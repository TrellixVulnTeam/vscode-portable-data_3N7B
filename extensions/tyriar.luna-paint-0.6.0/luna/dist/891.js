const a15_0x34d8=["zoom","2ypFkMD","_rectangleOtherPoint","state","sign","includes","abs","type","value","devicePixelRatio","darken","Resize Rectangle","_cursorOriginalRectangle","offsetY","Fill and outline","ctrlKey","render","bottom","right","Set Rectangle Blend Mode","_updateOutlineSize","2GgKVXt","Shift Rectangle","primaryColor","217039HLcROF","_finish","700589KjlqyN","setVisible","getPointerState","linearBurn","viewportService"," y=","_renderer","normal","17083vVZmDO","triggerRequestRender","Set Rectangle Outline Size","_onUpdate","currentLayer","9359RrnmxY","string","_updateStyle","onUpdate","_onHistoryUpdateValue","_value","none","move","_directionalMoveElements","removeChild","order","rectangleStep","_getStyleString","_getStyleValue","1xSjQvX","linearDodgeAdd","_clearRectLayer","_directionalMoveZones","imageService","registerTemporaryLayer","_onRequestRender","event","outlineSize","webpackChunkluna","setColors"," pixels wide by ","pointerMove","exclusion","get","temporaryLayer","keyDown","pointerDownMove","move-handle","_sc","createElement","round","buttons","_viewportService","paletteService","clientHeight","Set Rectangle Color","Style","_outlineSizeOption","_rectangleOrigin","616162gbiNmF","Draw Rectangle","_elementContainer","secondaryColor","onHistoryUnset","onBeforeRunLayerTask","shiftKey","name","6xkbXDS","metaKey","_rectLayerOwner","register","clientWidth","Set Rectangle Style","secondary","892488sZruCo","Outline Size","onCommit","pointerDown","_blendModeOption","ArrowDown","fire","left","_isVisible","Fill","min","topleft","_createRange","_setupActiveTemporaryLayer","_styleOption","_cursorCurrent","_onStateChange","getCoordsFromEvent","topright","top","difference","div","multiply","key","_cursorOrigin","ArrowLeft","setValueFromHistoryChange","_topLeftInfo","_range","classList","getInfo","currentState","display","Selection top left position is x=","Move Rectangle","Blend Mode","rectLayer","_updateColors","max","bottomright","_refreshInfo","style","ArrowRight","rectangle","options","Rectangle size is ","bottomleft","pointerUp","taskService","ArrowUp","lighten","historyService","_isCursorDown","_updateRectangle","_sizeInfo","commit","_updateBlendMode","onHistoryUpdateValue","range","1176541ddtnRH","new","primary","Outline","_container","onHistoryAction","_onOptionsChange","selectionService","overlay","onStateChange","offsetX","add","onLayerChange","blendMode","_imageService","screen","softLight","52YgtEGX"],a15_0x4f5e=function(t,e){return a15_0x34d8[t-=116]},a15_0x16f054=a15_0x4f5e;(function(t,e){const s=a15_0x4f5e;for(;;)try{if(887128==parseInt(s(267))*parseInt(s(227))+parseInt(s(254))*parseInt(s(281))-parseInt(s(210))+-parseInt(s(252))*-parseInt(s(229))+parseInt(s(249))*parseInt(s(136))-parseInt(s(151))+parseInt(s(144))*parseInt(s(262)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a15_0x34d8),(self[a15_0x16f054(290)]=self[a15_0x16f054(290)]||[]).push([[891],{9904:(t,e,s)=>{"use strict";const i=a15_0x16f054;s.d(e,{rP:()=>n,bG:()=>o,Jp:()=>a,qv:()=>c});var r=s(1815),h=s(5120);class n extends h.JT{constructor(t,e,s){const i=a15_0x4f5e;super(),this.name=t,this[i(195)]=e,this._value=s,this[i(235)]=i(268),this[i(271)]=this.register(new r.v),this[i(208)]=this[i(271)][i(288)],this._onUpdate=this[i(147)](new r.v),this.onUpdate=this[i(265)].event}get[i(236)](){return this[i(272)]}set[i(236)](t){const e=i;this[e(272)]=t,this[e(265)].fire()}setValueFromHistoryChange(t){const e=i;this._value=t,this[e(271)][e(157)](t)}}class o extends n{constructor(){const t=i;super("Blend Mode",[t(261),t(238),t(173),"linearBurn",t(201),t(225),t(282),t(218),t(226),"difference","exclusion"],t(261))}}class a extends n{constructor(){const t=i;super(t(186),[t(261),"replace","darken",t(173),t(257),"lighten","screen",t(282),t(218),"softLight",t(171),t(119)],t(261))}}class c extends h.JT{constructor(t,e,s,h){const n=i;super(),this[n(143)]=t,this[n(272)]=e,this.min=s,this[n(189)]=h,this.type="number",this[n(271)]=this[n(147)](new r.v),this[n(208)]=this[n(271)][n(288)],this._onUpdate=this[n(147)](new r.v),this.onUpdate=this._onUpdate.event}get[i(236)](){return this[i(272)]}set value(t){const e=i;this[e(272)]=t,this[e(265)].fire()}[i(177)](t){const e=i;this[e(272)]=t,this._onHistoryUpdateValue[e(157)](t)}}},7891:(t,e,s)=>{"use strict";const i=a15_0x16f054;s.r(e),s.d(e,{default:()=>d});var r=s(6374),h=s(1815),n=s(7896),o=s(5120),a=s(1003),c=s(807);class l extends o.JT{constructor(){const t=a15_0x4f5e;super(...arguments),this._onUpdate=this[t(147)](new h.v),this.onUpdate=this[t(265)][t(288)]}}var u=s(9904);class p extends o.JT{constructor(t){const e=a15_0x4f5e;super(),this[e(125)]=t,this.id=e(194),this[e(231)]=e(211),this._isCursorDown=!1,this[e(155)]=new u.bG,this[e(165)]=new u.rP(e(133),[e(213),e(160),"Fill and outline"],e(213)),this[e(134)]=new u.qv(e(152),1,1,1e3),this[e(195)]=[this[e(155)],this[e(165)],this[e(134)]],this[e(205)]=new g,this[e(178)]=new _,this.info=[this._topLeftInfo,this[e(205)]],this[e(287)]=this[e(147)](new h.v),this.onRequestRender=this[e(287)][e(288)],this._onStateChange=this[e(147)](new h.v),this[e(219)]=this[e(167)][e(288)],this[e(147)](this._sc[e(130)].onUpdate((()=>this[e(188)]()))),this[e(147)](this._styleOption.onUpdate((()=>this[e(269)]()))),this[e(147)](this._outlineSizeOption.onUpdate((()=>this[e(248)]()))),this[e(147)](this[e(155)][e(270)]((()=>this[e(207)]()))),this.register(this[e(125)][e(285)][e(222)]((()=>this[e(253)]()))),this[e(147)](this._sc[e(199)][e(141)]((()=>this[e(253)]()))),this[e(147)]({dispose:()=>this._finish()}),this[e(147)](this._sc[e(285)].onTemporaryLayerRegistered((t=>this[e(164)](t)))),this[e(125)][e(285)][e(266)]?.[e(121)]&&this[e(164)](this[e(125)][e(285)][e(266)].temporaryLayer)}[i(164)](t){const e=i;t[e(235)]===e(194)&&(this[e(187)]=t,this[e(147)](this[e(187)][e(153)]((()=>this._clearRectLayer()))),this.register(this[e(187)][e(215)]((()=>this[e(216)]()))),this[e(147)](this[e(187)][e(140)]((()=>this._clearRectLayer()))),this[e(135)]=[this[e(187)][e(182)][e(209)][e(158)],this.rectLayer[e(182)][e(209)][e(170)]],this[e(230)]=[this[e(187)][e(182)].range[e(246)],this[e(187)][e(182)][e(209)].bottom],this[e(260)]?.[e(255)](!0),this[e(287)][e(157)]())}[i(122)](t){const e=i;if(this[e(204)](t),this[e(187)]&&!this[e(203)]&&[e(200),e(176),"ArrowDown","ArrowRight"][e(233)](t[e(174)])){const s=(0,a.BN)(this[e(187)].currentState[e(209)]),i=(n.V?t[e(145)]:t[e(243)])?10:1;switch(t[e(174)]){case e(200):(0,a.Hd)(s,s[e(158)],s[e(170)]-i);break;case e(156):(0,a.Hd)(s,s[e(158)],s[e(170)]+i);break;case e(176):(0,a.Hd)(s,s[e(158)]-i,s.top);break;case e(193):(0,a.Hd)(s,s[e(158)]+i,s[e(170)])}this[e(187)][e(182)][e(209)]=s,this[e(187)][e(278)](e(250))}}keyUp(t){this[i(204)](t)}async[i(154)](t){const e=i;this[e(203)]=!0;const s=this[e(125)].imageService[e(266)];if(!s)return;const r=!(1&t[e(128)]),h=this[e(125)].viewportService[e(168)](t);if(this[e(175)]=h,this[e(166)]=h,!h)return;if(this[e(231)]!==e(211))return void(this[e(240)]=(0,a.BN)(this[e(187)]?.[e(182)].range));await this[e(253)](),this._rectangleOrigin=h,this[e(230)]=h;const n=this[e(163)](this[e(135)],this[e(230)]);this[e(240)]=(0,a.BN)(n),this[e(187)]=new c.F(s,{invertColors:r},{primaryColor:this[e(125)][e(130)].primary,secondaryColor:this[e(125)].paletteService[e(150)],blendMode:this[e(155)][e(236)],range:n,outlineSize:this._outlineSizeOption[e(236)],style:this[e(280)]()},this[e(125)][e(202)],this._sc[e(217)],this._sc.taskWorkerService),this[e(191)](),await s[e(286)](this[e(187)]),this[e(260)]?.[e(255)](!1),this[e(187)].triggerRequestRender()}[i(198)](t){const e=i;if(this[e(187)]){let t;switch(this[e(231)]){case e(211):t=e(137);break;case e(274):t=e(185);break;case e(162):case e(169):case e(197):case e(190):case e(170):case e(158):case e(246):case"bottom":t=e(239)}this[e(187)][e(278)](t)}this[e(203)]=!1,this._renderer?.setVisible(!0)}[i(123)](t){const e=i;if(!(this[e(135)]&&this[e(230)]&&this[e(175)]&&this[e(240)]))return;if(!this[e(125)][e(285)][e(266)])return;const s=this[e(125)][e(258)].getCoordsFromEvent(t);if(this[e(166)]=s,s[0]===this[e(230)][0]&&s[1]===this[e(230)][1])return;if(!this[e(187)])return;const r=this._cursorCurrent[0]-this._cursorOrigin[0],h=this._cursorCurrent[1]-this._cursorOrigin[1];switch(this[e(231)]){case e(211):return this[e(230)]=s,void this[e(204)](t);case e(274):{const t=(0,a.BN)(this._cursorOriginalRectangle);t.left+=r,t[e(170)]+=h,t[e(246)]+=r,t.bottom+=h,(0,a.FJ)(t),this[e(187)][e(182)][e(209)]=t;break}default:{let s;if(!t.shiftKey||this[e(231)]!==e(162)&&this[e(231)]!==e(169)&&this[e(231)]!==e(197)&&this.state!==e(190))s=(0,a.BN)(this[e(240)]),("top"===this[e(231)]||this.state===e(162)||"topright"===this.state)&&(s[e(170)]+=h),(this[e(231)]===e(245)||this[e(231)]===e(197)||this[e(231)]===e(190))&&(s[e(245)]+=h),(this[e(231)]===e(158)||"topleft"===this[e(231)]||this[e(231)]===e(197))&&(s[e(158)]+=r),(this[e(231)]===e(246)||this[e(231)]===e(169)||"bottomright"===this[e(231)])&&(s[e(246)]+=r);else{const t=(0,a.n3)(this._cursorOriginalRectangle);let i;switch(s=(0,a.BN)(this[e(240)]),this[e(231)]){case e(162):i=(1/t*-r-h)/2,s[e(158)]-=Math[e(127)](i*t),s[e(170)]-=Math[e(127)](i);break;case e(169):i=(r*(1/t)-h)/2,s[e(246)]+=Math[e(127)](i*t),s.top-=Math.round(i);break;case"bottomleft":i=(1/t*-r+h)/2,s[e(158)]-=Math[e(127)](i*t),s.bottom+=Math[e(127)](i);break;case"bottomright":i=(r*(1/t)+h)/2,s.right+=Math[e(127)](i*t),s[e(245)]+=Math[e(127)](i)}}this[e(187)][e(182)].range=(0,a.FJ)(s);break}}this._refreshInfo(),this[e(187)][e(263)]()}[i(118)](t){const e=i;if(this[e(260)]&&!this[e(203)]){const s=this[e(260)][e(256)](t);this.state!==s&&(this[e(231)]=s,this[e(167)].fire())}}[i(204)](t){const e=i;if(!(this[e(187)]&&this[e(135)]&&this[e(230)]&&this[e(203)]&&this[e(231)]===e(211)))return;let s=this[e(135)][0]-this._rectangleOtherPoint[0],r=this._rectangleOrigin[1]-this._rectangleOtherPoint[1];t[e(142)]&&(Math.abs(s)>Math[e(234)](r)?s=r*(Math[e(232)](s)!==Math[e(232)](r)?-1:1):r=s*(Math[e(232)](s)!==Math[e(232)](r)?-1:1)),this[e(187)][e(182)][e(209)]=this[e(163)](this._rectangleOrigin,[this[e(135)][0]-s,this[e(135)][1]-r]),this[e(191)](),this[e(187)][e(263)]()}[i(188)](){const t=i;if(!this[t(187)])return;const e=this[t(125)].paletteService.primary,s=this[t(125)][t(130)][t(150)];(0,r.W)(this[t(187)][t(182)][t(251)],e)&&(0,r.W)(this.rectLayer.currentState[t(139)],s)||(this[t(187)][t(182)][t(251)]=e,this[t(187)][t(182)].secondaryColor=s,this[t(187)].rectangleStep(t(132),!0),this.rectLayer.triggerRequestRender())}_updateStyle(){const t=i,e=this[t(280)]();this.rectLayer&&this[t(187)].currentState.style!==e&&(this[t(187)].currentState[t(192)]=e,this[t(187)][t(278)](t(149)),this[t(187)][t(263)]())}[i(280)](){const t=i;switch(this[t(165)][t(236)]){case"Outline":return 1;case t(160):return 2;case t(242):return 3}}[i(279)](t){const e=i;switch(t){case 1:return e(213);case 2:return e(160);case 3:return e(242)}}_updateOutlineSize(){const t=i,e=this[t(134)][t(236)];this[t(187)]&&this.rectLayer[t(182)].outlineSize!==e&&(this[t(187)][t(182)][t(289)]=e,this.rectLayer.rectangleStep(t(264),!0),this[t(187)].triggerRequestRender())}[i(207)](){const t=i,e=this[t(155)][t(236)];this.rectLayer&&this.rectLayer[t(182)].blendMode!==e&&(this[t(187)][t(182)][t(223)]=e,this[t(187)][t(278)](t(247)),this[t(187)][t(263)]())}[i(216)](){const t=i;this[t(187)]&&(this[t(155)].setValueFromHistoryChange(this[t(187)].currentState[t(223)]),this[t(134)][t(177)](this[t(187)][t(182)][t(289)]),this[t(165)][t(177)](this[t(279)](this[t(187)][t(182)][t(192)])),(!(0,r.W)(this[t(125)][t(130)][t(212)],this.rectLayer[t(182)].primaryColor)||!(0,r.W)(this[t(125)].paletteService.secondary,this[t(187)][t(182)][t(139)]))&&this[t(125)][t(130)][t(116)](this[t(187)][t(182)].primaryColor,this.rectLayer[t(182)][t(139)]))}async _finish(){const t=i;await(this.rectLayer?.[t(206)]()),this[t(283)]()}_clearRectLayer(){const t=i;this[t(187)]=void 0,this[t(240)]=void 0,this._renderer?.[t(255)](!1),this[t(287)][t(157)]()}[i(163)](t,e){return(0,a.tH)(t[0],t[1],e[0],e[1])}_refreshInfo(){const t=i;this._sizeInfo[t(209)]=this[t(187)]?.[t(182)][t(209)],this[t(178)].range=this.rectLayer?.[t(182)][t(209)]}createDomRenderProgram(t){const e=i;return this._renderer=new f(t,this,this[e(125)][e(258)],this[e(125)][e(285)]),this[e(260)].setVisible(this[e(231)]!==e(211)),this[e(260)]}}const d=p;class g extends l{constructor(){const t=i;super(...arguments),this[t(235)]="size"}get[i(209)](){return this[i(179)]}set[i(209)](t){const e=i;this[e(179)]=t,this._onUpdate[e(157)]()}get visible(){return!!this._range}[i(181)](){const t=i;return this._range?this[t(179)].right-this[t(179)][t(158)]+" x "+(this[t(179)][t(245)]-this._range[t(170)]):""}getDetailedInfo(){const t=i;if(!this[t(179)])return"";const e=this[t(179)][t(246)]-this[t(179)].left,s=this[t(179)][t(245)]-this[t(179)][t(170)];return t(196)+e+t(117)+s+" pixels tall"}}class _ extends l{constructor(){const t=i;super(...arguments),this[t(235)]=t(162)}get[i(209)](){return this[i(179)]}set[i(209)](t){const e=i;this[e(179)]=t,this[e(265)][e(157)]()}get visible(){return!!this[i(179)]}[i(181)](){const t=i;return this[t(179)]?this[t(179)][t(158)]+", "+this._range[t(170)]:""}getDetailedInfo(){const t=i;return this[t(179)]?t(184)+this._range[t(158)]+t(259)+this[t(179)][t(170)]:""}}class f extends o.JT{constructor(t,e,s,r){const h=i;super(),this[h(214)]=t,this[h(146)]=e,this[h(129)]=s,this[h(224)]=r,this[h(277)]=2,this._directionalMoveElements=new Map,this[h(284)]=new Map,this[h(159)]=!0,this[h(138)]=document[h(126)](h(172));const n=[h(162),h(169),h(197),"bottomright",h(170),h(245),h(158),h(246)];for(const t of n){const e=document[h(126)]("div");e[h(180)][h(221)](h(124)),this._elementContainer.appendChild(e),this[h(275)].set(t,e),this[h(284)].set(t,(0,a.Pq)())}this[h(214)].appendChild(this._elementContainer),this.register({dispose:()=>{const t=h;this[t(214)][t(276)](this[t(138)])}})}[i(255)](t){const e=i;t!==this[e(159)]&&(this[e(138)][e(192)][e(183)]=t?"":e(273),this._isVisible=t)}[i(244)](){const t=i;if(!this[t(146)][t(187)])return;const e=this[t(146)][t(187)][t(182)][t(209)],s=this._imageService.currentLayer;if(!s)return;const r=this[t(129)],h=Math.round(this[t(214)][t(148)]/2)-s.width/2*r.zoom,n=Math[t(127)](this[t(214)][t(131)]/2)-s.height/2*r.zoom,o=h+(r.x+e[t(158)])*r[t(228)],a=n+(r.y+e[t(170)])*r[t(228)],c=h+(r.x+e.right)*r[t(228)],l=n+(r.y+e[t(245)])*r.zoom,u=Math.round((o+c)/2),p=Math.round((a+l)/2),d=10*window[t(237)],g={left:Math.min(o+d,Math[t(189)](o,u-d)),top:Math[t(161)](a+d,Math.max(a,p-d)),right:Math[t(189)](c-d,Math[t(161)](c,u+d)),bottom:Math[t(189)](l-d,Math[t(161)](l,p+d))},_={left:o-d,top:a-d,right:c+d,bottom:l+d},f=this[t(284)].get("topleft");f[t(158)]=_.left,f.right=g[t(158)],f[t(170)]=_[t(170)],f[t(245)]=g.top;const y=this[t(275)].get("topleft");y[t(192)][t(158)]=o+"px",y[t(192)][t(170)]=a+"px";const m=this._directionalMoveZones[t(120)]("topright");m[t(158)]=g[t(246)],m[t(246)]=_.right,m[t(170)]=_[t(170)],m.bottom=g[t(170)];const v=this[t(275)].get(t(169));v.style.left=c+"px",v.style[t(170)]=a+"px";const x=this._directionalMoveZones[t(120)](t(197));x[t(158)]=_[t(158)],x[t(246)]=g[t(158)],x[t(170)]=g[t(245)],x.bottom=_[t(245)];const S=this[t(275)][t(120)](t(197));S[t(192)][t(158)]=o+"px",S[t(192)][t(170)]=l+"px";const b=this[t(284)].get(t(190));b[t(158)]=g[t(246)],b.right=_[t(246)],b[t(170)]=g[t(245)],b[t(245)]=_.bottom;const M=this[t(275)].get(t(190));M[t(192)][t(158)]=c+"px",M[t(192)][t(170)]=l+"px";const w=this[t(284)][t(120)](t(170));w[t(158)]=g.left,w[t(246)]=g[t(246)],w[t(170)]=_[t(170)],w.bottom=g.top;const R=this[t(275)][t(120)]("top");R[t(192)][t(158)]=u+"px",R.style.top=a+"px";const C=this._directionalMoveZones[t(120)](t(245));C[t(158)]=g[t(158)],C[t(246)]=g[t(246)],C[t(170)]=g.bottom,C[t(245)]=_[t(245)];const L=this[t(275)][t(120)](t(245));L[t(192)][t(158)]=u+"px",L[t(192)].top=l+"px";const O=this._directionalMoveZones[t(120)]("left");O[t(158)]=_[t(158)],O.right=g.left,O[t(170)]=g[t(170)],O[t(245)]=g[t(245)];const k=this[t(275)][t(120)]("left");k[t(192)][t(158)]=o+"px",k.style[t(170)]=p+"px";const I=this._directionalMoveZones[t(120)](t(246));I[t(158)]=g.right,I[t(246)]=_[t(246)],I[t(170)]=g[t(170)],I[t(245)]=g[t(245)];const U=this[t(275)][t(120)](t(246));U[t(192)][t(158)]=c+"px",U[t(192)][t(170)]=p+"px"}[i(256)](t){const e=i;if(!this[e(146)].rectLayer)return e(211);for(const[e,s]of this._directionalMoveZones)if(y(s,t.offsetX,t.offsetY))return e;const s=this._directionalMoveZones[e(120)]("topleft"),r=this._directionalMoveZones[e(120)](e(190));return y({left:s.left,top:s[e(170)],right:r[e(246)],bottom:r[e(245)]},t[e(220)],t[e(241)])?e(274):e(211)}}function y(t,e,s){const r=i;return e>=t.left&&e<t[r(246)]&&s>=t[r(170)]&&s<t.bottom}}}]);