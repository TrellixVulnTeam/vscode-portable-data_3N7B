const a14_0x5ba4=["max","softLight","_color","textContent","length","darken","_svg","_updateCursorInfo","210316IGotFO","style","_container","1087dLsHLo","fire","multiply","line","_outlineElementContainer","764359TgjTGv","stroke","historyService","createElementNS","_imageService","Blend Mode","_getOutlineElement","currentLayer","onUndo","order","options","_model","top","value","webpackChunkluna","_svgInnerLine","event","_outlineModel","svg","_blendModeOption","pointerDownMove","imageService","text","selectionService","createExtendedEdit","lighten","render","linearDodgeAdd","30202rftkoM","classList","_lastDownCoord","_onUpdate","offsetX","containsCoord","105394ejcJyG","none","atan2","onUpdate","pointerDown","push","_value","setAttribute","isValid","exclusion","display","pop","opacity","setValueFromHistoryChange","#000","81342sLpjvK","_getAngle","_viewportService","zoom","clientWidth","type","add","removeChild","normal","_getEdit","createDomRenderProgram","cursor-info","_svgLine","_element","_outlineElements","_isPointerDown","createElement","_cursorCoord","pencil","getCoordsFromEvent","abs","overlay","toString","block","linearBurn","38UZQIWY","onRedo","onRequestRender","_isShiftDown","_cursorInfo","commit","operationName","round","number","requestRender","difference","shiftKey","603285yMqawz","width","div","_onRequestRender","3qCCNGv","getColorFromPointerEvent","clientHeight","absolute","paletteService","activeEntry","_sc","_onHistoryUpdateValue","screen","height","viewportService","Pencil","position","_lastUpCoords","_drawLine","0.5","isVisible","onHistoryUpdateValue","_updateOutline","register","http://www.w3.org/2000/svg","left","replace","_hideCursorInfo","offsetY","_ignoreSetPixel","_edit","name","appendChild","strokeWidth","202DhYhsS"],a14_0x441a=function(t,s){return a14_0x5ba4[t-=111]},a14_0x1a8a24=a14_0x441a;(function(t,s){const i=a14_0x441a;for(;;)try{if(529440===-parseInt(i(191))+-parseInt(i(182))*parseInt(i(194))+parseInt(i(199))+-parseInt(i(111))*parseInt(i(152))+-parseInt(i(148))+-parseInt(i(233))+parseInt(i(227))*parseInt(i(136)))break;t.push(t.shift())}catch(s){t.push(t.shift())}})(a14_0x5ba4),(self[a14_0x1a8a24(213)]=self.webpackChunkluna||[])[a14_0x1a8a24(238)]([[525],{7571:(t,s,i)=>{"use strict";const e=a14_0x1a8a24;i.d(s,{P:()=>h});var n=i(5120);class h extends n.JT{constructor(t,s){const i=a14_0x441a;super(),this._container=t,this[i(210)]=s,this[i(208)]=2,this[i(124)]=document.createElement(i(150)),this[i(124)][i(228)].add(i(122)),this._container.appendChild(this[i(124)]),this[i(171)]({dispose:()=>this._container[i(118)](this[i(124)])})}[e(225)](){const t=e;this[t(124)][t(192)][t(243)]=this[t(210)][t(168)]?t(134):t(234),this._element[t(192)].left=this._model.x+"px",this[t(124)][t(192)][t(211)]=this._model.y+"px",this[t(124)][t(186)]=this[t(210)][t(221)]}}},566:(t,s,i)=>{"use strict";const e=a14_0x1a8a24;i.d(s,{d:()=>r,I:()=>a});var n=i(5120),h=i(1674),o=i(704);class r extends n.JT{constructor(t,s,i,e){const n=a14_0x441a;super(),this._container=t,this[n(203)]=s,this[n(113)]=i,this._model=e,this[n(208)]=2,this[n(125)]=[],this._outlineElementContainer=document[n(127)]("div"),this[n(193)][n(180)](this[n(198)]),this[n(189)]=document.createElementNS(h.q,n(217)),this._svgLine=document[n(202)](h.q,n(197)),this[n(123)][n(192)][n(200)]="#fff",this[n(123)][n(192)].strokeWidth="2",this._svgLine[n(192)][n(245)]=n(167),this._svgInnerLine=document[n(202)](h.q,"line"),this[n(214)][n(192)].stroke=n(247),this._svgInnerLine[n(192)][n(181)]="1",this[n(214)][n(192)][n(245)]="0.5",this._svg.append(this[n(123)],this._svgInnerLine),this._container[n(180)](this._svg),this[n(171)]({dispose:()=>{const t=n;this[t(193)].removeChild(this[t(198)]),this[t(193)][t(118)](this._svg)}})}[e(225)](){const t=e,s=this[t(113)],i=this._imageService[t(206)];if(!this[t(210)].isValid||!i)return this._outlineElementContainer[t(192)][t(243)]=t(234),void(this[t(189)][t(192)][t(243)]="none");if(s[t(114)]<4){if(this[t(198)][t(192)][t(243)]=t(234),this[t(189)][t(192)][t(243)]=t(134),i){const e=Math.round(this[t(193)][t(115)]/2)-i[t(149)]/2*s[t(114)]+s.x*s[t(114)],n=Math[t(143)](this[t(193)][t(154)]/2)-i[t(161)]/2*s[t(114)]+s.y*s[t(114)],h=(e+(this[t(210)].x1+.5)*s[t(114)])[t(133)](),o=(n+(this[t(210)].y1+.5)*s[t(114)])[t(133)](),r=(e+(this._model.x2+.5)*s[t(114)])[t(133)](),a=(n+(this[t(210)].y2+.5)*s[t(114)])[t(133)]();this._svg.setAttribute(t(149),this[t(193)][t(115)][t(133)]()),this._svg[t(240)](t(161),this._container[t(154)][t(133)]()),this[t(123)][t(240)]("x1",h),this[t(123)][t(240)]("y1",o),this[t(123)][t(240)]("x2",r),this[t(123)][t(240)]("y2",a),this[t(214)][t(240)]("x1",h),this[t(214)][t(240)]("y1",o),this[t(214)].setAttribute("x2",r),this[t(214)][t(240)]("y2",a)}return}this._outlineElementContainer[t(192)].display="block",this[t(189)][t(192)][t(243)]=t(234);const n=[];(0,o.g)(void 0,this[t(210)].x1,this[t(210)].y1,this._model.x2,this[t(210)].y2,((s,i)=>n[t(238)]([s,i])));const h=[];let r=0;for(;r<n[t(187)]-1;r++){const s=n[r];let i=r;if(s[0]===n[i+1][0]){for(;i+1<n[t(187)]&&s[0]===n[i+1][0];)i++;h.push([s[0],s[1],1,i-r+1])}else if(s[1]===n[i+1][1]){for(;i+1<n[t(187)]&&s[1]===n[i+1][1];)i++;h.push([s[0],s[1],i-r+1,1])}else h[t(238)]([s[0],s[1],1,1]);r=i}r===n[t(187)]-1&&h[t(238)]([n[r][0],n[r][1],1,1]);let a=0;for(const e of h){const n=Math[t(143)](this._container[t(115)]/2)-i.width/2*s[t(114)]+s.x*s[t(114)],h=Math[t(143)](this[t(193)][t(154)]/2)-i.height/2*s[t(114)]+s.y*s.zoom,o=this._getOutlineElement(a++);o.style[t(243)]=t(134),o[t(192)][t(173)]=n+e[0]*s.zoom-1+"px",o[t(192)].top=h+e[1]*s[t(114)]-1+"px",o[t(192)].width=e[2]*s[t(114)]+"px",o[t(192)][t(161)]=e[3]*s[t(114)]+"px"}for(;a<this[t(125)][t(187)];a++)this[t(125)][a][t(192)][t(243)]=t(234)}[e(205)](t){const s=e;for(;t>=this[s(125)][s(187)];){const t=document[s(127)]("div");t[s(192)][s(164)]=s(155),t[s(228)][s(117)]("outline"),this[s(125)][s(238)](t),this[s(198)][s(180)](t)}return this[s(125)][t]}}class a{constructor(){this[e(241)]=!1,this.x1=0,this.y1=0,this.x2=0,this.y2=0}}},9904:(t,s,i)=>{"use strict";const e=a14_0x1a8a24;i.d(s,{rP:()=>o,bG:()=>r,Jp:()=>a,qv:()=>c});var n=i(1815),h=i(5120);class o extends h.JT{constructor(t,s,i){const e=a14_0x441a;super(),this[e(179)]=t,this[e(209)]=s,this[e(239)]=i,this[e(116)]="string",this[e(159)]=this.register(new n.v),this.onHistoryUpdateValue=this[e(159)][e(215)],this._onUpdate=this[e(171)](new n.v),this[e(236)]=this[e(230)].event}get[e(212)](){return this[e(239)]}set[e(212)](t){const s=e;this[s(239)]=t,this[s(230)][s(195)]()}[e(246)](t){const s=e;this[s(239)]=t,this[s(159)][s(195)](t)}}class r extends o{constructor(){const t=e;super(t(204),[t(119),t(188),"multiply",t(135),t(224),t(160),t(226),t(132),t(184),t(146),t(242)],t(119))}}class a extends o{constructor(){const t=e;super(t(204),[t(119),t(174),t(188),t(196),t(135),t(224),"screen",t(226),t(132),t(184),t(146),t(242)],"normal")}}class c extends h.JT{constructor(t,s,i,h){const o=e;super(),this[o(179)]=t,this._value=s,this.min=i,this[o(183)]=h,this[o(116)]=o(144),this[o(159)]=this[o(171)](new n.v),this[o(169)]=this[o(159)][o(215)],this._onUpdate=this[o(171)](new n.v),this[o(236)]=this[o(230)][o(215)]}get[e(212)](){return this[e(239)]}set[e(212)](t){const s=e;this[s(239)]=t,this._onUpdate[s(195)]()}setValueFromHistoryChange(t){const s=e;this._value=t,this[s(159)][s(195)](t)}}},5525:(t,s,i)=>{"use strict";const e=a14_0x1a8a24;i.r(s),i.d(s,{default:()=>u});var n=i(1815),h=i(5120),o=i(9455),r=i(7571),a=i(566),c=i(9904),l=i(704);class d extends h.JT{constructor(t){const s=a14_0x441a;super(),this[s(158)]=t,this.id=s(129),this[s(165)]=[],this[s(128)]=[0,0],this[s(126)]=!1,this[s(139)]=!1,this[s(216)]=new a.I,this[s(218)]=new c.Jp,this[s(209)]=[this._blendModeOption],this[s(151)]=this.register(new n.v),this[s(138)]=this[s(151)][s(215)],this._cursorInfo={x:0,y:0,text:"",isVisible:!1},this.register(this[s(158)][s(201)][s(207)]((t=>{const i=s;t[i(142)]===i(163)&&this[i(158)].historyService[i(157)]?.[i(142)]===i(163)?this[i(165)]?.[i(244)]():this[i(165)][i(187)]=0}))),this[s(171)](this._sc[s(201)][s(137)]((()=>this[s(165)][s(187)]=0))),this._sc[s(162)].onUpdate((()=>{const t=s;this._outlineModel[t(241)]=!1,this[t(175)]()}))}[e(121)](t){const s=e;return[new r.P(t,this[s(140)]),new a.d(t,this[s(158)].imageService,this[s(158)].viewportService,this[s(216)])]}[e(237)](t){const s=e;this[s(126)]=!0;const i=this[s(158)][s(220)];if(!i[s(206)])return;if(this[s(185)]=this[s(158)][s(156)][s(153)](t),!this[s(185)])return;const n=this[s(158)].viewportService.getCoordsFromEvent(t);if(n){if(t.shiftKey&&this[s(165)].length>0){const t=this[s(165)][this[s(165)][s(187)]-1];this[s(177)]=t,this[s(166)](t,n,this._color),this._ignoreSetPixel=void 0}if(i[s(232)](n[0],n[1])){const t=this[s(120)]();this._setPixel(this[s(120)](),n[0],n[1],this[s(185)]),t[s(145)]()}this[s(229)]=n}}[e(219)](t){const s=e;if(!this[s(229)]||!this._color)return;const i=this[s(158)].imageService;if(!i[s(206)])return;const n=this[s(158)].viewportService.getCoordsFromEvent(t);this[s(229)][0]===n[0]&&this[s(229)][1]===n[1]||((i[s(232)](n[0],n[1])||i[s(232)](this[s(229)][0],this[s(229)][1]))&&this[s(166)](this[s(229)],n,this[s(185)]),this._lastDownCoord=n)}async pointerUp(t){const s=e;this[s(126)]=!1,this[s(158)].imageService[s(206)]&&(this[s(178)]?.[s(141)](s(163)),this[s(178)]=void 0);const i=this._sc[s(162)][s(130)](t);this[s(165)][s(238)](i),this[s(170)](t,!0)}async pointerMove(t){const s=e;this._cursorInfo.x=t[s(231)],this[s(140)].y=t[s(176)],this[s(128)]=this[s(158)][s(162)][s(130)](t),this._updateOutline(t),!this._isPointerDown&&t[s(147)]?this[s(190)]():this._cursorInfo[s(168)]&&this[s(175)]()}keyDown(t){const s=e;!this[s(139)]&&t[s(147)]&&(this[s(139)]=!0,!this[s(126)]&&(this[s(190)](),this[s(170)](t,!0)))}keyUp(t){const s=e;!t[s(147)]&&(this._outlineModel[s(241)]=!1,this[s(151)][s(195)](),this[s(140)][s(168)]&&this[s(175)](),this[s(139)]=!1)}_updateOutline(t,s){const i=e;if(s||this[i(216)].x1!==this[i(128)][0]||this[i(216)].y1!==this[i(128)][1]){if(this[i(216)].x1=this[i(128)][0],this[i(216)].y1=this[i(128)][1],!this[i(126)]&&t[i(147)]&&this._lastUpCoords.length>0){const t=this._lastUpCoords[this._lastUpCoords.length-1];this._outlineModel.x2=t[0],this._outlineModel.y2=t[1],this._outlineModel[i(241)]=!0}else this[i(216)].x2=this[i(128)][0],this._outlineModel.y2=this[i(128)][1],this[i(216)][i(241)]=this[i(158)][i(220)][i(232)](this[i(216)].x1,this[i(216)].y1);this._onRequestRender[i(195)]()}}_updateCursorInfo(){const t=e;if(0===this[t(165)][t(187)])return;if(!this[t(128)])return;const s=this[t(165)][this[t(165)][t(187)]-1];if(s[0]===this._cursorCoord[0]&&s[1]===this[t(128)][1])return;const i=this[t(112)](s,this[t(128)]);this[t(140)][t(221)]=i+"°",this[t(140)].isVisible=!0,this._onRequestRender[t(195)]()}[e(112)](t,s){return Math[e(143)](10*(0,o.AM)(t[0],t[1],s[0],s[1]))/10}[e(175)](){const t=e;this[t(140)].isVisible=!1,this[t(151)][t(195)]()}_drawLine(t,s,i){const n=e,h=this[n(120)]();(0,l.g)(i,t[0],t[1],s[0],s[1],((t,s,i)=>this._setPixel(h,t,s,i))),h[n(145)]()}[e(120)](){const t=e;if(!this[t(178)]&&(this[t(178)]=this[t(158)][t(220)].currentLayer?.[t(223)](),!this[t(178)]))throw new Error("Could not create extended edit");return this[t(178)]}_setPixel(t,s,i,n){const h=e;this._ignoreSetPixel&&this[h(177)][0]===s&&this[h(177)][1]===i||this._sc[h(222)][h(232)](s,i)&&this._sc[h(220)].containsCoord(s,i)&&t.setPixel(s,i,n,this[h(218)][h(212)]===h(174)?void 0:this._blendModeOption[h(212)])}}const u=d},704:(t,s,i)=>{"use strict";function e(t,s,i,e,o,r){const a=a14_0x441a;Math[a(131)](o-i)<Math[a(131)](e-s)?s>e?n(t,e,o,s,i,r):n(t,s,i,e,o,r):i>o?h(t,e,o,s,i,r):h(t,s,i,e,o,r)}function n(t,s,i,e,n,h){const o=e-s;let r=n-i,a=1;r<0&&(a=-1,r=-r);let c=2*r-o,l=i;for(let i=s;i<=e;i++)h(i,l,t),c>0?(l+=a,c+=2*(r-o)):c+=2*r}function h(t,s,i,e,n,h){let o=e-s;const r=n-i;let a=1;o<0&&(a=-1,o=-o);let c=2*o-r,l=s;for(let s=i;s<=n;s++)h(l,s,t),c>0?(l+=a,c+=2*(o-r)):c+=2*o}i.d(s,{g:()=>e})},1674:(t,s,i)=>{"use strict";const e=a14_0x1a8a24;i.d(s,{q:()=>n});const n=e(172)},9455:(t,s,i)=>{"use strict";function e(t,s,i,e){return 180*function(t,s,i,e){let n=-Math[a14_0x441a(235)](e-s,i-t);return-180===n&&(n=180),n}(t,s,i,e)/Math.PI}function n(t){return t*Math.PI/180}i.d(s,{AM:()=>e,Ht:()=>n})}}]);