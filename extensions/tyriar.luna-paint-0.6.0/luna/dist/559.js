const a11_0xd53a=["setAttribute","209390dUcTBE","svg","_container","_color","_outlineElements","value","appendChild","_svg","_onHistoryUpdateValue","strokeWidth","_sc","Blend Mode","line","lighten","render","0.5","onHistoryUpdateValue","max","setValueFromHistoryChange","sin","block","linearDodgeAdd","multiply","event","_onRequestRender","2QFiDCg","clientWidth","containsCoord","fire","_setPixel","14301dGamsL","webpackChunkluna","http://www.w3.org/2000/svg","exclusion","_outlineModel","getCoordsFromEvent","atan2","min","_isShiftDown","_isPointerDown","8KwNYZW","none","_blendModeOption","47462WJhQcM","_drawLine","left","style","_getAngle","onRequestRender","width","_hideCursorInfo","_imageService","pointerDown","textContent","_svgInnerLine","string","17038JPKosl","_updateOutline","offsetY","shiftKey","28jVpoWq","keyDown","linearBurn","classList","1goTHxL","div","_model","height","_downCoord","overlay","#fff","viewportService","length","stroke","609513jPCNxF","register","_viewportService","selectionService","screen","onUpdate","540535aWBNuD","commit","reduce","isVisible","softLight","display","darken","opacity","createDomRenderProgram","top","_updateCursorInfo","pointerUp","round","normal","_element","difference","setPixel","_onUpdate","add","createElement","_cursorCoord","_svgLine","toString","zoom","_value","clientHeight","createElementNS","_cursorInfo","createExtendedEdit","124181exxDOe","number","absolute","pointerDownMove","order","replace","type","imageService","currentLayer","1SKddyO","pow","isValid","requestRender","abs","removeChild","_getOutlineElement","keyUp","_ignoreSetPixel","push","_outlineElementContainer"],a11_0x5ae8=function(t,s){return a11_0xd53a[t-=271]},a11_0x389df8=a11_0x5ae8;(function(t,s){const e=a11_0x5ae8;for(;;)try{if(282178===parseInt(e(343))*parseInt(e(333))-parseInt(e(346))+-parseInt(e(328))*parseInt(e(282))+parseInt(e(383))*parseInt(e(367))+parseInt(e(363))*-parseInt(e(359))+parseInt(e(303))*-parseInt(e(291))+parseInt(e(377)))break;t.push(t.shift())}catch(s){t.push(t.shift())}})(a11_0xd53a),(self.webpackChunkluna=self[a11_0x389df8(334)]||[])[a11_0x389df8(300)]([[559],{7571:(t,s,e)=>{"use strict";const i=a11_0x389df8;e.d(s,{P:()=>h});var n=e(5120);class h extends n.JT{constructor(t,s){const e=a11_0x5ae8;super(),this._container=t,this[e(369)]=s,this[e(286)]=2,this[e(397)]=document.createElement(e(368)),this._element[e(366)][e(271)]("cursor-info"),this._container.appendChild(this[e(397)]),this[e(378)]({dispose:()=>this[e(305)][e(296)](this[e(397)])})}[i(317)](){const t=i;this[t(397)][t(349)][t(388)]=this[t(369)][t(386)]?t(323):t(344),this[t(397)][t(349)][t(348)]=this[t(369)].x+"px",this[t(397)].style[t(392)]=this[t(369)].y+"px",this[t(397)][t(356)]=this[t(369)].text}}},566:(t,s,e)=>{"use strict";const i=a11_0x389df8;e.d(s,{d:()=>r,I:()=>a});var n=e(5120),h=e(1674),o=e(704);class r extends n.JT{constructor(t,s,e,i){const n=a11_0x5ae8;super(),this[n(305)]=t,this[n(354)]=s,this[n(379)]=e,this[n(369)]=i,this[n(286)]=2,this._outlineElements=[],this[n(301)]=document.createElement("div"),this._container[n(309)](this[n(301)]),this[n(310)]=document.createElementNS(h.q,n(304)),this[n(274)]=document[n(279)](h.q,n(315)),this[n(274)][n(349)][n(376)]=n(373),this[n(274)][n(349)][n(312)]="2",this[n(274)].style.opacity="0.5",this._svgInnerLine=document[n(279)](h.q,n(315)),this._svgInnerLine.style[n(376)]="#000",this[n(357)].style[n(312)]="1",this[n(357)][n(349)][n(390)]=n(318),this[n(310)].append(this[n(274)],this[n(357)]),this[n(305)][n(309)](this[n(310)]),this[n(378)]({dispose:()=>{const t=n;this[t(305)][t(296)](this[t(301)]),this[t(305)][t(296)](this[t(310)])}})}[i(317)](){const t=i,s=this[t(379)],e=this._imageService[t(290)];if(!this[t(369)][t(293)]||!e)return this[t(301)][t(349)][t(388)]=t(344),void(this[t(310)][t(349)][t(388)]="none");if(s[t(276)]<4){if(this[t(301)].style[t(388)]="none",this[t(310)][t(349)][t(388)]="block",e){const i=Math[t(395)](this[t(305)][t(329)]/2)-e[t(352)]/2*s[t(276)]+s.x*s[t(276)],n=Math[t(395)](this._container.clientHeight/2)-e[t(370)]/2*s[t(276)]+s.y*s[t(276)],h=(i+(this[t(369)].x1+.5)*s[t(276)])[t(275)](),o=(n+(this[t(369)].y1+.5)*s.zoom).toString(),r=(i+(this[t(369)].x2+.5)*s.zoom)[t(275)](),a=(n+(this[t(369)].y2+.5)*s[t(276)])[t(275)]();this[t(310)].setAttribute(t(352),this[t(305)][t(329)][t(275)]()),this[t(310)][t(302)](t(370),this[t(305)][t(278)][t(275)]()),this[t(274)][t(302)]("x1",h),this[t(274)][t(302)]("y1",o),this[t(274)][t(302)]("x2",r),this[t(274)][t(302)]("y2",a),this[t(357)].setAttribute("x1",h),this._svgInnerLine[t(302)]("y1",o),this._svgInnerLine.setAttribute("x2",r),this._svgInnerLine[t(302)]("y2",a)}return}this[t(301)].style[t(388)]=t(323),this._svg[t(349)][t(388)]=t(344);const n=[];(0,o.g)(void 0,this[t(369)].x1,this._model.y1,this[t(369)].x2,this._model.y2,((s,e)=>n[t(300)]([s,e])));const h=[];let r=0;for(;r<n[t(375)]-1;r++){const s=n[r];let e=r;if(s[0]===n[e+1][0]){for(;e+1<n[t(375)]&&s[0]===n[e+1][0];)e++;h[t(300)]([s[0],s[1],1,e-r+1])}else if(s[1]===n[e+1][1]){for(;e+1<n.length&&s[1]===n[e+1][1];)e++;h[t(300)]([s[0],s[1],e-r+1,1])}else h.push([s[0],s[1],1,1]);r=e}r===n.length-1&&h.push([n[r][0],n[r][1],1,1]);let a=0;for(const i of h){const n=Math[t(395)](this[t(305)][t(329)]/2)-e[t(352)]/2*s[t(276)]+s.x*s.zoom,h=Math[t(395)](this[t(305)][t(278)]/2)-e[t(370)]/2*s[t(276)]+s.y*s.zoom,o=this[t(297)](a++);o.style[t(388)]=t(323),o.style[t(348)]=n+i[0]*s[t(276)]-1+"px",o[t(349)][t(392)]=h+i[1]*s[t(276)]-1+"px",o[t(349)].width=i[2]*s.zoom+"px",o.style[t(370)]=i[3]*s.zoom+"px"}for(;a<this._outlineElements[t(375)];a++)this._outlineElements[a][t(349)][t(388)]=t(344)}[i(297)](t){const s=i;for(;t>=this._outlineElements[s(375)];){const t=document[s(272)](s(368));t[s(349)].position=s(284),t[s(366)][s(271)]("outline"),this._outlineElements.push(t),this[s(301)].appendChild(t)}return this[s(307)][t]}}class a{constructor(){this[i(293)]=!1,this.x1=0,this.y1=0,this.x2=0,this.y2=0}}},9904:(t,s,e)=>{"use strict";const i=a11_0x389df8;e.d(s,{rP:()=>o,bG:()=>r,Jp:()=>a,qv:()=>c});var n=e(1815),h=e(5120);class o extends h.JT{constructor(t,s,e){const i=a11_0x5ae8;super(),this.name=t,this.options=s,this[i(277)]=e,this[i(288)]=i(358),this[i(311)]=this.register(new n.v),this.onHistoryUpdateValue=this[i(311)].event,this._onUpdate=this.register(new n.v),this[i(382)]=this[i(400)][i(326)]}get value(){return this[a11_0x5ae8(277)]}set value(t){const s=a11_0x5ae8;this[s(277)]=t,this[s(400)][s(331)]()}[i(321)](t){const s=i;this[s(277)]=t,this[s(311)][s(331)](t)}}class r extends o{constructor(){const t=i;super(t(314),[t(396),t(389),t(325),t(365),t(316),t(381),t(324),t(372),"softLight",t(398),t(336)],t(396))}}class a extends o{constructor(){const t=i;super(t(314),[t(396),t(287),t(389),t(325),t(365),t(316),t(381),t(324),t(372),t(387),"difference","exclusion"],t(396))}}class c extends h.JT{constructor(t,s,e,h){const o=i;super(),this.name=t,this[o(277)]=s,this[o(340)]=e,this[o(320)]=h,this[o(288)]=o(283),this._onHistoryUpdateValue=this[o(378)](new n.v),this[o(319)]=this._onHistoryUpdateValue.event,this[o(400)]=this[o(378)](new n.v),this[o(382)]=this._onUpdate[o(326)]}get[i(308)](){return this[i(277)]}set[i(308)](t){const s=i;this._value=t,this._onUpdate[s(331)]()}[i(321)](t){const s=i;this[s(277)]=t,this[s(311)][s(331)](t)}}},8559:(t,s,e)=>{"use strict";const i=a11_0x389df8;e.r(s),e.d(s,{default:()=>_});var n=e(1815),h=e(5120),o=e(9455),r=e(7571),a=e(566),c=e(9904),l=e(704);const d=[-180,-165,-150,-135,-120,-105,-90,-75,-60,-45,-30,-15,0,15,30,45,60,75,90,105,120,135,150,165,180];class u extends h.JT{constructor(t){const s=a11_0x5ae8;super(),this._sc=t,this.id=s(315),this[s(273)]=[0,0],this[s(342)]=!1,this[s(341)]=!1,this._outlineModel=new a.I,this[s(345)]=new c.Jp,this.options=[this[s(345)]],this[s(327)]=this[s(378)](new n.v),this[s(351)]=this[s(327)][s(326)],this[s(280)]={x:0,y:0,text:"",isVisible:!1},this[s(378)](this[s(313)][s(374)].onUpdate((()=>this[s(353)]())))}[i(391)](t){const s=i;return[new r.P(t,this[s(280)]),new a.d(t,this[s(313)][s(289)],this[s(313)][s(374)],this[s(337)])]}[i(355)](t){const s=i;if(this[s(342)]=!0,!this._sc.imageService[s(290)])return;if(this[s(306)]=this[s(313)].paletteService.getColorFromPointerEvent(t),!this._color)return;const e=this[s(313)][s(374)][s(338)](t);e&&(this[s(371)]=e,this._cursorCoord=[...e],this[s(360)](t))}[i(285)](t){const s=i;if(!this[s(371)]||!this[s(306)])return;if(!this[s(313)][s(289)][s(290)])return;const e=this[s(313)][s(374)][s(338)](t);this[s(371)][0]===e[0]&&this[s(371)][1]===e[1]||this[s(360)](t)}async[i(394)](t){const s=i;this[s(342)]=!1,this[s(371)]&&this[s(306)]&&(this[s(347)](this[s(371)],[this[s(337)].x2,this[s(337)].y2],this[s(306)]),this._downCoord=void 0,this[s(360)](t))}async pointerMove(t){const s=i;this[s(280)].x=t.offsetX,this[s(280)].y=t[s(361)],this[s(273)]=this[s(313)][s(374)][s(338)](t),this[s(360)](t),this[s(342)]&&t.shiftKey?this._updateCursorInfo():this[s(280)][s(386)]&&this[s(353)]()}[i(364)](t){const s=i;!this._isShiftDown&&t[s(362)]&&(this[s(341)]=!0,this[s(342)]&&this[s(360)](t))}[i(298)](t){const s=i;!t[s(362)]&&(this[s(341)]=!1,this[s(342)]&&this[s(360)](t))}[i(360)](t){const s=i;if(!this._isPointerDown||!this._downCoord)return void(this._outlineModel.isValid=!1);let e=this[s(273)];if(this._isShiftDown){const t=this[s(350)](this[s(371)],this[s(273)]),i=(0,o.Ht)(this._getClosestSnapDegrees(t)),n=Math.sqrt(Math[s(292)](this._downCoord[0]-this[s(273)][0],2)+Math[s(292)](this[s(371)][1]-this[s(273)][1],2));e=[Math[s(395)](this[s(371)][0]+n*Math.cos(i)),Math[s(395)](this[s(371)][1]-n*Math[s(322)](i))]}this[s(337)].x1=this._downCoord[0],this._outlineModel.y1=this[s(371)][1],this[s(337)].x2=e[0],this._outlineModel.y2=e[1],this[s(337)][s(293)]=!0,this[s(327)].fire(),this[s(393)]()}_updateCursorInfo(){const t=i;if(!this._downCoord)return;if(!this[t(273)])return;const s=this[t(371)];if(s[0]===this._cursorCoord[0]&&s[1]===this[t(273)][1])return;let e=this._getAngle(this[t(371)],this[t(273)]);this[t(341)]&&(e=this._getClosestSnapDegrees(e)),this._cursorInfo.text=e+"°",this[t(280)][t(386)]=!0,this._onRequestRender[t(331)]()}_getAngle(t,s){return Math[i(395)](10*(0,o.AM)(t[0],t[1],s[0],s[1]))/10}_getClosestSnapDegrees(t){const s=i;return d[s(385)](((e,i)=>Math.abs(i-t)<Math[s(295)](e-t)?i:e))}[i(353)](){const t=i;this[t(280)][t(386)]=!1,this[t(327)][t(331)]()}_drawLine(t,s,e){const n=i,h=this[n(313)][n(289)].currentLayer?.[n(281)]();if(!h)throw new Error("Could not create extended edit");(0,l.g)(e,t[0],t[1],s[0],s[1],((t,s,e)=>this[n(332)](h,t,s,e))),h[n(294)](),h[n(384)]("Draw Line")}[i(332)](t,s,e,n){const h=i;this._ignoreSetPixel&&this[h(299)][0]===s&&this._ignoreSetPixel[1]===e||this[h(313)][h(380)][h(330)](s,e)&&this._sc.imageService.containsCoord(s,e)&&t[h(399)](s,e,n,this[h(345)].value===h(287)?void 0:this[h(345)].value)}}const _=u},704:(t,s,e)=>{"use strict";function i(t,s,e,i,o,r){Math.abs(o-e)<Math.abs(i-s)?s>i?n(t,i,o,s,e,r):n(t,s,e,i,o,r):e>o?h(t,i,o,s,e,r):h(t,s,e,i,o,r)}function n(t,s,e,i,n,h){const o=i-s;let r=n-e,a=1;r<0&&(a=-1,r=-r);let c=2*r-o,l=e;for(let e=s;e<=i;e++)h(e,l,t),c>0?(l+=a,c+=2*(r-o)):c+=2*r}function h(t,s,e,i,n,h){let o=i-s;const r=n-e;let a=1;o<0&&(a=-1,o=-o);let c=2*o-r,l=s;for(let s=e;s<=n;s++)h(l,s,t),c>0?(l+=a,c+=2*(o-r)):c+=2*o}e.d(s,{g:()=>i})},1674:(t,s,e)=>{"use strict";const i=a11_0x389df8;e.d(s,{q:()=>n});const n=i(335)},9455:(t,s,e)=>{"use strict";function i(t,s,e,i){return 180*function(t,s,e,i){let n=-Math[a11_0x5ae8(339)](i-s,e-t);return-180===n&&(n=180),n}(t,s,e,i)/Math.PI}function n(t){return t*Math.PI/180}e.d(s,{AM:()=>i,Ht:()=>n})}}]);