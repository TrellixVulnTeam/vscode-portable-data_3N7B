const a2_0x15c6=["extName","addEntry","webpackChunkluna","container","pointerDownMove","linearDodgeAdd","getAttribute","#gui","sort","[invokeFunction] unknown service '","InstantiationService","dragging","serialize","_undoName","Hard edges","movePixels","aria-label","createTexture","block","onHistoryUpdateValue","goToTopImage","exportBlobClone","anchor","newImage","_stateService","hasStateHandler","ctrl+d","ctrl+alt+pageup","Space","terminate","imageSet","_onPointerDownMove","--vscode-foreground","factory","_undoImage","default","_rangeNotYetRequested","secondaryColor","Zoom In","bottomleft"," Layer","onHistoryUnset","SharedArrayBuffer","_isAnimating","_renderLayers","BLEND","clientX","onUpdate","Deselect","_glSelection","new","onKeyUp","2 colors","image.resize","Layers are not supported for this image type","MAX_TEXTURE_IMAGE_UNITS","_onRequestRender","openBlob","How many bits per pixel should be used for the image?","_commands","Go to Bottom Image","undoRange","resume","_onShowViewportChange","_selection","Toggle the minimap","getLayer","_showError","blendFuncSeparate","_contributions","_parentLayer","abs","pixelCount","map","commit","layer-new","ctrl+o","mimeType","requestNewDimensions","_getImageOrActiveIndex","UNSIGNED_BYTE","Rotate 90° Counter Clockwise","_shiftValue","deleteProgram","layer-delete","parentElement","ContextKeyService","Could not find temp layer ",'", ignoring',"_renderTileSet","setTimeout","Tools","_isDisposed","mergeLayerDown","Bottom left","insertBefore","event","filterCommands","_viewportService","refreshTheme","triggerRequestRender","click","stencilFunc","__param","_updateColorViaSlider","History entry type ","tool.hand","_statusBarService","_viewportPosition","setVisible","loadedImages","requestInput","nextSibling","_imageIdCounter","onZoomChange","width","_layersModel","from","createVertexArray","ctrl+shift+i","layer.mergeLayerDown","_toolService","WebGL context loss, please reload the tab","_isStretchEnabled","start","selection.erase","offsetX","setImageSoftDeleted","setPixel","_data","normal","NOTEQUAL","actions","preview","error","_restoreEntry","Layer","isStretchEnabled","Rotate 180°","moveImageDown","exportImageClone","view.togglePixelGrid","add","layer/resizeCanvas","_updateUniformValueMatrix","then","select","_imageFileService"," * a_position;\n}","tool.eraser","setTool","removeEventListener","_viewService","clipboard","_update","createDomRenderProgram","_elementResizeObserver","_createListItemElement","_updateUniformValueZoom","min","WinCE","Menu","values","Move Image Down","attach","Toggle small images between actual size and stretching to fit the minimap dimensions","Move Layer Down","_onmessage","1-bit","_onDidAddBottomItem","_onDidRemoveBottomItem","Edit","keydown","item","_name","offsetTop","--vscode-editor-background","imageResize","onImageChange","indexList","di$target","color-box","4-bit","_redoData",", bottom: ","_stopAnimatingProgram","pageX","mousedown","_luna","src","_entries","_undoBlendMode",", right: ","webglcontextlost","_onStopAnimating","hotExitMaxPixels","reportIssue","Move Layer to Top","inputBoxString",".bmp","Import Blob","_frameBufferRenderBuffer","metaKey","_blendWithframeBufferUniformLocation","getColorFromPointerEvent","createItem","getCommand","onHistoryAction","flattenLayers","rectangleStep","parentNode","effectAllowed","Unknown","_animationFrame","onStopAnimating","_commandService","flipX","Toggle Top Status Bar View","right-items","_toolRenderPrograms","toFixed","_inputService","releasePointerCapture","_createColorInfo","MacIntel","6odzqNw","Flip Vertical","onDidEndDrag","attachShader","#444444","useMovingLayer","image.goToImageBelow","initialState","onDidRemoveTopItem","div","_createMinimapImageBounds","createRenderProgram","push","_checkLayerSupport","_onBeforeRunLayerTask","setPointerCapture","_getIndexFromId","Win16","StatusBarService","layer.goToLayerAbove","validate","onDidAddTopItem","Copy","activeImageFileId","textContent","ctrlKey","_matrixNeedsUpdate","_layerListElement","_value","tabIndex","ctrl+shift+n","temporaryLayer","layer.moveLayerToTop","range","_progress","LINK_STATUS","findIndex","getAll","style","layer/invertColors","_clickOrigin","u_pixelsize","image-dimensions","pattern","StateService","floor","_removeItem","_startTime","STENCIL_TEST","_matrixLocation","triggerHistoryUnset","_clipspaceToCanvasCoordsMatrix","substr","postMessage","checked","_cachedMovingLayer","mouseleft","_forwardEventToTool","IpcService","exportBlob","image.rotate180","adjustMovePixels","_updateProgress","No active image index","_zoom","Create a new layer","undoHandler","_updateBottomLayer","Save","_frameBufferUniformLocation","_previewCache","hasOwnProperty","image.toggleImagesWindow","_imageLayerIdCounter","_textureAUniformLocation","change","_onPointerDown","moveSelectedPixels","fitToWindow","redoName","Redo","Move Pixels","scaledWidth","ContextMenuService","_isRestoringState","prototype",'Job dimension not found for task "',"_updatePalette","side","--luna-icon-brightness","onDidStartDrag","_historyService","layer-list","load","_openImages","_contentElement","remove","moveImageToTop","layer.duplicateLayer","_viewElement","_onProgress","onPointerDownMove","_createToggle","checkbox","_paletteService","denied","setMimeType","uniform1f","linkProgram","_onRequestTool","duplicateImage","dataTransfer","KeybindingService","_nullTexture","getUniformLocation","_quickPickService","drawCircle","_action","_attachedDisposables","Draw Rectangle","deleteImage","DEPTH_STENCIL_ATTACHMENT","_onSoftDeletedChange",".js","writeIco","pointermove","framebufferTexture2D","_setState","tool.handUntilRelease",'Unknown command id for type "',"_imageSet","Toggle Tools Window","_onRedo","onProgress","ctrl+n","selectionStart","clipboard-read","canUndo","Toggle Minimap Window","rightItems","selection","moveImageUp","Erase","_vertexArrayObject","Report Issue...","editIndex","focusout","goToImageBelow","dims","_hexInputElement","newLayer","pauseanimations","texImage2D","invokeFunction","registerTemporaryLayer","_isWindowAnchor","bottomStatusBar","isBottomLayer","_viewportElement","_imageFileId","deltaY","layer.flipVertical","focus","requiresTool","296857hctFSn","_imageListItems","_matrixUniformLocation","drawImage","_getCanvasBounds","_handlePointerUp","topleft","createImageBitmap","_screenPixelToCanvasCoord","vscode.main","onDidRemoveBottomItem","restoreState","encodeOptions","STATIC_DRAW","Image","vscode.executeCommand","data-active-tool","Could not restore workbench state (version ","_updateWindowViewPosition","reduce","620576luFaar",'Could not find non-existent window view "','Response received without request "',"Top left","No history entry ID to restore","Move the active image down","onImagesChange","primary","rgba(","classList","ONE_MINUS_SRC_ALPHA","layer/rotate90Clockwise","resize","unloadedImages","toBlob","Go to Image Above","_texcoordBuffer","triggerHistoryAction","label","end",";\n\nvoid main() {\n  gl_Position = ","requestQuickPick","The images window is not supported for this file type","target","Move the active image up","setService","onStretchEnabledChange"," x ","Window","Invalid range - left: ","Empty","setOption","resolve","TRIANGLES","WebGL2 is not supported","createFramebuffer","_vscodeApi","image/png","_createLayer","runAction","Select where to anchor the existing image","getProgramParameter","onVisibilityChange","string","generateLayerPreview","_height","STENCIL_BUFFER_BIT","layer/expandCanvasToSelection","Paste","toString",") in vec4 a_position;\n\nuniform mat4 ","_positionsArray","Selection top left position is x=","vscode.setContext","_needsAttributeUpdate","HelpService","Layer Blend Mode: "," ||\n      mod(v_position.y / ","getOwnPropertyDescriptor","OffscreenCanvas","indexOf","image/jpeg","_frameBufferTexture","color-overlay","getColorSetFromPointerEvent","requestAnimationFrame","_taskWorkerService","layer.flipHorizontal","uniform2f","Move Layer Up","moveSelection","minimap.toggleMinimapWindow","onLayerVisibilityChange","config","precision mediump float;varying vec2 v_texcoord;uniform int h;uniform int k;uniform vec2 d;uniform vec2 f;uniform vec2 g;uniform int m;uniform vec2 l;uniform int c[7];uniform sampler2D j[7];uniform sampler2D n;uniform vec2 o;vec3 A(vec4 B,vec4 C,vec3 D){float E=B.a*C.a;return(B.a-E)*B.rgb+(C.a-E)*C.rgb+E*D;}vec4 F(vec4 B,vec4 C,int G){if(C.a==0.){return B;}if(B.a==0.){return C;}vec3 H;if(G==1){H=C.rgb;}else if(G==3){H=vec3(min(B.r,C.r),min(B.g,C.g),min(B.b,C.b));}else if(G==4){H=B.rgb*C.rgb;}else if(G==6){H=max(B.rgb+C.rgb-1.,0.);}else if(G==8){H=vec3(max(B.r,C.r),max(B.g,C.g),max(B.b,C.b));}else if(G==9){H=vec3(1.-(1.-B.r)*(1.-C.r),1.-(1.-B.g)*(1.-C.g),1.-(1.-B.b)*(1.-C.b));}else if(G==11){H=min(B.rgb+C.rgb,vec3(1.));}else if(G==13){H=vec3(B.r<.5?(2.*B.r*C.r):(1.-2.*(1.-B.r)*(1.-C.r)),B.g<.5?(2.*B.g*C.g):(1.-2.*(1.-B.g)*(1.-C.g)),B.b<.5?(2.*B.b*C.b):(1.-2.*(1.-B.b)*(1.-C.b)));}else if(G==14){H=vec3(C.r<.5?(2.*B.r*C.r+B.r*B.r*(1.-2.*C.r)):(sqrt(B.r)*(2.*C.r-1.)+2.*B.r*(1.-C.r)),C.g<.5?(2.*B.g*C.g+B.g*B.g*(1.-2.*C.g)):(sqrt(B.g)*(2.*C.g-1.)+2.*B.g*(1.-C.g)),C.b<.5?(2.*B.b*C.b+B.b*B.b*(1.-2.*C.b)):(sqrt(B.b)*(2.*C.b-1.)+2.*B.b*(1.-C.b)));}else if(G==20){H=abs(B.rgb-C.rgb);}else if(G==21){H=B.rgb+C.rgb-2.*B.rgb*C.rgb;}float I=C.a+B.a*(1.-C.a);return vec4(A(B,C,H)/I,I);}void main(){vec4 B;if(g==f&&d==vec2(0.)){B=texture2D(j[0],v_texcoord);}else{if(v_texcoord.x>=(d.x)/g.x&&v_texcoord.y>=(d.y)/g.y&&v_texcoord.x<((d.x)+f.x)/g.x&&v_texcoord.y<((d.y)+f.y)/g.y){vec2 J=v_texcoord-vec2(d.x/g.x,d.y/g.y);vec2 K=J*vec2(g.x/f.x,g.y/f.y);if(o.x==1.){K.x=1.-K.x;}if(o.y==1.){K.y=1.-K.y;}B=texture2D(j[0],K);}else{if(k==1){discard;}else{B=vec4(0.,0.,0.,0.);}}}if(m==1){vec4 L=texture2D(n,gl_FragCoord.xy/l);B=F(L,B,c[0]);}for(int M=1;M<7;M++){if(M>=h){break;}if(g==f){vec4 C=texture2D(j[M],v_texcoord);B=F(B,C,c[M]);}else{if(v_texcoord.x>=(d.x)/g.x&&v_texcoord.y>=(d.y)/g.y&&v_texcoord.x<((d.x)+f.x)/g.x&&v_texcoord.y<((d.y)+f.y)/g.y){vec2 J=v_texcoord-vec2(d.x/g.x,d.y/g.y);vec2 K=J*vec2(g.x/f.x,g.y/f.y);vec4 C=texture2D(j[M],K);B=F(B,C,c[M]);}}}gl_FragColor=B;}","Command: Show All Commands","Erase Selection","_viewportOrigin","FRAGMENT_SHADER","_channelToHex","view","Selection","header-content","#bottom","img","firstChild","visibleCheckbox","readyPromise","no-text","images","Image: ","_blendShader","subarray","fitLayerToWindow",'Could not find non-existent command "',"_layerId","_replacedRange","1288563PPanZa","COMPILE_STATUS","platform","disconnect","setLayerName","image-delete","_onLayerVisibilityChange","ArrowUp",", 1.) < 1. / ","resource","TEXTURE_MIN_FILTER","afterend","ctrl+y","_addOption","pointerEvents","INPUT","moveToRange","_layerListItems","getProgramInfoLog","max","isSelectionTool","tempLayerId","progress","onPixelGridEnabledChange","cmdctrl+v","move","undo","ctrl+r","mouseright","staticState","inputBoxNumber","split","showViewport","mousemove","addEventListener","pencil","_onUpdate","_positionsNeedsUpdate",'Cannot find factory for history entry id "',"_shiftLocation","Resize Canvas","_taskService","precision mediump float;uniform vec4 c;void main(){gl_FragColor=c;}","operationName","layer-merge","_unloadImageSet","_handlePointerDownMove","moveLayerDown","startsWith","Resampling not selected","ArrowLeft","documentElement","Height not selected","_defaultValue","_width","all",'Cannot find image "',"clientY","_handlePointerMove","_frameBuffer","alt+pagedown","forEach","close","random","Cannot find module '","image.goToTopImage","Clipboard contains non-image data. Unable to access it.","_onDidChangeVisibilityEmitter","TEXTURE0","layer.rotate180","ctrl+shift+s","RENDERBUFFER","undoImage","assign","1120513ZbiuIH","--vscode-list-activeSelectionForeground","viewport","executeOnSingleLayer","blendFunc","history.toggleHistoryWindow",".png",'" failed: ',"getAttribLocation","_entryHandlers","image/webp","-bit","window.toggleTopStatusBarView","layer/flipVertical","finishTemporaryLayer","type"," - ","selection.selectAll","section","data","_changeHexInput","#version 300 es\nprecision mediump float;\n\nuniform float ","list","NEAREST","run","pageY","enabled","setPosition","fill","_windowVisibleContextKey","tool","_tileScaledDimensionsUniformLocation","onFirstListenerAdd","status-bar-item-","imageSmoothingEnabled","image/x-ico","_entryFactories","Update Selection","_destRange","RGBA","moveLayerToTop","_onLayerChange","_lastAnimationFrame","goToImageAbove","currentLayer","navigator.clipboard.write not supported","object","_currentCompositeEntry","activeEntry","content","_onPointerCoordChange","_isEditInProgress","file.new","destRange","image.flattenLayers","imageFile","_renderProgramsWithOrder","replace","_redoBlendMode","AddImage","_canvas","isSoftDeleted","targetIndex","sqrt","_model","previewCanvas","entries","mouseout","topStatusBar","swapImagePositions","@IServiceName-decorator can only be used to decorate a parameter","moveLayerToBottom","addImage",",1) 0%, rgba(","_isPaused","_setHorizontalLine","getShaderParameter","_ipcService","view-drop-target","_swapImagePositions","convertToBlob","_inputElement","Move Image Up","undoData","_windowPosition","initialIndex","Delete image","_reportProgress","tool.moveSelection","_gl","registerRequestHandler","useProgram","requestRender","Unexpected image file ID for single image file","_createButton","file",".jpg","createCompositeEntry","_renderService","arrayBuffer","bitness","framebufferRenderbuffer","_refreshToolState","Top right","goToTopLayer","getRightItems","fire","_render","edit.copy","_program","_imageService","_queueProgress","getShaderInfoLog","_onDidStartDrag","now","colorMask","Enter the new name","_animationRenderPrograms","timeout","acquireTemporaryLayerId","Duplicate layer","onerror","version","hand","input","texParameteri","edit","currentEntry","scrollTop","bottomright","Access to clipboard-read was denied","luna-icon","onKeyDown","Undoing temporary layer step without initial step state event","call","luna:textFocused","view.actualSize","redo","No redo entry","read","image.finishActiveAction","24-bit","#version 300 es\nlayout(location=0)in vec4 A;out vec2 v_texcoord;void main(){gl_Position=A;v_texcoord=(A.xy+1.)/2.;}",".jpe","tool.pencil","Command","setColors","_pointCache","drop-target","vertexAttribPointer","tagName","luna-image://","_listeners","_onStateChange","Rectangle","_activeAnimatingRenderPrograms","pointerId","shift","u_color","linear-gradient(180deg, rgba(","deleteRenderbuffer","_finishCompositeEntry","repeat","_ctx","onImageDeleted","exports","_forceSelectionAnimation","containsCoord","_goToRelativeLayer","render","scaledHeight","composite","_supportsLayers","cmdctrl+c","_onStartAnimating","8-bit","color","u_shift","_selectionAnimationFrame","layer-move-up","_sliderGradientElement","_onHistoryAction","createMessageHandler","importBlob","className","image.flipVertical","_progressLast","canRead","onWheel","boolean","Merge","merge","previousSibling",") 0%, rgba(","goToBottomImage","renderbufferStorage","ctor","runCommand","dest","_channelInputs","getService","_sc","_range",'History entry "',"hex","tiles"," 0%, rgba(","position","setAttribute","ctrl+m","onAttach","_onAttach","Delete the active image","moveLayerUp","_requestToolIfNeeded","Move the active layer down","bindVertexArray","_blendMode","data-webpack","_apply","_multiplyZoom","Image exceeded maximum pixel count allowed (","applyCommit","Could not find layer for history entry","Select how the resize will be performed","Windows","number","Unrecognized array type","uniform4f","Cut Image","unknown","TEXTURE_MAG_FILTER","bindBuffer","bindRenderbuffer","_onImagesChange","layerId","_getFrameBufferTexture","layers","function","_activeLayersModelIndex","dimensions","Adjustments","createProgram","_lastPointerEvent","types","_activeTool","zoomIn",";\n\nout vec2 v_position;\n\nvoid main() {\n  gl_Position = ","deleteTexture","_channelIndex","_extHostRequestHandlers","Cannot serialize history","layer/crop","disable","utf-8","_layerTexturesUniformLocation","layer/rotate90CounterClockwise","setLayerVisibility","extHostRequestId","insertAdjacentElement","_onEntriesChange","appendChild","clearRect","Duplicate Image","ctrl+shift+p","Images",";\n\nout vec4 outColor;\n\nvoid main() {\n  float c = floor(mod((float(gl_FragCoord.x) + float(gl_FragCoord.y) + ","toUpperCase","missing","Toggle Stretch","_isVisible","_checkCanEdit","wheel","Go to Layer Below","onPointerMove","_toolDisposables","luna-layer://","layer-move-down","rectangle","span","onPointerUp","deleteShader","undefined","Merge down","u_matrix","workbench.action.quickOpen","_restoreCompositeEntry","clear","_progressTimeout","importScripts","edit.redo","Expand Canvas to Selection","cancelAnimationFrame","image-entry","image/bmp","index","image.canvasSize","onChange","_onPointerMove","onToolChange","Show","colorData","tool.crop","image.cropToSelection","Move Image to Top"," not yet supported","background","moveLayerTo","_focusNonActiveImage","exportImage","_onKeyDown","erase"," at position ","Finish Active Action","Tool","_attach","_getNonSoftDeletedLayerCount","_viewportUpdate","document","offsetHeight","channel","Resize","saveAs","runTask","layer.moveLayerDown","crop","_tolerance","ctrl+shift+f","createCompositeEntrySync","Rename layer","tool.toggleMoveTool","_resetHexInput","Canvas Size","_onHistoryUnset","Smooth edges","shiftKey","layerReplace","_container","_redoDimensions","getCoordsFromEvent","Bottom","image.goToImageAbove","location","offsetY","_zoomLocation","_isReadonly","_validate","scaledImage","cmdctrl+z","dragover","redoHandler","onBeforeRunLayerTask","ctrl+shift+r","Zoom","_items","Cannot delete last layer","startLayer","_keyDown"," > ","toggle-minimap","_itemDisposables","canRunCommand","onChangedDimensions","pop","_info","selectAll","uniform1i","softLight","append","Bottom Status Bar","left","ChunkLoadError","Fit layer to window [","value","_replacedImage","includes","_createBlendModeSelect","getContext","_windowResolvedPosition","eraser","refresh","getInfo","_listItemElements","hasImage","getParameter","Image is readonly, edit is not supported","FileService","optionStep","_pointerCoord","--luna-icon-list-active-brightness"," y=","_activeItems","head","TEXTURE_WRAP_T","_applyData","redoBlendMode","QuickPickService","onPointerDown","Uint16Array","openFile","Open Image","data-tool-state","#canvas","Toggle Bottom Status Bar View","Image size is ","substring","_getJobDimension","getTemporaryLayerById","setActiveImage","buffer","pointerup","fireAndWait","Width not selected","button","chunk-","_dropTargetElement","primaryColor","percent","webgl2","Win32","_updateMatrixUniform","option","text/plain","grabbed","_clearUntilReleaseTool","_eventInViewport","Minimap","_pointerDownMoveListener"," pixels wide by ","edit.paste","finishMovePixels","_onVisibilityChange","_rehydrateExtHostMessage","_activeRequests","onmessage","setActiveImageByIndex","splice","fallbackDimensions","setActiveImageById","_instantiationService","keyDown","_sanitizeValue","activeTool","apply","draw","_onPointerUp","isArray","return this","_checkSupportsMultipleImages","translate(-50%, -50%)","preventDefault","task","for","ms ","getTempLayer","Delete Image","bufferData","updateConfig","blendMode","tool.line","Duplicate the active layer","clearEntries","bottom","image.goToBottomImage",'Duplicate webview request handler "',"linear-gradient(180deg, ","singleLayer","isVisible","scaledImageQuality","dropEffect","hardwareConcurrency","Move Layer","disposables","Toggle Shape Tool","clientHeight","temporaryLayers","_updatePreviewIfNeeded","fitToCoords","quickPick","body","_leftItemsElement","rgba-input-","modal","Anchor not selected","_outOfFrameScroll","find","a_texcoord","_viewsElement","script","outlineSize","round","selected","onStateChange","allSettled",") {\n    outColor = vec4(0.2, 0.2, 0.2, .2);\n  }\n}","_options","_blendModeUniformLocation","_createWorker","order","_canvasSelection","_onDimensionsChange","Cannot merge the bottom layer down","DeleteImage","_addItem","Rotate 90° Counter-Clockwise","eraseSelection","onDimensionsChange","_normalizeWheelDelta","_lastCommittedRange","_tempLayerId","_forwardLayerEvents","getBoundingClientRect","532680OdFhPN","currentValue","imageFileId","LINE_LOOP","_elementService","True color & alpha channel","_activeUntilReleaseTool","write","setBlendMode","Move Image to Bottom","palette.swapColors","onEntriesChange","isReadonly","onShowViewportChange","_mimeType","_serializeCompositeEntry","KEEP","draggable","ctrl+a",'No handler for webview request "',"negateEnabled","_onDispose","blur","_moveActiveImageToIndex","_startEdit","_loadModule","dispatchEvent","Toggle Pixel Grid","_loadedImages","Zoom Out","_onPixelGridEnabledChange","commandId","eraseRange","Paste Image","views","MacPPC","Trying to get visible viewport range before element is attached","_handleWheel","colorPicker",".css","SRC_ALPHA","Move Layer to Bottom","viewService","attribute vec4 a_position;uniform mat4 a;uniform vec2 b;void main(){gl_Position=a*(a_position*vec4(b,0.,1.));}","_startAnimatingProgram","texture","right","duplicateLayer","show","cmd-palette","True color","_workMatrices","createDocumentFragment","_disposed","Layers","_headerContentElement","has","_primary","onRequestTool","message","Finish Rectangle Pixels","_onToolChange","image.addNewImage","No undo entry","_calculateScrollVelocity","nonce","Cannot undo readonly entry","duplicate","currentScript","height","_deleteLayerByIndex","setProperty","_colorToHex","padStart",".jpeg","_onDidChangeViews","nearestneighbor","difference","undoBlendMode","Toggle pixel grid when zoomed in","scrollHeight","Left","layer.goToBottomLayer","Delete layer","Flip Horizontal","_getImageDragEventId","Toggle History Window","vscode.toggleMenuBar","getFineCoordsFromEvent","_selectionService","Could not find builtin tool ","_onDidRemoveTopItem","Duplicate Layer","Cannot restore state from previous version (","info","_onZoomChange","_savedViewport"," has already been registered","layer","[createInstance] ","getDetailedInfo","Line","_contextMenuService"," * a_position;\n  v_position = a_position.xy;\n}","fillGlobal","Layer: ","header","requestInputNumber","_undoDimensions","_views","_resize","join","TEXTURE_WRAP_S","_layoutDependentViews","_deleteCurrentLayer","redoImage","_zoomUniformLocation","Color Picker","_renderer","mouseWheelBehavior",", top: ","DYNAMIC_DRAW","set","css.toColor: Unsupported css format",">Luna: ",'Could not find non-existent static view "',"_imageListElement","enable","_createWindowView","updateAnimation","defaultPosition","dispose","tool.zoom","There must be at least one image","nameSpan","_layer","delete","_isSoftDeleted","_doExecuteOnLayer","code","FLOAT","static","_onChangedDimensions","dataType","leftItems","getComputedStyle","cmd-palette-header","canSerialize","Bottom right","_undoData","onUpdateEmitter","ranges",'Task "',"_reportInterval","none","enableVertexAttribArray","line","slice","tool.selection","Toggle Menu Bar","text","_redoRange","in-viewport","_updateItem","Move the active layer up","layerRange","_getAnchorSide","Enter","stopImmediatePropagation","Cannot get coords without element","removeChild","image",".ico","exclusion","_timeout","layer.toggleLayersWindow","pow","blend","name","canvas","goToBottomLayer","openIco","view.fitLayerToWindow","_onImageDeleted","ctrl+h","Finish Rectangle","_sliderTabElement","onRequestRender","_services","getImageData","_uniformValueZoom","uniform1iv","_imageCanvasRenderProgram","Macintosh","renderSelection","selectionEnd","_stateHandlers"," (Readonly)","_pixelSizeLocation","_activeLayersModel","Cannot call exportBlob for ico files","_openBlob","view.focusCanvas","_layoutAll","distance","enter","_layerCountUniformLocation","_blendModeOptions","serviceBrand","view.zoomOut","_toolElements","secondary","layer/resize","unregister","expand-canvas-to-selection",'" exceeded maximum pixel count allowed (',"pause","onLayerChange","miniCssF","filter","_redoName","_layerBlendModesUniformLocation","_contextKeyService","__decorate",") / 4., 2.));\n  outColor = vec4(c, c, c, 1);\n}","onTemporaryLayerRegistered","Cannot run expand canvas to selection without a selection","moving","_rebuildImageCache","altKey","minimap","_fillCommands","Palette","top","Moving layer exceeded maximum pixel count allowed (","Crop","isReady","edit.cut","state","screen","selection.deselect","flipY","_getImageCoordsFromEvent","The primary color's hex value in the format rrggbb. When changing, rgb will be expanded to rrggbb.","pointerdown","key","getLayerById","_onUndo","image.moveImageToBottom","_imagesMap","_onKeyUp","_redoImage","ArrowRight","_stepState","restoreHistory","TEXTURE_2D","activeTexture","negateChecked","_lunaService","shaderSource","putImage","dragend","finishRectangle","moveLayer","toStringTag","_messageHandler","currentState","renameLayer","Layer ","not supported","offsetWidth","getData",'" to set active',"_updateRenderLayerTiles","swap","ctrl+shift+x","layer.moveLayerToBottom","_updateLayer","slider-tab","image.expandCanvasToSelection","keys","NYI","Cannot redo readonly entry","lighten","multiply","deltaX","deleteLayer","setActiveLayer","Delete Layer","pointerout","_rectangleShader","_rangeBuffer","getPropertyValue","catch","webviewRequestId","_logProgress","history","+click]","onPointerCoordChange","vscode-menu","keyup","zoom","32-bit","onload","Crop to Selection","Loading chunk ","onCommit","REPLACE","_getActiveImage","clientWidth","hideView","fillContiguous","image-move-up","Unknown History Entry","canRedo","onSoftDeletedChange","activeElement","Bilinear","defineProperty","layer/cropToSelection","restoreImage","_canvasDimensionsUniformLocation","_fillRange","Uint8Array","value must not be falsy","bind","Hand","disabled","decorate","zoomOut","result","a_position","_isPixelGridEnabled","_backgroundColor","warn","setTopLeft","_getUnusedLayerLabelId","History","tool.toggleToolsWindow","_getBeforeRunLayerTaskEvent","goToLayerBelow","Command Palette","getRanges","_onDidAddTopItem","luna:","Move Selected Pixels","stencilOp","Add New Layer","workbenchState","_onWheel","di$dependencies","visible","Alt","_isPointerDown","onMimeTypeChange","Create a new image","minimap.toggleShowViewport","untilRelease","onDidChangeVisibility","_primaryColorDiv","Open","minimap-show-viewport","Cannot add composite entry to composite entry","runSyncAction","image.flipHorizontal","blendColorAtRange","disableWorkers","selection-size","create","LINEAR","textureImage","Duplicate image","linearBurn","activeLayer","_colorUniformLocation","adjustRectangle","length","png","statusbar"," failed.\n(","Move Image","CommandService","redoData","_refreshTitle","palette","some","log","layer/flipHorizontal","_state","executeOnAllLayers","Cannot delete the last layer","_listElement","_getLayerDragEventId","Status bar item already added","darken","_layerOffsetUniformLocation","layer/rotate180","_getRange","ONE","generatePreview","visibleRange","alignment","bindFramebuffer","querySelector","_positionBuffer","minimap-stretch","layerIndexList","charset","COLOR_ATTACHMENT0","COLOR_BUFFER_BIT","renderLayer","open","stepState","runLayerTask","dragleave","loaded","_renderPrograms","complete","rename","bilinear","_onDidEndDrag","_finishEdit","__esModule","tool.movePixels","view.fitToWindow","_onStretchEnabledChange","activeImage","_contextKeys","slider","ready","moveImageTo","uniformMatrix4fv","File","match","deselect","Gets the color of the nearest pixel."," pixels tall","_onTemporaryLayerRegistered","openImage","mergeDown","setNextLayerId",".webp","ctrl+j",") 100%)","Go to Bottom Layer","onDidChangeViews","_scrollVelocity","createElement","ceil","TRIANGLE_FAN","Rotate 90° Clockwise","Command ","registerStateHandler","clearColor","moveImageToBottom","_minimapService","_finish","setData","task.worker.worker.js","isPixelGridEnabled","contentRect","Selection size is ","Actual Size","_temporaryLayerIdCounter","Merge the active layer down","_setSoftDeleted",'Cannot run command "','Unrecognized file extension "',"goToLayerAbove","This image type doesn't support multiple images","observe","_currentEntryPointer","_updateAttributeBuffers"," executed","Cannot run crop to selection without a selection","register","--vscode-breadcrumb-foreground","overlay","Could not find layer to set","checkValidity","onStartAnimating","image.moveImageToTop","_pointCount","#version 300 es\nlayout (location = ","New Image","left-items","tools","activeImageSetIndex","Hide","dragstart","View","Add Image","save","Could not serialize layers","toggleView","query","_scrollInterval","linear-gradient(90deg, rgba(","bindTexture","_queueUpdate","toLowerCase","undoName","Fill","file.save","Report an issue or give feedback","Eraser","Image is readonly because an edit is in progress","_rightItemsElement","_targetIndex","removeAttribute","256 colors","Enter the height of the image","element","_disposables","_event","registerHistoryEntryFactory","onLayerChangeEmitter","_initialIndex","DEPTH_STENCIL","358928izMgzQ","_color","50%","display","contentRange","ArrowDown","_operationName","get","active","options","defaultVisible","registerHistoryEntryHandler","file.saveAs","Automatic publicPath is not supported in this browser","size","Merge Layer Down","_isScrollLocked","multiLayer","Cannot serialize history entry","newFromClipboard","Toggle the viewport display in the minimap","_setActiveItem","Help","createBuffer","Background","FRAMEBUFFER","updateWorkbenchState","cutImage","_secondaryColorDiv","_createPaletteButton","Move Selection","ctrl+shift+d","quality","_frameBufferTextures","drawArrays","title","minimap.toggleStretch","MoveImage","redoDimensions","_renderImages","_flippedAxisUniformLocation","pointerDown","_onMimeTypeChange","Zoom level is ","_positionArray","Unrecognized blend mode","toggle","luna:focused","Cannot set the active image to undefined","layer.addNewLayer","Could not find layer ","Layer Name: ","request","isPointerDown","readonly","_activeTemporaryLayers","1020643bgbVhJ","Cannot finish temporary layer without at least 1 step","createInstance","destImage","saveState","ARRAY_BUFFER","contextmenu","drawRectangle","_colorLocation","_onCommit","_showViewport","_target","_uniformValueBlendModes","getLeftItems","Hex:","hidden","drop","_secondary","deserialize","onLastListenerRemove","help.reportIssue","adjustments.invert","_generatePreview","CLAMP_TO_EDGE","showView"],a2_0x6447=function(t,e){return a2_0x15c6[t-=175]};(function(t,e){const i=a2_0x6447;for(;;)try{if(663741===-parseInt(i(337))+parseInt(i(1368))+-parseInt(i(263))+parseInt(i(1424))+-parseInt(i(1858))+parseInt(i(849))+parseInt(i(1674))*parseInt(i(1838)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a2_0x15c6),(()=>{var t={4738:t=>{t[a2_0x6447(502)]="#version 300 es\nprecision mediump float;uniform int a;uniform sampler2D b;uniform sampler2D c;in vec2 v_texcoord;out vec4 A;vec3 B(vec4 C,vec4 D,vec3 E){float a=C.a*D.a;return(C.a-a)*C.rgb+(D.a-a)*D.rgb+a*E;}vec4 F(vec4 C,vec4 D,int G){if(D.a==0.){return C;}if(C.a==0.){return D;}vec3 H;if(G==1){H=D.rgb;}else if(G==3){H=vec3(min(C.r,D.r),min(C.g,D.g),min(C.b,D.b));}else if(G==4){H=C.rgb*D.rgb;}else if(G==6){H=max(C.rgb+D.rgb-1.,0.);}else if(G==8){H=vec3(max(C.r,D.r),max(C.g,D.g),max(C.b,D.b));}else if(G==9){H=vec3(1.-(1.-C.r)*(1.-D.r),1.-(1.-C.g)*(1.-D.g),1.-(1.-C.b)*(1.-D.b));}else if(G==11){H=min(C.rgb+D.rgb,vec3(1.));}else if(G==13){H=vec3(C.r<.5?(2.*C.r*D.r):(1.-2.*(1.-C.r)*(1.-D.r)),C.g<.5?(2.*C.g*D.g):(1.-2.*(1.-C.g)*(1.-D.g)),C.b<.5?(2.*C.b*D.b):(1.-2.*(1.-C.b)*(1.-D.b)));}else if(G==14){H=vec3(D.r<.5?(2.*C.r*D.r+C.r*C.r*(1.-2.*D.r)):(sqrt(C.r)*(2.*D.r-1.)+2.*C.r*(1.-D.r)),D.g<.5?(2.*C.g*D.g+C.g*C.g*(1.-2.*D.g)):(sqrt(C.g)*(2.*D.g-1.)+2.*C.g*(1.-D.g)),D.b<.5?(2.*C.b*D.b+C.b*C.b*(1.-2.*D.b)):(sqrt(C.b)*(2.*D.b-1.)+2.*C.b*(1.-D.b)));}else if(G==20){H=abs(C.rgb-D.rgb);}else if(G==21){H=C.rgb+D.rgb-2.*C.rgb*D.rgb;}float I=D.a+C.a*(1.-D.a);return vec4(B(C,D,H)/I,I);}void main(){vec4 J=texture(b,v_texcoord);vec4 K=texture(c,v_texcoord);A=F(J,K,a);}"},7542:t=>{const e=a2_0x6447;t[e(502)]=e(479)},3318:t=>{const e=a2_0x6447;t.exports=e(240)},3716:t=>{t[a2_0x6447(502)]="attribute vec4 a_position;attribute vec2 a_texcoord;uniform mat4 a;uniform vec2 b;varying vec2 v_texcoord;void main(){gl_Position=a*(a_position*vec4(b,0.,1.));v_texcoord=a_texcoord;}"},98:t=>{const e=a2_0x6447;t[e(502)]=e(305)},7034:t=>{const e=a2_0x6447;t.exports=e(892)},6495:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{Z:()=>r,N:()=>a});var n=i(7166),o=i(4378);class r{constructor(t,e,i,s){const n=a2_0x6447;this[n(306)]=t,this[n(539)]=e,this[n(984)]=i,this._f=s}async[s(361)](){const t=s,e=(0,n.Qf)(this[t(984)],this._range);await this[t(984)][t(463)]((async(t,e,i)=>(await this._f(t,e,i),this._range)));const i=(0,n.Qf)(this[t(984)],this._range);return new o.$(this[t(306)],this[t(539)],this[t(984)][t(851)],this[t(984)].id,e,i)}}class a{constructor(t,e,i,n,o,r,a,h){const c=s;this._operationName=t,this[c(984)]=e,this[c(1513)]=i,this._x=n,this._y=o,this[c(1369)]=r,this[c(663)]=a,this[c(232)]=h}async[s(361)](){const t=s;let e;return await this[t(984)][t(463)]((async(i,s,n)=>{const o=t;return e=await this[o(232)][o(660)](o(953),{targetImage:{data:i,width:s,height:n},color:new Uint8Array(this[o(1369)]),selection:this[o(1513)],x:this._x,y:this._y,tolerance:this[o(663)]}),e.range})),new o.$(this._operationName,e[t(1707)],this._layer.imageFileId,this[t(984)].id,e[t(420)],e.redoData)}}},4375:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{Y:()=>n});class n{constructor(t,e,i,s,n){const o=a2_0x6447;this.operationName=t,this._stepState=e,this[o(1833)]=i,this[o(261)]=s,this._tempLayerId=n,this[o(352)]="singleLayer",this[o(1837)]="movePixels",this[o(1521)]=0}async[s(289)](t){const e=s,i=await t[e(1515)](this[e(1833)],this[e(261)]);if(!i)throw new Error(e(1418)+this._layerId);const n=await t[e(791)](this[e(1833)],this[e(261)],this._tempLayerId);if(!n)throw new Error("Could not find temp layer "+this[e(261)]);if(n.stepState[e(700)](),0===n[e(1261)][e(1225)])throw new Error("Undoing temporary layer step without initial step state event");const o=n[e(1261)][n[e(1261)][e(1225)]-1];return this[e(556)](n,o,t),i}async redo(t){const e=s,i=await t[e(1515)](this[e(1833)],this._layerId);if(!i)throw new Error("Could not find layer "+this._layerId);const n=await t[e(791)](this[e(1833)],this[e(261)],this[e(846)]);if(!n)throw new Error("Could not find temp layer "+this[e(261)]);return n[e(1261)][e(1686)](this._stepState),this._apply(n,this[e(1102)],t),i}[s(556)](t,e,i){const n=s;Object[n(336)](t[n(1115)],e),t.triggerRequestRender(),t[n(183)]()}[s(1461)](){const t=s;return{id:t(1735),operationName:this[t(306)],imageFileId:this[t(1833)],layerId:this[t(261)],tempLayerId:this[t(846)],stepState:this[t(1102)]}}static create(t){const e=s;return new n(t[e(306)],t[e(1261)],t[e(851)],t[e(572)],t.tempLayerId)}}},5901:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{X:()=>n});class n{constructor(t,e,i,s,n){const o=a2_0x6447;this[o(306)]=t,this[o(1261)]=e,this[o(1833)]=i,this[o(261)]=s,this[o(846)]=n,this[o(352)]=o(803),this.requiresTool=o(615),this[o(1521)]=0}async[s(289)](t){const e=s,i=await t[e(1515)](this._imageFileId,this[e(261)]);if(!i)throw new Error(e(1418)+this[e(261)]);const n=await t.getTempLayer(this[e(1833)],this[e(261)],this._tempLayerId);if(!n)throw new Error("Could not find temp layer "+this[e(261)]);if(n.stepState[e(700)](),0===n.stepState[e(1225)])throw new Error(e(470));const o=n.stepState[n[e(1261)][e(1225)]-1];return this[e(556)](n,o),i}async redo(t){const e=s,i=await t[e(1515)](this[e(1833)],this[e(261)]);if(!i)throw new Error(e(1418)+this._layerId);const n=await t[e(791)](this[e(1833)],this[e(261)],this[e(846)]);if(!n)throw new Error(e(1536)+this[e(261)]);return n[e(1261)][e(1686)](this[e(1261)]),this._apply(n,this[e(1261)]),i}_apply(t,e){Object[s(336)](t.currentState,e),t.triggerRequestRender(),t.triggerHistoryAction()}[s(1461)](){const t=s;return{id:t(1224),operationName:this[t(306)],imageFileId:this[t(1833)],layerId:this[t(261)],tempLayerId:this[t(846)],stepState:this[t(1261)]}}static[s(1217)](t){const e=s;return new n(t[e(306)],t[e(1261)],t.imageFileId,t[e(572)],t[e(284)])}}},1405:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{D:()=>n});class n{constructor(t,e,i,s,n){const o=a2_0x6447;this.operationName=t,this[o(1102)]=e,this[o(1833)]=i,this[o(261)]=s,this[o(846)]=n,this[o(352)]=o(803),this.requiresTool=o(615),this[o(1521)]=0}async[s(289)](t){const e=s,i=await t[e(1515)](this[e(1833)],this._layerId);if(!i)throw new Error("Could not find layer "+this[e(261)]);const n=await t[e(791)](this[e(1833)],this._layerId,this[e(846)]);if(!n)throw new Error("Could not find temp layer "+this._layerId);return n[e(1261)][e(700)](),this[e(556)](n,n.initialState),i.temporaryLayer=void 0,n[e(1724)](),i}async redo(t){const e=s,i=await t[e(1515)](this._imageFileId,this[e(261)]);if(!i)throw new Error(e(1418)+this._layerId);const n=await t[e(791)](this[e(1833)],this._layerId,this[e(846)]);if(!n)throw new Error("Could not find temp layer "+this._layerId);return n[e(1261)].push(this[e(1102)]),this[e(556)](n,this[e(1102)]),await i[e(1828)](n,!1),n[e(183)](),i}[s(556)](t,e){const i=s;Object.assign(t.currentState,e),t[i(1549)]()}[s(1461)](){const t=s;return{id:t(1431),operationName:this[t(306)],imageFileId:this[t(1833)],layerId:this[t(261)],tempLayerId:this[t(846)],stepState:this[t(1102)]}}static[s(1217)](t){const e=s;return new n(t[e(306)],t[e(1261)],t[e(851)],t.layerId,t[e(284)])}}},6628:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{$:()=>r});var n=i(1003),o=i(7605);class r{constructor(t,e,i,s,o,r,a,h){const c=a2_0x6447;this[c(306)]=t,this[c(232)]=e,this._destRange=i,this[c(262)]=s,this[c(1833)]=o,this._layerId=r,this[c(846)]=a,this[c(711)]=h,this[c(352)]=c(803),this[c(1837)]=c(1464),this[c(1521)]=(0,n.U6)(this[c(262)])}async[s(289)](t){const e=s,i=await t[e(1515)](this[e(1833)],this._layerId);if(!i)throw new Error(e(1418)+this[e(261)]);const n=await t[e(791)](this[e(1833)],this[e(261)],this[e(846)]);if(!n)throw new Error(e(1536)+this[e(261)]);if(0===n[e(1261)][e(1225)])throw new Error(e(1425));const o=n[e(1261)][n[e(1261)][e(1225)]-1];return n[e(1115)][e(1575)]=o.offsetX,n[e(1115)][e(680)]=o.offsetY,n.currentState[e(1665)]=o.flipX,n[e(1115)][e(1090)]=o[e(1090)],await i[e(1828)](n,!1),await i[e(463)]((async(t,i,s)=>{const n=e;return await this[n(232)].runTask(n(1109),{targetImage:{data:t,width:i,height:s},putImage:{data:this._replacedImage[n(356)],width:this._replacedImage[n(1564)],height:this[n(711)].height},putRange:this[n(262)],replacedImage:void 0,blend:!1}),this[n(375)]})),n[e(183)](),i}async[s(474)](t){const e=s,i=await t[e(1515)](this[e(1833)],this[e(261)]);if(!i)throw new Error(e(1418)+this._layerId);const n=await t[e(791)](this[e(1833)],this[e(261)],this[e(846)]);if(!n)throw new Error("Could not find temp layer "+this._layerId);const o=n[e(1261)][n.stepState.length-1];n[e(1115)][e(1575)]=this[e(375)][e(707)],n.currentState.offsetY=this[e(375)].top,n[e(1115)][e(1665)]=o[e(1665)],n[e(1115)][e(1090)]=o[e(1090)],i[e(1705)]=void 0;const r=await n[e(292)][e(1020)].readyPromise;let a;if(o[e(1756)]===r[e(1564)]&&o.scaledWidth===r[e(1564)])a=r;else{const t=await this._taskWorkerService.runLayerTask(e(1061),{width:o[e(1756)],height:o[e(507)],resampling:o[e(1400)]},r,void 0)[e(1179)];a=t[e(535)]}return await i.edit((async(t,i,s)=>{const o=e;return await this[o(232)][o(660)](o(1109),{targetImage:{data:t,width:i,height:s},putImage:{data:a[o(356)],width:a[o(1564)],height:a[o(918)]},putRange:this[o(375)],replacedImage:void 0,blend:!1,flipX:n[o(1115)][o(1665)],flipY:n[o(1115)][o(1090)]}),this._destRange})),n[e(1724)](),i}[s(1461)](){const t=s;return{id:t(767),operationName:this[t(306)],imageFileId:this[t(1833)],layerId:this[t(261)],tempLayerId:this[t(846)],destRange:this[t(375)],replacedRange:this[t(262)],replacedImage:(0,o.t)(this[t(711)])}}static[s(1217)](t,e){const i=s;return new r(e[i(306)],t,e[i(390)],e.replacedRange,e[i(851)],e[i(572)],e.tempLayerId,(0,o.e)(e.replacedImage))}}},3817:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{O:()=>n});class n{constructor(t,e,i,s){const n=a2_0x6447;this[n(306)]=t,this[n(1833)]=e,this._layerId=i,this[n(846)]=s,this.type=n(803),this[n(1837)]=n(615),this[n(1521)]=0}async[s(289)](t){const e=s,i=await t[e(1515)](this[e(1833)],this[e(261)]);if(!i)throw new Error(e(1418)+this[e(261)]);const n=await t.getTempLayer(this[e(1833)],this[e(261)],this[e(846)]);if(!n)throw new Error(e(1536)+this._layerId);if(0===n[e(1261)].length)throw new Error(e(1425));const o=n.stepState[n[e(1261)][e(1225)]-1];return this._apply(n[e(1115)],o),await i.registerTemporaryLayer(n,!1),n[e(183)](),i}async[s(474)](t){const e=s,i=await t.getLayer(this[e(1833)],this[e(261)]);if(!i)throw new Error(e(1418)+this[e(261)]);const n=await t[e(791)](this._imageFileId,this[e(261)],this[e(846)]);if(!n)throw new Error(e(1536)+this._layerId);return i[e(1705)]=void 0,n[e(1724)](),i}[s(556)](t,e){Object[s(336)](t,e)}[s(1461)](){const t=s;return{id:t(1111),operationName:this.operationName,imageFileId:this._imageFileId,layerId:this._layerId,tempLayerId:this[t(846)]}}static[s(1217)](t){const e=s;return new n(t[e(306)],t[e(851)],t.layerId,t[e(284)])}}},6785:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{x:()=>o});var n=i(7605);class o{constructor(t,e,i,s,n,o){const r=a2_0x6447;this.operationName=t,this[r(1833)]=e,this[r(261)]=i,this[r(539)]=s,this._undoData=n,this[r(1632)]=o,this[r(352)]=r(803),this[r(1521)]=this[r(998)].indexList[r(1225)]}[s(289)](t){const e=s;return this[e(731)](this[e(539)],this[e(998)],t)}[s(474)](t){const e=s;return this[e(731)](this[e(539)],this[e(1632)],t)}[s(1461)](){const t=s;return{id:t(1255),operationName:this[t(306)],imageFileId:this[t(1833)],layerId:this[t(261)],range:this[t(539)],undoData:(0,n.t)(this[t(998)]),redoData:(0,n.t)(this._redoData)}}async _applyData(t,e,i){const n=s,o=await i.getLayer(this[n(1833)],this._layerId);if(!o)throw new Error(n(560));return await o[n(463)]((i=>{const s=n;let o=0;for(let t=0;t<e.indexList.length;t++)o=e[s(1628)][t],i[o]=e[s(638)][4*t],i[o+1]=e.colorData[4*t+1],i[o+2]=e.colorData[4*t+2],i[o+3]=e[s(638)][4*t+3];return t})),o}static[s(1217)](t){const e=s;return new o(t[e(306)],t[e(851)],t.layerId,t[e(1707)],(0,n.e)(t[e(420)]),(0,n.e)(t[e(1231)]))}}},4378:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{$:()=>o});var n=i(1003);class o{constructor(t,e,i,s,o,r){const a=a2_0x6447;this[a(306)]=t,this[a(1707)]=e,this[a(1833)]=i,this[a(261)]=s,this[a(998)]=o,this._redoData=r,this.type="singleLayer",this[a(1521)]=(0,n.U6)(this[a(1707)])}async[s(289)](t){const e=s;return await this[e(556)](this[e(998)],t)}async[s(474)](t){const e=s;return await this[e(556)](this[e(1632)],t)}async[s(556)](t,e){const i=s,n=await e[i(1515)](this[i(1833)],this[i(261)]);if(!n)throw new Error(i(1418)+this[i(261)]);const o=this[i(1707)].bottom-this[i(1707)][i(1082)],r=this[i(1707)][i(895)]-this[i(1707)][i(707)],a=4*r;let h=0,c=0,l=0;return await n[i(463)](((e,s)=>{const n=i;for(let i=0;i<o;i++)c=i+this[n(1707)][n(1082)],h=4*(c*s+this.range[n(707)]),l=i*r*4,e[n(971)](t[n(258)](l,l+a),h);return this.range})),n}[s(1461)](){const t=s;return{id:t(1014),operationName:this[t(306)],imageFileId:this[t(1833)],layerId:this[t(261)],range:this[t(1707)],undoData:Array[t(1566)](this[t(998)]),redoData:Array[t(1566)](this[t(1632)])}}static[s(1217)](t){const e=s;return new o(t.operationName,t[e(1707)],t[e(851)],t.layerId,new Uint8Array(t.undoData),new Uint8Array(t[e(1231)]))}}},1375:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{C:()=>n});class n{constructor(t,e,i,s,n,o,r,a){const h=a2_0x6447;this[h(306)]=t,this[h(232)]=e,this._stepState=i,this[h(1833)]=s,this[h(261)]=n,this._tempLayerId=o,this[h(317)]=r,this._height=a,this.type=h(803),this[h(1837)]=h(1464),this[h(1521)]=this[h(317)]*this._height}async[s(289)](t){const e=s,i=await t.getLayer(this[e(1833)],this[e(261)]);if(!i)throw new Error(e(1418)+this[e(261)]);const n=await t.getTempLayer(this[e(1833)],this[e(261)],this[e(846)]);if(!n)throw new Error(e(1536)+this[e(261)]);return n[e(1261)][e(700)](),n[e(1115)][e(1575)]=n[e(1681)][e(1575)],n.currentState[e(680)]=n[e(1681)][e(680)],n.currentState[e(1665)]=n[e(1681)][e(1665)],n.currentState[e(1090)]=n.initialState[e(1090)],i[e(1705)]=void 0,await i[e(463)]((async(t,i,s)=>{const o=e,r=await n.staticState[o(1020)][o(253)],a=this[o(1246)](n);return await this._taskWorkerService.runTask("putImage",{targetImage:{data:t,width:i,height:s},putImage:{data:r[o(356)],width:r[o(1564)],height:r.height},putRange:a,replacedImage:void 0,blend:!1}),a})),n.triggerHistoryUnset(),i}async[s(474)](t){const e=s,i=await t[e(1515)](this[e(1833)],this[e(261)]);if(!i)throw new Error(e(1418)+this[e(261)]);const n=await t[e(791)](this._imageFileId,this._layerId,this[e(846)]);if(!n)throw new Error(e(1536)+this[e(261)]);return n[e(1261)][e(1686)](this[e(1102)]),n[e(1115)][e(1575)]=this[e(1102)][e(1575)],n.currentState[e(680)]=this[e(1102)].offsetY,n.currentState[e(1665)]=this[e(1102)][e(1665)],n[e(1115)][e(1090)]=this._stepState[e(1090)],i[e(1705)]=n,await i[e(463)]((async(t,i,s)=>{const o=e,r=this[o(1246)](n);return await this[o(232)][o(660)](o(881),{targetImage:{data:t,width:i,height:s},range:r}),r})),n[e(183)](),i}_getRange(t){const e=s;return{left:t[e(1681)].offsetX,top:t[e(1681)][e(680)],right:t[e(1681)][e(1575)]+t.staticState[e(1020)].resource[e(1564)],bottom:t[e(1681)].offsetY+t[e(292)][e(1020)][e(272)].height}}[s(1461)](){const t=s;return{id:t(1751),operationName:this[t(306)],imageFileId:this._imageFileId,layerId:this._layerId,tempLayerId:this[t(846)],stepState:this[t(1102)],width:this._width,height:this._height}}static[s(1217)](t,e){const i=s;return new n(e[i(306)],t,e[i(1261)],e.imageFileId,e[i(572)],e.tempLayerId,e[i(1564)],e[i(918)])}}},3491:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{M:()=>a,w:()=>h});var n=i(1815),o=i(5120);let r=0;function a(t){r=Math[a2_0x6447(282)](r,t)}class h extends o.JT{constructor(t){const e=a2_0x6447;super(),this[e(1433)]=this[e(1324)](new n.v),this[e(1155)]=this._onCommit.event,this[e(1505)]=this.register(new n.v),this[e(1036)]=this[e(1505)][e(1545)],this[e(670)]=this[e(1324)](new n.v),this[e(1490)]=this[e(670)][e(1545)],this[e(518)]=this[e(1324)](new n.v),this.onHistoryAction=this[e(518)][e(1545)],t?(this.id=t,a(t)):this.id=++r}[s(1549)](){const t=s;this._onRequestRender[t(443)]()}[s(183)](){const t=s;this[t(518)][t(443)]()}[s(1724)](){const t=s;this[t(670)][t(443)]()}}},270:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{m:()=>h});var n=i(6628),o=i(4375),r=i(1375),a=i(3491);class h extends a.w{constructor(t,e,i,n,o,r,a,h,c,l){const d=a2_0x6447;var u;super(h),this[d(1519)]=t,this._historyService=o,this[d(938)]=r,this[d(232)]=a,this.type=d(1076),this[d(795)]="replace",this[d(1681)]=c||{offsetX:i[d(707)],offsetY:i[d(1082)],flipX:!1,flipY:!1,scaledWidth:i[d(895)]-i[d(707)],scaledHeight:i[d(799)]-i[d(1082)],quality:n||d(1268)},this[d(1261)]=l||[],this[d(1115)]={...l?.length?l[l[d(1225)]-1]:this.initialState},this[d(1656)]((()=>this[d(813)]())),d(253)in e?(this[d(292)]={image:e,range:i},e[d(253)][d(1594)]((()=>this[d(1505)].fire()))):this[d(292)]={image:(u=e,{resource:u,readyPromise:Promise[s(198)](u),isReady:!0}),range:i}}get data(){const t=a2_0x6447;return this.staticState[t(1020)][t(272)].data}get width(){const t=a2_0x6447;return this[t(292)][t(1020)][t(272)][t(1564)]}get[s(918)](){const t=s;return this[t(292)][t(1020)][t(272)].height}[s(279)](t){const e=s;this[e(1115)].offsetX===t[e(707)]&&this[e(1115)].offsetY===t[e(1082)]&&this[e(1115)][e(1756)]===t[e(895)]-t[e(707)]&&this[e(1115)][e(507)]===t[e(799)]-t[e(1082)]||(this[e(1115)][e(1575)]=t.left,this[e(1115)][e(680)]=t.top,this.currentState[e(1756)]=t[e(895)]-t.left,this[e(1115)][e(507)]=t.bottom-t.top,this._onRequestRender[e(443)]())}moveStep(){const t=s,e={...this[t(1115)]};this[t(1261)][t(1225)]>0?this[t(1765)][t(1450)](new o.Y(t(1755),e,this[t(1519)][t(851)],this._parentLayer.id,this.id)):this._historyService[t(1450)](new r.C(t(1194),this[t(232)],e,this._parentLayer.imageFileId,this[t(1519)].id,this.id,this[t(292)].image[t(272)].width,this[t(292)].image[t(272)][t(918)])),this[t(813)](),this.stepState[t(1686)](e),this[t(1505)][t(443)]()}[s(724)](t){const e=s,i={...this[e(1115)]};this[e(1765)][e(1450)](new o.Y(t,i,this[e(1519)][e(851)],this._parentLayer.id,this.id)),this._updatePreviewIfNeeded(),this[e(1261)][e(1686)](i),this[e(1505)][e(443)]()}_updatePreviewIfNeeded(){const t=s,e=this[t(684)]?.[t(272)][t(1564)]||this[t(292)].image[t(272)][t(1564)],i=this.scaledImage?.[t(272)][t(918)]||this[t(292)].image[t(272)].height;if(e===this[t(1115)][t(1756)]&&i===this[t(1115)][t(507)]&&this[t(805)]===this.currentState[t(1400)])return;if(this[t(805)]=this[t(1115)][t(1400)],this.currentState[t(1756)]===this[t(292)][t(1020)][t(272)][t(1564)]&&this.currentState[t(507)]===this[t(292)].image[t(272)][t(918)])return this[t(684)]=this[t(292)][t(1020)],void this[t(1505)][t(443)]();let n;const o=new Promise((t=>n=t)),r={width:this[t(1115)][t(1756)],height:this[t(1115)].scaledHeight,data:new Uint8Array(0)};this[t(684)]={isReady:!1,readyPromise:o,resource:r},this[t(292)][t(1020)][t(253)][t(1594)]((async e=>{const i=t,s=await this[i(232)][i(1262)](i(1061),{width:this.currentState[i(1756)],height:this[i(1115)][i(507)],resampling:this[i(1115)][i(1400)]},e,void 0).result;r[i(356)]=s.dest[i(356)],this.scaledImage&&(this.scaledImage[i(1085)]=!0),n(r),this[i(1505)].fire()}))}async[s(1523)](){const t=s,e=await(this[t(684)]?.readyPromise||this[t(292)][t(1020)].readyPromise),i=Math.max(this[t(1115)][t(1575)],0),o=Math[t(282)](this[t(1115)][t(680)],0),r=Math[t(1608)](this.currentState[t(1575)]+this[t(1115)][t(1756)],this[t(1519)].width),a=Math[t(1608)](this[t(1115)][t(680)]+this[t(1115)].scaledHeight,this[t(1519)].height),h=r-i,c=a-o,l={width:h,height:c,data:new Uint8Array(new SharedArrayBuffer(h*c*4))},d={left:this.currentState[t(1575)],top:this.currentState[t(680)],right:this[t(1115)][t(1575)]+this[t(1115)][t(1756)],bottom:this[t(1115)].offsetY+this[t(1115)][t(507)]};await this._parentLayer[t(463)]((async(i,s,n)=>{const o=t;return await this[o(232)][o(660)](o(1109),{putRange:d,targetImage:{data:i,width:s,height:n},putImage:e,replacedImage:l,blend:!1,flipX:this[o(1115)][o(1665)],flipY:this[o(1115)][o(1090)]}),d})),this[t(1765)][t(1450)](new n.$("Finish Selection",this[t(232)],d,{left:i,top:o,right:r,bottom:a},this[t(1519)][t(851)],this[t(1519)].id,this.id,l)),this[t(1433)].fire()}[s(996)](t){const e=s;if(-1!==t&&this[e(1564)]*this[e(918)]>t)return e(1083)+this[e(1564)]*this[e(918)]+" > "+t+")"}[s(1461)](){const t=s;return{id:this.id,parentLayerId:this._parentLayer.id,type:"moving",staticState:c(this[t(292)]),initialState:this[t(1681)],currentState:this[t(1115)],stepState:this[t(1261)]}}static[s(1217)](t,e,i,n,o){const r=s,a=t[r(292)],c={data:new Uint8Array(a.data),width:a[r(1707)][r(895)]-a[r(1707)][r(707)],height:a[r(1707)][r(799)]-a.range[r(1082)]};return new h(e,c,a[r(1707)],void 0,i,n,o,t.id,t[r(1681)],t.stepState)}}function c(t){const e=s;return{data:Array.from(t[e(1020)][e(272)].data),range:t[e(1707)]}}},807:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{F:()=>d});var n=i(7517),o=i(1003),r=i(6495),a=i(5901),h=i(1405),c=i(3817),l=i(3491);class d extends l.w{constructor(t,e,i,s,n,o,r,a=[]){const h=a2_0x6447;super(r),this._parentLayer=t,this[h(292)]=e,this[h(1681)]=i,this._historyService=s,this[h(938)]=n,this._taskWorkerService=o,this.stepState=a,this[h(352)]=h(615),this[h(1115)]=u(a[h(1225)]?a[a[h(1225)]-1]:this.initialState)}[s(1658)](t,e=!1){const i=s,n=u(this.currentState);if(this[i(1261)][i(1225)]>0){let s=!1;if(e){const e=this[i(1765)][i(403)][this[i(1765)].entries.length-1];e.operationName===t&&(e.stepState=n,this.stepState[this[i(1261)][i(1225)]-1]=n,s=!0)}!s&&(this[i(1765)].addEntry(new a.X(t,n,this[i(1519)].imageFileId,this[i(1519)].id,this.id)),this[i(1261)][i(1686)](n))}else this[i(1765)].addEntry(new h.D(i(1793),n,this._parentLayer[i(851)],this[i(1519)].id,this.id)),this[i(1261)][i(1686)](n);this[i(1505)][i(443)]()}async[s(1523)](){const t=s,e=this.currentState[t(1707)];await this[t(1765)].createCompositeEntry(t(1034),(async()=>{const i=t;this._historyService[i(1450)](new c.O("Finish Rectangle",this[i(1519)].imageFileId,this[i(1519)].id,this.id)),await this[i(1765)][i(205)](new r.Z(i(909),e,this[i(1519)],(async(t,e,s)=>{const n=i;await this[n(559)](t,e,s)})))})),this[t(1433)][t(443)]()}async[s(559)](t,e,i){const n=s,o=this[n(1115)][n(795)],r=this.currentState[n(1707)],a=this[n(1191)]();if((r[n(799)]-r[n(1082)])*(r[n(895)]-r[n(707)])>25e4){const s=[];for(const r of a)for(const a of r[n(1e3)])s[n(1686)](this._taskWorkerService[n(660)](n(1214),{targetImage:{data:t,width:e,height:i},range:a,color:new Uint8Array(r[n(513)]),blendMode:o}));await Promise[n(318)](s)}else for(const i of a)for(const s of i.ranges)this[n(1171)](t,e,s,i[n(513)],o)}[s(1171)](t,e,i,o,r){const a=s;let h=0;for(let s=i.top;s<i[a(799)];s++)for(let c=i.left;c<i[a(895)];c++)h=4*(s*e+c),r===a(394)?(t[h]=o[0],t[h+1]=o[1],t[h+2]=o[2],t[h+3]=o[3]):(0,n.B)(r,t,h,o,0)}[s(1191)](){const t=s,e=[],i=this[t(1115)],n=this[t(292)].invertColors?i[t(1486)]:i[t(753)],r=this[t(292)].invertColors?i[t(753)]:i[t(1486)],a=2===i[t(1712)]?n:r,h=2===i.style?r:n,c=this[t(938)][t(1707)]||(0,o.DI)(this[t(1519)][t(1564)],this[t(1519)].height),l=(0,o.l$)({left:i[t(1707)].left,right:i[t(1707)][t(895)],top:i.range[t(1082)],bottom:Math[t(1608)](i.range[t(1082)]+i.outlineSize,i[t(1707)][t(799)])},c),d=(0,o.l$)({left:i.range[t(707)],right:i[t(1707)][t(895)],top:Math[t(282)](l[t(799)],i[t(1707)][t(799)]-i[t(826)]),bottom:i[t(1707)][t(799)]},c),u=(0,o.l$)({left:i[t(1707)][t(707)],right:i[t(1707)][t(707)]+i[t(826)],top:l.bottom,bottom:d[t(1082)]},c),m=(0,o.l$)({left:Math.max(u[t(895)],i[t(1707)][t(895)]-i[t(826)]),right:i[t(1707)][t(895)],top:l.bottom,bottom:d[t(1082)]},c);return 2!==i[t(1712)]&&e[t(1686)]({ranges:[l,d,u,m],color:h}),3===i[t(1712)]?e[t(1686)]({ranges:[{left:u[t(895)],right:m.left,top:l[t(799)],bottom:d[t(1082)]}],color:a}):2===i[t(1712)]&&e[t(1686)]({ranges:[{left:u[t(707)],right:m[t(895)],top:l[t(1082)],bottom:d.bottom}],color:a}),e}[s(1461)](){const t=s;return{id:this.id,parentLayerId:this[t(1519)].id,type:t(615),staticState:this.staticState,initialState:m(this[t(1681)]),currentState:m(this[t(1115)]),stepState:this[t(1261)][t(1522)]((t=>m(t)))}}static create(t,e,i,n,o){const r=s;return new d(e,t.staticState,g(t.initialState),i,n,o,t.id,t[r(1261)].map((t=>g(t))))}}function u(t){const e=s;return{primaryColor:t[e(753)],secondaryColor:t[e(1486)],blendMode:t.blendMode,range:(0,o.BN)(t.range),outlineSize:t[e(826)],style:t[e(1712)]}}function m(t){const e=s;return{primaryColor:Array[e(1566)](t.primaryColor),secondaryColor:Array[e(1566)](t.secondaryColor),blendMode:t[e(795)],range:(0,o.BN)(t[e(1707)]),outlineSize:t[e(826)],style:t.style}}function g(t){const e=s;return{primaryColor:new Float32Array(t[e(753)]),secondaryColor:new Float32Array(t[e(1486)]),blendMode:t.blendMode,range:(0,o.BN)(t.range),outlineSize:t[e(826)],style:t.style}}},1038:(t,e,i)=>{const s=a2_0x6447;var n={"./tools/colorPicker.js":[6471,471],"./tools/crop.js":[3976,976],"./tools/eraser.js":[2996,996],"./tools/fill.js":[7643,643],"./tools/hand.js":[2333,333],"./tools/line.js":[8559,559],"./tools/movePixels.js":[687,687],"./tools/moveSelection.js":[403,403],"./tools/pencil.js":[5525,525],"./tools/rectangle.js":[7891,891],"./tools/selection.js":[3040,40],"./tools/zoom.js":[7710,710]};function o(t){const e=a2_0x6447;if(!i.o(n,t))return Promise.resolve()[e(1594)]((()=>{const i=e;var s=new Error(i(327)+t+"'");throw s[i(988)]="MODULE_NOT_FOUND",s}));var s=n[t],o=s[0];return i.e(s[1])[e(1594)]((()=>i(o)))}o.keys=()=>Object[s(1129)](n),o.id=1038,t.exports=o},4371:(t,e,i)=>{"use strict";const s=a2_0x6447;function n(t,e=2*t[s(1225)]){const i=s;let n;if(t instanceof Float32Array)n=new Float32Array(e);else if(t instanceof Uint8Array)n=new Uint8Array(e);else if(t instanceof Uint16Array)n=new Uint16Array(e);else{if(!(t instanceof Uint32Array))throw new Error(i(564));n=new Uint32Array(e)}return n.set(t),n}function o(t,e,i=!1){return e<Math[s(1025)](2,8)?i?new Uint8Array(new SharedArrayBuffer(t)):new Uint8Array(t):e<Math.pow(2,16)?i?new Uint16Array(new SharedArrayBuffer(2*t)):new Uint16Array(t):i?new Uint32Array(new SharedArrayBuffer(4*t)):new Uint32Array(t)}function r(t){const e=s;if(window.SharedArrayBuffer&&!(t[e(746)]instanceof SharedArrayBuffer)){const i=new Uint8Array(new SharedArrayBuffer(t[e(1225)]));i[e(971)](t),t=i}return t}i.d(e,{Rs:()=>n,X$:()=>o,pZ:()=>r})},7517:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{B:()=>a});const n=new Float32Array(6);let o;const r={normal:(t,e)=>e,darken:(t,e)=>Math.min(t,e),multiply:(t,e)=>t*e,linearBurn:(t,e)=>Math[s(282)](t+e-1,0),lighten:(t,e)=>Math[s(282)](t,e),screen:(t,e)=>1-(1-t)*(1-e),linearDodgeAdd:(t,e)=>Math[s(1608)](t+e,1),overlay:(t,e)=>t<.5?2*t*e:1-2*(1-t)*(1-e),softLight:(t,e)=>e<.5?2*t*e+t*t*(1-2*e):Math[s(400)](t)*(2*e-1)+2*t*(1-e),difference:(t,e)=>Math[s(1520)](t-e),exclusion:(t,e)=>t+e-2*t*e};function a(t,e,i,a,c,l=e,d=i){const u=s;return n[0]=a[c+3]/255,0===n[0]?(e[i]=l[d],e[i+1]=l[d+1],e[i+2]=l[d+2],void(e[i+3]=l[d+3])):(n[1]=l[d+3]/255,0===n[1]?(e[i]=a[c],e[i+1]=a[c+1],e[i+2]=a[c+2],void(e[i+3]=a[c+3])):(o=r[t],n[3]=o(l[d]/255,a[c]/255),n[4]=o(l[d+1]/255,a[c+1]/255),n[5]=o(l[d+2]/255,a[c+2]/255),n[2]=n[0]+n[1]*(1-n[0]),e[i]=Math[u(827)](h(l[d]/255,n[1],a[c]/255,n[0],n[3])/n[2]*255),e[i+1]=Math[u(827)](h(l[d+1]/255,n[1],a[c+1]/255,n[0],n[4])/n[2]*255),e[i+2]=Math[u(827)](h(l[d+2]/255,n[1],a[c+2]/255,n[0],n[5])/n[2]*255),void(e[i+3]=Math[u(827)](255*n[2]))))}function h(t,e,i,s,n){return(e-e*s)*t+(s-e*s)*i+e*s*n}},6374:(t,e,i)=>{"use strict";function s(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}i.d(e,{W:()=>s})},1815:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{v:()=>n,B:()=>o});class n{constructor(t){const e=a2_0x6447;this[e(832)]=t,this[e(489)]=[],this[e(902)]=!1}get[s(1545)](){const t=s;return!this[t(1363)]&&(this[t(1363)]=e=>{const i=t;return 0===this[i(489)].length&&this[i(832)]?.[i(369)]&&this[i(832)].onFirstListenerAdd(),this[i(489)].push(e),{dispose:()=>{const t=i;if(!this[t(902)])for(let i=0;i<this[t(489)][t(1225)];i++)if(this._listeners[i]===e)return this[t(489)][t(773)](i,1),void(0===this[t(489)][t(1225)]&&this._options?.[t(1443)]&&this._options[t(1443)]())}}}),this[t(1363)]}[s(443)](t,e){const i=s,n=[];for(let t=0;t<this[i(489)].length;t++)n[i(1686)](this[i(489)][t]);for(let s=0;s<n[i(1225)];s++)n[s][i(471)](void 0,t,e)}async[s(748)](t,e){const i=s,n=[];for(let t=0;t<this._listeners[i(1225)];t++)n.push(this[i(489)][t]);for(let s=0;s<n[i(1225)];s++)await n[s][i(471)](void 0,t,e)}[s(980)](){const t=s;this._listeners&&(this[t(489)].length=0),this[t(902)]=!0}}function o(t,e){const i=s;return t(((t,s)=>e[i(443)](t,s)))}},7166:(t,e,i)=>{"use strict";function s(t,e){const i=a2_0x6447,s="number"==typeof t?t:t.width;return e=typeof t===i(563)?e:t.height,{data:new Uint8Array(new(i(1491)in window?SharedArrayBuffer:ArrayBuffer)(s*e*4)),width:s,height:e}}function n(t,e){const i=a2_0x6447,s=e[i(799)]-e[i(1082)],n=e[i(895)]-e[i(707)],o=new Uint8Array(n*s*4);let r=0,a=0;for(let h=0;h<s;h++)a=h+e[i(1082)],r=4*(a*t[i(1564)]+e[i(707)]),o[i(971)](t[i(356)][i(258)](r,r+4*n),h*n*4);return o}function o(t,e,i,s,n=!0){const o=a2_0x6447;if(!n&&e<s&&t<i)return{left:Math[o(827)]((i-t)/2),top:Math.round((s-e)/2),width:t,height:e};const r={left:0,top:0,width:i,height:s};if(e>t){const s=t/e;r.left=Math[o(827)](i*(.5-s/2)),r[o(1564)]=Math.round(i*s)}else if(t>e){const i=e/t;r.top=Math.round(s*(.5-i/2)),r[o(918)]=Math[o(827)](s*i)}return r}i.d(e,{uF:()=>s,Qf:()=>n,M_:()=>o})},5120:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{JT:()=>o,_c:()=>r,Lw:()=>a});var n=i(1815);class o{constructor(){const t=a2_0x6447;this[t(1362)]=[],this[t(1541)]=!1,this[t(870)]=this[t(1324)](new n.v),this.onDispose=this[t(870)][t(1545)]}[s(980)](){const t=s;if(this[t(1541)])throw new Error("Attempt to dispose a disposed entity");this._onDispose.fire(),this[t(1541)]=!0;for(const e of this[t(1362)])e[t(980)]();this[t(1362)][t(1225)]=0}[s(1324)](t){return this[s(1362)].push(t),t}[s(1062)](t){const e=s,i=this[e(1362)][e(226)](t);-1!==i&&this[e(1362)][e(773)](i,1)}}function r(t){const e=s;for(const i of t)i[e(980)]();t[e(1225)]=0}function a(t,e,i,n){const o=s;t[o(297)](e,i);let r=!1;return{dispose:()=>{r||(r=!0,t[o(1600)](e,i,n))}}}},2939:(t,e,i)=>{"use strict";function s(t,e,i=0){return Math[a2_0x6447(282)](Math.min(t,e),i)}i.d(e,{u:()=>s})},7896:(t,e,i)=>{"use strict";const s=a2_0x6447;i.d(e,{V:()=>n});const n=[s(1042),s(1673),s(884),"Mac68K"].includes(navigator[s(265)]);[s(562),s(1691),s(756),s(1609)][s(712)](navigator[s(265)])},1003:(t,e,i)=>{"use strict";function s(t){const e=a2_0x6447;if(t)return{left:t[e(707)],top:t[e(1082)],right:t.right,bottom:t[e(799)]}}function n(){return{left:-1,top:-1,right:-1,bottom:-1}}function o(t,e){return{left:t,top:e,right:t+1,bottom:e+1}}function r(t,e){return{left:0,top:0,right:t,bottom:e}}function a(t,e,i,s){const n=a2_0x6447,o=p({left:t,top:e,right:i,bottom:s});return o[n(895)]++,o[n(799)]++,o}function h(t,e){const i=a2_0x6447;return c(t)?s(e):c(e)?s(t):{left:Math[i(1608)](t.left,e.left),top:Math[i(1608)](t[i(1082)],e[i(1082)]),right:Math[i(282)](t[i(895)],e[i(895)]),bottom:Math[i(282)](t.bottom,e[i(799)])}}function c(t){const e=a2_0x6447;return t[e(707)]===t.right||t[e(1082)]===t[e(799)]}function l(t,e){const i=a2_0x6447;return t.left=Math[i(1608)](Math.max(t[i(707)],e[i(707)]),e[i(895)]),t[i(1082)]=Math[i(1608)](Math[i(282)](t[i(1082)],e[i(1082)]),e.bottom),t[i(895)]=Math[i(282)](Math[i(1608)](t[i(895)],e[i(895)]),e[i(707)]),t.bottom=Math[i(282)](Math[i(1608)](t.bottom,e[i(799)]),e[i(1082)]),t}function d(t,e,i){const s=a2_0x6447,n=e-t[s(707)],o=i-t[s(1082)];t.left=t.left+n,t[s(895)]=t[s(895)]+n,t[s(1082)]=t[s(1082)]+o,t[s(799)]=t[s(799)]+o}function u(t,e,i){const s=a2_0x6447;if(c(t))return t[s(707)]=e,t[s(895)]=e+1,t[s(1082)]=i,void(t.bottom=i+1);t.left=Math.min(t.left,e),t[s(1082)]=Math.min(t[s(1082)],i),t[s(895)]=Math.max(t[s(895)],e+1),t[s(799)]=Math[s(282)](t.bottom,i+1)}function m(t,e,i){const s=a2_0x6447;return e>=t[s(707)]&&e<t[s(895)]&&i>=t[s(1082)]&&i<t[s(799)]}function g(t,e){const i=a2_0x6447;return e[i(707)]>=t[i(707)]&&e[i(895)]<=t.right&&e[i(1082)]>=t[i(1082)]&&e.bottom<=t[i(799)]}function f(t,e){const i=a2_0x6447;return!(t.bottom<e[i(1082)]||t.top>e[i(799)]||t[i(895)]<e[i(707)]||t[i(707)]>e[i(895)])}function p(t){const e=a2_0x6447;if(t.left>t[e(895)]){const i=t[e(895)];t[e(895)]=t.left,t[e(707)]=i}if(t.top>t[e(799)]){const i=t[e(799)];t[e(799)]=t.top,t.top=i}if(t.right<t[e(707)]){const i=t[e(707)];t[e(707)]=t.right,t[e(895)]=i}if(t[e(799)]<t[e(1082)]){const i=t[e(1082)];t[e(1082)]=t[e(799)],t.bottom=i}return t}function y(t){const e=a2_0x6447;return(t[e(895)]-t[e(707)])*(t[e(799)]-t[e(1082)])}function _(t){const e=a2_0x6447;return(t[e(895)]-t[e(707)])/(t[e(799)]-t.top)}i.d(e,{BN:()=>s,Pq:()=>n,Re:()=>o,DI:()=>r,tH:()=>a,qi:()=>h,Bu:()=>c,l$:()=>l,Hd:()=>d,Hv:()=>u,RB:()=>m,ur:()=>g,b8:()=>f,FJ:()=>p,U6:()=>y,n3:()=>_})},7605:(t,e,i)=>{"use strict";function s(t){const e=a2_0x6447,i={};for(const s of Object[e(1129)](t)){const n=t[s];"object"==typeof n?n instanceof Uint8Array?i[s]=o(n,e(1172)):n instanceof Uint16Array?i[s]=o(n,e(735)):n instanceof Uint32Array?i[s]=o(n,"Uint32Array"):i[s]=n:i[s]=n}return i}function n(t){const e=a2_0x6447,i={};for(const s of Object[e(1129)](t)){const n=t[s];"object"==typeof n&&e(992)in n?i[s]=r(n):i[s]=n}return i}function o(t,e){return{dataType:e,data:Array[a2_0x6447(1566)](t)}}function r(t){const e=a2_0x6447;return new(window[t[e(992)]])(t[e(356)])}i.d(e,{t:()=>s,e:()=>n})}},e={};function i(s){const n=a2_0x6447;if(e[s])return e[s][n(502)];var o=e[s]={exports:{}};return t[s](o,o.exports,i),o[n(502)]}i.m=t,i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.f={},i.e=t=>{const e=a2_0x6447;return Promise[e(318)](Object.keys(i.f)[e(1857)](((e,s)=>(i.f[s](t,e),e)),[]))},i.u=t=>t+".js",(()=>{const t=a2_0x6447;i[t(1067)]=e=>{const i=t;return""+(122===e?i(1847):e)+i(888)}})(),i.g=function(){const t=a2_0x6447;if(typeof globalThis===t(383))return globalThis;try{return this||new Function(t(784))()}catch(e){if(typeof window===t(383))return window}}(),(()=>{const t=a2_0x6447;i.o=(e,i)=>Object.prototype[t(1745)][t(471)](e,i)})(),(()=>{const t=a2_0x6447;var e={},s=t(1193);i.l=(n,o,r)=>{const a=t;if(e[n])e[n].push(o);else{var h,c;if(void 0!==r)for(var l=document.getElementsByTagName(a(825)),d=0;d<l[a(1225)];d++){var u=l[d];if(u[a(1455)](a(1638))==n||u[a(1455)](a(555))==s+r){h=u;break}}!h&&(c=!0,(h=document.createElement("script"))[a(1256)]=a(591),h[a(455)]=120,i.nc&&h[a(545)](a(914),i.nc),h[a(545)](a(555),s+r),h[a(1638)]=n),e[n]=[o];var m=(t,i)=>{const s=a;h[s(458)]=h[s(1152)]=null,clearTimeout(g);var o=e[n];if(delete e[n],h[s(1659)]&&h[s(1659)][s(1019)](h),o&&o[s(324)]((t=>t(i))),t)return t(i)},g=setTimeout(m[a(1174)](null,void 0,{type:a(455),target:h}),12e4);h[a(458)]=m.bind(null,h[a(458)]),h.onload=m[a(1174)](null,h[a(1152)]),c&&document[a(729)].appendChild(h)}}})(),i.r=t=>{const e=a2_0x6447;typeof Symbol!==e(619)&&Symbol[e(1113)]&&Object[e(1167)](t,Symbol.toStringTag,{value:"Module"}),Object[e(1167)](t,e(1271),{value:!0})},(()=>{const t=a2_0x6447;var e;i.g[t(626)]&&(e=i.g[t(679)]+"");var s=i.g[t(655)];if(!e&&s&&(s.currentScript&&(e=s[t(917)][t(1638)]),!e)){var n=s.getElementsByTagName(t(825));n[t(1225)]&&(e=n[n[t(1225)]-1][t(1638)])}if(!e)throw new Error(t(1381));e=e[t(394)](/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{const t=a2_0x6447;var e={122:0};i.f.j=(t,s)=>{const n=a2_0x6447;var o=i.o(e,t)?e[t]:void 0;if(0!==o)if(o)s[n(1686)](o[2]);else{var r=new Promise(((i,s)=>{o=e[t]=[i,s]}));s[n(1686)](o[2]=r);var a=i.p+i.u(t),h=new Error;i.l(a,(s=>{const r=n;if(i.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var a=s&&(s[r(352)]===r(1767)?r(605):s[r(352)]),c=s&&s.target&&s[r(189)][r(1638)];h[r(908)]=r(1154)+t+r(1228)+a+": "+c+")",h[r(1027)]=r(708),h[r(352)]=a,h[r(1420)]=c,o[1](h)}}),n(751)+t)}};var s=(t,s)=>{const n=a2_0x6447;for(var o,r,[a,h,c]=s,l=0,d=[];l<a[n(1225)];l++)r=a[l],i.o(e,r)&&e[r]&&d[n(1686)](e[r][0]),e[r]=0;for(o in h)i.o(h,o)&&(i.m[o]=h[o]);for(c&&c(i),t&&t(s);d[n(1225)];)d[n(494)]()()},n=self[t(1451)]=self[t(1451)]||[];n[t(324)](s[t(1174)](null,0)),n[t(1686)]=s[t(1174)](null,n.push[t(1174)](n))})(),(()=>{"use strict";const t=a2_0x6447;var e=i(5120),s=i(1003),n=i(1815);class o extends e.JT{constructor(){const t=a2_0x6447;super(...arguments),this[t(548)]=this.register(new n.v),this[t(547)]=this._onAttach[t(1545)]}attach(t){const e=a2_0x6447;this.element=t,this._onAttach[e(443)](this.element)}}class r{constructor(){const t=a2_0x6447;this[t(352)]=t(1422),this[t(306)]=t(1162),this[t(1521)]=0}[t(1461)](){return{id:t(567)}}static create(t){return new r}}class a extends e.JT{constructor(){const e=t;super(),this[e(1639)]=[],this[e(1320)]=-1,this[e(346)]=new Map,this[e(373)]=new Map,this[e(597)]=this[e(1324)](new n.v),this[e(860)]=this._onEntriesChange[e(1545)],this[e(1096)]=this[e(1324)](new n.v),this.onUndo=this[e(1096)][e(1545)],this[e(1806)]=this[e(1324)](new n.v),this.onRedo=this[e(1806)].event,this[e(1783)]=this[e(1324)](new n.v),this[e(907)]=this._onRequestTool.event,this.registerHistoryEntryHandler("simple",{undo:t=>t[e(289)](),redo:t=>t[e(474)]()}),this[e(1364)](e(508),(t=>this[e(623)](t))),this[e(1364)](e(567),r.create)}get activeEntry(){const e=t;return this._entries[this[e(1320)]]}get[t(403)](){return this[t(1639)]}get[t(1811)](){const e=t;return this[e(1639)].length>1&&0!==this[e(1320)]}get canRedo(){const e=t;return this[e(1639)][e(1225)]>1&&this._currentEntryPointer!==this[e(1639)][e(1225)]-1}[t(1450)](e,i){const s=t;if(this[s(384)]){if(e.type===s(508))throw new Error(s(1211));if("readonly"===e[s(352)])throw new Error("Cannot add readonly entry to composite entry");this[s(384)][s(1686)](e)}else this[s(1639)][++this[s(1320)]]=e,this[s(1639)].length=this[s(1320)]+1,!i&&this[s(597)][s(443)](!0)}async[t(205)](e){const i=t,s=await e[i(361)]();s&&this[i(1450)](s)}[t(1212)](e){const i=e[t(361)]();i&&this.addEntry(i)}[t(798)](){const e=t;this[e(1320)]=-1,this[e(1639)][e(1225)]=0,this[e(597)][e(443)](!0)}async undo(){const e=t;if(-1===this[e(1320)])throw new Error(e(912));const i=this[e(1639)][this[e(1320)]];if(i[e(352)]===e(1422))throw new Error(e(915));if(this[e(1320)]--,this[e(551)](i),i.type===e(508))for(const t of i[e(403)])await this._entryHandlers[e(1375)](t.type)[e(289)](t);else await this[e(346)][e(1375)](i.type)[e(289)](i);this[e(597)][e(443)](!1),this._onUndo[e(443)](i)}async[t(474)](){const e=t;if(this[e(1639)][e(1225)]<=this[e(1320)]+1)throw new Error(e(475));const i=this[e(1639)][this[e(1320)]+1];if(i[e(352)]===e(1422))throw new Error(e(1131));if(this[e(1320)]++,this[e(551)](i),i.type===e(508)){const t=i.entries;for(let i=t[e(1225)]-1;i>=0;i--)await this[e(346)].get(t[i][e(352)])[e(474)](t[i])}else await this[e(346)][e(1375)](i[e(352)])[e(474)](i);this[e(597)][e(443)](!1),this[e(1806)][e(443)](i)}async createCompositeEntry(e,i){const s=t;if(this[s(384)])return i();this[s(384)]=[],await i(),this._finishCompositeEntry(e)}[t(665)](e,i){const s=t;if(this[s(384)])return i();this[s(384)]=[],i(),this._finishCompositeEntry(e)}[t(498)](e){const i=t;if(!this[i(384)])throw new Error("Cannot finish composite entry without an entries array");const s=this._currentCompositeEntry;this._currentCompositeEntry=void 0;const n=s[i(1857)](((t,e)=>e[i(1521)]>t?e[i(1521)]:t),0),o={type:i(508),operationName:e,entries:s,pixelCount:n,serialize:()=>this[i(864)](o)};this[i(1450)](o)}[t(1379)](e,i){const s=t;if(this[s(346)].get(e))throw new Error(s(1554)+e+s(946));this[s(346)][s(971)](e,i)}[t(1364)](e,i){const s=t;if(this[s(373)][s(1375)](e))throw new Error("History entry factory "+e+" has already been registered");this[s(373)][s(971)](e,i)}[t(1461)](e=0){const i=t;try{for(const t of this._entries)if(t.pixelCount>e)throw new Error(i(540)+t[i(306)]+i(1064)+t[i(1521)]+i(695)+e+")");const t=[];for(const e of this[i(1639)]){if(!e[i(1461)])throw new Error("serialize function does not exist on history entry");t.push(e[i(1461)]())}return{currentEntry:this[i(1320)],entries:t}}catch(t){return console[i(1183)]("Failed to serialize history",t),{currentEntry:0,entries:[]}}}[t(1442)](e){const i=t;for(const t of e[i(403)])try{this[i(1450)](this[i(1584)](t),!0)}catch{this[i(1450)](new r,!0)}this[i(1320)]=Math[i(1608)](e.currentEntry,this[i(1639)][i(1225)]-1),this._onEntriesChange.fire(!1)}[t(1584)](e){const i=t;if(!e.id)throw new Error(i(1862));const s=this._entryFactories.get(e.id);if(!s)throw new Error(i(301)+e.id+'"');return s(e)}[t(864)](e){const i=t;return{id:"composite",operationName:e.operationName,entries:e[i(403)][i(1522)]((t=>{const s=i;if(!t[s(1461)])throw console[s(1583)](s(1386),e),new Error(s(588));return t.serialize()})),requiresTool:e.requiresTool}}[t(623)](e){const i=t,s=[];for(const t of e[i(403)])s[i(1686)](this[i(1584)](t));const n=s[i(1857)](((t,e)=>e.pixelCount>t?e.pixelCount:t),0);try{const t={type:i(508),operationName:e.operationName,entries:s,pixelCount:n,requiresTool:e[i(1837)],serialize:()=>this[i(864)](t)};return t}catch{return new r}}[t(551)](e){const i=t;if(e[i(352)]===i(508)){const t=e[i(403)];for(let e=t.length-1;e>=0;e--){const s=t[e];if(s[i(1837)])return void this[i(1783)].fire(s[i(1837)])}}else e[i(1837)]&&this[i(1783)][i(443)](e.requiresTool)}}var h=i(4371),c=i(7605),l=i(6785);class d{constructor(e,i,s){const n=t;this[n(306)]=e,this._imageFileId=i,this._layerId=s,this.type="singleLayer",this[n(1521)]=0}async[t(289)](e){const i=t,s=await e[i(1515)](this[i(1833)],this[i(261)]);if(!s)throw new Error(i(560));return s}async[t(474)](e){const i=t,s=await e[i(1515)](this._imageFileId,this[i(261)]);if(!s)throw new Error(i(560));return s}serialize(){const e=t;return{id:e(196),operationName:this[e(306)],imageFileId:this[e(1833)],layerId:this[e(261)]}}static[t(1217)](e){const i=t;return new d(e[i(306)],e[i(851)],e[i(572)])}}var u=i(3491);class m{constructor(e,i){const s=t;this.operationName=e,this[s(1833)]=i,this[s(352)]=s(392),this[s(1521)]=0}async[t(289)](e){const i=t;e.setImageSoftDeleted(this[i(1833)],!0)}async redo(e){const i=t;e.setImageSoftDeleted(this[i(1833)],!1)}serialize(){const e=t;return{id:e(396),operationName:this[e(306)],imageFileId:this[e(1833)]}}static create(e){return new m(e[t(306)],e.imageFileId)}}class g{constructor(e,i){const s=t;this.operationName=e,this[s(1833)]=i,this[s(352)]="imageFile",this[s(1521)]=0}async[t(289)](e){const i=t;e[i(1576)](this[i(1833)],!1)}async[t(474)](e){const i=t;e.setImageSoftDeleted(this[i(1833)],!0)}[t(1461)](){const e=t;return{id:"DeleteImage",operationName:this[e(306)],imageFileId:this[e(1833)]}}static create(e){return new g(e[t(306)],e.imageFileId)}}class f{constructor(e,i,s){const n=t;this.operationName=e,this._initialIndex=i,this._targetIndex=s,this[n(352)]=n(392),this[n(1521)]=0}[t(289)](e){const i=t;e[i(406)](this._targetIndex,this[i(1366)])}[t(474)](e){e[t(406)](this._initialIndex,this._targetIndex)}[t(1461)](){const e=t;return{id:e(1405),operationName:this[e(306)],initialIndex:this[e(1366)],targetIndex:this[e(1357)]}}static[t(1217)](e){const i=t;return new f(e.operationName,e[i(422)],e[i(399)])}}class p extends e.JT{constructor(e,i,s,o){const r=t;super(),this[r(1765)]=e,this[r(447)]=i,this[r(938)]=s,this._viewportService=o,this[r(682)]=!1,this[r(877)]=new Map,this[r(945)]=new Map,this._imageIdCounter=0,this[r(571)]=this[r(1324)](new n.v),this.onImagesChange=this._onImagesChange.event,this._onImageDeleted=this[r(1324)](new n.v),this.onImageDeleted=this[r(1032)][r(1545)],this[r(1765)].registerHistoryEntryHandler(r(803),{undo:async t=>{const e=r,i=await t[e(289)](this);i[e(398)]?this[e(447)].setActiveLayer(this[e(447)][e(574)][0].id):this[e(447)].setActiveLayer(i.id)},redo:async t=>{const e=r,i=await t[e(474)](this);i.isSoftDeleted?this[e(447)][e(1136)](this[e(447)][e(574)][0].id):this[e(447)][e(1136)](i.id)}}),this[r(1765)][r(1379)]("imageFile",{undo:async t=>{const e=r;t[e(289)]({setImageSoftDeleted:this[e(1314)][e(1174)](this),swapImagePositions:this[e(416)].bind(this,!0)})},redo:async t=>{const e=r;t[e(474)]({setImageSoftDeleted:this._setSoftDeleted[e(1174)](this),swapImagePositions:this[e(416)][e(1174)](this,!0)})}}),this._historyService[r(1364)](r(1255),l.x[r(1217)]),this[r(1765)][r(1364)](r(196),d[r(1217)]),this._historyService[r(1364)]("AddImage",m[r(1217)]),this[r(1765)][r(1364)](r(839),g.create),this[r(1765)][r(1364)](r(1405),f[r(1217)]),this[r(938)][r(1155)]((()=>{const t=r;void 0!==this[t(1336)]&&this[t(1765)][t(1450)](new d(t(196),this[t(1157)]()?.id||0,this._imageService.currentLayer?.id||0))})),this[r(447)][r(699)]((()=>this._refreshActiveImage()))}async[t(1314)](e,i){const s=t,n=this[s(1804)]?.[s(822)]((t=>t.id===e));n&&(i?(n.isSoftDeleted=i,this[s(1157)]()?.id===e&&await this[s(645)](this[s(1336)],this[s(1804)]),this[s(1032)][s(443)](e),this._onImagesChange[s(443)]()):(n[s(398)]=i,this[s(571)][s(443)](),this[s(775)](n.id)))}get imageSet(){const e=t;if(this._imageSet)return this._refreshActiveImage(),y(this[e(1804)])}_refreshActiveImage(){const e=t;if(this._imageSet&&this[e(1336)]){const t=this[e(1804)][this[e(1336)]],i=this._imageService[e(381)];t&&i&&i.data!==t.data&&(t.data=i[e(356)],t[e(1564)]=i[e(1564)],t[e(918)]=i[e(918)])}}[t(1506)](e,i,s){const n=t;return this[n(682)]=s,this[n(447)][n(1506)](e,i,s)}[t(1287)](e,i,s){const n=t;let o;if(this._isReadonly=s,Array.isArray(i)){this._unloadImageSet();const t=i;this[n(1526)]=e,this._imageSet=t[n(1522)]((t=>({...t,id:++this[n(1562)]})));for(const t of this._imageSet)t[n(356)]=(0,h.pZ)(t[n(356)]);const s=t[n(1857)](((t,e,i)=>{const s=n;return e[s(1564)]*e[s(918)]>t[s(1822)]?(t.dims=e[s(1564)]*e[s(918)],{index:i,dims:e[s(1564)]*e[s(918)]}):t}),{index:0,dims:0})[n(632)];this[n(1336)]=s,o=this[n(1804)][s]}else o=i;this[n(447)][n(1287)](e,o,!0,this._isReadonly),Array[n(783)](i)&&this[n(571)][n(443)]()}[t(1472)](e,i,s){const n=t;if(this[n(308)](),e===n(372)){this[n(447)][n(1472)](i,s,e);const t=this[n(447)][n(381)];this[n(1526)]=e,this[n(1804)]=[{data:t[n(356)],width:i,height:s,bitness:32,id:++this._imageIdCounter}],this[n(1336)]=0,this[n(571)].fire()}else this[n(447)][n(1472)](i,s,e)}[t(308)](){const e=t;if(this._imageSet){for(const t of y(this[e(1804)]))this[e(1032)][e(443)](t.id);this[e(1336)]=void 0}}async[t(1733)](e){const s=t;if(this[s(1804)]){const t=(await i.e(495)[s(1594)](i[s(1174)](i,7495)))[s(1798)],e=await t(y(this[s(1804)]));return new Blob([e])}return this[s(447)][s(1733)](e)}async[t(1470)](e){const i=t;return this[i(1804)]?this[i(1733)](e):this[i(447)][i(1470)](e)}[t(785)](){const e=t;if(!this[e(1804)])throw new Error(e(1318));return this[e(1804)]}[t(608)](){const e=t;if(this._isReadonly)throw new Error(e(722))}async[t(772)](e,i){const s=t,n=this._checkSupportsMultipleImages();if(e>=n[s(1225)])throw new Error(s(319)+e+s(1121));if(void 0!==this[s(1336)]){const t=n[this.activeImageSetIndex];!i&&(await(this[s(447)].currentLayer?.finishTemporaryLayer()),this[s(938)][s(1707)]&&this[s(938)][s(1283)]());const e=this[s(447)][s(1461)](-1);this._loadedImages.set(t.id,e),this[s(945)][s(971)](t.id,{x:this._viewportService.x,y:this[s(1547)].y,zoom:this._viewportService[s(1150)]})}this[s(1336)]=e;const o=n[e],r=this[s(877)][s(1375)](o.id);r?this[s(447)].deserialize(r,!0):this[s(447)][s(1287)](o[s(1526)],o,!1,this._isReadonly);const a=this[s(945)][s(1375)](o.id);a?(this[s(1547)].x=a.x,this[s(1547)].y=a.y,this[s(1547)][s(1150)]=a[s(1150)]):this[s(1547)].fitToWindow(),this[s(571)][s(443)]()}async setActiveImageById(e,i){const s=t,n=this[s(785)]()[s(1710)]((t=>t.id===e));await this[s(772)](n,i)}async[t(409)](e,i,s){const n=t;this[n(608)]();const o=this[n(785)](),r={id:++this[n(1562)],width:e,height:i,data:new Uint8Array(e*i*4),bitness:s,mimeType:32===s?"image/png":n(631)};r[n(356)][n(365)](255),o[n(1686)](r),await this[n(772)](o[n(1225)]-1),this[n(1765)].addEntry(new m("Add Image",r.id))}async[t(1794)](e){const i=t;this[i(608)]();const s=this[i(785)]();if(s.length<=1)throw new Error(i(982));const n=this._getImageOrActiveIndex(e);if(void 0===n)throw new Error(i(1737));await this._focusNonActiveImage(n,s);const o=s[n];o[i(398)]=!0,this[i(1032)][i(443)](o.id),this[i(571)][i(443)](),this[i(1765)][i(1450)](new g(i(792),o.id))}async[t(1784)](e){const i=t;this[i(608)]();const s=this[i(785)](),n=this[i(1528)](e);if(void 0===n)throw new Error("No active image index");!e&&(e=s[n]);const o={id:++this[i(1562)],width:e[i(1564)],height:e[i(918)],data:e.data.slice(0),bitness:e[i(437)],mimeType:e[i(1526)]},r=n+1;s[i(773)](r,0,o),await this[i(772)](r),this._historyService[i(1450)](new m(i(600),o.id))}[t(1528)](e){const i=t,s=this[i(785)]();let n;return e?(n=s[i(1710)]((t=>t.id===e.id)),-1===n&&(n=void 0)):n=this[i(1336)],n}async[t(645)](e,i){const s=e+1<i[t(1225)]-1?e+1:e-1;await this.setActiveImageByIndex(s)}async[t(1469)](){const e=t;await this.setActiveImageByIndex(this[e(785)]()[e(1225)]-1)}async goToBottomImage(){await this.setActiveImageByIndex(0)}async goToImageAbove(){const e=t;await this[e(772)]((this[e(1336)]||0)+1)}async[t(1821)](){const e=t;await this[e(772)]((this[e(1336)]||0)-1)}async moveImageToTop(){const e=t;this[e(872)](e(641),this[e(785)]()[e(1225)]-1)}async[t(1303)](){const e=t;this[e(872)](e(858),0)}async[t(1815)](){const e=t;void 0!==this.activeImageSetIndex&&this[e(872)](e(419),this[e(1336)]+1)}async[t(1588)](){const e=t;void 0!==this[e(1336)]&&this[e(872)](e(1612),this[e(1336)]-1)}async[t(1279)](e,i){const s=t,n=this[s(785)](),o=(n[s(1710)]((t=>t.id===e)),n[s(1710)]((t=>t.id===i)));await this[s(775)](e),this[s(872)](s(1229),o)}[t(872)](e,i){const s=t;if(void 0===this[s(1336)])return;this[s(608)]();const n=this[s(785)]();i=Math[s(282)](Math[s(1608)](i,n[s(1225)]-1),0),this[s(1336)]!==i&&(this[s(1765)][s(1450)](new f(e,this.activeImageSetIndex,i)),this[s(416)](!1,this[s(1336)],i))}[t(416)](e,i,s){const n=t;if(i===s)return;const o=this[n(785)](),r=this._getActiveImage(),a=o[s],h=o[n(773)](i,1)[0];o.splice(s,0,h),(r?.id===h.id||r?.id===a.id)&&this[n(1336)]!==s&&(this[n(1336)]=s),this._onImagesChange.fire()}[t(1157)](){const e=t,i=this._checkSupportsMultipleImages();if(void 0!==this[e(1336)])return i[this[e(1336)]]}async getLayer(e,i){const s=t;if(!this._imageSet){if(0!==e)throw new Error(s(430));return this[s(447)].getLayerById(i)}let n=this[s(1157)]();return n?.id!==e&&(await this[s(775)](e,!0),n=this[s(1157)]()),this[s(447)].getLayerById(i)}async[t(791)](e,i,s){const n=t;return await this[n(1515)](e,i),this[n(447)][n(744)](s)}[t(1461)](e=0){const i=t;if(void 0!==this[i(1336)]){if(-1!==e){const t=this[i(1804)].reduce(((t,e)=>{const s=i,n=e[s(1564)]*e[s(918)];return n>t?n:t}),0);if(t>e)throw new Error(i(558)+t+" > "+e+")")}const t=Array[i(1566)](this[i(877)].values());return{mimeType:this[i(1526)]||"image/png",activeImageSetIndex:this[i(1336)]||0,loadedImages:t,unloadedImages:this[i(1804)][i(1522)]((t=>(0,c.t)(t)))}}return{mimeType:this[i(1526)]||i(203),activeImageSetIndex:0,loadedImages:[this[i(447)].serialize(e)],unloadedImages:void 0}}[t(1442)](e){const i=t;if(this[i(1526)]=e[i(1526)],e[i(179)]){let t=0;for(const s of e[i(1559)][i(1611)]())t=s[i(574)][i(1857)](((t,e)=>e.id>t?e.id:t),t),s[i(812)][i(324)]((t=>(0,u.M)(t.id)));this._imageService[i(1289)](t+1),this._imageSet=e[i(179)][i(1522)]((t=>(0,c.e)(t)));for(const t of e[i(1559)])this[i(877)].set(t[i(851)],t);this._imageSet&&this[i(772)](e[i(1336)])}else this[i(1804)]=void 0,this._imageService[i(1442)](e[i(1559)][0]);this[i(447)][i(1526)]=this[i(1526)],this[i(571)][i(443)]()}}function y(e){return e[t(1068)]((t=>!0!==t.isSoftDeleted))}var _=i(7517),w=i(2939);class v{constructor(e,i,s){const n=t;this.operationName=e,this[n(1366)]=i,this[n(1357)]=s,this.type=n(1385),this[n(1521)]=0}[t(289)](e){const i=t;b(this._targetIndex,this[i(1366)],e)}[t(474)](t){b(this._initialIndex,this._targetIndex,t)}[t(1461)](){const e=t;return{id:e(1112),operationName:this[e(306)],initialIndex:this[e(1366)],targetIndex:this[e(1357)]}}static[t(1217)](e){const i=t;return new v(e[i(306)],e.initialIndex,e[i(399)])}}function b(e,i,s){const n=t;if(i>=s[n(359)].length)return!1;const o=s[n(359)][e];if(!o)return!1;for(s.currentLayer=e;i>s[n(381)];)s[n(359)][s[n(381)]]=s[n(359)][s[n(381)]+1],s.list[++s.currentLayer]=o;for(;i<s[n(381)];)s[n(359)][s[n(381)]]=s.list[s[n(381)]-1],s[n(359)][--s[n(381)]]=o;return s[n(1365)][n(443)](),!0}class x{constructor(e,i,s){const n=t;this[n(1374)]=e,this[n(1357)]=i,this._model=s}run(){const e=t;if(this[e(1357)]===this[e(401)][e(381)])return;const i=this[e(401)][e(381)]<this[e(1357)]?-1:1;let s=!1;for(let t=this[e(1357)];t!==this._model[e(381)];t+=i)if(!this[e(401)].list[t][e(398)]){s=!0;break}if(!s)return;const n=this._model.currentLayer;return b(n,this[e(1357)],this[e(401)])?new v(this._operationName,n,this[e(1357)]):void 0}}class I{constructor(e,i,s,n){const o=t;this[o(1374)]=e,this[o(261)]=i,this[o(1357)]=s,this._model=n}[t(361)](){const e=t,i=this[e(401)].list.findIndex((t=>t.id===this._layerId));if(-1===i||this[e(1357)]===i)return;const s=i<this[e(1357)]?-1:1;let n=!1;for(let t=this[e(1357)];t!==i;t+=s)if(!this[e(401)][e(359)][t].isSoftDeleted){n=!0;break}return n&&b(i,this[e(1357)],this[e(401)])?new v(this[e(1374)],i,this[e(1357)]):void 0}}class S extends x{constructor(e,i,s){const n=t,o=i[n(359)][i[n(381)]],r=i.list.filter((t=>!t.isSoftDeleted)),a=r[n(226)](o)+s;(a<0||a>=r[n(1225)])&&super(e,i.currentLayer,i);const h=r[a];super(e,i.list.indexOf(h),i)}}class E extends S{constructor(e){super(t(235),e,1)}}class C extends S{constructor(e){super(t(1615),e,-1)}}var L=i(5901);class T{constructor(e,i,s){const n=t;this[n(306)]=e,this[n(1833)]=i,this[n(261)]=s,this[n(352)]=n(803),this[n(1521)]=0}async[t(289)](e){const i=t,s=await e[i(1515)](this._imageFileId,this[i(261)]);if(!s)throw new Error(i(1418)+this[i(261)]);return s[i(398)]=!1,s[i(999)].fire(),s}async[t(474)](e){const i=t,s=await e.getLayer(this[i(1833)],this._layerId);if(!s)throw new Error(i(1418)+this[i(261)]);return s[i(398)]=!0,s[i(999)].fire(),s}[t(1461)](){const e=t;return{id:e(1135),operationName:this[e(306)],imageFileId:this[e(1833)],layerId:this[e(261)]}}static[t(1217)](e){const i=t;return new T(e[i(306)],e.imageFileId,e[i(572)])}}var A=i(1405),R=i(6628),D=i(3817);class M{constructor(e,i,s){const n=t;this[n(306)]=e,this._undoDimensions=i,this[n(675)]=s,this.type=n(178),this.pixelCount=0}[t(289)](e){const i=t;e(this._undoDimensions[i(1564)],this._undoDimensions[i(918)])}[t(474)](e){const i=t;e(this[i(675)][i(1564)],this[i(675)].height)}[t(1461)](){const e=t;return{id:e(1626),operationName:this[e(306)],undoDimensions:this[e(957)],redoDimensions:this[e(675)]}}static[t(1217)](e){const i=t;return new M(e[i(306)],e.undoDimensions,e[i(1406)])}}class B{constructor(e,i,s,n,o,r){const a=t;this[a(306)]=e,this._imageFileId=i,this[a(261)]=s,this[a(846)]=n,this[a(317)]=o,this._height=r,this[a(352)]="singleLayer",this[a(1837)]="movePixels",this[a(1521)]=this[a(317)]*this[a(211)]}async undo(e){const i=t,s=await e.getLayer(this[i(1833)],this[i(261)]);if(!s)throw new Error(i(1418)+this._layerId);const n=await e[i(791)](this[i(1833)],this[i(261)],this[i(846)]);if(!n)throw new Error(i(1536)+this[i(261)]);return s.temporaryLayer=void 0,n[i(1724)](),s[i(999)][i(443)](),s}async redo(e){const i=t,s=await e[i(1515)](this[i(1833)],this._layerId);if(!s)throw new Error(i(1418)+this[i(261)]);const n=await e.getTempLayer(this[i(1833)],this[i(261)],this[i(846)]);if(!n)throw new Error(i(1536)+this._layerId);return s[i(1705)]=n,n[i(183)](),s.onUpdateEmitter.fire(),s}[t(1461)](){const e=t;return{id:e(520),operationName:this[e(306)],imageFileId:this[e(1833)],layerId:this._layerId,tempLayerId:this[e(846)],width:this[e(317)],height:this[e(211)]}}static[t(1217)](e){const i=t;return new B(e[i(306)],e[i(851)],e[i(572)],e[i(284)],e[i(1564)],e[i(918)])}}var k=i(4378);class P{constructor(e,i,s,n,o){const r=t;this[r(306)]=e,this[r(1833)]=i,this[r(261)]=s,this._undoImage=n,this[r(1100)]=o,this[r(352)]=r(803),this[r(1521)]=this[r(1483)][r(1564)]*this._undoImage.height}async[t(289)](e){const i=t,s=await e.getLayer(this._imageFileId,this[i(261)]);if(!s)throw new Error(i(1418)+this[i(261)]);return await s[i(463)]((()=>this._undoImage)),s}async[t(474)](e){const i=t,s=await e[i(1515)](this[i(1833)],this._layerId);if(!s)throw new Error("Could not find layer "+this[i(261)]);return await s.edit((()=>this._redoImage)),s}[t(1461)](){const e=t;return{id:e(673),operationName:this.operationName,imageFileId:this[e(1833)],layerId:this[e(261)],undoImage:(0,c.t)(this._undoImage),redoImage:(0,c.t)(this[e(1100)])}}static create(e){const i=t;return new P(e[i(306)],e[i(851)],e[i(572)],(0,c.e)(e[i(335)]),(0,c.e)(e[i(964)]))}}var U=i(4375),F=i(1375);class N{constructor(e,i,s,n,o){const r=t;this[r(306)]=e,this[r(1833)]=i,this[r(261)]=s,this[r(317)]=n,this[r(211)]=o,this[r(352)]=r(803),this[r(1521)]=this[r(317)]*this[r(211)]}async undo(e){const i=t,s=await e[i(1515)](this[i(1833)],this._layerId);if(!s)throw new Error("Could not find layer "+this[i(261)]);return s[i(398)]=!0,s.onUpdateEmitter[i(443)](),s}async[t(474)](e){const i=t,s=await e[i(1515)](this[i(1833)],this[i(261)]);if(!s)throw new Error(i(1418)+this[i(261)]);return s[i(398)]=!1,s.onUpdateEmitter[i(443)](),s}serialize(){const e=t;return{id:e(1472),operationName:this[e(306)],imageFileId:this._imageFileId,layerId:this[e(261)],width:this[e(317)],height:this._height}}static[t(1217)](e){const i=t;return new N(e[i(306)],e[i(851)],e.layerId,e.width,e[i(918)])}}class O{constructor(e){const i=t;this[i(306)]=e,this[i(352)]="readonly",this[i(1521)]=0}[t(1461)](){const e=t;return{id:e(1287),operationName:this[e(306)]}}static[t(1217)](e){return new O(e[t(306)])}}class V{constructor(){const e=t;this[e(352)]=e(1422),this[e(306)]="Restore Image (Hot Exit)",this.pixelCount=0}serialize(){return{id:t(1169)}}static[t(1217)](t){return new V}}class H{constructor(e,i,s,n){const o=t;this._imageFileId=e,this[o(261)]=i,this[o(1640)]=s,this._redoBlendMode=n,this[o(352)]=o(803),this[o(1521)]=0,this[o(306)]=o(222)+function(e){const i=t;return e.substr(0,1)[i(604)]()+e.substr(1)}(this[o(395)])}async[t(289)](e){const i=t,s=await e[i(1515)](this[i(1833)],this[i(261)]);if(!s)throw new Error("Could not find layer "+this[i(261)]);return s.blendMode=this[i(1640)],s}async[t(474)](e){const i=t,s=await e[i(1515)](this[i(1833)],this[i(261)]);if(!s)throw new Error("Could not find layer "+this[i(261)]);return s[i(795)]=this._redoBlendMode,s}serialize(){const e=t;return{id:e(857),imageFileId:this[e(1833)],layerId:this[e(261)],undoBlendMode:this[e(1640)],redoBlendMode:this[e(395)]}}static create(e){const i=t;return new H(e[i(851)],e.layerId,e[i(927)],e[i(732)])}}class z{constructor(e,i,s){const n=t;this[n(1833)]=e,this[n(261)]=i,this[n(607)]=s,this.type=n(803),this.pixelCount=0,this[n(306)]=(this[n(607)]?n(637):n(1337))+n(1489)}async undo(e){const i=t,s=await e[i(1515)](this[i(1833)],this[i(261)]);if(!s)throw new Error(i(1418)+this._layerId);return s[i(804)]=!this[i(607)],s}async[t(474)](e){const i=t,s=await e[i(1515)](this[i(1833)],this[i(261)]);if(!s)throw new Error("Could not find layer "+this._layerId);return s[i(804)]=this[i(607)],s}serialize(){const e=t;return{id:"setLayerVisibility",imageFileId:this._imageFileId,layerId:this._layerId,isVisible:this[e(607)]}}static[t(1217)](e){const i=t;return new z(e[i(851)],e[i(572)],e[i(804)])}}var W=i(6495);class j{constructor(e,i){const s=t;this[s(554)]=e,this[s(984)]=i}[t(361)](){const e=t;if(this[e(984)][e(795)]===this[e(554)])return;const i=this._layer[e(795)];return this[e(984)].blendMode=this[e(554)],new H(this[e(984)][e(851)],this._layer.id,i,this[e(554)])}}class q{constructor(e,i,s,n){const o=t;this[o(1833)]=e,this[o(261)]=i,this[o(1462)]=s,this[o(1069)]=n,this.type=o(803),this[o(1521)]=0,this.operationName=o(1419)+function(e){const i=t;return e[i(1726)](0,1)[i(604)]()+e[i(1726)](1)}(this[o(1069)])}async[t(289)](e){const i=t,s=await e[i(1515)](this[i(1833)],this[i(261)]);if(!s)throw new Error("Could not find layer "+this[i(261)]);return s.name=this[i(1462)],s}async[t(474)](e){const i=t,s=await e[i(1515)](this[i(1833)],this._layerId);if(!s)throw new Error(i(1418)+this[i(261)]);return s[i(1027)]=this[i(1069)],s}[t(1461)](){const e=t;return{id:e(267),imageFileId:this._imageFileId,layerId:this[e(261)],undoName:this[e(1462)],redoName:this[e(1069)]}}static[t(1217)](e){const i=t;return new q(e[i(851)],e[i(572)],e[i(1350)],e[i(1753)])}}class G{constructor(e,i){const s=t;this[s(1623)]=e,this[s(984)]=i}[t(361)](){const e=t;if(this[e(984)][e(1027)]===this._name)return;const i=this._layer[e(1027)];return this[e(984)][e(1027)]=this[e(1623)],new q(this[e(984)].imageFileId,this._layer.id,i,this._name)}}class X{constructor(e,i){this[t(607)]=e,this._layer=i}run(){const e=t;if(this[e(984)][e(804)]!==this._isVisible)return this[e(984)].isVisible=this._isVisible,new z(this[e(984)][e(851)],this[e(984)].id,this._isVisible)}}class J extends e.JT{constructor(e,i,o,r,a){const c=t;super(),this[c(984)]=e,this[c(1578)]=i,this[c(317)]=o,this[c(211)]=r,this._historyService=a,this[c(1331)]=0,this[c(484)]=new Set,this[c(539)]=(0,s.Pq)(),this[c(1485)]=(0,s.Pq)(),this._onUpdate=this[c(1324)](new n.v),this[c(1496)]=this[c(299)][c(1545)],this[c(1433)]=this[c(1324)](new n.v),this[c(1155)]=this[c(1433)][c(1545)],this._undoData={colorData:new Uint8Array(200),indexList:(0,h.X$)(50,this[c(317)]*this[c(211)]*4)},this._redoData={colorData:new Uint8Array(200),indexList:(0,h.X$)(50,this[c(317)]*this._height*4)}}setPixel(e,i,n,o){const r=t;if(e<0||e>=this[r(317)])return;const a=i*this._width+e;if(this[r(484)][r(905)](a))return;this[r(484)].add(a),(0,s.Hv)(this[r(1485)],e,i),this[r(1331)]>=this._undoData[r(1628)][r(1225)]&&(this[r(998)].indexList=(0,h.Rs)(this[r(998)][r(1628)]),this[r(998)][r(638)]=(0,h.Rs)(this._undoData[r(638)]),this[r(1632)].indexList=(0,h.Rs)(this[r(1632)][r(1628)]),this[r(1632)][r(638)]=(0,h.Rs)(this[r(1632)][r(638)]));const c=4*(i*this[r(317)]+e),l=4*this[r(1331)];this[r(998)].indexList[this[r(1331)]]=c,this[r(998)][r(638)][l]=this[r(1578)][c],this[r(998)][r(638)][l+1]=this[r(1578)][c+1],this[r(998)][r(638)][l+2]=this[r(1578)][c+2],this[r(998)][r(638)][l+3]=this[r(1578)][c+3],this[r(1632)].indexList[this[r(1331)]]=c,o?((0,_.B)(o,this[r(1578)],c,n,0),this[r(1632)][r(638)][l]=this[r(1578)][c],this[r(1632)][r(638)][l+1]=this[r(1578)][c+1],this._redoData[r(638)][l+2]=this[r(1578)][c+2],this._redoData[r(638)][l+3]=this[r(1578)][c+3]):(this[r(1632)][r(638)][l]=this[r(1578)][c]=n[0],this._redoData[r(638)][l+1]=this[r(1578)][c+1]=n[1],this[r(1632)].colorData[l+2]=this[r(1578)][c+2]=n[2],this[r(1632)].colorData[l+3]=this._data[c+3]=n[3]),this[r(1331)]++}[t(1790)](e,i,s,n,o){const r=t,a=Math[r(1719)]((s-1)/2),h=s%2==0?1:0;let c=a,l=0,d=1-a;for(n?(this[r(412)](e-a,e+a+h,i,o),h&&this._setHorizontalLine(e-a,e+a+h,i+1,o)):(this[r(1577)](e+a+h,i,o),this.setPixel(e-a,i,o),h&&(this.setPixel(e+a+h,i+1,o),this[r(1577)](e-a,i+1,o))),this.setPixel(e,i+a+h,o),this[r(1577)](e,i-a,o);c>l&&(l++,d<=0?d=d+2*l+1:(c--,d=d+2*i-2*e+1),!(c<l));)n?(this[r(412)](e-c,e+c+h,i+l+h,o),this[r(412)](e-c,e+c+h,i-l,o),this[r(412)](e-l,e+l+h,i+c+h,o),this[r(412)](e-l,e+l+h,i-c,o)):(this[r(1577)](e+c+h,i+l+h,o),this[r(1577)](e-c,i+l+h,o),this[r(1577)](e+c+h,i-l,o),this.setPixel(e-c,i-l,o),this[r(1577)](e+l,i+c+h,o),this[r(1577)](e-l,i+c+h,o),this.setPixel(e+l,i-c,o),this[r(1577)](e-l,i-c,o))}_setHorizontalLine(e,i,s,n){const o=t;for(let t=e;t<=i;t++)this[o(1577)](t,s,n),this[o(1577)](t,s,n)}[t(429)](){const e=t;(0,s.Bu)(this._rangeNotYetRequested)||(this[e(539)]=(0,s.qi)(this[e(539)],this[e(1485)]),this[e(299)][e(443)](this[e(1485)]),this._rangeNotYetRequested=(0,s.Pq)())}[t(1523)](e){const i=t,s={indexList:this._undoData[i(1628)][i(258)](0,this[i(1331)]),colorData:this[i(998)][i(638)][i(258)](0,4*this[i(1331)])},n={indexList:this._redoData[i(1628)][i(258)](0,this[i(1331)]),colorData:this[i(1632)].colorData[i(258)](0,4*this[i(1331)])},o=new l.x(e,this[i(984)][i(851)],this._layer.id,this[i(539)],s,n);this[i(1765)][i(1450)](o),this[i(1433)][i(443)](this[i(539)])}}var Y=i(270);class K extends e.JT{constructor(e,i,s,o,r,a,h,c,l,d){const u=t;super(),this[u(1765)]=e,this[u(938)]=i,this[u(232)]=s,this.id=o,this[u(851)]=r,this[u(1623)]=a,this.isReadonly=h,this[u(356)]=c,this.width=l,this[u(918)]=d,this._isEditInProgress=!1,this[u(554)]=u(1579),this[u(607)]=!0,this[u(986)]=!1,this[u(1831)]=!1,this.onUpdateEmitter=this[u(1324)](new n.v),this.onUpdate=this[u(999)].event,this[u(1796)]=this[u(1324)](new n.v),this.onSoftDeletedChange=this[u(1796)].event,this._onChangedDimensions=this[u(1324)](new n.v),this[u(699)]=this[u(991)][u(1545)],this[u(768)]=this[u(1324)](new n.v),this[u(208)]=this[u(768)][u(1545)],this._onRequestRender=this[u(1324)](new n.v),this.onRequestRender=this[u(1505)].event,this[u(1286)]=this[u(1324)](new n.v),this[u(1074)]=this[u(1286)][u(1545)]}get[t(1027)](){return this._name}set name(e){const i=t;e!==this[i(1623)]&&(this._name=e,this[i(999)][i(443)]())}get[t(795)](){return this._blendMode}set[t(795)](e){const i=t;e!==this[i(554)]&&(this[i(554)]=e,this[i(999)].fire())}get isSoftDeleted(){return this[t(986)]}set[t(398)](e){const i=t;e!==this._isSoftDeleted&&(this._isSoftDeleted=e,this[i(1796)].fire())}get[t(804)](){return this[t(607)]}set[t(804)](e){const i=t;e!==this[i(607)]&&(this[i(607)]=e,this[i(768)].fire(),this[i(999)][i(443)]())}get[t(1372)](){const e=t;let i=this[e(918)]-1;t:for(let t=0;t<this.height;t++)for(let s=0;s<this[e(1564)];s++)if(this.data[4*(t*this[e(1564)]+s)+3]>0){i=t;break t}let s=i;t:for(let t=this[e(918)]-1;t>i;t--)for(let i=0;i<this[e(1564)];i++)if(this[e(356)][4*(t*this[e(1564)]+i)+3]>0){s=t;break t}let n=this.width-1;t:for(let t=0;t<this[e(1564)];t++)for(let o=i;o<=s;o++)if(this.data[4*(o*this[e(1564)]+t)+3]>0){n=t;break t}let o=n;t:for(let t=this[e(1564)]-1;t>n;t--)for(let n=i;n<=s;n++)if(this[e(356)][4*(n*this[e(1564)]+t)+3]>0){o=t;break t}return{left:n,top:i,right:o,bottom:s}}async[t(463)](e){const i=t;this[i(873)]();try{const t=await e(this.data,this[i(1564)],this[i(918)]),s={image:t&&"data"in t?t:void 0,range:t&&"left"in t?t:void 0};this._finishEdit(s)}catch(t){throw this._finishEdit({range:(0,s.DI)(this.width,this.height)}),t}}createExtendedEdit(){const e=t;this._startEdit();const i=new J(this,this[e(356)],this.width,this[e(918)],this[e(1765)]);return(0,n.B)(i.onUpdate,this[e(999)]),i[e(1155)]((t=>this._finishEdit({range:t}))),i}async[t(528)](e){const i=t;if(e[i(804)])return this[i(1765)][i(205)](new W.Z(i(527),(0,s.DI)(this.width,this[i(918)]),this,(async(t,s,n)=>{const o=i;!this[o(804)]&&t[o(971)](e[o(356)],0);let r=0;for(let i=0;i<n;i++)for(let n=0;n<s;n++)r=4*(i*s+n),(0,_.B)(e[o(795)],t,r,e.data,r)})))}async[t(1828)](e,i=!0){const s=t;await this.finishTemporaryLayer(),this[s(1705)]=e,i&&((0,n.B)(e.onRequestRender,this._onRequestRender),e.onCommit((()=>this.temporaryLayer=void 0))),this[s(1286)][s(443)](this[s(1705)])}async finishTemporaryLayer(){const e=t;await(this.temporaryLayer?.[e(1523)]()),this[e(1705)]=void 0}async[t(1589)](){const e=t;if(!this[e(1705)])return this.data;const i=this.data.slice();if("moving"===this[e(1705)][e(352)]){const t=this.temporaryLayer,s=await t.staticState[e(1020)][e(253)],n={left:t[e(1115)][e(1575)],top:t[e(1115)].offsetY,right:t[e(1115)][e(1575)]+s[e(1564)],bottom:t[e(1115)][e(680)]+s[e(918)]};let o=0;for(let t=n[e(1082)];t<n[e(799)];t++)for(let r=n[e(707)];r<n[e(895)];r++){o=4*(t*this.width+r);const a=4*((t-n[e(1082)])*s.width+r-n.left);(0,_.B)(this[e(795)],i,o,s[e(356)],a)}}else this[e(1705)][e(559)](i,this[e(1564)],this[e(918)]);return i}async[t(1733)](e={}){const i=t;let n,o;if(e?.[i(1679)]&&this.temporaryLayer?.[i(352)]===i(1076)){const t=this[i(1705)];n=await t[i(292)][i(1020)].readyPromise,o=(0,s.DI)(n.width,n.height)}else await this[i(351)](),n=this,o=e[i(1707)]||(0,s.DI)(this[i(1564)],this[i(918)]);return $(function(e,i){const s=t,n=i[s(895)]-i[s(707)],o=i[s(799)]-i[s(1082)];let r,a=0;if(n===e[s(1564)])a=i[s(1082)]*n*4,r=new Uint8ClampedArray(e[s(356)][s(258)](a,a+n*o*4));else{r=new Uint8ClampedArray(n*o*4);for(let t=i.top;t<i[s(1082)]+o;t++)a=4*(t*e[s(1564)]+i[s(707)]),r[s(971)](e[s(356)][s(258)](a,a+4*n),(t-i[s(1082)])*n*4)}return new ImageData(r,n,o)}(n,o),e)}async[t(520)](e,i){const n=t,o=await window[n(1845)](e);let r;n(225)in window?r=new OffscreenCanvas(o[n(1564)],o[n(918)]):(r=document[n(1296)]("canvas"),r[n(1564)]=o[n(1564)],r[n(918)]=o[n(918)]);const a=r[n(714)]("2d");a[n(1841)](o,0,0);const h=a[n(1038)](0,0,o.width,o.height),c={data:new Uint8Array(h[n(356)]),width:h[n(1564)],height:h[n(918)]};let l;l=i&&i[n(895)]-i[n(707)]===h.width&&i[n(799)]-i[n(1082)]===h.height?(0,s.BN)(i):(0,s.DI)(h.width,h.height);const d=new Y.m(this,c,l,void 0,this[n(1765)],this[n(938)],this._taskWorkerService);d[n(1261)][n(1686)]({...d[n(1115)]}),await this[n(1828)](d),this[n(1765)][n(1450)](new B(n(1649),this[n(851)],this.id,d.id,d[n(292)][n(1020)][n(272)][n(1564)],d[n(292)][n(1020)][n(272)][n(918)]));const u=(0,s.l$)((0,s.DI)(h.width,h[n(918)]),(0,s.DI)(this[n(1564)],this[n(918)]));return this[n(999)].fire(u),d}_startEdit(){const e=t;if(this[e(861)])throw new Error(e(722));if(this[e(388)])throw new Error(e(1355));this[e(388)]=!0}[t(1270)](e){const i=t;if(e){if(e?.[i(1020)]){const t=this[i(1564)]!==e.image[i(1564)]||this.width!==e[i(1020)][i(1564)];this.data=e[i(1020)][i(356)],this[i(1564)]=e[i(1020)][i(1564)],this[i(918)]=e[i(1020)].height,t&&this[i(991)][i(443)](this[i(1564)],this[i(918)])}this.onUpdateEmitter[i(443)](e[i(1707)]),this[i(388)]=!1}else this._isEditInProgress=!1}[t(857)](t){this._historyService.runSyncAction(new j(t,this))}setName(e){const i=t;this._historyService[i(1212)](new G(e,this))}setVisible(e){const i=t;this[i(1765)][i(1212)](new X(e,this))}[t(1461)](){const e=t;return{id:this.id,name:this[e(1623)],data:Array[e(1566)](this[e(356)]),blendMode:this._blendMode,isSoftDeleted:this._isSoftDeleted,isVisible:this[e(607)]}}}async function $(e,i={}){const s=t,n=await createImageBitmap(e);if(!("OffscreenCanvas"in window)){const t=document[s(1296)](s(1028));return t.width=n[s(1564)],t.height=n[s(918)],t[s(714)]("2d").drawImage(n,0,0),new Promise(((e,n)=>{const o=s;t[o(180)]((t=>{if(!t)return n(t);e(t)}),i[o(1850)]?.[o(352)],i[o(1850)]?.quality)}))}const o=new OffscreenCanvas(n[s(1564)],n[s(918)]);return o[s(714)]("2d").drawImage(n,0,0),o[s(417)](i.encodeOptions)}var Z=i(807);class Q extends e.JT{constructor(){const e=t;super(),this[e(381)]=0,this[e(861)]=!1,this[e(359)]=[],this[e(1365)]=this[e(1324)](new n.v),this[e(1066)]=this[e(1365)][e(1545)]}}class tt extends e.JT{constructor(e,i,s){const o=t;super(),this[o(1765)]=e,this._selectionService=i,this._taskWorkerService=s,this.width=0,this[o(918)]=0,this.activeImageFileId=0,this[o(1747)]=0,this[o(1312)]=0,this[o(863)]=o(203),this[o(576)]=0,this._activeTemporaryLayers=new Map,this[o(299)]=this.register(new n.v),this.onUpdate=this[o(299)][o(1545)],this._onChangedDimensions=this[o(1324)](new n.v),this[o(699)]=this[o(991)][o(1545)],this[o(378)]=this[o(1324)](new n.v),this.onLayerChange=this[o(378)][o(1545)],this[o(269)]=this.register(new n.v),this[o(238)]=this[o(269)].event,this._onRequestRender=this[o(1324)](new n.v),this.onRequestRender=this._onRequestRender[o(1545)],this[o(1286)]=this[o(1324)](new n.v),this.onTemporaryLayerRegistered=this._onTemporaryLayerRegistered[o(1545)],this[o(1410)]=this[o(1324)](new n.v),this[o(1203)]=this[o(1410)][o(1545)];const r=new Q;(0,n.B)(r[o(1066)],this[o(378)]),this[o(1565)]=[r],this[o(1765)][o(1379)](o(1385),{undo:t=>t.undo(this[o(1048)]),redo:t=>t[o(474)](this[o(1048)])}),this._historyService[o(1379)]("resize",{undo:t=>t[o(289)](this[o(178)][o(1174)](this)),redo:t=>t[o(474)](this.resize.bind(this))}),this._historyService[o(1364)]("openImage",O[o(1217)]),this[o(1765)][o(1364)]("layerRange",k.$[o(1217)]),this[o(1765)][o(1364)]("layerReplace",P[o(1217)]),this._historyService[o(1364)](o(1626),M[o(1217)]),this[o(1765)][o(1364)]("setBlendMode",H[o(1217)]),this._historyService[o(1364)](o(267),q.create),this[o(1765)][o(1364)](o(594),z.create),this[o(1765)].registerHistoryEntryFactory(o(1135),T[o(1217)]),this._historyService.registerHistoryEntryFactory(o(1472),N[o(1217)]),this[o(1765)][o(1364)](o(1112),v[o(1217)]),this[o(1765)][o(1364)]("restoreImage",V[o(1217)]),this[o(1765)][o(1364)](o(520),B.create),this[o(1765)][o(1364)](o(767),R.$[o(1217)][o(1174)](null,this._taskWorkerService)),this[o(1765)][o(1364)](o(1751),F.C[o(1217)][o(1174)](null,this._taskWorkerService)),this[o(1765)][o(1364)](o(1735),U.Y[o(1217)]),this[o(1765)][o(1364)](o(1431),A.D[o(1217)]),this[o(1765)].registerHistoryEntryFactory(o(1224),L.X[o(1217)]),this[o(1765)][o(1364)]("finishRectangle",D.O[o(1217)]),this.onTemporaryLayerRegistered((t=>{const e=o;this[e(1423)][e(971)](t.id,t)}))}get[t(381)](){const e=t;return this[e(1048)][e(359)][this[e(1048)][e(381)]]}get[t(574)](){const e=t;return this[e(1048)][e(359)][e(1068)]((t=>!t.isSoftDeleted))}get[t(1526)](){return this[t(863)]}set[t(1526)](e){const i=t;this[i(863)]=e,this._onMimeTypeChange[i(443)](e)}get[t(1048)](){const e=t;return this[e(1565)][this[e(576)]]}[t(1461)](e=0){const i=t;if(-1!==e&&this[i(1564)]*this.height>e)throw new Error("Image exceeded maximum pixel count allowed ("+this[i(1564)]*this[i(918)]+i(695)+e+")");for(const t of this[i(1423)].values())if(t.canSerialize){const i=t.canSerialize(e);if(i)throw new Error(i)}const s=[];for(const t of this._activeTemporaryLayers[i(1611)]())s.push(t[i(1461)]());const n={dimensions:{width:this[i(1564)],height:this.height},currentLayer:this[i(1048)][i(381)],imageFileId:this.activeImageFileId,isReadonly:this[i(1048)][i(861)],layers:this[i(1048)][i(359)][i(1522)]((t=>t.serialize())),temporaryLayers:s,currentTemporaryLayerId:this[i(381)]?.temporaryLayer?.id};if(0===n.layers[i(1225)])throw new Error(i(1342));return n}deserialize(e,i){const s=t;if(this[s(1564)]=e[s(577)].width,this[s(918)]=e[s(577)][s(918)],this[s(1697)]=e.imageFileId,i&&(this[s(1048)][s(359)][s(1225)]=0,this[s(1423)].clear()),this[s(1048)][s(359)].length>0)throw new Error("Cannot restore layers when layer(s) exist");for(const t of e[s(574)]){const i=new K(this[s(1765)],this[s(938)],this[s(232)],t.id,e.imageFileId,t[s(1027)],e.isReadonly,new Uint8Array(t[s(356)]),e[s(577)].width,e[s(577)][s(918)]);i[s(795)]=t[s(795)],i.isSoftDeleted=t.isSoftDeleted,i[s(804)]=t[s(804)],this[s(1048)][s(359)][s(1686)](i),this[s(847)](i),this[s(1747)]=Math[s(282)](this[s(1747)],t.id+1)}this._activeLayersModel.isReadonly=e[s(861)],this[s(1048)][s(381)]=e.currentLayer;for(const t of e[s(812)]){const e=this[s(1095)](t.parentLayerId);let i;switch(t[s(352)]){case s(1076):i=Y.m[s(1217)];break;case s(615):i=Z.F[s(1217)]}const o=i(t,e,this._historyService,this[s(938)],this[s(232)]);o[s(1115)].offsetX=t.currentState[s(1575)],o[s(1115)][s(680)]=t[s(1115)].offsetY,(0,n.B)(o[s(1036)],this[s(381)][s(1505)]),this._activeTemporaryLayers[s(971)](t.id,o)}if(void 0!==e.currentTemporaryLayerId){const t=this[s(744)](e.currentTemporaryLayerId);this[s(381)][s(1705)]=t}this._updateBottomLayer(),this[s(299)][s(443)](),this[s(991)][s(443)](this[s(1564)],this.height),this[s(378)].fire()}setNextLayerId(e){this[t(1747)]=e-1}[t(456)](){return++this[t(1312)]}setNextTemporaryLayerId(e){this[t(1312)]=e-1}async[t(1506)](e,i,s){const n=t;this[n(1697)]=0,this[n(1526)]=e;const o=await window[n(1845)](i);let r;n(225)in window?r=new OffscreenCanvas(o[n(1564)],o[n(918)]):(r=document[n(1296)](n(1028)),r[n(1564)]=o.width,r[n(918)]=o[n(918)]);const a=r[n(714)]("2d");a[n(1841)](o,0,0);const h=a.getImageData(0,0,o.width,o[n(918)]);this[n(1287)](e,{data:new Uint8Array(h[n(356)][n(746)]),width:o[n(1564)],height:o.height},!0,s)}[t(1287)](e,i,s,n,o=t(737)+(n?t(1046):"")){const r=t;this[r(1697)]="id"in i?i.id:0,this[r(1526)]=e||"image/png";for(const t of this[r(1048)][r(359)])t.isSoftDeleted=!0,t[r(980)]();this._activeLayersModel.list[r(1225)]=0,this._activeTemporaryLayers[r(624)]();const a=this[r(1564)]!==i[r(1564)]||this[r(918)]!==i[r(918)];this[r(1564)]=i[r(1564)],this[r(918)]=i[r(918)],this[r(1048)][r(861)]=n,this._activeLayersModel[r(359)][r(1686)](this[r(204)](i[r(356)])),this[r(1741)](),s&&(this[r(1765)][r(798)](),this[r(1765)][r(1450)](new O(o))),this[r(299)][r(443)](),a&&this[r(991)][r(443)](this[r(1564)],this.height),this[r(378)][r(443)]()}[t(1472)](e,i,s){const n=t;this[n(1526)]=s;const o=window[n(1491)]?SharedArrayBuffer:ArrayBuffer,r=new Uint8Array(new o(e*i*4));r[n(365)](255);const a={data:r,width:e,height:i};this[n(1287)](void 0,a,!0,!1,n(1333))}async[t(1733)](e){const i=t;if(this[i(1526)]===i(372))throw new Error(i(1049));return await this[i(1657)](),this[i(1048)].list[this[i(1048)][i(381)]][i(1733)](e)}async[t(1470)](e){const i=t;if(this.mimeType===i(372))throw new Error(i(1049));const s=await this[i(1589)]();return $(new ImageData(new Uint8ClampedArray(s[i(356)]),s[i(1564)],s[i(918)]),e)}[t(646)](){const e=t;return this[e(1657)](),{data:this._activeLayersModel.list[this._activeLayersModel.currentLayer][e(356)][e(1006)](0,this[e(1564)]*this[e(918)]*4),width:this[e(1564)],height:this[e(918)]}}async exportImageClone(){const e=t,i=this[e(1048)][e(359)][e(1068)]((t=>t[e(804)]));if(0===i.length)return{data:new Uint8Array(0),width:0,height:0};const s={data:i[0][e(356)].slice(0,this.width*this[e(918)]*4),width:this[e(1564)],height:this[e(918)]};for(let t=0;t<i[e(1225)];t++){const n=i[t],o=await n.exportImageClone();let r=0;for(let t=0;t<this[e(918)];t++)for(let i=0;i<this[e(1564)];i++)r=4*(t*this[e(1564)]+i),(0,_.B)(n.blendMode,s.data,r,o,r)}return s}[t(509)](){const e=t;return this[e(1526)]!==e(372)}_checkLayerSupport(){const e=t;if(!this[e(509)]())throw new Error(e(1503))}[t(608)](){const e=t;if(this._activeLayersModel[e(861)])throw new Error("Image is readonly, edit is not supported")}[t(1136)](e){const i=t;this[i(381)]?.id!==e&&(this._checkLayerSupport(),this[i(1048)].currentLayer=this[i(1690)](e),this[i(378)][i(443)]())}async[t(1824)](){const e=t;this[e(608)](),this[e(1687)](),await(this[e(381)]?.[e(351)]());const i=window[e(1491)]?SharedArrayBuffer:ArrayBuffer,s=this[e(204)](new Uint8Array(new i(this[e(1564)]*this[e(918)]*4)));this[e(1048)][e(359)][e(773)](++this[e(1048)].currentLayer,0,s),this[e(1765)][e(1450)](new N("New Layer",s[e(851)],s.id,s[e(1564)],s.height)),this[e(299)][e(443)](),this._onLayerChange.fire()}async[t(1135)](e){const i=t;if(this._checkCanEdit(),this._checkLayerSupport(),this._activeLayersModel[i(359)].length<=1)throw new Error(i(1239));await(this[i(381)]?.finishTemporaryLayer()),e?this[i(919)](this[i(1690)](e)):this[i(963)](),this._onLayerChange.fire()}async[t(896)](e){const i=t;let s;this[i(608)](),void 0===e?(s=this[i(381)],e=s.id):s=this[i(1095)](e),this[i(574)][i(1225)]>0&&this._checkLayerSupport(),await s.finishTemporaryLayer();const n=(0,h.X$)(s[i(356)][i(1225)],255,!0);let o;if(n[i(971)](s[i(356)],0),s.name[i(1282)](/ Copy$/)){let t=1;o=s[i(1027)]+" 1";do{o=o.replace(/ \d+$/," "+ ++t)}while(this[i(1048)][i(359)].some((t=>t.name===o)))}else{const t=s[i(1027)][i(1282)](/ Copy (\d)+$/);if(t&&t[1]){let e=parseInt(t[1]);do{o=s[i(1027)][i(394)](/ \d+$/," "+ ++e)}while(this[i(1048)][i(359)][i(1234)]((t=>t[i(1027)]===o)))}else o=s[i(1027)]+" Copy"}const r=++this[i(1747)],a=new K(this._historyService,this[i(938)],this._taskWorkerService,r,this[i(1697)],o,this[i(1048)].isReadonly,n,this[i(1564)],this[i(918)]);this[i(847)](a);const c=this[i(1690)](e);this[i(1048)][i(359)][i(773)](c+1,0,a),this.setActiveLayer(r),this._historyService.addEntry(new N(i(941),s[i(851)],r,s[i(1564)],s[i(918)])),this[i(299)][i(443)](),this[i(378)][i(443)]()}async[t(1542)](){const e=t;if(this[e(608)](),this[e(1687)](),0===this[e(1048)].currentLayer||this[e(574)][0]===this[e(381)])throw new Error(e(838));const i=this[e(1048)][e(359)][this[e(1048)][e(381)]];await i[e(351)]();const s=this[e(574)].indexOf(i),n=this[e(574)][s-1],o=this[e(1048)][e(359)][e(226)](n);await this[e(1765)][e(434)]("Merge Layer Down",(async()=>{const t=e;i[t(1558)](!0),n.setVisible(!0),await this[t(1048)][t(359)][o][t(528)](i),this[t(963)](),this._activeLayersModel[t(381)]=o,this[t(381)]?.[t(1558)](!0)}))}renameLayer(e,i){const s=t;let n;this[s(608)](),void 0===i?(n=this[s(381)],i=n.id):n=this.getLayerById(i),n.setName(e),this[s(378)][s(443)]()}[t(441)](){const e=t;this[e(1687)](),this.setActiveLayer(this[e(574)][this[e(574)][e(1225)]-1].id)}[t(1029)](){const e=t;this[e(1687)](),this[e(1136)](this[e(574)][0].id)}[t(1317)](){const e=t;this[e(1687)](),this[e(505)](1)}[t(1189)](){const e=t;this[e(1687)](),this[e(505)](-1)}[t(505)](e){const i=t,s=this[i(381)];if(!s)throw new Error("No current layer");const n=this[i(574)],o=n.indexOf(s);if(-1===o)throw new Error("Could not find current layer");const r=(0,w.u)(o+e,n[i(1225)]-1,0);this.setActiveLayer(n[r].id)}[t(377)](){const e=t;this._checkCanEdit(),this[e(1687)](),this[e(1765)][e(1212)](new x(e(1646),this[e(1048)][e(359)].length-1,this[e(1048)]))}moveLayerToBottom(){const e=t;this[e(608)](),this[e(1687)](),this[e(1765)].runSyncAction(new x(e(890),0,this[e(1048)]))}[t(550)](){const e=t;this[e(608)](),this._checkLayerSupport(),this._historyService[e(1212)](new E(this[e(1048)]))}[t(310)](){const e=t;this._checkCanEdit(),this[e(1687)](),this._historyService[e(1212)](new C(this[e(1048)]))}[t(644)](e,i){const s=t;this[s(608)](),this._checkLayerSupport();const n=this[s(1048)][s(359)].findIndex((t=>t.id===i));-1!==n&&this[s(1765)][s(1212)](new I(s(808),e,n,this._activeLayersModel))}[t(504)](e,i){const s=t;return e>=0&&e<this[s(1564)]&&i>=0&&i<this[s(918)]}[t(178)](e,i){const s=t;this[s(608)](),this[s(1564)]===e&&this[s(918)]===i||(this.width=e,this[s(918)]=i,this[s(299)].fire(),this[s(991)][s(443)](e,i))}_createLayer(e){const i=t;this.layers[i(1225)]>0&&this[i(1687)](),e=(0,h.pZ)(e);const s=++this[i(1747)],n=new K(this[i(1765)],this[i(938)],this._taskWorkerService,s,this[i(1697)],1===s?i(1392):i(1117)+this[i(1185)](),this[i(1048)][i(861)],e,this[i(1564)],this.height);return this[i(847)](n),n}[t(847)](e){const i=t;(0,n.B)(e[i(1496)],this._onUpdate),(0,n.B)(e[i(1164)],this._onLayerChange),(0,n.B)(e[i(699)],this._onChangedDimensions),(0,n.B)(e.onVisibilityChange,this._onLayerVisibilityChange),(0,n.B)(e.onRequestRender,this._onRequestRender),(0,n.B)(e[i(1074)],this[i(1286)])}[t(1185)](){const e=t,i=this[e(574)][e(1522)]((t=>t[e(1027)])).filter((t=>t.match(/^Layer \d+$/))).map((t=>parseInt(t[e(1726)](6))));let s=1;for(;i[e(712)](s);)s++;return s}[t(963)](){const e=t;this[e(919)](this._activeLayersModel[e(381)])}[t(919)](e){const i=t;if(1===this[i(653)]())throw new Error(i(692));if(this._activeLayersModel[i(381)]===e){let t=this._activeLayersModel.currentLayer-1;for(;t>0&&this[i(1048)].list[t][i(398)];)t--;if(t<0)for(t=this[i(1048)][i(381)]+1;t<this._activeLayersModel[i(359)][i(1225)]-1&&this[i(1048)][i(359)][t][i(398)];)t++;this[i(1048)][i(381)]=Math[i(282)](t,0)}const s=this[i(1048)][i(359)][e];s[i(398)]=!0,this[i(1765)][i(1450)](new T(i(1137),s[i(851)],s.id)),this[i(1741)]()}async[t(1657)](){const e=t;this[e(1687)](),this[e(653)]()>1&&(await this[e(1765)][e(434)]("Flatten Layers",(async()=>{const t=e;for(let e=this[t(1048)][t(359)][t(1225)]-1;e>=1;e--){const i=this[t(1048)][t(359)][e];await i.finishTemporaryLayer(),await this[t(1048)][t(359)][e-1][t(528)](i),this[t(919)](e)}})),this[e(299)][e(443)](),this._onLayerChange[e(443)]())}[t(1741)](){const e=t;this[e(1048)][e(359)][0][e(1831)]=!0;for(let t=1;t<this[e(1048)][e(359)][e(1225)];t++)this[e(1048)][e(359)][t][e(1831)]=!1}_getIndexFromId(e){const i=t,s=this[i(1048)][i(359)][i(1710)]((t=>t.id===e));if(-1===s)throw new Error(i(1327));return s}[t(1095)](e){const i=t;return this[i(1048)].list[this[i(1690)](e)]}[t(744)](e){const i=t;return this._activeTemporaryLayers[i(1375)](e)}_getNonSoftDeletedLayerCount(){const e=t;let i=0;for(const t of this[e(1048)][e(359)])!t[e(398)]&&i++;return i}async[t(842)](){const e=t,i=this[e(938)].range;if(!i)return;const s=this[e(381)];s&&(await(this.currentLayer?.[e(351)]()),await this[e(1765)][e(434)]("Erase Selection",(async()=>{const t=e;await this[t(1765)].runAction(new W.Z(t(242),i,s,((e,s)=>{const n=t;for(let t=i.top;t<i[n(799)];t++){const o=t*s*4;e.fill(0,o+4*i.left,o+4*i[n(895)])}}))),this._selectionService[t(1283)]()})))}[t(702)](){const e=t,i=(0,s.DI)(this[e(1564)],this.height);return this[e(938)][e(1595)]("Select All",i),i}}class et extends e.JT{constructor(e){const i=t;super(),this[i(1792)]=[],this._onKeyDown=this[i(1324)](new n.v),this[i(469)]=this[i(647)][i(1545)],this[i(1099)]=this[i(1324)](new n.v),this.onKeyUp=this._onKeyUp.event,this[i(1750)]=this[i(1324)](new n.v),this[i(734)]=this[i(1750)].event,this[i(1480)]=this.register(new n.v),this[i(1775)]=this[i(1480)][i(1545)],this[i(635)]=this[i(1324)](new n.v),this[i(611)]=this[i(635)][i(1545)],this._onPointerUp=this[i(1324)](new n.v),this[i(617)]=this[i(782)][i(1545)],this[i(1198)]=this[i(1324)](new n.v),this[i(525)]=this[i(1198)][i(1545)],e[i(547)]((t=>this[i(652)](t)))}get[t(1421)](){return!!this._pointerDownMoveListener}dispose(){const e=t;this[e(764)]?.dispose(),super[e(980)]()}[t(652)](i){const s=t;(0,e._c)(this[s(1792)]),this[s(1792)].length=0,this[s(1324)]((0,e.Lw)(document[s(816)],s(1621),(t=>this[s(647)].fire(t)))),this.register((0,e.Lw)(document[s(816)],s(1149),(t=>this[s(1099)].fire(t)))),this[s(1324)]((0,e.Lw)(i,"pointerdown",(t=>{const n=s;i[n(1689)](t.pointerId),this[n(764)]=(0,e.Lw)(i,n(1799),(t=>this._onPointerDownMove[n(443)](t))),this[n(1750)][n(443)](t)}))),this[s(1324)]((0,e.Lw)(i,s(747),(t=>{const e=s;i[e(1671)](t[e(493)]),this[e(764)]?.[e(980)](),this[e(764)]=void 0,this[e(782)][e(443)](t)}))),this[s(1324)]((0,e.Lw)(i,"contextmenu",(t=>t[s(787)]()))),this[s(1324)]((0,e.Lw)(i,s(1799),(t=>this[s(635)][s(443)](t)))),this[s(1324)]((0,e.Lw)(i,s(609),(t=>this[s(1198)][s(443)](t)),{passive:!0}))}}var it=i(6374);class st extends e.JT{constructor(){const e=t;super(...arguments),this[e(906)]=new Float32Array([255,255,255,255]),this[e(1441)]=new Float32Array([0,0,0,255]),this[e(299)]=this.register(new n.v),this.onUpdate=this[e(299)].event}get primary(){return this[t(906)]}set[t(1865)](e){const i=t;this[i(683)](e),!(0,it.W)(this.primary,e)&&(this[i(906)]=e,this[i(299)].fire())}get[t(1060)](){return this[t(1441)]}set[t(1060)](e){const i=t;this._validate(e),!(0,it.W)(this[i(1060)],e)&&(this[i(1441)]=e,this[i(299)].fire())}[t(1123)](){const e=t,i=this[e(1441)];this[e(1441)]=this[e(906)],this[e(906)]=i,this[e(299)].fire()}[t(483)](e,i){const s=t;this._validate(e),this[s(683)](i),(!(0,it.W)(this[s(1865)],e)||!(0,it.W)(this[s(1060)],i))&&(this[s(906)]=e,this[s(1441)]=i,this[s(299)].fire())}[t(1653)](e){const i=t;return 1&e.buttons?this[i(1865)]:2&e[i(750)]?this.secondary:void 0}[t(230)](e){const i=t;return 1&e.buttons?[this[i(1865)],this[i(1060)]]:[this.secondary,this[i(1865)]]}[t(683)](e){if(4!==e[t(1225)])throw new Error("Could not set color to array of length smaller than 4")}}let nt=Float32Array;function ot(t,e,i,s,n,o,r=new nt(16)){return r[0]=2/(e-t),r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2/(s-i),r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2/(n-o),r[11]=0,r[12]=(t+e)/(t-e),r[13]=(i+s)/(i-s),r[14]=(n+o)/(n-o),r[15]=1,r}function rt(t,e,i,s,n=new nt(16)){var o=t[0],r=t[1],a=t[2],h=t[3],c=t[4],l=t[5],d=t[6],u=t[7],m=t[8],g=t[9],f=t[10],p=t[11],y=t[12],_=t[13],w=t[14],v=t[15];return t!==n&&(n[0]=o,n[1]=r,n[2]=a,n[3]=h,n[4]=c,n[5]=l,n[6]=d,n[7]=u,n[8]=m,n[9]=g,n[10]=f,n[11]=p),n[12]=o*e+c*i+m*s+y,n[13]=r*e+l*i+g*s+_,n[14]=a*e+d*i+f*s+w,n[15]=h*e+u*i+p*s+v,n}const at=[0,0,0,1,1,0,1,0,0,1,1,1];function ht(e,i,s){const n=t,o=e[n(579)]();if(e[n(1677)](o,lt(ct(e,e.VERTEX_SHADER,i))),e[n(1677)](o,lt(ct(e,e[n(244)],s))),e[n(1782)](o),e[n(207)](o,e[n(1709)]))return o;console.error(e[n(281)](o)),e[n(1532)](o)}function ct(e,i,s){const n=t,o=lt(e.createShader(i));if(e[n(1108)](o,s),e.compileShader(o),e[n(413)](o,e[n(264)]))return o;console[n(1583)](e[n(449)](o),{source:s}),e[n(618)](o)}function lt(e){if(!e)throw new Error(t(1173));return e}function dt(){return[new Float32Array(16),new Float32Array(16)]}function ut(e,i,s,n,o){const r=t;ot(0,e[r(1028)][r(1564)],e.canvas[r(918)],0,-1,1,o[0]),rt(o[0],Math[r(827)](e[r(1028)][r(1564)]/2)-s[r(1564)]/2*n.zoom+n.x*n.zoom,Math[r(827)](e[r(1028)].height/2)-s.height/2*n.zoom+n.y*n[r(1150)],0,o[1]),e[r(1280)](i,!1,o[1])}function mt(e,i=e.canvas[t(1564)],s=e[t(1028)][t(918)]){const n=t,o=lt(e[n(1466)]());return e[n(1347)](e[n(1104)],o),e.texParameteri(e[n(1104)],e.TEXTURE_WRAP_S,e[n(1447)]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e[n(1447)]),e[n(462)](e.TEXTURE_2D,e[n(273)],e[n(360)]),e[n(462)](e[n(1104)],e.TEXTURE_MAG_FILTER,e[n(360)]),e[n(1826)](e[n(1104)],0,e[n(376)],i,s,0,e[n(376)],e[n(1529)],null),o}const gt=t(1332)+0+t(216)+t(621)+t(186)+"u_matrix"+t(1597);class ft extends e.JT{constructor(e,i,s){const n=t;super(),this[n(426)]=e,this._imageService=i,this[n(1547)]=s,this[n(835)]=2,this[n(217)]=new Float32Array(8),this[n(900)]=dt(),this[n(300)]=!0,this[n(1700)]=!0;const o=this[n(426)];this[n(446)]=lt(ht(o,gt,"#version 300 es\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = vec4(0, 0, 0, 1);\n}")),this[n(1817)]=lt(o.createVertexArray()),o[n(553)](this[n(1817)]),this._positionBuffer=lt(o[n(1391)]()),this[n(1723)]=lt(o[n(1788)](this[n(446)],n(621))),o[n(569)](o[n(1429)],this[n(1253)]),o[n(1004)](0),o[n(486)](0,2,o[n(989)],!1,0,0),this[n(1324)](this[n(447)][n(699)]((()=>{const t=n;this[t(300)]=!0,this[t(1700)]=!0}))),this.register(this[n(1547)][n(1496)]((()=>{this[n(1700)]=!0,this._positionsNeedsUpdate=!0})))}[t(506)](){const e=t,i=this[e(447)].currentLayer;if(!i)return;const s=this[e(426)];s[e(428)](this[e(446)]),s[e(553)](this[e(1817)]),this[e(1321)](s,i,this[e(1547)]),this[e(757)](s,i,this[e(1547)]),s[e(1402)](s[e(852)],0,4)}[t(1321)](e,i,s){const n=t;this[n(300)]&&(e[n(553)](this[n(1817)]),e.bindBuffer(e[n(1429)],this[n(1253)]),this[n(217)][0]=this._positionsArray[2]=-.5,this[n(217)][1]=this._positionsArray[7]=-.5,this[n(217)][4]=this._positionsArray[6]=i.width*s.zoom+.5,this._positionsArray[3]=this._positionsArray[5]=i[n(918)]*s[n(1150)]+.5,e[n(793)](e.ARRAY_BUFFER,this[n(217)],e[n(1851)]),this[n(300)]=!1)}[t(757)](e,i,s){const n=t;this[n(1700)]&&(ut(e,this._matrixLocation,i,s,this._workMatrices),this[n(1700)]=!1)}}var pt=i(3318),yt=i.n(pt),_t=i(3716),wt=i.n(_t),vt=i(4738),bt=i.n(vt),xt=i(7542),It=i.n(xt),St=i(98),Et=i.n(St),Ct=i(7034),Lt=i.n(Ct);const Tt=new Map([["normal",1],[t(1243),3],["multiply",4],[t(1221),6],[t(1132),8],[t(1088),9],[t(1454),11],["overlay",13],["softLight",14],["difference",20],["exclusion",21]]),At=new Int32Array([0,1,2,3,4,5,6]);let Rt=0;class Dt extends e.JT{constructor(e,i,s,n){const o=t;super(),this[o(426)]=e,this._imageService=i,this[o(938)]=s,this[o(1547)]=n,this[o(835)]=1,this[o(1401)]=[],this._needsAttributeUpdate=!1,this[o(1493)]=new Map,this[o(1039)]=new Float32Array(2),this._uniformValueBlendModes=new Int32Array(8);const r=this[o(426)];this[o(446)]=lt(ht(r,wt(),yt())),this[o(1817)]=lt(r[o(1567)]()),r[o(553)](this[o(1817)]),0===Rt&&(Rt=r[o(721)](r[o(1504)]));const a=r[o(345)](this[o(446)],o(1180));this._positionBuffer=lt(r[o(1391)]()),r[o(569)](r.ARRAY_BUFFER,this._positionBuffer),r.bufferData(r[o(1429)],new Float32Array(at),r[o(1851)]),r[o(1004)](a),r[o(486)](a,2,r[o(989)],!1,0,0);const h=r[o(345)](this._program,o(823));this[o(182)]=lt(r[o(1391)]()),r[o(569)](r.ARRAY_BUFFER,this[o(182)]),r[o(793)](r.ARRAY_BUFFER,new Float32Array(at),r[o(1851)]),r[o(1004)](h),r.vertexAttribPointer(h,2,r.FLOAT,!1,0,0),this[o(1840)]=lt(r[o(1788)](this._program,"a")),this[o(681)]=lt(r[o(1788)](this._program,"b")),this[o(1070)]=lt(r[o(1788)](this[o(446)],"c")),this[o(1170)]=lt(r[o(1788)](this[o(446)],"l")),this._frameBufferUniformLocation=lt(r.getUniformLocation(this[o(446)],"n")),this[o(1652)]=lt(r[o(1788)](this[o(446)],"m")),this[o(1055)]=lt(r[o(1788)](this[o(446)],"h")),this[o(1244)]=lt(r[o(1788)](this[o(446)],"d")),this[o(368)]=lt(r[o(1788)](this[o(446)],"f")),this._imageDimensionsUniformLocation=lt(r[o(1788)](this[o(446)],"g")),this[o(592)]=lt(r[o(1788)](this._program,"j")),this._isStencilUniformLocation=lt(r[o(1788)](this[o(446)],"k")),this[o(1408)]=lt(r[o(1788)](this._program,"o")),this._frameBuffer=lt(r[o(201)]()),this[o(1787)]=lt(r[o(1466)]()),r.activeTexture(r[o(331)]),r[o(1347)](r[o(1104)],this._nullTexture),r[o(462)](r[o(1104)],r[o(273)],r.LINEAR),r[o(462)](r[o(1104)],r[o(568)],r.NEAREST),r[o(462)](r[o(1104)],r[o(961)],r.CLAMP_TO_EDGE),r[o(462)](r[o(1104)],r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r[o(1104)],0,r.RGBA,1,1,0,r[o(376)],r[o(1529)],new Uint8Array([255,255,255,255])),this[o(1324)](this[o(447)][o(1496)]((t=>this[o(220)]=t||!0))),this[o(1324)](this[o(447)][o(699)]((()=>{const t=o;this[t(220)]=!0,this[t(1607)]()}))),this[o(1324)](this._viewportService[o(1563)]((()=>{this[o(1607)]()}))),this[o(1321)](),this[o(1607)](),this._updateUniformValueMatrix()}resize(){const e=t,i=this[e(426)];for(;this[e(1401)][e(1225)]>0;)i.deleteTexture(this[e(1401)][e(700)]());this[e(1650)]&&(i[e(497)](this[e(1650)]),this._frameBufferRenderBuffer=void 0),this[e(257)]?.[e(178)](),this._rectangleShader?.resize(),this[e(1593)]()}[t(506)](){const e=t,i=this[e(447)][e(574)];if(0===i.length)return;this[e(220)]&&(!0===this[e(220)]?this[e(1321)]():this[e(1321)](this[e(220)]));const n=this[e(426)];n[e(428)](this[e(446)]),n[e(553)](this[e(1817)]),n.bindFramebuffer(n.FRAMEBUFFER,null),n.disable(n[e(1494)]);const o=this[e(1547)],r=this[e(447)];let a=-1,h=null;const c=[],l=[],d=[],u=[];let m=!1;for(const t of i){if(!t[e(804)])continue;const i=this[e(1493)][e(1375)](t.id);if(i){const o=t===this[e(447)][e(381)];let r;o?r=l:m?((0===u[e(1225)]||7===u[u[e(1225)]-1][0].length)&&u.push([]),r=u[u[e(1225)]-1]):((0===c.length||7===c[c[e(1225)]-1][0].length)&&c[e(1686)]([]),r=c[c[e(1225)]-1]);for(let t=0;t<i[e(542)].length;t++)!r[t]&&(r[t]=[]),r[t][e(1686)](i.tiles[t]);if(o&&(m=!0,t[e(1705)]?.[e(352)]===e(1076)&&t[e(1705)][e(292)][e(1020)][e(1085)])){const i=t[e(1705)];if(this[e(1729)]?.[e(1705)]!==i){if(this._cachedMovingLayer?.renderLayer){for(const t of this._cachedMovingLayer.renderLayer.tiles)n[e(585)](t.texture);this[e(1729)]=void 0}const t=(i[e(684)]?.[e(1085)]?i.scaledImage?.resource:void 0)||i.staticState.image[e(272)],o=lt(n[e(1466)]());n[e(1105)](n.TEXTURE0+0),n[e(1347)](n[e(1104)],o),n[e(462)](n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n[e(1218)]),n[e(462)](n.TEXTURE_2D,n[e(568)],n[e(360)]),n[e(462)](n.TEXTURE_2D,n.TEXTURE_WRAP_S,n[e(1447)]),n[e(462)](n.TEXTURE_2D,n.TEXTURE_WRAP_T,n[e(1447)]),n[e(1826)](n[e(1104)],0,n[e(376)],t[e(1564)],t[e(918)],0,n[e(376)],n[e(1529)],t[e(356)]),this[e(1729)]={temporaryLayer:i,renderLayer:{tiles:[{blendMode:Tt[e(1375)](this._imageService.currentLayer[e(795)]),texture:o,textureImage:t,range:(0,s.DI)(t[e(1564)],t.height),width:t.width,height:t[e(918)],scaledWidth:i.currentState[e(1756)],scaledHeight:i[e(1115)][e(507)],offsetX:i[e(1115)][e(1575)],offsetY:i[e(1115)].offsetY,flipX:i.currentState.flipX,flipY:i[e(1115)][e(1090)]}]}}}else{const t=this[e(1729)][e(1259)][e(542)][0];if(t.offsetX=i.currentState[e(1575)],t[e(680)]=i.currentState[e(680)],t.flipX=i.currentState[e(1665)],t[e(1090)]=i[e(1115)][e(1090)],t[e(795)]=Tt[e(1375)](this[e(447)][e(381)][e(795)]),t[e(1756)]=i[e(1115)][e(1756)],t[e(507)]=i[e(1115)][e(507)],i[e(684)]?.[e(1085)]&&t[e(1219)]!==i[e(684)][e(272)]){n[e(585)](t[e(894)]);const s=lt(n[e(1466)]());n.activeTexture(n[e(331)]+0),n[e(1347)](n[e(1104)],s),n[e(462)](n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n[e(1218)]),n[e(462)](n[e(1104)],n[e(568)],n[e(360)]),n[e(462)](n[e(1104)],n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n[e(462)](n[e(1104)],n[e(730)],n[e(1447)]),n[e(1826)](n[e(1104)],0,n.RGBA,i.scaledImage.resource[e(1564)],i[e(684)].resource.height,0,n[e(376)],n[e(1529)],i.scaledImage[e(272)][e(356)]),t[e(894)]=s,t[e(1219)]=i.scaledImage[e(272)]}}0!==this[e(1729)][e(1259)].tiles[0][e(507)]&&0!==this._cachedMovingLayer.renderLayer[e(542)][0][e(1756)]&&d.push(this._cachedMovingLayer[e(1259)][e(542)])}}}const g=[];g.push(...c),l.length>0&&g[e(1686)](l),d[e(1225)]>0&&g[e(1686)](d),g[e(1686)](...u);for(const[t,i]of g[e(403)]()){let s;if(t<g.length-1?(s=this[e(573)](n,++a),n[e(1251)](n.FRAMEBUFFER,this[e(322)]),n.framebufferTexture2D(n[e(1393)],n[e(1257)],n[e(1104)],s,0)):n.bindFramebuffer(n[e(1393)],null),i===l&&this[e(447)].currentLayer[e(1705)]?.[e(352)]===e(615)){const c=this[e(447)][e(381)][e(1705)];!s&&(s=this[e(573)](n,++a),n[e(1251)](n[e(1393)],this[e(322)]),n[e(1800)](n[e(1393)],n.COLOR_ATTACHMENT0,n[e(1104)],s,0)),this[e(1538)](n,i,!1,!1,r,o),n[e(1347)](n[e(1104)],null),!this[e(1139)]&&(this[e(1139)]=new Bt(n,this._viewportService));const l=Tt[e(1375)](c[e(1115)].blendMode),d=c[e(1191)](),u=this[e(1139)][e(781)](this._imageService[e(381)],d);!this[e(257)]&&(this[e(257)]=new Mt(n)),t<g[e(1225)]-1?(s=this[e(257)][e(1026)](s,u,l),h&&(s=this[e(257)][e(1026)](h,s,i[0][0][e(795)]))):h?(s=this[e(257)][e(1026)](s,u,l),this[e(257)][e(1026)](h,s,i[0][0][e(795)],!1)):this._blendShader.blend(s,u,l,!1),n[e(428)](this[e(446)]),n.bindVertexArray(this[e(1817)])}else i===l&&d.length>0?(n[e(1105)](n[e(331)]+7),n[e(1347)](n[e(1104)],h||this._nullTexture),this[e(1650)]?n.bindRenderbuffer(n[e(334)],this[e(1650)]):(this._frameBufferRenderBuffer=lt(n.createRenderbuffer()),n[e(570)](n.RENDERBUFFER,this._frameBufferRenderBuffer),n[e(532)](n[e(334)],n[e(1367)],n[e(1028)][e(1564)],n[e(1028)][e(918)])),n[e(438)](n.FRAMEBUFFER,n[e(1795)],n[e(334)],this[e(1650)]),n.clear(n[e(1258)]|n.DEPTH_BUFFER_BIT|n[e(212)]),n.enable(n[e(1722)]),n.stencilFunc(n.ALWAYS,1,255),n[e(1195)](n[e(865)],n.KEEP,n[e(1156)]),n[e(452)](!1,!1,!1,!1),this[e(1538)](n,d,!1,!0,r,o),n[e(1551)](n[e(1580)],1,255),n[e(1195)](n[e(865)],n[e(865)],n[e(865)]),n.colorMask(!0,!0,!0,!0),this[e(1538)](n,i,!1,!1,r,o),n[e(1347)](n[e(1104)],null),n[e(590)](n[e(1722)]),h&&(n[e(438)](n[e(1393)],n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,null),n[e(570)](n[e(334)],null),!this._blendShader&&(this[e(257)]=new Mt(n)),s=this._blendShader.blend(h,s,i[0][0][e(795)]),n[e(428)](this[e(446)]),n.bindVertexArray(this[e(1817)]))):(n[e(1105)](n[e(331)]+7),n[e(1347)](n.TEXTURE_2D,h||this[e(1787)]),this[e(1538)](n,i,!!h,!1,r,o),n[e(1347)](n[e(1104)],null));s&&(h=s)}}[t(573)](e,i){const s=t;for(;this[s(1401)].length<i+1;)this._frameBufferTextures[s(1686)](mt(e));return this._frameBufferTextures[i]}[t(1538)](e,i,s,n,o,r){const a=t,h=new Float32Array(16),c=Math[a(827)](e[a(1028)][a(1564)]/2)-o[a(1564)]/2*r.zoom+r.x*r[a(1150)],l=Math[a(827)](e.canvas.height/2)-o.height/2*r[a(1150)]+r.y*r[a(1150)];for(const t of i){const i=t[0];rt(this[a(1725)],c+i.range.left*r[a(1150)],l+i[a(1707)][a(1082)]*r[a(1150)],0,h),e[a(234)](this[a(1170)],e[a(1028)][a(1564)],e.canvas.height),e.uniform1i(this[a(1743)],7),e[a(703)](this[a(1652)],s?1:0),e[a(1280)](this._matrixUniformLocation,!1,h),e[a(1040)](this._layerTexturesUniformLocation,At),e[a(234)](this._zoomLocation,this[a(1039)][0],this[a(1039)][1]);let d=0;for(;d<t[a(1225)];d++)this[a(1436)][d]=t[d][a(795)],e[a(1105)](e.TEXTURE0+d),e[a(1347)](e[a(1104)],t[d][a(894)]);for(;d<=6;d++)e.activeTexture(e.TEXTURE0+d),e[a(1347)](e.TEXTURE_2D,this[a(1787)]);e[a(1040)](this._layerBlendModesUniformLocation,this[a(1436)]),e[a(703)](this._layerCountUniformLocation,t.length),e[a(234)](this[a(1244)],i.offsetX||0,i.offsetY||0),e.uniform2f(this._tileScaledDimensionsUniformLocation,i[a(1756)]??i[a(1564)],i[a(507)]??i.height),e.uniform2f(this._imageDimensionsUniformLocation,o[a(1564)],o[a(918)]),e[a(703)](this._isStencilUniformLocation,n?1:0),e.uniform2f(this[a(1408)],i[a(1665)]?1:0,i.flipY?1:0),e[a(1402)](e.TRIANGLES,0,6)}}[t(1321)](e){const i=t;if(0===this[i(447)][i(574)][i(1225)])return;this[i(220)]=!1;const s=this[i(426)];s[i(553)](this._vertexArrayObject);for(const t of this[i(447)].layers)this._updateAttributeBuffersForLayer(s,t,e)}_updateAttributeBuffersForLayer(e,i,s){const n=t;e[n(553)](this._vertexArrayObject);let o=this._renderLayers[n(1375)](i.id);!o&&(o={tiles:[]},this[n(1493)][n(971)](i.id,o)),this[n(1122)](e,o,i,s)}[t(1122)](e,i,n,o){const r=t,a=n.width,h=Math[r(1297)](n[r(918)]/128);let c=0;i.tiles.length=h;for(let t=0;t<h;t++){const l=c,d=Math[r(827)](n[r(918)]/h*(t+1)),u=d-c;c=d;const m={top:l,bottom:d,left:0,right:a};if(i[r(542)][t]){if(o&&!(0,s.b8)(o,m))continue;e[r(585)](i[r(542)][t][r(894)])}const g=lt(e[r(1466)]());i.tiles[t]={width:a,height:u,range:m,texture:g,blendMode:Tt[r(1375)](n[r(795)])||1},n[r(1575)]&&(i[r(542)][t][r(1575)]=n[r(1575)]),n.offsetY&&(i[r(542)][t].offsetY=n[r(680)]),e[r(1105)](e[r(331)]+0),e.bindTexture(e[r(1104)],g),e[r(462)](e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e[r(462)](e.TEXTURE_2D,e[r(568)],e[r(360)]),e.texParameteri(e[r(1104)],e.TEXTURE_WRAP_S,e[r(1447)]),e.texParameteri(e[r(1104)],e[r(730)],e[r(1447)]),e[r(1826)](e[r(1104)],0,e[r(376)],a,u,0,e[r(376)],e[r(1529)],n[r(356)],l*n[r(1564)]*4)}}[t(1607)](){const e=t;this[e(1039)][0]=this[e(1547)].zoom*this[e(447)][e(1564)],this[e(1039)][1]=this[e(1547)][e(1150)]*this[e(447)][e(918)]}_updateUniformValueMatrix(){const e=t;this[e(1725)]=ot(0,this[e(426)].canvas[e(1564)],this[e(426)][e(1028)][e(918)],0,-1,1)}}class Mt{constructor(e){const i=t;this[i(426)]=e;const s=this._gl;this[i(446)]=lt(ht(s,It(),bt())),this[i(1817)]=lt(s[i(1567)]()),s[i(553)](this[i(1817)]),this._frameBuffer=lt(s[i(201)]()),this[i(228)]=mt(s),s[i(1251)](s[i(1393)],this[i(322)]);const n=s[i(1391)]();s[i(569)](s.ARRAY_BUFFER,n),s.bufferData(s.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,-1,-1,1,1,1]),s[i(1851)]),s[i(1004)](0),s[i(486)](0,2,s[i(989)],!1,0,0),this._textureAUniformLocation=lt(s[i(1788)](this._program,"b")),this._textureBUniformLocation=lt(s[i(1788)](this[i(446)],"c")),this[i(833)]=lt(s[i(1788)](this[i(446)],"a"))}[t(1026)](e,i,s,n=!0){const o=t,r=this[o(426)];return r[o(428)](this[o(446)]),r[o(553)](this[o(1817)]),n?(r[o(1251)](r[o(1393)],this._frameBuffer),r[o(1800)](r[o(1393)],r[o(1257)],r[o(1104)],this[o(228)],0)):r[o(1251)](r[o(1393)],null),r.activeTexture(r[o(331)]),r[o(1347)](r.TEXTURE_2D,e),r.uniform1i(this[o(1748)],0),r.activeTexture(r[o(331)]+1),r[o(1347)](r[o(1104)],i),r[o(703)](this._textureBUniformLocation,1),r[o(703)](this[o(833)],s),r[o(1402)](r[o(199)],0,6),r.activeTexture(r[o(331)]),r[o(1347)](r[o(1104)],null),r.activeTexture(r[o(331)]+1),r[o(1347)](r[o(1104)],null),r[o(1251)](r[o(1393)],null),this._frameBufferTexture}[t(178)](){const e=t;this._gl[e(585)](this[e(228)]),this._frameBufferTexture=mt(this[e(426)])}}class Bt{constructor(e,i){const s=t;this._gl=e,this[s(1547)]=i,this._workMatrices=dt();const n=this[s(426)];this[s(446)]=lt(ht(n,Lt(),Et())),this[s(1817)]=lt(n[s(1567)]()),n[s(553)](this[s(1817)]),this._colorUniformLocation=lt(n[s(1788)](this._program,"c")),this._matrixUniformLocation=lt(n[s(1788)](this[s(446)],"a")),this._zoomUniformLocation=lt(n[s(1788)](this[s(446)],"b")),this._frameBuffer=lt(n.createFramebuffer()),this[s(228)]=mt(n),n[s(1251)](n[s(1393)],this[s(322)]),this[s(1140)]=lt(n.createBuffer()),n[s(569)](n[s(1429)],this[s(1140)]),n[s(1004)](0),n.vertexAttribPointer(0,2,n[s(989)],!1,0,0)}[t(781)](e,i){const s=t,n=this._gl;n[s(428)](this[s(446)]),n.bindVertexArray(this[s(1817)]),n[s(1251)](n.FRAMEBUFFER,this[s(322)]),n.framebufferTexture2D(n[s(1393)],n.COLOR_ATTACHMENT0,n[s(1104)],this[s(228)],0),n.clear(n.COLOR_BUFFER_BIT),ut(n,this[s(1840)],e,this[s(1547)],this._workMatrices),n[s(234)](this[s(965)],this._viewportService[s(1150)],this[s(1547)].zoom);for(const t of i){n.uniform4f(this[s(1223)],t[s(513)][0]/255,t[s(513)][1]/255,t[s(513)][2]/255,t[s(513)][3]/255),n[s(569)](n[s(1429)],this[s(1140)]);const e=new Float32Array(12*t.ranges.length);for(let i=0;i<t.ranges[s(1225)];i++){const n=t[s(1e3)][i],o=12*i;e[o]=e[o+2]=e[o+8]=n[s(707)],e[o+1]=e[o+5]=e[o+7]=n[s(1082)],e[o+4]=e[o+6]=e[o+10]=n[s(895)],e[o+3]=e[o+9]=e[o+11]=n[s(799)]}n[s(793)](n[s(1429)],e,n.DYNAMIC_DRAW),n[s(1402)](n[s(199)],0,e[s(1225)]/2)}return this[s(228)]}resize(){const e=t;this._gl[e(585)](this._frameBufferTexture),this[e(228)]=mt(this[e(426)])}}const kt=t(1332)+0+t(216)+t(621)+t(186)+t(621)+t(1597),Pt="#version 300 es\nprecision mediump float;\n\nuniform vec4 "+t(495)+";\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = "+t(495)+";\n}";class Ut extends e.JT{constructor(e,i,s){const n=t;super(),this[n(426)]=e,this[n(447)]=i,this[n(1547)]=s,this[n(835)]=2,this[n(217)]=new Float32Array(48),this[n(900)]=dt(),this[n(300)]=!0,this._matrixNeedsUpdate=!0,this[n(1182)]=new Float32Array(4);const o=this[n(426)];this[n(446)]=lt(ht(o,kt,Pt)),this[n(1817)]=lt(o[n(1567)]()),o[n(553)](this._vertexArrayObject),this[n(1253)]=lt(o[n(1391)]()),this[n(1432)]=lt(o[n(1788)](this[n(446)],n(495))),this[n(1723)]=lt(o[n(1788)](this[n(446)],"u_matrix")),this.refreshTheme(),o.bindBuffer(o[n(1429)],this[n(1253)]),o[n(1004)](0),o[n(486)](0,2,o[n(989)],!1,0,0),this[n(1324)](this[n(447)].onChangedDimensions((()=>{const t=n;this._positionsNeedsUpdate=!0,this[t(1700)]=!0}))),this[n(1324)](this[n(1547)][n(1496)]((()=>{const t=n;this[t(1700)]=!0,this[t(300)]=!0})))}refreshTheme(){const e=t,i=function(e){const i=t;switch(e.length){case 7:return(parseInt(e[i(1006)](1),16)<<8|255)>>>0;case 9:return parseInt(e[i(1006)](1),16)>>>0}throw new Error(i(972))}(window[e(994)](document.documentElement)[e(1141)](e(1625))||e(1678));this._backgroundColor[0]=(i>>24&255)/255,this[e(1182)][1]=(i>>16&255)/255,this._backgroundColor[2]=(i>>8&255)/255,this._backgroundColor[3]=(255&i)/255}[t(506)](){const e=t,i=this[e(447)][e(381)];if(!i)return;const s=this._gl;s[e(428)](this[e(446)]),s[e(553)](this._vertexArrayObject),s.disable(s[e(1494)]),s[e(565)](this[e(1432)],this[e(1182)][0],this[e(1182)][1],this._backgroundColor[2],this[e(1182)][3]),this[e(1321)](s,i,this._viewportService),this[e(757)](s,i,this._viewportService),s[e(1402)](s.TRIANGLE_STRIP,0,24)}_updateAttributeBuffers(e,i,s){const n=t;if(!this[n(300)])return;e[n(553)](this._vertexArrayObject),e[n(569)](e[n(1429)],this._positionBuffer);const o=this[n(1842)](),r=this[n(217)];r[0]=r[2]=r[36]=r[38]=r[40]=r[44]=o[n(707)],r[4]=r[6]=r[32]=r[34]=r[42]=r[46]=0,r[8]=r[10]=r[18]=r[22]=r[26]=r[28]=r[30]=i[n(1564)]*s[n(1150)],r[12]=r[14]=r[16]=r[20]=r[24]=o[n(895)],r[1]=r[5]=r[9]=r[13]=o[n(1082)],r[3]=r[7]=r[11]=r[15]=r[17]=r[19]=r[45]=r[47]=0,r[21]=r[23]=r[31]=r[35]=r[39]=r[41]=r[43]=i[n(918)]*s[n(1150)],r[25]=r[27]=r[29]=r[33]=r[37]=o[n(799)],e[n(793)](e[n(1429)],this[n(217)],e[n(1851)]),this._positionsNeedsUpdate=!1}[t(757)](e,i,s){const n=t;this[n(1700)]&&(ut(e,this._matrixLocation,i,s,this[n(900)]),this[n(1700)]=!1)}[t(1842)](){const e=t,i=this[e(1846)](-1,-1),s=this[e(1846)](this[e(426)][e(1028)].width,this[e(426)][e(1028)].height);return{left:i[0],top:i[1],right:s[0],bottom:s[1]}}[t(1846)](e,i){const s=t,n=this[s(426)];let o=e-n[s(1028)][s(1564)]/2,r=i-n[s(1028)][s(918)]/2;return o+=this[s(447)][s(1564)]*this[s(1547)][s(1150)]/2,r+=this[s(447)][s(918)]*this._viewportService[s(1150)]/2,o-=this._viewportService.x*this[s(1547)].zoom,r-=this[s(1547)].y*this[s(1547)][s(1150)],[o,r]}}const Ft=t(1332)+0+t(216)+t(621)+t(584)+t(621)+t(952),Nt=t(358)+"u_pixelsize;\n\nin vec2 v_position;\n\nout vec4 outColor;\n\nvoid main() {\n  if (mod(v_position.x / u_pixelsize"+t(271)+t(1715)+t(223)+t(1715)+t(271)+"u_pixelsize"+t(831);class Ot extends e.JT{constructor(e,i,s){const n=t;super(),this[n(426)]=e,this._imageService=i,this._viewportService=s,this[n(835)]=2,this[n(217)]=new Float32Array(8),this[n(900)]=dt(),this[n(300)]=!0,this[n(1700)]=!0;const o=this[n(426)];this._program=lt(ht(o,Ft,Nt)),this[n(1817)]=lt(o[n(1567)]()),o[n(553)](this._vertexArrayObject),this._positionBuffer=lt(o.createBuffer()),this[n(1723)]=lt(o[n(1788)](this[n(446)],"u_matrix")),this[n(1047)]=lt(o.getUniformLocation(this[n(446)],"u_pixelsize")),o[n(569)](o.ARRAY_BUFFER,this[n(1253)]),o[n(1004)](0),o[n(486)](0,2,o.FLOAT,!1,0,0),this[n(1324)](this[n(447)][n(699)]((()=>{const t=n;this[t(300)]=!0,this[t(1700)]=!0}))),this[n(1324)](this[n(1547)].onUpdate((()=>{const t=n;this[t(1700)]=!0,this[t(300)]=!0})))}[t(506)](){const e=t,i=this[e(447)].currentLayer;if(!i)return;if(!this._viewportService[e(1308)]||this[e(1547)].zoom<4)return;const s=this._gl;s[e(428)](this[e(446)]),s[e(553)](this[e(1817)]),s[e(976)](s[e(1494)]),s[e(1517)](s.SRC_ALPHA,s[e(176)],s.ONE,s[e(176)]),this[e(1321)](s,i,this[e(1547)]),this[e(757)](s,i,this[e(1547)]),s[e(1781)](this[e(1047)],this[e(1547)].zoom/1),s[e(1402)](s[e(1298)],0,4)}_updateAttributeBuffers(e,i,s){const n=t;this[n(300)]&&(e[n(553)](this._vertexArrayObject),e[n(569)](e[n(1429)],this[n(1253)]),this._positionsArray[4]=this[n(217)][6]=i[n(1564)]*s[n(1150)],this[n(217)][3]=this[n(217)][5]=i[n(918)]*s[n(1150)],e[n(793)](e[n(1429)],this[n(217)],e[n(1851)]),this._positionsNeedsUpdate=!1)}_updateMatrixUniform(e,i,s){const n=t;this[n(1700)]&&(ut(e,this[n(1723)],i,s,this[n(900)]),this[n(1700)]=!1)}}const Vt=t(1332)+0+") in vec4 a_position;\n\nuniform mat4 u_matrix"+t(186)+t(621)+t(1597),Ht=t(358)+t(514)+t(603)+t(514)+t(1073);class zt extends e.JT{constructor(e,i,s,o){const r=t;super(),this[r(426)]=e,this[r(447)]=i,this._selectionService=s,this._viewportService=o,this[r(835)]=2,this[r(217)]=new Float32Array(8),this[r(900)]=dt(),this[r(300)]=!1,this[r(1700)]=!0,this[r(1531)]=0,this[r(1492)]=!1,this._onStartAnimating=this[r(1324)](new n.v),this[r(1329)]=this._onStartAnimating[r(1545)],this._onStopAnimating=this[r(1324)](new n.v),this[r(1663)]=this._onStopAnimating[r(1545)];const a=this[r(426)];this[r(446)]=lt(ht(a,Vt,Ht)),this[r(1817)]=lt(a.createVertexArray()),a[r(553)](this[r(1817)]),this[r(1253)]=lt(a.createBuffer()),this[r(1723)]=lt(a[r(1788)](this[r(446)],r(621))),this._shiftLocation=lt(a[r(1788)](this[r(446)],r(514))),a.bindBuffer(a[r(1429)],this[r(1253)]),a[r(1004)](0),a.vertexAttribPointer(0,2,a[r(989)],!1,0,0),this.register(this._selectionService[r(1496)]((()=>{const t=r;this[t(300)]=!0,this._isAnimating!==!!this._selectionService[t(1707)]&&(this[t(1492)]=!!this[t(938)][t(1707)],this[t(1492)]?this[t(511)].fire():this[t(1643)][t(443)]())}))),this[r(1324)](this[r(447)][r(699)]((()=>{const t=r;this._matrixNeedsUpdate=!0,this[t(300)]=!0}))),this[r(1324)](this._viewportService[r(1496)]((()=>{const t=r;this._matrixNeedsUpdate=!0,this[t(300)]=!0})))}[t(506)](){const e=t,i=this[e(447)][e(381)];if(!i)return;const s=this[e(938)][e(1707)];if(!s)return;const n=this[e(426)];n[e(428)](this[e(446)]),n[e(553)](this[e(1817)]),n[e(976)](n[e(1494)]),n[e(341)](n[e(889)],n[e(176)]),this[e(1321)](n,s,this._viewportService),this[e(757)](n,i,this[e(1547)]),n[e(1402)](n[e(852)],0,4)}[t(978)](){const e=t;this._updateShiftUniform(this[e(426)])}[t(1321)](e,i,s){const n=t;this[n(300)]&&(e[n(553)](this[n(1817)]),e[n(569)](e[n(1429)],this[n(1253)]),this._positionsArray[0]=this[n(217)][2]=i[n(707)]*s[n(1150)]-.5,this._positionsArray[4]=this[n(217)][6]=i.right*s[n(1150)]+.5,this[n(217)][1]=this[n(217)][7]=i[n(1082)]*s[n(1150)]-.5,this._positionsArray[3]=this._positionsArray[5]=i[n(799)]*s[n(1150)]+.5,e[n(793)](e[n(1429)],this[n(217)],e[n(1851)]),this[n(300)]=!1)}[t(757)](e,i,s){const n=t;this[n(1700)]&&(ut(e,this[n(1723)],i,s,this[n(900)]),this._matrixNeedsUpdate=!1)}_updateShiftUniform(e){const i=t;e.useProgram(this[i(446)]),e[i(553)](this[i(1817)]),this[i(1531)]=(this[i(1531)]+1)%8,e[i(1781)](this[i(302)],this._shiftValue)}}const Wt=t(1332)+0+t(216)+t(621)+";\n\nvoid main() {\n  gl_Position = "+t(621)+t(1597);class jt extends e.JT{constructor(e,i,s,n,o){const r=t;super(),this._gl=e,this._imageService=i,this[r(938)]=s,this[r(1570)]=n,this[r(1547)]=o,this[r(835)]=2,this[r(1412)]=new Float32Array(8),this[r(900)]=dt(),this[r(300)]=!1,this._matrixNeedsUpdate=!0;const a=this[r(426)];this[r(446)]=lt(ht(a,Wt,"#version 300 es\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = vec4(0.5, 0.5, 1, 0.5);\n}")),this._vertexArrayObject=lt(a[r(1567)]()),a[r(553)](this[r(1817)]),this[r(1253)]=lt(a[r(1391)]()),this[r(1723)]=lt(a.getUniformLocation(this[r(446)],r(621))),a[r(569)](a[r(1429)],this[r(1253)]),a[r(1004)](0),a.vertexAttribPointer(0,2,a[r(989)],!1,0,0),this[r(1324)](this._selectionService[r(1496)]((()=>this[r(300)]=!0))),this[r(1324)](this._viewportService.onUpdate((()=>{const t=r;this[t(300)]=!0,this[t(1700)]=!0})))}[t(506)](){const e=t,i=this[e(447)].currentLayer;if(!i)return;if(!this._toolService.activeTool?.[e(283)])return;const s=this[e(938)].range;if(!s)return;const n=this._gl;n.useProgram(this._program),n[e(553)](this[e(1817)]),function(e,i){const s=t;e[s(976)](e[s(1494)]),e[s(1517)](e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e[s(1247)],e.ONE_MINUS_SRC_ALPHA)}(n),this[e(1321)](n,s,this[e(1547)]),this[e(757)](n,i,this[e(1547)]),n.drawArrays(n[e(1298)],0,4)}[t(1321)](e,i,s){const n=t;this._positionsNeedsUpdate&&(e[n(569)](e.ARRAY_BUFFER,this._positionBuffer),this[n(1412)][0]=this._positionArray[2]=i.left*s.zoom,this._positionArray[4]=this._positionArray[6]=i.right*s.zoom,this._positionArray[1]=this[n(1412)][7]=i[n(1082)]*s[n(1150)],this._positionArray[3]=this[n(1412)][5]=i[n(799)]*s[n(1150)],e[n(793)](e.ARRAY_BUFFER,this[n(1412)],e[n(970)]),this[n(300)]=!1)}[t(757)](e,i,s){const n=t;this[n(1700)]&&(ut(e,this._matrixLocation,i,s,this._workMatrices),this[n(1700)]=!1)}}class qt extends e.JT{constructor(i,s,n,o,r){const a=t;super(),this[a(674)]=i,this._imageService=s,this[a(938)]=n,this[a(1570)]=o,this[a(1547)]=r,this[a(1265)]=[],this[a(454)]=[],this[a(492)]=new Set,this[a(1662)]=0,this._selectionAnimationFrame=0,this[a(503)]=!1,this[a(379)]=0,this._isPaused=!1,this[a(1668)]=[],this[a(612)]=[],this[a(397)]=document[a(1296)]("canvas"),this[a(836)]=document[a(1296)]("canvas"),this[a(836)][a(175)][a(1591)]("animation"),this[a(824)]=document[a(1296)]("div"),this._viewsElement[a(175)][a(1591)](a(883)),this[a(674)].append(this[a(397)],this[a(836)],this[a(824)]),this.register({dispose:()=>{const t=a;this[t(397)][t(1534)]&&this[t(674)][t(1019)](this[t(397)]),this._canvas.parentElement&&this[t(674)].removeChild(this[t(836)]),this[t(674)][t(1019)](this[t(824)])}}),this.register(this[a(1547)][a(843)](((t,e)=>{const i=a;this._resize(t,e),this.render(),this[i(1043)](!0)}))),this[a(1324)](this[a(1547)][a(1496)]((()=>{this[a(506)](),this.renderSelection(!0)}))),this[a(1324)](this._selectionService[a(1496)]((()=>this[a(1043)](!0)))),this[a(1324)](this._imageService[a(1496)]((()=>this[a(506)]()))),this[a(1324)](this._imageService[a(1036)]((()=>this[a(506)]()))),this[a(1324)](this._imageService.onLayerChange((()=>this[a(506)]()))),this[a(1324)](this._toolService[a(636)]((t=>this[a(1599)](t)))),this[a(1324)]((0,e.Lw)(this._canvas,a(1642),(()=>this[a(1516)](a(1571)))));const h=this._canvas[a(714)](a(755),{antialias:!1,premultipliedAlpha:!1,stencil:!0});if(!h){const t=a(200);throw this._showError(t),new Error(t)}this[a(426)]=h,this[a(1498)]=lt(this._canvasSelection.getContext(a(755),{antialias:!1})),this[a(959)](this._container[a(1158)],this._container[a(811)]),this._gl.clearColor(0,0,0,0),this[a(426)][a(624)](this[a(426)][a(1258)]),this._glSelection[a(1302)](0,0,0,0),this[a(1498)][a(624)](this[a(426)][a(1258)]),this[a(1265)][a(1686)](new Ut(this._gl,this._imageService,this[a(1547)])),this[a(1265)].push(new ft(this._gl,this[a(447)],this[a(1547)])),this._imageCanvasRenderProgram=new Dt(this[a(426)],this[a(447)],this[a(938)],this[a(1547)]),this[a(1265)][a(1686)](new Ot(this._gl,this[a(447)],this._viewportService)),this[a(454)][a(1686)](new jt(this[a(1498)],this[a(447)],this._selectionService,this[a(1570)],this._viewportService)),this[a(454)][a(1686)](new zt(this[a(1498)],this[a(447)],this[a(938)],this[a(1547)]));for(const t of this[a(454)])t.onStartAnimating&&t[a(1663)]&&(t[a(1329)]((()=>this[a(893)](t))),t[a(1663)]((()=>this[a(1634)](t))));this[a(506)]();let c=this._imageService[a(1496)]((()=>{const t=a;this[t(674)].classList[t(1591)](t(1264)),c?.dispose(),c=void 0}));this.register({dispose:()=>c?.dispose()});const l=new MutationObserver((()=>{const t=a;for(const e of this[t(1265)])e[t(1548)]&&e[t(1548)]();this[t(506)]()}));l[a(1319)](document.documentElement,{attributes:!0,attributeFilter:[a(1712)]}),this[a(1324)]({dispose:()=>l.disconnect()})}_resize(e,i){const s=t,n=Math[s(1297)](e),o=Math[s(1297)](i);this[s(397)].width=n,this[s(397)][s(918)]=o,this[s(836)][s(1564)]=n,this._canvasSelection[s(918)]=o,this._gl[s(339)](0,0,n,o),this[s(1498)][s(339)](0,0,n,o),this._viewsElement[s(1712)][s(544)]="absolute",this[s(824)][s(1712)][s(707)]="0",this[s(824)][s(1712)][s(1082)]="0",this[s(824)][s(1712)][s(895)]="0",this[s(824)][s(1712)][s(799)]="0",this[s(1041)]?.[s(178)]()}[t(1065)](){this._isPaused=!0}[t(1511)](){const e=t;this._isPaused&&(this._isPaused=!1,this.render(),this[e(1043)](!0))}[t(506)](){const e=t;0===this[e(1662)]&&(this._animationFrame=window[e(231)]((()=>this[e(444)]())))}renderSelection(e=!1){const i=t;if(this[i(411)]&&!e)return window[i(629)](this[i(515)]),void(this._selectionAnimationFrame=0);this._forceSelectionAnimation=this[i(503)]||e,0===this[i(515)]&&(this[i(515)]=window.requestAnimationFrame((()=>this._renderSelection())))}[t(444)](){const e=t;this[e(393)](this._renderPrograms,1),!this[e(1570)][e(779)]?.[e(283)]&&this._renderProgramsWithOrder(this[e(1668)],1),this[e(1041)][e(506)](),this._renderProgramsWithOrder(this[e(1265)],2),!this[e(1570)][e(779)]?.isSelectionTool&&this[e(393)](this[e(1668)],2),this[e(1662)]=0}_renderSelection(){const e=t,i=!!this[e(938)].range;if(this._canvasSelection[e(1712)][e(1371)]=e(i?1467:1003),this[e(515)]=0,!i)return void(this[e(503)]=!1);const s=this._lastAnimationFrame<=Date[e(451)]()-50;if(!this[e(503)]&&!s)return this[e(503)]=!1,void this[e(1043)]();if(this[e(503)]=!1,s){for(const t of this[e(454)])t[e(978)]&&t[e(978)]();this[e(379)]=Date[e(451)]()}this[e(492)].size>0&&this[e(393)](this[e(454)],2),this[e(1570)][e(779)]?.isSelectionTool&&this[e(393)](this[e(1668)],2),this[e(1043)]()}[t(393)](e,i){const s=t;for(const t of e)t[s(835)]===i&&t[s(506)]()}[t(893)](e){const i=t;this._activeAnimatingRenderPrograms[i(1591)](e),this[i(1043)]()}_stopAnimatingProgram(e){const i=t;this._activeAnimatingRenderPrograms[i(985)](e)}[t(1599)](i){const s=t;(0,e._c)(this[s(612)]),this[s(612)].length=0;for(const t of this[s(1668)])t[s(980)]&&t[s(980)]();let n;this._toolRenderPrograms[s(1225)]=0,i[s(1685)]?n=i.createRenderProgram(this[s(426)]):i[s(1604)]&&(n=i[s(1604)](this[s(824)])),n&&(Array[s(783)](n)?this[s(1668)][s(1686)](...n):this[s(1668)].push(n),i[s(1036)]&&this[s(612)][s(1686)](i[s(1036)]((()=>this[s(506)]())))),n&&this.render()}[t(1516)](e){const i=t;this[i(397)][i(1534)]&&this[i(674)].removeChild(this[i(397)]);const s=document[i(1296)](i(1683));s[i(1698)]=e,s.style[i(544)]="absolute",s[i(1712)][i(707)]=i(1370),s[i(1712)][i(1082)]=i(1370),s[i(1712)].transform=i(786),this._container[i(175)][i(1770)](i(1264)),this[i(674)][i(598)](s)}}class Gt extends e.JT{constructor(e,i,s,n,o){const r=t;super(),this[r(853)]=e,this[r(447)]=i,this[r(938)]=s,this._toolService=n,this[r(1547)]=o,this[r(1324)](this[r(853)][r(547)]((t=>this._attach(t)))),this[r(1324)]({dispose:()=>this[r(967)]?.[r(980)]()})}render(){const e=t;this[e(967)]?.[e(506)]()}[t(1065)](){this[t(967)]?.pause()}[t(1511)](){this[t(967)]?.resume()}_attach(e){const i=t;this._renderer?.[i(980)](),this._renderer=new qt(e,this[i(447)],this[i(938)],this[i(1570)],this[i(1547)])}}class Xt{constructor(e,i,s,n,o){const r=t;this[r(938)]=e,this[r(306)]=i,this.requiresTool=s,this.undoRange=n,this[r(1010)]=o,this.type=r(1814),this.pixelCount=0}[t(289)](){const e=t;this[e(556)](this[e(1510)])}redo(){const e=t;this[e(556)](this[e(1010)])}[t(556)](e){const i=t;this[i(938)].range=e?{left:e[i(707)],top:e[i(1082)],right:e[i(895)],bottom:e.bottom}:void 0}[t(1461)](){const e=t;return{id:e(1814),operationName:this.operationName,requiresTool:this.requiresTool,undoRange:this[e(1510)],redoRange:this[e(1010)]}}static create(e,i){const s=t;return new Xt(e,i[s(306)],i[s(1837)],i[s(1510)],i.redoRange)}}class Jt extends e.JT{constructor(e){const i=t;super(),this[i(1765)]=e,this[i(299)]=this[i(1324)](new n.v),this[i(1496)]=this._onUpdate[i(1545)],this[i(1433)]=this[i(1324)](new n.v),this[i(1155)]=this[i(1433)][i(1545)],this[i(1765)][i(1379)](i(1814),{undo:t=>{const e=i;t[e(289)](this._range),this[e(845)]=t[e(1510)]},redo:t=>{const e=i;t[e(474)](this[e(539)]),this._lastCommittedRange=t[e(1510)]}}),this[i(1765)][i(1364)](i(1814),Xt[i(1217)][i(1174)](null,this))}get[t(1707)](){return this._range}set range(e){const i=t;if(e&&(e[i(707)]>e[i(895)]||e[i(1082)]>e[i(799)]))throw new Error(i(195)+e[i(707)]+i(1641)+e[i(895)]+i(969)+e.top+i(1633)+e.bottom);this[i(539)]=e,this._onUpdate.fire()}[t(1184)](e,i){const n=t;if(!this._range)return;const o=(0,s.BN)(this[n(1707)]);(0,s.Hd)(o,e,i),this[n(1707)]=o}[t(1694)](e,i){const s=t;this[s(539)]&&(this[s(539)].left>=e||this[s(539)][s(1082)]>=i||this._range[s(799)]<=0||this[s(539)].right<=0?this[s(539)]=void 0:this.range={left:Math.max(this[s(539)].left,0),top:Math[s(282)](this[s(539)][s(1082)],0),right:Math[s(1608)](this._range[s(895)],e),bottom:Math[s(1608)](this[s(539)][s(799)],i)})}[t(1283)](){this[t(1707)]=void 0,this.commit("Deselect")}select(e,i){const s=t;this.range=i,this[s(1523)](e)}async[t(1523)](e,i){const s=t;if(function(e,i){const s=t;return i&&e?e[s(707)]===i[s(707)]&&e[s(1082)]===i[s(1082)]&&e.right===i[s(895)]&&e.bottom===i[s(799)]:!e&&!i}(this._lastCommittedRange,this[s(1707)]))return;const n=new Xt(this,e,i,this[s(845)],this.range);this._historyService.createCompositeEntrySync(e,(()=>{const t=s;this._historyService.addEntry(n),this[t(1433)][t(443)]()})),this[s(845)]=this[s(1707)]}[t(504)](e,i){const s=t;return!this[s(539)]||e>=this[s(539)][s(707)]&&e<this[s(539)][s(895)]&&i>=this[s(539)].top&&i<this[s(539)][s(799)]}[t(1461)](){return this._range}[t(1442)](e){this[t(1707)]=e}}var Yt=i(7166);class Kt{constructor(e,i,s){const n=t;this.operationName=e,this[n(984)]=i,this._f=s}async[t(361)](){const e=t,i={data:(0,Yt.Qf)(this[e(984)],(0,s.DI)(this[e(984)][e(1564)],this[e(984)][e(918)])),width:this[e(984)].width,height:this[e(984)][e(918)]};let n;await this[e(984)][e(463)]((async(t,e,i)=>(n=await this._f(t,e,i),n)));const o={data:(0,Yt.Qf)(n,(0,s.DI)(n[e(1564)],n[e(918)])),width:n[e(1564)],height:n.height};return new P(this.operationName,this[e(984)][e(851)],this[e(984)].id,i,o)}}class $t{constructor(e,i,s,n){const o=t;this[o(1374)]=e,this[o(447)]=i,this[o(317)]=s,this[o(211)]=n}[t(361)](){const e=t;if(this[e(447)][e(1564)]===this._width&&this[e(447)][e(918)]===this[e(211)])return;const i={width:this[e(447)][e(1564)],height:this[e(447)][e(918)]},s={width:this._width,height:this._height},n=new M(this[e(1374)],i,s);return n[e(474)](this[e(447)][e(178)][e(1174)](this[e(447)])),n}}class Zt extends e.JT{constructor(e,i,s,o){const r=t;super(),this[r(1765)]=e,this[r(447)]=i,this[r(938)]=s,this._taskWorkerService=o,this[r(1774)]=this[r(1324)](new n.v),this.onProgress=this._onProgress[r(1545)],this[r(1688)]=this[r(1324)](new n.v),this[r(688)]=this[r(1688)].event}async[t(1238)](e,i){const s=t,n=this[s(447)][s(574)];if(0===n.length)return;await this[s(1688)].fireAndWait(this[s(1188)](e));const o={left:0,top:0,right:this[s(447)].width,bottom:this[s(447)][s(918)]},r=s(256)+Qt(e);await this[s(1765)][s(434)](r,(async()=>{const t=s;let a;for(const t of n)a=await this._doExecuteOnLayer(e,i,t,r,o);a&&(a[t(535)].width!==o[t(895)]||a[t(535)][t(918)]!==o[t(799)])&&this[t(1765)].runSyncAction(new $t(t(658),this._imageService,a[t(535)].width,a[t(535)][t(918)])),a?.[t(1814)]!==this[t(938)][t(1707)]&&(this[t(938)][t(1707)]=a?.[t(1814)],this[t(938)][t(1523)](t(374)))}))}async[t(340)](e,i){const s=t,n=this[s(447)][s(381)];if(!n)return;await this[s(1688)][s(748)](this[s(1188)](e));const o={left:0,top:0,right:n[s(1564)],bottom:n[s(918)]},r=s(954)+Qt(e);await this[s(1765)][s(434)](r,(async()=>{const t=s,a=await this._doExecuteOnLayer(e,i,n,r,o);if(a?.[t(1814)]!==this[t(938)].range&&(this[t(938)][t(1707)]=a?.[t(1814)],this[t(938)].commit(t(374))),a&&(a[t(535)][t(1564)]!==o[t(895)]||a[t(535)][t(918)]!==o[t(799)]))throw new Error("Cannot resize image in single layer task")}))}async[t(987)](e,i,s,o,r){const a=t;let h;return await this[a(1765)].runAction(new Kt(o,s,(async(t,s,o)=>{const r=a,c=this[r(232)][r(1262)](e,i,{data:t,width:s,height:o},this[r(938)][r(1707)]);return(0,n.B)(c.onProgress,this[r(1774)]),h=await c[r(1179)],h[r(535)]}))),h}[t(1188)](e){return{finishSelection:e!==t(213)}}}function Qt(e){const i=t;switch(e){case i(589):return i(1084);case"layer/cropToSelection":return i(1153);case i(213):return i(628);case i(1236):return i(933);case"layer/flipVertical":return i(1675);case"layer/invertColors":return"Invert Colors";case"layer/resize":return"Resize";case i(1592):return i(303);case i(1245):return i(1587);case i(177):return i(1299);case i(593):return i(841);default:return i(1661)}}function te(){const e=t;return new Worker(i.p+e(1307))}const ee=new Map;ee[t(971)](t(1214),(e=>e[t(1707)][t(799)]-e[t(1707)][t(1082)])),ee.set(t(1395),(e=>e[t(1395)].height)),ee[t(971)](t(881),(e=>e.range.bottom-e[t(1707)][t(1082)])),ee.set(t(1160),(()=>1)),ee[t(971)]("fillGlobal",(()=>1)),ee[t(971)]("generatePreview",(e=>e[t(1427)][t(918)])),ee[t(971)](t(1109),(e=>e.putRange[t(799)]-e.putRange[t(1082)]));let ie=!1;class se extends e.JT{get[t(1215)](){return ie}set[t(1215)](t){ie=t}runLayerTask(t,e,i,s){return new oe(t,e,i,s)}[t(660)](e,i){const s=t;return new re(e,i,this[s(743)](e,i))[s(1179)]}[t(743)](e,i){const s=t,n=ee.get(e);if(!n)throw new Error(s(1760)+e+'"');return n(i)}async[t(210)](e,i,s){const n=t,o={sourceImage:e,destImage:(0,Yt.uF)(i,s)};await this[n(660)](n(1248),o);const r=new ImageData(new Uint8ClampedArray(o[n(1427)][n(356)]),o.destImage[n(1564)],o[n(1427)].height);return createImageBitmap(r)}}class ne extends e.JT{constructor(e,i){const s=t;super(),this[s(1623)]=e,this._progress=i,this[s(523)]=0,this[s(625)]=0,this._onProgress=this[s(1324)](new n.v),this.onProgress=this._onProgress[s(1545)],this[s(1721)]=performance[s(451)](),this[s(1002)]=setInterval((()=>this[s(1144)]()),1e3)}[t(1305)](){const e=t;this[e(1002)]&&(clearInterval(this[e(1002)]),this[e(1002)]=0,this[e(1144)]())}[t(1736)](e,i){const s=t;this._progress[e]=i,this[s(448)]()}[t(448)](){const e=t;!this[e(625)]&&(this[e(625)]=window[e(1539)]((()=>{const t=e;this[t(424)](),this[t(625)]=0}),0))}[t(424)](){const e=t,i=this._progress.reduce(((t,e)=>t+e),0)/this._progress[e(1225)];this[e(523)]!==i&&(this[e(1774)][e(443)](i),this._progressLast=i)}[t(1144)](){const e=t,i=this[e(1708)][e(1857)](((t,e)=>t+e),0)/this[e(1708)][e(1225)],s=Math[e(827)](i/.05),n=20-s;let o="["+"█".repeat(s)+" "[e(499)](n)+"]";if(1===i){const t=" "+(performance.now()-this._startTime)[e(1669)](0)+e(790);o="["+t[e(922)](t.length+Math[e(1719)]((20-t.length)/2),"█").padEnd(20,"█")+"]"}console[e(943)](o+" "+Math[e(827)](100*i)[e(215)]()[e(922)](3," ")+"% "+this[e(1623)])}}class oe extends ne{constructor(e,i,n,o){const r=t,a=r(1564)in i&&r(918)in i;let h=a?i[r(1564)]:n[r(1564)],c=a?i[r(918)]:n.height;switch(e){case r(1168):if(!o)throw new Error(r(1323));h=o[r(895)]-o[r(707)],c=o[r(799)]-o[r(1082)];break;case r(213):if(!o)throw new Error(r(1075));const t=(0,s.DI)(n[r(1564)],n.height),e=(0,s.qi)(t,o);h=e[r(895)]-e[r(707)],c=e[r(799)]-e.top;break;case r(177):case r(593):h=n[r(918)],c=n[r(1564)]}const l=h*c*4,d=r(535)in i?i[r(535)]:{data:new Uint8Array(new SharedArrayBuffer(l)),width:h,height:c},u=[],m=Math[r(1608)](navigator[r(807)]||1,Math[r(282)](d[r(918)]/100,1));super(e,new Float32Array(m));for(let t=0;t<m;t++){const s={id:t,yStart:Math[r(1719)](t/m*d.height),yEnd:Math[r(1608)](Math[r(1719)]((t+1)/m*d[r(918)]),d.height),xStart:Math.floor(t/m*d.width),xEnd:Math[r(1608)](Math[r(1719)]((t+1)/m*d[r(1564)]),d[r(1564)])};u[r(1686)](this[r(834)](e,i,n,d,o,s))}this[r(1179)]=Promise[r(318)](u).then((()=>{const t=r;return this[t(1305)](),{selection:this[t(1814)],dest:d}}))[r(1142)]((t=>{throw this._finish(),t}))}[t(834)](t,e,s,n,o,r){return new Promise((async(a,h)=>{const c=a2_0x6447;let l;if(ie){const t=await i.e(174).then(i[c(1174)](i,9174));l=new ae(t[c(519)])}else l=new te;const d={type:c(693),taskName:t,source:s,dest:n,selection:o,options:e,job:r};l[c(1727)](d),l.onmessage=e=>{const i=c;switch(e[i(356)][i(352)]){case"complete":this[i(1736)](r.id,1),this[i(1814)]=e[i(356)][i(1814)],a(),l[i(1478)]();break;case i(1583):this[i(1736)](r.id,1),h(i(1001)+t+i(344)+e[i(356)][i(908)]),l.terminate();break;case i(285):this[i(1736)](r.id,e[i(356)][i(754)])}}}))}}class re extends ne{constructor(e,i,s){const n=t,o=[],r=Math.min(navigator[n(807)]||1,Math.max(Math.ceil(s/100),1));super(e,new Float32Array(r));for(let t=0;t<r;t++){const a=Math[n(1719)](t/r*s),h=Math[n(1719)]((t+1)/r*s),c={id:t,start:a,end:h,size:h-a};o[n(1686)](this[n(834)](e,i,c))}this.result=Promise[n(318)](o).then((t=>{const e=n;return this[e(1305)](),0===t[e(1225)]?void 0:t[0]}))[n(1142)]((t=>{throw this[n(1305)](),t}))}[t(834)](t,e,s){return new Promise((async(n,o)=>{const r=a2_0x6447;let a;if(ie){const t=await i.e(174)[r(1594)](i[r(1174)](i,9174));a=new ae(t[r(519)])}else a=new te;const h={type:"start",taskName:t,args:e,job:s};a.onmessage=e=>{const i=r;switch(e[i(356)][i(352)]){case i(1266):this._updateProgress(s.id,1),n(e[i(356)][i(1179)]),a[i(1478)]();break;case i(1583):this[i(1736)](s.id,1),o(i(1001)+t+'" failed: '+e[i(356)][i(908)]),a[i(1478)]();break;case i(285):this[i(1736)](s.id,e.data[i(754)])}},a[r(1727)](h)}))}}class ae{constructor(e){const i=t;this[i(771)]=()=>{},this[i(1114)]=e(this[i(1616)].bind(this))}[t(1727)](e){this[t(1114)]({data:e})}[t(1478)](){}[t(1616)](e){this[t(771)]({data:e})}}const he=new Map([[t(887),{file:"colorPicker"}],[t(662),{file:"crop"}],["eraser",{file:t(716)}],[t(365),{file:t(365)}],[t(460),{file:t(460)}],[t(1005),{file:"line"}],["movePixels",{file:t(1464)}],[t(236),{file:"moveSelection"}],["pencil",{file:t(298)}],[t(615),{file:"rectangle"}],[t(1814),{file:"selection"}],[t(1150),{file:"zoom"}]]);class ce extends e.JT{constructor(e,i,s,o,r,a,h,c){const l=t;super(),this[l(1765)]=e,this._imageService=i,this[l(1670)]=s,this[l(1778)]=o,this[l(938)]=r,this[l(304)]=a,this[l(232)]=h,this._viewportService=c,this[l(1202)]=!1,this[l(910)]=this[l(1324)](new n.v),this[l(636)]=this._onToolChange[l(1545)],this[l(538)]={historyService:this[l(1765)],imageService:this[l(447)],paletteService:this._paletteService,selectionService:this._selectionService,taskService:this[l(304)],taskWorkerService:this._taskWorkerService,viewportService:this[l(1547)]},this[l(1670)][l(734)]((t=>{const e=l;this[e(1202)]=!0,document[e(816)][e(175)][e(1414)](e(1730),0===t[e(750)]),document.body[e(175)][e(1414)](e(291),2===t[e(750)]),this._lastPointerEvent=t})),this[l(1670)][l(1775)]((t=>this[l(580)]=t)),this[l(1670)][l(617)]((()=>{const t=l;this[t(1202)]=!1,document[t(816)].classList[t(1770)]("mouseleft"),document.body[t(175)][t(1770)]("mouseright"),this._clearUntilReleaseTool(),this._lastPointerEvent=void 0})),this.register(this._viewportService.onUpdate((()=>{const t=l;if(this[t(580)]){const e=this[t(855)]||this.activeTool;e?.pointerMove?.(this[t(580)]),this[t(1202)]&&e?.[t(1453)]?.(this[t(580)])}}))),this[l(1670)][l(1500)]((()=>this._clearUntilReleaseTool())),this._historyService[l(907)]((t=>this[l(1599)](t))),this[l(447)][l(1074)]((t=>{const e=l;t.type===e(1076)&&this[e(1599)](e(1464))})),this[l(1731)](this[l(1670)][l(469)],l(777)),this[l(1731)](this[l(1670)][l(1500)],"keyUp"),this._forwardEventToTool(this[l(1670)][l(734)],l(1409)),this[l(1731)](this[l(1670)][l(1775)],"pointerDownMove"),this._forwardEventToTool(this[l(1670)][l(611)],"pointerMove"),this[l(1731)](this[l(1670)][l(617)],"pointerUp")}get[t(779)](){return this[t(582)]}async[t(1599)](e,i){const s=t;if(e===this[s(582)]?.id)return;if(i?.untilRelease&&this[s(855)])return;if(!i?.[s(1206)]&&this._activeTool?.[s(980)](),typeof e!==s(209))return void(i?.[s(1206)]?this[s(855)]=e:this[s(582)]=e);const n=he[s(1375)](e);if(!n)throw new Error(s(939)+e);if(!n[s(1482)]){const t=await this[s(874)](s(1335),n.file);n[s(1482)]=e=>new t(e)}const o=n.factory(this._sc);i?.[s(1206)]?this[s(855)]=o:this[s(582)]=o,document.body[s(545)](s(1854),o.id),this[s(439)](o),o[s(829)]&&o[s(829)]((()=>this[s(439)](o))),this._onToolChange[s(443)](o)}[t(439)](e){const i=t;e.state?document[i(816)].setAttribute(i(738),e.state):document[i(816)][i(1358)](i(738))}[t(761)](){const e=t;this[e(855)]&&!this[e(1202)]&&(this[e(855)]=void 0,this[e(779)]&&(document[e(816)][e(545)](e(1854),this.activeTool.id),this[e(439)](this[e(779)]),this[e(910)][e(443)](this[e(779)])))}async _loadModule(e,s){const n=t;return(await i(1038)("./"+e+"/"+s+n(1797)))[n(1484)]}[t(1731)](e,i){const s=t;this[s(1324)](e((t=>{const e=s,n=this[e(855)]||this.activeTool,o=n?n[i]:void 0;o&&o[e(1174)](n)(t,this[e(1670)]?.[e(1421)])})))}[t(1461)](){return this[t(582)]?.id}[t(1442)](e){e&&this[t(1599)](e)}}var le=i(7896);const de=new Uint16Array([1,2,3,4,5,6,7,8,9,10,11,12,13,15,17,19,21,24,27,30,34,38,43,48,54,60,64,70,76,82,90,100]);class ue extends e.JT{constructor(e,i,s){const o=t;super(),this[o(853)]=e,this._imageService=i,this.mouseWheelBehavior="scroll",this._zoom=20,this[o(1181)]=!0,this._isScrollLocked=!1,this._x=0,this._y=0,this[o(1295)]={x:0,y:0},this[o(1345)]=0,this[o(299)]=this[o(1324)](new n.v),this.onUpdate=this[o(299)][o(1545)],this[o(837)]=this.register(new n.v),this[o(843)]=this[o(837)].event,this._onPixelGridEnabledChange=this[o(1324)](new n.v),this.onPixelGridEnabledChange=this[o(879)][o(1545)],this[o(944)]=this[o(1324)](new n.v),this[o(1563)]=this[o(944)][o(1545)],this[o(387)]=this[o(1324)](new n.v),this[o(1147)]=this[o(387)][o(1545)],this[o(1324)](this[o(447)].onChangedDimensions((()=>this[o(1752)]()))),this.register(this._elementService[o(547)]((t=>{const e=o;this[e(1605)]?.[e(266)](),this[e(1605)]=new ResizeObserver((([t])=>{const i=e;this[i(837)].fire(t[i(1309)][i(1564)],t[i(1309)].height),this[i(299)][i(443)]()})),this[e(1605)][e(1319)](t)}))),this[o(1324)]({dispose:()=>{const t=o;this[t(1605)]?.[t(266)]()}}),this[o(1324)](s[o(525)]((t=>this[o(886)](t)))),this[o(1324)](s[o(1775)]((t=>this[o(309)](t)))),this.register(s[o(611)]((t=>this[o(321)](t)))),this[o(1324)](s[o(617)]((()=>this[o(1843)]())))}get[t(1249)](){const e=t,i=this[e(853)][e(1361)];if(!i)throw new Error(e(885));const s=i[e(1119)]/this[e(1150)],n=i[e(656)]/this[e(1150)],o=this._imageService.width/2-this._x,r=this[e(447)][e(918)]/2-this._y;return{left:Math.max(o-s/2,0),right:Math[e(1608)](o+s/2,this[e(447)].width),top:Math[e(282)](r-n/2,0),bottom:Math[e(1608)](r+n/2,this[e(447)].height)}}get zoom(){const e=t;return parseFloat(this[e(1738)][e(1669)](2))}set[t(1150)](e){const i=t;e<=0||(this[i(1738)]=e,this._onUpdate[i(443)](),this[i(944)][i(443)]())}get isPixelGridEnabled(){return this[t(1181)]}set[t(1308)](e){const i=t;e!==this[i(1181)]&&(this[i(1181)]=e,this[i(299)][i(443)](),this[i(879)][i(443)]())}get x(){return this._x}set x(e){const i=t,s=this._imageService[i(1564)]/2;this._x=(0,w.u)(e,s,-s),this[i(299)][i(443)]()}get y(){return this._y}set y(e){const i=t,s=this._imageService[i(918)]/2;this._y=(0,w.u)(e,s,-s),this[i(299)][i(443)]()}[t(583)](t=.2){return this._multiplyZoom(t)}zoomOut(e=.2){return this[t(557)](-e)}[t(1752)](){const e=t,i=this[e(853)][e(1361)];if(!i)return;const s=(i[e(1119)]-10)/this[e(447)][e(1564)],n=(i[e(656)]-10)/this[e(447)][e(918)];this[e(1150)]=Math[e(1608)](s,n),this._x=0,this._y=0,this[e(1384)]=!0,this[e(299)][e(443)]()}fitLayerToWindow(){const e=t,i=this[e(447)][e(381)];if(!i)return;const s=i[e(1372)];this[e(814)]([s.left,s[e(1082)]],[s[e(895)],s[e(799)]])}[t(814)](e,i){const s=t,n=this[s(853)][s(1361)];if(!n)return;const o=(n[s(1119)]-10)/(i[0]-e[0]),r=(n[s(656)]-10)/(i[1]-e[1]);this[s(1150)]=Math[s(1608)](o,r),this._x=-((i[0]+e[0])/2-this[s(447)][s(1564)]/2),this._y=-((i[1]+e[1])/2-this[s(447)][s(918)]/2),this[s(299)][s(443)]()}_handleWheel(e){const i=t;if(this[i(853)][i(1361)]){if("scroll"===this[i(968)]&&e.ctrlKey||this[i(968)]===i(1150)&&!e[i(1699)]){const t=this[i(1150)],s=le.V?e[i(1834)]<0?this[i(583)](-e[i(1834)]/20):this[i(1178)](e[i(1834)]/20):e[i(1834)]<0?this[i(583)]():this.zoomOut(),n=s/t;if(t!==s){const t=(e[i(1635)]-this[i(853)].element[i(1158)]/2)*(n-1),o=(e[i(362)]-this[i(853)][i(1361)][i(811)]/2)*(n-1);this.x-=t/s,this.y-=o/s}}else!le.V&&e[i(672)]?this.x-=this[i(844)](e[i(1834)])/this[i(1150)]:(this.x-=this._normalizeWheelDelta(e[i(1134)])/this[i(1150)],this.y-=this[i(844)](e[i(1834)])/this[i(1150)]);this[i(1384)]=!1,e[i(787)]()}}[t(844)](t){return le.V?t:Math.abs(t)<100?40*t:t}[t(309)](e){const i=t,s=this[i(853)][i(1361)];s&&(e.offsetX<30?this[i(1295)].x=this[i(913)](30-e[i(1575)]):e[i(1575)]>s[i(1158)]-30?this[i(1295)].x=-this._calculateScrollVelocity(e[i(1575)]-s.clientWidth-30):this._scrollVelocity.x=0,e.offsetY<30?this[i(1295)].y=this[i(913)](30-e[i(680)]):e[i(680)]>s.clientHeight-30?this[i(1295)].y=-this._calculateScrollVelocity(e.offsetY-s[i(811)]-30):this[i(1295)].y=0,!this[i(1345)]&&(this[i(821)](),this[i(1345)]=setInterval((()=>this[i(821)]()),16)))}[t(321)](e){const i=t,s=this._getImageCoordsFromEvent(e);if(void 0!==s||void 0!==this[i(725)])return void 0===s||void 0===this[i(725)]?(this[i(725)]=s,void this[i(387)][i(443)](this._pointerCoord)):void(s[0]===this[i(725)][0]&&s[1]===this._pointerCoord[1]||(this[i(725)]=s,this[i(387)][i(443)](this[i(725)])))}_calculateScrollVelocity(e){const i=t;return 1+Math[i(1025)](Math[i(282)](e/20,3),2)}[t(1843)](){const e=t;this._scrollVelocity.x=0,this[e(1295)].y=0,clearInterval(this[e(1345)]),this[e(1345)]=0}_outOfFrameScroll(){const e=t;this[e(1384)]||(this[e(1295)].x&&(this.x+=1*this[e(1295)].x/this[e(1150)]),this[e(1295)].y&&(this.y+=1*this[e(1295)].y/this[e(1150)]))}[t(557)](e){const i=t,s=this[i(1738)]+this[i(1738)]*e;if(s<=.02)return this[i(1738)]=.02,this._zoom;let n=-1;if(e>0){for(const t of de)if(t>this[i(1738)]){n=t;break}if(-1===n)return this[i(1738)];this[i(1738)]=n<s?n:s}else{for(const t of de){if(t>=this[i(1738)])break;n=t}this[i(1738)]=n>s?n:s}return this[i(299)][i(443)](),this[i(944)][i(443)](),this[i(1738)]}[t(676)](e){const i=this[t(937)](e);return[Math.floor(i[0]),Math.floor(i[1])]}[t(937)](e){const i=t,s=this._elementService[i(1361)];if(!s)throw new Error(i(1018));let n=e[i(1575)]-Math[i(1719)](s[i(1158)]/2),o=e[i(680)]-Math[i(1719)](s.clientHeight/2);return n/=this.zoom,o/=this.zoom,n+=this[i(447)][i(1564)]/2,o+=this._imageService[i(918)]/2,n-=this.x,o-=this.y,[n,o]}[t(1091)](e){const i=t,s=this[i(676)](e);if(!(s[0]<0||s[0]>=this[i(447)].width||s[1]<0||s[1]>=this[i(447)][i(918)]))return s}[t(1461)](){const e=t;return{x:this._x,y:this._y,zoom:this[e(1738)]}}[t(1442)](e){const i=t;this._x=e.x,this._y=e.y,this[i(1738)]=e[i(1150)],this[i(299)][i(443)](),this._onZoomChange[i(443)]()}}class me extends e.JT{constructor(){const e=t;super(),this[e(853)]=this.register(new o),this[e(1778)]=this.register(new st),this[e(1765)]=this.register(new a),this[e(232)]=this.register(new se),this[e(938)]=this[e(1324)](new Jt(this[e(1765)])),this._imageService=this[e(1324)](new tt(this[e(1765)],this[e(938)],this[e(232)])),this[e(1670)]=this.register(new et(this[e(853)])),this[e(1547)]=this.register(new ue(this[e(853)],this[e(447)],this[e(1670)])),this[e(1596)]=this[e(1324)](new p(this[e(1765)],this._imageService,this[e(938)],this[e(1547)])),this[e(304)]=this[e(1324)](new Zt(this[e(1765)],this._imageService,this[e(938)],this[e(232)])),this[e(1570)]=this[e(1324)](new ce(this[e(1765)],this[e(447)],this[e(1670)],this[e(1778)],this[e(938)],this[e(304)],this[e(232)],this[e(1547)])),this[e(435)]=this[e(1324)](new Gt(this[e(853)],this[e(447)],this[e(938)],this[e(1570)],this[e(1547)])),this[e(432)]=new ge(this[e(1765)],this[e(1596)],this[e(447)],this._selectionService,this[e(1570)],this[e(1547)]),this[e(1145)]=new fe(this[e(1765)]),this[e(1020)]=new pe(this[e(1596)]),this.layer=new ye(this[e(447)],this[e(938)],this[e(232)]),this[e(1233)]=new we(this[e(1778)]),this[e(506)]=new ve(this[e(435)]),this.selection=new be(this[e(447)],this[e(938)]),this[e(788)]=new xe(this._taskService,this._taskWorkerService),this.tool=new Ie(this[e(1570)],this[e(1765)],this[e(447)],this[e(1778)],this._selectionService,this._viewportService),this[e(339)]=new Se(this[e(853)],this[e(1547)])}}class ge{constructor(e,i,s,n,o,r){const a=t;this._historyService=e,this[a(1596)]=i,this[a(447)]=s,this[a(938)]=n,this._toolService=o,this[a(1547)]=r}get[t(1526)](){const e=t;return this[e(447)][e(1526)]}get[t(1203)](){return this[t(447)].onMimeTypeChange}[t(1733)](e){const i=t;return this[i(1596)][i(1733)](e)}[t(1470)](e){const i=t;return this[i(1596)][i(1470)](e)}[t(646)](){const e=t;return this._imageService[e(646)]()}[t(1589)](){const e=t;return this._imageService[e(1589)]()}async[t(736)](e,s,n){const o=t;switch(s){case o(1021):const t=(await i.e(959)[o(1594)](i[o(1174)](i,6959)))[o(1030)],r=await t(e);await Promise[o(830)](r.map((t=>t[o(253)]))),await this[o(1768)]("image/x-ico",r[o(1522)]((t=>t[o(272)])),n);break;default:let a;switch(s){case".jif":case o(480):case o(433):case o(923):a=o(227);break;case".png":a=o(203);break;case o(1648):case".dib":a=o(631);break;case o(1290):a="image/webp";break;default:throw new Error(o(1316)+s+'"')}await this[o(1050)](a,new Blob([e],{type:a}),n)}}async[t(1287)](e,i,s){const n=t;this[n(1596)][n(1287)](e,i,s),this[n(1547)].fitToWindow()}async[t(1768)](e,i,s){const n=t;this._imageFileService.openImage(e,i,s),this[n(1547)][n(1752)]()}async[t(1050)](e,i,s){const n=t;await this[n(447)][n(1506)](e,i,s),this._viewportService.fitToWindow()}[t(1472)](e,i,s){const n=t,o=".ico"===s?"image/x-ico":n(203);this[n(1596)][n(1472)](o,e,i),this[n(1547)].fitToWindow()}restoreState(e){const i=t;if(e.version<5)throw new Error(i(942)+e[i(459)]+")");this[i(1596)][i(1442)](e[i(816)].file),this[i(1765)][i(1442)](e.body[i(1145)]),this[i(1570)][i(1442)](e.body[i(367)]),this[i(938)][i(1442)](e[i(816)][i(1814)]),this[i(1547)][i(1442)](e[i(816)][i(339)])}[t(1428)](e){const i=t;return{version:5,body:{file:this._imageFileService[i(1461)](e),history:this._historyService[i(1461)](e),selection:this._selectionService[i(1461)](),tool:this[i(1570)][i(1461)](),viewport:this[i(1547)][i(1461)]()}}}}class fe{constructor(t){this._historyService=t}get[t(385)](){const e=t;return this[e(1765)][e(385)]}get[t(403)](){const e=t;return this[e(1765)][e(403)]}get canRedo(){return this[t(1765)].canRedo}get[t(1811)](){const e=t;return this[e(1765)][e(1811)]}get onEntriesChange(){const e=t;return this[e(1765)][e(860)]}[t(474)](){const e=t;return this[e(1765)][e(474)]()}[t(289)](){return this[t(1765)].undo()}async[t(434)](e,i){const s=t;return this[s(1765)][s(434)](e,i)}createCompositeEntrySync(e,i){const s=t;return this[s(1765)][s(665)](e,i)}}class pe{constructor(e){this[t(1596)]=e}get[t(1479)](){const e=t;return this._imageFileService[e(1479)]}get[t(1864)](){return this[t(1596)].onImagesChange}get[t(501)](){return this[t(1596)].onImageDeleted}get[t(1275)](){const e=t;return this[e(1596)][e(1336)]}async[t(745)](e){const i=t;if(e!==this[i(1596)][i(1336)]){if(void 0===e)throw new Error(i(1416));await this._imageFileService.setActiveImageByIndex(e)}}[t(409)](t,e,i){return this._imageFileService.addImage(t,e,i)}[t(1794)](e){const i=t;return this[i(1596)][i(1794)](e)}duplicateImage(e){return this[t(1596)].duplicateImage(e)}[t(1469)](){const e=t;return this._imageFileService[e(1469)]()}[t(531)](){const e=t;return this[e(1596)][e(531)]()}[t(380)](){return this[t(1596)].goToImageAbove()}goToImageBelow(){return this[t(1596)].goToImageBelow()}[t(1771)](){return this[t(1596)].moveImageToTop()}[t(1303)](){const e=t;return this[e(1596)][e(1303)]()}[t(1815)](){return this[t(1596)].moveImageUp()}[t(1588)](){return this._imageFileService.moveImageDown()}[t(1279)](e,i){const s=t;return this[s(1596)][s(1279)](e,i)}}class ye{constructor(e,i,s){const n=t;this[n(447)]=e,this[n(938)]=i,this[n(232)]=s}get[t(1564)](){return this[t(447)].width}get[t(918)](){const e=t;return this[e(447)][e(918)]}get onDidChangeDimensions(){const e=t;return this[e(447)][e(699)]}get[t(1627)](){const e=t;return this._imageService[e(1496)]}get[t(1066)](){const e=t;return this[e(447)][e(1066)]}get[t(238)](){const e=t;return this[e(447)][e(238)]}get[t(574)](){const e=t;return this._imageService[e(574)][e(1522)]((t=>new _e(t,this[e(938)],this[e(232)])))||[]}get[t(1222)](){const e=t,i=this[e(447)][e(381)];if(i)return new _e(i,this[e(938)],this[e(232)])}set[t(1222)](e){const i=t;if(void 0===e)throw new Error("Cannot set the active layer to undefined");this[i(447)][i(1136)](e.id)}[t(1824)](){const e=t;return this[e(447)][e(1824)]()}[t(1135)](e){const i=t;return this[i(447)][i(1135)](e?.id)}[t(896)](e){return this[t(447)].duplicateLayer(e?.id)}[t(1542)](){const e=t;return this[e(447)][e(1542)]()}[t(1657)](){return this._imageService.flattenLayers()}[t(1116)](e,i){const s=t;return this[s(447)][s(1116)](e,i?.id)}[t(441)](){const e=t;this[e(447)][e(441)]()}[t(1029)](){this[t(447)].goToBottomLayer()}[t(1317)](){const e=t;this[e(447)][e(1317)]()}goToLayerBelow(){const e=t;this[e(447)][e(1189)]()}[t(377)](){const e=t;this[e(447)][e(377)]()}[t(408)](){this._imageService.moveLayerToBottom()}moveLayerUp(){this._imageService.moveLayerUp()}[t(310)](){const e=t;this[e(447)][e(310)]()}moveLayerTo(e,i){const s=t;this._imageService[s(644)](e.id,i.id)}async finishTemporaryLayer(){const e=t;await(this._imageService[e(381)]?.[e(351)]())}}class _e{constructor(e,i,s){const n=t;this[n(984)]=e,this[n(938)]=i,this[n(232)]=s,this[n(1744)]=new Map,this[n(984)][n(1496)]((()=>this[n(1744)].clear()))}get onDispose(){return this[t(984)].onSoftDeletedChange}get[t(1496)](){return this[t(984)].onUpdate}get id(){return this[t(984)].id}get[t(1027)](){const e=t;return this[e(984)][e(1027)]}set[t(1027)](e){const i=t;this._layer[i(1027)]=e}get blendMode(){const e=t;return this[e(984)][e(795)]}set[t(795)](e){this[t(984)].setBlendMode(e)}get[t(804)](){const e=t;return this._layer[e(804)]}set[t(804)](e){const i=t;this[i(984)][i(1558)](e)}[t(1248)](e,i){const s=t,n=e+"x"+i,o=this[s(1744)][s(1375)](n);if(o)return o;const r={data:this._layer[s(356)],width:this[s(984)][s(1564)],height:this[s(984)][s(918)]},a=this[s(232)][s(210)](r,e,i);return this[s(1744)][s(971)](n,a),a}[t(1733)](e){return this[t(984)].exportBlob(e)}async importBlob(e,i){const n=t,o=await this[n(984)][n(520)](e,i);this._selectionService[n(1707)]=(0,s.BN)(o.staticState.range),this[n(938)][n(1523)]("Set Paste Image Selection")}}class we{constructor(t){this._paletteService=t}get[t(634)](){const e=t;return this._paletteService[e(1496)]}get[t(1865)](){return this[t(1778)].primary}set primary(e){this[t(1778)].primary=e}get[t(1060)](){const e=t;return this._paletteService[e(1060)]}set secondary(e){const i=t;this[i(1778)][i(1060)]=e}[t(1123)](){this[t(1778)].swap()}}class ve{constructor(e){this[t(435)]=e}[t(1065)](){const e=t;this[e(435)][e(1065)]()}[t(1511)](){const e=t;this[e(435)][e(1511)]()}}class be{constructor(e,i){const s=t;this._imageService=e,this[s(938)]=i}get[t(1496)](){const e=t;return this._selectionService[e(1496)]}get range(){const e=t;return this._selectionService[e(1707)]}[t(1283)](){const e=t;this[e(938)][e(1283)]()}[t(648)](){const e=t;return this[e(447)][e(842)]()}[t(702)](){const e=t;return this[e(447)][e(702)]()}}class xe{constructor(t,e){this._taskService=t,this._taskWorkerService=e}get[t(1215)](){const e=t;return this[e(232)][e(1215)]}set disableWorkers(e){const i=t;this._taskWorkerService[i(1215)]=e}get[t(1807)](){const e=t;return this._taskService[e(1807)]}[t(1238)](e,i){const s=t;return this[s(304)][s(1238)](e,i)}[t(340)](e,i){const s=t;return this[s(304)][s(340)](e,i)}}class Ie{constructor(e,i,s,n,o,r){const a=t;this[a(1570)]=e,this[a(1765)]=i,this[a(447)]=s,this._paletteService=n,this[a(938)]=o,this[a(1547)]=r}get onToolChange(){const e=t;return this[e(1570)][e(636)]}get activeTool(){const e=t;return this[e(1570)][e(779)]?.id}get[t(1581)](){const e=t;return this[e(1570)][e(779)]?.[e(1581)]||[]}get[t(1377)](){const e=t;return this[e(1570)][e(779)]?.[e(1377)]||[]}get[t(943)](){return this[t(1570)].activeTool?.info||[]}async setTool(e,i){const s=t;await this[s(1570)].setTool(e,i)}}class Se{constructor(e,i){this[t(853)]=e,this._viewportService=i}get[t(1496)](){const e=t;return this._viewportService[e(1496)]}get[t(1563)](){const e=t;return this._viewportService[e(1563)]}get[t(286)](){const e=t;return this[e(1547)][e(286)]}get[t(1147)](){return this[t(1547)].onPointerCoordChange}get x(){return this[t(1547)].x}set x(e){this[t(1547)].x=e}get y(){return this[t(1547)].y}set y(e){this[t(1547)].y=e}get visibleRange(){const e=t;return this._viewportService[e(1249)]}get[t(1150)](){const e=t;return this[e(1547)][e(1150)]}set[t(1150)](e){const i=t;this._viewportService[i(1150)]=e}get[t(1308)](){const e=t;return this[e(1547)][e(1308)]}set[t(1308)](t){this._viewportService.isPixelGridEnabled=t}get mouseWheelBehavior(){return this[t(1547)].mouseWheelBehavior}set[t(968)](e){this[t(1547)].mouseWheelBehavior=e}[t(1613)](e){const i=t;this[i(853)][i(1613)](e)}[t(1836)](){const e=t;document.activeElement[e(871)]()}[t(583)](e){const i=t;this[i(1547)][i(583)](e)}zoomOut(e){const i=t;this[i(1547)][i(1178)](e)}[t(1752)](){const e=t;this[e(1547)][e(1752)]()}[t(259)](){const e=t;this[e(1547)][e(259)]()}}const Ee=t(1629),Ce=t(1199),Le=new Map;function Te(t){if(Le.has(t))return Le.get(t);const e=function(t,i,s){const n=a2_0x6447;if(3!==arguments[n(1225)])throw new Error(n(407));Ae(e,t,s)};return e.toString=()=>t,Le.set(t,e),e}function Ae(e,i,s){const n=t;i[Ee]===i?i[Ce][n(1686)]({id:e,index:s}):(i[Ce]=[{id:e,index:s}],i[Ee]=i)}const Re=Te(t(1230)),De=Te(t(1535)),Me=Te(t(1459));class Be{constructor(){this._commands=new Map}[t(1324)](e,i){const s=t;this[s(1508)][s(971)](e,i)}get(e){const i=t,s=this[i(1508)][i(1375)](e);if(!s)throw new Error(i(260)+e+'"');return s}[t(1711)](){const e=t;return this[e(1508)][e(1611)]()}}const ke=new Be;var Pe=function(t,e){return function(i,s){e(i,s,t)}};let Ue=class{constructor(e,i){this[t(776)]=e,this._contextKeyService=i}[t(1655)](e){return ke[t(1375)](e)}getAllCommands(){return ke[t(1711)]()}[t(698)](e){const i=t,s=ke[i(1375)](e);if(void 0===s[i(363)])return!0;const n=this[i(1071)][i(1375)](s[i(363)]);if(!n)return!0;const o=n[i(1375)]();return s[i(869)]?!o:o}[t(534)](e){const i=t;if(!this[i(698)](e))throw new Error(i(1315)+e+"\", it's disabled");const s=ke[i(1375)](e);return console[i(943)]("Command "+e+i(1322)),this[i(776)][i(1827)](s[i(361)])}filterCommands(e,i){const s=t,n=ke[s(1711)](),o=[];for(const t of n)if((t[s(355)]+": "+t[s(184)])[s(1349)]().includes(e[s(1349)]())&&(o.push(t),o[s(1225)]===i))return o;return o}};Ue=function(e,i,s,n){const o=t;var r,a=arguments[o(1225)],h=a<3?i:null===n?n=Object[o(224)](i,s):n;if(typeof Reflect===o(383)&&typeof Reflect[o(1177)]===o(575))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1167)](i,s,h),h}([Pe(0,Me),Pe(1,De)],Ue);class Fe{constructor(){const e=t;this[e(1057)]=void 0,this[e(1276)]=new Map}[t(1375)](e){return this[t(1276)].get(e)}[t(1174)](t,e){const i=new Ne(e);return this._contextKeys.set(t,i),i}}class Ne extends e.JT{constructor(e){const i=t;super(),this[i(316)]=e,this[i(299)]=this.register(new n.v),this.onUpdate=this[i(299)][i(1545)],this[i(1702)]=this._defaultValue}set(e){const i=t;this._value!==e&&(this[i(1702)]=e,this[i(299)][i(443)](e))}reset(){this[t(971)](this._defaultValue)}get(){return this[t(1702)]}}const Oe=Te(t(1757)),Ve=Te(t(723));class He{constructor(...e){const i=t;this[i(1639)]=new Map;for(const[t,s]of e)this[i(971)](t,s)}[t(971)](e,i){const s=t,n=this[s(1639)].get(e);return this[s(1639)][s(971)](e,i),n}[t(324)](e){const i=t;this[i(1639)][i(324)](((t,i)=>e(i,t)))}[t(905)](e){const i=t;return this[i(1639)][i(905)](e)}[t(1375)](e){const i=t;return this[i(1639)][i(1375)](e)}}class ze{constructor(){const e=t;this[e(1037)]=new He,this._services[e(971)](Me,this)}[t(191)](e,i){const s=t;this[s(1037)][s(971)](e,i)}[t(537)](e){return this[t(1037)].get(e)}[t(1426)](e,...i){const s=t,n=(r=e,r[Ce]||[])[s(1457)](((t,e)=>t.index-e.index)),o=[];var r;for(const t of n){const i=this[s(1037)].get(t.id);if(!i)throw new Error(s(948)+e.name+" depends on UNKNOWN service "+t.id+".");o.push(i)}const a=n[s(1225)]>0?n[0][s(632)]:i.length;if(i[s(1225)]!==a)throw new Error("[createInstance] First service dependency of "+e[s(1027)]+s(649)+(a+1)+" conflicts with "+i[s(1225)]+" static arguments");return new e(...[...i,...o])}[t(1827)](t,...e){return t({get:t=>{const e=a2_0x6447,i=this[e(537)](t);if(!i)throw new Error(e(1458)+t+"'");return i}},...e)}}const We=Te(t(1786)),je=Te("ILunaService"),qe=Te(t(1692));class Ge extends e.JT{constructor(){const e=t;super(...arguments),this[e(691)]=new Map([[1,new Xe],[0,new Xe]]),this[e(1192)]=this[e(1324)](new n.v),this[e(1695)]=this[e(1192)].event,this[e(940)]=this[e(1324)](new n.v),this[e(1682)]=this[e(940)][e(1545)],this[e(1618)]=this[e(1324)](new n.v),this.onDidAddBottomItem=this[e(1618)][e(1545)],this[e(1619)]=this.register(new n.v),this[e(1848)]=this[e(1619)][e(1545)]}[t(1654)](e){const i=t,s=this[i(691)][i(1375)](e[i(189)]),n=0===e[i(1250)]?s[i(993)]:s[i(1813)];if(n[i(905)](e))throw new Error(i(1242));return n[i(1591)](e),(0===e[i(189)]?this[i(1192)]:this[i(1618)]).fire(e),{dispose:()=>{this[i(1720)](e)}}}[t(1437)](e){const i=t;return this._items[i(1375)](e)[i(993)][i(1611)]()}[t(442)](e){const i=t;return this[i(691)][i(1375)](e)[i(1813)].values()}_removeItem(e){const i=t,s=this[i(691)][i(1375)](e[i(189)]);(0===e[i(1250)]?s[i(993)]:s[i(1813)])[i(985)](e),(0===e[i(189)]?this[i(940)]:this._onDidRemoveBottomItem)[i(443)](e)}}class Xe{constructor(){const e=t;this.leftItems=new Set,this[e(1813)]=new Set}}const Je=Te(t(733)),Ye=Te("ViewService"),Ke=Te(t(1718));class $e{constructor(){this[t(958)]=new Map}[t(1324)](t,e){this._views.set(t,e)}[t(1375)](e){const i=t,s=this[i(958)][i(1375)](e);if(!s)throw new Error(i(974)+e+'"');return s}[t(1711)](){const e=t;return this[e(958)][e(403)]()}}const Ze=new $e;class Qe{constructor(){this[t(958)]=new Map}[t(1324)](e,i){const s=t;this[s(958)][s(971)](e,i)}get(e){const i=t,s=this[i(958)].get(e);if(!s)throw new Error(i(1859)+e+'"');return s}[t(1711)](){const e=t;return this._views[e(403)]()}}const ti=new Qe;var ei=function(e,i,s,n){const o=t;var r,a=arguments[o(1225)],h=a<3?i:null===n?n=Object[o(224)](i,s):n;if("object"==typeof Reflect&&typeof Reflect[o(1177)]===o(575))h=Reflect[o(1177)](e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1167)](i,s,h),h},ii=function(t,e){return function(i,s){e(i,s,t)}};let si=class extends e.JT{constructor(e,i){const s=t;super(),this._instantiationService=e,this._stateService=i,this[s(958)]=new Map,this[s(1758)]=!1,this[s(421)]=new Map,this[s(715)]=new Map,this._onStateChange=this[s(1324)](new n.v),this.onStateChange=this._onStateChange[s(1545)],this[s(924)]=this[s(1324)](new n.v),this[s(1294)]=this[s(924)][s(1545)];for(const[t,e]of Ze[s(1711)]()){let i;switch(e[s(1471)]){case"top":i=this._instantiationService[s(1426)](e[s(533)],document.querySelector("#top"));break;case s(799):i=this[s(776)][s(1426)](e[s(533)],document[s(1252)](s(249)))}i&&this[s(958)][s(971)](t,i)}this[s(824)]=document[s(1252)](s(1456));for(const[t,e]of ti[s(1711)]())e[s(1378)]&&this[s(977)](t,e);window[s(297)](s(178),(()=>this[s(1052)]())),(0,n.B)(this[s(829)],this[s(924)]),this[s(1473)][s(1301)](s(891),this)}[t(1052)](){const e=t;for(const[t,i]of this[e(421)][e(403)]())if(i){const s=this._views.get(t);if(s&&e(364)in s){if(this._isWindowAnchor(i?.x)&&i?.x[e(189)]||this._isWindowAnchor(i?.y)&&i?.y[e(189)])continue;this[e(1856)](s,i||ti[e(1375)](t)[e(979)])}}}[t(1343)](e){const i=t,s=this[i(958)][i(1375)](e);s?s[i(804)]=!s[i(804)]:this[i(977)](e,ti[i(1375)](e)),!1===s?.[i(804)]&&this[i(715)][i(985)](e),!this[i(1758)]&&(this[i(490)][i(443)](),this[i(962)](e))}[t(1159)](e){const i=t,s=this[i(958)][i(1375)](e);s&&s.isVisible&&(s[i(804)]=!1,this[i(715)][i(985)](e),!this[i(1758)]&&(this._onStateChange.fire(),this[i(962)](e)))}showView(e){const i=t,s=this._views.get(e);s?!s[i(804)]&&(s[i(804)]=!0,!this[i(1758)]&&(this._onStateChange[i(443)](),this[i(962)](e))):this[i(1343)](e)}isVisible(e){const i=t;return this[i(958)][i(1375)](e)?.[i(804)]||!1}_createWindowView(e,i){const s=t,n=this[s(776)][s(1426)](i[s(533)],this[s(824)]);this[s(1856)](n,i[s(979)]),n[s(1207)]((()=>{const t=s;!1===n[t(804)]&&(n[t(980)](),this[t(958)].delete(e),!this[t(1758)]&&(this[t(490)][t(443)](),this._layoutDependentViews(e)),this[t(715)].delete(e))})),n[s(1764)]((t=>{const e=s;!this[e(752)]&&setTimeout((()=>{const i=e;this._dropTargetElement=document.createElement(i(1683)),this[i(752)][i(175)][i(1591)](i(415)),this[i(752)].style[i(277)]=i(318),this[i(752)][i(297)](i(1440),(e=>{const s=i,o=this._viewsElement[s(848)](),r=e[s(1495)]+t[s(1575)]-o[s(707)]-10+t[s(1564)]/2>o.width/2?"end":s(1573),a=e[s(320)]+t[s(680)]-o[s(1082)]-10+t[s(918)]/2>o[s(918)]/2?s(185):s(1573);let h,c;h=r===s(1573)?e[s(1495)]+t[s(1575)]-o[s(707)]-10:o[s(1564)]-(e[s(1495)]+t[s(1575)])-t[s(1564)]-10,c=a===s(1573)?e[s(320)]+t[s(680)]-o[s(1082)]-10:o.height-(e[s(320)]+t[s(680)])-t[s(918)]+10+1,this._updateWindowViewPosition(n,{x:{side:r,distance:Math[s(282)](h,0)},y:{side:a,distance:Math[s(282)](c,0)}})})),this[i(752)][i(297)](i(686),(t=>t[i(787)]())),this[i(824)][i(598)](this[i(752)])}))})),n[s(1676)]((()=>{const t=s;this[t(752)]&&(this[t(824)][t(1019)](this[t(752)]),this[t(752)]=void 0),this[t(490)][t(443)]()})),this[s(958)][s(971)](e,n)}_updateWindowViewPosition(e,i){const s=t;let n,o,r,a;this._windowPosition[s(971)](e.id,i),this._windowResolvedPosition[s(985)](e.id);const h=this[s(1829)](i.x)?i.x[s(189)]:void 0,c=this._isWindowAnchor(i.y)?i.y[s(189)]:void 0,l=this[s(1829)](i.x)?i.x[s(1762)]:i.x;let d=this[s(1829)](i.x)?(i.x[s(1053)]||0)+10:10;if(h){const t=this._windowResolvedPosition.get(h);t&&(d+=(l===s(1573)?t.left:t[s(895)])||0,d+=this[s(958)][s(1375)](h)?.[s(918)]||0)}if("start"===l?a=(0,w.u)(d,this[s(824)][s(1119)]-e[s(1564)]-10,10):o=(0,w.u)(d,this[s(824)][s(1119)]-e[s(1564)]-10,10),!h&&c){const t=this[s(715)][s(1375)](c);t&&(a=t[s(707)],o=t[s(895)])}let u=this._isWindowAnchor(i.y)?i.y[s(1762)]:i.y,m=this[s(1829)](i.y)?(i.y[s(1053)]||0)+10:10;if(c){const t=this[s(421)][s(1375)](c),i=this[s(715)][s(1375)](c);if(i&&(void 0!==i[s(1082)]?m=i[s(1082)]-m-this[s(958)][s(1375)](e.id)?.height||0:void 0!==i[s(799)]&&(m+=i[s(799)]),t)){const e=this._getAnchorSide(t.y);u===e&&(m+=this[s(958)][s(1375)](c)?.[s(918)]||0),u=e}}if(u===s(1573)?n=(0,w.u)(m,this[s(824)][s(656)]-e[s(918)]-10,10):r=(0,w.u)(m,this[s(824)][s(656)]-e[s(918)]-10,10),!c&&h){const t=this[s(715)][s(1375)](h);t&&(n=t[s(1082)],r=t.bottom)}e[s(364)](n?n+"px":"",o?o+"px":"",r?r+"px":"",a?a+"px":""),this[s(715)].set(e.id,{top:n,right:o,bottom:r,left:a}),this._layoutDependentViews(e.id)}[t(962)](e){const i=t;for(const t of this._views[i(1611)]()){if(!(i(364)in t))continue;const s=this[i(421)].get(t.id)||ti[i(1375)](t.id)[i(979)];t[i(804)]&&(this[i(1829)](s.x)&&s.x[i(189)]===e||this[i(1829)](s.y)&&s.y[i(189)]===e)&&this[i(1856)](t,s)}}[t(1428)](){const e=t,i=[];for(const t of this[e(958)][e(1611)]())i[e(1686)]({id:t.id,position:this[e(421)][e(1375)](t.id),isVisible:t[e(804)]});return{views:i}}[t(1849)](e){const i=t;this._isRestoringState=!0;for(const t of e[i(883)])t[i(804)]?this[i(1448)](t.id):this.hideView(t.id);for(const t of this[i(958)][i(1129)]()){let s=!1;for(const n of e[i(883)].values())if(n.id===t){s=!0;break}!s&&this.hideView(t)}for(const t of e[i(883)])if(t.isVisible){const e=this._views[i(1375)](t.id);if(e&&i(364)in e){if(this[i(1829)](t[i(544)]?.x)&&t[i(544)]?.x[i(189)]||this[i(1829)](t.position?.y)&&t[i(544)]?.y[i(189)])continue;this._updateWindowViewPosition(e,t.position||ti[i(1375)](t.id)[i(979)])}}this._isRestoringState=!1}[t(1829)](t){return!!t&&"string"!=typeof t}[t(1015)](e){const i=t;return this._isWindowAnchor(e)?e[i(1762)]:e}};var ni;ei([(500,ni=(t,e)=>{const i="$debounce$"+e,s="$debounce$result$"+e;return function(...e){!this[s]&&(this[s]=void 0),clearTimeout(this[i]),this[i]=setTimeout((()=>{t[a2_0x6447(780)](this,e),this[s]=void 0}),500)}},(t,e,i)=>{const s=a2_0x6447;let n=null,o=null;if(typeof i[s(710)]===s(575)?(n=s(710),o=i[s(710)]):typeof i[s(1375)]===s(575)&&(n="get",o=i[s(1375)]),!o)throw new Error(s(1118));i[n]=ni(o,e)})],si[t(1759)],t(1052),null),si=ei([ii(0,Me),ii(1,Ke)],si);const oi=Te("MinimapService");class ri extends e.JT{constructor(){const e=t;super(...arguments),this._showViewport=!0,this[e(1572)]=!0,this[e(1512)]=this[e(1324)](new n.v),this[e(862)]=this[e(1512)][e(1545)],this._onStretchEnabledChange=this.register(new n.v),this[e(192)]=this[e(1274)].event}get[t(295)](){return this[t(1434)]}set[t(295)](e){const i=t;this[i(1434)]!==e&&(this[i(1434)]=e,this[i(1512)][i(443)](e))}get isStretchEnabled(){return this[t(1572)]}set[t(1586)](e){const i=t;this._isStretchEnabled!==e&&(this._isStretchEnabled=e,this[i(1274)].fire(e))}}class ai extends e.JT{constructor(){const e=t;super(...arguments),this._stateHandlers=new Map,this[e(1237)]=new Map,this[e(490)]=this[e(1324)](new n.v),this.onStateChange=this._onStateChange.event}get[t(1087)](){const e=t,i=[];for(const[t,s]of this[e(1237)][e(403)]())i[e(1686)]({id:t,state:s});return{version:2,entries:i}}[t(1301)](e,i){const s=t;if(this._stateHandlers[s(905)](e))throw new Error('State handler for id "'+e+'" already exists');this[s(1045)][s(971)](e,i),i[s(829)]((()=>{const t=this[s(1801)](i,e);this._onStateChange.fire({id:e,state:t})}))}[t(1801)](e,i){const s=t,n=e[s(1428)]();return this[s(1237)][s(971)](i,n),n}[t(1474)](t){return this._stateHandlers.has(t)}[t(1849)](e){const i=t;if(e)if(2===e[i(459)])for(const t of e[i(403)]){const e=this[i(1045)].get(t.id);e?e[i(1849)](t[i(1087)]):console[i(1183)]('No state handler for id "'+t.id+i(1537))}else console.warn(i(1855)+e[i(459)]+" < 2)");else for(const[t,e]of this[i(1045)][i(403)]())this[i(1801)](e,t)}}class hi{constructor(){this[t(1518)]=[]}[t(1324)](e){const i=t;this[i(1518)][i(1686)](e)}[t(1711)](){return this._contributions.values()}[t(624)](){const e=t;this._contributions[e(1225)]=0}}const ci=new hi;const li=Te(t(1732));class di{constructor(e){const i=t;this[i(202)]=e,this.serviceBrand=void 0,this._extHostRequestHandlers=new Map,this[i(770)]=new Map,window[i(297)](i(908),(async t=>{const e=i;if(e(1143)in t[e(356)]){const i=t.data[e(1143)],s=this[e(770)][e(1375)](i);if(!s)throw new Error(e(1860)+i+'"');return this._activeRequests[e(985)](i),void s(this[e(769)](t[e(356)]))}if(e(595)in t[e(356)]){const i=this._extHostRequestHandlers[e(1375)](t[e(356)][e(352)]);if(!i)throw new Error(e(868)+t[e(356)].type+'"');const s=await i(this[e(769)](t[e(356)])),n={type:t.data.type,body:s,extHostRequestId:t[e(356)][e(595)]};this._vscodeApi.postMessage(n)}}))}[t(427)](e,i){const s=t;if(this[s(587)][s(905)](e))throw new Error(s(801)+e+'"');this[s(587)].set(e,i)}async[t(1420)](e,i){const s=t,n=Math[s(827)](1e6*Math[s(326)]());return new Promise((t=>{const o=s;this[o(770)][o(971)](n,t),this[o(202)][o(1727)]({type:e,body:i,webviewRequestId:n})}))}[t(769)](e){const i=t;if(void 0===e.body)return e[i(816)];const s=e[i(816)];for(const t of Object.keys(s)){const e=s[t];"object"==typeof e&&i(352)in e&&"Buffer"===e[i(352)]&&(s[t]=new Uint8Array(e[i(356)]))}return s}}class ui{[t(1324)](t){}getAll(){return[][t(1611)]()}}let mi=class{constructor(e){this[t(1789)]=e}async[t(897)](e){const i=t;return this[i(1789)][i(187)]("",e)}};var gi,fi;mi=function(e,i,s,n){const o=t;var r,a=arguments[o(1225)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(383)&&typeof Reflect[o(1177)]===o(575))h=Reflect[o(1177)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([(gi=0,fi=Je,function(t,e){fi(t,e,gi)})],mi);class pi{constructor(){}async open(){throw new Error(t(1130))}async save(){throw new Error(t(1130))}async[t(659)](){throw new Error(t(1130))}}async function yi(t){return new Promise((e=>setTimeout(e,t)))}var _i=function(t,e){return function(i,s){e(i,s,t)}};let wi=class{constructor(e,i){this[t(414)]=e,this._lunaService=i}async requestLayerTaskOptions(e){const i=t;switch(e){case i(1061):{const t=await this[i(1527)]();await yi(50);const e=await this[i(414)][i(1420)](i(815),{items:[{id:i(1268),label:i(1166),description:i(671),detail:"Gets the color by averaging the values of surrounding pixels."},{id:i(925),label:"Nearest neighbor",description:i(1463),detail:i(1284)}],options:{placeHolder:i(561)}});if(void 0===e)throw new Error(i(312));return{...t,resampling:e}}case i(1592):{const t=await this[i(1527)]();await yi(50);const e=await this[i(414)][i(1420)](i(815),{items:[{id:"topleft",label:i(1861),description:"↘"},{id:i(1082),label:"Top",description:"↓"},{id:"topright",label:i(440),description:"↙"},{id:i(707),label:i(930),description:"→"},{id:"middle",label:"Middle",description:"·"},{id:i(895),label:"Right",description:"←"},{id:i(1488),label:i(1543),description:"↗"},{id:i(799),label:i(677),description:"↑"},{id:i(466),label:i(997),description:"↖"}],options:{placeHolder:i(206)}});if(void 0===e)throw new Error(i(820));return{...t,anchor:e}}default:throw new Error("Options for task "+e+i(642))}}async[t(1527)](){const e=t;await yi(50);const i=await this[e(414)][e(1420)]("inputBoxNumberOrDimensionsShorthand",{prompt:"Enter the width of the image (or wxh shorthand)",defaultValue:this[e(1107)].layer.width,minValue:1});if(void 0===i)throw new Error(e(749));let s,n;if(typeof i===e(563)?(await yi(50),s=i,n=await this[e(414)][e(1420)](e(293),{prompt:e(1360),defaultValue:this[e(1107)][e(947)][e(918)],minValue:1})):(s=i[e(1564)],n=i[e(918)]),void 0===n)throw new Error(e(315));return{width:s,height:n}}async[t(187)](e,i){const s=t;return await yi(50),await this[s(414)][s(1420)]("quickPick",{options:{placeHolder:e},items:i})}async[t(1560)](e,i){const s=t;return await yi(50),await this[s(414)][s(1420)](s(1647),{prompt:e,defaultValue:i})}async[t(956)](e,i,s,n){const o=t;return await yi(50),await this[o(414)].request("inputBoxNumber",{prompt:e,defaultValue:i,minValue:s,maxValue:n})}};wi=function(e,i,s,n){const o=t;var r,a=arguments[o(1225)],h=a<3?i:null===n?n=Object[o(224)](i,s):n;if(typeof Reflect===o(383)&&"function"==typeof Reflect[o(1177)])h=Reflect[o(1177)](e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1167)](i,s,h),h}([_i(0,li),_i(1,je)],wi);class vi{constructor(){this._entries=[]}[t(1324)](e){const i=t;this[i(1639)][i(1686)](e)}[t(1711)](){return this[t(1639)]}[t(624)](){const e=t;this[e(1639)][e(1225)]=0}}const bi=new vi;function xi(e){const i=t;if(ke[i(1324)](e.id,{id:e.id,label:e[i(184)],section:e[i(355)],run:e[i(361)],checked:e[i(1728)],negateChecked:e[i(1106)],enabled:e.enabled,negateEnabled:e[i(869)]}),e[i(1129)])if(Array[i(783)](e.keys))for(const t of e[i(1129)])bi.register({commandId:e.id,keys:t});else bi[i(1324)]({commandId:e.id,keys:e.keys})}xi({id:t(1445),label:"Invert",section:t(578),run:async e=>{const i=t,s=e.get(je);s[i(788)][i(340)](i(1713),{selection:s[i(1814)][i(1707)]})},keys:t(1568)});class Ii extends e.JT{constructor(e,i){const s=t;super(),this._contentElement=document[s(1296)](s(1683)),this[s(1769)].id=i[s(1349)]()[s(394)](/ /g,""),this[s(1769)][s(175)][s(1591)]("view",s(819)),e.appendChild(this[s(1769)]),this[s(1324)]({dispose:()=>{const t=s;e[t(1019)](this[t(1769)])}})}}let Si=class extends Ii{constructor(e,i){const s=t;super(e,s(1190)),this[s(1664)]=i,this[s(719)]=[];const n=document[s(1296)]("div");n[s(175)][s(1591)](s(995)),this[s(418)]=document[s(1296)](s(461)),this[s(418)][s(352)]=s(1009),this[s(418)][s(297)](s(461),(()=>this[s(1080)]())),this[s(418)][s(297)](s(1621),(t=>this[s(694)](t))),n[s(598)](this[s(418)]);const o=document[s(1296)]("ul");o[s(175)].add("cmd-palette-list");for(let t=0;t<18;t++)this[s(719)][s(1686)](this[s(1606)]());o[s(705)](...this[s(719)]),this._fillCommands(),this[s(1769)].classList[s(1591)](s(898)),this[s(1769)][s(705)](n,o),this[s(418)][s(1836)]()}[t(1606)](){return document[t(1296)]("li")}[t(1080)](){const e=t,i=this._commandService[e(1546)](this._inputElement.value,18);let s=0;for(;s<i.length;s++){const t=i[s],n=this[e(719)][s];n[e(1698)]=t[e(355)]+": "+t.label,n[e(175)].remove(e(1439))}for(;s<18;s++)this._listItemElements[s][e(175)].add(e(1439))}_keyDown(e){const i=t;if(e[i(1094)]===i(1016)){const t=this[i(1664)][i(1546)](this[i(418)][i(710)],18);return t[i(1225)]>0&&this[i(1664)][i(534)](t[0].id),void this.dispose()}}};var Ei;let Ci;async function Li(e){const i=t,s=document[i(1165)];if("INPUT"===s?.[i(487)]){const t=s;let e;return e=null===t.selectionStart||null===t[i(1044)]||t[i(1809)]===t[i(1044)]?t[i(710)]:t[i(710)].substring(t[i(1809)],t[i(1044)]),void navigator[i(1602)].writeText(e)}const n=e[i(1375)](je);if(!n[i(1814)][i(1707)])return;const o=n[i(947)].activeLayer;if(!o)return;const r=await o[i(1733)]({range:n[i(1814)][i(1707)],useMovingLayer:!0});Ci=n[i(1814)][i(1707)],await Ei.write(r)}var Ti,Ai;Si=function(e,i,s,n){const o=t;var r,a=arguments[o(1225)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(383)&&typeof Reflect[o(1177)]===o(575))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1167)](i,s,h),h}([(Ti=1,Ai=Re,function(t,e){Ai(t,e,Ti)})],Si),xi({id:t(241),label:"Show All Commands",section:t(482),run:e=>{const i=t;e[i(1375)](Me)[i(1426)](Si,document.body)},keys:[t(601),"f1"]}),function(e){const i=t;e[i(856)]=async function(t){const e=a2_0x6447,i=new ClipboardItem({"image/png":t});if(!(e(856)in navigator[e(1602)]))throw new Error(e(382));await navigator[e(1602)][e(856)]([i])},e[i(524)]=async function(){const t=i;return(await navigator.permissions[t(1344)]({name:"clipboard-read"})).state!==t(1779)||(console[t(1583)](t(467)),!1)},e.read=async function(){const t=i;if((await navigator.permissions[t(1344)]({name:t(1810)}))[t(1087)]===t(1779))return void console.error("Access to clipboard-read was denied");const e=await navigator[t(1602)][t(476)]();for(const i of e){if(i[t(581)][t(712)](t(203)))return await i.getType(t(203));console[t(1235)](t(329))}}}(Ei||(Ei={})),ci[t(1324)]({start(e){const i=t,s=e.get(je),n=e[i(1375)](De)[i(1174)](8,!1),o=e[i(1375)](De).bind(7,!1);s[i(1145)][i(860)]((()=>{const t=i;n[t(971)](s[t(1145)].canRedo),o.set(s[t(1145)][t(1811)])}))}}),xi({id:t(1086),label:"Cut",section:t(1620),run:function(e){const i=t,s=e[i(1375)](je);return s[i(1145)][i(434)](i(566),(async()=>{const t=i;await Li(e),await s.selection[t(648)]()}))},keys:"cmdctrl+x"}),xi({id:t(445),label:t(1696),section:t(1620),run:Li,keys:t(510)}),xi({id:t(766),label:t(214),section:"Edit",run:async function(e){const i=t,s=e[i(1375)](je),n=s[i(947)].activeLayer;if(!n)return;if(!Ei[i(524)]())return;await s[i(947)][i(351)]();const o=await Ei.read();o&&await s[i(1145)][i(434)](i(882),(()=>n[i(520)](o,Ci)))},keys:t(287)}),xi({id:t(627),label:t(1754),section:t(1620),run:e=>e.get(je)[t(1145)][t(474)](),keys:le.V?"cmd+shift+z":t(275),enabled:8}),xi({id:"edit.undo",label:"Undo",section:t(1620),run:e=>e.get(je)[t(1145)][t(289)](),keys:t(685),enabled:7}),xi({id:t(389),label:"New",section:t(1281),run:e=>e[t(1375)](je)[t(432)][t(1472)](20,15),keys:t(1808)}),xi({id:"file.open",label:t(1209),section:t(1281),run:async e=>e.get(Ve)[t(1260)](),keys:t(1525)}),xi({id:t(1352),label:t(1742),section:"File",run:async e=>e.get(Ve)[t(1341)](),keys:"ctrl+s"}),xi({id:t(1380),label:"Save As",section:"File",run:async e=>e[t(1375)](Ve)[t(659)](),keys:t(333)});class Ri extends e.JT{constructor(e,i,s){const o=t;super(),this.id=e,this[o(824)]=i,this[o(607)]=!0,this[o(330)]=this[o(1324)](new n.v),this[o(1207)]=this._onDidChangeVisibilityEmitter[o(1545)],this[o(450)]=this[o(1324)](new n.v),this.onDidStartDrag=this[o(450)][o(1545)],this._onDidEndDrag=this[o(1324)](new n.v),this[o(1676)]=this[o(1269)][o(1545)],this[o(1773)]=document[o(1296)]("div"),this[o(1773)].id=s[o(1349)]().replace(/ /g,""),this._viewElement.classList[o(1591)](o(246),"window");const r=document.createElement("div");r.classList[o(1591)](o(955)),r[o(297)](o(1636),(()=>this[o(1773)][o(866)]=!0)),r[o(297)](o(404),(()=>this[o(1773)][o(866)]=!1)),r[o(297)](o(1430),(t=>t[o(787)]())),this[o(1773)][o(297)](o(1338),(t=>{const e=o;t[e(1785)]&&(t[e(1785)][e(806)]="move",t.dataTransfer[e(1660)]="move");const i=this[e(1773)][e(848)]();this._onDidStartDrag.fire({offsetX:i.left-t[e(1495)],offsetY:i[e(1082)]-t[e(320)],width:i[e(1564)],height:i[e(918)]})})),this._viewElement[o(297)](o(1110),(()=>this._onDidEndDrag.fire()));const a=document[o(1296)]("div");a[o(175)][o(1591)](o(1403)),a[o(1698)]=s,this[o(904)]=document[o(1296)]("div"),this._headerContentElement.classList.add(o(248));const h=document[o(1296)]("button");h[o(175)][o(1591)](o(325),o(468)),h[o(545)](o(1465),"Close "+s+" window"),h[o(297)]("mousedown",(t=>t.stopImmediatePropagation())),h.addEventListener(o(1550),(()=>this[o(804)]=!1)),r[o(705)](a,this._headerContentElement,h),this._contentElement=document[o(1296)]("div"),this._contentElement[o(175)][o(1591)](o(386)),this._viewElement[o(705)](r,this[o(1769)]),this[o(824)][o(598)](this[o(1773)]),this[o(1324)]({dispose:()=>{const t=o;this[t(824)][t(1019)](this[t(1773)])}})}get isVisible(){return this._isVisible}set[t(804)](e){const i=t;this[i(607)]=e,this[i(330)][i(443)](e)}get[t(918)](){const e=t;return this._viewElement[e(848)]()[e(918)]}get[t(1564)](){const e=t;return this[e(1773)][e(848)]().width}[t(364)](e,i,s,n){const o=t;this[o(1773)].style[o(1082)]=e||"",this[o(1773)][o(1712)][o(895)]=i||"",this._viewElement[o(1712)][o(799)]=s||"",this[o(1773)][o(1712)][o(707)]=n||""}}var Di=function(t,e){return function(i,s){e(i,s,t)}};let Mi=class e extends Ri{constructor(e,i,s){const n=t;super(n(1145),e,n(1186)),this[n(1637)]=i,this[n(1071)]=s,this[n(719)]=[],this[n(366)]=this[n(1071)].bind(5,!0),this[n(1324)](this.onDidChangeVisibility((t=>this[n(366)][n(971)](t)))),this[n(1240)]=document[n(1296)]("ul"),this[n(1240)][n(175)][n(1591)]("history-list"),this[n(1324)](this[n(1637)][n(1145)].onEntriesChange((()=>this._render()))),this._render(),this[n(1769)][n(598)](this._listElement)}[t(444)](){const i=t,s=document.createDocumentFragment(),n=this[i(1637)][i(1145)][i(385)];let o,r=!1,a=!1;for(const[t,h]of this[i(1637)].history[i(403)][i(403)]()){let c;if(t<this[i(719)][i(1225)])c=this[i(719)][t];else{c=document[i(1296)]("li"),c[i(1703)]=0;const n=async()=>{const s=i;if(!this[s(1637)][s(1145)][s(385)])return;const n=t-this[s(1637)].history[s(403)][s(226)](this[s(1637)][s(1145)][s(385)]),o=n>0?e[s(687)]?e.redoHandler:this[s(1637)][s(1145)][s(474)]:e[s(1740)]?e.undoHandler:this._luna[s(1145)][s(289)];for(let t=0;t<Math[s(1520)](n);t++)await o()};c[i(297)](i(1550),(()=>n())),c.addEventListener(i(1621),(t=>{const e=i;switch(t[e(1094)]){case"ArrowUp":c.previousSibling?.[e(1836)](),t[e(787)](),t[e(1017)]();break;case e(1373):c[e(1561)]?.[e(1836)](),t.preventDefault(),t[e(1017)]();break;case"Enter":case e(1477):n(),t.preventDefault(),t.stopImmediatePropagation()}})),s[i(598)](c),this[i(719)][i(1686)](c)}c[i(1698)]=h[i(306)],c[i(175)][i(1414)](i(474),r),a=h===n,c[i(175)].toggle(i(1376),a),a&&(r=!0,o=c)}for(this._listElement[i(598)](s);this[i(719)][i(1225)]>this[i(1637)].history[i(403)][i(1225)];)this[i(1240)][i(1019)](this[i(719)].pop());o?(this[i(1769)][i(465)]+this._listElement.offsetTop>o.offsetTop||this[i(1769)][i(465)]<o.offsetTop-this._contentElement[i(656)])&&(this._contentElement.scrollTop=o[i(1624)]-this[i(1240)][i(1624)]):this[i(1769)][i(465)]=this[i(1769)][i(929)]}};Mi=function(e,i,s,n){const o=t;var r,a=arguments[o(1225)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(383)&&typeof Reflect[o(1177)]===o(575))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([Di(1,je),Di(2,De)],Mi),ti[t(1324)](t(1145),{ctor:Mi,defaultVisible:!0,defaultPosition:{x:t(185),y:t(1573)}}),xi({id:t(342),label:t(935),section:t(194),checked:5,run:e=>e[t(1375)](Ye)[t(1343)](t(1145))});let Bi=class extends e.JT{constructor(e){const i=t;super(),this[i(1107)]=e,this[i(189)]=1,this[i(1250)]=1,this[i(521)]=i(1716),this[i(720)]=!0,this[i(880)]=i(1502),this._onUpdate=this[i(1324)](new n.v),this[i(1496)]=this._onUpdate[i(1545)],this[i(1107)][i(947)].onDidChangeDimensions((()=>this[i(1603)]())),this._update()}[t(1603)](){const e=t;(this[e(317)]!==this[e(1107)][e(947)][e(1564)]||this[e(211)]!==this[e(1107)][e(947)][e(918)])&&(this[e(317)]=this[e(1107)][e(947)][e(1564)],this[e(211)]=this[e(1107)].layer[e(918)],this.text=this[e(317)]+e(193)+this[e(211)],this[e(1403)]=e(741)+this[e(317)]+e(765)+this[e(211)]+" pixels tall",this[e(299)].fire())}};var ki,Pi;Bi=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(224)](i,s):n;if(typeof Reflect===o(383)&&typeof Reflect[o(1177)]===o(575))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1167)](i,s,h),h}([(ki=0,Pi=je,function(t,e){Pi(t,e,ki)})],Bi);var Ui=function(t,e){return function(i,s){e(i,s,t)}};let Fi=class extends Ri{constructor(i,s,n,o,r,a){const h=t;super(h(255),i,h(602)),this[h(1637)]=s,this[h(1664)]=n,this[h(1071)]=o,this[h(951)]=r,this._quickPickService=a,this[h(1839)]=new Map,this[h(1098)]=new Map,this[h(366)]=this._contextKeyService[h(1174)](1,!0),this.register(this.onDidChangeVisibility((t=>this[h(366)][h(971)](t)))),this[h(975)]=document[h(1296)](h(1683)),this[h(975)][h(175)][h(1591)]("image-list");const c=document.createElement("div");c.classList[h(1591)]("actions"),c[h(705)](this[h(431)]("image-new",(()=>this[h(1664)][h(534)]("image.addNewImage")),h(1204)),this._createButton(h(268),(()=>this[h(1637)][h(1020)][h(1794)]()),h(549)),this[h(431)](h(1161),(()=>this._luna[h(1020)].moveImageUp()),h(190)),this[h(431)]("image-move-down",(()=>this._luna.image[h(1588)]()),h(1863))),this[h(1769)][h(705)](this[h(975)],c),this[h(1324)](this[h(1637)][h(1020)][h(1864)]((()=>this._renderImages()))),this.register({dispose:()=>{const t=h;for(const i of this[t(1839)].values())(0,e._c)(i[t(809)])}}),this[h(1407)]()}[t(431)](e,i,s){const n=t,o=document.createElement("button");o.id=e,o[n(1403)]=s;const r=document[n(1296)](n(250));return o.appendChild(r),o[n(175)][n(1591)](e,n(468)),o[n(297)](n(1550),i),o}[t(1077)](){const e=t,i=this[e(1637)].image[e(1479)];if(this._imagesMap[e(624)](),i)for(const t of i)this[e(1098)].set(t.id,t)}_renderImages(){const i=t,s=this[i(1637)].image[i(1479)],n=this[i(1637)][i(1020)].activeImage;if(!s||void 0===n)return;this._rebuildImageCache();let o=null;const r=s;for(let t=r[i(1225)]-1;t>=0;t--){const s=t,a=r[t].id;if(!this[i(1839)][i(905)](a)){const t={container:document[i(1296)](i(1683)),nameSpan:document.createElement(i(616)),previewCanvas:document[i(1296)]("canvas"),disposables:[]};t.container[i(175)][i(1591)](i(630)),t.previewCanvas[i(175)][i(1591)]("preview"),t[i(402)].width=40,t[i(402)].height=40;let n=!1;t[i(809)].push(this[i(1637)][i(947)][i(1627)]((()=>n=!0))),this[i(1362)][i(1686)](this[i(1637)][i(1145)][i(860)]((()=>{n&&(this[i(1446)](a,t),n=!1)}))),this[i(1446)](a,t),t[i(1452)][i(598)](t[i(402)]),t[i(1452)][i(1703)]=0,t[i(1452)][i(866)]=!0,t[i(809)][i(1686)]((0,e.Lw)(t[i(1452)],i(1338),(t=>{const e=i;this[e(1769)].classList.add(e(1460)),t[e(1785)]&&(t[e(1785)][e(806)]=e(288),t.dataTransfer[e(1660)]=e(288),t[e(1785)][e(1306)](e(759),e(488)+l.id)),t[e(1017)]()}))),t[i(809)][i(1686)]((0,e.Lw)(t[i(1452)],i(1110),(()=>{const t=i;this[t(1769)][t(175)][t(1770)](t(1460))}))),t[i(809)][i(1686)]((0,e.Lw)(t[i(1452)],i(1440),(e=>{const s=i;t[s(1452)][s(175)][s(1770)](s(485));const n=this[s(934)](e);n&&(this[s(1637)].image[s(1279)](n,l.id),setTimeout((()=>{const t=s;this[t(1839)][t(1375)](n)?.[t(1452)][t(1836)]()}))),e[s(1017)]()}))),t[i(809)][i(1686)]((0,e.Lw)(t[i(1452)],i(686),(e=>{const s=i,n=this[s(934)](e);l.id!==n&&(e[s(787)](),t[s(1452)][s(175)].add("drop-target"))}))),t[i(809)][i(1686)]((0,e.Lw)(t.container,"dragleave",(e=>{const s=i;t[s(1452)][s(175)][s(1770)](s(485))}))),t[i(983)][i(175)][i(1591)]("name"),t[i(1452)].addEventListener("click",(()=>this[i(1389)](a))),t[i(1452)][i(297)](i(1430),(async t=>{const e=i;switch(t[e(787)](),t.stopImmediatePropagation(),await this[e(951)].show([{id:"duplicate",label:e(1220)},{id:e(985),label:e(423)}])){case e(916):await this._luna[e(1020)][e(1784)](l);break;case"delete":await this[e(1637)].image[e(1794)](l)}})),t.container[i(297)]("keydown",(async e=>{const n=i;switch(e[n(1094)]){case"ArrowUp":t[n(1452)][n(529)]?.focus(),e[n(787)]();break;case n(1373):t[n(1452)][n(1561)]?.focus(),e[n(787)]();break;case n(1016):case"Space":await this._setActiveItem(s)}})),t[i(1452)][i(598)](t[i(983)]),this._imageListItems[i(971)](a,t),t[i(809)].push(this[i(1637)][i(1020)][i(501)]((e=>{const s=i;if(e===a){this[s(975)].removeChild(t[s(1452)]);for(const e of t.disposables)e[s(980)]();this[s(1839)][s(985)](a)}})))}const h=this[i(1839)][i(1375)](a),c=t===n;h.container[i(175)][i(1414)](i(1376),c);const l=this[i(1098)].get(a);this[i(1232)](l,h),null===o?(!h[i(1452)][i(1534)]||null!==h.container[i(529)])&&(this[i(975)].firstChild?this[i(975)][i(1544)](h[i(1452)],this[i(975)].firstChild):this[i(975)].appendChild(h[i(1452)])):h[i(1452)].previousSibling!==o&&o.insertAdjacentElement(i(274),h[i(1452)]),o=h[i(1452)]}}async[t(1446)](e,i){const s=t;this._rebuildImageCache();const n=this[s(1098)][s(1375)](e);if(!n)return;const o=new ImageData(new Uint8ClampedArray(n[s(356)]),n.width,n[s(918)]),r=await createImageBitmap(o),a=i.previewCanvas[s(714)]("2d");a.clearRect(0,0,40,40),n.width>=40||n.width>=40?a[s(1841)](r,0,0,40,40):a.drawImage(r,Math.round((40-n[s(1564)])/2),(40-n[s(918)])/2,n[s(1564)],n[s(918)]),this[s(1232)](n,i)}[t(1232)](e,i){const s=t,n=[-1===e.bitness?"corrupt":e[s(437)]+s(348)];e[s(1526)]&&n.push("("+(e[s(1526)]===s(631)?"bmp":s(1226))+")"),i[s(983)][s(1698)]=e[s(1564)]+"x"+e[s(918)]+(n.length>0?s(353)+n[s(960)](" "):"")}async[t(1389)](e){const i=t,s=this[i(1637)][i(1020)][i(1479)]?.[i(1710)]((t=>t.id===e));-1!==s&&await this._luna[i(1020)][i(745)](s)}[t(934)](e){const i=t;if(e[i(1785)]){const t=e[i(1785)][i(1120)]("text/plain");if(t?.[i(311)]("luna-image://"))return parseInt(t.substr(13))}}};Fi=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(224)](i,s):n;if(typeof Reflect===o(383)&&typeof Reflect[o(1177)]===o(575))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1167)](i,s,h),h}([Ui(1,je),Ui(2,Re),Ui(3,De),Ui(4,Oe),Ui(5,Je)],Fi);let Ni=class extends e.JT{constructor(e){const i=t;super(),this._lunaService=e,this[i(189)]=1,this.alignment=1,this[i(521)]="pointer-coords",this[i(720)]=!0,this[i(1200)]=!1,this[i(880)]=i(1502),this[i(299)]=this.register(new n.v),this.onUpdate=this._onUpdate[i(1545)],this[i(1107)][i(339)].onPointerCoordChange((t=>this[i(1603)](t)))}_update(e){const i=t;this[i(1200)]=!!e,e&&(this[i(1009)]=e[0]+","+e[1]),this[i(299)][i(443)]()}};var Oi,Vi;Ni=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(224)](i,s):n;if(typeof Reflect===o(383)&&"function"==typeof Reflect[o(1177)])h=Reflect[o(1177)](e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1167)](i,s,h),h}([(Oi=0,Vi=je,function(t,e){Vi(t,e,Oi)})],Ni),ti[t(1324)]("images",{ctor:Fi,defaultVisible:!1,defaultPosition:{x:"end",y:{target:t(1079),side:t(185)}}}),ci[t(1324)]({start(e){const i=t,s=e[i(1375)](qe),n=e.get(Me);s[i(1654)](n[i(1426)](Ni)),s.createItem(n[i(1426)](Bi))}}),xi({id:t(1746),label:"Toggle Images Window",section:t(194),checked:1,run:e=>{const i=t;if(void 0===e.get(je)[i(1020)][i(1479)])throw new Error(i(188));e[i(1375)](Ye)[i(1343)](i(255))}}),xi({id:t(911),label:t(1340),section:t(1852),enabled:9,run:async e=>{const i=t,s=e[i(1375)](Je),{width:n,height:o}=await s[i(1527)](),r=await s[i(187)](i(1507),[{id:"1",label:i(1617),description:i(1501)},{id:"4",label:i(1631),description:"16 colors"},{id:"8",label:i(512),description:i(1359)},{id:"24",label:i(478),description:i(899)},{id:"32",label:i(1151),description:i(854)}]);if(void 0!==r)return e.get(je).image[i(409)](n,o,parseInt(r))}}),xi({id:"image.deleteImage",label:t(792),section:t(1852),enabled:9,run:async e=>e.get(je)[t(1020)][t(1794)]()}),xi({id:t(328),label:"Go to Top Image",section:t(1852),run:e=>e.get(je)[t(1020)][t(1469)]()}),xi({id:t(800),label:t(1509),section:"Image",run:e=>e[t(1375)](je).image[t(531)]()}),xi({id:t(678),label:t(181),section:t(1852),run:e=>e[t(1375)](je).image[t(380)]()}),xi({id:t(1680),label:"Go to Image Below",section:t(1852),run:e=>e[t(1375)](je)[t(1020)].goToImageBelow()}),xi({id:t(1330),label:t(641),section:t(1852),run:e=>e.get(je)[t(1020)][t(1771)]()}),xi({id:"image.moveImageUp",label:t(419),section:"Image",run:e=>e.get(je)[t(1020)].moveImageUp()}),xi({id:"image.moveImageDown",label:t(1612),section:"Image",run:e=>e[t(1375)](je).image[t(1588)]()}),xi({id:t(1097),label:"Move Image to Bottom",section:t(1852),run:e=>e[t(1375)](je).image[t(1303)]()}),xi({id:t(640),label:"Crop to Selection",section:t(1852),run:async e=>{const i=t,s=e[i(1375)](je);s[i(788)].executeOnAllLayers(i(1168),{selection:s[i(1814)][i(1707)]})},keys:t(1124)}),xi({id:t(1128),label:t(628),section:"Image",run:async e=>{const i=t,s=e.get(je);await s[i(788)][i(1238)](i(213),{selection:s[i(1814)].range}),s.viewport[i(1752)]()}}),xi({id:t(1502),label:t(658),section:t(1852),run:async e=>{const i=t,s=await e.get(Je).requestLayerTaskOptions(i(1061));e[i(1375)](je)[i(788)][i(1238)]("layer/resize",s)},keys:t(290)}),xi({id:t(633),label:t(669),section:t(1852),run:async e=>{const i=t,s=await e[i(1375)](Je).requestLayerTaskOptions(i(1592));e[i(1375)](je).task[i(1238)]("layer/resizeCanvas",s)},keys:t(689)}),xi({id:t(1213),label:t(933),section:t(1852),run:async e=>{const i=t,s=e[i(1375)](je);s[i(788)][i(1238)](i(1236),{selection:s[i(1814)].range})}}),xi({id:t(522),label:t(1675),section:"Image",run:async e=>{const i=t,s=e[i(1375)](je);s[i(788)][i(1238)](i(350),{selection:s[i(1814)][i(1707)]})}}),xi({id:t(1734),label:t(1587),section:t(1852),run:async e=>{const i=t,s=e[i(1375)](je);s[i(788)][i(1238)](i(1245),{selection:s[i(1814)][i(1707)]})},keys:t(1291)}),xi({id:"image.rotate90Clockwise",label:"Rotate 90° Clockwise",section:t(1852),run:async e=>{const i=t,s=e[i(1375)](je);s[i(788)][i(1238)](i(177),{selection:s.selection[i(1707)]})},keys:t(1033)}),xi({id:"image.rotate90CounterClockwise",label:t(1530),section:"Image",run:async e=>{const i=t,s=e[i(1375)](je);s.task[i(1238)](i(593),{selection:s[i(1814)][i(1707)]})},keys:"ctrl+g"}),xi({id:t(391),label:"Flatten Layers",section:t(1852),run:e=>e[t(1375)](je)[t(947)].flattenLayers(),keys:t(664)}),xi({id:t(477),label:t(650),section:t(1852),run:e=>e.get(je)[t(947)][t(351)](),keys:t(1054)}),ci.register({start:()=>{const e=t;window[e(297)](e(1621),(t=>{const i=e;if("INPUT"!==t.target?.[i(487)])return;const s=t[i(189)];if("number"===s.type&&(le.V&&t[i(1651)]||!le.V&&t.ctrlKey)){let e;switch(t[i(1094)]){case i(270):e=parseInt(s[i(710)])+10;break;case"ArrowDown":e=parseInt(s[i(710)])-10;break;case"ArrowLeft":e=""!==s[i(1608)]?parseInt(s[i(1608)]):void 0;break;case i(1101):e=""!==s[i(282)]?parseInt(s[i(282)]):void 0}if(void 0===e)return;""!==s.min&&(e=Math[i(282)](e,parseInt(s.min))),""!==s.max&&(e=Math.min(e,parseInt(s[i(282)]))),s.value=e[i(215)](),t[i(787)](),t[i(1017)]();const n=new Event(i(461),{bubbles:!0});s[i(875)](n)}}))}});const Hi=["r","g","b","a"];class zi{constructor(e,i,s){const n=t;this[n(1637)]=e,this[n(674)]=i;const o=n(818)+s;this._channelIndex=Hi[n(226)](s);const r=document[n(1296)](n(1683));r.classList.add(n(657));const a=document.createElement(n(184));a[n(1698)]=s.toUpperCase()+":",a.setAttribute("for",o);const h=document.createElement(n(1683));h[n(175)][n(1591)](n(1277)),"a"===s&&h[n(175)].add("a"),this[n(517)]=document.createElement(n(1683)),this[n(517)][n(175)][n(1591)]("slider-gradient"),this[n(517)][n(297)](n(296),(t=>{const e=n;h[e(175)].contains(e(1376))&&t.buttons&&this[e(1553)](t[e(1575)])})),this[n(517)][n(297)](n(1093),(t=>{const e=n;this[e(517)][e(1689)](t[e(493)]),h[e(175)][e(1591)](e(1376)),this[e(1553)](t.offsetX)})),this[n(517)][n(297)]("pointerup",(t=>{const e=n;this[e(517)][e(1671)](t[e(493)]),h[e(175)][e(1770)]("active")})),this._sliderGradientElement[n(297)](n(609),(t=>{const e=n;if(0===t[e(1834)])return;const i=this._luna[e(1233)][e(1865)][e(1006)]();i[this[e(586)]]=Math[e(282)](Math[e(1608)](i[this[e(586)]]+(t[e(1834)]>0?-1:1),255),0),this[e(1637)][e(1233)][e(1865)]=i})),this._sliderTabElement=document[n(1296)](n(1683)),this._sliderTabElement[n(175)][n(1591)](n(1127)),h[n(705)](this._sliderGradientElement,this[n(1035)]);const c=document[n(1296)](n(461));c.type=n(563),c[n(1608)]="0",c[n(282)]="255",c[n(710)]="255",c.id=o,c[n(297)]("input",(()=>{const t=n,e=this[t(1637)][t(1233)][t(1865)][t(1006)]();e[this[t(586)]]=this[t(778)](parseInt(c[t(710)])),this[t(1637)][t(1233)][t(1865)]=e})),c[n(297)](n(871),(()=>{const t=n;this._inputElement.value=this[t(778)](parseInt(this[t(418)][t(710)]))[t(215)]()})),this[n(418)]=c,r[n(705)](a,h,c),this[n(717)](),this[n(674)].appendChild(r)}set value(e){const i=t;document[i(1165)]!==this[i(418)]&&(this[i(418)][i(710)]=e[i(215)]())}_sanitizeValue(e){return Math[t(282)](Math.min(e||0,255),0)}refresh(){const e=t,i=this[e(1637)][e(1233)][e(1865)],s=[0===this._channelIndex?0:i[0],1===this[e(586)]?0:i[1],2===this[e(586)]?0:i[2],3===this[e(586)]?0:1],n=[0===this[e(586)]?255:i[0],1===this[e(586)]?255:i[1],2===this[e(586)]?255:i[2],(this._channelIndex,1)];this[e(517)][e(1712)].background=e(1346)+s[e(960)](",")+e(530)+n[e(960)](",")+e(1292),this._sliderTabElement[e(1712)].left=i[this[e(586)]]/255*49+"px"}_updateColorViaSlider(e){const i=t,s=Math.max(Math[i(1608)](e/49,1),0),n=Math[i(827)](255*s),o=this[i(1637)].palette.primary[i(1006)]();o[this._channelIndex]=Math.round(n),this[i(1637)][i(1233)][i(1865)]=o}}var Wi=function(t,e){return function(i,s){e(i,s,t)}};let ji=class extends Ri{constructor(i,s,n,o){const r=t;super(r(1233),i,r(1081)),this[r(1637)]=s,this[r(1071)]=o,this[r(536)]=new Map,this[r(366)]=this[r(1071)][r(1174)](3,!0),this[r(1324)](this[r(1207)]((t=>this._windowVisibleContextKey.set(t)))),this[r(1637)].palette[r(1865)]=new Float32Array([0,0,0,255]),this[r(1637)][r(1233)].secondary=new Float32Array([255,255,255,255]);const a=document[r(1296)](r(1683));a[r(175)].add("active"),this[r(1208)]=this[r(1672)](r(1865)),this[r(1396)]=this._createColorInfo(r(1060));const h=document[r(1296)]("button");h.classList.add(r(1123),"luna-icon"),this[r(1324)]((0,e.Lw)(h,r(1550),(()=>n[r(534)]("palette.swapColors")))),a[r(705)](this._primaryColorDiv[r(1534)],this[r(1396)].parentElement,h);const c=document.createElement(r(1683));c.classList[r(1591)](r(707)),c[r(705)](a,document.createElement("br"),this[r(1397)](255,255,255),this._createPaletteButton(0,0,0),this[r(1397)](255,0,0),this._createPaletteButton(255,255,0),this[r(1397)](0,255,0),this[r(1397)](0,255,255),this._createPaletteButton(0,0,255),this[r(1397)](255,0,255),document[r(1296)]("br"),this._createPaletteButton(255,255,255,192),this[r(1397)](0,0,0,192),this[r(1397)](255,0,0,192),this._createPaletteButton(255,255,0,192),this[r(1397)](0,255,0,192),this._createPaletteButton(0,255,255,192),this._createPaletteButton(0,0,255,192),this[r(1397)](255,0,255,192),document[r(1296)]("br"),this._createPaletteButton(255,255,255,128),this._createPaletteButton(0,0,0,128),this[r(1397)](255,0,0,128),this[r(1397)](255,255,0,128),this[r(1397)](0,255,0,128),this[r(1397)](0,255,255,128),this[r(1397)](0,0,255,128),this[r(1397)](255,0,255,128),document[r(1296)]("br"),this._createPaletteButton(255,255,255,64),this[r(1397)](0,0,0,64),this[r(1397)](255,0,0,64),this[r(1397)](255,255,0,64),this[r(1397)](0,255,0,64),this[r(1397)](0,255,255,64),this._createPaletteButton(0,0,255,64),this[r(1397)](255,0,255,64));const l=document[r(1296)]("div");l.classList[r(1591)]("right");for(const t of Hi)this._channelInputs[r(971)](t,new zi(this[r(1637)],l,t));const d=document.createElement(r(1683));d[r(175)][r(1591)](r(657));const u=document[r(1296)]("label");u[r(1698)]=r(1438),u[r(545)](r(789),r(541)),this[r(1823)]=document.createElement(r(461)),this[r(1823)].id=r(541),this[r(1823)][r(1717)]="[0-9a-fA-F]*",this._hexInputElement[r(1403)]=r(1092),this[r(668)](),this._hexInputElement.addEventListener(r(461),(()=>{const t=r,e=this[t(1823)][t(710)];if(6===e.length){const i=this[t(1637)][t(1233)][t(1865)][t(1006)]();i[0]=parseInt(e.substr(0,2),16),i[1]=parseInt(e[t(1726)](2,2),16),i[2]=parseInt(e[t(1726)](4,2),16),this[t(1637)][t(1233)][t(1865)]=i}})),this[r(1823)][r(297)](r(1621),(t=>{const e=r;switch(t.key){case e(270):this[e(357)](t,le.V&&t[e(1651)]||!le.V&&t[e(1699)]?16:1);break;case"ArrowDown":this._changeHexInput(t,le.V&&t.metaKey||!le.V&&t.ctrlKey?-16:-1);break;case e(313):(le.V&&t[e(1651)]||!le.V&&t[e(1699)])&&this[e(357)](t,-255);break;case e(1101):(le.V&&t[e(1651)]||!le.V&&t[e(1699)])&&this[e(357)](t,255)}})),this._hexInputElement[r(297)]("change",(()=>{const t=r,e=this[t(1823)].value;if(e.match(/^[0-9a-fA-F]+$/))if(3===e[t(1225)]){const i=this._luna[t(1233)].primary[t(1006)]();i[0]=parseInt(e[t(1726)](0,1)[t(499)](2),16),i[1]=parseInt(e[t(1726)](1,1)[t(499)](2),16),i[2]=parseInt(e[t(1726)](2,1)[t(499)](2),16),this[t(1637)].palette[t(1865)]=i}else this[t(668)]();else this[t(668)]()})),d[r(705)](u,this[r(1823)]),l[r(598)](d),this[r(1769)][r(705)](c,l),this[r(1761)](),this.register(this[r(1637)][r(1233)][r(634)]((()=>this._updatePalette())))}[t(668)](){const e=t;this[e(1823)].value=this[e(921)](this[e(1637)][e(1233)].primary)}[t(357)](e,i){const s=t,n=this[s(1823)][s(1809)],o=this[s(1823)].selectionEnd;if(null===n||null===o)return;const r=n<=1,a=n>1&&n<4||o>2&&o<4||n<=1&&o>=4,h=n>=4||o>4;if(!r&&!a&&!h)return;const c=this._luna[s(1233)][s(1865)][s(1006)]();r&&(c[0]=Math.min(255,Math.max(0,parseInt(this._hexInputElement[s(710)][s(1726)](0,2),16)+i))),a&&(c[1]=Math[s(1608)](255,Math[s(282)](0,parseInt(this[s(1823)][s(710)][s(1726)](2,2),16)+i))),h&&(c[2]=Math.min(255,Math.max(0,parseInt(this._hexInputElement[s(710)].substr(4,2),16)+i))),this[s(1637)].palette[s(1865)]=c,e.preventDefault(),this._hexInputElement.selectionStart=n,this[s(1823)][s(1044)]=o}[t(921)](e){const i=t;return""+this[i(245)](e[0])+this[i(245)](e[1])+this[i(245)](e[2])}_channelToHex(e){const i=t;return e[i(215)](16)[i(922)](2,"0")[i(604)]()}[t(1672)](e){const i=t,s=document[i(1296)](i(1683));s.id=e,s[i(175)][i(1591)](e);const n=document[i(1296)](i(1683));return n[i(175)][i(1591)](i(229)),s[i(598)](n),n}[t(1397)](e,i,s,n=255){const o=t,r=document[o(1296)](o(1683));r[o(175)][o(1591)](o(1630));const a=document.createElement(o(1683));r.addEventListener(o(1550),(()=>this[o(1637)][o(1233)][o(1865)]=new Float32Array([e,i,s,n]))),r[o(297)](o(1430),(t=>{const r=o;this._luna[r(1233)][r(1060)]=new Float32Array([e,i,s,n]),t[r(787)]()})),a.classList.add("color-overlay");const h=o(1866)+e+","+i+","+s+",1)";return a[o(1712)][o(643)]=o(802)+h+o(543)+e+","+i+","+s+","+n/255+o(1292),r[o(598)](a),r}[t(1761)](){const e=t,i=this._luna[e(1233)].primary;for(const[t,s]of Hi[e(403)]()){const n=this._channelInputs[e(1375)](s);n[e(710)]=i[t],n[e(717)]()}this[e(668)]();const s=i[0]+","+i[1]+","+i[2];this[e(1208)][e(1712)][e(643)]=e(496)+s+e(410)+s+","+i[3]/255+e(1292);const n=this[e(1637)][e(1233)][e(1060)],o=n[0]+","+n[1]+","+n[2];this._secondaryColorDiv[e(1712)][e(643)]=e(496)+o+e(410)+o+","+n[3]/255+e(1292)}};ji=function(e,i,s,n){const o=t;var r,a=arguments[o(1225)],h=a<3?i:null===n?n=Object[o(224)](i,s):n;if(typeof Reflect===o(383)&&"function"==typeof Reflect[o(1177)])h=Reflect[o(1177)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1167)](i,s,h),h}([Wi(1,je),Wi(2,Re),Wi(3,De)],ji),ti[t(1324)]("palette",{ctor:ji,defaultVisible:!0,defaultPosition:{x:t(1573),y:t(185)}}),xi({id:"palette.togglePaletteWindow",label:"Toggle Palette Window",section:t(194),checked:3,run:e=>e[t(1375)](Ye).toggleView("palette")}),xi({id:t(859),label:"Swap Colors",section:t(1081),run:e=>e.get(je).palette[t(1123)](),keys:"x"});let qi=class extends e.JT{constructor(e){const i=t;super(),this[i(1107)]=e,this[i(189)]=1,this[i(1250)]=0,this.className=i(1216),this[i(720)]=!0,this.visible=!1,this[i(299)]=this[i(1324)](new n.v),this.onUpdate=this[i(299)][i(1545)],this._lunaService[i(1814)].onUpdate((()=>this._update())),this[i(1603)]()}_update(){const e=t,i=this[e(1107)][e(1814)][e(1707)];if(!i)return void(this[e(1200)]&&(this[e(1009)]="",this[e(1200)]=!1,this._onUpdate[e(443)]()));const s=i.right-i[e(707)],n=i[e(799)]-i[e(1082)];this[e(1009)]=s+e(193)+n,this[e(1403)]=e(1310)+s+e(765)+n+e(1285),this[e(1200)]=!0,this._onUpdate[e(443)]()}};var Gi,Xi;qi=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect[o(1177)])h=Reflect[o(1177)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1167)](i,s,h),h}([(Gi=0,Xi=je,function(t,e){Xi(t,e,Gi)})],qi);let Ji=class extends e.JT{constructor(e){const i=t;super(),this._lunaService=e,this[i(189)]=1,this[i(1250)]=0,this[i(521)]="selection-topleft",this[i(720)]=!0,this[i(1200)]=!1,this._onUpdate=this[i(1324)](new n.v),this.onUpdate=this[i(299)][i(1545)],this[i(1107)].selection[i(1496)]((()=>this[i(1603)]())),this[i(1603)]()}[t(1603)](){const e=t,i=this[e(1107)].selection.range;i?(this[e(1009)]=i[e(707)]+", "+i[e(1082)],this[e(1403)]=e(218)+i[e(707)]+e(727)+i[e(1082)],this[e(1200)]=!0,this[e(299)][e(443)]()):this[e(1200)]&&(this[e(1009)]="",this.visible=!1,this[e(299)][e(443)]())}};var Yi,Ki;Ji=function(e,i,s,n){const o=t;var r,a=arguments[o(1225)],h=a<3?i:null===n?n=Object[o(224)](i,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect[o(1177)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1167)](i,s,h),h}([(Yi=0,Ki=je,function(t,e){Ki(t,e,Yi)})],Ji),ci[t(1324)]({start(e){const i=t;e[i(1375)](qe).createItem(e.get(Me)[i(1426)](Ji)),e.get(qe)[i(1654)](e.get(Me)[i(1426)](qi));const s=e[i(1375)](je),n=e.get(De).bind(6,!1);s[i(1814)][i(1496)]((()=>{const t=i;n[t(971)](!!s[t(1814)][t(1707)])}))}}),xi({id:t(354),label:"Select All",section:t(247),run:e=>e[t(1375)](je)[t(1814)][t(702)](),keys:t(867)}),xi({id:t(1089),label:t(1497),section:t(247),run:e=>e[t(1375)](je)[t(1814)][t(1283)](),keys:t(1475),enabled:6}),xi({id:t(1574),label:t(1816),section:t(247),run:e=>e[t(1375)](je)[t(1814)][t(648)](),keys:t(985),enabled:6});class $i extends e.JT{constructor(e,i,s){const n=t;super(),this.id=e,this[n(607)]=!0,this[n(1769)]=document.createElement(n(1683)),this[n(1769)].id=s[n(1349)]()[n(394)](/ /g,""),this[n(1769)][n(175)][n(1591)](n(246),n(990)),i.appendChild(this[n(1769)]),this[n(1324)]({dispose:()=>{i.removeChild(this._contentElement)}})}get[t(804)](){return this[t(607)]}set isVisible(e){const i=t;this[i(607)]=e,this._contentElement[i(1712)][i(1371)]=this._isVisible?"":i(1003)}}var Zi=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(224)](i,s):n;if(typeof Reflect===o(383)&&typeof Reflect.decorate===o(575))h=Reflect[o(1177)](e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h},Qi=function(t,e){return function(i,s){e(i,s,t)}};class ts extends $i{constructor(e,i,s,n){const o=t;super(0===e?"topStatusBar":o(1830),i,0===e?"Top Status Bar":o(706)),this[o(1435)]=e,this[o(1556)]=s,this[o(1664)]=n,this[o(697)]=new Map,this._contentElement.classList[o(1591)](o(1227)),this._leftItemsElement=document.createElement(o(1683)),this[o(817)][o(175)][o(1591)](o(1334)),this[o(1356)]=document[o(1296)]("div"),this._rightItemsElement[o(175)][o(1591)](o(1667)),(0===this._target?this[o(1556)][o(1695)]:this._statusBarService.onDidAddBottomItem)((t=>this[o(840)](t))),(0===this[o(1435)]?this[o(1556)][o(1682)]:this[o(1556)][o(1848)])((t=>this[o(1720)](t))),this[o(1769)][o(705)](this._leftItemsElement,this[o(1356)]),this[o(1324)]({dispose:()=>{const t=o;for(const e of this[t(697)][t(1611)]())for(const i of e)i[t(980)]()}})}[t(840)](e){const i=t,s=[],n=0===e[i(1250)]?this._leftItemsElement:this[i(1356)],o=document[i(1296)](i(616));if(o.classList[i(1591)](i(1622)),e.className&&o[i(175)][i(1591)](e.className),e[i(720)]&&o.classList[i(1591)](i(1020),"luna-icon-before"),e.title&&(o.title=e[i(1403)]),o[i(297)](i(1550),(()=>{const t=i;e.commandId&&this[t(1664)][t(534)](e.commandId)})),e.input){const t=i(370)+Math[i(827)](1e6*Math.random());switch(e.input[i(352)]){case i(209):{const s=e[i(461)],n=document[i(1296)](i(184));n.textContent=e[i(1009)]+": ",n[i(545)](i(789),t);const r=document[i(1296)](i(1595));r.id=t;for(const t of s[i(1377)]){const e=document[i(1296)](i(758));e[i(710)]=t,e.textContent=t,r[i(598)](e)}r[i(710)]=s[i(850)],r[i(297)](i(1749),(()=>s[i(197)](r[i(710)]))),s.onHistoryUpdateValue((t=>r[i(710)]=t)),o[i(705)](n,r);break}case i(563):{const s=e[i(461)],n=document.createElement("label");n[i(1698)]=e[i(1009)]+": ",n[i(545)](i(789),t);const r=document.createElement("input");r.id=t,r[i(352)]=i(563),s[i(1608)]&&(r[i(1608)]=s.min[i(215)]()),s[i(282)]&&(r[i(282)]=s[i(282)][i(215)]()),r[i(710)]=s.currentValue[i(215)](),r[i(297)]("input",(()=>{const t=i;r[t(1328)]()&&s.setOption(parseInt(r[t(710)]))})),s[i(1468)]((t=>r[i(710)]=t[i(215)]())),o[i(705)](n,r);break}}}e[i(1496)]&&s[i(1686)](e.onUpdate((()=>this[i(1012)](e,o)))),this[i(1012)](e,o),n[i(598)](o),s[i(1686)]({dispose:()=>n[i(1019)](o)}),this[i(697)][i(971)](e,s)}_removeItem(e){const i=t,s=this._itemDisposables[i(1375)](e);if(s){for(const t of s)t[i(980)]();this[i(697)][i(985)](e)}}_updateItem(e,i){const s=t;e[s(461)]?i.querySelector(s(184))[s(1698)]=e.text+": ":(i[s(1698)]=e.text,i[s(175)][s(1414)](s(254),0===e[s(1009)]?.[s(1225)])),e[s(1403)]&&(i.title=e[s(1403)]),i[s(1712)][s(1371)]=!1===e.visible?s(1003):"",i[s(175)][s(1414)]("interactive",!!e[s(880)]&&!1!==e.enabled),i[s(175)][s(1414)]("checked",!!e[s(1728)]),void 0!==e[s(363)]&&i[s(175)][s(1414)](s(1176),!e[s(363)])}}let es=class extends ts{constructor(t,e,i){super(0,t,e,i)}};es=Zi([Qi(1,qe),Qi(2,Re)],es);let is=class extends ts{constructor(t,e,i){super(1,t,e,i)}};is=Zi([Qi(1,qe),Qi(2,Re)],is),Ze.register(t(405),{anchor:t(1082),ctor:es}),Ze[t(1324)]("bottomStatusBar",{anchor:t(799),ctor:is}),xi({id:t(349),label:t(1666),section:t(194),run:e=>e[t(1375)](Ye).toggleView(t(405))}),xi({id:"window.toggleBottomStatusBarView",label:t(740),section:t(194),run:e=>e[t(1375)](Ye)[t(1343)]("bottomStatusBar")});class ss extends e.JT{constructor(e,i){const s=t;super(),this[s(1791)]=e,this.className=i,this[s(189)]=0,this[s(1250)]=0,this[s(720)]=!0,this[s(1009)]="",this[s(299)]=this[s(1324)](new n.v),this.onUpdate=this[s(299)][s(1545)],this._action[s(1496)]&&this[s(1324)](this[s(1791)][s(1496)]((()=>this[s(1603)]()))),this[s(1603)]()}_update(){const e=t;switch(this[e(1791)][e(352)]){case"crop-to-selection":this[e(880)]="image.cropToSelection";break;case e(1063):this[e(880)]=e(1128);break;default:throw new Error(e(1803)+this[e(1791)][e(352)]+'"')}this[e(1403)]=this._action[e(1027)],this[e(363)]=this._action.enabled,this._onUpdate[e(443)]()}}class ns{constructor(){this._activeItems=[]}[t(1573)](e){const i=t,s=e[i(1375)](je),n=e[i(1375)](qe);s[i(367)][i(636)]((()=>this[i(1603)](s,n)))}_update(e,i){const s=t;for(const t of this[s(728)])t.dispose();this[s(728)][s(1225)]=0;const n=e[s(367)][s(1581)];for(const t of n)this[s(728)].push(i[s(1654)](new ss(t,e.tool[s(779)]+"-"+t.type)))}}class os extends e.JT{constructor(e,i){const s=t;super(),this[s(701)]=e,this[s(521)]=i,this[s(189)]=1,this.alignment=0,this[s(720)]=!0,this[s(1200)]=!1,this[s(299)]=this[s(1324)](new n.v),this[s(1496)]=this[s(299)][s(1545)],this.register(this[s(701)][s(1496)]((()=>this[s(1603)]()))),this[s(1603)]()}[t(1603)](){const e=t;this[e(701)].visible?(this[e(1009)]=this[e(701)][e(718)](),this[e(1403)]=this._info[e(949)](),this[e(1200)]=!0,this[e(299)][e(443)]()):this[e(1200)]&&(this[e(1009)]="",this[e(1200)]=!1,this[e(299)][e(443)]())}}class rs{constructor(){this[t(728)]=[]}[t(1573)](e){const i=t,s=e[i(1375)](je),n=e[i(1375)](qe);s[i(367)][i(636)]((()=>this._update(s,n)))}[t(1603)](e,i){const s=t;for(const t of this[s(728)])t[s(980)]();switch(this._activeItems[s(1225)]=0,e[s(367)][s(779)]){case"rectangle":for(const t of e[s(367)][s(943)])(t[s(352)]===s(1382)||t[s(352)]===s(1844))&&this[s(728)].push(i.createItem(new os(t,e[s(367)].activeTool+"-"+t.type)))}}}class as{constructor(){this[t(728)]=[]}[t(1573)](e){const i=t,s=e[i(1375)](je),n=e[i(1375)](qe);s.tool[i(636)]((()=>this[i(1603)](s,n)))}[t(1603)](e,i){const s=t;for(const t of this[s(728)])t[s(980)]();this[s(728)][s(1225)]=0;const n=e[s(367)][s(1377)];for(const t of n)switch(t[s(352)]){case s(526):break;case s(209):const e=t;this[s(276)](i,t[s(1027)],{type:"string",currentValue:e[s(710)],options:e[s(1377)],setOption:e=>t[s(710)]=e,onHistoryUpdateValue:t[s(1468)]});break;case s(563):const n=t;this[s(276)](i,t.name,{type:"number",currentValue:n.value,min:n[s(1608)],max:n.max,setOption:e=>t[s(710)]=e,onHistoryUpdateValue:t[s(1468)]})}}[t(276)](e,i,s){const n=t;this._activeItems[n(1686)](e[n(1654)]({target:0,alignment:0,dispose:()=>{},text:i,input:s}))}}var hs=function(t,e){return function(i,s){e(i,s,t)}};const cs=new Map([["selection","S"],["crop","C"],[t(1464),"M"],[t(298),"P"],["moveSelection","M"],[t(716),"E"],["colorPicker","K"],["fill","F"],["line","O"],[t(615),"O"],[t(460),"H"],[t(1150),"Z"]]),ls=[t(1814),t(1464),t(662),t(236),t(298),t(716),t(887),"fill",t(1005),t(615),"hand",t(1150)];let ds=class extends Ri{constructor(e,i,s){const n=t;super(n(1335),e,n(1540)),this[n(1637)]=i,this[n(1071)]=s,this[n(1059)]=new Map,this[n(366)]=this[n(1071)][n(1174)](0,!0),this[n(1324)](this[n(1207)]((t=>this[n(366)][n(971)](t))));const o=n(298),r=document[n(901)]();for(const[t,e]of ls[n(403)]()){const i=document[n(1296)](n(1683));i[n(175)][n(1591)]("tool-container");const s=document[n(1296)](n(461));s[n(1027)]=n(367),s[n(352)]="radio",s[n(175)][n(1591)](n(367),e,n(468));const a=us(e),h=cs[n(1375)](e);h?s.title=a+" ("+h+")":s[n(1403)]=""+a,s[n(545)](n(1465),a),this[n(1059)].set(e,s),s.checked=e===o,s[n(297)]("change",(()=>this[n(1637)][n(367)][n(1599)](e))),s[n(297)](n(1621),(s=>{const o=n;switch(s.key){case o(270):i[o(529)]?.[o(529)]?.firstChild?.[o(1836)](),s[o(787)](),s[o(1017)]();break;case o(1373):const n=i.nextSibling?.nextSibling?.[o(251)];n?n[o(1836)]():i[o(1561)]?.[o(251)]?.focus(),s[o(787)](),s[o(1017)]();break;case o(313):t%2==1&&i[o(529)]?.[o(251)]?.[o(1836)](),s[o(787)](),s[o(1017)]();break;case o(1101):if(t%2==0){const t=i[o(1561)]?.firstChild;t?t[o(1836)]():i[o(529)]?.[o(251)]?.[o(1836)]()}s.preventDefault(),s[o(1017)]();break;case o(1016):this[o(1637)].tool[o(1599)](e)}})),i[n(598)](s),r[n(598)](i)}this[n(1769)][n(598)](r),this[n(1324)](this._luna[n(367)].onToolChange((t=>{const e=n;this[e(1059)].get(t.id)[e(1728)]=!0;for(const[i,s]of this[e(1059)][e(403)]())s.parentElement?.classList.toggle("checked",i===t.id)}))),this[n(1637)].tool[n(1599)](o)}};function us(e){const i=t;return((e[i(1726)](0,1)[i(604)]()+e.substr(1))[i(1282)](/[A-Z][a-z]+/g)||[]).join(" ")}function ms(e,i,s){const n=t,o=e.get(je);o[n(367)].setTool(i,s),o[n(339)].focus()}ds=function(e,i,s,n){const o=t;var r,a=arguments[o(1225)],h=a<3?i:null===n?n=Object[o(224)](i,s):n;if("object"==typeof Reflect&&typeof Reflect.decorate===o(575))h=Reflect[o(1177)](e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([hs(1,je),hs(2,De)],ds),ti.register("tools",{ctor:ds,defaultVisible:!0,defaultPosition:{x:"start",y:"start"}}),ci[t(1324)](new as),ci.register(new ns),ci[t(1324)](new rs),xi({id:t(1187),label:t(1805),section:t(194),checked:0,run:e=>e[t(1375)](Ye)[t(1343)]("tools")}),xi({id:"tool.colorPicker",label:t(966),section:t(651),run:t=>ms(t,"colorPicker"),keys:"k"}),xi({id:t(639),label:t(1084),section:"Tool",run:e=>ms(e,t(662)),keys:"c"}),xi({id:t(1598),label:t(1354),section:t(651),run:t=>ms(t,"eraser"),keys:"e"}),xi({id:"tool.fill",label:t(1351),section:t(651),run:t=>ms(t,"fill"),keys:"f"}),xi({id:t(1555),label:t(1175),section:t(651),run:e=>ms(e,t(460)),keys:"h"}),xi({id:t(1802),label:"Hand Until Release",section:"Tool",run:e=>ms(e,t(460),{untilRelease:!0}),keys:"space"}),xi({id:t(796),label:t(950),section:t(651),run:t=>ms(t,"line")}),xi({id:"tool.toggleShapeTool",label:t(810),section:t(651),run:e=>{const i=t;e[i(1375)](je)[i(367)][i(779)]===i(1005)?ms(e,"rectangle"):ms(e,"line")},keys:"o"}),xi({id:t(1272),label:"Move Pixels",section:t(651),run:t=>ms(t,"movePixels")}),xi({id:t(425),label:t(1398),section:t(651),run:e=>ms(e,t(236))}),xi({id:t(667),label:"Toggle Move Tool",section:t(651),run:e=>{const i=t;e[i(1375)](je)[i(367)][i(779)]===i(1464)?ms(e,i(236)):ms(e,i(1464))},keys:"m"}),xi({id:t(481),label:"Pencil",section:"Tool",run:e=>ms(e,t(298)),keys:"p"}),xi({id:"tool.rectangle",label:t(491),section:t(651),run:e=>ms(e,t(615)),keys:"o"}),xi({id:t(1007),label:t(247),section:t(651),run:e=>ms(e,t(1814)),keys:"s"}),xi({id:t(981),label:t(690),section:"Tool",run:e=>ms(e,t(1150)),keys:"z"}),xi({id:t(1051),label:"Focus Canvas",section:t(1339),run:e=>e[t(1375)](je)[t(339)].focus()}),xi({id:"view.zoomIn",label:t(1487),section:t(1339),run:e=>e[t(1375)](je)[t(339)][t(583)]()}),xi({id:t(1058),label:t(878),section:"View",run:e=>e[t(1375)](je)[t(339)][t(1178)]()}),xi({id:t(473),label:t(1311),section:t(1339),run:e=>e[t(1375)](je)[t(339)].zoom=1,keys:"ctrl+9"}),xi({id:t(1273),label:"Fit to Window",section:"View",run:e=>e.get(je)[t(339)][t(1752)](),keys:"ctrl+0"}),xi({id:t(1031),label:"Fit Layer to Window",section:t(1339),run:e=>e[t(1375)](je)[t(339)].fitLayerToWindow()}),xi({id:t(1590),label:t(876),section:t(1339),run:e=>{const i=t,s=e[i(1375)](je)[i(339)];s.isPixelGridEnabled=!s.isPixelGridEnabled}});let gs=class extends e.JT{constructor(e){const i=t;super(),this[i(1107)]=e,this[i(189)]=0,this[i(1250)]=1,this.className="pixel-grid",this[i(720)]=!0,this.text="",this[i(1403)]=i(928),this.commandId=i(1590),this[i(299)]=this.register(new n.v),this[i(1496)]=this[i(299)][i(1545)],this[i(1107)][i(339)][i(286)]((()=>this[i(1603)]())),this[i(1603)]()}_update(){const e=t;this[e(1728)]=this[e(1107)][e(339)][e(1308)],this[e(299)].fire()}};var fs,ps;gs=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(224)](i,s):n;if(typeof Reflect===o(383)&&"function"==typeof Reflect[o(1177)])h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([(fs=0,ps=je,function(t,e){ps(t,e,fs)})],gs);let ys=class extends e.JT{constructor(e){const i=t;super(),this[i(1107)]=e,this[i(189)]=1,this[i(1250)]=1,this[i(521)]=i(1150),this[i(720)]=!0,this[i(299)]=this[i(1324)](new n.v),this[i(1496)]=this[i(299)].event,this[i(1107)][i(339)][i(1563)]((()=>this[i(1603)]())),this[i(1603)]()}[t(1603)](){const e=t,i=(100*this[e(1107)][e(339)][e(1150)])[e(1669)](0);this[e(1009)]=i+"%",this[e(1403)]=e(1411)+i+"%",this._onUpdate[e(443)]()}};var _s,ws;ys=function(e,i,s,n){const o=t;var r,a=arguments[o(1225)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(383)&&typeof Reflect[o(1177)]===o(575))h=Reflect[o(1177)](e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1167)](i,s,h),h}([(_s=0,ws=je,function(t,e){ws(t,e,_s)})],ys),ci[t(1324)]({start(e){const i=t,s=e.get(qe),n=e.get(Me);s.createItem(n[i(1426)](ys)),s[i(1654)](n[i(1426)](gs))}});var vs=function(t,e){return function(i,s){e(i,s,t)}};let bs=class extends Ri{constructor(i,s,n,o,r){const a=t;super(a(1079),i,a(763)),this[a(1637)]=s,this._contextKeyService=n,this[a(1664)]=o,this[a(1304)]=r,this._timeout=0,this[a(366)]=this._contextKeyService[a(1174)](4,!0),this.register(this.onDidChangeVisibility((t=>this._windowVisibleContextKey[a(971)](t))));const h=this[a(1776)](a(1254),a(1404),this[a(1304)][a(1586)],a(1614));this[a(1304)][a(192)]((t=>{const e=a;h[e(1728)]=t,this[e(1348)](),this._viewportUpdate()}));const c=this._createToggle(a(1210),"minimap.toggleShowViewport",this._minimapService[a(295)],a(1388));this._minimapService[a(862)]((t=>{c[a(1728)]=t,this._viewportUpdate()})),this._headerContentElement[a(705)](h,c),this[a(397)]=document.createElement("canvas"),this._canvas[a(1564)]=200,this[a(397)].height=200,this[a(397)][a(1712)][a(1564)]="200px",this[a(397)].style.height="200px",this[a(1324)]((0,e.Lw)(this[a(397)],a(1093),(t=>{const e=a;if(!this._eventInViewport(t)){const i=this[e(1684)]();this[e(1637)][e(339)].x=-((t.offsetX-i[e(707)])/i[e(1564)]*this[e(1637)][e(947)][e(1564)]-this[e(1637)][e(947)][e(1564)]/2),this._luna[e(339)].y=-((t[e(680)]-i[e(1082)])/i[e(918)]*this[e(1637)].layer[e(918)]-this[e(1637)].layer.height/2)}this[e(397)].setPointerCapture(t[e(493)]),this._canvas[e(175)].add(e(760)),this[e(1714)]=[t[e(1575)],t[e(680)]],this._viewportOrigin=[this._luna[e(339)].x,this[e(1637)][e(339)].y]}))),this[a(1324)]((0,e.Lw)(this[a(397)],a(747),(t=>{const e=a;this[e(397)][e(1671)](t[e(493)]),this[e(397)][e(175)][e(1770)](e(760)),this[e(1714)]=void 0,this[e(243)]=void 0}))),this[a(1324)]((0,e.Lw)(this[a(397)],"pointermove",(t=>{const e=a,i=this[e(1637)][e(339)][e(1249)],s=0===i[e(707)]&&0===i.top&&i[e(895)]===this[e(1637)][e(947)][e(1564)]&&i[e(799)]===this._luna[e(947)].height;if(this[e(397)][e(175)][e(1414)](e(1011),!s&&this[e(762)](t)),!this[e(1714)]||!this[e(243)])return;const n=this[e(1684)]();this[e(1637)].viewport.x=this[e(243)][0]+(this[e(1714)][0]-n[e(707)]-(t[e(1575)]-n.left))*(this._luna[e(947)].width/n[e(1564)]),this[e(1637)][e(339)].y=this[e(243)][1]+(this[e(1714)][1]-n[e(1082)]-(t[e(680)]-n[e(1082)]))*(this._luna[e(947)].height/n[e(918)])}))),this[a(1324)]((0,e.Lw)(this[a(397)],a(1138),(t=>{const e=a;this[e(397)][e(175)][e(1770)](e(1011))}))),this[a(1324)]((0,e.Lw)(this._canvas,a(609),(t=>{const e=a;le.V?t[e(1834)]<0?this[e(1637)][e(339)][e(583)](-t[e(1834)]/20):this._luna.viewport[e(1178)](t[e(1834)]/20):t[e(1834)]<0?this[e(1637)][e(339)][e(583)]():this[e(1637)][e(339)].zoomOut()}))),this[a(500)]=this[a(397)].getContext("2d"),this[a(1832)]=document[a(1296)](a(1683)),this[a(1832)][a(175)].add("minimap-viewport"),this[a(1769)][a(705)](this[a(397)],this[a(1832)]),this[a(1324)](this[a(1637)][a(1145)].onEntriesChange((()=>this[a(1348)]()))),this[a(1324)](this[a(1637)][a(947)][a(238)]((()=>this[a(1348)]()))),this[a(1324)](this[a(1637)][a(339)][a(1496)]((()=>this[a(654)]()))),this[a(1603)](),this[a(654)]()}_queueUpdate(){const e=t;this[e(1637)][e(947)][e(1564)]&&0===this._timeout&&(this[e(1023)]=setTimeout((()=>{const t=e;this[t(1603)](),this[t(1023)]=0})))}async[t(1603)](){const e=t,i=await this._luna[e(432)][e(1589)]();if(!i[e(1564)]||!i[e(918)])return void this[e(397)][e(175)][e(1591)]("hidden");this[e(397)][e(175)][e(1770)](e(1439));const s=new ImageData(new Uint8ClampedArray(i[e(356)]),i[e(1564)],i[e(918)]),n=await createImageBitmap(s);this[e(500)][e(371)]=i[e(1564)]>200||i[e(918)]>200,this[e(500)][e(599)](0,0,200,200);const o=this[e(1684)]();this[e(500)][e(1841)](n,o[e(707)],o[e(1082)],o[e(1564)],o[e(918)])}_viewportUpdate(){const e=t;if(!this[e(1637)][e(947)].width)return;const i=this[e(1637)].layer,s=this[e(1684)](),n=this[e(1637)].viewport.visibleRange,o=0===n[e(707)]&&0===n[e(1082)]&&n.right===i[e(1564)]&&n.bottom===i[e(918)];this[e(1832)][e(175)][e(1414)](e(1439),o||!this[e(1304)][e(295)]),this._viewportPosition={left:s.left+Math[e(827)](n[e(707)]/i[e(1564)]*s[e(1564)]),top:s[e(1082)]+Math[e(827)](n[e(1082)]/i[e(918)]*s[e(918)]),width:Math.round((n[e(895)]-n[e(707)])/i[e(1564)]*s[e(1564)]),height:Math[e(827)]((n[e(799)]-n.top)/i[e(918)]*s[e(918)])},this[e(1832)].style.left=this[e(1557)][e(707)]+"px",this[e(1832)].style[e(1082)]=this[e(1557)].top+"px",this[e(1832)][e(1712)][e(1564)]=this[e(1557)].width+"px",this[e(1832)][e(1712)][e(918)]=this[e(1557)][e(918)]+"px"}[t(762)](e){const i=t;return!!this._viewportPosition&&e[i(1575)]>this[i(1557)][i(707)]&&e[i(1575)]<this._viewportPosition[i(707)]+this._viewportPosition[i(1564)]&&e[i(680)]>this[i(1557)][i(1082)]&&e[i(680)]<this[i(1557)][i(1082)]+this[i(1557)][i(918)]}[t(1776)](e,i,s,n){const o=t,r=document[o(1296)](o(461));return r.type=o(1777),r.id=e,r[o(1728)]=s,r.title=n,r.classList[o(1591)](e,o(468)),r[o(297)](o(1550),(()=>this[o(1664)].runCommand(i))),r}[t(1684)](){const e=t;return(0,Yt.M_)(this._luna.layer[e(1564)],this[e(1637)][e(947)][e(918)],200,200,this[e(1304)][e(1586)])}};bs=function(e,i,s,n){const o=t;var r,a=arguments[o(1225)],h=a<3?i:null===n?n=Object[o(224)](i,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect[o(1177)])h=Reflect[o(1177)](e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([vs(1,je),vs(2,De),vs(3,Re),vs(4,oi)],bs);let xs=class extends e.JT{constructor(e){const i=t;super(),this[i(1601)]=e,this[i(189)]=0,this[i(1250)]=1,this[i(521)]=i(696),this.hasImage=!0,this[i(1009)]="",this.title=i(1514),this[i(880)]=i(237),this[i(299)]=this[i(1324)](new n.v),this[i(1496)]=this[i(299)].event,this[i(1601)].onDidChangeViews((()=>this[i(1603)]())),this[i(1603)]()}[t(1603)](){const e=t;this.checked=this[e(1601)][e(804)](e(1079)),this[e(299)].fire()}};var Is,Ss;xs=function(e,i,s,n){const o=t;var r,a=arguments[o(1225)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(383)&&"function"==typeof Reflect[o(1177)])h=Reflect[o(1177)](e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1167)](i,s,h),h}([(Is=0,Ss=Ye,function(t,e){Ss(t,e,Is)})],xs),ti[t(1324)](t(1079),{ctor:bs,defaultVisible:!1,defaultPosition:{x:t(185),y:t(185)}}),ci[t(1324)]({start(e){const i=t,s=e[i(1375)](qe),n=e[i(1375)](Me);s[i(1654)](n[i(1426)](xs))}}),xi({id:t(237),label:t(1812),section:t(194),checked:4,run:e=>e[t(1375)](Ye)[t(1343)](t(1079))}),xi({id:t(1205),label:"Toggle Show Viewport",section:"Minimap",run:e=>{const i=t,s=e[i(1375)](oi);s[i(295)]=!s.showViewport}}),xi({id:t(1404),label:t(606),section:t(763),run:e=>{const i=t,s=e[i(1375)](oi);s[i(1586)]=!s[i(1586)]}});var Es=function(t,e){return function(i,s){e(i,s,t)}};let Cs=class extends Ri{constructor(i,s,n,o,r){const a=t;super(a(574),i,a(903)),this._luna=s,this[a(1071)]=n,this[a(951)]=o,this[a(1789)]=r,this[a(280)]=new Map,this[a(1056)]=new Map,this[a(366)]=this[a(1071)][a(1174)](2,!0),this[a(1324)](this[a(1207)]((t=>this[a(366)][a(971)](t)))),this[a(1701)]=document[a(1296)](a(1683)),this._layerListElement[a(175)][a(1591)](a(1766));const h=document[a(1296)](a(1683));h[a(175)][a(1591)](a(1581)),h.append(this[a(431)](a(1524),(()=>this._luna.layer[a(1824)]()),a(1739)),this[a(431)](a(1533),(()=>this._luna.layer[a(1135)]()),"Delete the active layer"),this[a(431)]("layer-duplicate",(()=>this[a(1637)].layer.duplicateLayer()),a(797)),this[a(431)](a(307),(()=>this._luna[a(947)][a(1542)]()),a(1313)),this[a(431)](a(516),(()=>this._luna[a(947)][a(550)]()),a(1013)),this._createButton(a(614),(()=>this[a(1637)].layer[a(310)]()),a(552)),this[a(713)]()),this[a(1769)].append(this[a(1701)],h),this.register(this[a(1637)].layer.onLayerChange((()=>this[a(1493)]()))),this[a(1324)]({dispose:()=>{const t=a;for(const i of this._layerListItems.values())(0,e._c)(i[t(809)])}}),this[a(1493)]()}[t(431)](e,i,s){const n=t,o=document.createElement(n(750));o.id=e,o[n(1403)]=s;const r=document[n(1296)](n(250));return o[n(598)](r),o[n(175)][n(1591)](e,"luna-icon"),o[n(297)]("click",i),o}[t(713)](){const e=t,i=document.createElement(e(1595)),s=[e(1579),"darken",e(1133),e(1221),e(1132),"screen","linearDodgeAdd",e(1326),e(704),e(926),e(1022)];for(const t of s){const s=document.createElement("option");s[e(1698)]=t,s.value=t,this[e(1056)][e(971)](t,s),i[e(598)](s)}return i.addEventListener(e(1749),(()=>{const t=e;this._luna[t(947)][t(1222)]&&(this[t(1637)][t(947)].activeLayer[t(795)]=i.value)})),i}[t(1493)](){const i=t,s=this[i(1637)].layer[i(574)],n=this[i(1637)][i(947)][i(1222)];let o=null;for(let t=s[i(1225)]-1;t>=0;t--){const r=s[t];if(!this[i(280)][i(905)](r.id)){const t={container:document[i(1296)]("div"),nameSpan:document.createElement(i(616)),previewCanvas:document.createElement(i(1028)),visibleCheckbox:document[i(1296)](i(461)),disposables:[]};t[i(1452)][i(175)][i(1591)](i(947)),t[i(1452)][i(1703)]=0,t[i(1452)][i(866)]=!0,t[i(809)][i(1686)]((0,e.Lw)(t[i(1452)],i(1338),(t=>{const e=i;this[e(1769)][e(175)][e(1591)]("dragging"),t[e(1785)]&&(t.dataTransfer[e(806)]=e(288),t[e(1785)][e(1660)]="move",t.dataTransfer[e(1306)]("text/plain",e(613)+r.id)),t[e(1017)]()}))),t[i(809)][i(1686)]((0,e.Lw)(t[i(1452)],i(1110),(()=>{const t=i;this[t(1769)].classList.remove(t(1460))}))),t.disposables[i(1686)]((0,e.Lw)(t[i(1452)],i(1440),(e=>{const s=i;t[s(1452)][s(175)].remove(s(485));const n=this._getLayerDragEventId(e),o=this[s(1637)][s(947)].layers[s(822)]((t=>t.id===n));o&&this._luna[s(947)].moveLayerTo(o,r),e[s(1017)]()}))),t[i(809)][i(1686)]((0,e.Lw)(t[i(1452)],i(686),(e=>{const s=i,n=this._getLayerDragEventId(e);r.id!==n&&(e[s(787)](),t.container.classList[s(1591)]("drop-target"))}))),t[i(809)][i(1686)]((0,e.Lw)(t[i(1452)],i(1263),(e=>{const s=i;t[s(1452)][s(175)].remove("drop-target")}))),t[i(402)][i(175)][i(1591)](i(1582)),t.previewCanvas.width=40,t[i(402)][i(918)]=40;let s=!1;t.disposables.push(r[i(1496)]((()=>{s=!0,this[i(1126)](t,r)}))),this[i(1362)][i(1686)](this[i(1637)][i(1145)][i(860)]((()=>{s&&(this[i(1446)](r,t),s=!1)}))),this[i(1446)](r,t),t.container[i(598)](t[i(402)]),t[i(983)][i(175)][i(1591)](i(1027)),t[i(1452)][i(598)](t[i(983)]),t[i(252)][i(352)]=i(1777),t[i(252)][i(175)][i(1591)](i(1200)),t[i(252)][i(297)](i(1749),(()=>r[i(804)]=!r[i(804)])),t[i(1452)].appendChild(t[i(252)]);const n=e=>{const s=i;e?.[s(189)]!==t[s(252)]&&(this[s(1637)][s(947)][s(1222)]=r)};t.container.addEventListener(i(1550),(t=>{const e=i;n(t),t[e(1078)]&&this[e(1637)].viewport[e(259)]()})),t.container.addEventListener(i(1430),(async t=>{const e=i;switch(t.preventDefault(),t.stopImmediatePropagation(),await this[e(951)].show([{id:"duplicate",label:e(457)},{id:e(985),label:e(932)},{id:"rename",label:e(666)},{id:"mergeDown",label:e(620)},{id:"fitLayerToWindow",label:e(709)+(le.V?"⌥":e(1201))+e(1146)}])){case e(916):await this[e(1637)].layer[e(896)](r);break;case e(985):this[e(1637)][e(947)].deleteLayer(r);break;case e(1267):const t=await this[e(1789)][e(1560)](e(453),r[e(1027)]);t&&this[e(1637)][e(947)][e(1116)](t,r);break;case e(1288):this[e(1637)][e(947)].activeLayer=r,await this[e(1637)][e(947)][e(1542)]();break;case e(259):this[e(1637)][e(339)][e(259)]()}})),t[i(1452)][i(297)](i(1621),(e=>{const s=i;switch(e.key){case s(270):t[s(1452)].previousSibling?.[s(1836)](),e[s(787)]();break;case s(1373):t.container[s(1561)]?.[s(1836)](),e[s(787)]();break;case s(1016):case s(1477):n()}})),this._layerListItems[i(971)](r.id,t),t[i(809)][i(1686)](r.onDispose((()=>{const e=i;this[e(1701)][e(1019)](t[e(1452)]);for(const i of t.disposables)i[e(980)]();this[e(280)][e(985)](r.id)})))}const a=this[i(280)][i(1375)](r.id),h=r.id===n?.id;a[i(1452)][i(175)].toggle(i(1376),h),this[i(1126)](a,r),null===o?(!a.container.parentElement||null!==a.container[i(529)])&&(this[i(1701)][i(251)]?this[i(1701)][i(1544)](a.container,this[i(1701)].firstChild):this._layerListElement[i(598)](a[i(1452)])):a.container.previousSibling!==o&&o[i(596)](i(274),a[i(1452)]),o=a[i(1452)]}if(n){const t=this._blendModeOptions[i(1375)](n[i(795)]);t&&(t.selected=!0)}}[t(1126)](e,i){const s=t;e[s(983)][s(1698)]=i[s(1027)],e.visibleCheckbox[s(1728)]=i.isVisible;const n=this._luna[s(947)][s(1222)];if(i.id===n?.id){const t=this._blendModeOptions[s(1375)](n[s(795)]);t&&(t[s(828)]=!0)}}[t(1241)](e){const i=t,s=e.dataTransfer.getData("text/plain");if(s?.startsWith(i(613)))return parseInt(s[i(1726)](13))}[t(1446)](e,i){const s=t;e[s(1248)](40,40).then((t=>{const e=s,n=i[e(402)][e(714)]("2d");n.imageSmoothingEnabled=!1,n[e(599)](0,0,40,40),n.drawImage(t,0,0)}))}};Cs=function(e,i,s,n){const o=t;var r,a=arguments[o(1225)],h=a<3?i:null===n?n=Object[o(224)](i,s):n;if(typeof Reflect===o(383)&&typeof Reflect[o(1177)]===o(575))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1167)](i,s,h),h}([Es(1,je),Es(2,De),Es(3,Oe),Es(4,Je)],Cs),ti[t(1324)](t(574),{ctor:Cs,defaultVisible:!0,defaultPosition:{x:t(185),y:{side:"end",target:t(1079)}}}),xi({id:t(1024),label:"Toggle Layers Window",section:"Window",checked:2,run:e=>e[t(1375)](Ye).toggleView(t(574))}),xi({id:t(1417),label:t(1196),section:"Layer",run:e=>e[t(1375)](je)[t(947)][t(1824)](),keys:t(1704)}),xi({id:"layer.deleteLayer",label:t(1137),section:"Layer",run:e=>e[t(1375)](je)[t(947)].deleteLayer(),keys:"ctrl+shift+delete"}),xi({id:t(1772),label:"Duplicate Layer",section:t(1585),run:e=>e[t(1375)](je)[t(947)][t(896)](),keys:t(1399)}),xi({id:t(1569),label:t(1383),section:t(1585),run:e=>e[t(1375)](je)[t(947)][t(1542)](),keys:t(546)}),xi({id:"layer.renameLayer",label:"Rename Layer",section:t(1585),run:async e=>{const i=t,s=e.get(je),n=e[i(1375)](Je),o=await n[i(1560)](i(453),s[i(947)].activeLayer?.[i(1027)]||"");o&&s.layer[i(1116)](o)}}),xi({id:t(233),label:t(933),section:"Layer",run:async e=>{const i=t,s=e[i(1375)](je);s.task.executeOnSingleLayer(i(1236),{selection:s[i(1814)][i(1707)]})}}),xi({id:t(1835),label:t(1675),section:t(1585),run:async e=>{const i=t,s=e[i(1375)](je);s[i(788)][i(340)](i(350),{selection:s[i(1814)].range})}}),xi({id:t(332),label:"Rotate 180",section:t(1585),run:async e=>{const i=t,s=e.get(je);s.task[i(340)](i(1245),{selection:s[i(1814)][i(1707)]})}}),xi({id:"layer.goToTopLayer",label:"Go to Top Layer",section:t(1585),run:e=>e[t(1375)](je).layer.goToTopLayer(),keys:t(1476)}),xi({id:t(931),label:t(1293),section:t(1585),run:e=>e[t(1375)](je)[t(947)][t(1029)](),keys:"ctrl+alt+pagedown"}),xi({id:t(1693),label:"Go to Layer Above",section:t(1585),run:e=>e.get(je).layer[t(1317)](),keys:"alt+pageup"}),xi({id:"layer.goToLayerBelow",label:t(610),section:"Layer",run:e=>e[t(1375)](je)[t(947)][t(1189)](),keys:t(323)}),xi({id:t(1706),label:t(1646),section:t(1585),run:e=>e[t(1375)](je)[t(947)][t(377)]()}),xi({id:"layer.moveLayerUp",label:t(235),section:"Layer",run:e=>e[t(1375)](je)[t(947)].moveLayerUp()}),xi({id:t(661),label:t(1615),section:t(1585),run:e=>e[t(1375)](je)[t(947)][t(310)]()}),xi({id:t(1125),label:t(890),section:t(1585),run:e=>e.get(je)[t(947)][t(408)]()});class Ls extends e.JT{constructor(){const e=t;super(...arguments),this[e(189)]=0,this[e(1250)]=1,this[e(521)]="report-issue",this[e(720)]=!0,this.text="",this[e(1403)]=e(1353),this.commandId="help.reportIssue"}}const Ts=Te(t(221));async function As(e,i,s,n,o=!1){const r=t;switch(await s[r(432)][r(736)](e,i,o),i){case r(1021):Rs(n)}}function Rs(e){const i=t;e[i(1448)](i(255)),e.hideView(i(574)),e[i(1159)](i(1079))}function Ds(){const e=t,i=ks(getComputedStyle(document[e(314)]).getPropertyValue(e(1481)));void 0!==i&&document[e(816)][e(1712)][e(920)](e(1763),i);const s=ks(getComputedStyle(document[e(314)])[e(1141)](e(338)));void 0!==s&&document[e(816)].style.setProperty(e(726),s);const n=ks(getComputedStyle(document.documentElement)[e(1141)](e(1325)));void 0!==n&&document[e(816)][e(1712)][e(920)]("--luna-statusBar-icon-brightness",n)}function Ms(e,i,s){const n=t;e[n(1375)](9)?.[n(971)](s),Bs(i,"luna:supportsMultipleImages",s)}function Bs(e,i,s){const n=t;return e[n(1420)](n(219),{key:i,value:s})}function ks(e){const i=t;let s,n,o,r;if(e[i(311)]("rgba"))[s,n,o,r]=e[i(742)](5,e[i(226)](")"))[i(294)](",")[i(1522)]((t=>+t.trim()));else{if(7!==e.length)return;s=parseInt(e[i(1726)](1,2),16),n=parseInt(e[i(1726)](3,2),16),o=parseInt(e[i(1726)](5,2),16),r=1}return((s+n+o)*r/765)[i(1669)](2)}ci.register({start(e){const i=t,s=e[i(1375)](qe),n=e[i(1375)](Me);s[i(1654)](n.createInstance(Ls))}}),xi({id:t(1444),label:t(1818),section:t(1390),run:e=>e[t(1375)](Ts)[t(1645)]()}),ci.register({start(e){const i=t,s=e[i(1375)](je),n=e.get(De),o=e[i(1375)](li),r=e.get(Ke),a=e[i(1375)](Ye);let h;o[i(427)]("luna.executeCommand",(async t=>{const s=i;let n=!0;try{await e.get(Re)[s(534)](t)}catch(e){console.error(s(1300)+t+" failed",e),n=!1}return{success:n}})),o[i(427)](i(794),(t=>{const e=i;s[e(339)][e(968)]=t[e(968)]})),o.registerRequestHandler("save",(async t=>{const n=i,o=e[n(1375)](Je),r=s[n(432)][n(1526)];if(void 0===h&&(r===n(227)||r===n(347))){if(h=await o[n(956)]("Enter save quality between 0 and 100",80,0,100),void 0===h)throw new Error("Quality not selected");h/=100}const a=performance[n(451)](),c=await(t.isAutoSaveEnabled?s[n(432)][n(1470)]():s[n(432)][n(1733)]({encodeOptions:{quality:h,type:r}}));return{blobBuffer:Array[n(1566)](new Uint8Array(await c[n(436)]())),encodeDuration:performance[n(451)]()-a}})),o[i(427)]("backup",(async t=>{const e=i;return t[e(1644)]&&t[e(1644)]<s.layer[e(1564)]*s[e(947)][e(918)]?{success:!1}:{success:!0,state:s[e(432)][e(1428)](t[e(1644)]),workbenchState:r[e(1087)]}})),o[i(427)]("open",(async t=>{const e=i;h=void 0,As(t.data,t[e(1449)],s,a)})),o.request(i(1278),void 0)[i(1594)]((async e=>{const h=i,c=performance[h(451)]();switch(e[h(352)]){case h(1499):{s[h(432)][h(1472)](e[h(577)].width,e.dimensions[h(918)],e.extName);const t=".ico"===e[h(1449)];Ms(n,o,t),t&&Rs(a);break}case h(1387):try{const t=await Ei[h(476)]();if(t){s.file[h(736)](new Uint8Array(await t.arrayBuffer()),h(343),!1);break}}catch{}s.file[h(1472)](e.fallbackDimensions[h(1564)],e[h(774)].height),Ms(n,o,!1);break;case"open":await As(e[h(356)],e.extName,s,a,e[h(861)]),Ms(n,o,e.extName===h(1021));break;case"restore":if((!e[h(1103)]||0===e[h(1087)].body[h(1145)]?.[h(403)]?.[h(1225)])&&(e[h(1087)].body.history={currentEntry:0,entries:[(new V)[h(1461)]()]}),s[h(432)][h(1849)](e[h(1087)]),void 0!==e[h(1819)]&&e[h(1819)]!==e[h(1087)][h(816)][h(1145)][h(464)]){let t=e[h(1087)].body[h(1145)][h(464)]-e[h(1819)];if(t>0)for(;0!=t--&&s[h(1145)][h(1811)];)await s.history.undo();else if(t<0)for(;0!=t++&&s[h(1145)][h(1163)];)await s.history[h(474)]()}Ms(n,o,!1)}r[h(1849)](e[h(1197)]),function(e,i){const s=t;e[s(339)][s(968)]=i[s(968)]}(s,e[h(239)]),o[h(1420)]("parseFinished",{duration:performance[h(451)]()-c})})),r[i(829)]((t=>o[i(1420)](i(1394),t))),o[i(427)](i(1825),(()=>s[i(506)][i(1065)]())),window[i(297)](i(1836),(()=>{const t=i;Bs(o,t(1415),!0),s[t(506)][t(1511)]()})),window[i(297)](i(871),(()=>{Bs(o,i(1415),!1)})),window[i(297)]("focusin",(t=>{const e=i,s=t.target;if(s.tagName!==e(278))Bs(o,e(472),!1);else{const t=s,i=t[e(352)]===e(1009)||t[e(352)]===e(563);Bs(o,e(472),i)}})),window[i(297)](i(1820),(t=>{Bs(o,"luna:textFocused",!1)})),s.history[i(860)]((t=>{const e=i;!t||s[e(1145)][e(403)].length<=1||s[e(1145)][e(385)]!==s[e(1145)][e(403)][s[e(1145)][e(403)][e(1225)]-1]||o[e(1420)]("historyNewEdit",{label:s.history[e(385)][e(306)]})})),s.file[i(1203)]((t=>{const e=i;o[e(1420)](e(1780),t)})),xi({id:i(936),label:i(1008),section:i(1339),run:()=>{const t=i;return o.request(t(1853),{command:t(622),args:t(973)})}}),e[i(1375)](qe).createItem({text:i(1610),alignment:0,className:i(1148),hasImage:!0,target:0,dispose:()=>{},commandId:i(936)}),Mi[i(687)]=()=>o[i(1420)](i(1853),{command:i(474)}),Mi.undoHandler=()=>o[i(1420)](i(1853),{command:i(289)}),new MutationObserver((()=>Ds()))[i(1319)](document[i(314)],{attributes:!0,attributeFilter:[i(1712)]}),Ds()}});let Ps=class{constructor(e){this[t(414)]=e}async[t(1645)](){return this[t(414)].request("reportIssue",void 0)}};var Us,Fs;Ps=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(224)](i,s):n;if(typeof Reflect===o(383)&&typeof Reflect[o(1177)]===o(575))h=Reflect[o(1177)](e,i,s,n);else for(var c=e[o(1225)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1167)](i,s,h),h}([(Us=0,Fs=li,function(t,e){Fs(t,e,Us)})],Ps);const Ns=new ze,Os=new me;Os.task[t(1215)]=!0,Ns[t(191)](je,Os);const Vs=window.acquireVsCodeApi();window.acquireVsCodeApi=void 0,Ns[t(191)](li,Ns.createInstance(di,Vs)),Ns[t(191)](Ke,Ns[t(1426)](ai)),Ns.setService(Je,Ns[t(1426)](wi)),Ns[t(191)](Oe,Ns[t(1426)](mi)),Ns[t(191)](De,Ns[t(1426)](Fe)),Ns[t(191)](Re,Ns[t(1426)](Ue)),Ns[t(191)](Ve,Ns.createInstance(pi)),Ns[t(191)](qe,Ns[t(1426)](Ge)),Ns[t(191)](We,Ns.createInstance(ui)),Ns.setService(oi,Ns[t(1426)](ri)),Ns[t(191)](Ye,Ns[t(1426)](si)),Ns[t(191)](Ts,Ns[t(1426)](Ps)),new class{constructor(e){const i=t,s=document.querySelector(i(739));e[i(537)](je)[i(339)].attach(s);for(const t of ci[i(1711)]())e[i(1827)](t[i(1573)][i(1174)](t))}}(Ns)})()})();