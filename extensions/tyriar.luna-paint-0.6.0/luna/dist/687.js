const a12_0x456c=["softLight","Blend Mode","screen","move","110PEgxmi","exclusion","none","_updateQuality","811341aRIIdD","pointerDown","Expand Canvas to Selection","onHistoryUnset","2078vTtTCF","onLayerChange","push","_startMove","event","isReady","currentState","_container","_setupActiveTemporaryLayer","_enabled","onTemporaryLayerRegistered","imageService","removeChild","flipY","onBeforeRunLayerTask","Move Pixels","ctrlKey","_onOptionsChange","_onHistoryUpdateValue","topright","_selectionService","order","overlay","appendChild","onHistoryUpdateValue","onStateChange","zoom","bilinear","_getQualityValue","_imageService","onUpdate","normal","registerTemporaryLayer","nearestneighbor","enabled","pointerUp","devicePixelRatio","difference","_finishSelection","register","_clearMovingLayer","52232fSOiOO","topleft","bottomright","quality","key","moveToRange","1yTgSnD","_refreshLayerSelectionRange","fire","_value","moving","render","1190866rIYuYO","display","edit","cutImage","shiftKey","_isCursorDown","currentLayer","finishSelection","_activeMovingLayer","_renderer","_qualityOption","get","runTask","_isFirstMove","817226hWMRYw","_getQualityString","type","Quality","onUpdateEmitter","_directionalMoveElements","18izaqOJ","resource","optionStep","taskWorkerService","setValueFromHistoryChange","_viewportService","height","keyDown","lighten","_directionalMoveZones","move-handle","linearDodgeAdd","_onUpdate","Finish Selection","createElement","offsetY","width","642953FIqiHG","_expandCanvasToSelectionAction","number","ArrowDown","bottomleft","webpackChunkluna","range","Bilinear","_refreshActionEnabledState","validate","value","bottom","right","ArrowLeft","pointerDownMove","darken","createCompositeEntrySync","120289HNuoxu","moveStep","selectAll","taskService","add","_cursorCurrent","onHistoryAction","triggerRequestRender","selectionService","commit","div","name","setVisible","movePixels","replace","round","string","multiply","_activeLayer","data","viewportService","9VaknPs","createDomRenderProgram","_isVisible","_onStateChange","flipX","max","_originalSelection","linearBurn","ArrowRight","set","temporaryLayer","No moving layer","offsetX","_elementContainer","_cursorOrigin","getCoordsFromEvent","_sc","options","min","actions","_movingLayerOrigin","slice","historyService","setTopLeft","Nearest Neighbor","_onRequestRender","Set Quality Sampling","top","left","state","style"],a12_0x4e87=function(t,e){return a12_0x456c[t-=162]},a12_0x2d023b=a12_0x4e87;(function(t,e){const i=a12_0x4e87;for(;;)try{if(628183===parseInt(i(237))*-parseInt(i(258))+parseInt(i(183))+-parseInt(i(220))+parseInt(i(171))*parseInt(i(203))+-parseInt(i(301))*-parseInt(i(293))+parseInt(i(177))*parseInt(i(297))+-parseInt(i(197)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a12_0x456c),(self.webpackChunkluna=self[a12_0x2d023b(225)]||[])[a12_0x2d023b(303)]([[687],{6173:(t,e,i)=>{"use strict";const s=a12_0x2d023b;i.d(e,{f:()=>h});var r=i(1815),n=i(5120);class h extends n.JT{constructor(t,e,i){const s=a12_0x4e87;super(),this.name=t,this[s(199)]=e,this[s(310)]=i,this[s(215)]=this.register(new r.v),this.onUpdate=this[s(215)].event}get[s(164)](){return this[s(310)]}set[s(164)](t){const e=s;this._enabled!==t&&(this[e(310)]=t,this[e(215)][e(179)]())}}},9904:(t,e,i)=>{"use strict";const s=a12_0x2d023b;i.d(e,{rP:()=>h,bG:()=>o,Jp:()=>a,qv:()=>c});var r=i(1815),n=i(5120);class h extends n.JT{constructor(t,e,i){const s=a12_0x4e87;super(),this[s(248)]=t,this.options=e,this[s(180)]=i,this.type=s(253),this[s(319)]=this.register(new r.v),this[s(325)]=this[s(319)][s(305)],this[s(215)]=this[s(169)](new r.v),this[s(331)]=this[s(215)][s(305)]}get[s(230)](){return this[s(180)]}set value(t){const e=s;this._value=t,this._onUpdate[e(179)]()}[s(207)](t){const e=s;this._value=t,this._onHistoryUpdateValue[e(179)](t)}}class o extends h{constructor(){const t=s;super(t(290),[t(332),t(235),t(254),t(265),"lighten",t(291),t(214),t(323),t(289),t(167),"exclusion"],t(332))}}class a extends h{constructor(){const t=s;super(t(290),[t(332),t(251),t(235),t(254),"linearBurn",t(211),t(291),t(214),t(323),"softLight",t(167),t(294)],"normal")}}class c extends n.JT{constructor(t,e,i,n){const h=s;super(),this[h(248)]=t,this._value=e,this[h(276)]=i,this.max=n,this[h(199)]=h(222),this[h(319)]=this[h(169)](new r.v),this[h(325)]=this[h(319)][h(305)],this._onUpdate=this[h(169)](new r.v),this[h(331)]=this[h(215)][h(305)]}get[s(230)](){return this._value}set[s(230)](t){const e=s;this._value=t,this[e(215)][e(179)]()}[s(207)](t){const e=s;this[e(180)]=t,this[e(319)][e(179)](t)}}},687:(t,e,i)=>{"use strict";const s=a12_0x2d023b;i.r(e),i.d(e,{default:()=>v});var r=i(1815),n=i(7896),h=i(5120),o=i(1003),a=i(270),c=i(6173),l=i(9904);class u extends h.JT{constructor(t){const e=a12_0x4e87;super(),this[e(274)]=t,this.id=e(250),this[e(287)]="move",this[e(196)]=!0,this[e(188)]=!1,this[e(221)]=new c.f(e(299),"expand-canvas-to-selection",!1),this[e(277)]=[this[e(221)]],this[e(193)]=new l.rP(e(200),["Bilinear",e(282)],e(227)),this[e(275)]=[this[e(193)]],this[e(283)]=this.register(new r.v),this.onRequestRender=this[e(283)][e(305)],this[e(261)]=this[e(169)](new r.v),this[e(326)]=this[e(261)].event,this[e(169)](this[e(193)][e(331)]((()=>this[e(296)]()))),this[e(169)](this._sc.imageService[e(302)]((()=>this._finishSelection()))),this[e(169)](this._sc[e(240)][e(315)]((t=>{t[e(190)]&&this._finishSelection()}))),this.register(this[e(274)].selectionService[e(331)]((()=>{const t=e;this[t(178)](),this[t(228)](),this[t(283)][t(179)]()}))),this[e(169)](this[e(274)].imageService[e(311)]((t=>this[e(309)](t)))),this[e(274)][e(312)][e(189)]?.[e(268)]&&this[e(309)](this[e(274)][e(312)].currentLayer.temporaryLayer),this._refreshActionEnabledState()}_setupActiveTemporaryLayer(t){const e=a12_0x4e87;"moving"===t.type&&(this[e(191)]=t,this.register(this[e(191)][e(243)]((()=>this[e(318)]()))),this[e(169)](this._activeMovingLayer[e(300)]((()=>this._clearMovingLayer()))),this[e(192)]?.setVisible(!0),this._refreshLayerSelectionRange(),this._refreshActionEnabledState(),this[e(283)].fire())}[s(178)](){const t=s;if(!this[t(191)])return;const e=this[t(274)][t(245)][t(226)];e&&this[t(191)][t(176)](e)}[s(228)](){const t=s,e=this[t(274)][t(245)][t(226)],i=!(!e||(0,o.ur)((0,o.DI)(this[t(274)].imageService[t(219)],this._sc[t(312)][t(209)]),e));this[t(221)][t(164)]=i}[s(318)](){const t=s;this._activeMovingLayer&&this._qualityOption.setValueFromHistoryChange(this[t(198)](this._activeMovingLayer[t(307)].quality))}dispose(){this[s(168)](),super.dispose()}async[s(298)](t){const e=s;if(this[e(188)]=!0,this[e(255)]=this[e(274)][e(312)][e(189)],!this[e(255)])return;const i=this[e(274)][e(245)][e(226)]||this[e(274)][e(312)][e(239)]();this[e(196)]=!this._activeMovingLayer,this[e(272)]=this._sc[e(257)][e(273)](t),this[e(242)]=this[e(272)][e(279)](),this[e(278)]=[i[e(286)],i[e(285)]],await this[e(304)](this[e(255)],i),this[e(264)]=this[e(274)][e(245)][e(226)]}async[s(165)](){const t=s;if(this[t(188)]=!1,!this[t(255)])return;if(!this[t(191)])return;const e=this[t(191)],i=this[t(196)]?"Move Selected Pixels":t(316);this[t(274)][t(280)][t(236)](i,(()=>{const s=t;e.moveStep(),this._sc[s(245)].commit(i)})),this._isFirstMove=!1}pointerMove(t){const e=s;if(this[e(192)]&&!this._isCursorDown){const i=this[e(192)].getPointerState(t);this[e(287)]!==i&&(this[e(287)]=i,this[e(261)][e(179)]())}}[s(234)](t){const e=s;if(!this[e(191)]||!this._cursorOrigin||!this[e(278)])return;if(this[e(242)]=this[e(274)][e(257)].getCoordsFromEvent(t),this[e(287)]===e(292)){const t=this[e(278)][0]+this[e(242)][0]-this[e(272)][0],i=this[e(278)][1]+this._cursorCurrent[1]-this[e(272)][1];return void this[e(274)].selectionService[e(281)](t,i)}if(!this._originalSelection)return;const i=this[e(242)][0]-this[e(272)][0],r=this[e(242)][1]-this[e(272)][1];let n;if(!t[e(187)]||this[e(287)]!==e(172)&&this[e(287)]!==e(320)&&"bottomleft"!==this.state&&this[e(287)]!==e(173))switch(n=(0,o.BN)(this[e(264)]),this[e(287)]){case e(172):n[e(286)]+=i,n[e(285)]+=r;break;case"topright":n.right+=i,n[e(285)]+=r;break;case e(224):n[e(286)]+=i,n[e(231)]+=r;break;case e(173):n[e(232)]+=i,n[e(231)]+=r;break;case e(285):n[e(285)]+=r;break;case e(231):n[e(231)]+=r;break;case e(286):n[e(286)]+=i;break;case e(232):n.right+=i}else{const t=(0,o.n3)(this[e(264)]);let s;switch(n=(0,o.BN)(this._originalSelection),this[e(287)]){case e(172):s=(1/t*-i-r)/2,n[e(286)]-=Math[e(252)](s*t),n[e(285)]-=Math[e(252)](s);break;case e(320):s=(i*(1/t)-r)/2,n.right+=Math[e(252)](s*t),n[e(285)]-=Math[e(252)](s);break;case e(224):s=(1/t*-i+r)/2,n.left-=Math[e(252)](s*t),n.bottom+=Math[e(252)](s);break;case"bottomright":s=(i*(1/t)+r)/2,n[e(232)]+=Math[e(252)](s*t),n.bottom+=Math.round(s)}}this._activeMovingLayer.currentState[e(262)]=n[e(232)]<n.left,this._activeMovingLayer[e(307)][e(314)]=n[e(231)]<n[e(285)],this[e(274)][e(245)][e(226)]=(0,o.FJ)(n)}async[s(210)](t){const e=s;if(!this[e(255)]&&(this._activeLayer=this._sc.imageService[e(189)]),!this[e(255)])return;if("ArrowUp"!==t[e(175)]&&"ArrowDown"!==t[e(175)]&&t[e(175)]!==e(233)&&t.key!==e(266))return;const i=this[e(274)][e(245)][e(226)]||this[e(274)][e(312)][e(239)]();if(this[e(196)]=!this._activeMovingLayer,this[e(196)]&&await this[e(304)](this[e(255)],i),!this._activeMovingLayer)throw new Error(e(269));const r=(n.V?t.metaKey:t[e(317)])?10:1;switch(t[e(175)]){case"ArrowUp":this._sc[e(245)][e(281)](i.left,i[e(285)]-r);break;case e(223):this._sc[e(245)][e(281)](i[e(286)],i.top+r);break;case e(233):this[e(274)][e(245)][e(281)](i.left-r,i[e(285)]);break;case e(266):this[e(274)].selectionService.setTopLeft(i[e(286)]+r,i.top)}this[e(191)][e(238)]()}async[s(304)](t,e){const i=s;if((!this._activeMovingLayer||this[i(191)]!==t[i(268)])&&t[i(268)]?.[i(199)]===i(181)&&(this[i(191)]=t[i(268)]),this[i(191)]&&this[i(191)]===t.temporaryLayer)return;t[i(268)]&&await t[i(268)][i(246)](),(0,o.l$)(e,(0,o.DI)(t[i(219)],t.height));const r=e[i(232)]-e[i(286)],n=e[i(231)]-e.top;let h;const c=new Promise((t=>h=t)),l={resource:{width:r,height:n,data:new Uint8Array(new SharedArrayBuffer(r*n*4))},readyPromise:c,isReady:!1};this[i(191)]=new a.m(t,l,e,this._getQualityValue(),this[i(274)][i(280)],this[i(274)].selectionService,this[i(274)][i(206)]),await t[i(162)](this._activeMovingLayer),await t[i(185)]((async(t,s,r)=>{const n=i;return await this._sc.taskWorkerService[n(195)](n(186),{cutImage:{data:l[n(204)][n(256)],width:l[n(204)].width,height:l[n(204)][n(209)]},cutRange:e,targetImage:{data:t,width:s,height:r}}),e})),h(l[i(204)]),l[i(306)]=!0,t[i(201)].fire(e)}async[s(168)](){const t=s,e=this._activeLayer||this[t(274)].imageService[t(189)];if(!e)return;if(!this[t(191)]&&e[t(268)]?.[t(199)]===t(181)&&(this[t(191)]=e[t(268)]),!this._activeMovingLayer)return;const i=this._activeMovingLayer;await this[t(274)][t(280)].createCompositeEntry(t(216),(async()=>{const s=t;await i[s(246)](),this[s(274)][s(245)][s(229)](e[s(219)],e[s(209)]),this[s(274)].selectionService.commit("Finish Selection")})),this[t(170)]()}[s(170)](){const t=s;this[t(255)]=void 0,this[t(191)]=void 0,this._renderer?.[t(249)](!1),this[t(283)].fire()}[s(296)](){const t=s,e=this[t(329)]();this[t(191)]&&this._activeMovingLayer.currentState.quality!==e&&(this._activeMovingLayer[t(307)][t(174)]=e,this._activeMovingLayer[t(205)](t(284)),this[t(191)][t(244)]())}_getQualityValue(){const t=s;switch(this._qualityOption[t(230)]){case"Bilinear":return"bilinear";case t(282):return t(163)}}[s(198)](t){const e=s;switch(t){case e(328):return e(227);case e(163):return e(282)}}[s(259)](t){const e=s;return this._renderer=new p(t,this[e(274)][e(245)],this[e(274)].viewportService,this._sc.imageService),this[e(192)]}}const v=u;class p extends h.JT{constructor(t,e,i,r){const n=s;super(),this[n(308)]=t,this[n(321)]=e,this[n(208)]=i,this._imageService=r,this[n(322)]=2,this[n(202)]=new Map,this[n(212)]=new Map,this[n(260)]=!0,this[n(271)]=document[n(217)](n(247));const h=[n(172),n(320),n(224),n(173),n(285),n(231),"left",n(232)];for(const t of h){const e=document[n(217)](n(247));e.classList[n(241)](n(213)),this[n(271)][n(324)](e),this[n(202)][n(267)](t,e),this[n(212)][n(267)](t,(0,o.Pq)())}this[n(308)].appendChild(this[n(271)]),this.register({dispose:()=>{const t=n;this[t(308)][t(313)](this[t(271)])}}),this[n(321)][n(331)]((()=>this.setVisible(void 0!==this[n(321)][n(226)]))),this.setVisible(void 0!==this[n(321)][n(226)])}[s(249)](t){const e=s;t!==this[e(260)]&&(this[e(271)].style[e(184)]=t?"":e(295),this[e(260)]=t)}[s(182)](){const t=s,e=this[t(321)].range;if(!e)return;const i=this[t(330)][t(189)];if(!i)return;const r=this[t(208)],n=Math[t(252)](this[t(308)].clientWidth/2)-i[t(219)]/2*r[t(327)],h=Math.round(this[t(308)].clientHeight/2)-i[t(209)]/2*r[t(327)],o=n+(r.x+e[t(286)])*r[t(327)],a=h+(r.y+e.top)*r.zoom,c=n+(r.x+e[t(232)])*r.zoom,l=h+(r.y+e[t(231)])*r[t(327)],u=Math.round((o+c)/2),v=Math[t(252)]((a+l)/2),p=10*window[t(166)],g={left:Math[t(276)](o+p,Math[t(263)](o,u-p)),top:Math[t(276)](a+p,Math[t(263)](a,v-p)),right:Math[t(263)](c-p,Math[t(276)](c,u+p)),bottom:Math.max(l-p,Math[t(276)](l,v+p))},_={left:o-p,top:a-p,right:c+p,bottom:l+p},d=this._directionalMoveZones[t(194)](t(172));d.left=_.left,d[t(232)]=g[t(286)],d[t(285)]=_[t(285)],d[t(231)]=g[t(285)];const y=this._directionalMoveElements[t(194)](t(172));y[t(288)][t(286)]=o+"px",y[t(288)][t(285)]=a+"px";const m=this._directionalMoveZones.get("topright");m[t(286)]=g[t(232)],m.right=_[t(232)],m[t(285)]=_[t(285)],m[t(231)]=g.top;const f=this[t(202)].get(t(320));f[t(288)][t(286)]=c+"px",f[t(288)][t(285)]=a+"px";const w=this[t(212)].get(t(224));w[t(286)]=_.left,w[t(232)]=g[t(286)],w[t(285)]=g[t(231)],w[t(231)]=_[t(231)];const S=this[t(202)][t(194)](t(224));S[t(288)][t(286)]=o+"px",S[t(288)].top=l+"px";const M=this._directionalMoveZones.get(t(173));M[t(286)]=g[t(232)],M[t(232)]=_[t(232)],M[t(285)]=g[t(231)],M[t(231)]=_[t(231)];const x=this[t(202)].get("bottomright");x[t(288)][t(286)]=c+"px",x.style[t(285)]=l+"px";const b=this[t(212)][t(194)]("top");b.left=g.left,b.right=g[t(232)],b.top=_[t(285)],b[t(231)]=g[t(285)];const L=this[t(202)][t(194)]("top");L.style[t(286)]=u+"px",L.style[t(285)]=a+"px";const k=this[t(212)][t(194)]("bottom");k[t(286)]=g[t(286)],k[t(232)]=g[t(232)],k[t(285)]=g[t(231)],k[t(231)]=_[t(231)];const C=this[t(202)][t(194)](t(231));C[t(288)][t(286)]=u+"px",C[t(288)][t(285)]=l+"px";const I=this[t(212)].get(t(286));I[t(286)]=_[t(286)],I[t(232)]=g[t(286)],I[t(285)]=g[t(285)],I[t(231)]=g[t(231)];const R=this[t(202)][t(194)](t(286));R[t(288)][t(286)]=o+"px",R.style.top=v+"px";const T=this[t(212)][t(194)]("right");T[t(286)]=g[t(232)],T[t(232)]=_[t(232)],T[t(285)]=g[t(285)],T[t(231)]=g[t(231)];const A=this[t(202)][t(194)](t(232));A[t(288)].left=c+"px",A.style[t(285)]=v+"px"}getPointerState(t){const e=s;for(const[i,s]of this._directionalMoveZones)if(g(s,t[e(270)],t[e(218)]))return i;return e(292)}}function g(t,e,i){const r=s;return e>=t[r(286)]&&e<t.right&&i>=t[r(285)]&&i<t.bottom}}}]);