const a8_0x4693=["enabled","zoom","get","overlay","ArrowUp","moveStep","pointerMove","validate","resource","exclusion","Nearest Neighbor","cutImage","webpackChunkluna","getCoordsFromEvent","fire","Blend Mode","viewportService","_elementContainer","_activeLayer","_renderer","_refreshLayerSelectionRange","width","div","imageService","ArrowRight","move","1jjOlee","10fJcjsI","currentLayer","round","Move Pixels","Bilinear","nearestneighbor","createElement","taskWorkerService","Set Quality Sampling","historyService","_viewportService","_selectionService","max","optionStep","topright","_container","lighten","bottomleft","onUpdate","ctrlKey","Finish Selection","data","style","multiply","8476laTYOj","_onUpdate","onUpdateEmitter","add","left","createCompositeEntry","_activeMovingLayer","onHistoryAction","_refreshExpandCanvasToSelectionEnabled","difference","_imageService","bilinear","_expandCanvasToSelectionAction","devicePixelRatio","dispose","isReady","46559KoPqoW","pointerUp","_updateQuality","value","register","bottom","setValueFromHistoryChange","ArrowLeft","getPointerState","950896LGdxXv","_cursorCurrent","_value","topleft","_setupActiveTemporaryLayer","finishSelection","onTemporaryLayerRegistered","keyDown","commit","replace","onLayerChange","triggerRequestRender","runTask","_enabled","softLight","_originalSelection","_cursorOrigin","moving","onHistoryUpdateValue","classList","2659wsDvtU","ArrowDown","273571ckeFJw","darken","_finishSelection","set","taskService","type","_directionalMoveZones","currentState","event","Move Selected Pixels","243587QTpcHn","appendChild","registerTemporaryLayer","_getQualityValue","options","onRequestRender","height","edit","selectionService","_movingLayerOrigin","key","name","_isCursorDown","_clearMovingLayer","display","_isFirstMove","_getQualityString","temporaryLayer","_onHistoryUpdateValue","_onStateChange","normal","setTopLeft","order","actions","screen","_isVisible","338326aGCiod","state","setVisible","clientWidth","moveToRange","pointerDown","_onOptionsChange","offsetX","string","bottomright","_qualityOption","_onRequestRender","top","push","_sc","linearDodgeAdd","number","onStateChange","expand-canvas-to-selection","right","createDomRenderProgram","29NyBgTZ","_directionalMoveElements","selectAll","range","linearBurn","_startMove","min"],a8_0x3c63=function(t,e){return a8_0x4693[t-=220]},a8_0x3984ac=a8_0x3c63;(function(t,e){const i=a8_0x3c63;for(;;)try{if(438813===parseInt(i(368))*parseInt(i(246))+-parseInt(i(334))*-parseInt(i(275))+parseInt(i(277))+parseInt(i(287))+parseInt(i(313))+-parseInt(i(230))+-parseInt(i(367))*parseInt(i(255)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a8_0x4693),(self[a8_0x3984ac(353)]=self[a8_0x3984ac(353)]||[])[a8_0x3984ac(326)]([[765],{9904:(t,e,i)=>{"use strict";const s=a8_0x3984ac;i.d(e,{rP:()=>o,bG:()=>h,Jp:()=>a,qv:()=>c});var r=i(1815),n=i(5120);class o extends n.JT{constructor(t,e,i){const s=a8_0x3c63;super(),this.name=t,this.options=e,this[s(257)]=i,this.type=s(321),this[s(305)]=this.register(new r.v),this[s(273)]=this[s(305)][s(285)],this[s(231)]=this[s(250)](new r.v),this[s(224)]=this[s(231)].event}get[s(249)](){return this._value}set[s(249)](t){const e=s;this[e(257)]=t,this[e(231)][e(355)]()}[s(252)](t){this[s(257)]=t,this._onHistoryUpdateValue.fire(t)}}class h extends o{constructor(){const t=s;super(t(356),[t(307),t(278),t(229),t(338),t(222),t(311),t(328),t(344),t(269),"difference",t(350)],t(307))}}class a extends o{constructor(){const t=s;super(t(356),[t(307),t(264),t(278),t(229),"linearBurn",t(222),"screen",t(328),t(344),t(269),t(239),t(350)],t(307))}}class c extends n.JT{constructor(t,e,i,n){const o=s;super(),this[o(298)]=t,this._value=e,this.min=i,this[o(380)]=n,this[o(282)]=o(329),this[o(305)]=this[o(250)](new r.v),this[o(273)]=this[o(305)].event,this[o(231)]=this[o(250)](new r.v),this.onUpdate=this[o(231)][o(285)]}get value(){return this[s(257)]}set value(t){const e=s;this._value=t,this[e(231)].fire()}[s(252)](t){const e=s;this[e(257)]=t,this[e(305)][e(355)](t)}}},6765:(t,e,i)=>{"use strict";const s=a8_0x3984ac;i.r(e),i.d(e,{default:()=>u});var r=i(1815),n=i(5120),o=i(1003),h=i(270);class a extends n.JT{constructor(t,e,i){const s=a8_0x3c63;super(),this[s(298)]=t,this[s(282)]=e,this[s(268)]=i,this[s(231)]=this[s(250)](new r.v),this[s(224)]=this[s(231)][s(285)]}get[s(341)](){return this[s(268)]}set enabled(t){const e=s;this._enabled!==t&&(this[e(268)]=t,this[e(231)][e(355)]())}}var c=i(9904);class l extends n.JT{constructor(t){const e=s;super(),this._sc=t,this.id="movePixels",this[e(314)]=e(366),this[e(302)]=!0,this[e(299)]=!1,this[e(242)]=new a("Expand Canvas to Selection",e(331),!1),this[e(310)]=[this[e(242)]],this[e(323)]=new c.rP("Quality",[e(372),e(351)],"Bilinear"),this[e(291)]=[this[e(323)]],this[e(324)]=this[e(250)](new r.v),this[e(292)]=this[e(324)][e(285)],this[e(306)]=this[e(250)](new r.v),this[e(330)]=this[e(306)][e(285)],this[e(250)](this[e(323)].onUpdate((()=>this[e(248)]()))),this[e(250)](this[e(327)][e(364)][e(265)]((()=>this[e(279)]()))),this[e(250)](this._sc[e(281)].onBeforeRunLayerTask((t=>{const i=e;t[i(260)]&&this[i(279)]()}))),this[e(250)](this[e(327)].selectionService[e(224)]((()=>{const t=e;this[t(361)](),this[t(238)](),this[t(324)][t(355)]()}))),this[e(250)](this[e(327)].imageService[e(261)]((t=>this[e(259)](t)))),this[e(327)][e(364)][e(369)]?.[e(304)]&&this[e(259)](this[e(327)].imageService[e(369)][e(304)])}[s(259)](t){const e=s;t[e(282)]===e(272)&&(this._activeMovingLayer=t,this.register(this[e(236)][e(237)]((()=>this._onOptionsChange()))),this[e(250)](this[e(236)].onHistoryUnset((()=>this[e(300)]()))),this[e(360)]?.[e(315)](!0),this[e(361)](),this[e(238)](),this[e(324)][e(355)]())}[s(361)](){const t=s;if(!this[t(236)])return;const e=this._sc[t(295)].range;e&&this[t(236)][t(317)](e)}[s(238)](){const t=s,e=this[t(327)][t(295)].range,i=!(!e||(0,o.ur)((0,o.DI)(this._sc[t(364)][t(362)],this[t(327)].imageService[t(293)]),e));this[t(242)][t(341)]=i}[s(319)](){const t=s;this[t(236)]&&this._qualityOption[t(252)](this[t(303)](this[t(236)][t(284)].quality))}[s(244)](){const t=s;this[t(279)](),super[t(244)]()}async[s(318)](t){const e=s;if(this._isCursorDown=!0,this[e(359)]=this[e(327)][e(364)][e(369)],!this[e(359)])return;let i=this._sc[e(295)][e(337)];!i&&(this._sc.selectionService[e(336)](),i=this[e(327)][e(295)][e(337)]),this[e(302)]=!this._activeMovingLayer,this[e(271)]=this._sc[e(357)][e(354)](t),this[e(256)]=this._cursorOrigin.slice(),this[e(296)]=[i[e(234)],i[e(325)]],await this._startMove(this._activeLayer,i),this[e(270)]=this[e(327)][e(295)][e(337)]}async[s(247)](){const t=s;if(this[t(299)]=!1,!this._activeLayer)return;if(!this._activeMovingLayer)return;const e=this[t(236)],i=this._isFirstMove?t(286):t(371);await this[t(327)][t(377)][t(235)](i,(()=>{const s=t;e[s(346)](),this[s(327)].selectionService.commit(i)})),this._isFirstMove=!1}[s(347)](t){const e=s;if(this._renderer&&!this[e(299)]){const i=this[e(360)][e(254)](t);this[e(314)]!==i&&(this.state=i,this._onStateChange[e(355)]())}}pointerDownMove(t){const e=s;if(!this[e(236)]||!this[e(271)]||!this[e(296)])return;if(this[e(256)]=this[e(327)][e(357)][e(354)](t),this[e(314)]===e(366)){const t=this[e(296)][0]+this[e(256)][0]-this[e(271)][0],i=this[e(296)][1]+this[e(256)][1]-this[e(271)][1];return void this[e(327)][e(295)][e(308)](t,i)}if(!this[e(270)])return;const i=this[e(256)][0]-this._cursorOrigin[0],r=this[e(256)][1]-this._cursorOrigin[1],n=(0,o.BN)(this[e(270)]);switch(this.state){case e(258):n[e(234)]+=i,n[e(325)]+=r;break;case e(220):n.right+=i,n[e(325)]+=r;break;case e(223):n[e(234)]+=i,n[e(251)]+=r;break;case e(322):n[e(332)]+=i,n.bottom+=r;break;case e(325):n[e(325)]+=r;break;case e(251):n[e(251)]+=r;break;case e(234):n[e(234)]+=i;break;case"right":n.right+=i}this[e(327)][e(295)][e(337)]=(0,o.FJ)(n)}async[s(262)](t){const e=s;if(!this._activeLayer&&(this[e(359)]=this[e(327)][e(364)][e(369)]),!this._activeLayer)return;if(t.key!==e(345)&&t[e(297)]!==e(276)&&"ArrowLeft"!==t[e(297)]&&t[e(297)]!==e(365))return;let i=this[e(327)][e(295)][e(337)];if(!i&&(this._sc[e(295)][e(336)](),i=this[e(327)].selectionService.range),this[e(302)]=!this[e(236)],this._isFirstMove&&await this[e(339)](this[e(359)],i),!this[e(236)])throw new Error("No moving layer");const r=t[e(225)]?10:1;switch(t[e(297)]){case"ArrowUp":this[e(327)][e(295)][e(308)](i[e(234)],i.top-r);break;case e(276):this[e(327)][e(295)][e(308)](i[e(234)],i[e(325)]+r);break;case e(253):this[e(327)][e(295)][e(308)](i[e(234)]-r,i[e(325)]);break;case"ArrowRight":this[e(327)][e(295)][e(308)](i.left+r,i[e(325)])}}async[s(339)](t,e){const i=s;if((!this._activeMovingLayer||this._activeMovingLayer!==t.temporaryLayer)&&t[i(304)]?.[i(282)]===i(272)&&(this[i(236)]=t[i(304)]),this[i(236)]&&this._activeMovingLayer===t[i(304)])return;t[i(304)]&&await t[i(304)][i(263)](this[i(327)][i(295)][i(337)]),(0,o.l$)(e,(0,o.DI)(t.width,t.height));const r=e[i(332)]-e[i(234)],n=e[i(251)]-e.top;let a;const c=new Promise((t=>a=t)),l={resource:{width:r,height:n,data:new Uint8Array(new SharedArrayBuffer(r*n*4))},readyPromise:c,isReady:!1};this[i(236)]=new h.m(t,l,e,this._getQualityValue(),this[i(327)][i(377)],this[i(327)][i(375)]),await t[i(289)](this[i(236)]),await t[i(294)]((async(t,s,r)=>{const n=i;return await this[n(327)][n(375)][n(267)](n(352),{cutImage:{data:l[n(349)][n(227)],width:l[n(349)][n(362)],height:l.resource[n(293)]},cutRange:e,targetImage:{data:t,width:s,height:r}}),e})),a(l.resource),l[i(245)]=!0,t[i(232)].fire(e)}async[s(279)](){const t=s,e=this._activeLayer||this[t(327)].imageService[t(369)];if(!e)return;if(!this[t(236)]&&e[t(304)]?.[t(282)]===t(272)&&(this[t(236)]=e.temporaryLayer),!this[t(236)])return;const i=this[t(236)];await this._sc[t(377)][t(235)](t(226),(async()=>{const s=t;await i.commit(),this._sc.selectionService[s(348)](e[s(362)],e.height),this[s(327)].selectionService[s(263)](s(226))})),this[t(300)]()}[s(300)](){const t=s;this[t(359)]=void 0,this[t(236)]=void 0,this[t(360)]?.[t(315)](!1),this[t(324)][t(355)]()}[s(248)](){const t=s,e=this._getQualityValue();this[t(236)]&&this._activeMovingLayer[t(284)].quality!==e&&(this[t(236)][t(284)].quality=e,this._activeMovingLayer[t(381)](t(376)),this[t(236)][t(266)]())}[s(290)](){const t=s;switch(this[t(323)][t(249)]){case t(372):return"bilinear";case"Nearest Neighbor":return t(373)}}_getQualityString(t){const e=s;switch(t){case e(241):return e(372);case e(373):return e(351)}}[s(333)](t){const e=s;return this[e(360)]=new v(t,this[e(327)].selectionService,this._sc[e(357)],this[e(327)][e(364)]),this._renderer}}const u=l;class v extends n.JT{constructor(t,e,i,r){const n=s;super(),this[n(221)]=t,this[n(379)]=e,this._viewportService=i,this[n(240)]=r,this[n(309)]=2,this[n(335)]=new Map,this._directionalMoveZones=new Map,this[n(312)]=!0,this[n(358)]=document[n(374)](n(363));const h=[n(258),n(220),"bottomleft","bottomright",n(325),n(251),n(234),n(332)];for(const t of h){const e=document.createElement(n(363));e[n(274)][n(233)]("move-handle"),this[n(358)].appendChild(e),this[n(335)][n(280)](t,e),this[n(283)][n(280)](t,(0,o.Pq)())}this[n(221)][n(288)](this[n(358)]),this[n(250)]({dispose:()=>{const t=n;this[t(221)].removeChild(this[t(358)])}}),this[n(379)][n(224)]((()=>this[n(315)](void 0!==this[n(379)][n(337)]))),this[n(315)](void 0!==this._selectionService[n(337)])}[s(315)](t){const e=s;t!==this[e(312)]&&(this._elementContainer[e(228)][e(301)]=t?"":"none",this._isVisible=t)}render(){const t=s,e=this._selectionService.range;if(!e)return;const i=this[t(240)].currentLayer;if(!i)return;const r=this[t(378)],n=Math[t(370)](this[t(221)][t(316)]/2)-i[t(362)]/2*r.zoom,o=Math[t(370)](this._container.clientHeight/2)-i[t(293)]/2*r[t(342)],h=n+(r.x+e[t(234)])*r[t(342)],a=o+(r.y+e[t(325)])*r[t(342)],c=n+(r.x+e.right)*r[t(342)],l=o+(r.y+e[t(251)])*r[t(342)],u=Math[t(370)]((h+c)/2),v=Math.round((a+l)/2),p=10*window[t(243)],_={left:Math[t(340)](h+p,Math.max(h,u-p)),top:Math[t(340)](a+p,Math.max(a,v-p)),right:Math[t(380)](c-p,Math[t(340)](c,u+p)),bottom:Math[t(380)](l-p,Math[t(340)](l,v+p))},g={left:h-p,top:a-p,right:c+p,bottom:l+p},d=this._directionalMoveZones[t(343)](t(258));d[t(234)]=g[t(234)],d[t(332)]=_[t(234)],d[t(325)]=g[t(325)],d[t(251)]=_[t(325)];const y=this._directionalMoveElements.get("topleft");y[t(228)][t(234)]=h+"px",y[t(228)][t(325)]=a+"px";const m=this[t(283)][t(343)](t(220));m[t(234)]=_[t(332)],m[t(332)]=g.right,m[t(325)]=g[t(325)],m[t(251)]=_[t(325)];const f=this[t(335)][t(343)](t(220));f[t(228)].left=c+"px",f.style[t(325)]=a+"px";const w=this._directionalMoveZones[t(343)]("bottomleft");w[t(234)]=g[t(234)],w.right=_[t(234)],w[t(325)]=_[t(251)],w.bottom=g[t(251)];const x=this[t(335)][t(343)](t(223));x.style[t(234)]=h+"px",x[t(228)].top=l+"px";const S=this._directionalMoveZones[t(343)](t(322));S.left=_[t(332)],S.right=g[t(332)],S[t(325)]=_.bottom,S.bottom=g[t(251)];const b=this[t(335)][t(343)](t(322));b[t(228)].left=c+"px",b[t(228)][t(325)]=l+"px";const M=this[t(283)][t(343)](t(325));M.left=_[t(234)],M[t(332)]=_.right,M[t(325)]=g.top,M[t(251)]=_[t(325)];const L=this[t(335)][t(343)]("top");L.style[t(234)]=u+"px",L[t(228)][t(325)]=a+"px";const k=this[t(283)][t(343)](t(251));k.left=_[t(234)],k[t(332)]=_[t(332)],k.top=_.bottom,k.bottom=g[t(251)];const C=this[t(335)][t(343)](t(251));C[t(228)][t(234)]=u+"px",C.style[t(325)]=l+"px";const R=this[t(283)][t(343)](t(234));R[t(234)]=g[t(234)],R[t(332)]=_[t(234)],R[t(325)]=_[t(325)],R.bottom=_.bottom;const T=this[t(335)][t(343)]("left");T[t(228)][t(234)]=h+"px",T.style.top=v+"px";const I=this._directionalMoveZones[t(343)](t(332));I.left=_[t(332)],I[t(332)]=g.right,I[t(325)]=_[t(325)],I[t(251)]=_[t(251)];const A=this[t(335)][t(343)](t(332));A.style[t(234)]=c+"px",A[t(228)][t(325)]=v+"px"}getPointerState(t){const e=s;for(const[i,s]of this[e(283)])if(p(s,t[e(320)],t.offsetY))return i;return e(366)}}function p(t,e,i){const r=s;return e>=t[r(234)]&&e<t[r(332)]&&i>=t.top&&i<t[r(251)]}}}]);