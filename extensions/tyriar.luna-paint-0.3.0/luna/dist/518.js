const a10_0x38d0=["_lastDownCoord","onRequestRender","fire","_svgLine","pointerDownMove","softLight","818952Vsayfl","textContent","createElementNS","_updateOutline","max","round","screen","#fff","#00000080","_plotLineLow","number","_value","_setPixel","_svgInnerLine","Could not create extended edit","line","paletteService","0.5","boxShadow","abs","_ignoreSetPixel","_lastUpCoords","text","top","strokeWidth","_cursorCoord","shiftKey","createElement","block","requestRender","_cursorInfo","svg","absolute","min","left","difference","0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);","_outlineElementContainer","opacity","div","_getOutlineElement","_plotLine","isValid","_drawLine","_isShiftDown","20px","event","_model","_getLine","_getEdit","style","clientWidth","setAttribute","border","add","_viewportService","_isPointerDown","1280740MgfDZg","imageService","_svg","removeChild","lineHeight","activeEntry","width","_blendModeOption","_onRequestRender","zoom","offsetY","display","append","pointerUp","createExtendedEdit","627234UyRqDm","_updateCursorInfo","getColorFromPointerEvent","_container","currentLayer","appendChild","type","commit","_onUpdate","replace","_outlineElements","_getLineLow","none","string","classList","182402gsSZmL","onUndo","operationName","_sc","height","2119473zWWTVG","_element","lighten","_hideCursorInfo","exclusion","position","linearDodgeAdd","backgroundColor","Blend Mode","pencil","73265aWyUrW","linearBurn","setValueFromHistoryChange","order","padding","clientHeight","length","toString","1eWRcUp","darken","_getLineHigh","_plotLineHigh","onUpdate","webpackChunkluna","_onHistoryUpdateValue","_color","_outlineModel","register","zIndex","_imageService","Pencil","viewportService","historyService","overlay","atan2","isVisible","push","keyDown","normal","onRedo","containsCoord","getCoordsFromEvent","1015096JLMegE","#000","onHistoryUpdateValue","stroke","marginLeft","keyUp","_edit","value","setPixel"],a10_0x19da=function(t,s){return a10_0x38d0[t-=167]},a10_0x202cb8=a10_0x19da;(function(t,s){const i=a10_0x19da;for(;;)try{if(829794===parseInt(i(238))+parseInt(i(193))+-parseInt(i(285))+-parseInt(i(270))+-parseInt(i(223))+parseInt(i(246))*-parseInt(i(208))+parseInt(i(228)))break;t.push(t.shift())}catch(s){t.push(t.shift())}})(a10_0x38d0),(self[a10_0x202cb8(251)]=self[a10_0x202cb8(251)]||[])[a10_0x202cb8(264)]([[518],{9904:(t,s,i)=>{"use strict";const e=a10_0x202cb8;i.d(s,{rP:()=>o,bG:()=>r,Jp:()=>l,qv:()=>c});var h=i(1815),n=i(5120);class o extends n.JT{constructor(t,s,i){const e=a10_0x19da;super(),this.name=t,this.options=s,this._value=i,this[e(214)]=e(221),this[e(252)]=this[e(255)](new h.v),this[e(272)]=this[e(252)][e(182)],this._onUpdate=this[e(255)](new h.v),this[e(250)]=this._onUpdate[e(182)]}get[e(277)](){return this._value}set[e(277)](t){const s=e;this[s(296)]=t,this._onUpdate[s(281)]()}setValueFromHistoryChange(t){const s=e;this[s(296)]=t,this[s(252)][s(281)](t)}}class r extends o{constructor(){const t=e;super(t(236),[t(266),t(247),"multiply","linearBurn",t(230),t(291),"linearDodgeAdd",t(261),t(284),t(171),"exclusion"],t(266))}}class l extends o{constructor(){const t=e;super(t(236),[t(266),"replace",t(247),"multiply",t(239),"lighten",t(291),t(234),t(261),t(284),"difference",t(232)],"normal")}}class c extends n.JT{constructor(t,s,i,n){const o=e;super(),this.name=t,this[o(296)]=s,this[o(169)]=i,this[o(289)]=n,this[o(214)]=o(295),this[o(252)]=this[o(255)](new h.v),this.onHistoryUpdateValue=this[o(252)].event,this._onUpdate=this[o(255)](new h.v),this.onUpdate=this[o(216)][o(182)]}get[e(277)](){return this[e(296)]}set[e(277)](t){const s=e;this._value=t,this._onUpdate[s(281)]()}[e(240)](t){const s=e;this._value=t,this[s(252)][s(281)](t)}}},3518:(t,s,i)=>{"use strict";const e=a10_0x202cb8;i.r(s),i.d(s,{default:()=>_});var h=i(1815),n=i(5120);class o extends n.JT{constructor(t,s){const i=a10_0x19da;super(),this[i(211)]=t,this[i(183)]=s,this[i(241)]=2,this[i(229)]=document.createElement("div"),this[i(229)][i(186)][i(233)]=i(168),this._element[i(186)][i(235)]=i(293),this[i(229)][i(186)][i(189)]="1px solid #000",this._element[i(186)][i(303)]=i(172),this._element[i(186)][i(242)]="2px",this[i(229)][i(186)][i(227)]="20px",this[i(229)].style[i(197)]=i(181),this[i(229)][i(186)][i(274)]=i(181),this[i(229)][i(186)][i(256)]="1",this._element[i(186)][i(204)]=i(220),this[i(211)].appendChild(this[i(229)]),this[i(255)]({dispose:()=>this._container.removeChild(this[i(229)])})}render(){const t=a10_0x19da;this[t(229)][t(186)].display=this._model.isVisible?"block":t(220),this[t(229)].style[t(170)]=this[t(183)].x+"px",this[t(229)][t(186)].top=this[t(183)].y+"px",this._element[t(286)]=this[t(183)].text}}var r=i(1674);class l extends n.JT{constructor(t,s,i,e){const h=a10_0x19da;super(),this[h(211)]=t,this[h(257)]=s,this._viewportService=i,this._model=e,this[h(241)]=2,this[h(218)]=[],this[h(173)]=document[h(312)](h(175)),this[h(211)][h(213)](this[h(173)]),this[h(195)]=document[h(287)](r.q,h(167)),this[h(282)]=document.createElementNS(r.q,"line"),this[h(282)][h(186)][h(273)]=h(292),this._svgLine[h(186)][h(309)]="2",this[h(282)][h(186)][h(174)]="0.5",this[h(298)]=document[h(287)](r.q,h(300)),this[h(298)][h(186)].stroke=h(271),this._svgInnerLine.style[h(309)]="1",this._svgInnerLine[h(186)][h(174)]=h(302),this[h(195)][h(205)](this[h(282)],this[h(298)]),this[h(211)][h(213)](this[h(195)]),this.register({dispose:()=>{const t=h;this[t(211)].removeChild(this[t(173)]),this[t(211)][t(196)](this[t(195)])}})}render(){const t=a10_0x19da,s=this[t(191)],i=this._imageService.currentLayer;if(!this[t(183)][t(178)]||!i)return this[t(173)].style[t(204)]=t(220),void(this._svg[t(186)].display=t(220));if(s.zoom<4){if(this[t(173)][t(186)][t(204)]="none",this._svg[t(186)].display="block",i){const e=Math[t(290)](this[t(211)][t(187)]/2)-i[t(199)]/2*s[t(202)]+s.x*s.zoom,h=Math[t(290)](this[t(211)][t(243)]/2)-i[t(227)]/2*s[t(202)]+s.y*s[t(202)],n=(e+(this[t(183)].x1+.5)*s[t(202)])[t(245)](),o=(h+(this[t(183)].y1+.5)*s[t(202)])[t(245)](),r=(e+(this[t(183)].x2+.5)*s[t(202)]).toString(),l=(h+(this[t(183)].y2+.5)*s[t(202)])[t(245)]();this[t(195)][t(188)]("width",this._container[t(187)].toString()),this[t(195)].setAttribute(t(227),this._container[t(243)][t(245)]()),this[t(282)][t(188)]("x1",n),this[t(282)][t(188)]("y1",o),this[t(282)][t(188)]("x2",r),this[t(282)].setAttribute("y2",l),this._svgInnerLine[t(188)]("x1",n),this[t(298)][t(188)]("y1",o),this[t(298)][t(188)]("x2",r),this[t(298)][t(188)]("y2",l)}return}this._outlineElementContainer[t(186)][t(204)]=t(313),this[t(195)][t(186)][t(204)]=t(220);const e=this[t(184)](this[t(183)].x1,this._model.y1,this[t(183)].x2,this._model.y2),h=[];let n=0;for(;n<e[t(244)]-1;n++){const s=e[n];let i=n;if(s[0]===e[i+1][0]){for(;i+1<e.length&&s[0]===e[i+1][0];)i++;h[t(264)]([s[0],s[1],1,i-n+1])}else if(s[1]===e[i+1][1]){for(;i+1<e.length&&s[1]===e[i+1][1];)i++;h.push([s[0],s[1],i-n+1,1])}else h[t(264)]([s[0],s[1],1,1]);n=i}n===e[t(244)]-1&&h[t(264)]([e[n][0],e[n][1],1,1]);let o=0;for(const e of h){const h=Math[t(290)](this[t(211)][t(187)]/2)-i[t(199)]/2*s[t(202)]+s.x*s[t(202)],n=Math.round(this._container[t(243)]/2)-i[t(227)]/2*s[t(202)]+s.y*s.zoom,r=this[t(176)](o++);r[t(186)].display=t(313),r.style[t(170)]=h+e[0]*s.zoom-1+"px",r[t(186)][t(308)]=n+e[1]*s[t(202)]-1+"px",r.style[t(199)]=e[2]*s[t(202)]+"px",r[t(186)][t(227)]=e[3]*s[t(202)]+"px"}for(;o<this[t(218)][t(244)];o++)this._outlineElements[o][t(186)][t(204)]="none"}[e(176)](t){const s=e;for(;t>=this[s(218)][s(244)];){const t=document[s(312)](s(175));t[s(186)][s(233)]=s(168),t[s(222)][s(190)]("outline"),this[s(218)].push(t),this._outlineElementContainer[s(213)](t)}return this._outlineElements[t]}_getLine(t,s,i,h){const n=e;return Math[n(304)](h-s)<Math[n(304)](i-t)?t>i?this[n(219)](i,h,t,s):this[n(219)](t,s,i,h):s>h?this[n(248)](i,h,t,s):this[n(248)](t,s,i,h)}[e(219)](t,s,i,h){const n=e,o=[],r=i-t;let l=h-s,c=1;l<0&&(c=-1,l=-l);let a=2*l-r,d=s;for(let s=t;s<=i;s++)o[n(264)]([s,d]),a>0?(d+=c,a+=2*(l-r)):a+=2*l;return o}_getLineHigh(t,s,i,h){const n=e,o=[];let r=i-t;const l=h-s;let c=1;r<0&&(c=-1,r=-r);let a=2*r-l,d=t;for(let t=s;t<=h;t++)o[n(264)]([d,t]),a>0?(d+=c,a+=2*(r-l)):a+=2*r;return o}}class c{constructor(){this[e(178)]=!1,this.x1=0,this.y1=0,this.x2=0,this.y2=0}}var a=i(9904);class d extends n.JT{constructor(t){const s=e;super(),this[s(226)]=t,this.id=s(237),this[s(306)]=[],this[s(310)]=[0,0],this[s(192)]=!1,this._isShiftDown=!1,this._outlineModel=new c,this[s(200)]=new a.Jp,this.options=[this[s(200)]],this[s(201)]=this[s(255)](new h.v),this[s(280)]=this[s(201)][s(182)],this[s(315)]={x:0,y:0,text:"",isVisible:!1},this.register(this[s(226)][s(260)][s(224)]((t=>{const i=s;t[i(225)]===i(258)&&this[i(226)][i(260)][i(198)]?.[i(225)]===i(258)?this[i(306)]?.pop():this[i(306)][i(244)]=0}))),this.register(this[s(226)][s(260)][s(267)]((()=>this._lastUpCoords[s(244)]=0))),this[s(226)][s(259)].onUpdate((()=>{this._outlineModel.isValid=!1,this._hideCursorInfo()}))}createDomRenderProgram(t){const s=e;return[new o(t,this[s(315)]),new l(t,this._sc[s(194)],this[s(226)][s(259)],this._outlineModel)]}pointerDown(t){const s=e;this[s(192)]=!0;const i=this._sc[s(194)];if(!i[s(212)])return;if(this[s(253)]=this._sc[s(301)][s(210)](t),!this[s(253)])return;const h=this[s(226)][s(259)][s(269)](t);if(h){if(t.shiftKey&&this[s(306)][s(244)]>0){const t=this[s(306)][this[s(306)][s(244)]-1];this[s(305)]=t,this[s(179)](t,h,this._color),this[s(305)]=void 0}if(i.containsCoord(h[0],h[1])){const t=this[s(185)]();this[s(297)](this._getEdit(),h[0],h[1],this._color),t[s(314)]()}this[s(279)]=h}}[e(283)](t){const s=e;if(!this[s(279)]||!this._color)return;const i=this[s(226)][s(194)];if(!i[s(212)])return;const h=this[s(226)][s(259)][s(269)](t);this[s(279)][0]===h[0]&&this[s(279)][1]===h[1]||((i.containsCoord(h[0],h[1])||i[s(268)](this[s(279)][0],this[s(279)][1]))&&this[s(179)](this[s(279)],h,this._color),this[s(279)]=h)}async[e(206)](t){const s=e;this[s(192)]=!1,this._sc[s(194)][s(212)]&&(this[s(276)]?.[s(215)]("Pencil"),this[s(276)]=void 0);const i=this[s(226)][s(259)][s(269)](t);this[s(306)][s(264)](i),this[s(288)](t,!0)}async pointerMove(t){const s=e;this._cursorInfo.x=t.offsetX,this._cursorInfo.y=t[s(203)],this[s(310)]=this._sc[s(259)][s(269)](t),this._updateOutline(t),!this._isPointerDown&&t[s(311)]?this[s(209)]():this._cursorInfo[s(263)]&&this[s(231)]()}[e(265)](t){const s=e;!this[s(180)]&&t[s(311)]&&(this[s(180)]=!0,!this[s(192)]&&(this[s(209)](),this[s(288)](t,!0)))}[e(275)](t){const s=e;!t[s(311)]&&(this._outlineModel[s(178)]=!1,this[s(201)].fire(),this[s(315)][s(263)]&&this[s(231)](),this[s(180)]=!1)}[e(288)](t,s){const i=e;if(s||this[i(254)].x1!==this[i(310)][0]||this._outlineModel.y1!==this[i(310)][1]){if(this[i(254)].x1=this[i(310)][0],this._outlineModel.y1=this[i(310)][1],!this._isPointerDown&&t[i(311)]&&this[i(306)][i(244)]>0){const t=this[i(306)][this[i(306)].length-1];this[i(254)].x2=t[0],this[i(254)].y2=t[1],this[i(254)].isValid=!0}else this[i(254)].x2=this._cursorCoord[0],this[i(254)].y2=this._cursorCoord[1],this[i(254)].isValid=this[i(226)][i(194)][i(268)](this._outlineModel.x1,this[i(254)].y1);this[i(201)].fire()}}[e(209)](){const t=e;if(0===this._lastUpCoords[t(244)])return;if(!this._cursorCoord)return;const s=this[t(306)][this[t(306)].length-1];if(s[0]===this[t(310)][0]&&s[1]===this[t(310)][1])return;let i=180*-Math[t(262)](this[t(310)][1]-s[1],this[t(310)][0]-s[0])/Math.PI;-180===i&&(i=180),i=Math[t(290)](10*i)/10,this._cursorInfo[t(307)]=i+"°",this[t(315)][t(263)]=!0,this[t(201)].fire()}[e(231)](){const t=e;this[t(315)][t(263)]=!1,this[t(201)][t(281)]()}[e(179)](t,s,i){const h=e,n=this._getEdit();this[h(177)](n,i,t[0],t[1],s[0],s[1]),n[h(314)]()}[e(185)](){const t=e;if(!this[t(276)]&&(this[t(276)]=this[t(226)].imageService[t(212)]?.[t(207)](),!this[t(276)]))throw new Error(t(299));return this[t(276)]}[e(177)](t,s,i,h,n,o){const r=e;Math[r(304)](o-h)<Math[r(304)](n-i)?i>n?this[r(294)](t,s,n,o,i,h):this[r(294)](t,s,i,h,n,o):h>o?this._plotLineHigh(t,s,n,o,i,h):this[r(249)](t,s,i,h,n,o)}[e(294)](t,s,i,h,n,o){const r=e,l=n-i;let c=o-h,a=1;c<0&&(a=-1,c=-c);let d=2*c-l,_=h;for(let e=i;e<=n;e++)this[r(297)](t,e,_,s),d>0?(_+=a,d+=2*(c-l)):d+=2*c}[e(249)](t,s,i,h,n,o){const r=e;let l=n-i;const c=o-h;let a=1;l<0&&(a=-1,l=-l);let d=2*l-c,_=i;for(let i=h;i<=o;i++)this[r(297)](t,_,i,s),d>0?(_+=a,d+=2*(l-c)):d+=2*l}[e(297)](t,s,i,h){const n=e;this._ignoreSetPixel&&this[n(305)][0]===s&&this[n(305)][1]===i||this[n(226)].selectionService[n(268)](s,i)&&this[n(226)].imageService[n(268)](s,i)&&t[n(278)](s,i,h,this[n(200)][n(277)]===n(217)?void 0:this._blendModeOption[n(277)])}}const _=d},1674:(t,s,i)=>{"use strict";i.d(s,{q:()=>e});const e="http://www.w3.org/2000/svg"}}]);