const a8_0x3bda=["order","moveTo","devicePixelRatio","style","bottomright","dispose","1120117WrYgxV","_isVisible","fire","_directionalMoveElements","580160btnsXu","linearBurn","setValueFromHistoryChange","lighten","currentLayer","clientHeight","softLight","createDomRenderProgram","_imageService","_viewportService","register","_value","moveStep","onBeforeRunLayerTask","_cursorOrigin","_onHistoryUpdateValue","screen","_cursorCurrent","Bilinear","render","_renderer","zoom","keyDown","movePixels","onLayerChange","ctrlKey","selectAll","createCompositeEntry","range","bottom","moving","onTemporaryLayerRegistered","top","viewportService","state","169hJqoMC","normal","pointerUp","7885aNCaEv","imageService","exclusion","Set Quality Sampling","ArrowDown","right","offsetY","createElement","280047RlOOui","setTopLeft","event","type","_directionalMoveZones","_getQualityString","_clearMovingLayer","onHistoryUpdateValue","resource","validate","_activeLayer","topleft","add","getPointerState","string","_qualityOption","selectionService","4219ciefhT","_onUpdate","58921okFYWY","height","left","onUpdate","slice","historyService","_originalSelection","_elementContainer","Move Selected Pixels","value","triggerRequestRender","taskWorkerService","_selectionService","onUpdateEmitter","pointerMove","bilinear","Nearest Neighbor","_finishSelection","width","No moving layer","_updateQuality","nearestneighbor","appendChild","bottomleft","isReady","replace","topright","clientWidth","_startMove","Move Pixels","17TOuabS","get","linearDodgeAdd","runTask","onRequestRender","pointerDown","min","_setupActiveTemporaryLayer","quality","Quality","_isFirstMove","multiply","setVisible","_isCursorDown","edit","move","options","overlay","_sc","currentState","_container","_onOptionsChange","number","offsetX","name","cutImage","registerTemporaryLayer","_activeMovingLayer","webpackChunkluna","removeChild","getCoordsFromEvent","98BbxZoO","ArrowUp","ArrowRight","pointerDownMove","305948DnXaiY","taskService","key","_onRequestRender","_getQualityValue","difference","onHistoryUnset","_movingLayerOrigin","_onStateChange","div","max","round","Blend Mode","temporaryLayer","set","ArrowLeft","Finish Selection","darken","move-handle"],a8_0x2642=function(t,e){return a8_0x3bda[t-=220]},a8_0x4556d5=a8_0x2642;(function(t,e){const i=a8_0x2642;for(;;)try{if(630198===-parseInt(i(282))*parseInt(i(370))-parseInt(i(290))+parseInt(i(244))+parseInt(i(339))*parseInt(i(309))+-parseInt(i(374))+parseInt(i(240))+-parseInt(i(307))*parseInt(i(279)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a8_0x3bda),(self.webpackChunkluna=self[a8_0x4556d5(367)]||[]).push([[687],{9904:(t,e,i)=>{"use strict";const s=a8_0x4556d5;i.d(e,{rP:()=>h,bG:()=>n,Jp:()=>a,qv:()=>c});var r=i(1815),o=i(5120);class h extends o.JT{constructor(t,e,i){const s=a8_0x2642;super(),this[s(363)]=t,this[s(355)]=e,this[s(255)]=i,this[s(293)]=s(304),this._onHistoryUpdateValue=this[s(254)](new r.v),this[s(297)]=this._onHistoryUpdateValue[s(292)],this[s(308)]=this[s(254)](new r.v),this[s(312)]=this._onUpdate[s(292)]}get[s(318)](){return this[s(255)]}set value(t){const e=s;this[e(255)]=t,this[e(308)][e(242)]()}setValueFromHistoryChange(t){const e=s;this[e(255)]=t,this[e(259)][e(242)](t)}}class n extends h{constructor(){const t=s;super(t(227),[t(280),t(232),t(350),"linearBurn",t(247),t(260),"linearDodgeAdd",t(356),t(250),t(220),t(284)],t(280))}}class a extends h{constructor(){const t=s;super(t(227),[t(280),t(334),"darken",t(350),t(245),"lighten",t(260),t(341),t(356),"softLight",t(220),"exclusion"],t(280))}}class c extends o.JT{constructor(t,e,i,o){const h=s;super(),this[h(363)]=t,this[h(255)]=e,this[h(345)]=i,this.max=o,this[h(293)]=h(361),this[h(259)]=this.register(new r.v),this[h(297)]=this._onHistoryUpdateValue.event,this._onUpdate=this[h(254)](new r.v),this[h(312)]=this[h(308)][h(292)]}get[s(318)](){return this._value}set[s(318)](t){const e=s;this[e(255)]=t,this[e(308)][e(242)]()}setValueFromHistoryChange(t){const e=s;this[e(255)]=t,this[e(259)][e(242)](t)}}},687:(t,e,i)=>{"use strict";const s=a8_0x4556d5;i.r(e),i.d(e,{default:()=>l});var r=i(1815),o=i(5120),h=i(1003),n=i(270),a=i(9904);class c extends o.JT{constructor(t){const e=a8_0x2642;super(),this[e(357)]=t,this.id=e(267),this[e(278)]=e(354),this[e(349)]=!0,this[e(352)]=!1,this[e(305)]=new a.rP(e(348),[e(262),e(325)],e(262)),this[e(355)]=[this._qualityOption],this[e(377)]=this[e(254)](new r.v),this[e(343)]=this[e(377)][e(292)],this[e(223)]=this.register(new r.v),this.onStateChange=this[e(223)][e(292)],this[e(254)](this[e(305)][e(312)]((()=>this._updateQuality()))),this[e(254)](this[e(357)][e(283)][e(268)]((()=>this._finishSelection()))),this[e(254)](this[e(357)][e(375)][e(257)]((()=>this[e(326)]()))),this.register(this[e(357)][e(283)][e(275)]((t=>this[e(346)](t)))),this[e(357)][e(283)][e(248)]?.[e(228)]&&this[e(346)](this._sc[e(283)].currentLayer[e(228)])}[s(346)](t){const e=s;t[e(293)]===e(274)&&(this._activeMovingLayer=t,this[e(254)](this[e(366)].onHistoryAction((()=>this[e(360)]()))),this[e(254)](this[e(366)][e(221)]((()=>this[e(296)]()))),this[e(264)]?.[e(351)](!0),this._onRequestRender[e(242)]())}[s(360)](){const t=s;this[t(366)]&&this._qualityOption[t(246)](this._getQualityString(this[t(366)][t(358)][t(347)]))}[s(239)](){const t=s;this[t(326)](),super[t(239)]()}async[s(344)](t){const e=s;if(this[e(352)]=!0,this[e(300)]=this[e(357)][e(283)].currentLayer,!this[e(300)])return;let i=this._sc.selectionService[e(272)];!i&&(this[e(357)][e(306)][e(270)](),i=this[e(357)][e(306)][e(272)]),this._isFirstMove=!this._activeMovingLayer,this[e(258)]=this._sc[e(277)][e(369)](t),this[e(261)]=this[e(258)][e(313)](),this[e(222)]=[i[e(311)],i[e(276)]],await this[e(337)](this[e(300)],i),this[e(315)]=this._sc[e(306)][e(272)]}async[s(281)](){const t=s;if(this[t(352)]=!1,!this[t(300)])return;if(!this[t(366)])return;const e=this._activeMovingLayer,i=this[t(349)]?t(317):t(338);await this[t(357)][t(314)][t(271)](i,(()=>{const s=t;e[s(256)](),this[s(357)].selectionService.commit(i)})),this[t(349)]=!1}[s(323)](t){const e=s;if(this[e(264)]&&!this[e(352)]){const i=this._renderer[e(303)](t);this[e(278)]!==i&&(this[e(278)]=i,this[e(223)][e(242)]())}}[s(373)](t){const e=s;if(!this[e(366)]||!this[e(258)]||!this[e(222)])return;if(this._cursorCurrent=this[e(357)].viewportService[e(369)](t),this.state===e(354)){const t=this[e(222)][0]+this._cursorCurrent[0]-this[e(258)][0],i=this[e(222)][1]+this[e(261)][1]-this._cursorOrigin[1];return this[e(366)][e(235)](t,i),void this[e(357)][e(306)][e(291)](t,i)}if(!this[e(315)])return;const i=this[e(261)][0]-this[e(258)][0],r=this[e(261)][1]-this._cursorOrigin[1],o=(0,h.BN)(this[e(315)]);switch(this[e(278)]){case e(301):o.left+=i,o[e(276)]+=r;break;case e(335):o[e(287)]+=i,o.top+=r;break;case"bottomleft":o[e(311)]+=i,o.bottom+=r;break;case e(238):o[e(287)]+=i,o[e(273)]+=r;break;case"top":o[e(276)]+=r;break;case e(273):o[e(273)]+=r;break;case"left":o[e(311)]+=i;break;case"right":o.right+=i}this[e(357)][e(306)][e(272)]=(0,h.FJ)(o),this[e(366)].moveToRange(o)}async[s(266)](t){const e=s;if(!this[e(300)]&&(this[e(300)]=this[e(357)][e(283)][e(248)]),!this[e(300)])return;if(t[e(376)]!==e(371)&&t[e(376)]!==e(286)&&t[e(376)]!==e(230)&&t.key!==e(372))return;let i=this[e(357)].selectionService[e(272)];if(!i&&(this._sc[e(306)][e(270)](),i=this[e(357)][e(306)][e(272)]),this[e(349)]=!this[e(366)],this[e(349)]&&await this[e(337)](this[e(300)],i),!this[e(366)])throw new Error(e(328));const r=t[e(269)]?10:1;switch(t[e(376)]){case"ArrowUp":this[e(366)][e(235)](this[e(366)][e(358)].offsetX,this._activeMovingLayer[e(358)][e(288)]-r),this[e(357)][e(306)][e(291)](i[e(311)],i[e(276)]-r);break;case e(286):this._activeMovingLayer[e(235)](this[e(366)][e(358)][e(362)],this[e(366)][e(358)][e(288)]+r),this[e(357)][e(306)][e(291)](i[e(311)],i.top+r);break;case e(230):this._activeMovingLayer[e(235)](this[e(366)][e(358)][e(362)]-r,this._activeMovingLayer[e(358)].offsetY),this[e(357)].selectionService[e(291)](i.left-r,i[e(276)]);break;case e(372):this._activeMovingLayer[e(235)](this[e(366)][e(358)][e(362)]+r,this._activeMovingLayer[e(358)][e(288)]),this[e(357)][e(306)][e(291)](i[e(311)]+r,i[e(276)])}}async _startMove(t,e){const i=s;if((!this[i(366)]||this._activeMovingLayer!==t[i(228)])&&t[i(228)]?.[i(293)]===i(274)&&(this[i(366)]=t[i(228)]),this[i(366)]&&this[i(366)]===t.temporaryLayer)return;t.temporaryLayer&&await t.temporaryLayer.commit(this[i(357)][i(306)][i(272)]),(0,h.l$)(e,(0,h.DI)(t[i(327)],t.height));const r=e[i(287)]-e.left,o=e.bottom-e.top;let a;const c=new Promise((t=>a=t)),l={resource:{width:r,height:o,data:new Uint8Array(new SharedArrayBuffer(r*o*4))},readyPromise:c,isReady:!1};this[i(366)]=new n.m(t,l,e,this[i(378)](),this._sc[i(314)],this._sc[i(320)]),await t[i(365)](this[i(366)]),await t[i(353)]((async(t,s,r)=>{const o=i;return await this[o(357)][o(320)][o(342)](o(364),{cutImage:{data:l[o(298)].data,width:l[o(298)][o(327)],height:l[o(298)][o(310)]},cutRange:e,targetImage:{data:t,width:s,height:r}}),e})),a(l.resource),l[i(333)]=!0,t[i(322)].fire(e)}async[s(326)](){const t=s,e=this[t(300)]||this[t(357)][t(283)][t(248)];if(!e)return;if(!this[t(366)]&&e[t(228)]?.[t(293)]===t(274)&&(this[t(366)]=e[t(228)]),!this[t(366)])return;const i=this[t(366)];await this[t(357)][t(314)][t(271)](t(231),(async()=>{const s=t;await i.commit(),this[s(357)][s(306)][s(299)](e.width,e[s(310)]),this[s(357)].selectionService.commit(s(231))})),this[t(296)]()}[s(296)](){const t=s;this[t(300)]=void 0,this[t(366)]=void 0,this[t(264)]?.[t(351)](!1),this._onRequestRender[t(242)]()}[s(329)](){const t=s,e=this[t(378)]();this[t(366)]&&this[t(366)][t(358)][t(347)]!==e&&(this[t(366)][t(358)].quality=e,this[t(366)].optionStep(t(285)),this[t(366)][t(319)]())}_getQualityValue(){const t=s;switch(this[t(305)].value){case t(262):return"bilinear";case t(325):return t(330)}}[s(295)](t){const e=s;switch(t){case e(324):return e(262);case e(330):return e(325)}}[s(251)](t){const e=s;return this[e(264)]=new u(t,this[e(357)].selectionService,this[e(357)][e(277)],this._sc[e(283)]),this._renderer}}const l=c;class u extends o.JT{constructor(t,e,i,r){const o=s;super(),this[o(359)]=t,this[o(321)]=e,this[o(253)]=i,this[o(252)]=r,this[o(234)]=2,this[o(243)]=new Map,this[o(294)]=new Map,this[o(241)]=!0,this[o(316)]=document[o(289)](o(224));const n=[o(301),o(335),o(332),o(238),o(276),"bottom",o(311),"right"];for(const t of n){const e=document.createElement(o(224));e.classList[o(302)](o(233)),this._elementContainer[o(331)](e),this[o(243)][o(229)](t,e),this._directionalMoveZones[o(229)](t,(0,h.Pq)())}this[o(359)][o(331)](this._elementContainer),this[o(254)]({dispose:()=>{const t=o;this[t(359)][t(368)](this[t(316)])}}),this[o(321)][o(312)]((()=>this[o(351)](void 0!==this[o(321)][o(272)]))),this[o(351)](void 0!==this[o(321)][o(272)])}[s(351)](t){const e=s;t!==this[e(241)]&&(this[e(316)][e(237)].display=t?"":"none",this[e(241)]=t)}[s(263)](){const t=s,e=this._selectionService[t(272)];if(!e)return;const i=this[t(252)][t(248)];if(!i)return;const r=this[t(253)],o=Math.round(this._container[t(336)]/2)-i[t(327)]/2*r[t(265)],h=Math[t(226)](this[t(359)][t(249)]/2)-i[t(310)]/2*r[t(265)],n=o+(r.x+e.left)*r.zoom,a=h+(r.y+e[t(276)])*r.zoom,c=o+(r.x+e.right)*r.zoom,l=h+(r.y+e[t(273)])*r[t(265)],u=Math.round((n+c)/2),p=Math[t(226)]((a+l)/2),d=10*window[t(236)],v={left:Math[t(345)](n+d,Math[t(225)](n,u-d)),top:Math.min(a+d,Math.max(a,p-d)),right:Math[t(225)](c-d,Math[t(345)](c,u+d)),bottom:Math[t(225)](l-d,Math[t(345)](l,p+d))},g={left:n-d,top:a-d,right:c+d,bottom:l+d},_=this[t(294)].get(t(301));_.left=g[t(311)],_[t(287)]=v.left,_[t(276)]=g.top,_[t(273)]=v[t(276)];const y=this[t(243)].get(t(301));y.style[t(311)]=n+"px",y[t(237)][t(276)]=a+"px";const m=this[t(294)][t(340)](t(335));m.left=v[t(287)],m[t(287)]=g[t(287)],m[t(276)]=g.top,m.bottom=v[t(276)];const f=this[t(243)][t(340)]("topright");f[t(237)][t(311)]=c+"px",f.style[t(276)]=a+"px";const w=this[t(294)].get(t(332));w[t(311)]=g[t(311)],w.right=v.left,w[t(276)]=v.bottom,w.bottom=g[t(273)];const x=this[t(243)][t(340)](t(332));x[t(237)][t(311)]=n+"px",x[t(237)][t(276)]=l+"px";const b=this[t(294)][t(340)](t(238));b[t(311)]=v[t(287)],b[t(287)]=g[t(287)],b[t(276)]=v[t(273)],b[t(273)]=g[t(273)];const M=this[t(243)][t(340)](t(238));M[t(237)][t(311)]=c+"px",M.style[t(276)]=l+"px";const S=this._directionalMoveZones[t(340)](t(276));S[t(311)]=v[t(311)],S[t(287)]=v.right,S[t(276)]=g[t(276)],S[t(273)]=v[t(276)];const L=this[t(243)].get("top");L[t(237)][t(311)]=u+"px",L[t(237)].top=a+"px";const k=this[t(294)][t(340)]("bottom");k[t(311)]=v.left,k[t(287)]=v[t(287)],k[t(276)]=v[t(273)],k.bottom=g[t(273)];const C=this[t(243)][t(340)](t(273));C[t(237)][t(311)]=u+"px",C[t(237)][t(276)]=l+"px";const R=this[t(294)][t(340)](t(311));R[t(311)]=g.left,R[t(287)]=v.left,R[t(276)]=v.top,R[t(273)]=v[t(273)];const U=this[t(243)][t(340)]("left");U[t(237)][t(311)]=n+"px",U[t(237)].top=p+"px";const I=this._directionalMoveZones[t(340)](t(287));I[t(311)]=v[t(287)],I[t(287)]=g[t(287)],I.top=v[t(276)],I.bottom=v[t(273)];const T=this[t(243)][t(340)]("right");T[t(237)][t(311)]=c+"px",T.style.top=p+"px"}getPointerState(t){const e=s;for(const[i,s]of this[e(294)])if(p(s,t[e(362)],t.offsetY))return i;return e(354)}}function p(t,e,i){const r=s;return e>=t[r(311)]&&e<t[r(287)]&&i>=t.top&&i<t.bottom}}}]);