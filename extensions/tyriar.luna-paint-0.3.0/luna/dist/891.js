const a11_0x539d=["string","options","_rectangleOtherPoint","getPointerState","_getStyleString","_onUpdate"," pixels tall","_topLeftInfo","value","order","Set Rectangle Blend Mode","ArrowRight","218973GkPiQf","846247DhbUYs","pointerUp","softLight","new","type","keyUp","ArrowUp","topleft","normal","Rectangle size is ","range","146AWaLWK","selectionService","difference","name","event","outlineSize","Fill and outline","onTemporaryLayerRegistered","right","blendMode","secondary","add","Move Rectangle","567393iHBPVV","Style","_cursorOrigin","style","devicePixelRatio","_cursorOriginalRectangle","_getStyleValue","multiply","_onHistoryUpdateValue","_setupActiveTemporaryLayer","max","_elementContainer","1809PBQJYk","6qcfFXr","_range","zoom","rectangleStep","classList","temporaryLayer","_value","_container","_rectLayerOwner","Resize Rectangle","getCoordsFromEvent","Outline Size","_styleOption","_updateColors","exclusion","5243qATcpB","taskService","Outline","setVisible","_finish","_updateRectangle","_outlineSizeOption","linearBurn","register","clientHeight","pointerMove","paletteService","clientWidth","left","1APWONX","linearDodgeAdd","setColors","appendChild","_onStateChange","_isVisible","Fill","rectLayer","set","bottomright","_clearRectLayer","_sizeInfo","_viewportService","_createRange","rectangle","visible","getInfo","min","91893jZkNhU","onHistoryAction","_blendModeOption","onStateChange","ctrlKey","onUpdate","sign","div","registerTemporaryLayer","move-handle","commit","height","onRequestRender","Set Rectangle Style","_sc","removeChild","topright","viewportService","webpackChunkluna","secondaryColor","onHistoryUnset","primary","primaryColor","round","_renderer","key","onBeforeRunLayerTask","keyDown","bottom","148JxfyXj","currentLayer","onLayerChange","fire","replace","get","info","ArrowDown","_updateOutlineSize","_onOptionsChange","darken","buttons","onHistoryUpdateValue","onCommit","state","abs","_onRequestRender","getDetailedInfo","_updateStyle","Set Rectangle Color","setValueFromHistoryChange","lighten","top","render","pointerDownMove","_cursorCurrent","_updateBlendMode","bottomleft","triggerRequestRender","_isCursorDown","overlay","_rectangleOrigin","imageService","size","_directionalMoveZones","includes"," x ","100202sCyfTU","display","move","_directionalMoveElements","currentState","offsetY","_refreshInfo","Blend Mode","offsetX"],a11_0x254b=function(t,e){return a11_0x539d[t-=211]},a11_0xea2ea=a11_0x254b;(function(t,e){const s=a11_0x254b;for(;;)try{if(583772===-parseInt(s(219))+-parseInt(s(231))*-parseInt(s(308))+parseInt(s(367))*parseInt(s(261))-parseInt(s(366))+parseInt(s(247))*parseInt(s(378))+parseInt(s(279))+parseInt(s(232))*-parseInt(s(345)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a11_0x539d),(self[a11_0xea2ea(297)]=self.webpackChunkluna||[]).push([[891],{9904:(t,e,s)=>{"use strict";const i=a11_0xea2ea;s.d(e,{rP:()=>h,bG:()=>o,Jp:()=>a,qv:()=>c});var r=s(1815),n=s(5120);class h extends n.JT{constructor(t,e,s){const i=a11_0x254b;super(),this[i(381)]=t,this[i(355)]=e,this[i(238)]=s,this[i(371)]=i(354),this[i(227)]=this[i(255)](new r.v),this[i(320)]=this[i(227)][i(382)],this._onUpdate=this[i(255)](new r.v),this[i(284)]=this._onUpdate[i(382)]}get value(){return this._value}set[i(362)](t){const e=i;this[e(238)]=t,this[e(359)][e(311)]()}setValueFromHistoryChange(t){const e=i;this[e(238)]=t,this[e(227)].fire(t)}}class o extends h{constructor(){const t=i;super(t(352),[t(375),t(318),t(226),t(254),t(329),"screen","linearDodgeAdd",t(338),t(369),t(380),t(246)],t(375))}}class a extends h{constructor(){const t=i;super(t(352),["normal",t(312),t(318),"multiply",t(254),t(329),"screen",t(262),"overlay",t(369),"difference",t(246)],t(375))}}class c extends n.JT{constructor(t,e,s,n){const h=i;super(),this.name=t,this[h(238)]=e,this[h(278)]=s,this[h(229)]=n,this[h(371)]="number",this[h(227)]=this.register(new r.v),this[h(320)]=this[h(227)][h(382)],this._onUpdate=this[h(255)](new r.v),this.onUpdate=this[h(359)][h(382)]}get[i(362)](){return this[i(238)]}set value(t){const e=i;this._value=t,this[e(359)].fire()}[i(328)](t){const e=i;this[e(238)]=t,this._onHistoryUpdateValue[e(311)](t)}}},7891:(t,e,s)=>{"use strict";const i=a11_0xea2ea;s.r(e),s.d(e,{default:()=>p});var r=s(6374),n=s(1815),h=s(5120),o=s(1003),a=s(807);class c extends h.JT{constructor(){const t=a11_0x254b;super(...arguments),this[t(359)]=this[t(255)](new n.v),this[t(284)]=this[t(359)][t(382)]}}var l=s(9904);class u extends h.JT{constructor(t){const e=a11_0x254b;super(),this[e(293)]=t,this.id=e(275),this[e(322)]="new",this[e(337)]=!1,this[e(281)]=new l.bG,this[e(244)]=new l.rP(e(220),[e(249),e(267),e(212)],e(249)),this._outlineSizeOption=new l.qv(e(243),1,1,1e3),this[e(355)]=[this[e(281)],this[e(244)],this._outlineSizeOption],this[e(272)]=new g,this[e(361)]=new d,this[e(314)]=[this[e(361)],this._sizeInfo],this[e(324)]=this[e(255)](new n.v),this[e(291)]=this[e(324)][e(382)],this[e(265)]=this[e(255)](new n.v),this[e(282)]=this._onStateChange[e(382)],this[e(255)](this[e(293)].paletteService[e(284)]((()=>this[e(245)]()))),this[e(255)](this[e(244)][e(284)]((()=>this[e(326)]()))),this[e(255)](this[e(253)][e(284)]((()=>this._updateOutlineSize()))),this.register(this[e(281)][e(284)]((()=>this[e(334)]()))),this[e(255)](this._sc[e(340)][e(310)]((()=>this[e(251)]()))),this[e(255)](this[e(293)][e(248)][e(305)]((()=>this[e(251)]()))),this[e(255)]({dispose:()=>this[e(251)]()}),this[e(255)](this._sc[e(340)][e(213)]((t=>this[e(228)](t)))),this[e(293)][e(340)][e(309)]?.[e(237)]&&this[e(228)](this[e(293)][e(340)].currentLayer[e(237)])}[i(228)](t){const e=i;"rectangle"===t.type&&(this[e(268)]=t,this[e(255)](this.rectLayer[e(321)]((()=>this[e(271)]()))),this[e(255)](this[e(268)][e(280)]((()=>this[e(317)]()))),this[e(255)](this[e(268)][e(299)]((()=>this[e(271)]()))),this[e(339)]=[this[e(268)][e(349)][e(377)][e(260)],this.rectLayer[e(349)].range.top],this[e(356)]=[this[e(268)][e(349)].range.right,this[e(268)].currentState.range[e(307)]],this[e(303)]?.[e(250)](!0),this._onRequestRender[e(311)]())}[i(306)](t){const e=i;if(this[e(252)](t),this.rectLayer&&!this[e(337)]&&[e(373),"ArrowLeft",e(315),e(365)][e(343)](t[e(304)])){const s=(0,o.BN)(this.rectLayer[e(349)].range),i=t[e(283)]?10:1;switch(t.key){case e(373):(0,o.Hd)(s,s[e(260)],s[e(330)]-i);break;case e(315):(0,o.Hd)(s,s[e(260)],s[e(330)]+i);break;case"ArrowLeft":(0,o.Hd)(s,s[e(260)]-i,s.top);break;case"ArrowRight":(0,o.Hd)(s,s[e(260)]+i,s.top)}this[e(268)][e(349)][e(377)]=s,this[e(268)].rectangleStep("Shift Rectangle")}}[i(372)](t){this._updateRectangle(t)}async pointerDown(t){const e=i;this[e(337)]=!0;const s=this[e(293)][e(340)].currentLayer;if(!s)return;const r=!(1&t[e(319)]),n=this[e(293)].viewportService[e(242)](t);if(this[e(221)]=n,this[e(333)]=n,!n)return;if(this.state!==e(370))return void(this[e(224)]=(0,o.BN)(this.rectLayer?.currentState[e(377)]));await this[e(251)](),this[e(339)]=n,this._rectangleOtherPoint=n;const h=this._createRange(this[e(339)],this[e(356)]);this[e(224)]=(0,o.BN)(h),this.rectLayer=new a.F(s,{invertColors:r},{primaryColor:this._sc[e(258)][e(300)],secondaryColor:this[e(293)][e(258)][e(216)],blendMode:this[e(281)][e(362)],range:h,outlineSize:this[e(253)].value,style:this._getStyleValue()},this[e(293)].historyService,this[e(293)].taskWorkerService),this[e(351)](),await s[e(287)](this[e(268)]),this[e(303)]?.[e(250)](!1),this[e(268)][e(336)]()}[i(368)](t){const e=i;if(this[e(268)]){let t;switch(this.state){case e(370):t="Draw Rectangle";break;case"move":t=e(218);break;case e(374):case"topright":case"bottomleft":case e(270):case e(330):case e(260):case"right":case"bottom":t=e(241)}this[e(268)][e(235)](t)}this[e(337)]=!1,this[e(303)]?.[e(250)](!0)}[i(332)](t){const e=i;if(!(this._rectangleOrigin&&this._rectangleOtherPoint&&this[e(221)]&&this[e(224)]))return;if(!this._sc.imageService.currentLayer)return;const s=this[e(293)][e(296)].getCoordsFromEvent(t);if(this[e(333)]=s,s[0]===this[e(356)][0]&&s[1]===this._rectangleOtherPoint[1])return;if(!this.rectLayer)return;const r=this._cursorCurrent[0]-this[e(221)][0],n=this[e(333)][1]-this[e(221)][1];switch(this[e(322)]){case"new":return this[e(356)]=s,void this[e(252)](t);case"move":{const t=(0,o.BN)(this[e(224)]);t[e(260)]+=r,t[e(330)]+=n,t[e(214)]+=r,t[e(307)]+=n,(0,o.FJ)(t),this[e(268)][e(349)][e(377)]=t;break}default:{const t=(0,o.BN)(this[e(224)]);(this[e(322)]===e(330)||this.state===e(374)||this[e(322)]===e(295))&&(t[e(330)]+=n),(this[e(322)]===e(307)||this[e(322)]===e(335)||this[e(322)]===e(270))&&(t.bottom+=n),(this[e(322)]===e(260)||this[e(322)]===e(374)||this[e(322)]===e(335))&&(t[e(260)]+=r),(this.state===e(214)||this.state===e(295)||this.state===e(270))&&(t.right+=r),(0,o.FJ)(t),this[e(268)].currentState[e(377)]=t;break}}this._refreshInfo(),this[e(268)][e(336)]()}[i(257)](t){const e=i;if(this[e(303)]&&!this[e(337)]){const s=this[e(303)][e(357)](t);this[e(322)]!==s&&(this[e(322)]=s,this._onStateChange.fire())}}[i(252)](t){const e=i;if(!(this[e(268)]&&this[e(339)]&&this[e(356)]&&this._isCursorDown&&this[e(322)]===e(370)))return;let s=this._rectangleOrigin[0]-this._rectangleOtherPoint[0],r=this[e(339)][1]-this[e(356)][1];t.shiftKey&&(Math[e(323)](s)>Math[e(323)](r)?s=r*(Math[e(285)](s)!==Math.sign(r)?-1:1):r=s*(Math.sign(s)!==Math[e(285)](r)?-1:1)),this[e(268)][e(349)][e(377)]=this[e(274)](this[e(339)],[this[e(339)][0]-s,this[e(339)][1]-r]),this[e(351)](),this.rectLayer.triggerRequestRender()}[i(245)](){const t=i;if(!this[t(268)])return;const e=this[t(293)][t(258)][t(300)],s=this[t(293)].paletteService[t(216)];(0,r.W)(this.rectLayer.currentState[t(301)],e)&&(0,r.W)(this[t(268)][t(349)][t(298)],s)||(this.rectLayer.currentState[t(301)]=e,this[t(268)].currentState[t(298)]=s,this[t(268)][t(235)](t(327),!0),this.rectLayer[t(336)]())}[i(326)](){const t=i,e=this[t(225)]();this[t(268)]&&this.rectLayer[t(349)][t(222)]!==e&&(this[t(268)][t(349)].style=e,this[t(268)][t(235)](t(292)),this.rectLayer.triggerRequestRender())}[i(225)](){const t=i;switch(this[t(244)].value){case t(249):return 1;case t(267):return 2;case t(212):return 3}}[i(358)](t){const e=i;switch(t){case 1:return"Outline";case 2:return e(267);case 3:return e(212)}}[i(316)](){const t=i,e=this._outlineSizeOption.value;this[t(268)]&&this[t(268)].currentState[t(211)]!==e&&(this[t(268)][t(349)][t(211)]=e,this[t(268)][t(235)]("Set Rectangle Outline Size",!0),this[t(268)][t(336)]())}_updateBlendMode(){const t=i,e=this[t(281)][t(362)];this[t(268)]&&this.rectLayer[t(349)][t(215)]!==e&&(this[t(268)][t(349)][t(215)]=e,this[t(268)][t(235)](t(364)),this[t(268)].triggerRequestRender())}[i(317)](){const t=i;this[t(268)]&&(this[t(281)][t(328)](this.rectLayer[t(349)][t(215)]),this[t(253)][t(328)](this[t(268)][t(349)][t(211)]),this._styleOption.setValueFromHistoryChange(this._getStyleString(this[t(268)][t(349)][t(222)])),(!(0,r.W)(this[t(293)][t(258)].primary,this[t(268)].currentState[t(301)])||!(0,r.W)(this[t(293)][t(258)][t(216)],this.rectLayer.currentState[t(298)]))&&this[t(293)][t(258)][t(263)](this.rectLayer.currentState[t(301)],this[t(268)][t(349)].secondaryColor))}async[i(251)](){const t=i;await(this[t(268)]?.[t(289)](this[t(293)][t(379)][t(377)])),this[t(271)]()}_clearRectLayer(){const t=i;this[t(268)]=void 0,this[t(224)]=void 0,this._renderer?.[t(250)](!1),this[t(324)].fire()}[i(274)](t,e){return(0,o.tH)(t[0],t[1],e[0],e[1])}_refreshInfo(){const t=i;this[t(272)][t(377)]=this[t(268)]?.[t(349)][t(377)],this[t(361)].range=this[t(268)]?.[t(349)].range}createDomRenderProgram(t){const e=i;return this[e(303)]=new _(t,this,this[e(293)][e(296)],this[e(293)][e(340)]),this._renderer.setVisible("new"!==this[e(322)]),this._renderer}}const p=u;class g extends c{constructor(){const t=i;super(...arguments),this.type=t(341)}get[i(377)](){return this._range}set[i(377)](t){this[i(233)]=t,this._onUpdate.fire()}get[i(276)](){return!!this[i(233)]}getInfo(){const t=i;if(!this[t(233)])return"";const e=this[t(233)].right-this._range[t(260)],s=this[t(233)][t(307)]-this[t(233)][t(330)];return e+t(344)+s}getDetailedInfo(){const t=i;if(!this[t(233)])return"";const e=this[t(233)][t(214)]-this[t(233)][t(260)],s=this[t(233)].bottom-this[t(233)][t(330)];return t(376)+e+" pixels wide by "+s+t(360)}}class d extends c{constructor(){const t=i;super(...arguments),this[t(371)]=t(374)}get[i(377)](){return this[i(233)]}set[i(377)](t){const e=i;this[e(233)]=t,this[e(359)].fire()}get visible(){return!!this[i(233)]}[i(277)](){const t=i;return this[t(233)]?this[t(233)][t(260)]+", "+this._range[t(330)]:""}[i(325)](){const t=i;return this[t(233)]?"Selection top left position is x="+this[t(233)][t(260)]+" y="+this[t(233)][t(330)]:""}}class _ extends h.JT{constructor(t,e,s,r){const n=i;super(),this[n(239)]=t,this[n(240)]=e,this[n(273)]=s,this._imageService=r,this[n(363)]=2,this[n(348)]=new Map,this[n(342)]=new Map,this[n(266)]=!0,this[n(230)]=document.createElement(n(286));const h=[n(374),"topright","bottomleft","bottomright",n(330),n(307),"left","right"];for(const t of h){const e=document.createElement("div");e[n(236)][n(217)](n(288)),this[n(230)].appendChild(e),this._directionalMoveElements.set(t,e),this[n(342)][n(269)](t,(0,o.Pq)())}this[n(239)][n(264)](this._elementContainer),this[n(255)]({dispose:()=>{const t=n;this[t(239)][t(294)](this._elementContainer)}})}[i(250)](t){const e=i;t!==this._isVisible&&(this[e(230)][e(222)][e(346)]=t?"":"none",this[e(266)]=t)}[i(331)](){const t=i;if(!this[t(240)][t(268)])return;const e=this._rectLayerOwner[t(268)].currentState[t(377)],s=this._imageService.currentLayer;if(!s)return;const r=this[t(273)],n=Math.round(this[t(239)][t(259)]/2)-s.width/2*r[t(234)],h=Math[t(302)](this._container[t(256)]/2)-s[t(290)]/2*r[t(234)],o=n+(r.x+e[t(260)])*r[t(234)],a=h+(r.y+e[t(330)])*r[t(234)],c=n+(r.x+e.right)*r[t(234)],l=h+(r.y+e[t(307)])*r.zoom,u=Math[t(302)]((o+c)/2),p=Math.round((a+l)/2),g=10*window[t(223)],d={left:Math[t(278)](o+g,Math[t(229)](o,u-g)),top:Math[t(278)](a+g,Math[t(229)](a,p-g)),right:Math.max(c-g,Math.min(c,u+g)),bottom:Math.max(l-g,Math[t(278)](l,p+g))},_={left:o-g,top:a-g,right:c+g,bottom:l+g},f=this[t(342)][t(313)](t(374));f[t(260)]=_.left,f.right=d.left,f.top=_.top,f[t(307)]=d[t(330)];const y=this[t(348)].get(t(374));y[t(222)][t(260)]=o+"px",y.style[t(330)]=a+"px";const m=this[t(342)][t(313)](t(295));m[t(260)]=d.right,m[t(214)]=_[t(214)],m[t(330)]=_[t(330)],m[t(307)]=d[t(330)];const v=this[t(348)][t(313)]("topright");v[t(222)][t(260)]=c+"px",v[t(222)][t(330)]=a+"px";const S=this[t(342)][t(313)](t(335));S[t(260)]=_[t(260)],S[t(214)]=d[t(260)],S[t(330)]=d[t(307)],S[t(307)]=_[t(307)];const w=this[t(348)].get(t(335));w.style.left=o+"px",w.style[t(330)]=l+"px";const b=this[t(342)][t(313)](t(270));b.left=d[t(214)],b[t(214)]=_[t(214)],b[t(330)]=d[t(307)],b[t(307)]=_.bottom;const x=this[t(348)].get(t(270));x[t(222)][t(260)]=c+"px",x[t(222)][t(330)]=l+"px";const L=this[t(342)][t(313)]("top");L[t(260)]=d[t(260)],L[t(214)]=d[t(214)],L[t(330)]=_[t(330)],L[t(307)]=d.top;const M=this[t(348)][t(313)](t(330));M[t(222)][t(260)]=u+"px",M[t(222)][t(330)]=a+"px";const R=this[t(342)][t(313)]("bottom");R[t(260)]=d.left,R[t(214)]=d[t(214)],R.top=d.bottom,R.bottom=_.bottom;const C=this._directionalMoveElements[t(313)](t(307));C[t(222)][t(260)]=u+"px",C[t(222)][t(330)]=l+"px";const O=this._directionalMoveZones[t(313)]("left");O[t(260)]=_[t(260)],O[t(214)]=d[t(260)],O.top=d[t(330)],O[t(307)]=d[t(307)];const k=this._directionalMoveElements[t(313)]("left");k[t(222)][t(260)]=o+"px",k[t(222)].top=p+"px";const I=this[t(342)].get(t(214));I[t(260)]=d[t(214)],I.right=_.right,I[t(330)]=d[t(330)],I.bottom=d[t(307)];const z=this[t(348)][t(313)](t(214));z[t(222)].left=c+"px",z[t(222)][t(330)]=p+"px"}[i(357)](t){const e=i;if(!this._rectLayerOwner[e(268)])return e(370);for(const[s,i]of this[e(342)])if(f(i,t.offsetX,t[e(350)]))return s;const s=this[e(342)][e(313)](e(374)),r=this._directionalMoveZones[e(313)]("bottomright");return f({left:s.left,top:s[e(330)],right:r.right,bottom:r[e(307)]},t[e(353)],t[e(350)])?e(347):e(370)}}function f(t,e,s){const r=i;return e>=t[r(260)]&&e<t[r(214)]&&s>=t[r(330)]&&s<t[r(307)]}}}]);