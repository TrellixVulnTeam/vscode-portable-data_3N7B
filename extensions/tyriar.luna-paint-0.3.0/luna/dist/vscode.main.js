const a2_0x17cc=["colorData","window.toggleBottomStatusBarView","vscode.setContext","minimap.toggleStretch","New","_viewportOrigin","selectAll","cmdctrl+x","Trying to get visible viewport range before element is attached","section","_fillRange","content","_resetHexInput","tool.toggleMoveTool","Cannot delete last layer","top","_undoData","#444444","previousSibling","_isSoftDeleted","Toggle Bottom Status Bar View","_doExecuteOnLayer","blend","layer/invertColors","serialize","Redo","_pointerCoord","History entry type ","_layersModel","onWheel"," conflicts with ","_selection","toLowerCase","bindFramebuffer","primaryColor","version","exportImage","Move Layer Up","TRIANGLE_FAN","getAll","Save As","movePixels","_startEdit","_forwardLayerEvents","Command: Show All Commands","bottomleft","acquireVsCodeApi","read","has","onPointerUp","grabbed","_handlePointerDownMove","nearestneighbor","requiresTool","onRequestRender","_isScrollLocked","setService","MinimapService","_disposed","Canvas Size","goToTopLayer","_minimapService","Pencil","body","moveLayer","bindBuffer","label","linear-gradient(180deg, ","Create a new layer","_queueProgress","setTimeout","setProperty","image.expandCanvasToSelection","negateEnabled","_ctx","range","deleteRenderbuffer","_taskWorkerService","_finishEdit","Zoom Out","_listElement","redoData","_onKeyDown","create","image.cropToSelection","layerIndexList","framebufferTexture2D","minimap","deleteShader","New Image","_onHistoryAction"," pixels tall","invertColors","resource","Resize","_scrollInterval","rgba(","saveAs","_channelToHex","_showViewport"," Layer","_windowVisibleContextKey","Toggle Top Status Bar View","runLayerTask","redoRange","remove","defineProperty","Options for task ","drawRectangle","DEPTH_STENCIL_ATTACHMENT","viewport","canRunCommand","pointerDownMove","ctrl+shift+n","warn","runAction","Cannot run crop to selection without a selection","new","_isDisposed","Toggle Move Tool","activeLayer","bindTexture","interactive","Task failed: ","SharedArrayBuffer","Palette","selection.deselect","onLayerVisibilityChange","Nearest neighbor","keys","_onKeyUp","pattern","image.finishActiveAction","layerReplace","Menu","_width","linearBurn","getPropertyValue","layer/expandCanvasToSelection","getContext","#version 300 es\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = vec4(0.5, 0.5, 1, 0.5);\n}","layer.rotate180","Rotate 90Â° Clockwise","cmdctrl+v","#version 300 es\nprecision mediump float;\n\nuniform float ","_matrixUniformLocation","_inputElement","_render","onAttach","arrayBuffer","Command Palette","_onUndo","undoImage","hotExitMaxPixels","#version 300 es\nprecision mediump float;uniform int a;uniform sampler2D b;uniform sampler2D c;in vec2 v_texcoord;out vec4 A;vec3 B(vec4 C,vec4 D,vec3 E){float a=C.a*D.a;return(C.a-a)*C.rgb+(D.a-a)*D.rgb+a*E;}vec4 F(vec4 C,vec4 D,int G){if(D.a==0.){return C;}if(C.a==0.){return D;}vec3 H;if(G==1){H=D.rgb;}else if(G==3){H=vec3(min(C.r,D.r),min(C.g,D.g),min(C.b,D.b));}else if(G==4){H=C.rgb*D.rgb;}else if(G==6){H=max(C.rgb+D.rgb-1.,0.);}else if(G==8){H=vec3(max(C.r,D.r),max(C.g,D.g),max(C.b,D.b));}else if(G==9){H=vec3(1.-(1.-C.r)*(1.-D.r),1.-(1.-C.g)*(1.-D.g),1.-(1.-C.b)*(1.-D.b));}else if(G==11){H=min(C.rgb+D.rgb,vec3(1.));}else if(G==13){H=vec3(C.r<.5?(2.*C.r*D.r):(1.-2.*(1.-C.r)*(1.-D.r)),C.g<.5?(2.*C.g*D.g):(1.-2.*(1.-C.g)*(1.-D.g)),C.b<.5?(2.*C.b*D.b):(1.-2.*(1.-C.b)*(1.-D.b)));}else if(G==14){H=vec3(D.r<.5?(2.*C.r*D.r+C.r*C.r*(1.-2.*D.r)):(sqrt(C.r)*(2.*D.r-1.)+2.*C.r*(1.-D.r)),D.g<.5?(2.*C.g*D.g+C.g*C.g*(1.-2.*D.g)):(sqrt(C.g)*(2.*D.g-1.)+2.*C.g*(1.-D.g)),D.b<.5?(2.*C.b*D.b+C.b*C.b*(1.-2.*D.b)):(sqrt(C.b)*(2.*D.b-1.)+2.*C.b*(1.-D.b)));}else if(G==20){H=abs(C.rgb-D.rgb);}else if(G==21){H=C.rgb+D.rgb-2.*C.rgb*D.rgb;}float I=D.a+C.a*(1.-D.a);return vec4(B(C,D,H)/I,I);}void main(){vec4 J=texture(b,v_texcoord);vec4 K=texture(c,v_texcoord);A=F(J,K,a);}","Paste Image","_selectionAnimationFrame","hidden",";\n\nvoid main() {\n  gl_Position = ","Delete Layer","302188dPdJTE","Uint32Array"," * a_position;\n  v_position = a_position.xy;\n}","Layer: ","padEnd","min","dest","selectionEnd","currentScript","webglcontextlost","Loading chunk ","INPUT","onDidRemoveBottomItem","_uniformValueBlendModes","_createMinimapImageBounds","Erase","deltaY","activeEntry","_onRequestRender","firstChild","_backgroundColor","onStateChange","_blendShader","scaledImage","removeAttribute","topright","Rectangle","zoom","Selection","cmd-palette-header","_replacedRange","_logProgress","view","event","Layer ","layerRange","_onDidAddTopItem",'" already exists',"Move Layer to Top","_luna","bind","_updateAttributeBuffersForLayer","utf-8","generateLayerPreview","multiLayer","[createInstance] ","Enter the height of the image","aria-label","_createView","Finish Rectangle Pixels","_onChangedDimensions","ctrl+d","_handleWheel","left-items","layer/rotate90Clockwise","_pointerDownMoveListener","header-content","getCommand","vscode.main","left","_toolRenderPrograms","ctrl+m","tool.rectangle","file.new","Height not selected","window.toggleTopStatusBarView","DEPTH_STENCIL","registerRequestHandler","position",") in vec4 a_position;\n\nuniform mat4 ","contentRect","_startAnimatingProgram","keyup","_positionsArray","_isPixelGridEnabled","lighten","ctrl+shift+i","clearEntries","layer/flipVertical","keyDown","_zoom","Paste","history.toggleHistoryWindow","_restoreEntry",") 0%, rgba(","moveSelection","Resampling not selected","options","type","Gets the color of the nearest pixel.","_target","_onProgress","toFixed","onStopAnimating","inputBoxNumber","setTopLeft","Cannot get coords without element","difference","request","getProgramParameter","TaskService","clearColor","draw","Cannot set the active layer to undefined","toStringTag","exclusion","_views","attachShader","dispose","MacIntel","vscode.toggleMenuBar","_imageDimensionsUniformLocation","fireAndWait","_handlePointerUp","_toolDisposables","bottomStatusBar","releasePointerCapture","_currentCompositeEntry","toString","query","189799GrrSMn","_name","scrollHeight","div","script","_leftItemsElement","hardwareConcurrency","_initialIndex","_keyDown","_color","_onStartAnimating","_activeAnimatingRenderPrograms","useMovingLayer","Bottom right","restoreState","Move Layer to Bottom","scrollTop","data-webpack","onChange","_reportInterval","Win16","file","_positionBuffer","workbenchState","Cut Image","_matrixNeedsUpdate","_updatePreviewIfNeeded","push","multiply","onload","translate(-50%, -50%)","onDidChangeDimensions","_parent","_onBeforeRunLayerTask","undefined","percent","minimap-show-viewport","ctrlKey","code","_onDispose","finishRectangle","parentLayerId","onLastListenerRemove","offsetTop","_deleteLayerByIndex","putRange","layer-move-up","_createWorker","createTexture","onPointerMove","STENCIL_TEST","max","_updateUniformValueMatrix","_rehydrateExtHostMessage","_secondaryColorDiv","open","moveStep","SRC_ALPHA","_multiplyZoom","exportBlob","ctrl+shift+p"," ||\n      mod(v_position.y / ","_isRestoringState","_removeItem","_elementService","vscode-menu","Left","Toggle Tools Window","button","previewCanvas","hasOwnProperty",".css","_imageService","missing","encodeOptions","StatusBarService","Eraser","_progressLast","ARRAY_BUFFER","texParameteri","Cannot run expand canvas to selection without a selection","selection","UNSIGNED_BYTE",", top: ","view.togglePixelGrid","texture","dataType","pointerId","querySelector","data","splice","convertToBlob","_forwardEventToTool","filter","_canvas","_selectionService","_updateColorViaSlider","pop","ctrl+alt+pagedown","_renderService","webgl2","Top","enable","palette.swapColors","layer/flipHorizontal","mergeLayerDown","moveLayerUp","Could not find layer to set","_cachedMovingLayer","_pointCount","isSoftDeleted","Image exceeded maximum pixel count allowed (","_startTime","BLEND","readyPromise","onFirstListenerAdd","_clipspaceToCanvasCoordsMatrix","Rotate 180","_redoDimensions","tool.colorPicker","_createListItemElement",";\n\nout vec4 outColor;\n\nvoid main() {\n  float c = floor(mod((float(gl_FragCoord.x) + float(gl_FragCoord.y) + ","_onPointerCoordChange","toggleView","_redoImage","_onZoomChange","_updateBottomLayer","tool.movePixels","color","_validate","createFramebuffer","Draw Rectangle","image/png","_updatePosition","[createInstance] First service dependency of ","getLayerById","createImageBitmap","ctrl+shift+s",";\n}","undoHandler","Adjustments","_requestToolIfNeeded","_parentLayer","pointerdown","_createPaletteButton","disconnect","getLeftItems","replace","_positionsNeedsUpdate","temporaryLayers","_renderPrograms","selectionStart","edit","_channelInputs","_renderProgramsWithOrder","Top right","getRange","call",",1) 0%, rgba(","Mac68K","newLayer","_attach","substring","_activeRequests","_fillCommands","Clipboard contains non-image data. Unable to access it.","indexOf","_matrixLocation","removeEventListener","topleft","_getJobDimension","10px","WebGL context loss, please reload the tab","newImage","destRange","setOption","_onTemporaryLayerRegistered","Set Paste Image Selection","tool.pencil","_action","luna:","height",'No handler for webview request "',"Zoom level is ","LINE_LOOP","_showError","_entries","fillGlobal","_info","clipboard-read","attach","redo","_onShowViewportChange","View","File","registerStateHandler","_vertexArrayObject","vscode.executeCommand","_blendModeUniformLocation","documentElement","u_pixelsize",'", ignoring',"Toggle the viewport display in the minimap","getShaderParameter","_serializeCompositeEntry","invokeFunction","ONE","currentValue","_targetIndex","STATIC_DRAW","registerTemporaryLayer","item","renderLayer","_commands","image.canvasSize","_layer","validate","_replacedImage","background","replacedRange","onKeyDown","_gl","initialState","Close ","runCommand","join","_secondary","TEXTURE_MAG_FILTER","Select how the resize will be performed","u_color","_renderTileSet","currentLayer","forEach","className","KeybindingService","initial","filterCommands","_disposables","createVertexArray","triggerHistoryAction","history-list","_setHorizontalLine","nameSpan","_normalizeWheelDelta","checkValidity","99523atJrnG","Finish Active Action","onUpdateEmitter","Select All","_addOption","LINEAR","view.actualSize"," failed.\n(","Move Layer Down","parentNode","Flip Vertical","Delete the active layer","_stopAnimatingProgram","tool","zoomOut","_createColorInfo","updateWorkbenchState","Could not find builtin tool ","onDidChangeVisibility","_updateProgress","Minimap is currently only supported for images < 5MP (width * height)","_onPointerDown","_getCanvasBounds",".js","_activeTool","change","_onRedo","start","--vscode-editor-background","getParameter","8129AygjXF","now","eraseRange","onChangedDimensions","Hide","getShaderInfoLog","setPixel","image-dimensions","_viewportUpdate","ChunkLoadError","Cut","data-tool-state","getImageData","activeTexture","createMessageHandler","image","renderbufferStorage","style","close","deleteTexture","_range","palette.togglePaletteWindow","_goToRelativeLayer","list","RGBA","_onStretchEnabledChange","[invokeFunction] unknown service '","colorPicker","Flatten Layers","preview","replacedImage","drawImage","onHistoryUnset","load","_contentElement","Anchor not selected","_onStateChange","createDocumentFragment","finishMovePixels","_frameBuffer","_ipcService","run","staticState","file.saveAs","_updateAttributeBuffers","undoRange","_viewsElement","_listeners","_zoomUniformLocation","Could not restore workbench state (version ","_stateService","_updateItem","ceil","[0-9a-fA-F]*","_onLayerVisibilityChange","webpackChunkluna","_inputService","mouseleft","eraser","zoomIn","resume","layer/rotate180","onSoftDeletedChange","normal"," y=","checkbox","_contributions","_historyService","selection.selectAll","onStretchEnabledChange","Move Pixels","name","executeOnAllLayers","registerHistoryEntryHandler","display","block","Image","onDimensionsChange","Restore Image (Hot Exit)","ctrl+b","_sc","shift","_animationFrame"," > ","insertAdjacentElement","parentElement","saveState","tool.moveSelection","_nullTexture","_height","decorate","visibleRange","edit.undo","_colorToHex",'Response received without request "',"onToolChange","topStatusBar","unknown","_workMatrices","_redoBlendMode","scaledWidth","_onWheel","radio","requestOptions","1AfUQaS","_renderer","onShowViewportChange","onEntriesChange","destImage","_operationName","_onToolChange","_onPixelGridEnabledChange","Hard edges","useProgram","color-box","_outOfFrameScroll","Zoom","_loadModule","sort","denied","onLayerChangeEmitter","layer/cropToSelection","all","goToBottomLayer","clientWidth","_container","wheel","_layerOffsetUniformLocation","moveLayerToTop","_isAnimating","scaledHeight","onDidAddBottomItem","_contextKeyService","blendFunc","layer-list","bottom","Enter the width of the image","vertexAttribPointer","onDidAddTopItem","miniCssF","singleLayer","Toggle small images between actual size and stretching to fit the minimap dimensions","blendColorAtRange","fitToWindow","leftItems","_getBeforeRunLayerTaskEvent","isStretchEnabled","checked","_primary","slider-tab","openBlob","Toggle pixel grid when zoomed in","view.fitToWindow","object","target","_redoData","Open Image","color-overlay","currentEntry","error","Cannot find module '","moveLayerToBottom","Hex:","_sliderGradientElement",'History entry "',"_extHostRequestHandlers","KEEP","viewService","tool.zoom","Selection top left position is x=","ctrl+n",'Could not find non-existent window view "',"_updateShiftUniform","Unrecognized blend mode","stencilFunc","uniform2f","#gui","COLOR_ATTACHMENT0","layers","_requestNewDimensions","_frameBufferRenderBuffer","status-bar-item-","pixelCount","removeChild","Cannot finish temporary layer without at least 1 step","Cannot merge the bottom layer down","image.resize","Top left","_onLayerChange","Cannot resize image in single layer task","_currentEntryPointer","match","buffer","_layerBlendModesUniformLocation","indexList","createRenderbuffer","rgba","toBlob","_itemDisposables","Import Blob","subarray","resize","_onDidAddBottomItem","_updateUniformValueZoom","di$target","ranges","triggerRequestRender","contains","_defaultValue","index","onDispose","_deleteCurrentLayer","from","erase","finishTemporaryLayer","_options","composite","getInfo","map","Automatic publicPath is not supported in this browser","_imageCanvasRenderProgram","TEXTURE0","layer.goToBottomLayer","Command","FileService","padStart",") 100%)","_updateMatrixUniform","_frameBufferTextures","runSyncAction","Rotate 90Â° Counter-Clockwise","layer-delete","abs","Toggle Menu Bar","onKeyUp","framebufferRenderbuffer","getRanges","_apply","adjustMovePixels","disposables","ctrl+y","_sliderTabElement","canSerialize","rectangle","setBlendMode","Background","Toggle Palette Window","_onSoftDeletedChange","canvas","_value","_items","setLayerVisibility","registerHistoryEntryFactory",'" exceeded maximum pixel count allowed (',"_colorLocation",'Cannot run command "',"Buffer","_rangeNotYetRequested","pow","_clickOrigin","runTask","_glSelection","window","pageX","buttons","length","width","#top","Image size is ","di$dependencies","_update","COLOR_BUFFER_BIT","onStartAnimating","requestRender","Windows","_onHistoryUnset","TEXTURE_MIN_FILTER","pause","Rotate 180Â°","_channelIndex","Merge",";\n\nin vec2 v_position;\n\nout vec4 outColor;\n\nvoid main() {\n  if (mod(v_position.x / ","none","luna:focused","6XigewX","hasImage","_updatePalette",'Cannot find factory for history entry id "',"_lastCommittedRange","VERTEX_SHADER","Toggle Pixel Grid","_uniformValueZoom",";\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = ","fire","Resize Canvas","createProgram","complete","Finish Selection","onVisibilityChange","onerror","_resize","size","for","_createLayer","layer.addNewLayer","onCommit","Rotate 90Â° Counter Clockwise","importScripts","Expand Canvas to Selection","outlineSize","ONE_MINUS_SRC_ALPHA","_generatePreview","_activeItems","onZoomChange","_onRequestTool","moveSelectedPixels","_lunaService","span","Invert","_blendWithframeBufferUniformLocation","state","exportBlobClone","onTemporaryLayerRegistered","quickPick","view.zoomOut","Unknown","refresh","_attachedDisposables","getAllCommands","cutImage","Access to clipboard-read was denied","_scrollVelocity","_getFrameBufferTexture","_getIndexFromId","document","setAttribute","save","message","bindVertexArray","stencilOp","addEventListener","offsetX","merge","stepState","mouseright","_texcoordBuffer","_elementResizeObserver","serialize function does not exist on history entry","_commandService","layer.flipHorizontal","TRIANGLE_STRIP","_animationRenderPrograms","_queueUpdate","Bilinear","restoreHistory","darken","string","key","Toggle Layers Window","onmessage","Go to Top Layer","visibleCheckbox","palette","onUndo","cmd-palette","_rectangleShader","Width not selected","offsetHeight","refreshTheme","undoData","NYI","_primaryColorDiv","workbench.action.quickOpen","getComputedStyle","_layerTexturesUniformLocation","static","absolute","50%","startLayer","linear-gradient(180deg, rgba(","_data"," has already been registered",'Could not find non-existent static view "',"isBottomLayer",'Job dimension not found for task "',"bufferData","round","blur","No history entry ID to restore","order","FRAMEBUFFER","Smooth edges","repeat","Uint16Array","_listItemElements","createCompositeEntry","_hexInputElement","executeOnSingleLayer","onBeforeRunLayerTask","layer.moveLayerToBottom","_createBlendModeSelect",'Duplicate webview request handler "',"1jSXVCK"," at position ","Cannot delete the last layer","views","defaultVisible","targetIndex","_onDidChangeVisibilityEmitter","secondaryColor","layer.goToLayerAbove","_previewCache","edit.redo","Layer","classList","then","enabled","resolve",") {\n    outColor = vec4(0.2, 0.2, 0.2, .2);\n  }\n}","Tool","_progressTimeout","Cannot restore state from previous version (","Fit to Window","_taskService","Edit","getCoordsFromEvent","src","toUpperCase","RENDERBUFFER","nonce","uniform4f","Move the active layer up","selection-size","currentTemporaryLayerId","permissions","postMessage","_undoBlendMode","_undoDimensions","trim"," 0%, rgba(","Middle","_blendModeOptions","set","pointerMove","disabled","delete","layer/rotate90CounterClockwise","img","onRedo","rectangleStep","_viewportElement","_viewportPosition","43hTIweM","navigator.clipboard.write not supported","Crop","--vscode-foreground","__decorate","Image is readonly, edit is in progress","enableVertexAttribArray","ILunaService","History entry factory ","default","StateService","_calculateScrollVelocity","setVisible","Toggle Stretch","ctrl+h","_canvasSelection","Update Selection","catch","Module","_onmessage","includes","Macintosh","title","undo","shaderSource","_layerListElement","_program","edit.copy","layer.flipVertical","screen","negateChecked","temporaryLayer","rgba-input-","CurrentVersion","_isVisible","value","imageSmoothingEnabled","InstantiationService","uniform1f","input","Gets the color by averaging the values of surrounding pixels.","text","CLAMP_TO_EDGE","restoreImage","onPixelGridEnabledChange","option","split","redoHandler","17351wOVlTe","triggerHistoryUnset","_rangeBuffer","serviceBrand","offsetWidth","_onAttach","_onEntriesChange","Window","info","Layers","_destRange","element","setTool","STENCIL_BUFFER_BIT","focus","offsetY","MacPPC","requestAnimationFrame","#version 300 es\nlayout (location = ","sqrt","_entryHandlers","Zoom In","pointerUp","function","uniformMatrix4fv","getService","setActiveLayer","_lastAnimationFrame","tiles","currentState","_undoImage","_screenPixelToCanvasCoord","_zoomLocation","moveLayerDown","undoBlendMode","_onPointerMove","#bottom","commandId","66957VxaSYz","isPixelGridEnabled","Open","container","ctrl+shift+x"," * a_position;\n}","view.zoomIn","__esModule","TEXTURE_WRAP_T","showViewport","onProgress","_event","fill","_rightItemsElement","initialIndex","_pointCache","commit","prototype","task.worker.worker.js","_tempLayer","primary","middle","onPointerDown","head","result",'Unknown command id for type "',"Minimap","_onCommit","right","TEXTURE_2D","optionStep","FLOAT","_updateRenderLayerTiles","Selection size is ","createExtendedEdit","getType","_addItem","textContent","Unrecognized array type","_handlePointerMove","importBlob","_textureBUniformLocation","_pixelSizeLocation","Toggle History Window","attribute vec4 a_position;attribute vec2 a_texcoord;uniform mat4 a;uniform vec2 b;varying vec2 v_texcoord;void main(){gl_Position=a*(a_position*vec4(b,0.,1.));v_texcoord=a_texcoord;}","Unknown History Entry","rightItems","isVisible","getUniformLocation","Go to Bottom Layer","u_shift","onUpdate","_colorUniformLocation","layer/resizeCanvas","ctrl+j","86361VGmgbj","deleteProgram","contextmenu","chunk-","cmdctrl+z","_entryFactories","loaded","_onUpdate","ctrl+a","_layerListItems","onHistoryUpdateValue","#version 300 es\nlayout(location=0)in vec4 A;out vec2 v_texcoord;void main(){gl_Position=A;v_texcoord=(A.xy+1.)/2.;}","layer.moveLayerUp","_onPointerDownMove","append","--vscode-breadcrumb-foreground",", 1.) < 1. / ","alignment","getTemporaryLayerById","Save","_renderLayers","platform","entries","onRequestTool","_createToggle","disableWorkers","undoDimensions","_contextKeys","createBuffer","colorMask","_onPointerUp","REPLACE","extHostRequestId","blobBuffer","_onDimensionsChange","substr","slice","_paletteService","task","_canvasDimensionsUniformLocation","pageY","drawCircle","bilinear","Deselect","layer/resize","onPointerCoordChange","_isEditInProgress","createRenderProgram","_stepState","isSelectionTool","layer.deleteLayer",",1)","adjustRectangle","reduce","_viewportService","Flip Horizontal","No undo entry","FRAGMENT_SHADER","_toolElements","_createButton","OffscreenCanvas","isReady","scaledImageQuality","toggle","precision mediump float;varying vec2 v_texcoord;uniform int h;uniform int k;uniform vec2 d;uniform vec2 f;uniform vec2 g;uniform int m;uniform vec2 l;uniform int c[7];uniform sampler2D j[7];uniform sampler2D n;vec3 A(vec4 B,vec4 C,vec3 D){float E=B.a*C.a;return(B.a-E)*B.rgb+(C.a-E)*C.rgb+E*D;}vec4 F(vec4 B,vec4 C,int G){if(C.a==0.){return B;}if(B.a==0.){return C;}vec3 H;if(G==1){H=C.rgb;}else if(G==3){H=vec3(min(B.r,C.r),min(B.g,C.g),min(B.b,C.b));}else if(G==4){H=B.rgb*C.rgb;}else if(G==6){H=max(B.rgb+C.rgb-1.,0.);}else if(G==8){H=vec3(max(B.r,C.r),max(B.g,C.g),max(B.b,C.b));}else if(G==9){H=vec3(1.-(1.-B.r)*(1.-C.r),1.-(1.-B.g)*(1.-C.g),1.-(1.-B.b)*(1.-C.b));}else if(G==11){H=min(B.rgb+C.rgb,vec3(1.));}else if(G==13){H=vec3(B.r<.5?(2.*B.r*C.r):(1.-2.*(1.-B.r)*(1.-C.r)),B.g<.5?(2.*B.g*C.g):(1.-2.*(1.-B.g)*(1.-C.g)),B.b<.5?(2.*B.b*C.b):(1.-2.*(1.-B.b)*(1.-C.b)));}else if(G==14){H=vec3(C.r<.5?(2.*B.r*C.r+B.r*B.r*(1.-2.*C.r)):(sqrt(B.r)*(2.*C.r-1.)+2.*B.r*(1.-C.r)),C.g<.5?(2.*B.g*C.g+B.g*B.g*(1.-2.*C.g)):(sqrt(B.g)*(2.*C.g-1.)+2.*B.g*(1.-C.g)),C.b<.5?(2.*B.b*C.b+B.b*B.b*(1.-2.*C.b)):(sqrt(B.b)*(2.*C.b-1.)+2.*B.b*(1.-C.b)));}else if(G==20){H=abs(B.rgb-C.rgb);}else if(G==21){H=B.rgb+C.rgb-2.*B.rgb*C.rgb;}float I=C.a+B.a*(1.-C.a);return vec4(A(B,C,H)/I,I);}void main(){vec4 B;if(g==f&&d==vec2(0.)){B=texture2D(j[0],v_texcoord);}else{if(v_texcoord.x>=(d.x)/g.x&&v_texcoord.y>=(d.y)/g.y&&v_texcoord.x<((d.x)+f.x)/g.x&&v_texcoord.y<((d.y)+f.y)/g.y){vec2 J=v_texcoord-vec2(d.x/g.x,d.y/g.y);vec2 K=J*vec2(g.x/f.x,g.y/f.y);B=texture2D(j[0],K);}else{if(k==1){discard;}else{B=vec4(0.,0.,0.,0.);}}}if(m==1){vec4 L=texture2D(n,gl_FragCoord.xy/l);B=F(L,B,c[0]);}for(int M=1;M<7;M++){if(M>=h){break;}vec4 C=texture2D(j[M],v_texcoord);B=F(B,C,c[M]);}gl_FragColor=B;}","pencil","History","css.toColor: Unsupported css format","WinCE","Actual Size","_getNonSoftDeletedLayerCount","terminate","createItem","getColorSetFromPointerEvent","_viewElement","exportImageClone","clearRect","observe","softLight","data-active-tool"," x ","DYNAMIC_DRAW","image.rotate180","Cannot serialize history","#canvas","putImage","webviewRequestId","_forceSelectionAnimation","_toolService","get","_headerContentElement","_statusBarService","#version 300 es\nprecision mediump float;\n\nuniform vec4 ","redoDimensions","onLayerChange","isArray","goToLayerAbove","Tools","tool.toggleToolsWindow","NOTEQUAL","addEntry","active","alt+pageup","containsCoord","clear","precision mediump float;uniform vec4 c;void main(){gl_FragColor=c;}","_services","NEAREST","_position","minimap.toggleMinimapWindow","--luna-statusBar-icon-brightness","_redoRange","secondary","number","goToLayerBelow","values","_finish","getAttribute","tools","deleteLayer","getOwnPropertyDescriptor","moving","_activeTemporaryLayers","historyNewEdit","clientHeight","updateAnimation","getDetailedInfo","modal","Toggle Minimap Window","add","_shiftValue","uniform1i","preventDefault","unregister","Bottom","_instantiationService","setPointerCapture","layer.goToLayerBelow","return this","CommandService","activeTool","ctrl+alt+pageup","select","layer/crop","_onVisibilityChange","canRedo","click","__param","factory","quality","createElement","isPointerDown","_isPaused","render","tool.fill","layerId","_imageLayerIdCounter","TEXTURE_WRAP_S","keydown","register","flattenLayers","ctrl+shift+delete","tempLayerId","COMPILE_STATUS","Toggle Show Viewport","bindRenderbuffer","getAttribLocation","ctor","_timeout","Finish Rectangle","progress","uniform1iv","getElementsByTagName","operationName","overlay","u_matrix","pointerup","layer.moveLayerToTop","edit.cut","Undoing temporary layer step without initial step state event",";\n\nout vec2 v_position;\n\nvoid main() {\n  gl_Position = ","write","createShader","layer","_eventInViewport","blendMode","_reportProgress","hex","visible","assign","luna-icon","generatePreview","openImage","swap","_model","floor","Move the active layer down","onHistoryAction",", bottom: ","_layerCountUniformLocation","_positionArray","_shiftLocation","Cannot redo readonly entry","_onDidRemoveTopItem","onDidRemoveTopItem","canUndo","cmd+shift+z","#version 300 es\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = vec4(0, 0, 0, 1);\n}","minimap.toggleShowViewport","bottomright","simple","clipboard","createInstance","imageResize","_stateHandlers","transform","dimensions"," < ","_frameBufferTexture","renderSelection","texImage2D","_refreshToolState","actions","deserialize","deselect","log","_onDidRemoveBottomItem","No current layer","linearDodgeAdd","readonly","drawArrays","_blendMode","moveToRange","_progress","exports","_isStretchEnabled","_isStencilUniformLocation","appendChild","history"],a2_0x41cc=function(t,e){return a2_0x17cc[t-=155]};(function(t,e){const i=a2_0x41cc;for(;;)try{if(236557===-parseInt(i(862))*parseInt(i(608))-parseInt(i(294))+parseInt(i(1436))+-parseInt(i(324))*-parseInt(i(776))+parseInt(i(917))*-parseInt(i(726))+parseInt(i(1316))+parseInt(i(824))*-parseInt(i(428)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a2_0x17cc),(()=>{var t={4738:t=>{const e=a2_0x41cc;t[e(1151)]=e(1310)},7542:t=>{const e=a2_0x41cc;t.exports=e(928)},3318:t=>{const e=a2_0x41cc;t[e(1151)]=e(981)},3716:t=>{const e=a2_0x41cc;t.exports=e(906)},98:t=>{const e=a2_0x41cc;t[e(1151)]=e(1022)},7034:t=>{t[a2_0x41cc(1151)]="attribute vec4 a_position;uniform mat4 a;uniform vec2 b;void main(){gl_Position=a*(a_position*vec4(b,0.,1.));}"},6495:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n,N:()=>o});var s=i(7166),r=i(4378);class n{constructor(t,e,i,s){const r=a2_0x41cc;this[r(1090)]=t,this._range=e,this[r(264)]=i,this._f=s}async run(){const t=a2_0x41cc,e=(0,s.Qf)(this[t(264)],this._range);await this[t(264)][t(201)]((async(e,i,s)=>{const r=t;return await this._f(e,i,s),this[r(344)]}));const i=(0,s.Qf)(this[t(264)],this._range);return new r.$(this.operationName,this[t(344)],this._layer,e,i)}}class o{constructor(t,e,i,s,r,n,o){const h=a2_0x41cc;this._operationName=t,this[h(264)]=e,this[h(1187)]=i,this._x=s,this._y=r,this[h(1445)]=n,this[h(1233)]=o}async run(){const t=a2_0x41cc;let e;return await this[t(264)][t(201)]((async(i,s,r)=>{const n=t;return e=await this[n(1233)][n(584)](n(236),{targetImage:{data:i,width:s,height:r},color:new Uint8Array(this[n(1445)]),selection:this._selection,x:this._x,y:this._y}),e[n(1231)]})),new r.$(this[t(433)],e[t(1231)],this._layer,e[t(693)],e[t(1237)])}}},4375:(t,e,i)=>{"use strict";const s=a2_0x41cc;i.d(e,{Y:()=>r});class r{constructor(t,e,i,s){const r=a2_0x41cc;this[r(1090)]=t,this[r(965)]=e,this[r(264)]=i,this[r(881)]=s,this[r(1404)]=r(464),this[r(1209)]=r(1197),this[r(506)]=0}async[s(799)](){const t=s;if(this[t(881)][t(667)][t(1533)](),0===this[t(881)][t(667)][t(589)])throw new Error(t(1096));const e=this[t(881)][t(667)][this[t(881)][t(667)][t(589)]-1];return this[t(561)](this[t(881)].currentState,e),this[t(264)]}async[s(240)](){const t=s;return this[t(881)][t(667)][t(1463)](this[t(965)]),this._apply(this[t(881)][t(853)],this[t(965)]),this[t(264)]}[s(561)](t,e){const i=s;Object[i(1106)](t,e),this[i(881)][i(530)](),this._tempLayer.triggerHistoryAction()}[s(1180)](){const t=s;return{id:t(562),operationName:this[t(1090)],layerId:this[t(264)].id,tempLayerId:this[t(881)].id,stepState:this[t(965)]}}static[s(1239)](t,e){const i=s,n=t[i(184)](e[i(1072)]),o=t[i(935)](e[i(1079)]);return new r(e[i(1090)],e[i(667)],n,o)}}},5901:(t,e,i)=>{"use strict";const s=a2_0x41cc;i.d(e,{X:()=>r});class r{constructor(t,e,i,s){const r=a2_0x41cc;this[r(1090)]=t,this[r(667)]=e,this[r(264)]=i,this[r(881)]=s,this[r(1404)]=r(464),this.requiresTool=r(567),this.pixelCount=0}async undo(){const t=a2_0x41cc;if(this[t(881)].stepState[t(1533)](),0===this[t(881)][t(667)][t(589)])throw new Error(t(1096));const e=this[t(881)].stepState[this._tempLayer.stepState[t(589)]-1];return this[t(561)](this[t(881)][t(853)],e),this[t(264)]}async[s(240)](){const t=s;return this._tempLayer.stepState[t(1463)](this[t(667)]),this._apply(this[t(881)][t(853)],this.stepState),this[t(264)]}[s(561)](t,e){const i=s;Object[i(1106)](t,e),this[i(881)][i(530)](),this._tempLayer[i(288)]()}[s(1180)](){const t=s;return{id:t(969),operationName:this[t(1090)],layerId:this[t(264)].id,tempLayerId:this[t(881)].id,stepState:this[t(667)]}}static[s(1239)](t,e){const i=s,n=t.getLayerById(e[i(1072)]),o=t[i(935)](e[i(1079)]);return new r(e.operationName,e[i(667)],n,o)}}},1405:(t,e,i)=>{"use strict";const s=a2_0x41cc;i.d(e,{D:()=>r});class r{constructor(t,e,i,s){const r=a2_0x41cc;this[r(1090)]=t,this[r(965)]=e,this[r(264)]=i,this[r(881)]=s,this[r(1404)]=r(464),this[r(1209)]="rectangle",this.pixelCount=0}async[s(799)](){const t=s;return this[t(881)][t(667)][t(1533)](),this[t(561)](this._tempLayer.currentState,this[t(881)][t(271)]),this[t(264)][t(807)]=void 0,this[t(881)].triggerHistoryUnset(),this[t(264)]}async redo(){const t=s;return this[t(881)][t(667)].push(this[t(965)]),this[t(561)](this[t(881)][t(853)],this._stepState),await this._layer[t(259)](this[t(881)],!1),this._tempLayer[t(288)](),this[t(264)]}[s(561)](t,e){const i=s;Object[i(1106)](t,e),this[i(881)][i(530)]()}serialize(){const t=s;return{id:"drawRectangle",operationName:this[t(1090)],layerId:this[t(264)].id,tempLayerId:this[t(881)].id,stepState:this._stepState}}static[s(1239)](t,e){const i=s,n=t[i(184)](e[i(1072)]),o=t.getTemporaryLayerById(e.tempLayerId);return new r(e[i(1090)],e.stepState,n,o)}}},6628:(t,e,i)=>{"use strict";const s=a2_0x41cc;i.d(e,{$:()=>o});var r=i(1003),n=i(7605);class o{constructor(t,e,i,s,n,o,h){const a=a2_0x41cc;this[a(1090)]=t,this._taskWorkerService=e,this[a(834)]=i,this[a(1346)]=s,this[a(264)]=n,this._tempLayer=o,this[a(266)]=h,this[a(1404)]=a(464),this[a(1209)]=a(1197),this.pixelCount=(0,r.U6)(this[a(1346)])}async undo(){const t=a2_0x41cc;if(0===this._tempLayer[t(667)].length)throw new Error(t(508));const e=this._tempLayer.stepState[this[t(881)][t(667)][t(589)]-1];return this._tempLayer[t(853)][t(665)]=e.offsetX,this[t(881)].currentState[t(839)]=e[t(839)],await this[t(264)][t(259)](this[t(881)],!1),await this[t(264)].edit((async(e,i,s)=>{const r=t;return await this._taskWorkerService[r(584)](r(1002),{targetImage:{data:e,width:i,height:s},putImage:{data:this[r(266)][r(1525)],width:this[r(266)][r(590)],height:this[r(266)].height},putRange:this[r(1346)],replacedImage:void 0,blend:!1}),this._destRange})),this[t(881)][t(288)](),this[t(264)]}async redo(){const t=a2_0x41cc,e=this[t(881)].stepState[this._tempLayer[t(667)].length-1];this[t(881)][t(853)][t(665)]=this._destRange[t(1375)],this._tempLayer.currentState.offsetY=this[t(834)][t(1171)],this[t(264)][t(807)]=void 0;const i=await this[t(881)][t(366)][t(339)][t(163)];let s;if(e[t(424)]===i[t(590)]&&e[t(424)]===i[t(590)])s=i;else{const r=await this[t(1233)][t(1259)](t(961),{width:e[t(424)],height:e.scaledHeight,resampling:e[t(1066)]},i,void 0).result;s=r[t(1322)]}return await this[t(264)][t(201)]((async(e,i,r)=>{const n=t;return await this[n(1233)][n(584)](n(1002),{targetImage:{data:e,width:i,height:r},putImage:{data:s[n(1525)],width:s[n(590)],height:s[n(230)]},putRange:this[n(834)],replacedImage:void 0,blend:!1}),this[n(834)]})),this[t(881)][t(825)](),this._layer}[s(1180)](){const t=s;return{id:t(362),operationName:this[t(1090)],layerId:this[t(264)].id,tempLayerId:this._tempLayer.id,destRange:this._destRange,replacedRange:this._replacedRange,replacedImage:(0,n.t)(this[t(266)])}}static[s(1239)](t,e,i){const r=s,h=t[r(184)](i[r(1072)]),a=t[r(935)](i[r(1079)]);return new o(i[r(1090)],e,i[r(223)],i[r(268)],h,a,(0,n.e)(i[r(354)]))}}},3817:(t,e,i)=>{"use strict";const s=a2_0x41cc;i.d(e,{O:()=>r});class r{constructor(t,e,i){const s=a2_0x41cc;this[s(1090)]=t,this._layer=e,this._tempLayer=i,this[s(1404)]=s(464),this.requiresTool=s(567),this.pixelCount=0}async[s(799)](){const t=s;if(0===this[t(881)][t(667)][t(589)])throw new Error(t(508));const e=this[t(881)].stepState[this[t(881)][t(667)][t(589)]-1];return this[t(561)](this[t(881)][t(853)],e),await this[t(264)][t(259)](this[t(881)],!1),this._tempLayer.triggerHistoryAction(),this[t(264)]}async redo(){const t=s;return this[t(264)][t(807)]=void 0,this[t(881)][t(825)](),this[t(264)]}[s(561)](t,e){Object[s(1106)](t,e)}serialize(){const t=s;return{id:t(1476),operationName:this[t(1090)],layerId:this[t(264)].id,tempLayerId:this[t(881)].id}}static[s(1239)](t,e){const i=s,n=t[i(184)](e[i(1072)]),o=t[i(935)](e.tempLayerId);return new r(e[i(1090)],n,o)}}},6785:(t,e,i)=>{"use strict";const s=a2_0x41cc;i.d(e,{x:()=>n});var r=i(7605);class n{constructor(t,e,i,s,r){const n=a2_0x41cc;this[n(1090)]=t,this[n(264)]=e,this[n(344)]=i,this._undoData=s,this[n(479)]=r,this.type="singleLayer",this.pixelCount=this._undoData[n(518)].length}undo(){const t=a2_0x41cc;return o(this[t(264)],this._range,this[t(1172)]),this[t(264)]}[s(240)](){const t=s;return o(this[t(264)],this[t(344)],this._redoData),this[t(264)]}[s(1180)](){const t=s;return{id:t(1241),operationName:this[t(1090)],layerId:this[t(264)].id,range:this[t(344)],undoData:(0,r.t)(this[t(1172)]),redoData:(0,r.t)(this[t(479)])}}static[s(1239)](t,e){const i=s,o=t.getLayerById(e.layerId);return new n(e.operationName,o,e.range,(0,r.e)(e[i(693)]),(0,r.e)(e[i(1237)]))}}function o(t,e,i){const r=s;t[r(201)]((t=>{const s=r;let n=0;for(let e=0;e<i[s(518)][s(589)];e++)n=i[s(518)][e],t[n]=i[s(1156)][4*e],t[n+1]=i[s(1156)][4*e+1],t[n+2]=i[s(1156)][4*e+2],t[n+3]=i[s(1156)][4*e+3];return e}))}},4378:(t,e,i)=>{"use strict";const s=a2_0x41cc;i.d(e,{$:()=>n});var r=i(1003);class n{constructor(t,e,i,s,n){const o=a2_0x41cc;this.operationName=t,this[o(1231)]=e,this[o(264)]=i,this._undoData=s,this._redoData=n,this[o(1404)]=o(464),this[o(506)]=(0,r.U6)(this[o(1231)])}async[s(799)](){const t=s;return await this[t(561)](this[t(1172)]),this[t(264)]}async[s(240)](){const t=s;return await this._apply(this[t(479)]),this._layer}async[s(561)](t){const e=s,i=this.range[e(459)]-this.range[e(1171)],r=this[e(1231)][e(890)]-this[e(1231)][e(1375)],n=4*r;let o=0,h=0,a=0;await this[e(264)].edit(((s,c)=>{const l=e;for(let e=0;e<i;e++)h=e+this[l(1231)][l(1171)],o=4*(h*c+this[l(1231)][l(1375)]),a=e*r*4,s[l(766)](t.subarray(a,a+n),o);return this[l(1231)]}))}[s(1180)](){const t=s;return{id:"layerRange",operationName:this.operationName,layerId:this._layer.id,range:this[t(1231)],undoData:Array[t(536)](this._undoData),redoData:Array[t(536)](this[t(479)])}}static create(t,e){const i=s,r=t[i(184)](e[i(1072)]);return new n(e[i(1090)],e[i(1231)],r,new Uint8Array(e[i(693)]),new Uint8Array(e[i(1237)]))}}},1375:(t,e,i)=>{"use strict";const s=a2_0x41cc;i.d(e,{C:()=>r});class r{constructor(t,e,i,s,r){const n=a2_0x41cc;this[n(1090)]=t,this[n(1233)]=e,this[n(965)]=i,this[n(264)]=s,this[n(881)]=r,this[n(1404)]="singleLayer",this[n(1209)]=n(1197),this.pixelCount=this[n(881)][n(366)].image[n(1249)][n(590)]*this[n(881)][n(366)][n(339)][n(1249)][n(230)]}getRange(){const t=a2_0x41cc;return{left:this[t(881)][t(271)].offsetX,top:this._tempLayer[t(271)].offsetY,right:this._tempLayer[t(271)][t(665)]+this[t(881)][t(366)][t(339)][t(1249)].width,bottom:this[t(881)].initialState[t(839)]+this[t(881)][t(366)][t(339)][t(1249)].height}}async undo(){const t=a2_0x41cc;return this[t(881)][t(667)][t(1533)](),this[t(881)][t(853)][t(665)]=this[t(881)][t(271)][t(665)],this[t(881)][t(853)][t(839)]=this[t(881)][t(271)][t(839)],this[t(264)][t(807)]=void 0,await this[t(264)][t(201)]((async(e,i,s)=>{const r=t,n=await this._tempLayer[r(366)][r(339)][r(163)],o=this.getRange();return await this._taskWorkerService[r(584)](r(1002),{targetImage:{data:e,width:i,height:s},putImage:{data:n.data,width:n[r(590)],height:n[r(230)]},putRange:o,replacedImage:void 0,blend:!1}),o})),this._tempLayer[t(825)](),this[t(264)]}async redo(){const t=a2_0x41cc;return this[t(881)][t(667)][t(1463)](this[t(965)]),this._tempLayer.currentState[t(665)]=this._stepState[t(665)],this[t(881)][t(853)][t(839)]=this[t(965)][t(839)],this[t(264)].temporaryLayer=this._tempLayer,await this._layer.edit((async(e,i,s)=>{const r=t,n=this[r(205)]();return await this._taskWorkerService.runTask(r(326),{targetImage:{data:e,width:i,height:s},range:n}),n})),this[t(881)].triggerHistoryAction(),this[t(264)]}[s(1180)](){const t=s;return{id:t(639),operationName:this[t(1090)],layerId:this[t(264)].id,tempLayerId:this._tempLayer.id,stepState:this[t(965)]}}static[s(1239)](t,e,i){const n=s,o=t.getLayerById(i.layerId),h=t[n(935)](i[n(1079)]);return new r(i[n(1090)],e,i[n(667)],o,h)}}},3491:(t,e,i)=>{"use strict";const s=a2_0x41cc;i.d(e,{w:()=>h});var r=i(1815),n=i(5120);let o=-1;class h extends n.JT{constructor(t){const e=a2_0x41cc;var i;super(),this._onCommit=this[e(1076)](new r.v),this[e(629)]=this[e(889)][e(1349)],this._onRequestRender=this[e(1076)](new r.v),this.onRequestRender=this[e(1334)][e(1349)],this._onHistoryUnset=this[e(1076)](new r.v),this[e(356)]=this[e(599)][e(1349)],this[e(1246)]=this[e(1076)](new r.v),this[e(1114)]=this._onHistoryAction.event,t?(this.id=t,i=t,o=Math.max(o,i)):this.id=++o}triggerRequestRender(){const t=a2_0x41cc;this[t(1334)][t(617)]()}triggerHistoryAction(){this._onHistoryAction.fire()}[s(825)](){this[s(599)].fire()}}},270:(t,e,i)=>{"use strict";const s=a2_0x41cc;i.d(e,{m:()=>a});var r=i(6628),n=i(4375),o=i(1375),h=i(3491);class a extends h.w{constructor(t,e,i,r,n,o,h,a,c){const l=a2_0x41cc;var d;super(h),this[l(191)]=t,this[l(391)]=n,this[l(1233)]=o,this[l(1404)]=l(1038),this[l(1102)]=l(196),this[l(271)]=a||{offsetX:i[l(1375)],offsetY:i[l(1171)],scaledWidth:i[l(890)]-i[l(1375)],scaledHeight:i[l(459)]-i[l(1171)],quality:r||l(959)},this[l(667)]=c||[],this.currentState={...c?.[l(589)]?c[c[l(589)]-1]:this[l(271)]},this[l(1114)]((()=>this[l(1462)]())),l(163)in e?(this[l(366)]={image:e,range:i},e[l(163)][l(739)]((()=>this[l(1334)][l(617)]()))):this[l(366)]={image:(d=e,{resource:d,readyPromise:Promise[s(741)](d),isReady:!0}),range:i}}get data(){const t=a2_0x41cc;return this[t(366)][t(339)][t(1249)][t(1525)]}get[s(590)](){const t=s;return this.staticState[t(339)][t(1249)][t(590)]}get height(){return this[s(366)].image.resource.height}[s(1149)](t){const e=s;this.currentState[e(665)]===t[e(1375)]&&this[e(853)][e(839)]===t[e(1171)]&&this[e(853)].scaledWidth===t[e(890)]-t[e(1375)]&&this[e(853)][e(454)]===t[e(459)]-t.top||(this.currentState[e(665)]=t[e(1375)],this[e(853)][e(839)]=t[e(1171)],this[e(853)].scaledWidth=t[e(890)]-t.left,this.currentState.scaledHeight=t[e(459)]-t[e(1171)],this[e(1334)][e(617)]())}[s(1492)](){const t=s,e={...this[t(853)]};this.stepState[t(589)]>0?this[t(391)][t(1017)](new n.Y(t(394),e,this[t(191)],this)):this[t(391)].addEntry(new o.C("Move Selected Pixels",this[t(1233)],e,this._parentLayer,this)),this[t(1462)](),this.stepState[t(1463)](e),this[t(1334)].fire()}[s(892)](t){const e=s,i={...this[e(853)]};this[e(391)][e(1017)](new n.Y(t,i,this[e(191)],this)),this[e(1462)](),this[e(667)][e(1463)](i),this[e(1334)][e(617)]()}[s(1462)](){const t=s,e=this[t(1339)]?.[t(1249)][t(590)]||this[t(366)][t(339)][t(1249)][t(590)],i=this[t(1339)]?.[t(1249)][t(230)]||this[t(366)].image[t(1249)][t(230)];if(e===this[t(853)][t(424)]&&i===this[t(853)][t(454)]&&this[t(979)]===this[t(853)].quality)return;if(this[t(979)]=this[t(853)][t(1066)],this[t(853)][t(424)]===this[t(366)][t(339)][t(1249)].width&&this[t(853)].scaledHeight===this[t(366)][t(339)].resource[t(230)])return this[t(1339)]=this[t(366)][t(339)],void this[t(1334)][t(617)]();let r;const n=new Promise((t=>r=t)),o={width:this[t(853)].scaledWidth,height:this[t(853)][t(454)],data:new Uint8Array(0)};this.scaledImage={isReady:!1,readyPromise:n,resource:o},this[t(366)][t(339)].readyPromise[t(739)]((async e=>{const i=t,s=await this[i(1233)][i(1259)]("layer/resize",{width:this[i(853)][i(424)],height:this[i(853)][i(454)],resampling:this[i(853)][i(1066)]},e,void 0)[i(886)];o[i(1525)]=s[i(1322)][i(1525)],this[i(1339)]&&(this.scaledImage[i(978)]=!0),r(o),this._onRequestRender[i(617)]()}))}async[s(878)](){const t=s,e=await(this[t(1339)]?.[t(163)]||this[t(366)][t(339)][t(163)]),i=Math[t(1487)](this[t(853)][t(665)],0),n=Math[t(1487)](this[t(853)].offsetY,0),o=Math[t(1321)](this[t(853)].offsetX+this[t(853)][t(424)],this[t(191)][t(590)]),h=Math[t(1321)](this[t(853)][t(839)]+this[t(853)].scaledHeight,this._parentLayer[t(230)]),a=o-i,c=h-n,l={width:a,height:c,data:new Uint8Array(new SharedArrayBuffer(a*c*4))},d={left:this.currentState.offsetX,top:this[t(853)][t(839)],right:this[t(853)][t(665)]+this[t(853)][t(424)],bottom:this[t(853)][t(839)]+this[t(853)][t(454)]};await this[t(191)][t(201)]((async(i,s,r)=>{const n=t;return await this._taskWorkerService.runTask(n(1002),{putRange:d,targetImage:{data:i,width:s,height:r},putImage:e,replacedImage:l,blend:!1}),d})),this._historyService[t(1017)](new r.$(t(621),this[t(1233)],d,{left:i,top:n,right:o,bottom:h},this[t(191)],this,l)),this[t(889)][t(617)]()}[s(566)](t){const e=s;if(this[e(590)]*this[e(230)]>t)return"Moving layer exceeded maximum pixel count allowed ("+this[e(590)]*this[e(230)]+" > "+t+")"}serialize(){const t=s;return{id:this.id,parentLayerId:this._parentLayer.id,type:t(1038),staticState:c(this[t(366)]),initialState:this[t(271)],currentState:this[t(853)],stepState:this[t(667)]}}static[s(1239)](t,e,i,r){const n=s,o=t[n(366)],h={data:new Uint8Array(o[n(1525)]),width:o[n(1231)][n(890)]-o[n(1231)][n(1375)],height:o[n(1231)][n(459)]-o.range.top};return new a(e,h,o[n(1231)],void 0,i,r,t.id,t.initialState,t[n(667)])}}function c(t){const e=s;return{data:Array[e(536)](t[e(339)][e(1249)].data),range:t.range}}},807:(t,e,i)=>{"use strict";const s=a2_0x41cc;i.d(e,{F:()=>d});var r=i(7517),n=i(1003),o=i(6495),h=i(5901),a=i(1405),c=i(3817),l=i(3491);class d extends l.w{constructor(t,e,i,s,r,n,o=[]){const h=a2_0x41cc;super(n),this._parentLayer=t,this.staticState=e,this.initialState=i,this[h(391)]=s,this[h(1233)]=r,this[h(667)]=o,this[h(1404)]=h(567),this[h(853)]=u(o[h(589)]?o[o.length-1]:this.initialState)}[s(773)](t,e=!1){const i=s,r=u(this.currentState);if(this.stepState[i(589)]>0){let s=!1;if(e){const e=this._historyService[i(939)][this[i(391)].entries.length-1];e.operationName===t&&(e[i(667)]=r,this[i(667)][this.stepState[i(589)]-1]=r,s=!0)}!s&&(this[i(391)][i(1017)](new h.X(t,r,this._parentLayer,this)),this[i(667)][i(1463)](r))}else this._historyService[i(1017)](new a.D(i(180),r,this[i(191)],this)),this[i(667)][i(1463)](r);this[i(1334)][i(617)]()}async commit(t){const e=s,i=this[e(853)].blendMode,r=this[e(853)][e(1231)];await this[e(391)][e(719)](e(1086),(async()=>{const s=e;this[s(391)].addEntry(new c.O(s(1086),this[s(191)],this)),await this[s(391)][s(1271)](new o.Z(s(1365),r,this[s(191)],(async(e,n,o)=>{const h=s,a=this.getRanges(t);if((r[h(459)]-r[h(1171)])*(r[h(890)]-r[h(1375)])>25e4){const t=[];for(const s of a)for(const r of s.ranges)t[h(1463)](this[h(1233)][h(584)]("blendColorAtRange",{targetImage:{data:e,width:n,height:o},range:r,color:new Uint8Array(s[h(177)]),blendMode:i}));await Promise.all(t)}else for(const t of a)for(const s of t.ranges)this[h(1166)](e,n,s,t[h(177)],i)})))})),this[e(889)].fire()}[s(1166)](t,e,i,n,o){const h=s;let a=0;for(let s=i[h(1171)];s<i[h(459)];s++)for(let c=i[h(1375)];c<i[h(890)];c++)a=4*(s*e+c),"replace"===o?(t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2],t[a+3]=n[3]):(0,r.B)(o,t,a,n,0)}getRanges(t){const e=s,i=[],r=this[e(853)],o=this[e(366)][e(1248)]?r.secondaryColor:r[e(1190)],h=this.staticState[e(1248)]?r.primaryColor:r[e(733)],a=2===r[e(341)]?o:h,c=2===r[e(341)]?h:o,l=t||(0,n.DI)(this[e(191)].width,this[e(191)][e(230)]),d=(0,n.l$)({left:r[e(1231)][e(1375)],right:r.range[e(890)],top:r[e(1231)][e(1171)],bottom:Math[e(1321)](r.range.top+r[e(633)],r.range[e(459)])},l),u=(0,n.l$)({left:r[e(1231)].left,right:r[e(1231)][e(890)],top:Math[e(1487)](d[e(459)],r[e(1231)][e(459)]-r[e(633)]),bottom:r[e(1231)].bottom},l),f=(0,n.l$)({left:r[e(1231)].left,right:r[e(1231)][e(1375)]+r[e(633)],top:d.bottom,bottom:u[e(1171)]},l),m=(0,n.l$)({left:Math[e(1487)](f[e(890)],r.range[e(890)]-r[e(633)]),right:r[e(1231)][e(890)],top:d[e(459)],bottom:u[e(1171)]},l);return 2!==r.style&&i[e(1463)]({ranges:[d,u,f,m],color:c}),3===r[e(341)]?i.push({ranges:[{left:f[e(890)],right:m[e(1375)],top:d.bottom,bottom:u[e(1171)]}],color:a}):2===r[e(341)]&&i[e(1463)]({ranges:[{left:f[e(1375)],right:m[e(890)],top:d.top,bottom:u.bottom}],color:a}),i}[s(1180)](){const t=s;return{id:this.id,parentLayerId:this._parentLayer.id,type:t(567),staticState:this[t(366)],initialState:f(this[t(271)]),currentState:f(this[t(853)]),stepState:this[t(667)][t(542)]((t=>f(t)))}}static create(t,e,i,r){const n=s;return new d(e,t[n(366)],m(t.initialState),i,r,t.id,t[n(667)][n(542)]((t=>m(t))))}}function u(t){const e=s;return{primaryColor:t[e(1190)],secondaryColor:t[e(733)],blendMode:t[e(1102)],range:(0,n.BN)(t.range),outlineSize:t[e(633)],style:t[e(341)]}}function f(t){const e=s;return{primaryColor:Array[e(536)](t[e(1190)]),secondaryColor:Array[e(536)](t.secondaryColor),blendMode:t[e(1102)],range:(0,n.BN)(t[e(1231)]),outlineSize:t[e(633)],style:t.style}}function m(t){const e=s;return{primaryColor:new Float32Array(t[e(1190)]),secondaryColor:new Float32Array(t[e(733)]),blendMode:t[e(1102)],range:(0,n.BN)(t[e(1231)]),outlineSize:t[e(633)],style:t[e(341)]}}},1038:(t,e,i)=>{const s=a2_0x41cc;var r={"./tools/colorPicker.js":[6471,471],"./tools/eraser.js":[2996,996],"./tools/fill.js":[7643,643],"./tools/movePixels.js":[6765,765],"./tools/moveSelection.js":[403,403],"./tools/pencil.js":[3518,518],"./tools/rectangle.js":[7891,891],"./tools/selection.js":[3040,40],"./tools/zoom.js":[7710,710]};function n(t){const e=a2_0x41cc;if(!i.o(r,t))return Promise[e(741)]()[e(739)]((()=>{const i=e;var s=new Error(i(484)+t+"'");throw s[i(1474)]="MODULE_NOT_FOUND",s}));var s=r[t],n=s[0];return i.e(s[1])[e(739)]((()=>i(n)))}n[s(1285)]=()=>Object[s(1285)](r),n.id=1038,t[s(1151)]=n},4371:(t,e,i)=>{"use strict";const s=a2_0x41cc;function r(t,e=2*t[s(589)]){const i=s;let r;if(t instanceof Float32Array)r=new Float32Array(e);else if(t instanceof Uint8Array)r=new Uint8Array(e);else if(t instanceof Uint16Array)r=new Uint16Array(e);else{if(!(t instanceof Uint32Array))throw new Error(i(900));r=new Uint32Array(e)}return r[i(766)](t),r}function n(t,e,i=!1){const r=s;return e<Math[r(582)](2,8)?i?new Uint8Array(new SharedArrayBuffer(t)):new Uint8Array(t):e<Math[r(582)](2,16)?i?new Uint16Array(new SharedArrayBuffer(2*t)):new Uint16Array(t):i?new Uint32Array(new SharedArrayBuffer(4*t)):new Uint32Array(t)}i.d(e,{R:()=>r,X:()=>n})},7517:(t,e,i)=>{"use strict";const s=a2_0x41cc;i.d(e,{B:()=>h});const r=new Float32Array(6);let n;const o={normal:(t,e)=>e,darken:(t,e)=>Math[s(1321)](t,e),multiply:(t,e)=>t*e,linearBurn:(t,e)=>Math[s(1487)](t+e-1,0),lighten:(t,e)=>Math.max(t,e),screen:(t,e)=>1-(1-t)*(1-e),linearDodgeAdd:(t,e)=>Math[s(1321)](t+e,1),overlay:(t,e)=>t<.5?2*t*e:1-2*(1-t)*(1-e),softLight:(t,e)=>e<.5?2*t*e+t*t*(1-2*e):Math[s(843)](t)*(2*e-1)+2*t*(1-e),difference:(t,e)=>Math[s(556)](t-e),exclusion:(t,e)=>t+e-2*t*e};function h(t,e,i,h,c,l=e,d=i){const u=s;return r[0]=h[c+3]/255,0===r[0]?(e[i]=l[d],e[i+1]=l[d+1],e[i+2]=l[d+2],void(e[i+3]=l[d+3])):(r[1]=l[d+3]/255,0===r[1]?(e[i]=h[c],e[i+1]=h[c+1],e[i+2]=h[c+2],void(e[i+3]=h[c+3])):(n=o[t],r[3]=n(l[d]/255,h[c]/255),r[4]=n(l[d+1]/255,h[c+1]/255),r[5]=n(l[d+2]/255,h[c+2]/255),r[2]=r[0]+r[1]*(1-r[0]),e[i]=Math[u(710)](a(l[d]/255,r[1],h[c]/255,r[0],r[3])/r[2]*255),e[i+1]=Math[u(710)](a(l[d+1]/255,r[1],h[c+1]/255,r[0],r[4])/r[2]*255),e[i+2]=Math[u(710)](a(l[d+2]/255,r[1],h[c+2]/255,r[0],r[5])/r[2]*255),void(e[i+3]=Math[u(710)](255*r[2]))))}function a(t,e,i,s,r){return(e-e*s)*t+(s-e*s)*i+e*s*r}},6374:(t,e,i)=>{"use strict";function s(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}i.d(e,{W:()=>s})},1815:(t,e,i)=>{"use strict";const s=a2_0x41cc;i.d(e,{v:()=>r,B:()=>n});class r{constructor(t){const e=a2_0x41cc;this._options=t,this[e(371)]=[],this[e(1214)]=!1}get[s(1349)](){const t=s;return!this[t(873)]&&(this._event=e=>{const i=t;return 0===this._listeners[i(589)]&&this._options?.[i(164)]&&this[i(539)][i(164)](),this._listeners[i(1463)](e),{dispose:()=>{const t=i;if(!this[t(1214)])for(let i=0;i<this[t(371)][t(589)];i++)if(this._listeners[i]===e)return this[t(371)][t(1526)](i,1),void(0===this[t(371)][t(589)]&&this._options?.[t(1478)]&&this[t(539)][t(1478)]())}}}),this[t(873)]}[s(617)](t,e){const i=s,r=[];for(let t=0;t<this[i(371)][i(589)];t++)r[i(1463)](this._listeners[t]);for(let s=0;s<r[i(589)];s++)r[s].call(void 0,t,e)}async[s(1428)](t,e){const i=s,r=[];for(let t=0;t<this._listeners.length;t++)r[i(1463)](this[i(371)][t]);for(let s=0;s<r[i(589)];s++)await r[s].call(void 0,t,e)}[s(1424)](){const t=s;this[t(371)]&&(this[t(371)][t(589)]=0),this[t(1214)]=!0}}function n(t,e){const i=s;return t(((t,s)=>e[i(617)](t,s)))}},7166:(t,e,i)=>{"use strict";function s(t,e){const i=a2_0x41cc,s=typeof t===i(1030)?t:t.width;return e=typeof t===i(1030)?e:t[i(230)],{data:new Uint8Array(new(i(1280)in window?SharedArrayBuffer:ArrayBuffer)(s*e*4)),width:s,height:e}}function r(t,e){const i=a2_0x41cc,s=e[i(459)]-e[i(1171)],r=e.right-e[i(1375)],n=new Uint8Array(r*s*4);let o=0,h=0;for(let a=0;a<s;a++)h=a+e[i(1171)],o=4*(h*t.width+e.left),n[i(766)](t.data[i(524)](o,o+4*r),a*r*4);return n}function n(t,e,i,s,r=!0){const n=a2_0x41cc;if(!r&&e<s&&t<i)return{left:Math.round((i-t)/2),top:Math.round((s-e)/2),width:t,height:e};const o={left:0,top:0,width:i,height:s};if(e>t){const s=t/e;o[n(1375)]=Math.round(i*(.5-s/2)),o[n(590)]=Math[n(710)](i*s)}else if(t>e){const i=e/t;o.top=Math[n(710)](s*(.5-i/2)),o.height=Math[n(710)](s*i)}return o}i.d(e,{uF:()=>s,Qf:()=>r,M_:()=>n})},5120:(t,e,i)=>{"use strict";const s=a2_0x41cc;i.d(e,{JT:()=>n,_c:()=>o,Lw:()=>h});var r=i(1815);class n{constructor(){const t=a2_0x41cc;this[t(286)]=[],this[t(1274)]=!1,this[t(1475)]=this.register(new r.v),this[t(534)]=this[t(1475)][t(1349)]}[s(1424)](){const t=s;if(this._isDisposed)throw new Error("Attempt to dispose a disposed entity");this._onDispose[t(617)](),this._isDisposed=!0;for(const e of this._disposables)e[t(1424)]();this[t(286)][t(589)]=0}register(t){const e=s;return this[e(286)][e(1463)](t),t}[s(1050)](t){const e=s,i=this[e(286)][e(215)](t);-1!==i&&this[e(286)][e(1526)](i,1)}}function o(t){const e=s;for(const i of t)i[e(1424)]();t[e(589)]=0}function h(t,e,i,r){const n=s;t[n(664)](e,i);let o=!1;return{dispose:()=>{o||(o=!0,t[n(217)](e,i,r))}}}},2939:(t,e,i)=>{"use strict";function s(t,e,i=0){const s=a2_0x41cc;return Math[s(1321)](Math[s(1487)](t,i),e)}i.d(e,{u:()=>s})},1003:(t,e,i)=>{"use strict";function s(t){const e=a2_0x41cc;if(t)return{left:t.left,top:t[e(1171)],right:t[e(890)],bottom:t[e(459)]}}function r(){return{left:-1,top:-1,right:-1,bottom:-1}}function n(t,e){return{left:t,top:e,right:t+1,bottom:e+1}}function o(t,e){return{left:0,top:0,right:t,bottom:e}}function h(t,e,i,s){const r=a2_0x41cc,n=_({left:t,top:e,right:i,bottom:s});return n[r(890)]++,n[r(459)]++,n}function a(t,e){const i=a2_0x41cc;return c(t)?s(e):c(e)?s(t):{left:Math[i(1321)](t[i(1375)],e[i(1375)]),top:Math[i(1321)](t[i(1171)],e[i(1171)]),right:Math[i(1487)](t[i(890)],e.right),bottom:Math.max(t.bottom,e[i(459)])}}function c(t){const e=a2_0x41cc;return t.left===t[e(890)]||t[e(1171)]===t[e(459)]}function l(t,e){const i=a2_0x41cc;return t[i(1375)]=Math[i(1321)](Math[i(1487)](t.left,e[i(1375)]),e.right),t[i(1171)]=Math[i(1321)](Math[i(1487)](t[i(1171)],e[i(1171)]),e[i(459)]),t.right=Math[i(1487)](Math.min(t.right,e[i(890)]),e.left),t[i(459)]=Math.max(Math[i(1321)](t[i(459)],e[i(459)]),e[i(1171)]),t}function d(t,e,i){const s=a2_0x41cc,r=e-t[s(1375)],n=i-t[s(1171)];t[s(1375)]=t[s(1375)]+r,t[s(890)]=t[s(890)]+r,t[s(1171)]=t[s(1171)]+n,t[s(459)]=t[s(459)]+n}function u(t,e,i){const s=a2_0x41cc;if(c(t))return t.left=e,t[s(890)]=e+1,t.top=i,void(t[s(459)]=i+1);t.left=Math[s(1321)](t[s(1375)],e),t[s(1171)]=Math.min(t[s(1171)],i),t[s(890)]=Math[s(1487)](t.right,e+1),t.bottom=Math[s(1487)](t[s(459)],i+1)}function f(t,e,i){const s=a2_0x41cc;return e>=t[s(1375)]&&e<t[s(890)]&&i>=t.top&&i<t[s(459)]}function m(t,e){const i=a2_0x41cc;return e.left>=t.left&&e[i(890)]<=t.right&&e.top>=t[i(1171)]&&e[i(459)]<=t[i(459)]}function g(t,e){const i=a2_0x41cc;return!(t[i(459)]<e.top||t[i(1171)]>e[i(459)]||t[i(890)]<e.left||t.left>e[i(890)])}function _(t){const e=a2_0x41cc;if(t[e(1375)]>t.right){const i=t[e(890)];t[e(890)]=t[e(1375)],t[e(1375)]=i}if(t[e(1171)]>t[e(459)]){const i=t[e(459)];t[e(459)]=t[e(1171)],t[e(1171)]=i}if(t[e(890)]<t[e(1375)]){const i=t[e(1375)];t[e(1375)]=t.right,t[e(890)]=i}if(t.bottom<t[e(1171)]){const i=t.top;t[e(1171)]=t[e(459)],t[e(459)]=i}return t}function p(t){const e=a2_0x41cc;return(t[e(890)]-t[e(1375)])*(t[e(459)]-t[e(1171)])}i.d(e,{BN:()=>s,Pq:()=>r,Re:()=>n,DI:()=>o,tH:()=>h,qi:()=>a,Bu:()=>c,l$:()=>l,Hd:()=>d,Hv:()=>u,RB:()=>f,ur:()=>m,b8:()=>g,FJ:()=>_,U6:()=>p})},7605:(t,e,i)=>{"use strict";function s(t){const e=a2_0x41cc,i={};for(const s of Object[e(1285)](t)){const r=t[s];typeof r===e(477)?r instanceof Uint8Array?i[s]=n(r,"Uint8Array"):r instanceof Uint16Array?i[s]=n(r,e(717)):r instanceof Uint32Array?i[s]=n(r,e(1317)):i[s]=r:i[s]=r}return i}function r(t){const e=a2_0x41cc,i={};for(const s of Object.keys(t)){const r=t[s];typeof r===e(477)&&"dataType"in r?i[s]=o(r):i[s]=r}return i}function n(t,e){return{dataType:e,data:Array[a2_0x41cc(536)](t)}}function o(t){const e=a2_0x41cc;return new(window[t[e(1522)]])(t[e(1525)])}i.d(e,{t:()=>s,e:()=>r})}},e={};function i(s){const r=a2_0x41cc;if(e[s])return e[s][r(1151)];var n=e[s]={exports:{}};return t[s](n,n[r(1151)],i),n[r(1151)]}i.m=t,i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{const s=a2_0x41cc;for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object[s(1262)](t,r,{enumerable:!0,get:e[r]})},i.f={},i.e=t=>{const e=a2_0x41cc;return Promise[e(446)](Object.keys(i.f)[e(970)](((e,s)=>(i.f[s](t,e),e)),[]))},i.u=t=>""+t+a2_0x41cc(317),(()=>{const t=a2_0x41cc;i[t(463)]=e=>{const i=t;return""+(122===e?i(1374):e)+i(1507)}})(),i.g=function(){const t=a2_0x41cc;if(typeof globalThis===t(477))return globalThis;try{return this||new Function(t(1055))()}catch(e){if(typeof window===t(477))return window}}(),(()=>{const t=a2_0x41cc;i.o=(e,i)=>Object[t(879)][t(1506)][t(206)](e,i)})(),(()=>{const t=a2_0x41cc;var e={},s=t(229);i.l=(r,n,o)=>{const h=t;if(e[r])e[r][h(1463)](n);else{var a,c;if(void 0!==o)for(var l=document.getElementsByTagName("script"),d=0;d<l[h(589)];d++){var u=l[d];if(u[h(1034)](h(750))==r||u[h(1034)]("data-webpack")==s+o){a=u;break}}!a&&(c=!0,(a=document[h(1067)](h(1440))).charset=h(1358),a.timeout=120,i.nc&&a.setAttribute(h(753),i.nc),a[h(659)](h(1453),s+o),a.src=r),e[r]=[n];var f=(t,i)=>{const s=h;a.onerror=a[s(1465)]=null,clearTimeout(m);var n=e[r];if(delete e[r],a[s(303)]&&a.parentNode[s(507)](a),n&&n.forEach((t=>t(i))),t)return t(i)},m=setTimeout(f[h(1356)](null,void 0,{type:"timeout",target:a}),12e4);a.onerror=f.bind(null,a[h(623)]),a[h(1465)]=f.bind(null,a[h(1465)]),c&&document[h(885)].appendChild(a)}}})(),i.r=t=>{const e=a2_0x41cc;typeof Symbol!==e(1470)&&Symbol.toStringTag&&Object.defineProperty(t,Symbol[e(1420)],{value:e(794)}),Object.defineProperty(t,e(869),{value:!0})},(()=>{const t=a2_0x41cc;var e;i.g[t(631)]&&(e=i.g.location+"");var s=i.g[t(658)];if(!e&&s&&(s[t(1324)]&&(e=s.currentScript[t(750)]),!e)){var r=s[t(1089)](t(1440));r.length&&(e=r[r[t(589)]-1].src)}if(!e)throw new Error(t(543));e=e[t(196)](/#.*$/,"")[t(196)](/\?.*$/,"")[t(196)](/\/[^\/]+$/,"/"),i.p=e})(),(()=>{const t=a2_0x41cc;var e={122:0};i.f.j=(t,s)=>{const r=a2_0x41cc;var n=i.o(e,t)?e[t]:void 0;if(0!==n)if(n)s[r(1463)](n[2]);else{var o=new Promise(((i,s)=>{n=e[t]=[i,s]}));s[r(1463)](n[2]=o);var h=i.p+i.u(t),a=new Error;i.l(h,(s=>{const o=r;if(i.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var h=s&&(s[o(1404)]===o(357)?o(1509):s[o(1404)]),c=s&&s.target&&s.target[o(750)];a[o(661)]=o(1326)+t+o(301)+h+": "+c+")",a[o(395)]=o(333),a[o(1404)]=h,a[o(1414)]=c,n[1](a)}}),r(920)+t)}};var s=(t,s)=>{const r=a2_0x41cc;for(var n,o,[h,a,c]=s,l=0,d=[];l<h.length;l++)o=h[l],i.o(e,o)&&e[o]&&d[r(1463)](e[o][0]),e[o]=0;for(n in a)i.o(a,n)&&(i.m[n]=a[n]);for(c&&c(i),t&&t(s);d[r(589)];)d[r(405)]()()},r=self[t(379)]=self[t(379)]||[];r[t(281)](s.bind(null,0)),r[t(1463)]=s[t(1356)](null,r[t(1463)][t(1356)](r))})(),(()=>{"use strict";const t=a2_0x41cc;var e=i(5120),s=i(1003),r=i(1815);class n extends e.JT{constructor(){const t=a2_0x41cc;super(...arguments),this[t(829)]=this[t(1076)](new r.v),this[t(1304)]=this[t(829)].event}[t(239)](e){const i=t;this[i(835)]=e,this[i(829)][i(617)](this[i(835)])}}class o{constructor(){const e=t;this.type=e(1146),this[e(1090)]=e(907),this[e(506)]=0}[t(1180)](){return{id:t(421)}}static[t(1239)](t){return new o}}class h extends e.JT{constructor(){const e=t;super(),this._entries=[],this[e(514)]=-1,this[e(844)]=new Map,this[e(922)]=new Map,this[e(830)]=this[e(1076)](new r.v),this[e(431)]=this[e(830)][e(1349)],this[e(1307)]=this.register(new r.v),this[e(687)]=this[e(1307)].event,this[e(320)]=this.register(new r.v),this[e(772)]=this[e(320)][e(1349)],this[e(638)]=this[e(1076)](new r.v),this[e(940)]=this[e(638)].event,this[e(397)](e(1127),{undo:t=>t[e(799)](),redo:t=>t[e(240)]()}),this[e(576)](e(540),(t=>this._restoreCompositeEntry(t))),this[e(576)]("unknown",o[e(1239)])}get[t(1333)](){const e=t;return this[e(235)][this[e(514)]]}get entries(){return this[t(235)]}get canUndo(){const e=t;return this[e(235)][e(589)]>1&&0!==this[e(514)]}get canRedo(){const e=t;return this._entries.length>1&&this._currentEntryPointer!==this[e(235)][e(589)]-1}[t(1017)](e,i){const s=t;if(this[s(1433)]){if(e.type===s(540))throw new Error("Cannot add composite entry to composite entry");if(e[s(1404)]===s(1146))throw new Error("Cannot add readonly entry to composite entry");this[s(1433)][s(1463)](e)}else this[s(235)][++this._currentEntryPointer]=e,this[s(235)].length=this[s(514)]+1,!i&&this._onEntriesChange.fire(!0)}async runAction(e){const i=t,s=await e[i(365)]();s&&this[i(1017)](s)}[t(553)](e){const i=t,s=e[i(365)]();s&&this[i(1017)](s)}clearEntries(){const e=t;this[e(514)]=-1,this[e(235)].length=0,this[e(830)][e(617)](!0)}async[t(799)](){const e=t;if(-1===this[e(514)])throw new Error(e(973));const i=this._entries[this[e(514)]];if(i[e(1404)]===e(1146))throw new Error("Cannot undo readonly entry");if(this[e(514)]--,this._requestToolIfNeeded(i),i.type===e(540))for(const t of i.entries)await this[e(844)].get(t.type)[e(799)](t);else await this[e(844)].get(i[e(1404)])[e(799)](i);this[e(830)][e(617)](!1),this[e(1307)][e(617)](i)}async[t(240)](){const e=t;if(this._entries[e(589)]<=this[e(514)]+1)throw new Error("No redo entry");const i=this[e(235)][this._currentEntryPointer+1];if(i[e(1404)]===e(1146))throw new Error(e(1119));if(this[e(514)]++,this[e(190)](i),i[e(1404)]===e(540)){const t=i.entries;for(let i=t[e(589)]-1;i>=0;i--)await this[e(844)][e(1006)](t[i][e(1404)])[e(240)](t[i])}else await this._entryHandlers.get(i[e(1404)]).redo(i);this[e(830)][e(617)](!1),this[e(320)][e(617)](i)}async[t(719)](e,i){const s=t;if(this[s(1433)])return void await i();this[s(1433)]=[],await i();const r=this[s(1433)];this._currentCompositeEntry=void 0;const n=r.reduce(((t,e)=>e.pixelCount>t?e[s(506)]:t),0),o={type:"composite",operationName:e,entries:r,pixelCount:n,serialize:()=>this[s(253)](o)};this[s(1017)](o)}[t(397)](e,i){const s=t;if(this._entryHandlers[s(1006)](e))throw new Error(s(1183)+e+s(705));this[s(844)].set(e,i)}registerHistoryEntryFactory(e,i){const s=t;if(this._entryFactories[s(1006)](e))throw new Error(s(784)+e+" has already been registered");this[s(922)][s(766)](e,i)}[t(1180)](e=0){const i=t;try{for(const t of this[i(235)])if(t.pixelCount>e)throw new Error(i(488)+t.operationName+i(577)+t[i(506)]+i(407)+e+")");const t=[];for(const e of this[i(235)]){if(!e.serialize)throw new Error(i(671));t.push(e.serialize())}return{currentEntry:this[i(514)],entries:t}}catch(t){return console[i(1270)]("Failed to serialize history",t),{currentEntry:0,entries:[]}}}[t(1140)](e){const i=t;for(const t of e[i(939)])try{this.addEntry(this[i(1399)](t),!0)}catch{this[i(1017)](new o,!0)}this[i(514)]=Math.min(e[i(482)],this[i(235)].length-1),this[i(830)][i(617)](!1)}[t(1399)](e){const i=t;if(!e.id)throw new Error(i(712));const s=this[i(922)].get(e.id);if(!s)throw new Error(i(611)+e.id+'"');return s(e)}[t(253)](e){const i=t;return{id:i(540),operationName:e[i(1090)],entries:e[i(939)][i(542)]((t=>{const s=i;if(!t.serialize)throw console[s(483)]("Cannot serialize history entry",e),new Error(s(1e3));return t[s(1180)]()})),requiresTool:e[i(1209)]}}_restoreCompositeEntry(e){const i=t,s=[];for(const t of e[i(939)])s[i(1463)](this[i(1399)](t));const r=s[i(970)](((t,e)=>e.pixelCount>t?e[i(506)]:t),0);try{const t={type:"composite",operationName:e.operationName,entries:s,pixelCount:r,requiresTool:e[i(1209)],serialize:()=>this[i(253)](t)};return t}catch{return new o}}[t(190)](e){const i=t;if(e.type===i(540)){const t=e[i(939)];for(let e=t[i(589)]-1;e>=0;e--){const s=t[e];if(s.requiresTool)return void this[i(638)].fire(s[i(1209)])}}else e[i(1209)]&&this._onRequestTool[i(617)](e[i(1209)])}}var a=i(7517),c=i(2939);class l{constructor(e,i,s){const r=t;this.operationName=e,this[r(1443)]=i,this[r(257)]=s,this.type=r(1360),this[r(506)]=0}[t(799)](e){const i=t;d(this._targetIndex,this[i(1443)],e)}[t(240)](e){const i=t;d(this[i(1443)],this[i(257)],e)}serialize(){const e=t;return{id:"moveLayer",operationName:this[e(1090)],initialIndex:this[e(1443)],targetIndex:this[e(257)]}}static[t(1239)](e){const i=t;return new l(e[i(1090)],e[i(876)],e[i(731)])}}function d(e,i,s){const r=t;if(i>=s[r(347)].length)return!1;const n=s[r(347)][e];if(!n)return!1;for(s[r(280)]=e;i>s[r(280)];)s[r(347)][s[r(280)]]=s[r(347)][s.currentLayer+1],s.list[++s[r(280)]]=n;for(;i<s.currentLayer;)s.list[s.currentLayer]=s.list[s.currentLayer-1],s[r(347)][--s[r(280)]]=n;return s[r(444)][r(617)](),!0}class u{constructor(e,i,s){const r=t;this._operationName=e,this[r(257)]=i,this[r(1111)]=s}[t(365)](){const e=t;if(this._targetIndex===this[e(1111)][e(280)])return;const i=this[e(1111)][e(280)]<this[e(257)]?-1:1;let s=!1;for(let t=this[e(257)];t!==this[e(1111)].currentLayer;t+=i)if(!this[e(1111)].list[t][e(159)]){s=!0;break}if(!s)return;const r=this._model[e(280)];return d(r,this._targetIndex,this[e(1111)])?new l(this[e(433)],r,this[e(257)]):void 0}}class f extends u{constructor(e,i,s){const r=t,n=i[r(347)][i[r(280)]],o=i.list[r(1529)]((t=>!t[r(159)])),h=o[r(215)](n)+s;(h<0||h>=o[r(589)])&&super(e,i[r(280)],i);const a=o[h];super(e,i[r(347)][r(215)](a),i)}}class m extends f{constructor(e){super(t(1193),e,1)}}class g extends f{constructor(e){super(t(302),e,-1)}}var _=i(5901);class p{constructor(e,i){const s=t;this.operationName=e,this._layer=i,this[s(1404)]="singleLayer",this[s(506)]=0}[t(799)](){const e=t;return this._layer.isSoftDeleted=!1,this[e(264)].onUpdateEmitter[e(617)](),this[e(264)]}redo(){const e=t;return this._layer[e(159)]=!0,this[e(264)].onUpdateEmitter[e(617)](),this[e(264)]}serialize(){const e=t;return{id:e(1036),operationName:this.operationName,layerId:this[e(264)].id}}static[t(1239)](e,i){const s=t,r=e[s(184)](i.layerId);return new p(i[s(1090)],r)}}var y=i(1405),w=i(6628),v=i(3817);class b{constructor(e,i,s){const r=t;this[r(1090)]=e,this[r(761)]=i,this[r(167)]=s,this[r(1404)]=r(525),this[r(506)]=0}undo(e){const i=t;e(this._undoDimensions.width,this[i(761)].height)}redo(e){const i=t;e(this._redoDimensions[i(590)],this[i(167)].height)}[t(1180)](){const e=t;return{id:e(1130),operationName:this[e(1090)],undoDimensions:this[e(761)],redoDimensions:this[e(167)]}}static[t(1239)](e){const i=t;return new b(e.operationName,e[i(943)],e[i(1010)])}}class x{constructor(e,i,s){const r=t;this[r(1090)]=e,this[r(264)]=i,this._tempLayer=s,this[r(1404)]="singleLayer",this[r(1209)]=r(1197),this[r(506)]=this._tempLayer.staticState[r(339)].resource[r(590)]*this._tempLayer[r(366)].image[r(1249)][r(230)]}async[t(799)](){const e=t;return this[e(264)].temporaryLayer=void 0,this._tempLayer[e(825)](),this._layer[e(296)][e(617)](),this[e(264)]}async[t(240)](){const e=t;return this[e(264)][e(807)]=this._tempLayer,this[e(881)].triggerHistoryAction(),this[e(264)].onUpdateEmitter.fire(),this[e(264)]}serialize(){const e=t;return{id:e(902),operationName:this.operationName,layerId:this._layer.id,tempLayerId:this[e(881)].id}}static[t(1239)](e,i){const s=t,r=e[s(184)](i[s(1072)]),n=e[s(935)](i.tempLayerId);return new x(i[s(1090)],r,n)}}var S=i(6785),C=i(4378),E=i(7605);class L{constructor(e,i,s,r){const n=t;this[n(1090)]=e,this[n(264)]=i,this._undoImage=s,this._redoImage=r,this[n(1404)]=n(464),this[n(506)]=this[n(854)][n(590)]*this._undoImage.height}async[t(799)](){const e=t;return await this[e(264)][e(201)]((()=>this._undoImage)),this[e(264)]}async[t(240)](){const e=t;return await this[e(264)][e(201)]((()=>this[e(173)])),this[e(264)]}serialize(){const e=t;return{id:e(1289),operationName:this[e(1090)],layerId:this[e(264)].id,undoImage:(0,E.t)(this[e(854)]),redoImage:(0,E.t)(this._redoImage)}}static create(e,i){const s=t,r=e[s(184)](i[s(1072)]);return new L(i[s(1090)],r,(0,E.e)(i[s(1308)]),(0,E.e)(i.redoImage))}}var T=i(4375),I=i(1375);class A{constructor(e,i){const s=t;this.operationName=e,this[s(264)]=i,this.type=s(464),this[s(506)]=this[s(264)][s(590)]*this._layer.height}[t(799)](){const e=t;return this[e(264)][e(159)]=!0,this[e(264)][e(296)][e(617)](),this._layer}redo(){const e=t;return this._layer[e(159)]=!1,this[e(264)][e(296)].fire(),this._layer}[t(1180)](){const e=t;return{id:e(222),operationName:this[e(1090)],layerId:this._layer.id}}static create(e,i){const s=t,r=e[s(184)](i[s(1072)]);return new A(i[s(1090)],r)}}class R{constructor(){const e=t;this.type=e(1146),this[e(1090)]=e(480),this[e(506)]=0}[t(1180)](){return{id:t(1109)}}static[t(1239)](t){return new R}}class B{constructor(){const e=t;this[e(1404)]=e(1146),this[e(1090)]=e(402),this[e(506)]=0}[t(1180)](){return{id:"restoreImage"}}static[t(1239)](t){return new B}}class M{constructor(e,i,s){const r=t;this[r(264)]=e,this[r(760)]=i,this._redoBlendMode=s,this[r(1404)]=r(464),this[r(506)]=0,this[r(1090)]="Layer Blend Mode: "+function(e){const i=t;return e.substr(0,1)[i(751)]()+e[i(952)](1)}(this[r(423)])}[t(799)](){const e=t;return this[e(264)][e(1102)]=this[e(760)],this[e(264)]}[t(240)](){const e=t;return this[e(264)].blendMode=this[e(423)],this[e(264)]}serialize(){const e=t;return{id:e(568),layerId:this[e(264)].id,undoBlendMode:this[e(760)],redoBlendMode:this[e(423)]}}static[t(1239)](e,i){const s=t,r=e.getLayerById(i[s(1072)]);return new M(r,i[s(858)],i.redoBlendMode)}}class D{constructor(e,i){const s=t;this._layer=e,this[s(810)]=i,this.type=s(464),this[s(506)]=0,this[s(1090)]=(this[s(810)]?"Show":s(328))+s(1256)}[t(799)](){const e=t;return this[e(264)][e(909)]=!this[e(810)],this[e(264)]}[t(240)](){const e=t;return this[e(264)].isVisible=this[e(810)],this[e(264)]}serialize(){const e=t;return{id:e(575),layerId:this[e(264)].id,isVisible:this._isVisible}}static create(e,i){const s=t,r=e[s(184)](i.layerId);return new D(r,i[s(909)])}}var P=i(6495);class U{constructor(e,i){this[t(1148)]=e,this._layer=i}[t(365)](){const e=t;if(this._layer[e(1102)]===this[e(1148)])return;const i=this._layer[e(1102)];return this[e(264)].blendMode=this[e(1148)],new M(this[e(264)],i,this[e(1148)])}}class k{constructor(e,i){this[t(810)]=e,this._layer=i}[t(365)](){const e=t;if(this[e(264)][e(909)]!==this[e(810)])return this[e(264)][e(909)]=this[e(810)],new D(this._layer,this[e(810)])}}var F=i(4371);class N extends e.JT{constructor(e,i,n,o,h){const a=t;super(),this[a(264)]=e,this[a(704)]=i,this[a(1291)]=n,this[a(413)]=o,this._historyService=h,this[a(158)]=0,this[a(877)]=new Set,this[a(344)]=(0,s.Pq)(),this[a(581)]=(0,s.Pq)(),this[a(924)]=this[a(1076)](new r.v),this[a(913)]=this[a(924)][a(1349)],this[a(889)]=this[a(1076)](new r.v),this.onCommit=this[a(889)][a(1349)],this._undoData={colorData:new Uint8Array(200),indexList:(0,F.X)(50,this[a(1291)]*this._height*4)},this[a(479)]={colorData:new Uint8Array(200),indexList:(0,F.X)(50,this._width*this[a(413)]*4)}}[t(330)](e,i,r,n){const o=t;if(e<0||e>=this[o(1291)])return;const h=i*this[o(1291)]+e;if(this[o(877)].has(h))return;this[o(877)][o(1046)](h),(0,s.Hv)(this[o(581)],e,i),this._pointCount>=this[o(1172)].indexList[o(589)]&&(this[o(1172)].indexList=(0,F.R)(this[o(1172)][o(518)]),this[o(1172)].colorData=(0,F.R)(this[o(1172)][o(1156)]),this._redoData[o(518)]=(0,F.R)(this[o(479)].indexList),this._redoData.colorData=(0,F.R)(this[o(479)][o(1156)]));const c=4*(i*this[o(1291)]+e),l=4*this[o(158)];this._undoData[o(518)][this[o(158)]]=c,this[o(1172)][o(1156)][l]=this[o(704)][c],this[o(1172)][o(1156)][l+1]=this._data[c+1],this[o(1172)][o(1156)][l+2]=this[o(704)][c+2],this[o(1172)].colorData[l+3]=this[o(704)][c+3],this[o(479)][o(518)][this._pointCount]=c,n?((0,a.B)(n,this[o(704)],c,r,0),this[o(479)][o(1156)][l]=this._data[c],this[o(479)][o(1156)][l+1]=this[o(704)][c+1],this[o(479)][o(1156)][l+2]=this[o(704)][c+2],this[o(479)][o(1156)][l+3]=this[o(704)][c+3]):(this[o(479)][o(1156)][l]=this[o(704)][c]=r[0],this[o(479)][o(1156)][l+1]=this[o(704)][c+1]=r[1],this._redoData.colorData[l+2]=this[o(704)][c+2]=r[2],this[o(479)][o(1156)][l+3]=this[o(704)][c+3]=r[3]),this[o(158)]++}[t(958)](e,i,s,r,n){const o=t,h=Math[o(1112)]((s-1)/2),a=s%2==0?1:0;let c=h,l=0,d=1-h;for(r?(this[o(290)](e-h,e+h+a,i,n),a&&this[o(290)](e-h,e+h+a,i+1,n)):(this[o(330)](e+h+a,i,n),this[o(330)](e-h,i,n),a&&(this[o(330)](e+h+a,i+1,n),this.setPixel(e-h,i+1,n))),this.setPixel(e,i+h+a,n),this.setPixel(e,i-h,n);c>l&&(l++,d<=0?d=d+2*l+1:(c--,d=d+2*i-2*e+1),!(c<l));)r?(this._setHorizontalLine(e-c,e+c+a,i+l+a,n),this._setHorizontalLine(e-c,e+c+a,i-l,n),this[o(290)](e-l,e+l+a,i+c+a,n),this[o(290)](e-l,e+l+a,i-c,n)):(this.setPixel(e+c+a,i+l+a,n),this[o(330)](e-c,i+l+a,n),this[o(330)](e+c+a,i-l,n),this[o(330)](e-c,i-l,n),this.setPixel(e+l,i+c+a,n),this[o(330)](e-l,i+c+a,n),this[o(330)](e+l,i-c,n),this[o(330)](e-l,i-c,n))}[t(290)](e,i,s,r){const n=t;for(let t=e;t<=i;t++)this[n(330)](t,s,r),this[n(330)](t,s,r)}[t(597)](){const e=t;(0,s.Bu)(this[e(581)])||(this._range=(0,s.qi)(this._range,this._rangeNotYetRequested),this[e(924)][e(617)](this[e(581)]),this[e(581)]=(0,s.Pq)())}[t(878)](e){const i=t,s={indexList:this._undoData[i(518)][i(524)](0,this._pointCount),colorData:this[i(1172)].colorData[i(524)](0,4*this[i(158)])},r={indexList:this._redoData[i(518)][i(524)](0,this[i(158)]),colorData:this[i(479)][i(1156)].subarray(0,4*this[i(158)])},n=new S.x(e,this[i(264)],this[i(344)],s,r);this[i(391)][i(1017)](n),this[i(889)][i(617)](this[i(344)])}}var O=i(270);class H extends e.JT{constructor(e,i,s,n,o,h,a){const c=t;super(),this._parent=e,this[c(391)]=i,this[c(1233)]=s,this.id=n,this[c(1525)]=o,this[c(590)]=h,this[c(230)]=a,this[c(963)]=!1,this[c(1148)]=c(387),this[c(810)]=!0,this[c(1175)]=!1,this.isBottomLayer=!1,this[c(296)]=this[c(1076)](new r.v),this[c(913)]=this[c(296)][c(1349)],this[c(571)]=this[c(1076)](new r.v),this[c(386)]=this[c(571)][c(1349)],this._onChangedDimensions=this.register(new r.v),this.onChangedDimensions=this[c(1366)][c(1349)],this[c(1061)]=this.register(new r.v),this[c(622)]=this._onVisibilityChange[c(1349)],this[c(1334)]=this[c(1076)](new r.v),this[c(1210)]=this[c(1334)][c(1349)],this._onTemporaryLayerRegistered=this.register(new r.v),this.onTemporaryLayerRegistered=this[c(225)][c(1349)],this[c(1437)]=1===this.id?c(569):c(1350)+this.id}get[t(395)](){return this[t(1437)]}set[t(395)](e){this[t(1437)]=e}get[t(1102)](){return this._blendMode}set[t(1102)](e){const i=t;e!==this._blendMode&&(this[i(1148)]=e,this.onUpdateEmitter[i(617)]())}get isSoftDeleted(){return this._isSoftDeleted}set[t(159)](e){const i=t;e!==this._isSoftDeleted&&(this[i(1175)]=e,this._onSoftDeletedChange[i(617)]())}get[t(909)](){return this[t(810)]}set[t(909)](e){const i=t;e!==this[i(810)]&&(this._isVisible=e,this[i(1061)].fire(),this[i(296)].fire())}async[t(201)](e){const i=t;this._startEdit();try{const t=await e(this.data,this[i(590)],this[i(230)]),s={image:t&&"data"in t?t:void 0,range:t&&"left"in t?t:void 0};this[i(1234)](s)}catch(t){throw this[i(1234)]({range:(0,s.DI)(this[i(590)],this[i(230)])}),t}}[t(896)](){const e=t;this[e(1198)]();const i=new N(this,this[e(1525)],this[e(590)],this[e(230)],this._historyService);return(0,r.B)(i[e(913)],this.onUpdateEmitter),i[e(629)]((t=>this._finishEdit({range:t}))),i}async[t(666)](e){const i=t;if(e[i(909)])return this._historyService.runAction(new P.Z(i(604),(0,s.DI)(this.width,this[i(230)]),this,(async(t,s,r)=>{const n=i;!this[n(909)]&&t[n(766)](e.data,0);let o=0;for(let i=0;i<r;i++)for(let r=0;r<s;r++)o=4*(i*s+r),(0,a.B)(e[n(1102)],t,o,e[n(1525)],o)})))}async[t(259)](e,i=!0){const s=t;await this[s(538)](),this.temporaryLayer=e,i&&((0,r.B)(e[s(1210)],this._onRequestRender),e[s(629)]((()=>this.temporaryLayer=void 0))),this[s(225)].fire(this.temporaryLayer)}async[t(538)](){const e=t;await(this[e(807)]?.[e(878)](this._parent.mutableRange)),this.temporaryLayer=void 0}async exportBlob(e={}){const i=t;let r,n;if(e?.[i(1448)]&&"moving"===this[i(807)]?.[i(1404)]){const t=this.temporaryLayer;r=await t[i(366)].image[i(163)],n=(0,s.DI)(r[i(590)],r[i(230)])}else await this[i(538)](),r=this,n=e[i(1231)]||(0,s.DI)(this[i(590)],this[i(230)]);return V(function(e,i){const s=t,r=i[s(890)]-i.left,n=i[s(459)]-i.top;let o,h=0;if(r===e[s(590)])h=i.top*r*4,o=new Uint8ClampedArray(e.data[s(524)](h,h+r*n*4));else{o=new Uint8ClampedArray(r*n*4);for(let t=i[s(1171)];t<i[s(1171)]+n;t++)h=4*(t*e[s(590)]+i[s(1375)]),o[s(766)](e.data.subarray(h,h+4*r),(t-i[s(1171)])*r*4)}return new ImageData(o,r,n)}(r,n),e)}async[t(902)](e,i){const r=t,n=await window.createImageBitmap(e);let o;r(977)in window?o=new OffscreenCanvas(n[r(590)],n[r(230)]):(o=document[r(1067)](r(572)),o[r(590)]=n[r(590)],o[r(230)]=n[r(230)]);const h=o[r(1295)]("2d");h[r(355)](n,0,0);const a=h[r(336)](0,0,n[r(590)],n[r(230)]),c={data:new Uint8Array(a[r(1525)]),width:a[r(590)],height:a.height};let l;l=i&&i.right-i[r(1375)]===a[r(590)]&&i[r(459)]-i[r(1171)]===a.height?(0,s.BN)(i):(0,s.DI)(a[r(590)],a.height);const d=new O.m(this,c,l,void 0,this._historyService,this[r(1233)]);d.stepState[r(1463)]({...d[r(853)]}),await this[r(259)](d),this[r(391)][r(1017)](new x(r(523),this,d));const u=(0,s.l$)((0,s.DI)(a[r(590)],a.height),(0,s.DI)(this[r(590)],this.height));return this[r(296)][r(617)](u),d}_startEdit(){const e=t;if(this[e(963)])throw new Error(e(781));this[e(963)]=!0}[t(1234)](e){const i=t;if(e){if(e?.[i(339)]){const t=this[i(590)]!==e[i(339)].width||this.width!==e.image[i(590)];this[i(1525)]=e.image[i(1525)],this[i(590)]=e[i(339)][i(590)],this.height=e.image[i(230)],t&&this._onChangedDimensions.fire(this[i(1468)][i(590)],this[i(1468)][i(230)])}this[i(296)][i(617)](e[i(1231)]),this[i(963)]=!1}else this._isEditInProgress=!1}[t(568)](e){const i=t;this[i(391)][i(553)](new U(e,this))}[t(788)](e){const i=t;this[i(391)][i(553)](new k(e,this))}[t(1180)](){const e=t;return{id:this.id,name:this[e(1437)],data:Array.from(this[e(1525)]),blendMode:this[e(1148)],isSoftDeleted:this[e(1175)],isVisible:this[e(810)]}}}async function V(e,i={}){const s=t,r=await createImageBitmap(e);if(!(s(977)in window)){const t=document[s(1067)](s(572));return t.width=r[s(590)],t[s(230)]=r[s(230)],t[s(1295)]("2d").drawImage(r,0,0),new Promise(((e,r)=>{const n=s;t[n(521)]((t=>{if(!t)return r(t);e(t)}),i[n(1510)]?.[n(1404)],i[n(1510)]?.[n(1066)])}))}const n=new OffscreenCanvas(r[s(590)],r[s(230)]);return n[s(1295)]("2d")[s(355)](r,0,0),n[s(1527)](i[s(1510)])}var z=i(807);class j extends e.JT{constructor(e,i){const s=t;super(),this[s(391)]=e,this._taskWorkerService=i,this.width=0,this[s(230)]=0,this[s(1073)]=0,this[s(1039)]=new Map,this[s(924)]=this[s(1076)](new r.v),this.onUpdate=this._onUpdate[s(1349)],this[s(1366)]=this[s(1076)](new r.v),this[s(327)]=this._onChangedDimensions[s(1349)],this[s(512)]=this[s(1076)](new r.v),this.onLayerChange=this._onLayerChange[s(1349)],this[s(378)]=this.register(new r.v),this[s(1283)]=this[s(378)].event,this._onRequestRender=this[s(1076)](new r.v),this.onRequestRender=this[s(1334)][s(1349)],this[s(225)]=this[s(1076)](new r.v),this[s(646)]=this[s(225)][s(1349)],this[s(1184)]={list:[],currentLayer:0,onLayerChangeEmitter:this._onLayerChange},this[s(391)][s(397)](s(464),{undo:async t=>{const e=s,i=await t[e(799)]();i[e(159)]?this[e(850)](this[e(502)][0].id):this[e(850)](i.id)},redo:async t=>{const e=s,i=await t[e(240)]();i.isSoftDeleted?this.setActiveLayer(this[e(502)][0].id):this[e(850)](i.id)}}),this._historyService.registerHistoryEntryHandler(s(1360),{undo:t=>t[s(799)](this[s(1184)]),redo:t=>t[s(240)](this[s(1184)])}),this[s(391)].registerHistoryEntryHandler("resize",{undo:t=>t[s(799)](this[s(525)].bind(this)),redo:t=>t.redo(this.resize[s(1356)](this))}),this._historyService[s(576)](s(1109),R[s(1239)]),this[s(391)][s(576)](s(1241),S.x[s(1239)][s(1356)](null,this)),this._historyService[s(576)](s(1351),C.$[s(1239)].bind(null,this)),this[s(391)][s(576)](s(1289),L.create[s(1356)](null,this)),this[s(391)][s(576)](s(1130),b[s(1239)]),this[s(391)][s(576)](s(568),M[s(1239)][s(1356)](null,this)),this[s(391)][s(576)](s(575),D[s(1239)].bind(null,this)),this[s(391)][s(576)](s(1036),p[s(1239)][s(1356)](null,this)),this[s(391)].registerHistoryEntryFactory("newImage",A[s(1239)][s(1356)](null,this)),this._historyService[s(576)](s(1220),l[s(1239)]),this[s(391)][s(576)](s(819),B[s(1239)]),this[s(391)][s(576)](s(902),x[s(1239)][s(1356)](null,this)),this._historyService[s(576)](s(362),w.$[s(1239)][s(1356)](null,this,this[s(1233)])),this[s(391)][s(576)](s(639),I.C.create.bind(null,this,this._taskWorkerService)),this[s(391)][s(576)]("adjustMovePixels",T.Y[s(1239)].bind(null,this)),this[s(391)][s(576)](s(1264),y.D[s(1239)][s(1356)](null,this)),this[s(391)].registerHistoryEntryFactory(s(969),_.X[s(1239)].bind(null,this)),this[s(391)][s(576)](s(1476),v.O[s(1239)][s(1356)](null,this)),this[s(646)]((t=>{this[s(1039)].set(t.id,t)}))}get currentLayer(){const e=t;return this[e(1184)][e(347)][this[e(1184)][e(280)]]}get[t(502)](){const e=t;return this[e(1184)][e(347)].filter((t=>!t[e(159)]))}[t(1180)](e=0){const i=t;if(this[i(590)]*this[i(230)]>e)throw new Error(i(160)+this[i(590)]*this.height+i(407)+e+")");for(const t of this[i(1039)][i(1032)]())if(t[i(566)]){const i=t.canSerialize(e);if(i)throw new Error(i)}const s=[];for(const t of this._activeTemporaryLayers[i(1032)]())s[i(1463)](t[i(1180)]());const r={dimensions:{width:this[i(590)],height:this.height},currentLayer:this[i(1184)][i(280)],layers:this._layersModel[i(347)].map((t=>t.serialize())),temporaryLayers:s,currentTemporaryLayerId:this.currentLayer?.[i(807)]?.id};if(0===r[i(502)][i(589)])throw new Error("Could not serialize layers");return r}deserialize(e){const i=t;if(this[i(590)]=e[i(1133)][i(590)],this.height=e[i(1133)].height,this[i(1184)][i(347)][i(589)]>0)throw new Error("Cannot restore layers when layer(s) exist");for(const t of e[i(502)]){const s=new H(this,this[i(391)],this[i(1233)],t.id,new Uint8Array(t[i(1525)]),e[i(1133)].width,e.dimensions[i(230)]);s[i(395)]=t[i(395)],s[i(1102)]=t.blendMode,s[i(159)]=t[i(159)],s.isVisible=t[i(909)],this._layersModel[i(347)][i(1463)](s),this[i(1199)](s),this._imageLayerIdCounter=Math.max(this[i(1073)],t.id+1)}this[i(1184)].currentLayer=e[i(280)];for(const t of e[i(198)]){const e=this[i(184)](t[i(1477)]);let s;switch(t[i(1404)]){case i(1038):s=O.m.create;break;case i(567):s=z.F[i(1239)]}const n=s(t,e,this[i(391)],this[i(1233)]);n[i(853)][i(665)]=t[i(853)].offsetX,n[i(853)][i(839)]=t[i(853)][i(839)],(0,r.B)(n[i(1210)],this[i(280)][i(1334)]),this[i(1039)][i(766)](t.id,n)}if(void 0!==e[i(757)]){const t=this.getTemporaryLayerById(e[i(757)]);this[i(280)].temporaryLayer=t}this._updateBottomLayer(),this._onUpdate[i(617)](),this[i(1366)].fire(this.width,this[i(230)]),this[i(512)][i(617)]()}async openBlob(e){const i=t,s=await window[i(185)](e);let r;i(977)in window?r=new OffscreenCanvas(s[i(590)],s.height):(r=document[i(1067)](i(572)),r[i(590)]=s[i(590)],r.height=s.height);const n=r[i(1295)]("2d");n[i(355)](s,0,0);const o=n[i(336)](0,0,s.width,s[i(230)]);this.openImage({data:new Uint8Array(o[i(1525)][i(516)]),width:s[i(590)],height:s[i(230)]})}[t(1109)](e,i=t(480)){const s=t;for(const t of this[s(1184)][s(347)])t.isSoftDeleted=!0,t[s(1424)]();this[s(1184)][s(347)][s(589)]=0;const r=this[s(590)]!==e.width||this[s(230)]!==e.height;this[s(590)]=e[s(590)],this.height=e.height,this[s(1184)][s(347)][s(1463)](this[s(627)](e[s(1525)])),this[s(175)](),this[s(391)][s(1393)](),this[s(391)][s(1017)](new R),this[s(924)][s(617)](),r&&this[s(1366)][s(617)](this.width,this[s(230)]),this[s(512)][s(617)]()}[t(222)](e,i){const s=t,r=window[s(1280)]?SharedArrayBuffer:ArrayBuffer,n=new Uint8Array(new r(e*i*4));n[s(874)](255);const o={data:n,width:e,height:i};this[s(1109)](o,s(1245))}async exportBlob(e){const i=t;return await this[i(1077)](),this[i(1184)].list[this._layersModel[i(280)]][i(1495)](e)}async[t(645)](e){const i=t,s=await this.exportImageClone();return V(new ImageData(new Uint8ClampedArray(s[i(1525)]),s.width,s[i(230)]),e)}[t(1192)](){const e=t;return this[e(1077)](),{data:this[e(1184)][e(347)][this[e(1184)][e(280)]][e(1525)][e(953)](0,this.width*this[e(230)]*4),width:this[e(590)],height:this.height}}async[t(992)](){const e=t,i=this[e(1184)].list.filter((t=>t.isVisible));if(0===i[e(589)])return{data:new Uint8Array(0),width:0,height:0};const r={data:i[0].data[e(953)](0,this.width*this.height*4),width:this[e(590)],height:this[e(230)]};for(let t=1;t<i[e(589)];t++){const n=i[t];if(n[e(807)]){const t=n[e(807)],i=await t.staticState[e(339)][e(163)],o={left:t[e(853)].offsetX,top:t.currentState.offsetY,right:t[e(853)][e(665)]+i.width,bottom:t.currentState[e(839)]+i[e(230)]};let h=0;for(let t=0;t<this[e(230)];t++)for(let c=0;c<this.width;c++)if(h=4*(t*this[e(590)]+c),(0,s.RB)(o,c,t)){const s=4*((t-o.top)*i[e(590)]+c-o[e(1375)]);(0,a.B)(n[e(1102)],r.data,h,i[e(1525)],s)}else(0,a.B)(n[e(1102)],r[e(1525)],h,n[e(1525)],h)}else{let t=0;for(let i=0;i<this[e(230)];i++)for(let s=0;s<this.width;s++)t=4*(i*this[e(590)]+s),(0,a.B)(n.blendMode,r.data,t,n[e(1525)],t)}}return r}[t(850)](e){const i=t;this[i(280)]?.id!==e&&(this[i(1184)][i(280)]=this._getIndexFromId(e),this[i(512)].fire())}[t(209)](){const e=t,i=window.SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s=this[e(627)](new Uint8Array(new i(this.width*this[e(230)]*4)));this[e(1184)].list[e(1526)](++this[e(1184)][e(280)],0,s),this[e(391)][e(1017)](new A("New Layer",s)),this[e(924)][e(617)](),this[e(512)][e(617)]()}[t(1036)](e){const i=t;if(this[i(1184)].list[i(589)]<=1)throw new Error(i(728));e?this[i(1480)](this[i(657)](e)):this[i(535)](),this[i(512)][i(617)]()}async[t(1541)](){const e=t;if(0===this._layersModel[e(280)]||this[e(502)][0]===this.currentLayer)throw new Error(e(509));const i=this._layersModel[e(347)][this._layersModel.currentLayer];i.isVisible=!0,await i[e(538)]();const s=this[e(502)][e(215)](i),r=this.layers[s-1],n=this._layersModel[e(347)].indexOf(r);await this[e(391)][e(719)]("Merge Layer Down",(async()=>{const t=e;await this[t(1184)][t(347)][n].merge(i),this._deleteCurrentLayer(),this[t(1184)][t(280)]=n}))}[t(1216)](){const e=t;this[e(850)](this[e(502)][this[e(502)].length-1].id)}[t(447)](){this[t(850)](this.layers[0].id)}goToLayerAbove(){this[t(346)](1)}goToLayerBelow(){this[t(346)](-1)}[t(346)](e){const i=t,s=this[i(280)];if(!s)throw new Error(i(1144));const r=this.layers,n=r[i(215)](s);if(-1===n)throw new Error("Could not find current layer");const o=(0,c.u)(n+e,r.length-1,0);this[i(850)](r[o].id)}[t(452)](){const e=t;this._historyService[e(553)](new u(e(1354),this[e(1184)][e(347)][e(589)]-1,this[e(1184)]))}[t(485)](){const e=t;this._historyService[e(553)](new u(e(1451),0,this[e(1184)]))}[t(155)](){const e=t;this[e(391)][e(553)](new m(this[e(1184)]))}[t(857)](){const e=t;this[e(391)][e(553)](new g(this[e(1184)]))}[t(1020)](e,i){const s=t;return e>=0&&e<this.width&&i>=0&&i<this[s(230)]}[t(525)](e,i){const s=t;this[s(590)]===e&&this[s(230)]===i||(this.width=e,this[s(230)]=i,this._onUpdate.fire(),this[s(1366)][s(617)](e,i))}[t(627)](e){const i=t;if(window[i(1280)]&&!(e[i(516)]instanceof SharedArrayBuffer)){const t=new Uint8Array(new SharedArrayBuffer(e.length));t.set(e),e=t}const s=new H(this,this[i(391)],this[i(1233)],++this[i(1073)],e,this[i(590)],this.height);return this._forwardLayerEvents(s),s}_forwardLayerEvents(e){const i=t;(0,r.B)(e[i(913)],this._onUpdate),(0,r.B)(e[i(386)],this[i(512)]),(0,r.B)(e.onChangedDimensions,this[i(1366)]),(0,r.B)(e.onVisibilityChange,this[i(378)]),(0,r.B)(e.onRequestRender,this[i(1334)]),(0,r.B)(e[i(646)],this[i(225)])}[t(535)](){const e=t;this[e(1480)](this[e(1184)][e(280)])}[t(1480)](e){const i=t;if(1===this[i(987)]())throw new Error(i(1170));this[i(1184)].currentLayer===e&&(this[i(1184)][i(280)]=Math[i(1487)](this._layersModel[i(280)]-1,0));const s=this._layersModel.list[e];s.isSoftDeleted=!0,this._historyService[i(1017)](new p(i(1315),s)),this._updateBottomLayer()}async[t(1077)](){const e=t;this[e(987)]()>1&&(await this[e(391)][e(719)](e(352),(async()=>{const t=e;for(let e=this[t(1184)][t(347)][t(589)]-1;e>=1;e--){const i=this[t(1184)][t(347)][e];await i[t(538)](),await this[t(1184)][t(347)][e-1][t(666)](i),this._deleteLayerByIndex(e)}})),this[e(924)][e(617)](),this[e(512)].fire())}[t(175)](){const e=t;this[e(1184)].list[0][e(707)]=!0;for(let t=1;t<this[e(1184)][e(347)][e(589)];t++)this._layersModel[e(347)][t].isBottomLayer=!1}[t(657)](e){const i=t,s=this[i(1184)][i(347)].findIndex((t=>t.id===e));if(-1===s)throw new Error(i(156));return s}[t(184)](e){const i=t;return this[i(1184)].list[this[i(657)](e)]}[t(935)](e){const i=t;return this[i(1039)][i(1006)](e)}[t(987)](){const e=t;let i=0;for(const t of this[e(1184)][e(347)])!t[e(159)]&&i++;return i}}class W extends e.JT{constructor(e){const i=t;super(),this._attachedDisposables=[],this[i(1238)]=this[i(1076)](new r.v),this[i(269)]=this[i(1238)][i(1349)],this[i(1286)]=this[i(1076)](new r.v),this[i(558)]=this[i(1286)][i(1349)],this[i(315)]=this[i(1076)](new r.v),this[i(884)]=this[i(315)].event,this._onPointerDownMove=this[i(1076)](new r.v),this.onPointerDownMove=this[i(930)][i(1349)],this[i(859)]=this[i(1076)](new r.v),this.onPointerMove=this[i(859)][i(1349)],this[i(947)]=this.register(new r.v),this[i(1205)]=this[i(947)].event,this._onWheel=this[i(1076)](new r.v),this.onWheel=this[i(425)][i(1349)],e[i(1304)]((t=>this._attach(t)))}get[t(1068)](){return!!this[t(1371)]}[t(1424)](){const e=t;this[e(1371)]?.dispose(),super[e(1424)]()}[t(210)](i){const s=t;(0,e._c)(this[s(651)]),this._attachedDisposables[s(589)]=0,this[s(1076)]((0,e.Lw)(document[s(1219)],s(1075),(t=>this[s(1238)][s(617)](t)))),this.register((0,e.Lw)(document[s(1219)],s(1388),(t=>this[s(1286)][s(617)](t)))),this.register((0,e.Lw)(i,"pointerdown",(t=>{const r=s;i[r(1053)](t[r(1523)]),this[r(1371)]=(0,e.Lw)(i,"pointermove",(t=>this[r(930)][r(617)](t))),this[r(315)][r(617)](t)}))),this.register((0,e.Lw)(i,s(1093),(t=>{const e=s;i[e(1432)](t[e(1523)]),this[e(1371)]?.[e(1424)](),this._pointerDownMoveListener=void 0,this[e(947)][e(617)](t)}))),this.register((0,e.Lw)(i,"contextmenu",(t=>t[s(1049)]()))),this[s(1076)]((0,e.Lw)(i,"pointermove",(t=>this._onPointerMove[s(617)](t)))),this[s(1076)]((0,e.Lw)(i,s(450),(t=>this._onWheel.fire(t)),{passive:!0}))}}var q=i(6374);class G extends e.JT{constructor(){const e=t;super(...arguments),this[e(472)]=new Float32Array([255,255,255,255]),this._secondary=new Float32Array([0,0,0,255]),this._onUpdate=this[e(1076)](new r.v),this[e(913)]=this._onUpdate.event}get[t(882)](){return this[t(472)]}set[t(882)](e){const i=t;this._validate(e),!(0,q.W)(this[i(882)],e)&&(this[i(472)]=e,this._onUpdate[i(617)]())}get[t(1029)](){return this[t(275)]}set[t(1029)](e){const i=t;this._validate(e),!(0,q.W)(this.secondary,e)&&(this[i(275)]=e,this[i(924)][i(617)]())}[t(1110)](){const e=t,i=this._secondary;this[e(275)]=this._primary,this[e(472)]=i,this._onUpdate[e(617)]()}setColors(e,i){const s=t;this[s(178)](e),this._validate(i),(!(0,q.W)(this[s(882)],e)||!(0,q.W)(this[s(1029)],i))&&(this[s(472)]=e,this[s(275)]=i,this[s(924)][s(617)]())}getColorFromPointerEvent(e){const i=t;return 1&e[i(588)]?this.primary:2&e[i(1504)]?this[i(1029)]:void 0}[t(990)](e){const i=t;return 1&e[i(588)]?[this[i(882)],this[i(1029)]]:[this.secondary,this[i(882)]]}[t(178)](e){if(4!==e[t(589)])throw new Error("Could not set color to array of length smaller than 4")}}let X=Float32Array;function J(t,e,i,s,r,n,o=new X(16)){return o[0]=2/(e-t),o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/(s-i),o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2/(r-n),o[11]=0,o[12]=(t+e)/(t-e),o[13]=(i+s)/(i-s),o[14]=(r+n)/(r-n),o[15]=1,o}function Y(t,e,i,s,r=new X(16)){var n=t[0],o=t[1],h=t[2],a=t[3],c=t[4],l=t[5],d=t[6],u=t[7],f=t[8],m=t[9],g=t[10],_=t[11],p=t[12],y=t[13],w=t[14],v=t[15];return t!==r&&(r[0]=n,r[1]=o,r[2]=h,r[3]=a,r[4]=c,r[5]=l,r[6]=d,r[7]=u,r[8]=f,r[9]=m,r[10]=g,r[11]=_),r[12]=n*e+c*i+f*s+p,r[13]=o*e+l*i+m*s+y,r[14]=h*e+d*i+g*s+w,r[15]=a*e+u*i+_*s+v,r}const K=[0,0,0,1,1,0,1,0,0,1,1,1];function $(e,i,s){const r=t,n=e[r(619)]();if(e[r(1423)](n,Q(Z(e,e[r(613)],i))),e[r(1423)](n,Q(Z(e,e[r(974)],s))),e.linkProgram(n),e[r(1415)](n,e.LINK_STATUS))return n;console[r(483)](e.getProgramInfoLog(n)),e[r(918)](n)}function Z(e,i,s){const r=t,n=Q(e[r(1099)](i));if(e[r(800)](n,s),e.compileShader(n),e[r(252)](n,e[r(1080)]))return n;console[r(483)](e[r(329)](n),{source:s}),e[r(1244)](n)}function Q(t){if(!t)throw new Error("value must not be falsy");return t}function tt(){return[new Float32Array(16),new Float32Array(16)]}function et(e,i,s,r,n){const o=t;J(0,e[o(572)].width,e[o(572)][o(230)],0,-1,1,n[0]),Y(n[0],Math[o(710)](e[o(572)][o(590)]/2)-s.width/2*r[o(1343)]+r.x*r[o(1343)],Math[o(710)](e.canvas.height/2)-s.height/2*r.zoom+r.y*r[o(1343)],0,n[1]),e[o(848)](i,!1,n[1])}function it(e,i=e[t(572)][t(590)],s=e.canvas.height){const r=t,n=Q(e.createTexture());return e.bindTexture(e[r(891)],n),e[r(1515)](e[r(891)],e[r(1074)],e.CLAMP_TO_EDGE),e[r(1515)](e.TEXTURE_2D,e[r(870)],e[r(818)]),e[r(1515)](e[r(891)],e[r(600)],e[r(1024)]),e.texParameteri(e[r(891)],e[r(276)],e[r(1024)]),e[r(1137)](e[r(891)],0,e[r(348)],i,s,0,e[r(348)],e[r(1518)],null),n}const st=t(842)+0+t(1385)+t(1092)+";\n\nvoid main() {\n  gl_Position = "+t(1092)+t(867),rt=t(1124);class nt extends e.JT{constructor(e,i,s){const r=t;super(),this[r(270)]=e,this._imageService=i,this._viewportService=s,this[r(713)]=2,this[r(1389)]=new Float32Array(8),this[r(422)]=tt(),this[r(197)]=!0,this[r(1461)]=!0;const n=this[r(270)];this[r(802)]=Q($(n,st,rt)),this._vertexArrayObject=Q(n[r(287)]()),n[r(662)](this[r(245)]),this[r(1458)]=Q(n[r(945)]()),this[r(216)]=Q(n[r(910)](this._program,r(1092))),n[r(1221)](n[r(1514)],this[r(1458)]),n[r(782)](0),n.vertexAttribPointer(0,2,n[r(893)],!1,0,0),this.register(this[r(1508)].onChangedDimensions((()=>{const t=r;this[t(197)]=!0,this[t(1461)]=!0}))),this[r(1076)](this[r(971)][r(913)]((()=>{const t=r;this._matrixNeedsUpdate=!0,this[t(197)]=!0})))}render(){const e=t,i=this._imageService[e(280)];if(!i)return;const s=this._gl;s[e(437)](this[e(802)]),s[e(662)](this._vertexArrayObject),this[e(368)](s,i,this[e(971)]),this[e(551)](s,i,this[e(971)]),s[e(1147)](s.LINE_LOOP,0,4)}[t(368)](e,i,s){const r=t;this[r(197)]&&(e[r(662)](this._vertexArrayObject),e[r(1221)](e[r(1514)],this[r(1458)]),this[r(1389)][0]=this[r(1389)][2]=-.5,this._positionsArray[1]=this[r(1389)][7]=-.5,this[r(1389)][4]=this._positionsArray[6]=i.width*s[r(1343)]+.5,this[r(1389)][3]=this[r(1389)][5]=i[r(230)]*s[r(1343)]+.5,e[r(709)](e[r(1514)],this[r(1389)],e[r(258)]),this[r(197)]=!1)}[t(551)](e,i,s){const r=t;this._matrixNeedsUpdate&&(et(e,this[r(216)],i,s,this[r(422)]),this._matrixNeedsUpdate=!1)}}var ot=i(3318),ht=i.n(ot),at=i(3716),ct=i.n(at),lt=i(4738),dt=i.n(lt),ut=i(7542),ft=i.n(ut),mt=i(98),gt=i.n(mt),_t=i(7034),pt=i.n(_t);const yt=new Map([["normal",1],[t(679),3],["multiply",4],[t(1292),6],[t(1391),8],["screen",9],[t(1145),11],["overlay",13],["softLight",14],[t(1413),20],[t(1421),21]]),wt=new Int32Array([0,1,2,3,4,5,6]);let vt=0;class bt extends e.JT{constructor(e,i,s,r){const n=t;super(),this[n(270)]=e,this[n(1508)]=i,this[n(1531)]=s,this._viewportService=r,this[n(713)]=1,this._frameBufferTextures=[],this[n(937)]=new Map,this[n(615)]=new Float32Array(2),this._uniformValueBlendModes=new Int32Array(8);const o=this[n(270)];this[n(802)]=Q($(o,ct(),ht())),this[n(245)]=Q(o[n(287)]()),o[n(662)](this[n(245)]),0===vt&&(vt=o[n(323)](o.MAX_TEXTURE_IMAGE_UNITS));const h=o[n(1083)](this._program,"a_position");this[n(1458)]=Q(o.createBuffer()),o[n(1221)](o.ARRAY_BUFFER,this._positionBuffer),o.bufferData(o[n(1514)],new Float32Array(K),o.STATIC_DRAW),o[n(782)](h),o[n(461)](h,2,o.FLOAT,!1,0,0);const a=o[n(1083)](this[n(802)],"a_texcoord");this[n(669)]=Q(o.createBuffer()),o[n(1221)](o[n(1514)],this._texcoordBuffer),o[n(709)](o[n(1514)],new Float32Array(K),o[n(258)]),o[n(782)](a),o.vertexAttribPointer(a,2,o.FLOAT,!1,0,0),this._matrixUniformLocation=Q(o[n(910)](this[n(802)],"a")),this[n(856)]=Q(o.getUniformLocation(this[n(802)],"b")),this[n(517)]=Q(o[n(910)](this[n(802)],"c")),this[n(956)]=Q(o.getUniformLocation(this[n(802)],"l")),this._frameBufferUniformLocation=Q(o[n(910)](this[n(802)],"n")),this[n(643)]=Q(o[n(910)](this._program,"m")),this[n(1116)]=Q(o.getUniformLocation(this._program,"h")),this[n(451)]=Q(o[n(910)](this._program,"d")),this._tileScaledDimensionsUniformLocation=Q(o[n(910)](this[n(802)],"f")),this[n(1427)]=Q(o[n(910)](this[n(802)],"g")),this[n(698)]=Q(o[n(910)](this[n(802)],"j")),this[n(1153)]=Q(o[n(910)](this._program,"k")),this[n(363)]=Q(o.createFramebuffer()),this[n(412)]=Q(o[n(1484)]()),o.activeTexture(o[n(545)]),o[n(1277)](o.TEXTURE_2D,this[n(412)]),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o[n(276)],o.NEAREST),o.texParameteri(o[n(891)],o[n(1074)],o[n(818)]),o[n(1515)](o[n(891)],o[n(870)],o[n(818)]),o[n(1137)](o[n(891)],0,o.RGBA,1,1,0,o[n(348)],o[n(1518)],new Uint8Array([255,255,255,255])),this[n(1076)](this[n(1508)][n(913)]((t=>this[n(368)](t)))),this.register(this[n(1508)][n(327)]((()=>{const t=n;this[t(368)](),this[t(527)]()}))),this[n(1076)](this._viewportService[n(637)]((()=>{this._updateUniformValueZoom()}))),this[n(368)](),this[n(527)](),this[n(1488)]()}[t(525)](){const e=t,i=this._gl;for(;this[e(552)].length>0;)i.deleteTexture(this[e(552)].pop());this[e(504)]&&(i[e(1232)](this[e(504)]),this[e(504)]=void 0),this[e(1338)]?.resize(),this[e(689)]?.resize(),this[e(1488)]()}render(){const e=t,i=this[e(1508)][e(502)];if(0===i[e(589)])return;const r=this[e(270)];r[e(437)](this[e(802)]),r[e(662)](this._vertexArrayObject),r[e(1189)](r[e(714)],null),r.disable(r[e(162)]);const n=this[e(971)],o=this._imageService;let h=-1,a=null;const c=[],l=[],d=[],u=[];let f=!1;for(const t of i){if(!t.isVisible)continue;const i=this[e(937)][e(1006)](t.id);if(i){const n=t===this[e(1508)][e(280)];let o;n?o=l:f?((0===u[e(589)]||7===u[u[e(589)]-1][0][e(589)])&&u[e(1463)]([]),o=u[u.length-1]):((0===c.length||7===c[c[e(589)]-1][0][e(589)])&&c[e(1463)]([]),o=c[c.length-1]);for(let t=0;t<i[e(852)].length;t++)!o[t]&&(o[t]=[]),o[t].push(i[e(852)][t]);if(n&&(f=!0,t[e(807)]?.[e(1404)]===e(1038)&&t[e(807)].staticState[e(339)][e(978)])){const i=t[e(807)];if(this[e(157)]?.[e(807)]!==i){if(this[e(157)]?.[e(261)]){for(const t of this[e(157)][e(261)][e(852)])r[e(343)](t[e(1521)]);this[e(157)]=void 0}const t=(i.scaledImage?.[e(978)]?i[e(1339)]?.resource:void 0)||i[e(366)][e(339)].resource,n=Q(r.createTexture());r[e(337)](r[e(545)]+0),r[e(1277)](r[e(891)],n),r.texParameteri(r[e(891)],r[e(600)],r[e(299)]),r[e(1515)](r[e(891)],r.TEXTURE_MAG_FILTER,r.NEAREST),r[e(1515)](r[e(891)],r.TEXTURE_WRAP_S,r[e(818)]),r.texParameteri(r.TEXTURE_2D,r[e(870)],r.CLAMP_TO_EDGE),r.texImage2D(r[e(891)],0,r.RGBA,t[e(590)],t.height,0,r.RGBA,r[e(1518)],t.data),this[e(157)]={temporaryLayer:i,renderLayer:{tiles:[{blendMode:yt[e(1006)](this[e(1508)][e(280)][e(1102)]),texture:n,textureImage:t,range:(0,s.DI)(t[e(590)],t[e(230)]),width:t[e(590)],height:t[e(230)],scaledWidth:i.currentState[e(424)],scaledHeight:i[e(853)][e(454)],offsetX:i.currentState[e(665)],offsetY:i[e(853)].offsetY}]}}}else{const t=this[e(157)][e(261)].tiles[0];if(t[e(665)]=i[e(853)][e(665)],t[e(839)]=i[e(853)].offsetY,t[e(1102)]=yt.get(this._imageService[e(280)][e(1102)]),t.scaledWidth=i.currentState.scaledWidth,t[e(454)]=i[e(853)][e(454)],i[e(1339)]?.[e(978)]&&t.textureImage!==i[e(1339)].resource){r.deleteTexture(t.texture);const s=Q(r.createTexture());r[e(337)](r.TEXTURE0+0),r[e(1277)](r[e(891)],s),r[e(1515)](r.TEXTURE_2D,r[e(600)],r[e(299)]),r[e(1515)](r[e(891)],r.TEXTURE_MAG_FILTER,r[e(1024)]),r.texParameteri(r[e(891)],r[e(1074)],r[e(818)]),r.texParameteri(r[e(891)],r[e(870)],r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,i[e(1339)][e(1249)][e(590)],i[e(1339)][e(1249)][e(230)],0,r[e(348)],r.UNSIGNED_BYTE,i[e(1339)][e(1249)][e(1525)]),t[e(1521)]=s,t.textureImage=i.scaledImage.resource}}0!==this[e(157)][e(261)][e(852)][0][e(454)]&&0!==this[e(157)][e(261)][e(852)][0].scaledWidth&&d[e(1463)](this[e(157)][e(261)][e(852)])}}}const m=[];m[e(1463)](...c),l.length>0&&m.push(l),d[e(589)]>0&&m[e(1463)](d),m[e(1463)](...u);for(const[t,i]of m.entries()){let s;if(t<m.length-1?(s=this[e(656)](r,++h),r.bindFramebuffer(r[e(714)],this[e(363)]),r[e(1242)](r[e(714)],r[e(501)],r[e(891)],s,0)):r.bindFramebuffer(r[e(714)],null),i===l&&this._imageService[e(280)].temporaryLayer?.[e(1404)]===e(567)){const c=this._imageService[e(280)][e(807)];!s&&(s=this[e(656)](r,++h),r.bindFramebuffer(r.FRAMEBUFFER,this[e(363)]),r[e(1242)](r[e(714)],r[e(501)],r[e(891)],s,0)),this[e(279)](r,i,!1,!1,o,n),r.bindTexture(r[e(891)],null),!this[e(689)]&&(this._rectangleShader=new St(r,this[e(971)]));const l=yt[e(1006)](c[e(853)][e(1102)]),d=c[e(560)](this[e(1531)][e(1231)]),u=this[e(689)][e(1418)](this[e(1508)].currentLayer,d);!this[e(1338)]&&(this[e(1338)]=new xt(r)),t<m.length-1?(s=this._blendShader[e(1178)](s,u,l),a&&(s=this[e(1338)][e(1178)](a,s,i[0][0][e(1102)]))):a?(s=this[e(1338)][e(1178)](s,u,l),this[e(1338)][e(1178)](a,s,i[0][0].blendMode,!1)):this[e(1338)][e(1178)](s,u,l,!1),r[e(437)](this[e(802)]),r[e(662)](this[e(245)])}else i===l&&d[e(589)]>0?(r[e(337)](r[e(545)]+7),r.bindTexture(r[e(891)],a||this[e(412)]),this._frameBufferRenderBuffer?r[e(1082)](r.RENDERBUFFER,this[e(504)]):(this[e(504)]=Q(r[e(519)]()),r[e(1082)](r.RENDERBUFFER,this[e(504)]),r[e(340)](r.RENDERBUFFER,r[e(1382)],r.canvas[e(590)],r[e(572)][e(230)])),r.framebufferRenderbuffer(r[e(714)],r.DEPTH_STENCIL_ATTACHMENT,r[e(752)],this[e(504)]),r[e(1021)](r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT|r[e(837)]),r[e(1538)](r.STENCIL_TEST),r[e(498)](r.ALWAYS,1,255),r[e(663)](r[e(490)],r[e(490)],r[e(948)]),r.colorMask(!1,!1,!1,!1),this[e(279)](r,d,!1,!0,o,n),r[e(498)](r[e(1016)],1,255),r[e(663)](r[e(490)],r.KEEP,r[e(490)]),r[e(946)](!0,!0,!0,!0),this._renderTileSet(r,i,!1,!1,o,n),r[e(1277)](r[e(891)],null),r.disable(r[e(1486)]),a&&(r[e(559)](r[e(714)],r[e(1265)],r[e(752)],null),r[e(1082)](r[e(752)],null),!this[e(1338)]&&(this[e(1338)]=new xt(r)),s=this[e(1338)][e(1178)](a,s,i[0][0].blendMode),r[e(437)](this[e(802)]),r[e(662)](this[e(245)]))):(r[e(337)](r.TEXTURE0+7),r[e(1277)](r[e(891)],a||this[e(412)]),this._renderTileSet(r,i,!!a,!1,o,n),r[e(1277)](r.TEXTURE_2D,null));s&&(a=s)}}_getFrameBufferTexture(e,i){const s=t;for(;this[s(552)].length<i+1;)this[s(552)][s(1463)](it(e));return this[s(552)][i]}[t(279)](e,i,s,r,n,o){const h=t,a=new Float32Array(16),c=Math[h(710)](e[h(572)][h(590)]/2)-n.width/2*o[h(1343)]+o.x*o[h(1343)],l=Math[h(710)](e[h(572)][h(230)]/2)-n[h(230)]/2*o[h(1343)]+o.y*o[h(1343)];for(const t of i){const i=t[0];Y(this._clipspaceToCanvasCoordsMatrix,c+i[h(1231)][h(1375)]*o[h(1343)],l+i.range[h(1171)]*o[h(1343)],0,a),e[h(499)](this[h(956)],e[h(572)].width,e[h(572)][h(230)]),e.uniform1i(this._frameBufferUniformLocation,7),e.uniform1i(this[h(643)],s?1:0),e[h(848)](this[h(1301)],!1,a),e[h(1088)](this[h(698)],wt),e.uniform2f(this[h(856)],this[h(615)][0],this[h(615)][1]);let d=0;for(;d<t[h(589)];d++)this[h(1329)][d]=t[d].blendMode,e[h(337)](e[h(545)]+d),e[h(1277)](e[h(891)],t[d][h(1521)]);for(;d<=6;d++)e[h(337)](e[h(545)]+d),e[h(1277)](e[h(891)],this[h(412)]);e.uniform1iv(this._layerBlendModesUniformLocation,this[h(1329)]),e[h(1048)](this[h(1116)],t.length),e[h(499)](this[h(451)],i[h(665)]||0,i[h(839)]||0),e[h(499)](this._tileScaledDimensionsUniformLocation,i[h(424)]??i[h(590)],i[h(454)]??i[h(230)]),e[h(499)](this._imageDimensionsUniformLocation,n.width,n[h(230)]),e[h(1048)](this._isStencilUniformLocation,r?1:0),e.drawArrays(e.TRIANGLES,0,6)}}[t(368)](e){const i=t;if(0===this[i(1508)].layers.length)return;const s=this[i(270)];s[i(662)](this[i(245)]);for(const t of this._imageService[i(502)])this[i(1357)](s,t,e)}_updateAttributeBuffersForLayer(e,i,s){const r=t;e[r(662)](this[r(245)]);let n=this._renderLayers.get(i.id);!n&&(n={tiles:[]},this[r(937)][r(766)](i.id,n)),this[r(894)](e,n,i,s)}[t(894)](e,i,r,n){const o=t,h=r.width,a=Math.ceil(r[o(230)]/128);let c=0;for(let t=0;t<a;t++){const l=c,d=Math[o(710)](r[o(230)]/a*(t+1)),u=d-c;c=d;const f={top:l,bottom:d,left:0,right:h};if(i.tiles[t]){if(n&&!(0,s.b8)(n,f))continue;e[o(343)](i[o(852)][t].texture)}const m=Q(e[o(1484)]());i[o(852)][t]={width:h,height:u,range:f,texture:m,blendMode:yt[o(1006)](r[o(1102)])||1},r[o(665)]&&(i[o(852)][t][o(665)]=r[o(665)]),r.offsetY&&(i.tiles[t][o(839)]=r[o(839)]),e[o(337)](e[o(545)]+0),e.bindTexture(e[o(891)],m),e[o(1515)](e[o(891)],e[o(600)],e[o(299)]),e[o(1515)](e[o(891)],e[o(276)],e[o(1024)]),e[o(1515)](e[o(891)],e.TEXTURE_WRAP_S,e[o(818)]),e[o(1515)](e[o(891)],e[o(870)],e[o(818)]),e.texImage2D(e[o(891)],0,e.RGBA,h,u,0,e[o(348)],e[o(1518)],r[o(1525)],l*r[o(590)]*4)}}[t(527)](){const e=t;this[e(615)][0]=this._viewportService[e(1343)]*this[e(1508)][e(590)],this[e(615)][1]=this[e(971)].zoom*this[e(1508)][e(230)]}[t(1488)](){const e=t;this[e(165)]=J(0,this[e(270)].canvas[e(590)],this[e(270)].canvas[e(230)],0,-1,1)}}class xt{constructor(e){const i=t;this._gl=e;const s=this[i(270)];this[i(802)]=Q($(s,ft(),dt())),this[i(245)]=Q(s[i(287)]()),s[i(662)](this[i(245)]),this[i(363)]=Q(s.createFramebuffer()),this[i(1135)]=it(s),s[i(1189)](s[i(714)],this[i(363)]);const r=s[i(945)]();s[i(1221)](s[i(1514)],r),s.bufferData(s.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,-1,-1,1,1,1]),s[i(258)]),s[i(782)](0),s[i(461)](0,2,s[i(893)],!1,0,0),this._textureAUniformLocation=Q(s[i(910)](this._program,"b")),this[i(903)]=Q(s[i(910)](this._program,"c")),this[i(247)]=Q(s[i(910)](this[i(802)],"a"))}blend(e,i,s,r=!0){const n=t,o=this[n(270)];return o[n(437)](this[n(802)]),o[n(662)](this[n(245)]),r?(o[n(1189)](o[n(714)],this[n(363)]),o[n(1242)](o[n(714)],o[n(501)],o[n(891)],this[n(1135)],0)):o[n(1189)](o[n(714)],null),o[n(337)](o[n(545)]),o[n(1277)](o[n(891)],e),o[n(1048)](this._textureAUniformLocation,0),o[n(337)](o[n(545)]+1),o[n(1277)](o[n(891)],i),o[n(1048)](this._textureBUniformLocation,1),o[n(1048)](this[n(247)],s),o.drawArrays(o.TRIANGLES,0,6),o[n(337)](o.TEXTURE0),o[n(1277)](o.TEXTURE_2D,null),o.activeTexture(o[n(545)]+1),o[n(1277)](o[n(891)],null),o[n(1189)](o[n(714)],null),this._frameBufferTexture}[t(525)](){const e=t;this[e(270)].deleteTexture(this[e(1135)]),this[e(1135)]=it(this[e(270)])}}class St{constructor(e,i){const s=t;this[s(270)]=e,this._viewportService=i,this[s(422)]=tt();const r=this[s(270)];this[s(802)]=Q($(r,pt(),gt())),this._vertexArrayObject=Q(r.createVertexArray()),r.bindVertexArray(this[s(245)]),this[s(914)]=Q(r[s(910)](this._program,"c")),this[s(1301)]=Q(r[s(910)](this[s(802)],"a")),this[s(372)]=Q(r[s(910)](this[s(802)],"b")),this[s(363)]=Q(r[s(179)]()),this[s(1135)]=it(r),r[s(1189)](r[s(714)],this[s(363)]),this[s(826)]=Q(r[s(945)]()),r[s(1221)](r[s(1514)],this[s(826)]),r[s(782)](0),r[s(461)](0,2,r[s(893)],!1,0,0)}[t(1418)](e,i){const s=t,r=this[s(270)];r[s(437)](this[s(802)]),r[s(662)](this[s(245)]),r[s(1189)](r[s(714)],this[s(363)]),r[s(1242)](r[s(714)],r.COLOR_ATTACHMENT0,r[s(891)],this[s(1135)],0),r.clear(r[s(595)]),et(r,this._matrixUniformLocation,e,this[s(971)],this[s(422)]),r[s(499)](this[s(372)],this[s(971)][s(1343)],this._viewportService.zoom);for(const t of i){r[s(754)](this[s(914)],t.color[0]/255,t.color[1]/255,t[s(177)][2]/255,t[s(177)][3]/255),r[s(1221)](r[s(1514)],this._rangeBuffer);const e=new Float32Array(12*t[s(529)][s(589)]);for(let i=0;i<t.ranges[s(589)];i++){const r=t[s(529)][i],n=12*i;e[n]=e[n+2]=e[n+8]=r.left,e[n+1]=e[n+5]=e[n+7]=r[s(1171)],e[n+4]=e[n+6]=e[n+10]=r.right,e[n+3]=e[n+9]=e[n+11]=r.bottom}r.bufferData(r[s(1514)],e,r[s(998)]),r[s(1147)](r.TRIANGLES,0,e[s(589)]/2)}return this[s(1135)]}[t(525)](){const e=t;this[e(270)][e(343)](this[e(1135)]),this[e(1135)]=it(this[e(270)])}}const Ct="#version 300 es\nlayout (location = 0"+t(1385)+t(1092)+t(1314)+"u_matrix"+t(867),Et=t(1009)+"u_color"+t(616)+t(278)+t(187);class Lt extends e.JT{constructor(e,i,s){const r=t;super(),this._gl=e,this[r(1508)]=i,this._viewportService=s,this[r(713)]=2,this[r(1389)]=new Float32Array(48),this[r(422)]=tt(),this[r(197)]=!0,this._matrixNeedsUpdate=!0,this[r(1336)]=new Float32Array(4);const n=this[r(270)];this[r(802)]=Q($(n,Ct,Et)),this[r(245)]=Q(n[r(287)]()),n.bindVertexArray(this[r(245)]),this[r(1458)]=Q(n.createBuffer()),this[r(578)]=Q(n[r(910)](this._program,r(278))),this[r(216)]=Q(n[r(910)](this[r(802)],r(1092))),this[r(692)](),n[r(1221)](n[r(1514)],this[r(1458)]),n[r(782)](0),n[r(461)](0,2,n[r(893)],!1,0,0),this.register(this[r(1508)].onChangedDimensions((()=>{this._positionsNeedsUpdate=!0,this._matrixNeedsUpdate=!0}))),this[r(1076)](this[r(971)][r(913)]((()=>{const t=r;this._matrixNeedsUpdate=!0,this[t(197)]=!0})))}refreshTheme(){const e=t,i=function(e){const i=t;switch(e[i(589)]){case 7:return(parseInt(e.slice(1),16)<<8|255)>>>0;case 9:return parseInt(e[i(953)](1),16)>>>0}throw new Error(i(984))}(window[e(697)](document[e(248)])[e(1293)](e(322))||e(1173));this[e(1336)][0]=(i>>24&255)/255,this[e(1336)][1]=(i>>16&255)/255,this[e(1336)][2]=(i>>8&255)/255,this[e(1336)][3]=(255&i)/255}[t(1070)](){const e=t,i=this[e(1508)][e(280)];if(!i)return;const s=this._gl;s[e(437)](this._program),s[e(662)](this[e(245)]),s.disable(s[e(162)]),s.uniform4f(this[e(578)],this._backgroundColor[0],this._backgroundColor[1],this[e(1336)][2],this[e(1336)][3]),this[e(368)](s,i,this._viewportService),this._updateMatrixUniform(s,i,this[e(971)]),s[e(1147)](s[e(674)],0,24)}[t(368)](e,i,s){const r=t;if(!this[r(197)])return;e[r(662)](this[r(245)]),e[r(1221)](e.ARRAY_BUFFER,this[r(1458)]);const n=this[r(316)](),o=this[r(1389)];o[0]=o[2]=o[36]=o[38]=o[40]=o[44]=n[r(1375)],o[4]=o[6]=o[32]=o[34]=o[42]=o[46]=0,o[8]=o[10]=o[18]=o[22]=o[26]=o[28]=o[30]=i[r(590)]*s[r(1343)],o[12]=o[14]=o[16]=o[20]=o[24]=n.right,o[1]=o[5]=o[9]=o[13]=n[r(1171)],o[3]=o[7]=o[11]=o[15]=o[17]=o[19]=o[45]=o[47]=0,o[21]=o[23]=o[31]=o[35]=o[39]=o[41]=o[43]=i.height*s[r(1343)],o[25]=o[27]=o[29]=o[33]=o[37]=n[r(459)],e[r(709)](e[r(1514)],this[r(1389)],e[r(258)]),this._positionsNeedsUpdate=!1}[t(551)](e,i,s){const r=t;this[r(1461)]&&(et(e,this[r(216)],i,s,this._workMatrices),this[r(1461)]=!1)}[t(316)](){const e=t,i=this._screenPixelToCanvasCoord(-1,-1),s=this[e(855)](this[e(270)][e(572)][e(590)],this[e(270)][e(572)][e(230)]);return{left:i[0],top:i[1],right:s[0],bottom:s[1]}}[t(855)](e,i){const s=t,r=this[s(270)];let n=e-r[s(572)][s(590)]/2,o=i-r.canvas[s(230)]/2;return n+=this[s(1508)].width*this[s(971)][s(1343)]/2,o+=this[s(1508)][s(230)]*this[s(971)].zoom/2,n-=this[s(971)].x*this._viewportService.zoom,o-=this[s(971)].y*this[s(971)].zoom,[n,o]}}const Tt=t(842)+0+t(1385)+t(1092)+t(1097)+t(1092)+t(1318),It=t(1300)+t(249)+t(605)+"u_pixelsize"+t(933)+"u_pixelsize"+t(1497)+"u_pixelsize, 1.) < 1. / "+t(249)+t(742);class At extends e.JT{constructor(e,i,s){const r=t;super(),this[r(270)]=e,this[r(1508)]=i,this._viewportService=s,this[r(713)]=2,this[r(1389)]=new Float32Array(8),this._workMatrices=tt(),this._positionsNeedsUpdate=!0,this._matrixNeedsUpdate=!0;const n=this[r(270)];this[r(802)]=Q($(n,Tt,It)),this[r(245)]=Q(n.createVertexArray()),n.bindVertexArray(this[r(245)]),this._positionBuffer=Q(n[r(945)]()),this[r(216)]=Q(n.getUniformLocation(this._program,r(1092))),this._pixelSizeLocation=Q(n[r(910)](this[r(802)],r(249))),n[r(1221)](n[r(1514)],this._positionBuffer),n[r(782)](0),n.vertexAttribPointer(0,2,n[r(893)],!1,0,0),this[r(1076)](this[r(1508)][r(327)]((()=>{const t=r;this[t(197)]=!0,this[t(1461)]=!0}))),this[r(1076)](this[r(971)][r(913)]((()=>{const t=r;this[t(1461)]=!0,this[t(197)]=!0})))}[t(1070)](){const e=t,i=this[e(1508)][e(280)];if(!i)return;if(!this[e(971)][e(863)]||this[e(971)].zoom<4)return;const s=this._gl;s[e(437)](this[e(802)]),s[e(662)](this._vertexArrayObject),s[e(1538)](s[e(162)]),s.blendFuncSeparate(s[e(1493)],s[e(634)],s[e(255)],s[e(634)]),this[e(368)](s,i,this[e(971)]),this[e(551)](s,i,this[e(971)]),s[e(814)](this[e(904)],this[e(971)][e(1343)]/1),s[e(1147)](s[e(1194)],0,4)}[t(368)](e,i,s){const r=t;this._positionsNeedsUpdate&&(e[r(662)](this[r(245)]),e[r(1221)](e[r(1514)],this._positionBuffer),this[r(1389)][4]=this[r(1389)][6]=i[r(590)]*s[r(1343)],this[r(1389)][3]=this[r(1389)][5]=i.height*s[r(1343)],e.bufferData(e[r(1514)],this._positionsArray,e[r(258)]),this[r(197)]=!1)}[t(551)](e,i,s){const r=t;this[r(1461)]&&(et(e,this[r(216)],i,s,this._workMatrices),this[r(1461)]=!1)}}const Rt=t(842)+0+t(1385)+"u_matrix;\n\nvoid main() {\n  gl_Position = "+t(1092)+t(867),Bt=t(1300)+t(912)+t(170)+t(912)+") / 4., 2.));\n  outColor = vec4(c, c, c, 1);\n}";class Mt extends e.JT{constructor(e,i,s,n){const o=t;super(),this[o(270)]=e,this[o(1508)]=i,this[o(1531)]=s,this[o(971)]=n,this[o(713)]=2,this[o(1389)]=new Float32Array(8),this[o(422)]=tt(),this[o(197)]=!1,this[o(1461)]=!0,this[o(1047)]=0,this[o(453)]=!1,this[o(1446)]=this[o(1076)](new r.v),this[o(596)]=this._onStartAnimating[o(1349)],this._onStopAnimating=this[o(1076)](new r.v),this[o(1409)]=this._onStopAnimating[o(1349)];const h=this[o(270)];this[o(802)]=Q($(h,Rt,Bt)),this[o(245)]=Q(h[o(287)]()),h[o(662)](this[o(245)]),this[o(1458)]=Q(h.createBuffer()),this[o(216)]=Q(h[o(910)](this[o(802)],o(1092))),this._shiftLocation=Q(h[o(910)](this[o(802)],"u_shift")),h[o(1221)](h[o(1514)],this[o(1458)]),h[o(782)](0),h[o(461)](0,2,h[o(893)],!1,0,0),this.register(this[o(1531)][o(913)]((()=>{const t=o;this[t(197)]=!0,this[t(453)]!==!!this[t(1531)][t(1231)]&&(this[t(453)]=!!this[t(1531)][t(1231)],this[t(453)]?this[t(1446)][t(617)]():this._onStopAnimating[t(617)]())}))),this[o(1076)](this[o(1508)][o(327)]((()=>{this._matrixNeedsUpdate=!0,this._positionsNeedsUpdate=!0}))),this[o(1076)](this[o(971)].onUpdate((()=>{this[o(1461)]=!0,this._positionsNeedsUpdate=!0})))}[t(1070)](){const e=t,i=this[e(1508)].currentLayer;if(!i)return;const s=this[e(1531)][e(1231)];if(!s)return;const r=this._gl;r[e(437)](this._program),r[e(662)](this[e(245)]),r[e(1538)](r[e(162)]),r[e(457)](r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this[e(368)](r,s,this[e(971)]),this._updateMatrixUniform(r,i,this[e(971)]),r.drawArrays(r[e(233)],0,4)}[t(1042)](){const e=t;this[e(496)](this[e(270)])}_updateAttributeBuffers(e,i,s){const r=t;this[r(197)]&&(e.bindVertexArray(this[r(245)]),e[r(1221)](e[r(1514)],this[r(1458)]),this._positionsArray[0]=this._positionsArray[2]=i[r(1375)]*s.zoom-.5,this[r(1389)][4]=this[r(1389)][6]=i[r(890)]*s[r(1343)]+.5,this[r(1389)][1]=this[r(1389)][7]=i.top*s.zoom-.5,this[r(1389)][3]=this[r(1389)][5]=i[r(459)]*s.zoom+.5,e[r(709)](e[r(1514)],this[r(1389)],e[r(258)]),this[r(197)]=!1)}[t(551)](e,i,s){const r=t;this[r(1461)]&&(et(e,this._matrixLocation,i,s,this[r(422)]),this._matrixNeedsUpdate=!1)}[t(496)](e){const i=t;e[i(437)](this[i(802)]),e[i(662)](this._vertexArrayObject),this[i(1047)]=(this[i(1047)]+1)%8,e.uniform1f(this[i(1118)],this[i(1047)])}}const Dt=t(842)+0+t(1385)+t(1092)+t(1314)+t(1092)+t(867),Pt=t(1296);class Ut extends e.JT{constructor(e,i,s,r,n){const o=t;super(),this[o(270)]=e,this[o(1508)]=i,this[o(1531)]=s,this[o(1005)]=r,this[o(971)]=n,this[o(713)]=2,this[o(1117)]=new Float32Array(8),this[o(422)]=tt(),this[o(197)]=!1,this[o(1461)]=!0;const h=this[o(270)];this[o(802)]=Q($(h,Dt,Pt)),this[o(245)]=Q(h.createVertexArray()),h.bindVertexArray(this[o(245)]),this[o(1458)]=Q(h[o(945)]()),this[o(216)]=Q(h[o(910)](this[o(802)],o(1092))),h[o(1221)](h[o(1514)],this[o(1458)]),h.enableVertexAttribArray(0),h.vertexAttribPointer(0,2,h[o(893)],!1,0,0),this[o(1076)](this[o(1531)][o(913)]((()=>this[o(197)]=!0))),this.register(this[o(971)][o(913)]((()=>{this[o(197)]=!0,this._matrixNeedsUpdate=!0})))}[t(1070)](){const e=t,i=this._imageService[e(280)];if(!i)return;if(!this[e(1005)].activeTool?.[e(966)])return;const s=this[e(1531)].range;if(!s)return;const r=this[e(270)];r[e(437)](this[e(802)]),r[e(662)](this[e(245)]),function(e,i){const s=t;e[s(1538)](e[s(162)]),e.blendFuncSeparate(e[s(1493)],e[s(634)],e[s(255)],e[s(634)])}(r),this[e(368)](r,s,this._viewportService),this[e(551)](r,i,this[e(971)]),r[e(1147)](r[e(1194)],0,4)}[t(368)](e,i,s){const r=t;this[r(197)]&&(e[r(1221)](e[r(1514)],this[r(1458)]),this._positionArray[0]=this[r(1117)][2]=i[r(1375)]*s[r(1343)],this[r(1117)][4]=this[r(1117)][6]=i[r(890)]*s[r(1343)],this[r(1117)][1]=this._positionArray[7]=i[r(1171)]*s[r(1343)],this._positionArray[3]=this[r(1117)][5]=i[r(459)]*s.zoom,e.bufferData(e[r(1514)],this[r(1117)],e.DYNAMIC_DRAW),this[r(197)]=!1)}_updateMatrixUniform(e,i,s){const r=t;this[r(1461)]&&(et(e,this[r(216)],i,s,this._workMatrices),this[r(1461)]=!1)}}class kt extends e.JT{constructor(i,s,r,n,o){const h=t;super(),this._container=i,this[h(1508)]=s,this[h(1531)]=r,this[h(1005)]=n,this._viewportService=o,this._renderPrograms=[],this[h(675)]=[],this[h(1447)]=new Set,this[h(406)]=0,this[h(1312)]=0,this[h(1004)]=!1,this[h(851)]=0,this[h(1069)]=!1,this._toolRenderPrograms=[],this._toolDisposables=[],this[h(1530)]=document.createElement(h(572)),this[h(791)]=document[h(1067)](h(572)),this[h(791)][h(738)][h(1046)]("animation"),this[h(370)]=document.createElement(h(1439)),this[h(370)].classList.add(h(729)),this._container[h(931)](this[h(1530)],this[h(791)],this[h(370)]),this[h(1076)]({dispose:()=>{const t=h;this[t(1530)][t(409)]&&this._container[t(507)](this._canvas),this._canvas[t(409)]&&this[t(449)][t(507)](this[t(791)]),this._container[t(507)](this[t(370)])}}),this[h(1076)](this._viewportService[h(401)](((t,e)=>{const i=h;this[i(624)](t,e),this.render(),this[i(1136)](!0)}))),this[h(1076)](this[h(971)][h(913)]((()=>{const t=h;this[t(1070)](),this[t(1136)](!0)}))),this.register(this[h(1531)].onUpdate((()=>this[h(1136)](!0)))),this.register(this[h(1508)].onUpdate((()=>this[h(1070)]()))),this[h(1076)](this._imageService[h(1210)]((()=>this[h(1070)]()))),this[h(1076)](this[h(1508)][h(1011)]((()=>this.render()))),this[h(1076)](this._toolService[h(419)]((t=>this[h(836)](t)))),this[h(1076)]((0,e.Lw)(this[h(1530)],h(1325),(()=>this._showError(h(221)))));const a=this[h(1530)].getContext(h(1536),{antialias:!1,premultipliedAlpha:!1,stencil:!0});if(!a){const t="WebGL2 is not supported";throw this[h(234)](t),new Error(t)}this[h(270)]=a,this[h(585)]=Q(this[h(791)].getContext(h(1536),{antialias:!1})),this[h(624)](this[h(449)][h(448)],this._container[h(1041)]),this[h(270)][h(1417)](0,0,0,0),this._gl[h(1021)](this[h(270)][h(595)]),this._glSelection.clearColor(0,0,0,0),this[h(585)][h(1021)](this[h(270)][h(595)]),this[h(199)][h(1463)](new Lt(this[h(270)],this[h(1508)],this[h(971)])),this[h(199)][h(1463)](new nt(this[h(270)],this._imageService,this._viewportService)),this[h(544)]=new bt(this[h(270)],this[h(1508)],this[h(1531)],this._viewportService),this[h(199)].push(new At(this._gl,this[h(1508)],this[h(971)])),this._animationRenderPrograms[h(1463)](new Ut(this[h(585)],this[h(1508)],this[h(1531)],this[h(1005)],this[h(971)])),this[h(675)][h(1463)](new Mt(this[h(585)],this[h(1508)],this[h(1531)],this[h(971)]));for(const t of this[h(675)])t[h(596)]&&t[h(1409)]&&(t[h(596)]((()=>this[h(1387)](t))),t[h(1409)]((()=>this[h(306)](t))));this[h(1070)]();let c=this._imageService[h(913)]((()=>{const t=h;this[t(449)].classList[t(1046)](t(923)),c?.[t(1424)](),c=void 0}));this[h(1076)]({dispose:()=>c?.[h(1424)]()});const l=new MutationObserver((()=>{const t=h;for(const e of this[t(199)])e[t(692)]&&e.refreshTheme();this.render()}));l[h(994)](document.documentElement,{attributes:!0,attributeFilter:[h(341)]}),this.register({dispose:()=>l[h(194)]()})}[t(624)](e,i){const s=t,r=Math[s(376)](e),n=Math[s(376)](i);this[s(1530)].width=r,this[s(1530)][s(230)]=n,this[s(791)].width=r,this._canvasSelection[s(230)]=n,this[s(270)][s(1266)](0,0,r,n),this[s(585)][s(1266)](0,0,r,n),this[s(370)][s(341)][s(1384)]=s(700),this[s(370)].style[s(1375)]="0",this[s(370)][s(341)][s(1171)]="0",this[s(370)][s(341)][s(890)]="0",this[s(370)][s(341)][s(459)]="0",this[s(544)]?.[s(525)]()}pause(){this._isPaused=!0}[t(384)](){const e=t;this[e(1069)]&&(this[e(1069)]=!1,this.render(),this[e(1136)](!0))}[t(1070)](){const e=t;0===this[e(406)]&&(this[e(406)]=window[e(841)]((()=>this._render())))}[t(1136)](e=!1){const i=t;if(this[i(1069)]&&!e)return window.cancelAnimationFrame(this[i(1312)]),void(this._selectionAnimationFrame=0);this[i(1004)]=this[i(1004)]||e,0===this[i(1312)]&&(this[i(1312)]=window[i(841)]((()=>this._renderSelection())))}_render(){const e=t;this[e(203)](this[e(199)],1),!this[e(1005)][e(1057)]?.[e(966)]&&this[e(203)](this[e(1376)],1),this[e(544)][e(1070)](),this._renderProgramsWithOrder(this[e(199)],2),!this[e(1005)].activeTool?.isSelectionTool&&this._renderProgramsWithOrder(this[e(1376)],2),this[e(406)]=0}_renderSelection(){const e=t,i=!!this._selectionService.range;if(this[e(791)][e(341)][e(398)]=e(i?399:606),this[e(1312)]=0,!i)return void(this[e(1004)]=!1);const s=this[e(851)]<=Date[e(325)]()-50;if(!this[e(1004)]&&!s)return this[e(1004)]=!1,void this[e(1136)]();if(this[e(1004)]=!1,s){for(const t of this[e(675)])t.updateAnimation&&t[e(1042)]();this._lastAnimationFrame=Date[e(325)]()}this[e(1447)][e(625)]>0&&this[e(203)](this[e(675)],2),this[e(1005)][e(1057)]?.[e(966)]&&this[e(203)](this._toolRenderPrograms,2),this.renderSelection()}[t(203)](e,i){const s=t;for(const t of e)t[s(713)]===i&&t[s(1070)]()}[t(1387)](e){const i=t;this[i(1447)][i(1046)](e),this[i(1136)]()}[t(306)](e){const i=t;this._activeAnimatingRenderPrograms[i(769)](e)}[t(836)](i){const s=t;(0,e._c)(this[s(1430)]),this._toolDisposables[s(589)]=0;for(const t of this[s(1376)])t[s(1424)]&&t[s(1424)]();let r;this[s(1376)][s(589)]=0,i[s(964)]?r=i[s(964)](this[s(270)]):i.createDomRenderProgram&&(r=i.createDomRenderProgram(this._viewsElement)),r&&(Array[s(1012)](r)?this[s(1376)].push(...r):this[s(1376)].push(r),i[s(1210)]&&this[s(1430)][s(1463)](i[s(1210)]((()=>this[s(1070)]())))),r&&this[s(1070)]()}[t(234)](e){const i=t;this[i(1530)].parentElement&&this[i(449)].removeChild(this._canvas);const s=document[i(1067)]("div");s[i(899)]=e,s.style.position=i(700),s[i(341)].left=i(701),s.style[i(1171)]="50%",s[i(341)][i(1132)]=i(1466),this._container[i(738)][i(1261)](i(923)),this[i(449)][i(1154)](s)}}class Ft extends e.JT{constructor(e,i,s,r,n){const o=t;super(),this[o(1500)]=e,this[o(1508)]=i,this[o(1531)]=s,this[o(1005)]=r,this[o(971)]=n,this.register(this[o(1500)][o(1304)]((t=>this[o(210)](t)))),this[o(1076)]({dispose:()=>this[o(429)]?.dispose()})}[t(1070)](){this[t(429)]?.render()}[t(601)](){this[t(429)]?.pause()}[t(384)](){const e=t;this[e(429)]?.[e(384)]()}[t(210)](e){const i=t;this[i(429)]?.[i(1424)](),this[i(429)]=new kt(e,this[i(1508)],this[i(1531)],this[i(1005)],this[i(971)])}}class Nt{constructor(e,i,s,r,n){const o=t;this[o(1531)]=e,this[o(1090)]=i,this.requiresTool=s,this[o(369)]=r,this[o(1028)]=n,this[o(1404)]=o(1517),this[o(506)]=0}[t(799)](){const e=t;this[e(561)](this[e(369)])}[t(240)](){const e=t;this._apply(this[e(1028)])}_apply(e){const i=t;this[i(1531)][i(1231)]=e?{left:e.left,top:e[i(1171)],right:e[i(890)],bottom:e[i(459)]}:void 0}[t(1180)](){const e=t;return{id:e(1517),operationName:this[e(1090)],requiresTool:this[e(1209)],undoRange:this[e(369)],redoRange:this[e(1028)]}}static[t(1239)](e,i){const s=t;return new Nt(e,i[s(1090)],i[s(1209)],i[s(369)],i[s(1260)])}}class Ot extends e.JT{constructor(e,i){const s=t;super(),this[s(1508)]=e,this[s(391)]=i,this._onUpdate=this[s(1076)](new r.v),this[s(913)]=this[s(924)][s(1349)],this[s(391)][s(397)](s(1517),{undo:t=>{const e=s;t[e(799)](this[e(344)]),this[e(612)]=t[e(369)]},redo:t=>{const e=s;t[e(240)](this[e(344)]),this[e(612)]=t.undoRange}}),this[s(391)][s(576)](s(1517),Nt.create[s(1356)](null,this))}get[t(1231)](){return this[t(344)]}set[t(1231)](e){const i=t;if(e&&(e.left>e[i(890)]||e.top>e[i(459)]))throw new Error("Invalid range - left: "+e.left+", right: "+e[i(890)]+i(1519)+e[i(1171)]+i(1115)+e[i(459)]);this[i(344)]=e,this[i(924)].fire()}[t(1411)](e,i){if(!this[t(344)])return;const r=(0,s.BN)(this.range);(0,s.Hd)(r,e,i),this.range=r}[t(265)](e,i){const s=t;this[s(344)]&&(this[s(344)][s(1375)]>=e||this[s(344)][s(1171)]>=i||this[s(344)][s(459)]<=0||this._range.right<=0?this[s(344)]=void 0:this[s(1231)]={left:Math.max(this._range[s(1375)],0),top:Math[s(1487)](this[s(344)].top,0),right:Math.min(this._range[s(890)],e),bottom:Math[s(1321)](this[s(344)][s(459)],i)})}[t(1141)](){const e=t;this[e(1231)]=void 0,this[e(878)](e(960))}async erase(){const e=t,i=this._range;if(!i)return;const s=this[e(1508)][e(280)];s&&(await(this[e(1508)][e(280)]?.[e(538)]()),await this[e(391)][e(719)]("Erase Selection",(async()=>{const t=e;await this[t(391)][t(1271)](new P.Z("Erase Selection",i,s,((e,s)=>{const r=t;for(let t=i[r(1171)];t<i[r(459)];t++){const n=t*s*4;e.fill(0,n+4*i.left,n+4*i[r(890)])}}))),this[t(1141)]()})))}selectAll(){const e=t;this[e(1231)]={left:0,top:0,right:this[e(1508)][e(590)],bottom:this[e(1508)][e(230)]},this.commit(e(297))}[t(878)](e,i){const s=t;if(function(e,i){const s=t;return i&&e?e.left===i[s(1375)]&&e.top===i[s(1171)]&&e.right===i[s(890)]&&e[s(459)]===i[s(459)]:!e&&!i}(this[s(612)],this.range))return;const r=new Nt(this,e,i,this[s(612)],this.range);this[s(391)][s(1017)](r),this._lastCommittedRange=this[s(1231)]}[t(1020)](e,i){const s=t;return!this._range||e>=this[s(344)][s(1375)]&&e<this._range[s(890)]&&i>=this[s(344)][s(1171)]&&i<this[s(344)][s(459)]}[t(1180)](){return this[t(344)]}deserialize(e){this[t(1231)]=e}}var Ht=i(7166);class Vt{constructor(e,i,s){this[t(1090)]=e,this._layer=i,this._f=s}async[t(365)](){const e=t,i={data:(0,Ht.Qf)(this._layer,(0,s.DI)(this._layer[e(590)],this[e(264)][e(230)])),width:this[e(264)][e(590)],height:this[e(264)][e(230)]};let r;await this._layer[e(201)]((async(t,e,i)=>(r=await this._f(t,e,i),r)));const n={data:(0,Ht.Qf)(r,(0,s.DI)(r[e(590)],r[e(230)])),width:r[e(590)],height:r.height};return new L(this[e(1090)],this[e(264)],i,n)}}class zt{constructor(e,i,s,r){const n=t;this[n(433)]=e,this[n(1508)]=i,this[n(1291)]=s,this[n(413)]=r}[t(365)](){const e=t;if(this[e(1508)].width===this[e(1291)]&&this[e(1508)].height===this[e(413)])return;const i={width:this[e(1508)][e(590)],height:this[e(1508)].height},s={width:this[e(1291)],height:this[e(413)]},r=new b(this[e(433)],i,s);return r[e(240)](this[e(1508)].resize.bind(this._imageService)),r}}class jt extends e.JT{constructor(e,i,s,n){const o=t;super(),this[o(391)]=e,this[o(1508)]=i,this._selectionService=s,this[o(1233)]=n,this[o(1407)]=this[o(1076)](new r.v),this[o(872)]=this[o(1407)][o(1349)],this[o(1469)]=this[o(1076)](new r.v),this[o(722)]=this[o(1469)].event}async[t(396)](e,i){const s=t,r=this[s(1508)].layers;if(0===r.length)return;await this[s(1469)][s(1428)](this[s(469)](e));const n={left:0,top:0,right:this[s(1508)][s(590)],bottom:this[s(1508)][s(230)]},o="Image: "+Wt(e);await this[s(391)][s(719)](o,(async()=>{const t=s;let h;for(const s of r)h=await this[t(1177)](e,i,s,o,n);h&&(h[t(1322)][t(590)]!==n[t(890)]||h[t(1322)].height!==n[t(459)])&&this[t(391)].runSyncAction(new zt(t(1250),this[t(1508)],h[t(1322)][t(590)],h.dest[t(230)])),h?.[t(1517)]!==this[t(1531)][t(1231)]&&(this[t(1531)].range=h?.[t(1517)],this._selectionService[t(878)](t(792)))}))}async executeOnSingleLayer(e,i){const s=t,r=this._imageService.currentLayer;if(!r)return;await this._onBeforeRunLayerTask.fireAndWait(this._getBeforeRunLayerTaskEvent(e));const n={left:0,top:0,right:r[s(590)],bottom:r.height},o=s(1319)+Wt(e);await this._historyService[s(719)](o,(async()=>{const t=s,h=await this._doExecuteOnLayer(e,i,r,o,n);if(h?.selection!==this[t(1531)].range&&(this[t(1531)][t(1231)]=h?.[t(1517)],this[t(1531)][t(878)]("Update Selection")),h&&(h[t(1322)][t(590)]!==n[t(890)]||h[t(1322)][t(230)]!==n.bottom))throw new Error(t(513))}))}async[t(1177)](e,i,s,n,o){const h=t;let a;return await this._historyService[h(1271)](new Vt(n,s,(async(t,s,n)=>{const o=h,c=this[o(1233)][o(1259)](e,i,{data:t,width:s,height:n},this._selectionService[o(1231)]);return(0,r.B)(c[o(872)],this[o(1407)]),a=await c[o(886)],a[o(1322)]}))),a}[t(469)](e){return{finishSelection:e!==t(1294)}}}function Wt(e){const i=t;switch(e){case i(1060):return i(778);case i(445):return"Crop to Selection";case i(1294):return i(632);case i(1540):return i(972);case i(1394):return i(304);case i(1179):return"Invert Colors";case i(961):return i(1250);case i(915):return i(618);case i(385):return i(602);case"layer/rotate90Clockwise":return i(1298);case i(770):return i(554);default:return i(649)}}function qt(){const e=t;return new Worker(i.p+e(880))}const Gt=new Map;Gt[t(766)](t(466),(e=>e.range[t(459)]-e[t(1231)].top)),Gt[t(766)](t(653),(e=>e[t(653)].height)),Gt.set(t(326),(e=>e[t(1231)].bottom-e.range.top)),Gt[t(766)]("fillContiguous",(()=>1)),Gt[t(766)]("fillGlobal",(()=>1)),Gt[t(766)]("generatePreview",(t=>t.destImage.height)),Gt[t(766)](t(1002),(e=>e[t(1481)][t(459)]-e[t(1481)][t(1171)]));let Xt=!1;class Jt extends e.JT{get disableWorkers(){return Xt}set disableWorkers(t){Xt=t}[t(1259)](t,e,i,s){return new Kt(t,e,i,s)}[t(584)](e,i){const s=t;return new $t(e,i,this[s(219)](e,i))[s(886)]}[t(219)](e,i){const s=t,r=Gt[s(1006)](e);if(!r)throw new Error(s(708)+e+'"');return r(i)}async[t(1359)](e,i,s){const r=t,n={sourceImage:e,destImage:(0,Ht.uF)(i,s)};await this[r(584)]("generatePreview",n);const o=new ImageData(new Uint8ClampedArray(n[r(432)].data),n.destImage[r(590)],n[r(432)][r(230)]);return createImageBitmap(o)}}class Yt extends e.JT{constructor(e,i){const s=t;super(),this[s(1437)]=e,this[s(1150)]=i,this[s(1513)]=0,this[s(744)]=0,this[s(1407)]=this[s(1076)](new r.v),this[s(872)]=this[s(1407)][s(1349)],this[s(161)]=performance[s(325)](),this[s(1455)]=setInterval((()=>this[s(1347)]()),1e3)}_finish(){const e=t;this[e(1455)]&&(clearInterval(this[e(1455)]),this[e(1455)]=0,this._logProgress())}[t(313)](e,i){this[t(1150)][e]=i,this._queueProgress()}[t(1225)](){const e=t;!this[e(744)]&&(this[e(744)]=window[e(1226)]((()=>{const t=e;this._reportProgress(),this[t(744)]=0}),0))}[t(1103)](){const e=t,i=this._progress[e(970)](((t,e)=>t+e),0)/this[e(1150)].length;this._progressLast!==i&&(this[e(1407)][e(617)](i),this[e(1513)]=i)}_logProgress(){const e=t,i=this[e(1150)][e(970)](((t,e)=>t+e),0)/this._progress.length,s=Math[e(710)](i/.05),r=20-s;let n="["+"â"[e(716)](s)+" "[e(716)](r)+"]";if(1===i){const t=" "+(performance[e(325)]()-this[e(161)])[e(1408)](0)+"ms ";n="["+t.padStart(t[e(589)]+Math.floor((20-t.length)/2),"â")[e(1320)](20,"â")+"]"}console.info(n+" "+Math[e(710)](100*i)[e(1434)]()[e(549)](3," ")+"% "+this[e(1437)])}}class Kt extends Yt{constructor(e,i,r,n){const o=t,h=o(590)in i&&o(230)in i;let a=h?i[o(590)]:r[o(590)],c=h?i[o(230)]:r[o(230)];switch(e){case o(445):if(!n)throw new Error(o(1272));a=n[o(890)]-n.left,c=n.bottom-n[o(1171)];break;case o(1294):if(!n)throw new Error(o(1516));const t=(0,s.DI)(r[o(590)],r[o(230)]),e=(0,s.qi)(t,n);a=e[o(890)]-e[o(1375)],c=e[o(459)]-e[o(1171)];break;case o(1370):case o(770):a=r[o(230)],c=r[o(590)]}const l=a*c*4,d=o(1322)in i?i.dest:{data:new Uint8Array(new SharedArrayBuffer(l)),width:a,height:c},u=[],f=Math[o(1321)](navigator[o(1442)]||1,Math[o(1487)](d.height/100,1));super(e,new Float32Array(f));for(let t=0;t<f;t++){const s={id:t,yStart:Math[o(1112)](t/f*d.height),yEnd:Math[o(1112)]((t+1)/f*d.height),xStart:Math[o(1112)](t/f*d[o(590)]),xEnd:Math[o(1112)]((t+1)/f*d.width)};u[o(1463)](this._createWorker(e,i,r,d,n,s))}this[o(886)]=Promise[o(446)](u)[o(739)]((()=>(this._finish(),{selection:this.selection,dest:d})))[o(793)]((t=>{throw this[o(1033)](),t}))}[t(1483)](t,e,s,r,n,o){return new Promise((async(h,a)=>{const c=a2_0x41cc;let l;if(Xt){const t=await i.e(174)[c(739)](i[c(1356)](i,9174));l=new Zt(t[c(338)])}else l=new qt;const d={type:c(702),taskName:t,source:s,dest:r,selection:n,options:e,job:o};l[c(759)](d),l[c(683)]=t=>{const e=c;switch(t[e(1525)][e(1404)]){case e(620):this[e(313)](o.id,1),this.selection=t[e(1525)][e(1517)],h(),l[e(988)]();break;case e(483):this[e(313)](o.id,1),a(e(1279)+t[e(1525)][e(661)]),l[e(988)]();break;case e(1087):this._updateProgress(o.id,t[e(1525)][e(1471)])}}}))}}class $t extends Yt{constructor(e,i,s){const r=t,n=[],o=Math[r(1321)](navigator.hardwareConcurrency||1,Math[r(1487)](Math[r(376)](s/100),1));super(e,new Float32Array(o));for(let t=0;t<o;t++){const h=Math.floor(t/o*s),a=Math[r(1112)]((t+1)/o*s),c={id:t,start:h,end:a,size:a-h};n[r(1463)](this[r(1483)](e,i,c))}this[r(886)]=Promise.all(n)[r(739)]((t=>{const e=r;return this[e(1033)](),0===t[e(589)]?void 0:t[0]})).catch((t=>{throw this[r(1033)](),t}))}[t(1483)](t,e,s){return new Promise((async(r,n)=>{const o=a2_0x41cc;let h;if(Xt){const t=await i.e(174).then(i[o(1356)](i,9174));h=new Zt(t[o(338)])}else h=new qt;const a={type:o(321),taskName:t,args:e,job:s};h.onmessage=t=>{const e=o;switch(t[e(1525)][e(1404)]){case"complete":this[e(313)](s.id,1),r(t[e(1525)][e(886)]),h[e(988)]();break;case"error":this._updateProgress(s.id,1),n(e(1279)+t[e(1525)][e(661)]),h.terminate();break;case e(1087):this[e(313)](s.id,t[e(1525)][e(1471)])}},h[o(759)](a)}))}}class Zt{constructor(e){const i=t;this.onmessage=()=>{},this._messageHandler=e(this[i(795)][i(1356)](this))}[t(759)](t){this._messageHandler({data:t})}[t(988)](){}[t(795)](t){this.onmessage({data:t})}}const Qt=new Map([[t(351),{file:t(351)}],[t(382),{file:"eraser"}],[t(874),{file:t(874)}],[t(1197),{file:"movePixels"}],["moveSelection",{file:"moveSelection"}],[t(982),{file:t(982)}],["rectangle",{file:"rectangle"}],[t(1517),{file:t(1517)}],[t(1343),{file:"zoom"}]]);class te extends e.JT{constructor(e,i,s,n,o,h,a,c){const l=t;super(),this[l(391)]=e,this._imageService=i,this[l(380)]=s,this[l(954)]=n,this._selectionService=o,this[l(747)]=h,this[l(1233)]=a,this[l(971)]=c,this._onToolChange=this[l(1076)](new r.v),this[l(419)]=this[l(434)][l(1349)],this[l(404)]={historyService:this[l(391)],imageService:this._imageService,paletteService:this[l(954)],selectionService:this[l(1531)],taskService:this[l(747)],taskWorkerService:this._taskWorkerService,viewportService:this[l(971)]},this._inputService[l(884)]((t=>{const e=l;document[e(1219)].classList[e(980)](e(381),0===t[e(1504)]),document.body[e(738)][e(980)](e(668),2===t[e(1504)])})),this._inputService[l(1205)]((()=>{const t=l;document[t(1219)][t(738)][t(1261)]("mouseleft"),document[t(1219)][t(738)].remove(t(668))})),this[l(391)][l(940)]((t=>this[l(836)](t))),this[l(1508)][l(646)]((t=>{const e=l;t.type===e(1038)&&this[e(836)](e(1197))})),this[l(1528)](this[l(380)][l(269)],l(1395)),this._forwardEventToTool(this[l(380)][l(558)],"keyUp"),this[l(1528)](this[l(380)][l(884)],"pointerDown"),this[l(1528)](this[l(380)].onPointerDownMove,l(1268)),this[l(1528)](this[l(380)][l(1485)],l(767)),this._forwardEventToTool(this[l(380)][l(1205)],l(846))}get[t(1057)](){return this[t(318)]}async[t(836)](e){const i=t;if(e===this[i(318)]?.id)return;if(this[i(318)]?.[i(1424)](),typeof e!==i(680))return void(this[i(318)]=e);const s=Qt.get(e);if(!s)throw new Error(i(311)+e);if(!s[i(1065)]){const t=await this[i(441)](i(1035),s[i(1457)]);s.factory=e=>new t(e)}const r=s.factory(this[i(404)]);this[i(318)]=r,document[i(1219)][i(659)](i(996),r.id),this[i(1138)](r),r[i(1337)]&&r[i(1337)]((()=>this[i(1138)](r))),this._onToolChange.fire(r)}[t(1138)](e){const i=t;e[i(644)]?document[i(1219)][i(659)]("data-tool-state",e[i(644)]):document[i(1219)][i(1340)](i(335))}async[t(441)](e,s){const r=t;return(await i(1038)("./"+e+"/"+s+r(317)))[r(785)]}[t(1528)](e,i){const s=t;this[s(1076)](e((t=>{const e=s,r=this[e(1057)]?this[e(1057)][i]:void 0;r&&r[e(1356)](this[e(1057)])(t,this[e(380)]?.isPointerDown)})))}[t(1180)](){return this[t(318)]?.id}[t(1140)](e){e&&this[t(836)](e)}}const ee=[t(797),t(1425),t(840),t(208)][t(796)](navigator.platform),ie=([t(598),t(1456),"Win32",t(985)][t(796)](navigator[t(938)]),new Uint16Array([1,2,3,4,5,6,7,8,9,10,11,12,13,15,17,19,21,24,27,30,34,38,43,48,54,60,64,70,76,82,90,100]));class se extends e.JT{constructor(e,i,s){const n=t;super(),this._elementService=e,this[n(1508)]=i,this[n(1396)]=20,this[n(1390)]=!0,this[n(1211)]=!1,this._x=0,this._y=0,this._scrollVelocity={x:0,y:0},this[n(1251)]=0,this[n(924)]=this[n(1076)](new r.v),this[n(913)]=this._onUpdate.event,this[n(951)]=this.register(new r.v),this[n(401)]=this[n(951)][n(1349)],this[n(435)]=this[n(1076)](new r.v),this[n(820)]=this._onPixelGridEnabledChange[n(1349)],this[n(174)]=this[n(1076)](new r.v),this[n(637)]=this[n(174)][n(1349)],this[n(171)]=this[n(1076)](new r.v),this[n(962)]=this[n(171)][n(1349)],this[n(1076)](this._imageService[n(327)]((()=>{this.x=this._x,this.y=this._y}))),this.register(this[n(1500)][n(1304)]((t=>{const e=n;this[e(670)]?.[e(194)](),this[e(670)]=new ResizeObserver((([t])=>{const i=e;this[i(951)][i(617)](t.contentRect[i(590)],t[i(1386)][i(230)]),this[i(924)][i(617)]()})),this[e(670)].observe(t)}))),this[n(1076)]({dispose:()=>{const t=n;this[t(670)]?.[t(194)]()}}),this[n(1076)](s[n(1185)]((t=>this[n(1368)](t)))),this[n(1076)](s.onPointerDownMove((t=>this[n(1207)](t)))),this.register(s.onPointerMove((t=>this[n(901)](t)))),this[n(1076)](s.onPointerUp((()=>this[n(1429)]())))}get[t(415)](){const e=t,i=this[e(1500)][e(835)];if(!i)throw new Error(e(1164));const s=i[e(828)]/this[e(1343)],r=i[e(691)]/this[e(1343)],n=this[e(1508)][e(590)]/2-this._x,o=this[e(1508)][e(230)]/2-this._y;return{left:Math[e(1487)](n-s/2,0),right:Math[e(1321)](n+s/2,this[e(1508)].width),top:Math.max(o-r/2,0),bottom:Math[e(1321)](o+r/2,this._imageService.height)}}get[t(1343)](){const e=t;return parseFloat(this._zoom[e(1408)](2))}set[t(1343)](e){const i=t;e<=0||(this[i(1396)]=e,this[i(924)].fire(),this[i(174)][i(617)]())}get[t(863)](){return this[t(1390)]}set[t(863)](e){const i=t;e!==this._isPixelGridEnabled&&(this[i(1390)]=e,this[i(924)][i(617)](),this[i(435)][i(617)]())}get x(){return this._x}set x(e){const i=t,s=this[i(1508)][i(590)]/2;this._x=(0,c.u)(e,s,-s),this[i(924)][i(617)]()}get y(){return this._y}set y(e){const i=t,s=this[i(1508)][i(230)]/2;this._y=(0,c.u)(e,s,-s),this._onUpdate[i(617)]()}[t(383)](e=.2){return this[t(1494)](e)}[t(308)](e=.2){return this[t(1494)](-e)}[t(467)](){const e=t,i=this[e(1500)][e(835)];if(!i)return;const s=(i[e(828)]-10)/this[e(1508)][e(590)],r=(i[e(691)]-10)/this[e(1508)][e(230)];this[e(1343)]=Math[e(1321)](s,r),this._x=0,this._y=0,this[e(1211)]=!0,this._onUpdate[e(617)]()}[t(1368)](e){const i=t;if(this[i(1500)][i(835)]){if(e[i(1473)]){const t=this[i(1343)],s=ee?e.deltaY<0?this.zoomIn(-e.deltaY/20):this[i(308)](e.deltaY/20):e[i(1332)]<0?this[i(383)]():this[i(308)](),r=s/t;if(t!==s){const t=(e[i(587)]-this[i(1500)][i(835)][i(448)]/2)*(r-1),n=(e[i(957)]-this[i(1500)][i(835)][i(1041)]/2)*(r-1);this.x-=t/s,this.y-=n/s}}else!ee&&e.shiftKey?this.x-=this._normalizeWheelDelta(e[i(1332)])/this[i(1343)]:(this.x-=this[i(292)](e.deltaX)/this[i(1343)],this.y-=this[i(292)](e[i(1332)])/this[i(1343)]);this[i(1211)]=!1,e[i(1049)]()}}[t(292)](e){return ee?e:Math[t(556)](e)<100?40*e:e}[t(1207)](e){const i=t,s=this[i(1500)][i(835)];s&&(e.offsetX<30?this[i(655)].x=this._calculateScrollVelocity(30-e[i(665)]):e.offsetX>s[i(448)]-30?this[i(655)].x=-this[i(787)](e.offsetX-s[i(448)]-30):this[i(655)].x=0,e[i(839)]<30?this[i(655)].y=this._calculateScrollVelocity(30-e[i(839)]):e[i(839)]>s[i(1041)]-30?this[i(655)].y=-this[i(787)](e[i(839)]-s[i(1041)]-30):this[i(655)].y=0,!this[i(1251)]&&(this[i(439)](),this[i(1251)]=setInterval((()=>this[i(439)]()),16)))}[t(901)](e){const i=t,s=this._getImageCoordsFromEvent(e);if(void 0!==s||void 0!==this[i(1182)])return void 0===s||void 0===this[i(1182)]?(this[i(1182)]=s,void this[i(171)][i(617)](this[i(1182)])):void(s[0]===this[i(1182)][0]&&s[1]===this[i(1182)][1]||(this[i(1182)]=s,this[i(171)][i(617)](this._pointerCoord)))}[t(787)](e){return 1+Math[t(582)](Math.max(e/20,3),2)}[t(1429)](){const e=t;this._scrollVelocity.x=0,this._scrollVelocity.y=0,clearInterval(this[e(1251)]),this._scrollInterval=0}[t(439)](){const e=t;this[e(1211)]||(this._scrollVelocity.x&&(this.x+=1*this[e(655)].x/this[e(1343)]),this[e(655)].y&&(this.y+=1*this[e(655)].y/this.zoom))}_multiplyZoom(e){const i=t,s=this._zoom+this[i(1396)]*e;if(s<=.02)return this[i(1396)]=.02,this[i(1396)];let r=-1;if(e>0){for(const t of ie)if(t>this._zoom){r=t;break}if(-1===r)return this._zoom;r<s?this._zoom=r:this[i(1396)]=s}else{for(const t of ie){if(t>=this[i(1396)])break;r=t}r>s?this._zoom=r:this[i(1396)]=s}return this[i(924)][i(617)](),this[i(174)][i(617)](),this[i(1396)]}getCoordsFromEvent(e){const i=t,s=this[i(1500)][i(835)];if(!s)throw new Error(i(1412));let r=e[i(665)]-Math[i(1112)](s.clientWidth/2),n=e[i(839)]-Math[i(1112)](s.clientHeight/2);return r/=this[i(1343)],n/=this.zoom,r+=this[i(1508)].width/2,n+=this[i(1508)][i(230)]/2,r-=this.x,n-=this.y,[Math[i(1112)](r),Math[i(1112)](n)]}_getImageCoordsFromEvent(e){const i=t,s=this[i(749)](e);if(!(s[0]<0||s[0]>=this._imageService[i(590)]||s[1]<0||s[1]>=this._imageService[i(230)]))return s}[t(1180)](){const e=t;return{x:this._x,y:this._y,zoom:this[e(1396)]}}[t(1140)](e){const i=t;this._x=e.x,this._y=e.y,this[i(1396)]=e[i(1343)],this._onUpdate[i(617)](),this[i(174)].fire()}}class re extends e.JT{constructor(){const e=t;super(),this[e(1500)]=this.register(new n),this[e(954)]=this.register(new G),this._historyService=this[e(1076)](new h),this._taskWorkerService=this[e(1076)](new Jt),this[e(1508)]=this.register(new j(this[e(391)],this[e(1233)])),this[e(1531)]=this.register(new Ot(this[e(1508)],this[e(391)])),this._inputService=this[e(1076)](new W(this._elementService)),this[e(971)]=this[e(1076)](new se(this._elementService,this[e(1508)],this[e(380)])),this._taskService=this[e(1076)](new jt(this._historyService,this._imageService,this._selectionService,this._taskWorkerService)),this[e(1005)]=this.register(new te(this._historyService,this[e(1508)],this[e(380)],this[e(954)],this[e(1531)],this[e(747)],this[e(1233)],this._viewportService)),this[e(1535)]=this[e(1076)](new Ft(this[e(1500)],this._imageService,this[e(1531)],this[e(1005)],this[e(971)])),this[e(1457)]=new ne(this._historyService,this[e(1508)],this[e(1531)],this[e(1005)],this[e(971)]),this[e(1155)]=new oe(this[e(391)]),this[e(1100)]=new he(this[e(1508)],this[e(1531)],this[e(1233)]),this.palette=new ce(this[e(954)]),this[e(1070)]=new le(this[e(1535)]),this[e(1517)]=new de(this[e(1531)]),this.task=new ue(this._taskService,this[e(1233)]),this[e(307)]=new fe(this[e(1005)],this[e(391)],this[e(1508)],this[e(954)],this[e(1531)],this._viewportService),this[e(1266)]=new me(this._elementService,this._viewportService)}}class ne{constructor(e,i,s,r,n){const o=t;this[o(391)]=e,this[o(1508)]=i,this[o(1531)]=s,this[o(1005)]=r,this[o(971)]=n}[t(1495)](e){return this[t(1508)].exportBlob(e)}[t(645)](e){const i=t;return this[i(1508)][i(645)](e)}[t(1192)](){return this._imageService.exportImage()}[t(992)](){const e=t;return this[e(1508)][e(992)]()}async[t(474)](e){const i=t;await this[i(1508)][i(474)](e),this[i(971)].fitToWindow()}async openImage(e){const i=t;this[i(1508)][i(1109)](e),this[i(971)][i(467)]()}[t(222)](e,i){const s=t;this[s(1508)][s(222)](e,i),this[s(971)][s(467)]()}[t(1450)](e){const i=t;if(e[i(1191)]<3)throw new Error(i(745)+e.version+")");this[i(1508)][i(1140)](e[i(1219)][i(339)]),this[i(391)].deserialize(e[i(1219)][i(1155)]),this[i(1005)][i(1140)](e.body[i(307)]),this[i(1531)][i(1140)](e[i(1219)].selection),this._viewportService[i(1140)](e.body[i(1266)])}[t(410)](e){const i=t;return{version:3,body:{image:this._imageService.serialize(e),history:this[i(391)][i(1180)](e),selection:this[i(1531)][i(1180)](),tool:this[i(1005)][i(1180)](),viewport:this[i(971)][i(1180)]()}}}}class oe{constructor(e){this[t(391)]=e}get[t(1333)](){const e=t;return this[e(391)][e(1333)]}get entries(){const e=t;return this[e(391)][e(939)]}get canRedo(){const e=t;return this._historyService[e(1062)]}get canUndo(){const e=t;return this[e(391)][e(1122)]}get[t(431)](){return this[t(391)].onEntriesChange}[t(240)](){const e=t;return this[e(391)][e(240)]()}[t(799)](){const e=t;return this._historyService[e(799)]()}createCompositeEntry(e,i){return this[t(391)].createCompositeEntry(e,i)}}class he{constructor(e,i,s){const r=t;this._imageService=e,this[r(1531)]=i,this[r(1233)]=s}get[t(590)](){const e=t;return this[e(1508)][e(590)]}get[t(230)](){return this[t(1508)].height}get[t(1467)](){const e=t;return this[e(1508)][e(327)]}get[t(1011)](){const e=t;return this[e(1508)][e(1011)]}get onLayerVisibilityChange(){const e=t;return this._imageService[e(1283)]}get layers(){const e=t;return this._imageService[e(502)][e(542)]((t=>new ae(t,this[e(1531)],this._taskWorkerService)))||[]}get[t(1276)](){const e=t,i=this[e(1508)][e(280)];if(i)return new ae(i,this[e(1531)],this[e(1233)])}set[t(1276)](e){const i=t;if(void 0===e)throw new Error(i(1419));this[i(1508)][i(850)](e.id)}newLayer(){const e=t;this[e(1508)][e(209)]()}[t(1036)](e){const i=t;this._imageService[i(1036)](e?.id)}mergeLayerDown(){const e=t;return this[e(1508)][e(1541)]()}flattenLayers(){const e=t;return this[e(1508)][e(1077)]()}[t(1216)](){const e=t;this[e(1508)][e(1216)]()}goToBottomLayer(){const e=t;this._imageService[e(447)]()}[t(1013)](){const e=t;this[e(1508)][e(1013)]()}[t(1031)](){const e=t;this[e(1508)][e(1031)]()}moveLayerToTop(){this._imageService.moveLayerToTop()}[t(485)](){this._imageService.moveLayerToBottom()}[t(155)](){const e=t;this[e(1508)][e(155)]()}[t(857)](){const e=t;this[e(1508)][e(857)]()}async finishTemporaryLayer(){const e=t;await(this[e(1508)][e(280)]?.[e(538)]())}}class ae{constructor(e,i,s){const r=t;this[r(264)]=e,this._selectionService=i,this[r(1233)]=s,this[r(735)]=new Map,this[r(264)][r(913)]((()=>this[r(735)][r(1021)]()))}get[t(534)](){const e=t;return this._layer[e(386)]}get[t(913)](){const e=t;return this[e(264)][e(913)]}get id(){return this._layer.id}get name(){const e=t;return this[e(264)][e(395)]}set name(e){const i=t;this[i(264)][i(395)]=e}get[t(1102)](){const e=t;return this._layer[e(1102)]}set[t(1102)](e){const i=t;this[i(264)][i(568)](e)}get[t(909)](){const e=t;return this._layer[e(909)]}set isVisible(e){this[t(264)].setVisible(e)}[t(1108)](e,i){const s=t,r=e+"x"+i,n=this[s(735)][s(1006)](r);if(n)return n;const o={data:this[s(264)].data,width:this[s(264)].width,height:this[s(264)][s(230)]},h=this[s(1233)][s(1359)](o,e,i);return this._previewCache[s(766)](r,h),h}exportBlob(e){const i=t;return this[i(264)][i(1495)](e)}async importBlob(e,i){const r=t,n=await this[r(264)][r(902)](e,i);this[r(1531)][r(1231)]=(0,s.BN)(n[r(366)][r(1231)]),this[r(1531)][r(878)](r(226))}}class ce{constructor(e){this[t(954)]=e}get[t(1454)](){return this[t(954)].onUpdate}get[t(882)](){return this._paletteService.primary}set[t(882)](e){const i=t;this._paletteService[i(882)]=e}get[t(1029)](){const e=t;return this[e(954)][e(1029)]}set[t(1029)](e){const i=t;this._paletteService[i(1029)]=e}swap(){this[t(954)].swap()}}class le{constructor(e){this[t(1535)]=e}[t(601)](){this._renderService.pause()}[t(384)](){const e=t;this._renderService[e(384)]()}}class de{constructor(t){this._selectionService=t}get[t(913)](){const e=t;return this[e(1531)][e(913)]}get range(){const e=t;return this._selectionService[e(1231)]}[t(1141)](){this[t(1531)].deselect()}[t(537)](){const e=t;return this[e(1531)][e(537)]()}[t(1162)](){const e=t;this[e(1531)][e(1162)]()}}class ue{constructor(e,i){const s=t;this[s(747)]=e,this[s(1233)]=i}get[t(942)](){return this[t(1233)].disableWorkers}set[t(942)](e){const i=t;this[i(1233)][i(942)]=e}get[t(872)](){const e=t;return this[e(747)][e(872)]}executeOnAllLayers(e,i){const s=t;return this._taskService[s(396)](e,i)}[t(721)](e,i){const s=t;return this._taskService[s(721)](e,i)}}class fe{constructor(e,i,s,r,n,o){const h=t;this[h(1005)]=e,this._historyService=i,this[h(1508)]=s,this._paletteService=r,this[h(1531)]=n,this[h(971)]=o}get[t(419)](){const e=t;return this._toolService[e(419)]}get activeTool(){const e=t;return this[e(1005)][e(1057)]?.id}get[t(1139)](){const e=t;return this[e(1005)][e(1057)]?.[e(1139)]||[]}get[t(1403)](){const e=t;return this._toolService[e(1057)]?.[e(1403)]||[]}get[t(832)](){const e=t;return this._toolService[e(1057)]?.[e(832)]||[]}async[t(836)](e){const i=t;await this[i(1005)][i(836)](e)}}class me{constructor(e,i){const s=t;this[s(1500)]=e,this[s(971)]=i}get onUpdate(){const e=t;return this[e(971)][e(913)]}get[t(637)](){return this[t(971)].onZoomChange}get[t(820)](){return this[t(971)].onPixelGridEnabledChange}get onPointerCoordChange(){return this[t(971)].onPointerCoordChange}get x(){return this[t(971)].x}set x(e){this[t(971)].x=e}get y(){return this[t(971)].y}set y(e){this[t(971)].y=e}get[t(415)](){const e=t;return this._viewportService[e(415)]}get[t(1343)](){const e=t;return this[e(971)][e(1343)]}set[t(1343)](e){const i=t;this[i(971)][i(1343)]=e}get[t(863)](){const e=t;return this._viewportService[e(863)]}set[t(863)](e){const i=t;this._viewportService[i(863)]=e}[t(239)](e){const i=t;this[i(1500)][i(239)](e)}focus(){const e=t;this._elementService[e(835)]?.[e(1524)](e(1001))?.[e(838)]()}[t(383)](e){this[t(971)].zoomIn(e)}zoomOut(e){const i=t;this[i(971)][i(308)](e)}[t(467)](){const e=t;this[e(971)][e(467)]()}}const ge=t(528),_e=t(593),pe=new Map;function ye(e){const i=t;if(pe[i(1204)](e))return pe[i(1006)](e);const s=function(t,e,i){if(3!==arguments.length)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");we(s,t,i)};return s.toString=()=>e,pe[i(766)](e,s),s}function we(t,e,i){e[ge]===e?e[_e].push({id:t,index:i}):(e[_e]=[{id:t,index:i}],e[ge]=e)}const ve=ye(t(1056)),be=ye("ContextKeyService"),xe=ye(t(813));class Se{constructor(){this[t(262)]=new Map}[t(1076)](e,i){const s=t;this[s(262)][s(766)](e,i)}[t(1006)](e){const i=t,s=this[i(262)][i(1006)](e);if(!s)throw new Error('Could not find non-existent command "'+e+'"');return s}[t(1195)](){const e=t;return this[e(262)][e(1032)]()}}const Ce=new Se;var Ee=function(t,e){return function(i,s){e(i,s,t)}};let Le=class{constructor(e,i){const s=t;this._instantiationService=e,this[s(456)]=i}[t(1373)](e){return Ce[t(1006)](e)}[t(652)](){return Ce[t(1195)]()}canRunCommand(e){const i=t,s=Ce.get(e);if(void 0===s[i(740)])return!0;const r=this[i(456)][i(1006)](s[i(740)]);if(!r)return!0;const n=r.get();return s[i(1229)]?!n:n}[t(273)](e){const i=t;if(!this[i(1267)](e))throw new Error(i(579)+e+"\", it's disabled");const s=Ce.get(e);return console[i(832)]("Run Command: "+e),this[i(1052)].invokeFunction(s[i(365)])}filterCommands(e,i){const s=t,r=Ce[s(1195)](),n=[];for(const t of r)if((t.section+": "+t.label)[s(1188)]()[s(796)](e[s(1188)]())&&(n[s(1463)](t),n[s(589)]===i))return n;return n}};Le=function(e,i,s,r){const n=t;var o,h=arguments[n(589)],a=h<3?i:null===r?r=Object.getOwnPropertyDescriptor(i,s):r;if(typeof Reflect===n(477)&&typeof Reflect[n(414)]===n(847))a=Reflect[n(414)](e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object[n(1262)](i,s,a),a}([Ee(0,xe),Ee(1,be)],Le);class Te{constructor(){const e=t;this[e(827)]=void 0,this[e(944)]=new Map}[t(1006)](e){const i=t;return this[i(944)][i(1006)](e)}[t(1356)](e,i){const s=t,r=new Ie(i);return this[s(944)][s(766)](e,r),r}}class Ie extends e.JT{constructor(e){const i=t;super(),this[i(532)]=e,this[i(924)]=this[i(1076)](new r.v),this.onUpdate=this[i(924)].event,this._value=this[i(532)]}set(e){const i=t;this[i(573)]!==e&&(this[i(573)]=e,this._onUpdate.fire(e))}reset(){this.set(this._defaultValue)}[t(1006)](){return this[t(573)]}}const Ae=ye(t(548));class Re{constructor(...t){this._entries=new Map;for(const[e,i]of t)this.set(e,i)}[t(766)](e,i){const s=t,r=this[s(235)][s(1006)](e);return this[s(235)][s(766)](e,i),r}[t(281)](e){this[t(235)].forEach(((t,i)=>e(i,t)))}[t(1204)](e){return this[t(235)].has(e)}[t(1006)](e){const i=t;return this[i(235)][i(1006)](e)}}class Be{constructor(){const e=t;this[e(1023)]=new Re,this[e(1023)][e(766)](xe,this)}[t(1212)](e,i){const s=t;this[s(1023)][s(766)](e,i)}getService(t){return this._services.get(t)}[t(1129)](e,...i){const s=t,r=(o=e,o[_e]||[])[s(442)](((t,e)=>t[s(533)]-e[s(533)])),n=[];var o;for(const t of r){const i=this._services[s(1006)](t.id);if(!i)throw new Error(s(1361)+e.name+" depends on UNKNOWN service "+t.id+".");n[s(1463)](i)}const h=r[s(589)]>0?r[0][s(533)]:i[s(589)];if(i.length!==h)throw new Error(s(183)+e[s(395)]+s(727)+(h+1)+s(1186)+i[s(589)]+" static arguments");return new e(...[...i,...n])}invokeFunction(t,...e){return t({get:t=>{const e=a2_0x41cc,i=this[e(849)](t);if(!i)throw new Error(e(350)+t+"'");return i}},...e)}}const Me=ye(t(283)),De=ye(t(783)),Pe=ye(t(1511));class Ue extends e.JT{constructor(){const e=t;super(...arguments),this[e(574)]=new Map([[1,new ke],[0,new ke]]),this[e(1352)]=this[e(1076)](new r.v),this.onDidAddTopItem=this[e(1352)][e(1349)],this._onDidRemoveTopItem=this.register(new r.v),this[e(1121)]=this[e(1120)][e(1349)],this[e(526)]=this.register(new r.v),this[e(455)]=this[e(526)][e(1349)],this[e(1143)]=this[e(1076)](new r.v),this[e(1328)]=this[e(1143)][e(1349)]}[t(989)](e){const i=t,s=this[i(574)][i(1006)](e[i(478)]),r=0===e[i(934)]?s[i(468)]:s[i(908)];if(r.has(e))throw new Error("Status bar item already added");return r[i(1046)](e),(0===e.target?this[i(1352)]:this[i(526)])[i(617)](e),{dispose:()=>{this._removeItem(e)}}}[t(195)](e){const i=t;return this._items[i(1006)](e).leftItems.values()}getRightItems(e){const i=t;return this[i(574)].get(e)[i(908)].values()}[t(1499)](e){const i=t,s=this[i(574)][i(1006)](e.target);(0===e.alignment?s[i(468)]:s[i(908)]).delete(e),(0===e.target?this[i(1120)]:this[i(1143)])[i(617)](e)}}class ke{constructor(){this.leftItems=new Set,this.rightItems=new Set}}const Fe=ye(t(1416)),Ne=ye("ViewService"),Oe=ye(t(786));class He{constructor(){this._views=new Map}[t(1076)](e,i){const s=t;this._views[s(766)](e,i)}[t(1006)](e){const i=t,s=this[i(1422)][i(1006)](e);if(!s)throw new Error(i(706)+e+'"');return s}getAll(){const e=t;return this[e(1422)][e(939)]()}}const Ve=new He;class ze{constructor(){this._views=new Map}[t(1076)](e,i){const s=t;this._views[s(766)](e,i)}[t(1006)](e){const i=t,s=this._views[i(1006)](e);if(!s)throw new Error(i(495)+e+'"');return s}getAll(){const e=t;return this[e(1422)][e(939)]()}}const je=new ze;var We=function(t,e){return function(i,s){e(i,s,t)}};let qe=class extends e.JT{constructor(e,i){const s=t;super(),this[s(1052)]=e,this._stateService=i,this[s(1422)]=new Map,this[s(1498)]=!1,this._onStateChange=this.register(new r.v),this[s(1337)]=this._onStateChange.event;for(const[t,e]of Ve.getAll()){let i;switch(e.anchor){case s(1171):i=this._instantiationService[s(1129)](e[s(1084)],document[s(1524)](s(591)));break;case s(459):i=this._instantiationService[s(1129)](e[s(1084)],document[s(1524)](s(860)))}i&&this[s(1422)].set(t,i)}this[s(370)]=document[s(1524)](s(500));for(const[t,e]of je.getAll())e[s(730)]&&this[s(1364)](t,e);this[s(374)].registerStateHandler(s(491),this)}toggleView(e,i=!1){const s=t,r=this[s(1422)].get(e);r?r[s(909)]=!r[s(909)]:this[s(1364)](e,je[s(1006)](e)),!this[s(1498)]&&this._onStateChange[s(617)]()}_createView(e,i){const s=t,r=this[s(1052)][s(1129)](i[s(1084)],this._viewsElement);r[s(312)]((()=>{const t=s;!1===r[t(909)]&&(r.dispose(),this[t(1422)].delete(e),!this._isRestoringState&&this[t(360)][t(617)]())})),this[s(1422)][s(766)](e,r)}saveState(){const e=t,i=[];for(const t of this[e(1422)].values())i[e(1463)](t.id);return{visibleViews:i}}[t(1450)](e){const i=t;this[i(1498)]=!0;for(const t of e.visibleViews)!this[i(1422)][i(1204)](t)&&this[i(172)](t);for(const t of this[i(1422)].keys()){let s=!1;for(const r of e.visibleViews[i(1032)]())if(r===t){s=!0;break}!s&&this.toggleView(t)}this[i(1498)]=!1}};qe=function(e,i,s,r){const n=t;var o,h=arguments[n(589)],a=h<3?i:null===r?r=Object[n(1037)](i,s):r;if("object"==typeof Reflect&&typeof Reflect[n(414)]===n(847))a=Reflect.decorate(e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object[n(1262)](i,s,a),a}([We(0,xe),We(1,Oe)],qe);const Ge=ye(t(1213));class Xe extends e.JT{constructor(){const e=t;super(...arguments),this[e(1255)]=!0,this[e(1152)]=!0,this[e(241)]=this[e(1076)](new r.v),this[e(430)]=this._onShowViewportChange[e(1349)],this[e(349)]=this[e(1076)](new r.v),this[e(393)]=this[e(349)][e(1349)]}get[t(871)](){return this._showViewport}set[t(871)](e){const i=t;this[i(1255)]!==e&&(this[i(1255)]=e,this[i(241)][i(617)](e))}get[t(470)](){return this[t(1152)]}set[t(470)](e){const i=t;this[i(1152)]!==e&&(this[i(1152)]=e,this[i(349)][i(617)](e))}}var Je;!function(e){const i=t;e[e[i(809)]=1]=i(809)}(Je||(Je={}));class Ye extends e.JT{constructor(){const e=t;super(...arguments),this[e(1131)]=new Map,this._onStateChange=this[e(1076)](new r.v),this[e(1337)]=this[e(360)][e(1349)]}[t(244)](e,i){const s=t;if(this[s(1131)][s(1204)](e))throw new Error('State handler for id "'+e+s(1353));this._stateHandlers[s(766)](e,i),i[s(1337)]((()=>this[s(360)][s(617)]({id:e,body:i[s(410)]()})))}restoreState(e){const i=t;if(e[i(1191)]===Je[i(809)])for(const t of e[i(939)]){const e=this._stateHandlers[i(1006)](t.id);e?e[i(1450)](t[i(644)]):console[i(1270)]('No state handler for id "'+t.id+i(250))}else console[i(1270)](i(373)+e[i(1191)]+i(1134)+Je[i(809)]+")")}}class Ke{constructor(){this[t(390)]=[]}[t(1076)](e){const i=t;this[i(390)][i(1463)](e)}[t(1195)](){const e=t;return this[e(390)][e(1032)]()}[t(1021)](){this[t(390)].length=0}}const $e=new Ke;const Ze=ye("IpcService");class Qe{constructor(e){const i=t;this._vscodeApi=e,this.serviceBrand=void 0,this._extHostRequestHandlers=new Map,this[i(212)]=new Map,window[i(664)](i(661),(async t=>{const e=i;if(e(1003)in t[e(1525)]){const i=t[e(1525)][e(1003)],s=this[e(212)][e(1006)](i);if(!s)throw new Error(e(418)+i+'"');return this[e(212)].delete(i),void s(this[e(1489)](t[e(1525)]))}if(e(949)in t[e(1525)]){const i=this[e(489)][e(1006)](t[e(1525)].type);if(!i)throw new Error(e(231)+t.data[e(1404)]+'"');const s=await i(this[e(1489)](t[e(1525)])),r={type:t[e(1525)][e(1404)],body:s,extHostRequestId:t[e(1525)][e(949)]};this._vscodeApi.postMessage(r)}}))}[t(1383)](e,i){const s=t;if(this[s(489)][s(1204)](e))throw new Error(s(725)+e+'"');this._extHostRequestHandlers.set(e,i)}async[t(1414)](e,i){const s=t,r=Math[s(710)](1e6*Math.random());return new Promise((t=>{const n=s;this._activeRequests[n(766)](r,t),this._vscodeApi[n(759)]({type:e,body:i,webviewRequestId:r})}))}[t(1489)](e){const i=t;if(void 0===e.body)return e[i(1219)];const s=e[i(1219)];for(const t of Object[i(1285)](s)){const e=s[t];"object"==typeof e&&"type"in e&&e[i(1404)]===i(580)&&(s[t]=new Uint8Array(e[i(1525)]))}return s}}class ti{[t(1076)](t){}[t(1195)](){return[][t(1032)]()}}class ei{constructor(){}async[t(1491)](){throw new Error(t(694))}async[t(660)](){throw new Error(t(694))}async[t(1253)](){throw new Error(t(694))}}var ii=function(t,e){return function(i,s){e(i,s,t)}};let si=class{constructor(e,i){this[t(364)]=e,this._lunaService=i}async[t(427)](e){const i=t;switch(e){case i(961):{const t=await this[i(503)](),e=await this[i(364)][i(1414)]("quickPick",{items:[{id:i(959),label:i(677),description:i(715),detail:i(816)},{id:i(1208),label:i(1284),description:i(436),detail:i(1405)}],options:{placeHolder:i(277)}});if(void 0===e)throw new Error(i(1402));return{...t,resampling:e}}case i(915):{const t=await this._requestNewDimensions(),e=await this._ipcService[i(1414)](i(647),{items:[{id:"topleft",label:i(511),description:"â"},{id:"top",label:i(1537),description:"â"},{id:i(1341),label:i(204),description:"â"},{id:i(1375),label:i(1502),description:"â"},{id:i(883),label:i(764),description:"Â·"},{id:"right",label:"Right",description:"â"},{id:i(1201),label:"Bottom left",description:"â"},{id:i(459),label:i(1051),description:"â"},{id:i(1126),label:i(1449),description:"â"}],options:{placeHolder:"Select where to anchor the existing image"}});if(void 0===e)throw new Error(i(359));return{...t,anchor:e}}default:throw new Error(i(1263)+e+" not yet supported")}}async[t(503)](){const e=t,i=await this[e(364)].request("inputBoxNumber",{prompt:e(460),defaultValue:this[e(640)][e(1100)].width,minValue:1});if(void 0===i)throw new Error(e(690));const s=await this[e(364)][e(1414)](e(1410),{prompt:e(1362),defaultValue:this[e(640)].layer[e(230)],minValue:1});if(void 0===s)throw new Error(e(1380));return{width:i,height:s}}};si=function(e,i,s,r){const n=t;var o,h=arguments[n(589)],a=h<3?i:null===r?r=Object[n(1037)](i,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object[n(1262)](i,s,a),a}([ii(0,Ze),ii(1,De)],si);class ri{constructor(){this[t(235)]=[]}[t(1076)](e){this[t(235)].push(e)}[t(1195)](){return this._entries}clear(){const e=t;this[e(235)][e(589)]=0}}const ni=new ri;function oi(e){const i=t;if(Ce[i(1076)](e.id,{id:e.id,label:e[i(1222)],section:e[i(1165)],run:e[i(365)],checked:e[i(471)],negateChecked:e[i(806)],enabled:e[i(740)],negateEnabled:e.negateEnabled}),e[i(1285)])if(Array[i(1012)](e[i(1285)]))for(const t of e[i(1285)])ni[i(1076)]({commandId:e.id,keys:t});else ni[i(1076)]({commandId:e.id,keys:e[i(1285)]})}oi({id:"adjustments.invert",label:t(642),section:t(189),run:async e=>{const i=t,s=e.get(De);s.task[i(721)](i(1179),{selection:s.selection.range})},keys:t(1392)});class hi extends e.JT{constructor(e,i){const s=t;super(),this[s(358)]=document[s(1067)](s(1439)),this._contentElement.id=i[s(1188)]()[s(196)](/ /g,""),this._contentElement[s(738)][s(1046)](s(1348),s(1044)),e.appendChild(this[s(358)]),this[s(1076)]({dispose:()=>{const t=s;e[t(507)](this[t(358)])}})}}let ai,ci=class extends hi{constructor(e,i){const s=t;super(e,s(1306)),this[s(672)]=i,this[s(718)]=[];const r=document[s(1067)](s(1439));r[s(738)].add(s(1345)),this[s(1302)]=document[s(1067)](s(815)),this[s(1302)][s(1404)]=s(817),this[s(1302)][s(664)](s(815),(()=>this[s(213)]())),this[s(1302)].addEventListener(s(1075),(t=>this._keyDown(t))),r[s(1154)](this[s(1302)]);const n=document[s(1067)]("ul");n[s(738)][s(1046)]("cmd-palette-list");for(let t=0;t<18;t++)this[s(718)][s(1463)](this[s(169)]());n[s(931)](...this[s(718)]),this[s(213)](),this[s(358)][s(738)][s(1046)](s(688)),this[s(358)].append(r,n),this[s(1302)][s(838)]()}[t(169)](){return document.createElement("li")}_fillCommands(){const e=t,i=this[e(672)][e(285)](this._inputElement[e(811)],18);let s=0;for(;s<i.length;s++){const t=i[s],r=this[e(718)][s];r[e(899)]=t[e(1165)]+": "+t[e(1222)],r[e(738)][e(1261)](e(1313))}for(;s<18;s++)this[e(718)][s][e(738)].add(e(1313))}[t(1444)](e){const i=t;if("Enter"===e[i(681)]){const t=this[i(672)][i(285)](this[i(1302)].value,18);return t[i(589)]>0&&this[i(672)][i(273)](t[0].id),void this[i(1424)]()}}};async function li(e){const i=t,s=document.activeElement;if(s?.tagName===i(1327)){const t=s;let e;return e=null===t.selectionStart||null===t[i(1323)]||t[i(200)]===t[i(1323)]?t[i(811)]:t[i(811)][i(211)](t[i(200)],t[i(1323)]),void navigator[i(1128)].writeText(e)}const r=e[i(1006)](De);if(!r[i(1517)][i(1231)])return;const n=r[i(1100)][i(1276)];if(!n)return;const o=await n.exportBlob({range:r[i(1517)][i(1231)],useMovingLayer:!0});ai=r.selection[i(1231)];const h=new ClipboardItem({"image/png":o});if(!(i(1098)in navigator.clipboard))throw new Error(i(777));navigator[i(1128)][i(1098)]([h])}var di,ui;ci=function(e,i,s,r){const n=t;var o,h=arguments[n(589)],a=h<3?i:null===r?r=Object[n(1037)](i,s):r;if(typeof Reflect===n(477)&&typeof Reflect[n(414)]===n(847))a=Reflect.decorate(e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object[n(1262)](i,s,a),a}([(di=1,ui=ve,function(t,e){ui(t,e,di)})],ci),oi({id:t(1200),label:"Show All Commands",section:t(547),run:e=>{const i=t;e[i(1006)](xe)[i(1129)](ci,document[i(1219)])},keys:[t(1496),"f1"]}),$e[t(1076)]({start(e){const i=t,s=e[i(1006)](De),r=e[i(1006)](be)[i(1356)](7,!1),n=e[i(1006)](be)[i(1356)](6,!1);s[i(1155)][i(431)]((()=>{const t=i;r[t(766)](s.history.canRedo),n[t(766)](s[t(1155)][t(1122)])}))}}),oi({id:t(1095),label:t(334),section:t(748),run:function(e){const i=t,s=e.get(De);return s.history[i(719)](i(1460),(async()=>{const t=i;await li(e),await s[t(1517)].erase()}))},keys:t(1163)}),oi({id:t(803),label:"Copy",section:t(748),run:li,keys:"cmdctrl+c"}),oi({id:"edit.paste",label:t(1397),section:"Edit",run:async function(e){const i=t,s=e[i(1006)](De),r=s[i(1100)].activeLayer;if(!r)return;if((await navigator[i(758)][i(1435)]({name:i(238)}))[i(644)]===i(443))return void console.error(i(654));await s[i(1100)].finishTemporaryLayer();const n=await navigator[i(1128)][i(1203)]();for(const t of n){if(!t.types.includes(i(181))){console[i(1142)](i(214));continue}const e=await t[i(897)]("image/png");await s[i(1155)][i(719)](i(1311),(()=>r[i(902)](e,ai)))}},keys:t(1299)}),oi({id:t(736),label:t(1181),section:t(748),run:e=>e[t(1006)](De).history[t(240)](),keys:t(ee?1123:564),enabled:7}),oi({id:t(416),label:"Undo",section:"Edit",run:e=>e.get(De).history[t(799)](),keys:t(921),enabled:6}),oi({id:t(1379),label:t(1160),section:t(243),run:e=>e[t(1006)](De).file[t(222)](20,15),keys:t(494)}),oi({id:"file.open",label:t(864),section:t(243),run:async e=>e[t(1006)](Ae)[t(1491)](),keys:"ctrl+o"}),oi({id:"file.save",label:t(936),section:t(243),run:async e=>e[t(1006)](Ae)[t(660)](),keys:"ctrl+s"}),oi({id:t(367),label:t(1196),section:"File",run:async e=>e[t(1006)](Ae)[t(1253)](),keys:t(186)});class fi extends e.JT{constructor(e,i,s,n){const o=t;super(),this.id=e,this[o(370)]=i,this._position=n,this._isVisible=!0,this[o(732)]=this.register(new r.v),this[o(312)]=this[o(732)][o(1349)],this[o(991)]=document[o(1067)](o(1439)),this._viewElement.id=s.toLowerCase().replace(/ /g,""),this[o(991)].classList[o(1046)]("view",o(586),this[o(1025)]);const h=document[o(1067)](o(1439));h.classList[o(1046)]("header");const a=document.createElement("div");a[o(738)][o(1046)](o(798)),a[o(899)]=s,this[o(1007)]=document[o(1067)](o(1439)),this[o(1007)][o(738)][o(1046)](o(1372));const c=document[o(1067)](o(1504));c.classList[o(1046)](o(342),o(1107)),c[o(659)]("aria-label",o(272)+s+" window"),c.addEventListener("click",(()=>this[o(909)]=!1)),h[o(931)](a,this._headerContentElement,c),this[o(358)]=document[o(1067)](o(1439)),this[o(358)][o(738)][o(1046)](o(1167)),this[o(991)][o(931)](h,this._contentElement),this[o(370)][o(1154)](this[o(991)]),this.register({dispose:()=>{const t=o;this[t(370)][t(507)](this[t(991)])}}),this[o(182)]()}get[t(909)](){return this[t(810)]}set isVisible(e){const i=t;this[i(810)]=e,this._onDidChangeVisibilityEmitter[i(617)](e)}_updatePosition(){const e=t;this._position===e(1201)||"bottomright"===this[e(1025)]?(this._viewElement[e(341)][e(1171)]=e(284),this[e(991)][e(341)][e(459)]=e(220)):(this[e(1025)]===e(218)||"topright"===this[e(1025)])&&(this._viewElement[e(341)].top="10px",this[e(991)][e(341)].bottom=e(284)),this[e(1025)]===e(1201)||this._position===e(218)?(this[e(991)][e(341)][e(890)]=e(284),this[e(991)][e(341)][e(1375)]=e(220)):(this._position===e(1341)||this._position===e(1126))&&(this[e(991)][e(341)][e(890)]=e(220),this[e(991)][e(341)][e(1375)]=e(284))}}var mi=function(t,e){return function(i,s){e(i,s,t)}};let gi=class e extends fi{constructor(e,i,s){const r=t;super(r(1155),e,r(983),r(1341)),this[r(1355)]=i,this[r(456)]=s,this[r(718)]=[],this[r(1257)]=this[r(456)][r(1356)](4,!0),this[r(1076)](this[r(312)]((t=>this[r(1257)][r(766)](t)))),this[r(1236)]=document[r(1067)]("ul"),this[r(1236)][r(738)][r(1046)](r(289)),this[r(1076)](this._luna[r(1155)][r(431)]((()=>this._render()))),this[r(1303)](),this[r(358)][r(1154)](this._listElement)}_render(){const i=t,s=document.createDocumentFragment(),r=this._luna[i(1155)][i(1333)];let n,o=!1,h=!1;for(const[t,a]of this[i(1355)][i(1155)][i(939)][i(939)]()){let c;t<this[i(718)].length?c=this._listItemElements[t]:(c=document.createElement("li"),c[i(664)](i(1063),(async()=>{const s=i;if(!this[s(1355)][s(1155)].activeEntry)return;const r=t-this[s(1355)][s(1155)][s(939)][s(215)](this._luna[s(1155)][s(1333)]),n=r>0?e[s(823)]?e[s(823)]:this._luna[s(1155)][s(240)]:e[s(188)]?e[s(188)]:this[s(1355)][s(1155)].undo;for(let t=0;t<Math[s(556)](r);t++)await n()})),s[i(1154)](c),this._listItemElements.push(c)),c[i(899)]=a[i(1090)],c[i(738)][i(980)](i(240),o),h=a===r,c[i(738)].toggle("active",h),h&&(o=!0,n=c)}for(this[i(1236)].appendChild(s);this[i(718)][i(589)]>this[i(1355)][i(1155)].entries[i(589)];)this._listElement[i(507)](this[i(718)][i(1533)]());n?(this[i(358)][i(1452)]+this._listElement[i(1479)]>n[i(1479)]||this[i(358)].scrollTop<n[i(1479)]-this[i(358)][i(691)])&&(this[i(358)].scrollTop=n[i(1479)]-this[i(1236)][i(1479)]):this[i(358)].scrollTop=this[i(358)][i(1438)]}};gi=function(e,i,s,r){const n=t;var o,h=arguments.length,a=h<3?i:null===r?r=Object[n(1037)](i,s):r;if("object"==typeof Reflect&&typeof Reflect.decorate===n(847))a=Reflect[n(414)](e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object[n(1262)](i,s,a),a}([mi(1,De),mi(2,be)],gi),je.register(t(1155),{ctor:gi,defaultVisible:!0}),oi({id:t(1398),label:t(905),section:t(831),checked:4,run:e=>e[t(1006)](Ne)[t(172)](t(1155))});let _i=class extends e.JT{constructor(e){const i=t;super(),this[i(640)]=e,this.target=1,this[i(934)]=1,this[i(282)]=i(331),this.hasImage=!0,this[i(861)]=i(510),this[i(924)]=this[i(1076)](new r.v),this[i(913)]=this[i(924)][i(1349)],this._lunaService[i(1100)][i(1467)]((()=>this[i(594)]())),this[i(594)]()}[t(594)](){const e=t;(this[e(1291)]!==this[e(640)][e(1100)].width||this[e(413)]!==this[e(640)][e(1100)][e(230)])&&(this[e(1291)]=this[e(640)][e(1100)][e(590)],this[e(413)]=this[e(640)][e(1100)][e(230)],this[e(817)]=this[e(1291)]+" x "+this[e(413)],this[e(798)]=e(592)+this[e(1291)]+" pixels wide by "+this[e(413)]+" pixels tall",this._onUpdate[e(617)]())}};var pi,yi;_i=function(e,i,s,r){const n=t;var o,h=arguments[n(589)],a=h<3?i:null===r?r=Object[n(1037)](i,s):r;if(typeof Reflect===n(477)&&typeof Reflect[n(414)]===n(847))a=Reflect[n(414)](e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object.defineProperty(i,s,a),a}([(pi=0,yi=De,function(t,e){yi(t,e,pi)})],_i);let wi=class extends e.JT{constructor(e){const i=t;super(),this[i(640)]=e,this.target=1,this.alignment=1,this[i(282)]="pointer-coords",this[i(609)]=!0,this[i(1105)]=!1,this[i(861)]=i(510),this[i(924)]=this[i(1076)](new r.v),this[i(913)]=this[i(924)][i(1349)],this[i(640)][i(1266)].onPointerCoordChange((t=>this[i(594)](t)))}[t(594)](e){const i=t;this[i(1105)]=!!e,e&&(this.text=e[0]+","+e[1]),this[i(924)][i(617)]()}};var vi,bi;wi=function(e,i,s,r){const n=t;var o,h=arguments[n(589)],a=h<3?i:null===r?r=Object[n(1037)](i,s):r;if(typeof Reflect===n(477)&&typeof Reflect.decorate===n(847))a=Reflect[n(414)](e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object[n(1262)](i,s,a),a}([(vi=0,bi=De,function(t,e){bi(t,e,vi)})],wi),$e.register({start(e){const i=t,s=e[i(1006)](Pe),r=e.get(xe);s[i(989)](r[i(1129)](wi)),s[i(989)](r[i(1129)](_i))}}),oi({id:t(1240),label:"Crop to Selection",section:t(400),run:async e=>{const i=t,s=e[i(1006)](De);s.task[i(396)]("layer/cropToSelection",{selection:s.selection.range})},keys:t(866)}),oi({id:t(1228),label:t(632),section:t(400),run:async e=>{const i=t,s=e[i(1006)](De);await s[i(955)][i(396)](i(1294),{selection:s.selection[i(1231)]}),s[i(1266)].fitToWindow()}}),oi({id:t(510),label:t(1250),section:"Image",run:async e=>{const i=t,s=await e[i(1006)](Fe)[i(427)](i(961));e.get(De)[i(955)].executeOnAllLayers(i(961),s)},keys:"ctrl+r"}),oi({id:t(263),label:t(1215),section:t(400),run:async e=>{const i=t,s=await e[i(1006)](Fe)[i(427)](i(915));e[i(1006)](De)[i(955)][i(396)](i(915),s)},keys:"ctrl+shift+r"}),oi({id:"image.flipHorizontal",label:"Flip Horizontal",section:t(400),run:async e=>{const i=t,s=e[i(1006)](De);s[i(955)][i(396)](i(1540),{selection:s[i(1517)][i(1231)]})}}),oi({id:"image.flipVertical",label:t(304),section:t(400),run:async e=>{const i=t,s=e[i(1006)](De);s[i(955)][i(396)](i(1394),{selection:s[i(1517)][i(1231)]})}}),oi({id:t(999),label:t(602),section:t(400),run:async e=>{const i=t,s=e[i(1006)](De);s[i(955)][i(396)](i(385),{selection:s[i(1517)].range})},keys:t(916)}),oi({id:"image.rotate90Clockwise",label:"Rotate 90Â° Clockwise",section:t(400),run:async e=>{const i=t,s=e[i(1006)](De);s[i(955)][i(396)](i(1370),{selection:s[i(1517)][i(1231)]})},keys:t(790)}),oi({id:"image.rotate90CounterClockwise",label:t(630),section:t(400),run:async e=>{const i=t,s=e[i(1006)](De);s[i(955)][i(396)](i(770),{selection:s[i(1517)].range})},keys:"ctrl+g"}),oi({id:"image.flattenLayers",label:t(352),section:t(400),run:e=>e.get(De)[t(1100)][t(1077)](),keys:"ctrl+shift+f"}),oi({id:t(1288),label:t(295),section:"Image",run:e=>e[t(1006)](De)[t(1100)][t(538)](),keys:"enter"});const xi=["r","g","b","a"];class Si{constructor(e,i,s){const r=t;this[r(1355)]=e,this[r(449)]=i;const n=r(808)+s;this._channelIndex=xi[r(215)](s);const o=document[r(1067)](r(1439));o[r(738)].add("channel");const h=document[r(1067)](r(1222));h[r(899)]=s[r(751)]()+":",h[r(659)](r(626),n);const a=document[r(1067)](r(1439));a[r(738)][r(1046)]("slider"),"a"===s&&a[r(738)].add("a"),this[r(487)]=document[r(1067)](r(1439)),this[r(487)][r(738)][r(1046)]("slider-gradient"),this[r(487)].addEventListener("mousemove",(t=>{const e=r;a[e(738)][e(531)](e(1018))&&t[e(588)]&&this[e(1532)](t[e(665)])})),this[r(487)][r(664)](r(192),(t=>{const e=r;this._sliderGradientElement[e(1053)](t[e(1523)]),a.classList[e(1046)]("active"),this._updateColorViaSlider(t.offsetX)})),this[r(487)][r(664)](r(1093),(t=>{const e=r;this[e(487)][e(1432)](t[e(1523)]),a.classList[e(1261)](e(1018))})),this[r(487)][r(664)](r(450),(t=>{const e=r;if(0===t[e(1332)])return;const i=this[e(1355)][e(686)][e(882)].slice();i[this._channelIndex]=Math[e(1487)](Math[e(1321)](i[this._channelIndex]+(t[e(1332)]>0?-1:1),255),0),this[e(1355)][e(686)][e(882)]=i})),this._sliderTabElement=document[r(1067)](r(1439)),this[r(565)].classList[r(1046)](r(473)),a[r(931)](this[r(487)],this[r(565)]);const c=document[r(1067)]("input");c[r(1404)]=r(1030),c[r(1321)]="0",c[r(1487)]="255",c[r(811)]="255",c.id=n,c[r(664)](r(815),(()=>{const t=r,e=this[t(1355)][t(686)][t(882)][t(953)]();e[this[t(603)]]=parseInt(c.value),this._luna[t(686)][t(882)]=e})),this[r(1302)]=c,o.append(h,a,c),this[r(650)](),this[r(449)][r(1154)](o)}set[t(811)](e){this[t(1302)].value=e.toString()}[t(650)](){const e=t,i=this[e(1355)][e(686)][e(882)],s=[0===this[e(603)]?0:i[0],1===this._channelIndex?0:i[1],2===this._channelIndex?0:i[2],3===this[e(603)]?0:1],r=[0===this[e(603)]?255:i[0],1===this[e(603)]?255:i[1],2===this[e(603)]?255:i[2],(this[e(603)],1)];this._sliderGradientElement.style[e(267)]="linear-gradient(90deg, rgba("+s[e(274)](",")+e(1400)+r[e(274)](",")+e(550),this._sliderTabElement[e(341)][e(1375)]=i[this[e(603)]]/255*49+"px"}_updateColorViaSlider(e){const i=t,s=Math[i(1487)](Math[i(1321)](e/49,1),0),r=Math.round(255*s),n=this[i(1355)][i(686)][i(882)].slice();n[this._channelIndex]=Math[i(710)](r),this[i(1355)][i(686)][i(882)]=n}}var Ci=function(t,e){return function(i,s){e(i,s,t)}};let Ei=class extends fi{constructor(i,s,r,n){const o=t;super(o(686),i,"Palette",o(1201)),this[o(1355)]=s,this[o(456)]=n,this[o(202)]=new Map,this[o(1257)]=this._contextKeyService[o(1356)](2,!0),this.register(this[o(312)]((t=>this._windowVisibleContextKey[o(766)](t)))),this[o(1355)][o(686)][o(882)]=new Float32Array([255,255,255,255]),this._luna.palette.secondary=new Float32Array([0,0,0,255]);const h=document[o(1067)]("div");h[o(738)][o(1046)](o(1018)),this[o(695)]=this._createColorInfo(o(882)),this[o(1490)]=this[o(309)](o(1029));const a=document[o(1067)](o(1504));a[o(738)][o(1046)]("swap",o(1107)),this.register((0,e.Lw)(a,o(1063),(()=>r[o(273)](o(1539))))),h.append(this[o(695)][o(409)],this._secondaryColorDiv.parentElement,a);const c=document[o(1067)](o(1439));c[o(738)].add("left"),c.append(h,document[o(1067)]("br"),this[o(193)](255,255,255),this[o(193)](0,0,0),this[o(193)](255,0,0),this._createPaletteButton(255,255,0),this[o(193)](0,255,0),this[o(193)](0,255,255),this[o(193)](0,0,255),this[o(193)](255,0,255),document[o(1067)]("br"),this[o(193)](255,255,255,192),this[o(193)](0,0,0,192),this._createPaletteButton(255,0,0,192),this._createPaletteButton(255,255,0,192),this[o(193)](0,255,0,192),this[o(193)](0,255,255,192),this[o(193)](0,0,255,192),this[o(193)](255,0,255,192),document[o(1067)]("br"),this._createPaletteButton(255,255,255,128),this[o(193)](0,0,0,128),this[o(193)](255,0,0,128),this[o(193)](255,255,0,128),this[o(193)](0,255,0,128),this[o(193)](0,255,255,128),this[o(193)](0,0,255,128),this._createPaletteButton(255,0,255,128),document.createElement("br"),this._createPaletteButton(255,255,255,64),this._createPaletteButton(0,0,0,64),this[o(193)](255,0,0,64),this[o(193)](255,255,0,64),this[o(193)](0,255,0,64),this._createPaletteButton(0,255,255,64),this._createPaletteButton(0,0,255,64),this._createPaletteButton(255,0,255,64));const l=document.createElement("div");l.classList[o(1046)](o(890));for(const t of xi)this[o(202)][o(766)](t,new Si(this[o(1355)],l,t));const d=document[o(1067)](o(1439));d[o(738)][o(1046)]("channel");const u=document[o(1067)](o(1222));u[o(899)]=o(486),u.setAttribute(o(626),o(1104)),this[o(720)]=document[o(1067)](o(815)),this[o(720)].id=o(1104),this[o(720)][o(1287)]=o(377),this[o(720)][o(798)]="The primary color's hex value in the format rrggbb. When changing, rgb will be expanded to rrggbb.",this[o(1168)](),this[o(720)][o(664)](o(815),(()=>{const t=o,e=this[t(720)][t(811)];if(6===e[t(589)]){const i=this[t(1355)][t(686)][t(882)][t(953)]();i[0]=parseInt(e.substr(0,2),16),i[1]=parseInt(e[t(952)](2,2),16),i[2]=parseInt(e[t(952)](4,2),16),this[t(1355)][t(686)].primary=i}})),this[o(720)][o(664)](o(319),(()=>{const t=o,e=this[t(720)][t(811)];if(e[t(515)](/^[0-9a-fA-F]+$/))if(3===e.length){const i=this[t(1355)][t(686)].primary.slice();i[0]=parseInt(e[t(952)](0,1)[t(716)](2),16),i[1]=parseInt(e.substr(1,1)[t(716)](2),16),i[2]=parseInt(e[t(952)](2,1)[t(716)](2),16),this[t(1355)][t(686)].primary=i}else this[t(1168)]();else this[t(1168)]()})),d.append(u,this[o(720)]),l[o(1154)](d),this._contentElement[o(931)](c,l),this[o(610)](),this[o(1076)](this[o(1355)][o(686)][o(1454)]((()=>this[o(610)]())))}[t(1168)](){const e=t;this[e(720)].value=this._colorToHex(this[e(1355)].palette[e(882)])}[t(417)](e){const i=t;return""+this._channelToHex(e[0])+this[i(1254)](e[1])+this[i(1254)](e[2])}[t(1254)](e){const i=t;return e[i(1434)](16)[i(549)](2,"0")[i(751)]()}_createColorInfo(e){const i=t,s=document[i(1067)]("div");s.id=e,s[i(738)][i(1046)](e);const r=document[i(1067)](i(1439));return r[i(738)][i(1046)](i(481)),s[i(1154)](r),r}[t(193)](e,i,s,r=255){const n=t,o=document[n(1067)](n(1439));o.classList[n(1046)](n(438));const h=document.createElement(n(1439));o[n(664)]("click",(()=>this[n(1355)].palette.primary=new Float32Array([e,i,s,r]))),o[n(664)](n(919),(t=>{const o=n;this[o(1355)][o(686)].secondary=new Float32Array([e,i,s,r]),t.preventDefault()})),h[n(738)][n(1046)](n(481));const a=n(1252)+e+","+i+","+s+n(968);return h.style[n(267)]=n(1223)+a+n(763)+e+","+i+","+s+","+r/255+n(550),o[n(1154)](h),o}_updatePalette(){const e=t,i=this[e(1355)][e(686)].primary;for(const[t,s]of xi.entries()){const r=this[e(202)][e(1006)](s);r[e(811)]=i[t],r.refresh()}this._resetHexInput();const s=i[0]+","+i[1]+","+i[2];this[e(695)][e(341)][e(267)]=e(703)+s+e(207)+s+","+i[3]/255+") 100%)";const r=this[e(1355)].palette.secondary,n=r[0]+","+r[1]+","+r[2];this._secondaryColorDiv[e(341)][e(267)]="linear-gradient(180deg, rgba("+n+e(207)+n+","+r[3]/255+") 100%)"}};Ei=function(e,i,s,r){const n=t;var o,h=arguments[n(589)],a=h<3?i:null===r?r=Object.getOwnPropertyDescriptor(i,s):r;if(typeof Reflect===n(477)&&typeof Reflect[n(414)]===n(847))a=Reflect[n(414)](e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object.defineProperty(i,s,a),a}([Ci(1,De),Ci(2,ve),Ci(3,be)],Ei),je[t(1076)]("palette",{ctor:Ei,defaultVisible:!0}),oi({id:t(345),label:t(570),section:t(831),checked:2,run:e=>e[t(1006)](Ne)[t(172)](t(686))}),oi({id:t(1539),label:"Swap Colors",section:t(1281),run:e=>e[t(1006)](De)[t(686)].swap(),keys:"x"});let Li=class extends e.JT{constructor(e){const i=t;super(),this._lunaService=e,this[i(478)]=1,this[i(934)]=0,this[i(282)]=i(756),this.hasImage=!0,this.visible=!1,this[i(924)]=this[i(1076)](new r.v),this[i(913)]=this[i(924)][i(1349)],this[i(640)][i(1517)].onUpdate((()=>this[i(594)]())),this[i(594)]()}[t(594)](){const e=t,i=this[e(640)][e(1517)][e(1231)];if(!i)return void(this[e(1105)]&&(this[e(817)]="",this[e(1105)]=!1,this[e(924)][e(617)]()));const s=i[e(890)]-i[e(1375)],r=i[e(459)]-i[e(1171)];this[e(817)]=s+e(997)+r,this[e(798)]=e(895)+s+" pixels wide by "+r+e(1247),this.visible=!0,this._onUpdate[e(617)]()}};var Ti,Ii;Li=function(e,i,s,r){const n=t;var o,h=arguments[n(589)],a=h<3?i:null===r?r=Object.getOwnPropertyDescriptor(i,s):r;if(typeof Reflect===n(477)&&typeof Reflect[n(414)]===n(847))a=Reflect[n(414)](e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object[n(1262)](i,s,a),a}([(Ti=0,Ii=De,function(t,e){Ii(t,e,Ti)})],Li);let Ai=class extends e.JT{constructor(e){const i=t;super(),this[i(640)]=e,this[i(478)]=1,this[i(934)]=0,this[i(282)]="selection-topleft",this.hasImage=!0,this[i(1105)]=!1,this[i(924)]=this[i(1076)](new r.v),this[i(913)]=this[i(924)][i(1349)],this[i(640)][i(1517)].onUpdate((()=>this._update())),this[i(594)]()}[t(594)](){const e=t,i=this[e(640)][e(1517)][e(1231)];i?(this.text=i.left+", "+i.top,this[e(798)]=e(493)+i.left+e(388)+i[e(1171)],this[e(1105)]=!0,this._onUpdate[e(617)]()):this[e(1105)]&&(this[e(817)]="",this[e(1105)]=!1,this._onUpdate[e(617)]())}};var Ri,Bi;Ai=function(e,i,s,r){const n=t;var o,h=arguments[n(589)],a=h<3?i:null===r?r=Object[n(1037)](i,s):r;if(typeof Reflect===n(477)&&"function"==typeof Reflect[n(414)])a=Reflect[n(414)](e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object[n(1262)](i,s,a),a}([(Ri=0,Bi=De,function(t,e){Bi(t,e,Ri)})],Ai),$e[t(1076)]({start(e){const i=t;e[i(1006)](Pe)[i(989)](e.get(xe).createInstance(Ai)),e[i(1006)](Pe)[i(989)](e[i(1006)](xe)[i(1129)](Li));const s=e.get(De),r=e[i(1006)](be)[i(1356)](5,!1);s[i(1517)][i(913)]((()=>{const t=i;r[t(766)](!!s[t(1517)][t(1231)])}))}}),oi({id:t(392),label:t(297),section:t(1344),run:e=>e[t(1006)](De)[t(1517)][t(1162)](),keys:t(925)}),oi({id:t(1282),label:t(960),section:"Selection",run:e=>e[t(1006)](De).selection.deselect(),keys:t(1367),enabled:5}),oi({id:"selection.erase",label:t(1331),section:"Selection",run:e=>e.get(De)[t(1517)][t(537)](),keys:t(769),enabled:5});class Mi extends e.JT{constructor(e,i,s){const r=t;super(),this.id=e,this[r(810)]=!0,this._contentElement=document[r(1067)](r(1439)),this[r(358)].id=s[r(1188)]().replace(/ /g,""),this[r(358)][r(738)][r(1046)](r(1348),r(699)),i[r(1154)](this[r(358)]),this.register({dispose:()=>{const t=r;i[t(507)](this[t(358)])}})}get[t(909)](){return this[t(810)]}set[t(909)](e){const i=t;this[i(810)]=e,this[i(358)][i(341)][i(398)]=this[i(810)]?"":i(606)}}var Di=function(e,i,s,r){const n=t;var o,h=arguments[n(589)],a=h<3?i:null===r?r=Object[n(1037)](i,s):r;if("object"==typeof Reflect&&typeof Reflect[n(414)]===n(847))a=Reflect[n(414)](e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object[n(1262)](i,s,a),a},Pi=function(t,e){return function(i,s){e(i,s,t)}};class Ui extends Mi{constructor(e,i,s,r){const n=t;super(0===e?"topStatusBar":n(1431),i,"Status Bar"),this[n(1406)]=e,this[n(1008)]=s,this[n(672)]=r,this._itemDisposables=new Map,this[n(1441)]=document[n(1067)](n(1439)),this[n(1441)][n(738)][n(1046)](n(1369)),this[n(875)]=document[n(1067)](n(1439)),this[n(875)][n(738)].add("right-items"),(0===this._target?this[n(1008)][n(462)]:this._statusBarService[n(455)])((t=>this[n(898)](t))),(0===this._target?this[n(1008)].onDidRemoveTopItem:this._statusBarService[n(1328)])((t=>this[n(1499)](t))),this[n(358)].append(this._leftItemsElement,this[n(875)]),this[n(1076)]({dispose:()=>{const t=n;for(const e of this[t(522)].values())for(const i of e)i[t(1424)]()}})}[t(898)](e){const i=t,s=[],r=0===e[i(934)]?this[i(1441)]:this[i(875)],n=document[i(1067)](i(641));if(n[i(738)].add(i(260)),e[i(282)]&&n.classList[i(1046)](e[i(282)]),e.hasImage&&n[i(738)].add("image","luna-icon-before"),e[i(798)]&&(n.title=e[i(798)]),n.addEventListener(i(1063),(()=>{const t=i;e[t(861)]&&this[t(672)][t(273)](e.commandId)})),e.input){const t=i(505)+Math[i(710)](1e6*Math.random());switch(e[i(815)][i(1404)]){case i(680):{const s=e[i(815)],r=document[i(1067)](i(1222));r[i(899)]=e[i(817)]+": ",r.setAttribute("for",t);const o=document[i(1067)](i(1059));o.id=t;for(const t of s[i(1403)]){const e=document[i(1067)](i(821));e[i(811)]=t,e.textContent=t,o[i(1154)](e)}o.value=s[i(256)],o[i(664)]("change",(()=>s[i(224)](o[i(811)]))),s[i(927)]((t=>o[i(811)]=t)),n[i(931)](r,o);break}case i(1030):{const s=e.input,r=document[i(1067)](i(1222));r[i(899)]=e[i(817)]+": ",r.setAttribute(i(626),t);const o=document[i(1067)]("input");o.id=t,o[i(1404)]="number",s[i(1321)]&&(o[i(1321)]=s[i(1321)][i(1434)]()),s[i(1487)]&&(o.max=s[i(1487)][i(1434)]()),o[i(811)]=s[i(256)][i(1434)](),o[i(664)]("input",(()=>{o[i(293)]()&&s.setOption(parseInt(o.value))})),s[i(927)]((t=>o[i(811)]=t[i(1434)]())),n.append(r,o);break}}}e[i(913)]&&s[i(1463)](e[i(913)]((()=>this[i(375)](e,n)))),this._updateItem(e,n),r[i(1154)](n),s[i(1463)]({dispose:()=>r[i(507)](n)}),this[i(522)].set(e,s)}[t(1499)](e){const i=t,s=this[i(522)][i(1006)](e);if(s){for(const t of s)t.dispose();this._itemDisposables[i(769)](e)}}[t(375)](e,i){const s=t;e.input?i[s(1524)]("label").textContent=e[s(817)]+": ":(i[s(899)]=e[s(817)],i[s(738)][s(980)]("no-text",0===e[s(817)]?.[s(589)])),e[s(798)]&&(i[s(798)]=e[s(798)]),i.style[s(398)]=!1===e[s(1105)]?s(606):"",i[s(738)][s(980)](s(1278),!!e.commandId&&!1!==e.enabled),i.classList[s(980)](s(471),!!e[s(471)]),void 0!==e[s(740)]&&i.classList[s(980)](s(768),!e[s(740)])}}let ki=class extends Ui{constructor(t,e,i){super(0,t,e,i)}};ki=Di([Pi(1,Pe),Pi(2,ve)],ki);let Fi=class extends Ui{constructor(t,e,i){super(1,t,e,i)}};Fi=Di([Pi(1,Pe),Pi(2,ve)],Fi),Ve[t(1076)](t(420),{anchor:t(1171),ctor:ki}),Ve[t(1076)](t(1431),{anchor:t(459),ctor:Fi}),oi({id:t(1381),label:t(1258),section:t(831),run:e=>e[t(1006)](Ne)[t(172)](t(420))}),oi({id:t(1157),label:t(1176),section:t(831),run:e=>e[t(1006)](Ne)[t(172)](t(1431))});class Ni extends e.JT{constructor(e,i){const s=t;super(),this[s(228)]=e,this[s(282)]=i,this[s(478)]=0,this[s(934)]=0,this[s(609)]=!0,this[s(817)]="",this[s(924)]=this.register(new r.v),this[s(913)]=this[s(924)][s(1349)],this[s(228)][s(913)]&&this.register(this[s(228)].onUpdate((()=>this[s(594)]()))),this[s(594)]()}[t(594)](){const e=t;switch(this[e(228)].type){case"expand-canvas-to-selection":this.commandId="image.expandCanvasToSelection";break;default:throw new Error(e(887)+this._action[e(1404)]+'"')}this.title=this[e(228)].name,this[e(740)]=this._action[e(740)],this[e(924)].fire()}}class Oi{constructor(){this[t(636)]=[]}[t(321)](e){const i=t,s=e.get(De),r=e[i(1006)](Pe);s[i(307)][i(419)]((()=>this[i(594)](s,r)))}[t(594)](e,i){const s=t;for(const t of this[s(636)])t.dispose();this[s(636)].length=0;const r=e[s(307)][s(1139)];for(const t of r)this[s(636)][s(1463)](i[s(989)](new Ni(t,e.tool[s(1057)]+"-"+t[s(1404)])))}}class Hi extends e.JT{constructor(e,i){const s=t;super(),this[s(237)]=e,this[s(282)]=i,this[s(478)]=1,this.alignment=0,this.hasImage=!0,this[s(1105)]=!1,this._onUpdate=this[s(1076)](new r.v),this.onUpdate=this[s(924)].event,this[s(1076)](this[s(237)][s(913)]((()=>this._update()))),this[s(594)]()}[t(594)](){const e=t;this._info[e(1105)]?(this[e(817)]=this[e(237)][e(541)](),this[e(798)]=this[e(237)][e(1043)](),this[e(1105)]=!0,this[e(924)].fire()):this.visible&&(this[e(817)]="",this[e(1105)]=!1,this[e(924)][e(617)]())}}class Vi{constructor(){this[t(636)]=[]}[t(321)](e){const i=t,s=e.get(De),r=e[i(1006)](Pe);s.tool[i(419)]((()=>this[i(594)](s,r)))}[t(594)](e,i){const s=t;for(const t of this[s(636)])t[s(1424)]();switch(this[s(636)][s(589)]=0,e[s(307)][s(1057)]){case s(567):for(const t of e[s(307)][s(832)])(t[s(1404)]===s(625)||t[s(1404)]===s(218))&&this[s(636)][s(1463)](i[s(989)](new Hi(t,e[s(307)][s(1057)]+"-"+t[s(1404)])))}}}class zi{constructor(){this._activeItems=[]}start(e){const i=t,s=e[i(1006)](De),r=e[i(1006)](Pe);s[i(307)].onToolChange((()=>this[i(594)](s,r)))}_update(e,i){const s=t;for(const t of this._activeItems)t.dispose();this[s(636)][s(589)]=0;const r=e.tool[s(1403)];for(const t of r)switch(t[s(1404)]){case"boolean":break;case s(680):const e=t;this._addOption(i,t.name,{type:"string",currentValue:e.value,options:e[s(1403)],setOption:e=>t[s(811)]=e,onHistoryUpdateValue:t[s(927)]});break;case s(1030):const r=t;this._addOption(i,t.name,{type:"number",currentValue:r.value,min:r[s(1321)],max:r.max,setOption:e=>t.value=e,onHistoryUpdateValue:t.onHistoryUpdateValue})}}[t(298)](e,i,s){const r=t;this._activeItems.push(e[r(989)]({target:0,alignment:0,dispose:()=>{},text:i,input:s}))}}var ji=function(t,e){return function(i,s){e(i,s,t)}};const Wi=new Map([[t(1517),"S"],[t(1197),"M"],["pencil","P"],["moveSelection","M"],["eraser","E"],[t(351),"K"],[t(874),"F"],[t(1343),"Z"],["rectangle","O"]]);let qi=class extends fi{constructor(e,i,s){const r=t;super("tools",e,r(1014),"topleft"),this[r(1355)]=i,this[r(456)]=s,this._toolElements=new Map,this[r(1257)]=this[r(456)][r(1356)](0,!0),this[r(1076)](this[r(312)]((t=>this[r(1257)].set(t))));const n=r(982),o=document[r(361)]();for(const t of[r(1517),r(1197),r(982),r(1401),"eraser","colorPicker","fill",r(1343),r(567)]){const e=document[r(1067)](r(815));e.name=r(307),e[r(1404)]=r(426),e[r(738)][r(1046)]("tool",t,r(1107));const i=Gi(t),s=Wi[r(1006)](t);e.title=s?i+" ("+s+")":""+i,e[r(659)](r(1363),i),this[r(975)][r(766)](t,e),e[r(471)]=t===n,e.addEventListener(r(319),(()=>{const i=r;this._luna.tool[i(836)](t),e[i(711)]()})),o[r(1154)](e)}this._contentElement[r(1154)](o),this[r(1076)](this._luna[r(307)][r(419)]((t=>this[r(975)][r(1006)](t.id)[r(471)]=!0))),this[r(1355)].tool[r(836)](n)}};function Gi(e){const i=t;return((e[i(952)](0,1)[i(751)]()+e[i(952)](1))[i(515)](/[A-Z][a-z]+/g)||[])[i(274)](" ")}function Xi(e,i){const s=t,r=e.get(De);r[s(307)][s(836)](i),r[s(1266)][s(838)]()}qi=function(e,i,s,r){const n=t;var o,h=arguments[n(589)],a=h<3?i:null===r?r=Object[n(1037)](i,s):r;if(typeof Reflect===n(477)&&"function"==typeof Reflect[n(414)])a=Reflect.decorate(e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object.defineProperty(i,s,a),a}([ji(1,De),ji(2,be)],qi),je.register(t(1035),{ctor:qi,defaultVisible:!0}),$e[t(1076)](new zi),$e[t(1076)](new Oi),$e[t(1076)](new Vi),oi({id:t(1015),label:t(1503),section:t(831),checked:0,run:e=>e.get(Ne).toggleView(t(1035))}),oi({id:t(168),label:"Color Picker",section:t(743),run:t=>Xi(t,"colorPicker"),keys:"k"}),oi({id:"tool.eraser",label:t(1512),section:t(743),run:e=>Xi(e,t(382)),keys:"e"}),oi({id:t(1071),label:"Fill",section:t(743),run:e=>Xi(e,t(874)),keys:"f"}),oi({id:t(176),label:t(394),section:"Tool",run:e=>Xi(e,t(1197))}),oi({id:t(411),label:"Move Selection",section:t(743),run:e=>Xi(e,t(1401))}),oi({id:t(1169),label:t(1275),section:t(743),run:e=>{const i=t;e.get(De).tool[i(1057)]===i(1197)?Xi(e,i(1401)):Xi(e,i(1197))},keys:"m"}),oi({id:t(227),label:t(1218),section:t(743),run:t=>Xi(t,"pencil"),keys:"p"}),oi({id:t(1378),label:t(1342),section:t(743),run:e=>Xi(e,t(567)),keys:"o"}),oi({id:"tool.selection",label:t(1344),section:t(743),run:e=>Xi(e,t(1517)),keys:"s"}),oi({id:t(492),label:t(440),section:t(743),run:e=>Xi(e,t(1343)),keys:"z"}),oi({id:t(868),label:t(845),section:"View",run:e=>e[t(1006)](De)[t(1266)][t(383)]()}),oi({id:t(648),label:t(1235),section:t(242),run:e=>e[t(1006)](De)[t(1266)].zoomOut()}),oi({id:t(300),label:t(986),section:t(242),run:e=>e[t(1006)](De)[t(1266)][t(1343)]=1,keys:"ctrl+0"}),oi({id:t(476),label:t(746),section:t(242),run:e=>e[t(1006)](De).viewport.fitToWindow(),keys:t(403)}),oi({id:t(1520),label:t(614),section:t(242),run:e=>{const i=t,s=e[i(1006)](De).viewport;s.isPixelGridEnabled=!s[i(863)]}});let Ji=class extends e.JT{constructor(e){const i=t;super(),this[i(640)]=e,this.target=0,this[i(934)]=1,this[i(282)]="pixel-grid",this.hasImage=!0,this[i(817)]="",this.title=i(475),this[i(861)]=i(1520),this[i(924)]=this[i(1076)](new r.v),this.onUpdate=this[i(924)][i(1349)],this[i(640)][i(1266)][i(820)]((()=>this[i(594)]())),this[i(594)]()}[t(594)](){const e=t;this[e(471)]=this[e(640)][e(1266)].isPixelGridEnabled,this[e(924)][e(617)]()}};var Yi,Ki;Ji=function(e,i,s,r){const n=t;var o,h=arguments.length,a=h<3?i:null===r?r=Object[n(1037)](i,s):r;if(typeof Reflect===n(477)&&typeof Reflect[n(414)]===n(847))a=Reflect.decorate(e,i,s,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object[n(1262)](i,s,a),a}([(Yi=0,Ki=De,function(t,e){Ki(t,e,Yi)})],Ji);let $i=class extends e.JT{constructor(e){const i=t;super(),this[i(640)]=e,this[i(478)]=1,this[i(934)]=1,this[i(282)]=i(1343),this[i(609)]=!0,this[i(924)]=this[i(1076)](new r.v),this[i(913)]=this._onUpdate[i(1349)],this[i(640)][i(1266)][i(637)]((()=>this._update())),this._update()}_update(){const e=t,i=(100*this[e(640)][e(1266)][e(1343)])[e(1408)](0);this.text=i+"%",this[e(798)]=e(232)+i+"%",this[e(924)].fire()}};var Zi,Qi;$i=function(e,i,s,r){const n=t;var o,h=arguments[n(589)],a=h<3?i:null===r?r=Object.getOwnPropertyDescriptor(i,s):r;if(typeof Reflect===n(477)&&typeof Reflect.decorate===n(847))a=Reflect[n(414)](e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object[n(1262)](i,s,a),a}([(Zi=0,Qi=De,function(t,e){Qi(t,e,Zi)})],$i),$e[t(1076)]({start(e){const i=t,s=e[i(1006)](Pe),r=e[i(1006)](xe);s.createItem(r[i(1129)]($i)),s[i(989)](r[i(1129)](Ji))}});var ts=function(t,e){return function(i,s){e(i,s,t)}};let es=class extends fi{constructor(i,s,r,n,o){const h=t;super(h(1243),i,h(888),h(1126)),this[h(1355)]=s,this[h(456)]=r,this[h(672)]=n,this[h(1217)]=o,this._timeout=0,this._windowVisibleContextKey=this._contextKeyService[h(1356)](3,!0),this[h(1076)](this[h(312)]((t=>this[h(1257)][h(766)](t))));const a=this[h(941)]("minimap-stretch",h(1159),this[h(1217)].isStretchEnabled,h(465));this[h(1217)][h(393)]((t=>{a[h(471)]=t,this._queueUpdate(),this._viewportUpdate()}));const c=this[h(941)](h(1472),h(1125),this[h(1217)].showViewport,h(251));this[h(1217)][h(430)]((t=>{const e=h;c[e(471)]=t,this[e(332)]()})),this._headerContentElement.append(a,c),this._canvas=document[h(1067)](h(572)),this._canvas[h(590)]=200,this[h(1530)].height=200,this._canvas[h(341)].width="200px",this._canvas[h(341)][h(230)]="200px",this[h(1076)]((0,e.Lw)(this._canvas,h(192),(t=>{const e=h;if(!this[e(1101)](t)){const i=this._createMinimapImageBounds();this[e(1355)][e(1266)].x=-((t[e(665)]-i[e(1375)])/i[e(590)]*this[e(1355)][e(1100)].width-this[e(1355)][e(1100)][e(590)]/2),this[e(1355)][e(1266)].y=-((t[e(839)]-i.top)/i.height*this._luna[e(1100)].height-this[e(1355)][e(1100)][e(230)]/2)}this[e(1530)][e(1053)](t[e(1523)]),this[e(1530)][e(738)][e(1046)](e(1206)),this._clickOrigin=[t[e(665)],t[e(839)]],this[e(1161)]=[this[e(1355)][e(1266)].x,this[e(1355)][e(1266)].y],this[e(676)]()}))),this[h(1076)]((0,e.Lw)(this[h(1530)],h(1093),(t=>{const e=h;this[e(1530)][e(1432)](t[e(1523)]),this[e(1530)].classList[e(1261)](e(1206)),this._clickOrigin=void 0,this._viewportOrigin=void 0}))),this[h(1076)]((0,e.Lw)(this[h(1530)],"pointermove",(t=>{const e=h,i=this._luna[e(1266)][e(415)],s=0===i.left&&0===i[e(1171)]&&i[e(890)]===this[e(1355)][e(1100)][e(590)]&&i[e(459)]===this[e(1355)][e(1100)][e(230)];if(this[e(1530)][e(738)][e(980)]("in-viewport",!s&&this[e(1101)](t)),!this[e(583)]||!this[e(1161)])return;const r=this._createMinimapImageBounds();this[e(1355)][e(1266)].x=this[e(1161)][0]+(this[e(583)][0]-r[e(1375)]-(t.offsetX-r[e(1375)]))*(this[e(1355)][e(1100)][e(590)]/r[e(590)]),this[e(1355)][e(1266)].y=this[e(1161)][1]+(this[e(583)][1]-r.top-(t[e(839)]-r.top))*(this[e(1355)][e(1100)].height/r[e(230)])}))),this[h(1076)]((0,e.Lw)(this._canvas,h(450),(t=>{const e=h;ee?t[e(1332)]<0?this[e(1355)][e(1266)][e(383)](-t.deltaY/20):this._luna[e(1266)][e(308)](t[e(1332)]/20):t[e(1332)]<0?this[e(1355)].viewport.zoomIn():this[e(1355)][e(1266)][e(308)]()}))),this[h(1230)]=this._canvas[h(1295)]("2d"),this[h(774)]=document[h(1067)](h(1439)),this._viewportElement[h(738)][h(1046)]("minimap-viewport"),this[h(358)].append(this[h(1530)],this[h(774)]),this.register(this[h(1355)].history[h(431)]((()=>this[h(676)]()))),this.register(this[h(1355)][h(1100)][h(1283)]((()=>this[h(676)]()))),this[h(1076)](this[h(1355)][h(1266)][h(913)]((()=>this[h(332)]()))),this[h(594)](),this[h(332)]()}_queueUpdate(){const e=t;if(this[e(1355)][e(1100)].width*this[e(1355)][e(1100)][e(230)]>5e6)return console[e(832)](e(314)),void this[e(1530)][e(738)].add("hidden");this[e(1355)][e(1100)].width&&0===this._timeout&&(this[e(1085)]=setTimeout((()=>{const t=e;this[t(594)](),this[t(1085)]=0}),0))}async[t(594)](){const e=t,i=await this[e(1355)].file[e(992)]();if(!i.width||!i[e(230)])return void this[e(1530)][e(738)].add(e(1313));this[e(1530)][e(738)][e(1261)](e(1313));const s=new ImageData(new Uint8ClampedArray(i[e(1525)]),i.width,i.height),r=await createImageBitmap(s);this[e(1230)][e(812)]=i[e(590)]>200||i[e(230)]>200,this._ctx[e(993)](0,0,200,200);const n=this[e(1330)]();this[e(1230)][e(355)](r,n[e(1375)],n[e(1171)],n[e(590)],n[e(230)])}[t(332)](){const e=t;if(!this[e(1355)][e(1100)][e(590)])return;const i=this[e(1355)][e(1100)],s=this[e(1330)](),r=this[e(1355)][e(1266)].visibleRange,n=0===r[e(1375)]&&0===r[e(1171)]&&r.right===i[e(590)]&&r[e(459)]===i.height;this._viewportElement[e(738)][e(980)](e(1313),n||!this[e(1217)][e(871)]),this._viewportPosition={left:s[e(1375)]+Math[e(710)](r[e(1375)]/i[e(590)]*s[e(590)]),top:s[e(1171)]+Math[e(710)](r.top/i[e(230)]*s[e(230)]),width:Math.round((r[e(890)]-r[e(1375)])/i.width*s[e(590)]),height:Math[e(710)]((r[e(459)]-r[e(1171)])/i[e(230)]*s[e(230)])},this[e(774)].style[e(1375)]=this._viewportPosition.left+"px",this._viewportElement[e(341)][e(1171)]=this[e(775)][e(1171)]+"px",this[e(774)][e(341)].width=this[e(775)][e(590)]+"px",this[e(774)].style.height=this[e(775)][e(230)]+"px"}_eventInViewport(e){const i=t;return!!this[i(775)]&&e.offsetX>this[i(775)][i(1375)]&&e[i(665)]<this[i(775)][i(1375)]+this._viewportPosition.width&&e[i(839)]>this._viewportPosition[i(1171)]&&e[i(839)]<this._viewportPosition.top+this[i(775)][i(230)]}_createToggle(e,i,s,r){const n=t,o=document[n(1067)](n(815));return o.type=n(389),o.id=e,o.checked=s,o.title=r,o[n(738)][n(1046)](e,n(1107)),o[n(664)](n(1063),(()=>this._commandService[n(273)](i))),o}[t(1330)](){const e=t;return(0,Ht.M_)(this[e(1355)][e(1100)][e(590)],this[e(1355)][e(1100)][e(230)],200,200,this[e(1217)][e(470)])}};es=function(e,i,s,r){const n=t;var o,h=arguments[n(589)],a=h<3?i:null===r?r=Object[n(1037)](i,s):r;if(typeof Reflect===n(477)&&typeof Reflect[n(414)]===n(847))a=Reflect[n(414)](e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object.defineProperty(i,s,a),a}([ts(1,De),ts(2,be),ts(3,ve),ts(4,Ge)],es),je[t(1076)](t(1243),{ctor:es,defaultVisible:!0}),oi({id:t(1026),label:t(1045),section:t(831),checked:3,run:e=>e[t(1006)](Ne).toggleView(t(1243))}),oi({id:t(1125),label:t(1081),section:t(888),run:e=>{const i=t,s=e[i(1006)](Ge);s.showViewport=!s[i(871)]}}),oi({id:t(1159),label:t(789),section:t(888),run:t=>{const e=t.get(Ge);e.isStretchEnabled=!e.isStretchEnabled}});var is=function(t,e){return function(i,s){e(i,s,t)}};let ss=class extends fi{constructor(i,s,r){const n=t;super(n(502),i,n(833),n(1126)),this[n(1355)]=s,this[n(456)]=r,this[n(926)]=new Map,this[n(765)]=new Map,this[n(1257)]=this[n(456)].bind(1,!0),this.register(this[n(312)]((t=>this[n(1257)][n(766)](t)))),this[n(801)]=document[n(1067)](n(1439)),this[n(801)][n(738)][n(1046)](n(458));const o=document[n(1067)](n(1439));o[n(738)][n(1046)](n(1139)),o[n(931)](this[n(976)]("layer-new",(()=>this[n(1355)][n(1100)][n(209)]()),n(1224)),this._createButton(n(555),(()=>this[n(1355)][n(1100)][n(1036)]()),n(305)),this._createButton("layer-merge",(()=>this[n(1355)][n(1100)].mergeLayerDown()),"Merge the active layer down"),this[n(976)](n(1482),(()=>this._luna.layer[n(155)]()),n(755)),this[n(976)]("layer-move-down",(()=>this[n(1355)][n(1100)][n(857)]()),n(1113)),this[n(724)]()),this._contentElement[n(931)](this[n(801)],o),this[n(1076)](this[n(1355)][n(1100)].onLayerChange((()=>this[n(937)]()))),this[n(1076)]({dispose:()=>{const t=n;for(const i of this[t(926)][t(1032)]())(0,e._c)(i[t(563)])}}),this[n(937)]()}_createButton(e,i,s){const r=t,n=document[r(1067)](r(1504));n.id=e,n[r(798)]=s;const o=document.createElement(r(771));return n[r(1154)](o),n[r(738)][r(1046)](e,r(1107)),n[r(664)](r(1063),i),n}[t(724)](){const e=t,i=document[e(1067)](e(1059)),s=[e(387),"darken",e(1464),e(1292),e(1391),e(805),"linearDodgeAdd",e(1091),e(995),e(1413),e(1421)];for(const t of s){const s=document[e(1067)]("option");s[e(899)]=t,s[e(811)]=t,this._blendModeOptions[e(766)](t,s),i[e(1154)](s)}return i.addEventListener(e(319),(()=>{const t=e;this[t(1355)][t(1100)][t(1276)]&&(this._luna[t(1100)][t(1276)][t(1102)]=i[t(811)])})),i}[t(937)](){const e=t,i=this._luna.layer[e(502)],s=this[e(1355)][e(1100)][e(1276)];let r=null;for(let t=i[e(589)]-1;t>=0;t--){const n=i[t];if(!this[e(926)][e(1204)](n.id)){const t={container:document[e(1067)](e(1439)),nameSpan:document.createElement(e(641)),previewCanvas:document[e(1067)](e(572)),visibleCheckbox:document[e(1067)](e(815)),disposables:[]};t[e(865)][e(738)][e(1046)](e(1100)),t[e(1505)][e(738)].add(e(353)),t[e(1505)].width=40,t[e(1505)][e(230)]=40;let i=!1;t[e(563)].push(n[e(913)]((()=>i=!0))),this[e(286)].push(this._luna[e(1155)][e(431)]((()=>{i&&(this[e(635)](n,t),i=!1)}))),this[e(635)](n,t),t[e(865)][e(1154)](t[e(1505)]),t[e(291)].classList.add(e(395)),t[e(291)][e(664)]("click",(()=>this[e(1355)][e(1100)][e(1276)]=n)),t[e(865)].appendChild(t.nameSpan),t[e(685)][e(1404)]=e(389),t.visibleCheckbox.classList.add(e(1105)),t[e(685)].addEventListener(e(319),(()=>n[e(909)]=!n[e(909)])),t[e(865)].appendChild(t[e(685)]),this[e(926)][e(766)](n.id,t),t.disposables[e(1463)](n.onDispose((()=>{const i=e;this[i(801)].removeChild(t.container);for(const e of t.disposables)e[i(1424)]();this[i(926)].delete(n.id)})))}const o=this[e(926)].get(n.id),h=n.id===s?.id;o[e(865)][e(738)].toggle(e(1018),h),o[e(291)][e(899)]=n[e(395)],o.visibleCheckbox[e(471)]=n[e(909)],null===r?(!o[e(865)][e(409)]||null!==o[e(865)][e(1174)])&&(this[e(801)][e(1335)]?this[e(801)].insertBefore(o[e(865)],this[e(801)].firstChild):this[e(801)][e(1154)](o.container)):o.container[e(1174)]!==r&&r[e(408)]("afterend",o.container),r=o.container}if(s){const t=this[e(765)].get(s[e(1102)]);t&&(t.selected=!0)}}_generatePreview(e,i){const s=t;e[s(1108)](40,40)[s(739)]((t=>{const e=s,r=i[e(1505)][e(1295)]("2d");r[e(812)]=!1,r[e(993)](0,0,40,40),r[e(355)](t,0,0)}))}};function rs(){const e=t,i=os(getComputedStyle(document[e(248)])[e(1293)](e(779)));void 0!==i&&document[e(1219)][e(341)].setProperty("--luna-icon-brightness",i);const s=os(getComputedStyle(document.documentElement).getPropertyValue(e(932)));void 0!==s&&document[e(1219)][e(341)][e(1227)](e(1027),s)}function ns(e,i){const s=t;return e[s(1414)](s(1158),{key:s(607),value:i})}function os(e){const i=t;let s,r,n,o;if(e.startsWith(i(520)))[s,r,n,o]=e[i(211)](5,e[i(215)](")"))[i(822)](",")[i(542)]((t=>+t[i(762)]()));else{if(7!==e.length)return;s=parseInt(e[i(952)](1,2),16),r=parseInt(e.substr(3,2),16),n=parseInt(e[i(952)](5,2),16),o=1}return((s+r+n)*o/765)[i(1408)](2)}ss=function(e,i,s,r){const n=t;var o,h=arguments[n(589)],a=h<3?i:null===r?r=Object[n(1037)](i,s):r;if(typeof Reflect===n(477)&&typeof Reflect[n(414)]===n(847))a=Reflect[n(414)](e,i,s,r);else for(var c=e[n(589)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(i,s,a):o(i,s))||a);return h>3&&a&&Object[n(1262)](i,s,a),a}([is(1,De),is(2,be)],ss),je[t(1076)]("layers",{ctor:ss,defaultVisible:!0}),oi({id:"layer.toggleLayersWindow",label:t(682),section:t(831),checked:1,run:e=>e[t(1006)](Ne)[t(172)]("layers")}),oi({id:t(628),label:"Add New Layer",section:t(737),run:e=>e[t(1006)](De)[t(1100)][t(209)](),keys:t(1269)}),oi({id:t(967),label:t(1315),section:t(737),run:e=>e[t(1006)](De)[t(1100)][t(1036)](),keys:t(1078)}),oi({id:"layer.mergeLayerDown",label:"Merge Layer Down",section:t(737),run:e=>e[t(1006)](De).layer[t(1541)](),keys:t(1377)}),oi({id:t(673),label:"Flip Horizontal",section:t(737),run:async e=>{const i=t,s=e[i(1006)](De);s[i(955)][i(721)](i(1540),{selection:s[i(1517)][i(1231)]})}}),oi({id:t(804),label:t(304),section:"Layer",run:async e=>{const i=t,s=e[i(1006)](De);s[i(955)][i(721)](i(1394),{selection:s.selection[i(1231)]})}}),oi({id:t(1297),label:t(166),section:t(737),run:async e=>{const i=t,s=e[i(1006)](De);s[i(955)][i(721)](i(385),{selection:s[i(1517)][i(1231)]})}}),oi({id:"layer.goToTopLayer",label:t(684),section:t(737),run:e=>e[t(1006)](De).layer[t(1216)](),keys:t(1058)}),oi({id:t(546),label:t(911),section:"Layer",run:e=>e[t(1006)](De)[t(1100)][t(447)](),keys:t(1534)}),oi({id:t(734),label:"Go to Layer Above",section:"Layer",run:e=>e[t(1006)](De)[t(1100)][t(1013)](),keys:t(1019)}),oi({id:t(1054),label:"Go to Layer Below",section:t(737),run:e=>e.get(De)[t(1100)][t(1031)](),keys:"alt+pagedown"}),oi({id:t(1094),label:t(1354),section:"Layer",run:e=>e[t(1006)](De)[t(1100)].moveLayerToTop()}),oi({id:t(929),label:t(1193),section:t(737),run:e=>e[t(1006)](De)[t(1100)][t(155)]()}),oi({id:"layer.moveLayerDown",label:t(302),section:t(737),run:e=>e[t(1006)](De).layer[t(857)]()}),oi({id:t(723),label:t(1451),section:t(737),run:e=>e[t(1006)](De)[t(1100)][t(485)]()}),$e[t(1076)]({start(e){const i=t,s=e[i(1006)](De),r=e[i(1006)](Ze),n=e.get(Oe);r[i(1383)]("luna.executeCommand",(async t=>{const s=i;let r=!0;try{await e[s(1006)](ve)[s(273)](t)}catch{r=!1}return{success:r}})),r[i(1383)](i(660),(async t=>{const e=i,r=await(t.isAutoSaveEnabled?s.file[e(645)]():s[e(1457)][e(1495)]());return{blobBuffer:Array[e(536)](new Uint8Array(await r[e(1305)]()))}})),r[i(1383)]("backup",(async t=>{const e=i;return t.hotExitMaxPixels&&t[e(1309)]<s[e(1100)][e(590)]*s.layer[e(230)]?{success:!1}:{success:!0,state:s.file.saveState(t[e(1309)])}})),r[i(1383)](i(1491),(async t=>{const e=i;await s[e(1457)].openBlob(new Blob([t[e(950)]]))})),r[i(1414)]("ready",void 0)[i(739)]((async t=>{const e=i;switch(t[e(1404)]){case e(1273):s[e(1457)].newImage(t[e(1133)][e(590)],t[e(1133)].height);break;case e(1491):await s[e(1457)][e(474)](new Blob([t[e(1525)]]));break;case"restore":(!t[e(678)]||0===t.state[e(1219)][e(1155)]?.[e(939)]?.[e(589)])&&(t.state[e(1219)][e(1155)]={currentEntry:0,entries:[(new B)[e(1180)]()]}),s[e(1457)][e(1450)](t[e(644)]),t.workbenchState&&n[e(1450)](t[e(1459)])}})),n[i(1337)]((t=>r[i(1414)](i(310),t))),r[i(1383)]("pauseanimations",(()=>s[i(1070)].pause())),window[i(664)](i(838),(()=>{ns(r,!0),s.render.resume()})),window[i(664)](i(711),(()=>{ns(r,!1)})),s[i(1155)][i(431)]((t=>{const e=i;!t||s[e(1155)].entries[e(589)]<=1||s[e(1155)].activeEntry!==s[e(1155)][e(939)][s.history[e(939)][e(589)]-1]||r.request(e(1040),{label:s.history[e(1333)][e(1090)]})})),oi({id:i(1426),label:i(557),section:"View",run:()=>{const t=i;return r[t(1414)](t(246),{command:t(696),args:">Luna: "})}}),e[i(1006)](Pe)[i(989)]({text:i(1290),alignment:0,className:i(1501),hasImage:!0,target:0,dispose:()=>{},commandId:i(1426)}),gi.redoHandler=()=>r[i(1414)](i(246),{command:i(240)}),gi[i(188)]=()=>r.request(i(246),{command:i(799)}),new MutationObserver((()=>rs()))[i(994)](document[i(248)],{attributes:!0,attributeFilter:[i(341)]}),rs()}});const hs=new Be,as=new re;as[t(955)].disableWorkers=!0,hs[t(1212)](De,as);const cs=window[t(1202)]();window.acquireVsCodeApi=void 0,hs[t(1212)](Ze,hs.createInstance(Qe,cs)),hs[t(1212)](Oe,hs[t(1129)](Ye)),hs[t(1212)](Fe,hs[t(1129)](si)),hs.setService(be,hs[t(1129)](Te)),hs[t(1212)](ve,hs[t(1129)](Le)),hs[t(1212)](Ae,hs[t(1129)](ei)),hs.setService(Pe,hs.createInstance(Ue)),hs.setService(Me,hs[t(1129)](ti)),hs[t(1212)](Ge,hs[t(1129)](Xe)),hs[t(1212)](Ne,hs.createInstance(qe)),new class{constructor(e){const i=t,s=document[i(1524)]("#canvas");e[i(849)](De)[i(1266)][i(239)](s);for(const t of $e[i(1195)]())e[i(254)](t.start.bind(t))}}(hs)})()})();