(()=>{var Ju={879:(l,P)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.ByteStream=void 0;class x{constructor(N){this.bytes=N,this.byteIndexCurrent=0}hasMoreBytes(){return this.byteIndexCurrent<this.bytes.length}readBytes(N){const k=this.byteIndexCurrent;return this.byteIndexCurrent+=N,this.bytes.slice(k,this.byteIndexCurrent)}readByte(){let N=this.bytes[this.byteIndexCurrent];return this.byteIndexCurrent++,N}readString(N){let k="";for(let v=0;v<N;v++){const m=this.readByte();m!=0&&(k+=String.fromCharCode(m))}return k}}P.ByteStream=x},7106:(l,P)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.ChunkSize=P.HeaderSizeInBytes=P.FileNameMaxLength=void 0,P.FileNameMaxLength=99,P.HeaderSizeInBytes=500,P.ChunkSize=512},5759:(l,P,x)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.TarFile=void 0;const I=x(879),N=x(7106),k=x(4108),v=x(3335);class m{constructor(E){this.entries=E}static fromBytes(E){const T=new I.ByteStream(E),M=[],A=N.ChunkSize;let j=0;for(;T.hasMoreBytes()==!0;){const ee=T.readBytes(A);let V=!0;for(let te=0;te<ee.length;te++)if(ee[te]!=0){V=!1;break}if(V==!0){if(j++,j==2)break}else{j=0;const te=k.TarFileEntry.fromBytes(ee,T);M.push(te)}}let re=new m(M);return re.consolidateLongPathEntries(),re}consolidateLongPathEntries(){var E;const T=v.TarFileTypeFlag.Instances().LongFilePath.name,M=this.entries;for(let A=0;A<M.length;A++){const j=M[A];if(((E=j.header.typeFlag)===null||E===void 0?void 0:E.name)==T){const re=M[A+1];re.header.fileName=j.dataAsBytes.reduce((ee,V)=>ee+=String.fromCharCode(V),""),re.header.fileName=re.header.fileName.replace(/\0/g,""),M.splice(A,1),A--}}}}P.TarFile=m},4108:(l,P,x)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.TarFileEntry=void 0;const I=x(7106),N=x(2895);class k{constructor(m,R){this.header=m,this.dataAsBytes=R}static fromBytes(m,R){const E=I.ChunkSize,T=N.TarFileEntryHeader.fromBytes(m),M=T.fileSizeInBytes,j=Math.ceil(M/E)*E,re=R.readBytes(j).slice(0,M);return new k(T,re)}}P.TarFileEntry=k},2895:(l,P,x)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.TarFileEntryHeader=void 0;const I=x(879),N=x(3335);class k{constructor(m,R,E,T,M,A,j,re,ee,V,te,ae,oe,le,L,K){this.fileName=m,this.fileMode=R,this.userIDOfOwner=E,this.userIDOfGroup=T,this.fileSizeInBytes=M,this.timeModifiedInUnixFormat=A,this.checksum=j,this.typeFlag=re,this.nameOfLinkedFile=ee,this.uStarIndicator=V,this.uStarVersion=te,this.userNameOfOwner=ae,this.groupNameOfOwner=oe,this.deviceNumberMajor=le,this.deviceNumberMinor=L,this.filenamePrefix=K,this.fullFileName=K.length?K.endsWith("/")?K+m:K+"/"+m:m}static fromBytes(m){const R=new I.ByteStream(m),E=R.readString(100).trim(),T=R.readString(8),M=R.readString(8),A=R.readString(8),j=R.readString(12),re=R.readBytes(12),ee=R.readString(8),V=R.readString(1),te=R.readString(100),ae=R.readString(6),oe=R.readString(2),le=R.readString(32),L=R.readString(32),K=R.readString(8),G=R.readString(8),ne=R.readString(155),ce=R.readBytes(12),ve=parseInt(j.trim(),8),y=parseInt(ee,8),$=N.TarFileTypeFlag.Instances()._All,W="_"+V,B=$[W];return new k(E,T,M,A,ve,re,y,B,te,ae,oe,le,L,K,G,ne)}}P.TarFileEntryHeader=k},3335:(l,P)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.TarFileTypeFlag=void 0;class x{constructor(k,v){this.value=k,this.id="_"+this.value,this.name=v}static Instances(){return x._instances==null&&(x._instances=new I),x._instances}}P.TarFileTypeFlag=x;class I{constructor(){this.Normal=new x("0","Normal"),this.HardLink=new x("1","Hard Link"),this.SymbolicLink=new x("2","Symbolic Link"),this.CharacterSpecial=new x("3","Character Special"),this.BlockSpecial=new x("4","Block Special"),this.Directory=new x("5","Directory"),this.FIFO=new x("6","FIFO"),this.ContiguousFile=new x("7","Contiguous File"),this.LongFilePath=new x("L","././@LongLink"),this._All=[this.Normal,this.HardLink,this.SymbolicLink,this.CharacterSpecial,this.BlockSpecial,this.Directory,this.FIFO,this.ContiguousFile,this.LongFilePath];for(let k=0;k<this._All.length;k++){const v=this._All[k];this._All[v.id]=v}}}},5790:(l,P,x)=>{"use strict";var I;I={value:!0},P.t9=I=I=I=void 0;const N=x(5759);I={enumerable:!0,get:function(){return N.TarFile}};const k=x(4108);I={enumerable:!0,get:function(){return k.TarFileEntry}};const v=x(2895);I={enumerable:!0,get:function(){return v.TarFileEntryHeader}},P.t9=m=>N.TarFile.fromBytes(m)},9669:(l,P,x)=>{l.exports=x(1609)},5448:(l,P,x)=>{"use strict";var I=x(4867),N=x(6026),k=x(4372),v=x(5327),m=x(4097),R=x(4109),E=x(7985),T=x(5061);l.exports=function(A){return new Promise(function(re,ee){var V=A.data,te=A.headers;I.isFormData(V)&&delete te["Content-Type"];var ae=new XMLHttpRequest;if(A.auth){var oe=A.auth.username||"",le=A.auth.password?unescape(encodeURIComponent(A.auth.password)):"";te.Authorization="Basic "+btoa(oe+":"+le)}var L=m(A.baseURL,A.url);if(ae.open(A.method.toUpperCase(),v(L,A.params,A.paramsSerializer),!0),ae.timeout=A.timeout,ae.onreadystatechange=function(){if(!(!ae||ae.readyState!==4)&&!(ae.status===0&&!(ae.responseURL&&ae.responseURL.indexOf("file:")===0))){var ne="getAllResponseHeaders"in ae?R(ae.getAllResponseHeaders()):null,ce=!A.responseType||A.responseType==="text"?ae.responseText:ae.response,ve={data:ce,status:ae.status,statusText:ae.statusText,headers:ne,config:A,request:ae};N(re,ee,ve),ae=null}},ae.onabort=function(){!ae||(ee(T("Request aborted",A,"ECONNABORTED",ae)),ae=null)},ae.onerror=function(){ee(T("Network Error",A,null,ae)),ae=null},ae.ontimeout=function(){var ne="timeout of "+A.timeout+"ms exceeded";A.timeoutErrorMessage&&(ne=A.timeoutErrorMessage),ee(T(ne,A,"ECONNABORTED",ae)),ae=null},I.isStandardBrowserEnv()){var K=(A.withCredentials||E(L))&&A.xsrfCookieName?k.read(A.xsrfCookieName):void 0;K&&(te[A.xsrfHeaderName]=K)}if("setRequestHeader"in ae&&I.forEach(te,function(ne,ce){typeof V=="undefined"&&ce.toLowerCase()==="content-type"?delete te[ce]:ae.setRequestHeader(ce,ne)}),I.isUndefined(A.withCredentials)||(ae.withCredentials=!!A.withCredentials),A.responseType)try{ae.responseType=A.responseType}catch(G){if(A.responseType!=="json")throw G}typeof A.onDownloadProgress=="function"&&ae.addEventListener("progress",A.onDownloadProgress),typeof A.onUploadProgress=="function"&&ae.upload&&ae.upload.addEventListener("progress",A.onUploadProgress),A.cancelToken&&A.cancelToken.promise.then(function(ne){!ae||(ae.abort(),ee(ne),ae=null)}),V||(V=null),ae.send(V)})}},1609:(l,P,x)=>{"use strict";var I=x(4867),N=x(1849),k=x(321),v=x(7185),m=x(5655);function R(T){var M=new k(T),A=N(k.prototype.request,M);return I.extend(A,k.prototype,M),I.extend(A,M),A}var E=R(m);E.Axios=k,E.create=function(M){return R(v(E.defaults,M))},E.Cancel=x(5263),E.CancelToken=x(4972),E.isCancel=x(6502),E.all=function(M){return Promise.all(M)},E.spread=x(8713),E.isAxiosError=x(6268),l.exports=E,l.exports.default=E},5263:l=>{"use strict";function P(x){this.message=x}P.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},P.prototype.__CANCEL__=!0,l.exports=P},4972:(l,P,x)=>{"use strict";var I=x(5263);function N(k){if(typeof k!="function")throw new TypeError("executor must be a function.");var v;this.promise=new Promise(function(E){v=E});var m=this;k(function(E){m.reason||(m.reason=new I(E),v(m.reason))})}N.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},N.source=function(){var v,m=new N(function(E){v=E});return{token:m,cancel:v}},l.exports=N},6502:l=>{"use strict";l.exports=function(x){return!!(x&&x.__CANCEL__)}},321:(l,P,x)=>{"use strict";var I=x(4867),N=x(5327),k=x(782),v=x(3572),m=x(7185);function R(E){this.defaults=E,this.interceptors={request:new k,response:new k}}R.prototype.request=function(T){typeof T=="string"?(T=arguments[1]||{},T.url=arguments[0]):T=T||{},T=m(this.defaults,T),T.method?T.method=T.method.toLowerCase():this.defaults.method?T.method=this.defaults.method.toLowerCase():T.method="get";var M=[v,void 0],A=Promise.resolve(T);for(this.interceptors.request.forEach(function(re){M.unshift(re.fulfilled,re.rejected)}),this.interceptors.response.forEach(function(re){M.push(re.fulfilled,re.rejected)});M.length;)A=A.then(M.shift(),M.shift());return A},R.prototype.getUri=function(T){return T=m(this.defaults,T),N(T.url,T.params,T.paramsSerializer).replace(/^\?/,"")},I.forEach(["delete","get","head","options"],function(T){R.prototype[T]=function(M,A){return this.request(m(A||{},{method:T,url:M,data:(A||{}).data}))}}),I.forEach(["post","put","patch"],function(T){R.prototype[T]=function(M,A,j){return this.request(m(j||{},{method:T,url:M,data:A}))}}),l.exports=R},782:(l,P,x)=>{"use strict";var I=x(4867);function N(){this.handlers=[]}N.prototype.use=function(v,m){return this.handlers.push({fulfilled:v,rejected:m}),this.handlers.length-1},N.prototype.eject=function(v){this.handlers[v]&&(this.handlers[v]=null)},N.prototype.forEach=function(v){I.forEach(this.handlers,function(R){R!==null&&v(R)})},l.exports=N},4097:(l,P,x)=>{"use strict";var I=x(1793),N=x(7303);l.exports=function(v,m){return v&&!I(m)?N(v,m):m}},5061:(l,P,x)=>{"use strict";var I=x(481);l.exports=function(k,v,m,R,E){var T=new Error(k);return I(T,v,m,R,E)}},3572:(l,P,x)=>{"use strict";var I=x(4867),N=x(8527),k=x(6502),v=x(5655);function m(R){R.cancelToken&&R.cancelToken.throwIfRequested()}l.exports=function(E){m(E),E.headers=E.headers||{},E.data=N(E.data,E.headers,E.transformRequest),E.headers=I.merge(E.headers.common||{},E.headers[E.method]||{},E.headers),I.forEach(["delete","get","head","post","put","patch","common"],function(A){delete E.headers[A]});var T=E.adapter||v.adapter;return T(E).then(function(A){return m(E),A.data=N(A.data,A.headers,E.transformResponse),A},function(A){return k(A)||(m(E),A&&A.response&&(A.response.data=N(A.response.data,A.response.headers,E.transformResponse))),Promise.reject(A)})}},481:l=>{"use strict";l.exports=function(x,I,N,k,v){return x.config=I,N&&(x.code=N),x.request=k,x.response=v,x.isAxiosError=!0,x.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},x}},7185:(l,P,x)=>{"use strict";var I=x(4867);l.exports=function(k,v){v=v||{};var m={},R=["url","method","data"],E=["headers","auth","proxy","params"],T=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],M=["validateStatus"];function A(V,te){return I.isPlainObject(V)&&I.isPlainObject(te)?I.merge(V,te):I.isPlainObject(te)?I.merge({},te):I.isArray(te)?te.slice():te}function j(V){I.isUndefined(v[V])?I.isUndefined(k[V])||(m[V]=A(void 0,k[V])):m[V]=A(k[V],v[V])}I.forEach(R,function(te){I.isUndefined(v[te])||(m[te]=A(void 0,v[te]))}),I.forEach(E,j),I.forEach(T,function(te){I.isUndefined(v[te])?I.isUndefined(k[te])||(m[te]=A(void 0,k[te])):m[te]=A(void 0,v[te])}),I.forEach(M,function(te){te in v?m[te]=A(k[te],v[te]):te in k&&(m[te]=A(void 0,k[te]))});var re=R.concat(E).concat(T).concat(M),ee=Object.keys(k).concat(Object.keys(v)).filter(function(te){return re.indexOf(te)===-1});return I.forEach(ee,j),m}},6026:(l,P,x)=>{"use strict";var I=x(5061);l.exports=function(k,v,m){var R=m.config.validateStatus;!m.status||!R||R(m.status)?k(m):v(I("Request failed with status code "+m.status,m.config,null,m.request,m))}},8527:(l,P,x)=>{"use strict";var I=x(4867);l.exports=function(k,v,m){return I.forEach(m,function(E){k=E(k,v)}),k}},5655:(l,P,x)=>{"use strict";var I=x(4867),N=x(6016),k={"Content-Type":"application/x-www-form-urlencoded"};function v(E,T){!I.isUndefined(E)&&I.isUndefined(E["Content-Type"])&&(E["Content-Type"]=T)}function m(){var E;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(E=x(5448)),E}var R={adapter:m(),transformRequest:[function(T,M){return N(M,"Accept"),N(M,"Content-Type"),I.isFormData(T)||I.isArrayBuffer(T)||I.isBuffer(T)||I.isStream(T)||I.isFile(T)||I.isBlob(T)?T:I.isArrayBufferView(T)?T.buffer:I.isURLSearchParams(T)?(v(M,"application/x-www-form-urlencoded;charset=utf-8"),T.toString()):I.isObject(T)?(v(M,"application/json;charset=utf-8"),JSON.stringify(T)):T}],transformResponse:[function(T){if(typeof T=="string")try{T=JSON.parse(T)}catch(M){}return T}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(T){return T>=200&&T<300}};R.headers={common:{Accept:"application/json, text/plain, */*"}},I.forEach(["delete","get","head"],function(T){R.headers[T]={}}),I.forEach(["post","put","patch"],function(T){R.headers[T]=I.merge(k)}),l.exports=R},1849:l=>{"use strict";l.exports=function(x,I){return function(){for(var k=new Array(arguments.length),v=0;v<k.length;v++)k[v]=arguments[v];return x.apply(I,k)}}},5327:(l,P,x)=>{"use strict";var I=x(4867);function N(k){return encodeURIComponent(k).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}l.exports=function(v,m,R){if(!m)return v;var E;if(R)E=R(m);else if(I.isURLSearchParams(m))E=m.toString();else{var T=[];I.forEach(m,function(j,re){j===null||typeof j=="undefined"||(I.isArray(j)?re=re+"[]":j=[j],I.forEach(j,function(V){I.isDate(V)?V=V.toISOString():I.isObject(V)&&(V=JSON.stringify(V)),T.push(N(re)+"="+N(V))}))}),E=T.join("&")}if(E){var M=v.indexOf("#");M!==-1&&(v=v.slice(0,M)),v+=(v.indexOf("?")===-1?"?":"&")+E}return v}},7303:l=>{"use strict";l.exports=function(x,I){return I?x.replace(/\/+$/,"")+"/"+I.replace(/^\/+/,""):x}},4372:(l,P,x)=>{"use strict";var I=x(4867);l.exports=I.isStandardBrowserEnv()?function(){return{write:function(v,m,R,E,T,M){var A=[];A.push(v+"="+encodeURIComponent(m)),I.isNumber(R)&&A.push("expires="+new Date(R).toGMTString()),I.isString(E)&&A.push("path="+E),I.isString(T)&&A.push("domain="+T),M===!0&&A.push("secure"),document.cookie=A.join("; ")},read:function(v){var m=document.cookie.match(new RegExp("(^|;\\s*)("+v+")=([^;]*)"));return m?decodeURIComponent(m[3]):null},remove:function(v){this.write(v,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}()},1793:l=>{"use strict";l.exports=function(x){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(x)}},6268:l=>{"use strict";l.exports=function(x){return typeof x=="object"&&x.isAxiosError===!0}},7985:(l,P,x)=>{"use strict";var I=x(4867);l.exports=I.isStandardBrowserEnv()?function(){var k=/(msie|trident)/i.test(navigator.userAgent),v=document.createElement("a"),m;function R(E){var T=E;return k&&(v.setAttribute("href",T),T=v.href),v.setAttribute("href",T),{href:v.href,protocol:v.protocol?v.protocol.replace(/:$/,""):"",host:v.host,search:v.search?v.search.replace(/^\?/,""):"",hash:v.hash?v.hash.replace(/^#/,""):"",hostname:v.hostname,port:v.port,pathname:v.pathname.charAt(0)==="/"?v.pathname:"/"+v.pathname}}return m=R(window.location.href),function(T){var M=I.isString(T)?R(T):T;return M.protocol===m.protocol&&M.host===m.host}}():function(){return function(){return!0}}()},6016:(l,P,x)=>{"use strict";var I=x(4867);l.exports=function(k,v){I.forEach(k,function(R,E){E!==v&&E.toUpperCase()===v.toUpperCase()&&(k[v]=R,delete k[E])})}},4109:(l,P,x)=>{"use strict";var I=x(4867),N=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];l.exports=function(v){var m={},R,E,T;return v&&I.forEach(v.split(`
`),function(A){if(T=A.indexOf(":"),R=I.trim(A.substr(0,T)).toLowerCase(),E=I.trim(A.substr(T+1)),R){if(m[R]&&N.indexOf(R)>=0)return;R==="set-cookie"?m[R]=(m[R]?m[R]:[]).concat([E]):m[R]=m[R]?m[R]+", "+E:E}}),m}},8713:l=>{"use strict";l.exports=function(x){return function(N){return x.apply(null,N)}}},4867:(l,P,x)=>{"use strict";var I=x(1849),N=Object.prototype.toString;function k(y){return N.call(y)==="[object Array]"}function v(y){return typeof y=="undefined"}function m(y){return y!==null&&!v(y)&&y.constructor!==null&&!v(y.constructor)&&typeof y.constructor.isBuffer=="function"&&y.constructor.isBuffer(y)}function R(y){return N.call(y)==="[object ArrayBuffer]"}function E(y){return typeof FormData!="undefined"&&y instanceof FormData}function T(y){var $;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?$=ArrayBuffer.isView(y):$=y&&y.buffer&&y.buffer instanceof ArrayBuffer,$}function M(y){return typeof y=="string"}function A(y){return typeof y=="number"}function j(y){return y!==null&&typeof y=="object"}function re(y){if(N.call(y)!=="[object Object]")return!1;var $=Object.getPrototypeOf(y);return $===null||$===Object.prototype}function ee(y){return N.call(y)==="[object Date]"}function V(y){return N.call(y)==="[object File]"}function te(y){return N.call(y)==="[object Blob]"}function ae(y){return N.call(y)==="[object Function]"}function oe(y){return j(y)&&ae(y.pipe)}function le(y){return typeof URLSearchParams!="undefined"&&y instanceof URLSearchParams}function L(y){return y.replace(/^\s*/,"").replace(/\s*$/,"")}function K(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function G(y,$){if(!(y===null||typeof y=="undefined"))if(typeof y!="object"&&(y=[y]),k(y))for(var W=0,B=y.length;W<B;W++)$.call(null,y[W],W,y);else for(var S in y)Object.prototype.hasOwnProperty.call(y,S)&&$.call(null,y[S],S,y)}function ne(){var y={};function $(S,O){re(y[O])&&re(S)?y[O]=ne(y[O],S):re(S)?y[O]=ne({},S):k(S)?y[O]=S.slice():y[O]=S}for(var W=0,B=arguments.length;W<B;W++)G(arguments[W],$);return y}function ce(y,$,W){return G($,function(S,O){W&&typeof S=="function"?y[O]=I(S,W):y[O]=S}),y}function ve(y){return y.charCodeAt(0)===65279&&(y=y.slice(1)),y}l.exports={isArray:k,isArrayBuffer:R,isBuffer:m,isFormData:E,isArrayBufferView:T,isString:M,isNumber:A,isObject:j,isPlainObject:re,isUndefined:v,isDate:ee,isFile:V,isBlob:te,isFunction:ae,isStream:oe,isURLSearchParams:le,isStandardBrowserEnv:K,forEach:G,merge:ne,extend:ce,trim:L,stripBOM:ve}},5623:l=>{"use strict";l.exports=P;function P(N,k,v){N instanceof RegExp&&(N=x(N,v)),k instanceof RegExp&&(k=x(k,v));var m=I(N,k,v);return m&&{start:m[0],end:m[1],pre:v.slice(0,m[0]),body:v.slice(m[0]+N.length,m[1]),post:v.slice(m[1]+k.length)}}function x(N,k){var v=k.match(N);return v?v[0]:null}P.range=I;function I(N,k,v){var m,R,E,T,M,A=v.indexOf(N),j=v.indexOf(k,A+1),re=A;if(A>=0&&j>0){if(N===k)return[A,j];for(m=[],E=v.length;re>=0&&!M;)re==A?(m.push(re),A=v.indexOf(N,re+1)):m.length==1?M=[m.pop(),j]:(R=m.pop(),R<E&&(E=R,T=j),j=v.indexOf(k,re+1)),re=A<j&&A>=0?A:j;m.length&&(M=[E,T])}return M}},5186:(l,P,x)=>{var I=x(3698),N=x(2505),k=x(6417),v=Function.bind,m=v.bind(v);function R(j,re,ee){var V=m(k,null).apply(null,ee?[re,ee]:[re]);j.api={remove:V},j.remove=V,["before","error","after","wrap"].forEach(function(te){var ae=ee?[re,te,ee]:[re,te];j[te]=j.api[te]=m(N,null).apply(null,ae)})}function E(){var j="h",re={registry:{}},ee=I.bind(null,re,j);return R(ee,re,j),ee}function T(){var j={registry:{}},re=I.bind(null,j);return R(re,j),re}var M=!1;function A(){return M||(console.warn('[before-after-hook]: "Hook()" repurposing warning, use "Hook.Collection()". Read more: https://git.io/upgrade-before-after-hook-to-1.4'),M=!0),T()}A.Singular=E.bind(),A.Collection=T.bind(),l.exports=A,l.exports.Hook=A,l.exports.Singular=A.Singular,l.exports.Collection=A.Collection},2505:l=>{l.exports=P;function P(x,I,N,k){var v=k;x.registry[N]||(x.registry[N]=[]),I==="before"&&(k=function(m,R){return Promise.resolve().then(v.bind(null,R)).then(m.bind(null,R))}),I==="after"&&(k=function(m,R){var E;return Promise.resolve().then(m.bind(null,R)).then(function(T){return E=T,v(E,R)}).then(function(){return E})}),I==="error"&&(k=function(m,R){return Promise.resolve().then(m.bind(null,R)).catch(function(E){return v(E,R)})}),x.registry[N].push({hook:k,orig:v})}},3698:l=>{l.exports=P;function P(x,I,N,k){if(typeof N!="function")throw new Error("method for before hook must be a function");return k||(k={}),Array.isArray(I)?I.reverse().reduce(function(v,m){return P.bind(null,x,m,v,k)},N)():Promise.resolve().then(function(){return x.registry[I]?x.registry[I].reduce(function(v,m){return m.hook.bind(null,v,k)},N)():N(k)})}},6417:l=>{l.exports=P;function P(x,I,N){if(!!x.registry[I]){var k=x.registry[I].map(function(v){return v.orig}).indexOf(N);k!==-1&&x.registry[I].splice(k,1)}}},3644:(l,P,x)=>{var I=x(1048),N=x(5623);l.exports=re;var k="\0SLASH"+Math.random()+"\0",v="\0OPEN"+Math.random()+"\0",m="\0CLOSE"+Math.random()+"\0",R="\0COMMA"+Math.random()+"\0",E="\0PERIOD"+Math.random()+"\0";function T(L){return parseInt(L,10)==L?parseInt(L,10):L.charCodeAt(0)}function M(L){return L.split("\\\\").join(k).split("\\{").join(v).split("\\}").join(m).split("\\,").join(R).split("\\.").join(E)}function A(L){return L.split(k).join("\\").split(v).join("{").split(m).join("}").split(R).join(",").split(E).join(".")}function j(L){if(!L)return[""];var K=[],G=N("{","}",L);if(!G)return L.split(",");var ne=G.pre,ce=G.body,ve=G.post,y=ne.split(",");y[y.length-1]+="{"+ce+"}";var $=j(ve);return ve.length&&(y[y.length-1]+=$.shift(),y.push.apply(y,$)),K.push.apply(K,y),K}function re(L){return L?(L.substr(0,2)==="{}"&&(L="\\{\\}"+L.substr(2)),le(M(L),!0).map(A)):[]}function ee(L){return L}function V(L){return"{"+L+"}"}function te(L){return/^-?0\d/.test(L)}function ae(L,K){return L<=K}function oe(L,K){return L>=K}function le(L,K){var G=[],ne=N("{","}",L);if(!ne||/\$$/.test(ne.pre))return[L];var ce=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(ne.body),ve=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(ne.body),y=ce||ve,$=ne.body.indexOf(",")>=0;if(!y&&!$)return ne.post.match(/,.*\}/)?(L=ne.pre+"{"+ne.body+m+ne.post,le(L)):[L];var W;if(y)W=ne.body.split(/\.\./);else if(W=j(ne.body),W.length===1&&(W=le(W[0],!1).map(V),W.length===1)){var S=ne.post.length?le(ne.post,!1):[""];return S.map(function(Ne){return ne.pre+W[0]+Ne})}var B=ne.pre,S=ne.post.length?le(ne.post,!1):[""],O;if(y){var J=T(W[0]),me=T(W[1]),ie=Math.max(W[0].length,W[1].length),se=W.length==3?Math.abs(T(W[2])):1,ye=ae,_e=me<J;_e&&(se*=-1,ye=oe);var Ie=W.some(te);O=[];for(var ge=J;ye(ge,me);ge+=se){var ke;if(ve)ke=String.fromCharCode(ge),ke==="\\"&&(ke="");else if(ke=String(ge),Ie){var be=ie-ke.length;if(be>0){var $e=new Array(be+1).join("0");ge<0?ke="-"+$e+ke.slice(1):ke=$e+ke}}O.push(ke)}}else O=I(W,function(rt){return le(rt,!1)});for(var Pe=0;Pe<O.length;Pe++)for(var Ue=0;Ue<S.length;Ue++){var Oe=B+O[Pe]+S[Ue];(!K||y||Oe)&&G.push(Oe)}return G}},1048:l=>{l.exports=function(x,I){for(var N=[],k=0;k<x.length;k++){var v=I(x[k],k);P(v)?N.push.apply(N,v):N.push(v)}return N};var P=Array.isArray||function(x){return Object.prototype.toString.call(x)==="[object Array]"}},4098:function(l,P){var x=typeof self!="undefined"?self:this,I=function(){function k(){this.fetch=!1,this.DOMException=x.DOMException}return k.prototype=x,new k}();(function(k){var v=function(m){var R={searchParams:"URLSearchParams"in k,iterable:"Symbol"in k&&"iterator"in Symbol,blob:"FileReader"in k&&"Blob"in k&&function(){try{return new Blob,!0}catch(S){return!1}}(),formData:"FormData"in k,arrayBuffer:"ArrayBuffer"in k};function E(S){return S&&DataView.prototype.isPrototypeOf(S)}if(R.arrayBuffer)var T=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],M=ArrayBuffer.isView||function(S){return S&&T.indexOf(Object.prototype.toString.call(S))>-1};function A(S){if(typeof S!="string"&&(S=String(S)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(S))throw new TypeError("Invalid character in header field name");return S.toLowerCase()}function j(S){return typeof S!="string"&&(S=String(S)),S}function re(S){var O={next:function(){var J=S.shift();return{done:J===void 0,value:J}}};return R.iterable&&(O[Symbol.iterator]=function(){return O}),O}function ee(S){this.map={},S instanceof ee?S.forEach(function(O,J){this.append(J,O)},this):Array.isArray(S)?S.forEach(function(O){this.append(O[0],O[1])},this):S&&Object.getOwnPropertyNames(S).forEach(function(O){this.append(O,S[O])},this)}ee.prototype.append=function(S,O){S=A(S),O=j(O);var J=this.map[S];this.map[S]=J?J+", "+O:O},ee.prototype.delete=function(S){delete this.map[A(S)]},ee.prototype.get=function(S){return S=A(S),this.has(S)?this.map[S]:null},ee.prototype.has=function(S){return this.map.hasOwnProperty(A(S))},ee.prototype.set=function(S,O){this.map[A(S)]=j(O)},ee.prototype.forEach=function(S,O){for(var J in this.map)this.map.hasOwnProperty(J)&&S.call(O,this.map[J],J,this)},ee.prototype.keys=function(){var S=[];return this.forEach(function(O,J){S.push(J)}),re(S)},ee.prototype.values=function(){var S=[];return this.forEach(function(O){S.push(O)}),re(S)},ee.prototype.entries=function(){var S=[];return this.forEach(function(O,J){S.push([J,O])}),re(S)},R.iterable&&(ee.prototype[Symbol.iterator]=ee.prototype.entries);function V(S){if(S.bodyUsed)return Promise.reject(new TypeError("Already read"));S.bodyUsed=!0}function te(S){return new Promise(function(O,J){S.onload=function(){O(S.result)},S.onerror=function(){J(S.error)}})}function ae(S){var O=new FileReader,J=te(O);return O.readAsArrayBuffer(S),J}function oe(S){var O=new FileReader,J=te(O);return O.readAsText(S),J}function le(S){for(var O=new Uint8Array(S),J=new Array(O.length),me=0;me<O.length;me++)J[me]=String.fromCharCode(O[me]);return J.join("")}function L(S){if(S.slice)return S.slice(0);var O=new Uint8Array(S.byteLength);return O.set(new Uint8Array(S)),O.buffer}function K(){return this.bodyUsed=!1,this._initBody=function(S){this._bodyInit=S,S?typeof S=="string"?this._bodyText=S:R.blob&&Blob.prototype.isPrototypeOf(S)?this._bodyBlob=S:R.formData&&FormData.prototype.isPrototypeOf(S)?this._bodyFormData=S:R.searchParams&&URLSearchParams.prototype.isPrototypeOf(S)?this._bodyText=S.toString():R.arrayBuffer&&R.blob&&E(S)?(this._bodyArrayBuffer=L(S.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):R.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(S)||M(S))?this._bodyArrayBuffer=L(S):this._bodyText=S=Object.prototype.toString.call(S):this._bodyText="",this.headers.get("content-type")||(typeof S=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):R.searchParams&&URLSearchParams.prototype.isPrototypeOf(S)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},R.blob&&(this.blob=function(){var S=V(this);if(S)return S;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?V(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(ae)}),this.text=function(){var S=V(this);if(S)return S;if(this._bodyBlob)return oe(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(le(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},R.formData&&(this.formData=function(){return this.text().then(ve)}),this.json=function(){return this.text().then(JSON.parse)},this}var G=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function ne(S){var O=S.toUpperCase();return G.indexOf(O)>-1?O:S}function ce(S,O){O=O||{};var J=O.body;if(S instanceof ce){if(S.bodyUsed)throw new TypeError("Already read");this.url=S.url,this.credentials=S.credentials,O.headers||(this.headers=new ee(S.headers)),this.method=S.method,this.mode=S.mode,this.signal=S.signal,!J&&S._bodyInit!=null&&(J=S._bodyInit,S.bodyUsed=!0)}else this.url=String(S);if(this.credentials=O.credentials||this.credentials||"same-origin",(O.headers||!this.headers)&&(this.headers=new ee(O.headers)),this.method=ne(O.method||this.method||"GET"),this.mode=O.mode||this.mode||null,this.signal=O.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&J)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(J)}ce.prototype.clone=function(){return new ce(this,{body:this._bodyInit})};function ve(S){var O=new FormData;return S.trim().split("&").forEach(function(J){if(J){var me=J.split("="),ie=me.shift().replace(/\+/g," "),se=me.join("=").replace(/\+/g," ");O.append(decodeURIComponent(ie),decodeURIComponent(se))}}),O}function y(S){var O=new ee,J=S.replace(/\r?\n[\t ]+/g," ");return J.split(/\r?\n/).forEach(function(me){var ie=me.split(":"),se=ie.shift().trim();if(se){var ye=ie.join(":").trim();O.append(se,ye)}}),O}K.call(ce.prototype);function $(S,O){O||(O={}),this.type="default",this.status=O.status===void 0?200:O.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in O?O.statusText:"OK",this.headers=new ee(O.headers),this.url=O.url||"",this._initBody(S)}K.call($.prototype),$.prototype.clone=function(){return new $(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new ee(this.headers),url:this.url})},$.error=function(){var S=new $(null,{status:0,statusText:""});return S.type="error",S};var W=[301,302,303,307,308];$.redirect=function(S,O){if(W.indexOf(O)===-1)throw new RangeError("Invalid status code");return new $(null,{status:O,headers:{location:S}})},m.DOMException=k.DOMException;try{new m.DOMException}catch(S){m.DOMException=function(O,J){this.message=O,this.name=J;var me=Error(O);this.stack=me.stack},m.DOMException.prototype=Object.create(Error.prototype),m.DOMException.prototype.constructor=m.DOMException}function B(S,O){return new Promise(function(J,me){var ie=new ce(S,O);if(ie.signal&&ie.signal.aborted)return me(new m.DOMException("Aborted","AbortError"));var se=new XMLHttpRequest;function ye(){se.abort()}se.onload=function(){var _e={status:se.status,statusText:se.statusText,headers:y(se.getAllResponseHeaders()||"")};_e.url="responseURL"in se?se.responseURL:_e.headers.get("X-Request-URL");var Ie="response"in se?se.response:se.responseText;J(new $(Ie,_e))},se.onerror=function(){me(new TypeError("Network request failed"))},se.ontimeout=function(){me(new TypeError("Network request failed"))},se.onabort=function(){me(new m.DOMException("Aborted","AbortError"))},se.open(ie.method,ie.url,!0),ie.credentials==="include"?se.withCredentials=!0:ie.credentials==="omit"&&(se.withCredentials=!1),"responseType"in se&&R.blob&&(se.responseType="blob"),ie.headers.forEach(function(_e,Ie){se.setRequestHeader(Ie,_e)}),ie.signal&&(ie.signal.addEventListener("abort",ye),se.onreadystatechange=function(){se.readyState===4&&ie.signal.removeEventListener("abort",ye)}),se.send(typeof ie._bodyInit=="undefined"?null:ie._bodyInit)})}return B.polyfill=!0,k.fetch||(k.fetch=B,k.Headers=ee,k.Request=ce,k.Response=$),m.Headers=ee,m.Request=ce,m.Response=$,m.fetch=B,Object.defineProperty(m,"__esModule",{value:!0}),m}({})})(I),I.fetch.ponyfill=!0,delete I.fetch.polyfill;var N=I;P=N.fetch,P.default=N.fetch,P.fetch=N.fetch,P.Headers=N.Headers,P.Request=N.Request,P.Response=N.Response,l.exports=P},7360:function(l,P){var x,I,N;(function(k,v){I=[],x=v,N=typeof x=="function"?x.apply(P,I):x,N!==void 0&&(l.exports=N)})(this,function(){function v(oe){var le={single:function(L,K,G){if(!L||(V(L)||(L=le.getPreparedSearch(L)),!K))return null;V(K)||(K=le.getPrepared(K));var ne=G&&G.allowTypo!==void 0?G.allowTypo:oe&&oe.allowTypo!==void 0?oe.allowTypo:!0,ce=ne?le.algorithm:le.algorithmNoTypo;return ce(L,K,L[0])},go:function(L,K,G){if(!L)return T;L=le.prepareSearch(L);var ne=L[0],ce=G&&G.threshold||oe&&oe.threshold||-9007199254740991,ve=G&&G.limit||oe&&oe.limit||9007199254740991,y=G&&G.allowTypo!==void 0?G.allowTypo:oe&&oe.allowTypo!==void 0?oe.allowTypo:!0,$=y?le.algorithm:le.algorithmNoTypo,W=0,B=0,S=K.length;if(G&&G.keys)for(var O=G.scoreFn||re,J=G.keys,me=J.length,ie=S-1;ie>=0;--ie){for(var se=K[ie],ye=new Array(me),_e=me-1;_e>=0;--_e){var Ie=J[_e],ge=ee(se,Ie);if(!ge){ye[_e]=null;continue}V(ge)||(ge=le.getPrepared(ge)),ye[_e]=$(L,ge,ne)}ye.obj=se;var ke=O(ye);ke!==null&&(ke<ce||(ye.score=ke,W<ve?(ae.add(ye),++W):(++B,ke>ae.peek().score&&ae.replaceTop(ye))))}else if(G&&G.key)for(var Ie=G.key,ie=S-1;ie>=0;--ie){var se=K[ie],ge=ee(se,Ie);if(!!ge){V(ge)||(ge=le.getPrepared(ge));var be=$(L,ge,ne);be!==null&&(be.score<ce||(be={target:be.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:be.score,indexes:be.indexes,obj:se},W<ve?(ae.add(be),++W):(++B,be.score>ae.peek().score&&ae.replaceTop(be))))}}else for(var ie=S-1;ie>=0;--ie){var ge=K[ie];if(!!ge){V(ge)||(ge=le.getPrepared(ge));var be=$(L,ge,ne);be!==null&&(be.score<ce||(W<ve?(ae.add(be),++W):(++B,be.score>ae.peek().score&&ae.replaceTop(be))))}}if(W===0)return T;for(var $e=new Array(W),ie=W-1;ie>=0;--ie)$e[ie]=ae.poll();return $e.total=W+B,$e},goAsync:function(L,K,G){var ne=!1,ce=new Promise(function(ve,y){if(!L)return ve(T);L=le.prepareSearch(L);var $=L[0],W=te(),B=K.length-1,S=G&&G.threshold||oe&&oe.threshold||-9007199254740991,O=G&&G.limit||oe&&oe.limit||9007199254740991,J=G&&G.allowTypo!==void 0?G.allowTypo:oe&&oe.allowTypo!==void 0?oe.allowTypo:!0,me=J?le.algorithm:le.algorithmNoTypo,ie=0,se=0;function ye(){if(ne)return y("canceled");var _e=Date.now();if(G&&G.keys)for(var Ie=G.scoreFn||re,ge=G.keys,ke=ge.length;B>=0;--B){for(var be=K[B],$e=new Array(ke),Pe=ke-1;Pe>=0;--Pe){var Ue=ge[Pe],Oe=ee(be,Ue);if(!Oe){$e[Pe]=null;continue}V(Oe)||(Oe=le.getPrepared(Oe)),$e[Pe]=me(L,Oe,$)}$e.obj=be;var rt=Ie($e);if(rt!==null&&!(rt<S)&&($e.score=rt,ie<O?(W.add($e),++ie):(++se,rt>W.peek().score&&W.replaceTop($e)),B%1e3==0&&Date.now()-_e>=10)){m?setImmediate(ye):setTimeout(ye);return}}else if(G&&G.key)for(var Ue=G.key;B>=0;--B){var be=K[B],Oe=ee(be,Ue);if(!!Oe){V(Oe)||(Oe=le.getPrepared(Oe));var Ne=me(L,Oe,$);if(Ne!==null&&!(Ne.score<S)&&(Ne={target:Ne.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:Ne.score,indexes:Ne.indexes,obj:be},ie<O?(W.add(Ne),++ie):(++se,Ne.score>W.peek().score&&W.replaceTop(Ne)),B%1e3==0&&Date.now()-_e>=10)){m?setImmediate(ye):setTimeout(ye);return}}}else for(;B>=0;--B){var Oe=K[B];if(!!Oe){V(Oe)||(Oe=le.getPrepared(Oe));var Ne=me(L,Oe,$);if(Ne!==null&&!(Ne.score<S)&&(ie<O?(W.add(Ne),++ie):(++se,Ne.score>W.peek().score&&W.replaceTop(Ne)),B%1e3==0&&Date.now()-_e>=10)){m?setImmediate(ye):setTimeout(ye);return}}}if(ie===0)return ve(T);for(var mt=new Array(ie),Zt=ie-1;Zt>=0;--Zt)mt[Zt]=W.poll();mt.total=ie+se,ve(mt)}m?setImmediate(ye):ye()});return ce.cancel=function(){ne=!0},ce},highlight:function(L,K,G){if(L===null)return null;K===void 0&&(K="<b>"),G===void 0&&(G="</b>");for(var ne="",ce=0,ve=!1,y=L.target,$=y.length,W=L.indexes,B=0;B<$;++B){var S=y[B];if(W[ce]===B){if(++ce,ve||(ve=!0,ne+=K),ce===W.length){ne+=S+G+y.substr(B+1);break}}else ve&&(ve=!1,ne+=G);ne+=S}return ne},prepare:function(L){if(!!L)return{target:L,_targetLowerCodes:le.prepareLowerCodes(L),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareSlow:function(L){if(!!L)return{target:L,_targetLowerCodes:le.prepareLowerCodes(L),_nextBeginningIndexes:le.prepareNextBeginningIndexes(L),score:null,indexes:null,obj:null}},prepareSearch:function(L){if(!!L)return le.prepareLowerCodes(L)},getPrepared:function(L){if(L.length>999)return le.prepare(L);var K=R.get(L);return K!==void 0||(K=le.prepare(L),R.set(L,K)),K},getPreparedSearch:function(L){if(L.length>999)return le.prepareSearch(L);var K=E.get(L);return K!==void 0||(K=le.prepareSearch(L),E.set(L,K)),K},algorithm:function(L,K,G){for(var ne=K._targetLowerCodes,ce=L.length,ve=ne.length,y=0,$=0,W=0,B=0;;){var S=G===ne[$];if(S){if(M[B++]=$,++y,y===ce)break;G=L[W===0?y:W===y?y+1:W===y-1?y-1:y]}if(++$,$>=ve)for(;;){if(y<=1)return null;if(W===0){--y;var O=L[y];if(G===O)continue;W=y}else{if(W===1)return null;--W,y=W,G=L[y+1];var O=L[y];if(G===O)continue}B=y,$=M[B-1]+1;break}}var y=0,J=0,me=!1,ie=0,se=K._nextBeginningIndexes;se===null&&(se=K._nextBeginningIndexes=le.prepareNextBeginningIndexes(K.target));var ye=$=M[0]===0?0:se[M[0]-1];if($!==ve)for(;;)if($>=ve){if(y<=0){if(++J,J>ce-2)break;if(L[J]===L[J+1])continue;$=ye;continue}--y;var _e=A[--ie];$=se[_e]}else{var S=L[J===0?y:J===y?y+1:J===y-1?y-1:y]===ne[$];if(S){if(A[ie++]=$,++y,y===ce){me=!0;break}++$}else $=se[$]}{if(me)var Ie=A,ge=ie;else var Ie=M,ge=B;for(var ke=0,be=-1,$e=0;$e<ce;++$e){var $=Ie[$e];be!==$-1&&(ke-=$),be=$}me?J!==0&&(ke+=-20):(ke*=1e3,W!==0&&(ke+=-20)),ke-=ve-ce,K.score=ke,K.indexes=new Array(ge);for(var $e=ge-1;$e>=0;--$e)K.indexes[$e]=Ie[$e];return K}},algorithmNoTypo:function(L,K,G){for(var ne=K._targetLowerCodes,ce=L.length,ve=ne.length,y=0,$=0,W=0;;){var B=G===ne[$];if(B){if(M[W++]=$,++y,y===ce)break;G=L[y]}if(++$,$>=ve)return null}var y=0,S=!1,O=0,J=K._nextBeginningIndexes;J===null&&(J=K._nextBeginningIndexes=le.prepareNextBeginningIndexes(K.target));var me=$=M[0]===0?0:J[M[0]-1];if($!==ve)for(;;)if($>=ve){if(y<=0)break;--y;var ie=A[--O];$=J[ie]}else{var B=L[y]===ne[$];if(B){if(A[O++]=$,++y,y===ce){S=!0;break}++$}else $=J[$]}{if(S)var se=A,ye=O;else var se=M,ye=W;for(var _e=0,Ie=-1,ge=0;ge<ce;++ge){var $=se[ge];Ie!==$-1&&(_e-=$),Ie=$}S||(_e*=1e3),_e-=ve-ce,K.score=_e,K.indexes=new Array(ye);for(var ge=ye-1;ge>=0;--ge)K.indexes[ge]=se[ge];return K}},prepareLowerCodes:function(L){for(var K=L.length,G=[],ne=L.toLowerCase(),ce=0;ce<K;++ce)G[ce]=ne.charCodeAt(ce);return G},prepareBeginningIndexes:function(L){for(var K=L.length,G=[],ne=0,ce=!1,ve=!1,y=0;y<K;++y){var $=L.charCodeAt(y),W=$>=65&&$<=90,B=W||$>=97&&$<=122||$>=48&&$<=57,S=W&&!ce||!ve||!B;ce=W,ve=B,S&&(G[ne++]=y)}return G},prepareNextBeginningIndexes:function(L){for(var K=L.length,G=le.prepareBeginningIndexes(L),ne=[],ce=G[0],ve=0,y=0;y<K;++y)ce>y?ne[y]=ce:(ce=G[++ve],ne[y]=ce===void 0?K:ce);return ne},cleanup:j,new:v};return le}var m=typeof window=="undefined",R=new Map,E=new Map,T=[];T.total=0;var M=[],A=[];function j(){R.clear(),E.clear(),M=[],A=[]}function re(oe){for(var le=-9007199254740991,L=oe.length-1;L>=0;--L){var K=oe[L];if(K!==null){var G=K.score;G>le&&(le=G)}}return le===-9007199254740991?null:le}function ee(oe,le){var L=oe[le];if(L!==void 0)return L;var K=le;Array.isArray(le)||(K=le.split("."));for(var G=K.length,ne=-1;oe&&++ne<G;)oe=oe[K[ne]];return oe}function V(oe){return typeof oe=="object"}var te=function(){var oe=[],le=0,L={};function K(){for(var G=0,ne=oe[G],ce=1;ce<le;){var ve=ce+1;G=ce,ve<le&&oe[ve].score<oe[ce].score&&(G=ve),oe[G-1>>1]=oe[G],ce=1+(G<<1)}for(var y=G-1>>1;G>0&&ne.score<oe[y].score;y=(G=y)-1>>1)oe[G]=oe[y];oe[G]=ne}return L.add=function(G){var ne=le;oe[le++]=G;for(var ce=ne-1>>1;ne>0&&G.score<oe[ce].score;ce=(ne=ce)-1>>1)oe[ne]=oe[ce];oe[ne]=G},L.poll=function(){if(le!==0){var G=oe[0];return oe[0]=oe[--le],K(),G}},L.peek=function(G){if(le!==0)return oe[0]},L.replaceTop=function(G){oe[0]=G,K()},L},ae=te();return v()})},1171:(l,P,x)=>{l.exports=V,V.Minimatch=te;var I={sep:"/"};try{I=x(6470)}catch(y){}var N=V.GLOBSTAR=te.GLOBSTAR={},k=x(3644),v={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},m="[^/]",R=m+"*?",E="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",T="(?:(?!(?:\\/|^)\\.).)*?",M=A("().*{}+?[]^$\\!");function A(y){return y.split("").reduce(function($,W){return $[W]=!0,$},{})}var j=/\/+/;V.filter=re;function re(y,$){return $=$||{},function(W,B,S){return V(W,y,$)}}function ee(y,$){y=y||{},$=$||{};var W={};return Object.keys($).forEach(function(B){W[B]=$[B]}),Object.keys(y).forEach(function(B){W[B]=y[B]}),W}V.defaults=function(y){if(!y||!Object.keys(y).length)return V;var $=V,W=function(S,O,J){return $.minimatch(S,O,ee(y,J))};return W.Minimatch=function(S,O){return new $.Minimatch(S,ee(y,O))},W},te.defaults=function(y){return!y||!Object.keys(y).length?te:V.defaults(y).Minimatch};function V(y,$,W){if(typeof $!="string")throw new TypeError("glob pattern string required");return W||(W={}),!W.nocomment&&$.charAt(0)==="#"?!1:$.trim()===""?y==="":new te($,W).match(y)}function te(y,$){if(!(this instanceof te))return new te(y,$);if(typeof y!="string")throw new TypeError("glob pattern string required");$||($={}),y=y.trim(),I.sep!=="/"&&(y=y.split(I.sep).join("/")),this.options=$,this.set=[],this.pattern=y,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}te.prototype.debug=function(){},te.prototype.make=ae;function ae(){if(!this._made){var y=this.pattern,$=this.options;if(!$.nocomment&&y.charAt(0)==="#"){this.comment=!0;return}if(!y){this.empty=!0;return}this.parseNegate();var W=this.globSet=this.braceExpand();$.debug&&(this.debug=console.error),this.debug(this.pattern,W),W=this.globParts=W.map(function(B){return B.split(j)}),this.debug(this.pattern,W),W=W.map(function(B,S,O){return B.map(this.parse,this)},this),this.debug(this.pattern,W),W=W.filter(function(B){return B.indexOf(!1)===-1}),this.debug(this.pattern,W),this.set=W}}te.prototype.parseNegate=oe;function oe(){var y=this.pattern,$=!1,W=this.options,B=0;if(!W.nonegate){for(var S=0,O=y.length;S<O&&y.charAt(S)==="!";S++)$=!$,B++;B&&(this.pattern=y.substr(B)),this.negate=$}}V.braceExpand=function(y,$){return le(y,$)},te.prototype.braceExpand=le;function le(y,$){if($||(this instanceof te?$=this.options:$={}),y=typeof y=="undefined"?this.pattern:y,typeof y=="undefined")throw new TypeError("undefined pattern");return $.nobrace||!y.match(/\{.*\}/)?[y]:k(y)}te.prototype.parse=K;var L={};function K(y,$){if(y.length>1024*64)throw new TypeError("pattern is too long");var W=this.options;if(!W.noglobstar&&y==="**")return N;if(y==="")return"";var B="",S=!!W.nocase,O=!1,J=[],me=[],ie,se=!1,ye=-1,_e=-1,Ie=y.charAt(0)==="."?"":W.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",ge=this;function ke(){if(ie){switch(ie){case"*":B+=R,S=!0;break;case"?":B+=m,S=!0;break;default:B+="\\"+ie;break}ge.debug("clearStateChar %j %j",ie,B),ie=!1}}for(var be=0,$e=y.length,Pe;be<$e&&(Pe=y.charAt(be));be++){if(this.debug("%s	%s %s %j",y,be,B,Pe),O&&M[Pe]){B+="\\"+Pe,O=!1;continue}switch(Pe){case"/":return!1;case"\\":ke(),O=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",y,be,B,Pe),se){this.debug("  in class"),Pe==="!"&&be===_e+1&&(Pe="^"),B+=Pe;continue}ge.debug("call clearStateChar %j",ie),ke(),ie=Pe,W.noext&&ke();continue;case"(":if(se){B+="(";continue}if(!ie){B+="\\(";continue}J.push({type:ie,start:be-1,reStart:B.length,open:v[ie].open,close:v[ie].close}),B+=ie==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",ie,B),ie=!1;continue;case")":if(se||!J.length){B+="\\)";continue}ke(),S=!0;var Ue=J.pop();B+=Ue.close,Ue.type==="!"&&me.push(Ue),Ue.reEnd=B.length;continue;case"|":if(se||!J.length||O){B+="\\|",O=!1;continue}ke(),B+="|";continue;case"[":if(ke(),se){B+="\\"+Pe;continue}se=!0,_e=be,ye=B.length,B+=Pe;continue;case"]":if(be===_e+1||!se){B+="\\"+Pe,O=!1;continue}if(se){var Oe=y.substring(_e+1,be);try{RegExp("["+Oe+"]")}catch(ni){var rt=this.parse(Oe,L);B=B.substr(0,ye)+"\\["+rt[0]+"\\]",S=S||rt[1],se=!1;continue}}S=!0,se=!1,B+=Pe;continue;default:ke(),O?O=!1:M[Pe]&&!(Pe==="^"&&se)&&(B+="\\"),B+=Pe}}for(se&&(Oe=y.substr(_e+1),rt=this.parse(Oe,L),B=B.substr(0,ye)+"\\["+rt[0],S=S||rt[1]),Ue=J.pop();Ue;Ue=J.pop()){var Ne=B.slice(Ue.reStart+Ue.open.length);this.debug("setting tail",B,Ue),Ne=Ne.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(ni,ii,ln){return ln||(ln="\\"),ii+ii+ln+"|"}),this.debug(`tail=%j
   %s`,Ne,Ne,Ue,B);var mt=Ue.type==="*"?R:Ue.type==="?"?m:"\\"+Ue.type;S=!0,B=B.slice(0,Ue.reStart)+mt+"\\("+Ne}ke(),O&&(B+="\\\\");var Zt=!1;switch(B.charAt(0)){case".":case"[":case"(":Zt=!0}for(var xr=me.length-1;xr>-1;xr--){var Kt=me[xr],Yn=B.slice(0,Kt.reStart),ao=B.slice(Kt.reStart,Kt.reEnd-8),ei=B.slice(Kt.reEnd-8,Kt.reEnd),ar=B.slice(Kt.reEnd);ei+=ar;var ti=Yn.split("(").length-1,sn=ar;for(be=0;be<ti;be++)sn=sn.replace(/\)[+*?]?/,"");ar=sn;var kr="";ar===""&&$!==L&&(kr="$");var ri=Yn+ao+ar+kr+ei;B=ri}if(B!==""&&S&&(B="(?=.)"+B),Zt&&(B=Ie+B),$===L)return[B,S];if(!S)return ce(y);var so=W.nocase?"i":"";try{var cn=new RegExp("^"+B+"$",so)}catch(ni){return new RegExp("$.")}return cn._glob=y,cn._src=B,cn}V.makeRe=function(y,$){return new te(y,$||{}).makeRe()},te.prototype.makeRe=G;function G(){if(this.regexp||this.regexp===!1)return this.regexp;var y=this.set;if(!y.length)return this.regexp=!1,this.regexp;var $=this.options,W=$.noglobstar?R:$.dot?E:T,B=$.nocase?"i":"",S=y.map(function(O){return O.map(function(J){return J===N?W:typeof J=="string"?ve(J):J._src}).join("\\/")}).join("|");S="^(?:"+S+")$",this.negate&&(S="^(?!"+S+").*$");try{this.regexp=new RegExp(S,B)}catch(O){this.regexp=!1}return this.regexp}V.match=function(y,$,W){W=W||{};var B=new te($,W);return y=y.filter(function(S){return B.match(S)}),B.options.nonull&&!y.length&&y.push($),y},te.prototype.match=ne;function ne(y,$){if(this.debug("match",y,this.pattern),this.comment)return!1;if(this.empty)return y==="";if(y==="/"&&$)return!0;var W=this.options;I.sep!=="/"&&(y=y.split(I.sep).join("/")),y=y.split(j),this.debug(this.pattern,"split",y);var B=this.set;this.debug(this.pattern,"set",B);var S,O;for(O=y.length-1;O>=0&&(S=y[O],!S);O--);for(O=0;O<B.length;O++){var J=B[O],me=y;W.matchBase&&J.length===1&&(me=[S]);var ie=this.matchOne(me,J,$);if(ie)return W.flipNegate?!0:!this.negate}return W.flipNegate?!1:this.negate}te.prototype.matchOne=function(y,$,W){var B=this.options;this.debug("matchOne",{this:this,file:y,pattern:$}),this.debug("matchOne",y.length,$.length);for(var S=0,O=0,J=y.length,me=$.length;S<J&&O<me;S++,O++){this.debug("matchOne loop");var ie=$[O],se=y[S];if(this.debug($,ie,se),ie===!1)return!1;if(ie===N){this.debug("GLOBSTAR",[$,ie,se]);var ye=S,_e=O+1;if(_e===me){for(this.debug("** at the end");S<J;S++)if(y[S]==="."||y[S]===".."||!B.dot&&y[S].charAt(0)===".")return!1;return!0}for(;ye<J;){var Ie=y[ye];if(this.debug(`
globstar while`,y,ye,$,_e,Ie),this.matchOne(y.slice(ye),$.slice(_e),W))return this.debug("globstar found match!",ye,J,Ie),!0;if(Ie==="."||Ie===".."||!B.dot&&Ie.charAt(0)==="."){this.debug("dot detected!",y,ye,$,_e);break}this.debug("globstar swallow a segment, and continue"),ye++}return!!(W&&(this.debug(`
>>> no match, partial?`,y,ye,$,_e),ye===J))}var ge;if(typeof ie=="string"?(B.nocase?ge=se.toLowerCase()===ie.toLowerCase():ge=se===ie,this.debug("string match",ie,se,ge)):(ge=se.match(ie),this.debug("pattern match",ie,se,ge)),!ge)return!1}if(S===J&&O===me)return!0;if(S===J)return W;if(O===me){var ke=S===J-1&&y[S]==="";return ke}throw new Error("wtf?")};function ce(y){return y.replace(/\\(.)/g,"$1")}function ve(y){return y.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}},778:(l,P,x)=>{var I=x(2479);l.exports=I(N),l.exports.strict=I(k),N.proto=N(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return N(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return k(this)},configurable:!0})});function N(v){var m=function(){return m.called?m.value:(m.called=!0,m.value=v.apply(this,arguments))};return m.called=!1,m}function k(v){var m=function(){if(m.called)throw new Error(m.onceError);return m.called=!0,m.value=v.apply(this,arguments)},R=v.name||"Function wrapped with `once`";return m.onceError=R+" shouldn't be called more than once",m.called=!1,m}},6470:l=>{"use strict";function P(k){if(typeof k!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(k))}function x(k,v){for(var m="",R=0,E=-1,T=0,M,A=0;A<=k.length;++A){if(A<k.length)M=k.charCodeAt(A);else{if(M===47)break;M=47}if(M===47){if(!(E===A-1||T===1))if(E!==A-1&&T===2){if(m.length<2||R!==2||m.charCodeAt(m.length-1)!==46||m.charCodeAt(m.length-2)!==46){if(m.length>2){var j=m.lastIndexOf("/");if(j!==m.length-1){j===-1?(m="",R=0):(m=m.slice(0,j),R=m.length-1-m.lastIndexOf("/")),E=A,T=0;continue}}else if(m.length===2||m.length===1){m="",R=0,E=A,T=0;continue}}v&&(m.length>0?m+="/..":m="..",R=2)}else m.length>0?m+="/"+k.slice(E+1,A):m=k.slice(E+1,A),R=A-E-1;E=A,T=0}else M===46&&T!==-1?++T:T=-1}return m}function I(k,v){var m=v.dir||v.root,R=v.base||(v.name||"")+(v.ext||"");return m?m===v.root?m+R:m+k+R:R}var N={resolve:function(){for(var v="",m=!1,R,E=arguments.length-1;E>=-1&&!m;E--){var T;E>=0?T=arguments[E]:(R===void 0&&(R=process.cwd()),T=R),P(T),T.length!==0&&(v=T+"/"+v,m=T.charCodeAt(0)===47)}return v=x(v,!m),m?v.length>0?"/"+v:"/":v.length>0?v:"."},normalize:function(v){if(P(v),v.length===0)return".";var m=v.charCodeAt(0)===47,R=v.charCodeAt(v.length-1)===47;return v=x(v,!m),v.length===0&&!m&&(v="."),v.length>0&&R&&(v+="/"),m?"/"+v:v},isAbsolute:function(v){return P(v),v.length>0&&v.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var v,m=0;m<arguments.length;++m){var R=arguments[m];P(R),R.length>0&&(v===void 0?v=R:v+="/"+R)}return v===void 0?".":N.normalize(v)},relative:function(v,m){if(P(v),P(m),v===m||(v=N.resolve(v),m=N.resolve(m),v===m))return"";for(var R=1;R<v.length&&v.charCodeAt(R)===47;++R);for(var E=v.length,T=E-R,M=1;M<m.length&&m.charCodeAt(M)===47;++M);for(var A=m.length,j=A-M,re=T<j?T:j,ee=-1,V=0;V<=re;++V){if(V===re){if(j>re){if(m.charCodeAt(M+V)===47)return m.slice(M+V+1);if(V===0)return m.slice(M+V)}else T>re&&(v.charCodeAt(R+V)===47?ee=V:V===0&&(ee=0));break}var te=v.charCodeAt(R+V),ae=m.charCodeAt(M+V);if(te!==ae)break;te===47&&(ee=V)}var oe="";for(V=R+ee+1;V<=E;++V)(V===E||v.charCodeAt(V)===47)&&(oe.length===0?oe+="..":oe+="/..");return oe.length>0?oe+m.slice(M+ee):(M+=ee,m.charCodeAt(M)===47&&++M,m.slice(M))},_makeLong:function(v){return v},dirname:function(v){if(P(v),v.length===0)return".";for(var m=v.charCodeAt(0),R=m===47,E=-1,T=!0,M=v.length-1;M>=1;--M)if(m=v.charCodeAt(M),m===47){if(!T){E=M;break}}else T=!1;return E===-1?R?"/":".":R&&E===1?"//":v.slice(0,E)},basename:function(v,m){if(m!==void 0&&typeof m!="string")throw new TypeError('"ext" argument must be a string');P(v);var R=0,E=-1,T=!0,M;if(m!==void 0&&m.length>0&&m.length<=v.length){if(m.length===v.length&&m===v)return"";var A=m.length-1,j=-1;for(M=v.length-1;M>=0;--M){var re=v.charCodeAt(M);if(re===47){if(!T){R=M+1;break}}else j===-1&&(T=!1,j=M+1),A>=0&&(re===m.charCodeAt(A)?--A==-1&&(E=M):(A=-1,E=j))}return R===E?E=j:E===-1&&(E=v.length),v.slice(R,E)}else{for(M=v.length-1;M>=0;--M)if(v.charCodeAt(M)===47){if(!T){R=M+1;break}}else E===-1&&(T=!1,E=M+1);return E===-1?"":v.slice(R,E)}},extname:function(v){P(v);for(var m=-1,R=0,E=-1,T=!0,M=0,A=v.length-1;A>=0;--A){var j=v.charCodeAt(A);if(j===47){if(!T){R=A+1;break}continue}E===-1&&(T=!1,E=A+1),j===46?m===-1?m=A:M!==1&&(M=1):m!==-1&&(M=-1)}return m===-1||E===-1||M===0||M===1&&m===E-1&&m===R+1?"":v.slice(m,E)},format:function(v){if(v===null||typeof v!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof v);return I("/",v)},parse:function(v){P(v);var m={root:"",dir:"",base:"",ext:"",name:""};if(v.length===0)return m;var R=v.charCodeAt(0),E=R===47,T;E?(m.root="/",T=1):T=0;for(var M=-1,A=0,j=-1,re=!0,ee=v.length-1,V=0;ee>=T;--ee){if(R=v.charCodeAt(ee),R===47){if(!re){A=ee+1;break}continue}j===-1&&(re=!1,j=ee+1),R===46?M===-1?M=ee:V!==1&&(V=1):M!==-1&&(V=-1)}return M===-1||j===-1||V===0||V===1&&M===j-1&&M===A+1?j!==-1&&(A===0&&E?m.base=m.name=v.slice(1,j):m.base=m.name=v.slice(A,j)):(A===0&&E?(m.name=v.slice(1,M),m.base=v.slice(1,j)):(m.name=v.slice(A,M),m.base=v.slice(A,j)),m.ext=v.slice(M,j)),A>0?m.dir=v.slice(0,A-1):E&&(m.dir="/"),m},sep:"/",delimiter:":",win32:null,posix:null};N.posix=N,l.exports=N},5102:()=>{},189:function(l,P,x){"use strict";var I=this&&this.__spreadArrays||function(){for(var E=0,T=0,M=arguments.length;T<M;T++)E+=arguments[T].length;for(var A=Array(E),j=0,T=0;T<M;T++)for(var re=arguments[T],ee=0,V=re.length;ee<V;ee++,j++)A[j]=re[ee];return A};Object.defineProperty(P,"__esModule",{value:!0}),P.config=P.loadMessageBundle=void 0;var N=x(1926),k=x(800),v=x(800);Object.defineProperty(P,"MessageFormat",{enumerable:!0,get:function(){return v.MessageFormat}}),Object.defineProperty(P,"BundleFormat",{enumerable:!0,get:function(){return v.BundleFormat}});function m(E){return function(T,M){for(var A=[],j=2;j<arguments.length;j++)A[j-2]=arguments[j];if(typeof T=="number")throw new Error("Browser implementation does currently not support externalized strings.");return k.localize.apply(void 0,I([T,M],A))}}P.loadMessageBundle=m;function R(E){return k.setPseudo((E==null?void 0:E.locale.toLowerCase())==="pseudo"),m}P.config=R,N.default.install(Object.freeze({loadMessageBundle:m,config:R}))},800:(l,P,x)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.config=P.loadMessageBundle=P.localize=P.format=P.setPseudo=P.isPseudo=P.isDefined=P.BundleFormat=P.MessageFormat=void 0;var I=x(1926),N;(function(j){j.file="file",j.bundle="bundle",j.both="both"})(N=P.MessageFormat||(P.MessageFormat={}));var k;(function(j){j.standalone="standalone",j.languagePack="languagePack"})(k=P.BundleFormat||(P.BundleFormat={}));var v;(function(j){function re(ee){var V=ee;return V&&m(V.key)&&m(V.comment)}j.is=re})(v||(v={}));function m(j){return typeof j!="undefined"}P.isDefined=m,P.isPseudo=!1;function R(j){P.isPseudo=j}P.setPseudo=R;function E(j,re){var ee;return P.isPseudo&&(j="\uFF3B"+j.replace(/[aouei]/g,"$&$&")+"\uFF3D"),re.length===0?ee=j:ee=j.replace(/\{(\d+)\}/g,function(V,te){var ae=te[0],oe=re[ae],le=V;return typeof oe=="string"?le=oe:(typeof oe=="number"||typeof oe=="boolean"||oe===void 0||oe===null)&&(le=String(oe)),le}),ee}P.format=E;function T(j,re){for(var ee=[],V=2;V<arguments.length;V++)ee[V-2]=arguments[V];return E(re,ee)}P.localize=T;function M(j){return I.default().loadMessageBundle(j)}P.loadMessageBundle=M;function A(j){return I.default().config(j)}P.config=A},1926:(l,P)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});var x;function I(){if(x===void 0)throw new Error("No runtime abstraction layer installed");return x}(function(N){function k(v){if(v===void 0)throw new Error("No runtime abstraction layer provided");x=v}N.install=k})(I||(I={})),P.default=I},2479:l=>{l.exports=P;function P(x,I){if(x&&I)return P(x)(I);if(typeof x!="function")throw new TypeError("need wrapper function");return Object.keys(x).forEach(function(k){N[k]=x[k]}),N;function N(){for(var k=new Array(arguments.length),v=0;v<k.length;v++)k[v]=arguments[v];var m=x.apply(this,k),R=k[k.length-1];return typeof m=="function"&&m!==R&&Object.keys(R).forEach(function(E){m[E]=R[E]}),m}}},3730:(l,P)=>{"use strict";var x;x={value:!0};let I=function(){function N(k,v,m){}return N.prototype.updateUserOptIn=function(k){},N.prototype.createAppInsightsClient=function(k){},N.prototype.getCommonProperties=function(){},N.prototype.sendTelemetryEvent=function(k,v,m){},N.prototype.dispose=function(){},N.TELEMETRY_CONFIG_ID="telemetry",N.TELEMETRY_CONFIG_ENABLED_ID="enableTelemetry",N}();P.Z=I}},Za={};function ze(l){var P=Za[l];if(P!==void 0)return P.exports;var x=Za[l]={exports:{}};return Ju[l].call(x.exports,x,x.exports,ze),x.exports}(()=>{ze.n=l=>{var P=l&&l.__esModule?()=>l.default:()=>l;return ze.d(P,{a:P}),P}})(),(()=>{ze.d=(l,P)=>{for(var x in P)ze.o(P,x)&&!ze.o(l,x)&&Object.defineProperty(l,x,{enumerable:!0,get:P[x]})}})(),(()=>{ze.o=(l,P)=>Object.prototype.hasOwnProperty.call(l,P)})(),(()=>{ze.r=l=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})}})();var oo={};(()=>{"use strict";ze.r(oo),ze.d(oo,{activate:()=>my,getOpenActionsService:()=>zu,showRepositoryNotFoundMessage:()=>za});const l=require("vscode");var P=ze(189);function x(){this.__data__=[],this.size=0}const I=x;function N(e,t){return e===t||e!==e&&t!==t}const k=N;function v(e,t){for(var r=e.length;r--;)if(k(e[r][0],t))return r;return-1}const m=v;var R=Array.prototype,E=R.splice;function T(e){var t=this.__data__,r=m(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():E.call(t,r,1),--this.size,!0}const M=T;function A(e){var t=this.__data__,r=m(t,e);return r<0?void 0:t[r][1]}const j=A;function re(e){return m(this.__data__,e)>-1}const ee=re;function V(e,t){var r=this.__data__,n=m(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}const te=V;function ae(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ae.prototype.clear=I,ae.prototype.delete=M,ae.prototype.get=j,ae.prototype.has=ee,ae.prototype.set=te;const oe=ae;function le(){this.__data__=new oe,this.size=0}const L=le;function K(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}const G=K;function ne(e){return this.__data__.get(e)}const ce=ne;function ve(e){return this.__data__.has(e)}const y=ve;var $=typeof global=="object"&&global&&global.Object===Object&&global;const W=$;var B=typeof self=="object"&&self&&self.Object===Object&&self,S=W||B||Function("return this")();const O=S;var J=O.Symbol;const me=J;var ie=Object.prototype,se=ie.hasOwnProperty,ye=ie.toString,_e=me?me.toStringTag:void 0;function Ie(e){var t=se.call(e,_e),r=e[_e];try{e[_e]=void 0;var n=!0}catch(o){}var i=ye.call(e);return n&&(t?e[_e]=r:delete e[_e]),i}const ge=Ie;var ke=Object.prototype,be=ke.toString;function $e(e){return be.call(e)}const Pe=$e;var Ue="[object Null]",Oe="[object Undefined]",rt=me?me.toStringTag:void 0;function Ne(e){return e==null?e===void 0?Oe:Ue:rt&&rt in Object(e)?ge(e):Pe(e)}const mt=Ne;function Zt(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}const xr=Zt;var Kt="[object AsyncFunction]",Yn="[object Function]",ao="[object GeneratorFunction]",ei="[object Proxy]";function ar(e){if(!xr(e))return!1;var t=mt(e);return t==Yn||t==ao||t==Kt||t==ei}const ti=ar;var sn=O["__core-js_shared__"];const kr=sn;var ri=function(){var e=/[^.]+$/.exec(kr&&kr.keys&&kr.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function so(e){return!!ri&&ri in e}const cn=so;var ni=Function.prototype,ii=ni.toString;function ln(e){if(e!=null){try{return ii.call(e)}catch(t){}try{return e+""}catch(t){}}return""}const sr=ln;var Yu=/[\\^$.*+?()[\]{}|]/g,ed=/^\[object .+?Constructor\]$/,td=Function.prototype,rd=Object.prototype,nd=td.toString,id=rd.hasOwnProperty,od=RegExp("^"+nd.call(id).replace(Yu,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ad(e){if(!xr(e)||cn(e))return!1;var t=ti(e)?od:ed;return t.test(sr(e))}const sd=ad;function cd(e,t){return e==null?void 0:e[t]}const ld=cd;function ud(e,t){var r=ld(e,t);return sd(r)?r:void 0}const Er=ud;var dd=Er(O,"Map");const un=dd;var hd=Er(Object,"create");const dn=hd;function fd(){this.__data__=dn?dn(null):{},this.size=0}const pd=fd;function gd(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}const md=gd;var vd="__lodash_hash_undefined__",wd=Object.prototype,yd=wd.hasOwnProperty;function bd(e){var t=this.__data__;if(dn){var r=t[e];return r===vd?void 0:r}return yd.call(t,e)?t[e]:void 0}const _d=bd;var Sd=Object.prototype,Cd=Sd.hasOwnProperty;function xd(e){var t=this.__data__;return dn?t[e]!==void 0:Cd.call(t,e)}const kd=xd;var Ed="__lodash_hash_undefined__";function Rd(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=dn&&t===void 0?Ed:t,this}const Dd=Rd;function Rr(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Rr.prototype.clear=pd,Rr.prototype.delete=md,Rr.prototype.get=_d,Rr.prototype.has=kd,Rr.prototype.set=Dd;const Ka=Rr;function Ad(){this.size=0,this.__data__={hash:new Ka,map:new(un||oe),string:new Ka}}const Td=Ad;function Pd(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}const Id=Pd;function Fd(e,t){var r=e.__data__;return Id(t)?r[typeof t=="string"?"string":"hash"]:r.map}const oi=Fd;function $d(e){var t=oi(this,e).delete(e);return this.size-=t?1:0,t}const Od=$d;function Ud(e){return oi(this,e).get(e)}const Nd=Ud;function Md(e){return oi(this,e).has(e)}const Ld=Md;function Bd(e,t){var r=oi(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}const Hd=Bd;function Dr(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Dr.prototype.clear=Td,Dr.prototype.delete=Od,Dr.prototype.get=Nd,Dr.prototype.has=Ld,Dr.prototype.set=Hd;const Qa=Dr;var Wd=200;function zd(e,t){var r=this.__data__;if(r instanceof oe){var n=r.__data__;if(!un||n.length<Wd-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Qa(n)}return r.set(e,t),this.size=r.size,this}const jd=zd;function Ar(e){var t=this.__data__=new oe(e);this.size=t.size}Ar.prototype.clear=L,Ar.prototype.delete=G,Ar.prototype.get=ce,Ar.prototype.has=y,Ar.prototype.set=jd;const co=Ar;var qd="__lodash_hash_undefined__";function Vd(e){return this.__data__.set(e,qd),this}const Gd=Vd;function Zd(e){return this.__data__.has(e)}const Kd=Zd;function ai(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Qa;++t<r;)this.add(e[t])}ai.prototype.add=ai.prototype.push=Gd,ai.prototype.has=Kd;const Qd=ai;function Xd(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}const Jd=Xd;function Yd(e,t){return e.has(t)}const eh=Yd;var th=1,rh=2;function nh(e,t,r,n,i,o){var a=r&th,s=e.length,u=t.length;if(s!=u&&!(a&&u>s))return!1;var c=o.get(e),d=o.get(t);if(c&&d)return c==t&&d==e;var f=-1,h=!0,p=r&rh?new Qd:void 0;for(o.set(e,t),o.set(t,e);++f<s;){var g=e[f],w=t[f];if(n)var _=a?n(w,g,f,t,e,o):n(g,w,f,e,t,o);if(_!==void 0){if(_)continue;h=!1;break}if(p){if(!Jd(t,function(D,C){if(!eh(p,C)&&(g===D||i(g,D,r,n,o)))return p.push(C)})){h=!1;break}}else if(!(g===w||i(g,w,r,n,o))){h=!1;break}}return o.delete(e),o.delete(t),h}const Xa=nh;var ih=O.Uint8Array;const Ja=ih;function oh(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}const ah=oh;function sh(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}const ch=sh;var lh=1,uh=2,dh="[object Boolean]",hh="[object Date]",fh="[object Error]",ph="[object Map]",gh="[object Number]",mh="[object RegExp]",vh="[object Set]",wh="[object String]",yh="[object Symbol]",bh="[object ArrayBuffer]",_h="[object DataView]",Ya=me?me.prototype:void 0,lo=Ya?Ya.valueOf:void 0;function Sh(e,t,r,n,i,o,a){switch(r){case _h:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case bh:return!(e.byteLength!=t.byteLength||!o(new Ja(e),new Ja(t)));case dh:case hh:case gh:return k(+e,+t);case fh:return e.name==t.name&&e.message==t.message;case mh:case wh:return e==t+"";case ph:var s=ah;case vh:var u=n&lh;if(s||(s=ch),e.size!=t.size&&!u)return!1;var c=a.get(e);if(c)return c==t;n|=uh,a.set(e,t);var d=Xa(s(e),s(t),n,i,o,a);return a.delete(e),d;case yh:if(lo)return lo.call(e)==lo.call(t)}return!1}const Ch=Sh;function xh(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}const kh=xh;var Eh=Array.isArray;const si=Eh;function Rh(e,t,r){var n=t(e);return si(e)?n:kh(n,r(e))}const Dh=Rh;function Ah(e,t){for(var r=-1,n=e==null?0:e.length,i=0,o=[];++r<n;){var a=e[r];t(a,r,e)&&(o[i++]=a)}return o}const Th=Ah;function Ph(){return[]}const Ih=Ph;var Fh=Object.prototype,$h=Fh.propertyIsEnumerable,es=Object.getOwnPropertySymbols,Oh=es?function(e){return e==null?[]:(e=Object(e),Th(es(e),function(t){return $h.call(e,t)}))}:Ih;const Uh=Oh;function Nh(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}const Mh=Nh;function Lh(e){return e!=null&&typeof e=="object"}const hn=Lh;var Bh="[object Arguments]";function Hh(e){return hn(e)&&mt(e)==Bh}const ts=Hh;var rs=Object.prototype,Wh=rs.hasOwnProperty,zh=rs.propertyIsEnumerable,jh=ts(function(){return arguments}())?ts:function(e){return hn(e)&&Wh.call(e,"callee")&&!zh.call(e,"callee")};const qh=jh;function Vh(){return!1}const Gh=Vh;var ns=typeof exports=="object"&&exports&&!exports.nodeType&&exports,is=ns&&typeof module=="object"&&module&&!module.nodeType&&module,Zh=is&&is.exports===ns,os=Zh?O.Buffer:void 0,Kh=os?os.isBuffer:void 0,Qh=Kh||Gh;const uo=Qh;var Xh=9007199254740991,Jh=/^(?:0|[1-9]\d*)$/;function Yh(e,t){var r=typeof e;return t=t==null?Xh:t,!!t&&(r=="number"||r!="symbol"&&Jh.test(e))&&e>-1&&e%1==0&&e<t}const ef=Yh;var tf=9007199254740991;function rf(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=tf}const as=rf;var nf="[object Arguments]",of="[object Array]",af="[object Boolean]",sf="[object Date]",cf="[object Error]",lf="[object Function]",uf="[object Map]",df="[object Number]",hf="[object Object]",ff="[object RegExp]",pf="[object Set]",gf="[object String]",mf="[object WeakMap]",vf="[object ArrayBuffer]",wf="[object DataView]",yf="[object Float32Array]",bf="[object Float64Array]",_f="[object Int8Array]",Sf="[object Int16Array]",Cf="[object Int32Array]",xf="[object Uint8Array]",kf="[object Uint8ClampedArray]",Ef="[object Uint16Array]",Rf="[object Uint32Array]",Me={};Me[yf]=Me[bf]=Me[_f]=Me[Sf]=Me[Cf]=Me[xf]=Me[kf]=Me[Ef]=Me[Rf]=!0,Me[nf]=Me[of]=Me[vf]=Me[af]=Me[wf]=Me[sf]=Me[cf]=Me[lf]=Me[uf]=Me[df]=Me[hf]=Me[ff]=Me[pf]=Me[gf]=Me[mf]=!1;function Df(e){return hn(e)&&as(e.length)&&!!Me[mt(e)]}const Af=Df;function Tf(e){return function(t){return e(t)}}const Pf=Tf;var ss=typeof exports=="object"&&exports&&!exports.nodeType&&exports,fn=ss&&typeof module=="object"&&module&&!module.nodeType&&module,If=fn&&fn.exports===ss,ho=If&&W.process,Ff=function(){try{var e=fn&&fn.require&&fn.require("util").types;return e||ho&&ho.binding&&ho.binding("util")}catch(t){}}();const cs=Ff;var ls=cs&&cs.isTypedArray,$f=ls?Pf(ls):Af;const us=$f;var Of=Object.prototype,Uf=Of.hasOwnProperty;function Nf(e,t){var r=si(e),n=!r&&qh(e),i=!r&&!n&&uo(e),o=!r&&!n&&!i&&us(e),a=r||n||i||o,s=a?Mh(e.length,String):[],u=s.length;for(var c in e)(t||Uf.call(e,c))&&!(a&&(c=="length"||i&&(c=="offset"||c=="parent")||o&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||ef(c,u)))&&s.push(c);return s}const Mf=Nf;var Lf=Object.prototype;function Bf(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Lf;return e===r}const Hf=Bf;function Wf(e,t){return function(r){return e(t(r))}}var zf=Wf(Object.keys,Object);const jf=zf;var qf=Object.prototype,Vf=qf.hasOwnProperty;function Gf(e){if(!Hf(e))return jf(e);var t=[];for(var r in Object(e))Vf.call(e,r)&&r!="constructor"&&t.push(r);return t}const Zf=Gf;function Kf(e){return e!=null&&as(e.length)&&!ti(e)}const Qf=Kf;function Xf(e){return Qf(e)?Mf(e):Zf(e)}const Jf=Xf;function Yf(e){return Dh(e,Jf,Uh)}const ds=Yf;var ep=1,tp=Object.prototype,rp=tp.hasOwnProperty;function np(e,t,r,n,i,o){var a=r&ep,s=ds(e),u=s.length,c=ds(t),d=c.length;if(u!=d&&!a)return!1;for(var f=u;f--;){var h=s[f];if(!(a?h in t:rp.call(t,h)))return!1}var p=o.get(e),g=o.get(t);if(p&&g)return p==t&&g==e;var w=!0;o.set(e,t),o.set(t,e);for(var _=a;++f<u;){h=s[f];var D=e[h],C=t[h];if(n)var U=a?n(C,D,h,t,e,o):n(D,C,h,e,t,o);if(!(U===void 0?D===C||i(D,C,r,n,o):U)){w=!1;break}_||(_=h=="constructor")}if(w&&!_){var F=e.constructor,z=t.constructor;F!=z&&"constructor"in e&&"constructor"in t&&!(typeof F=="function"&&F instanceof F&&typeof z=="function"&&z instanceof z)&&(w=!1)}return o.delete(e),o.delete(t),w}const ip=np;var op=Er(O,"DataView");const fo=op;var ap=Er(O,"Promise");const po=ap;var sp=Er(O,"Set");const go=sp;var cp=Er(O,"WeakMap");const mo=cp;var hs="[object Map]",lp="[object Object]",fs="[object Promise]",ps="[object Set]",gs="[object WeakMap]",ms="[object DataView]",up=sr(fo),dp=sr(un),hp=sr(po),fp=sr(go),pp=sr(mo),cr=mt;(fo&&cr(new fo(new ArrayBuffer(1)))!=ms||un&&cr(new un)!=hs||po&&cr(po.resolve())!=fs||go&&cr(new go)!=ps||mo&&cr(new mo)!=gs)&&(cr=function(e){var t=mt(e),r=t==lp?e.constructor:void 0,n=r?sr(r):"";if(n)switch(n){case up:return ms;case dp:return hs;case hp:return fs;case fp:return ps;case pp:return gs}return t});const vs=cr;var gp=1,ws="[object Arguments]",ys="[object Array]",ci="[object Object]",mp=Object.prototype,bs=mp.hasOwnProperty;function vp(e,t,r,n,i,o){var a=si(e),s=si(t),u=a?ys:vs(e),c=s?ys:vs(t);u=u==ws?ci:u,c=c==ws?ci:c;var d=u==ci,f=c==ci,h=u==c;if(h&&uo(e)){if(!uo(t))return!1;a=!0,d=!1}if(h&&!d)return o||(o=new co),a||us(e)?Xa(e,t,r,n,i,o):Ch(e,t,u,r,n,i,o);if(!(r&gp)){var p=d&&bs.call(e,"__wrapped__"),g=f&&bs.call(t,"__wrapped__");if(p||g){var w=p?e.value():e,_=g?t.value():t;return o||(o=new co),i(w,_,r,n,o)}}return h?(o||(o=new co),ip(e,t,r,n,i,o)):!1}const wp=vp;function _s(e,t,r,n,i){return e===t?!0:e==null||t==null||!hn(e)&&!hn(t)?e!==e&&t!==t:wp(e,t,r,n,_s,i)}const yp=_s;function bp(e,t){return yp(e,t)}const _p=bp,Ot="remoteHub";class Ss{constructor(){this._onDidChange=new l.EventEmitter,this._onDidChangeAny=new l.EventEmitter}static configure(t){t.subscriptions.push(l.workspace.onDidChangeConfiguration(Ce.onConfigurationChanged,Ce))}get onDidChange(){return this._onDidChange.event}get onDidChangeAny(){return this._onDidChangeAny.event}onConfigurationChanged(t){if(!t.affectsConfiguration(Ot)){this._onDidChangeAny.fire(t);return}this._onDidChangeAny.fire(t),this._onDidChange.fire(t)}get(t,r,n){return n===void 0?l.workspace.getConfiguration(t===void 0?void 0:Ot,r).get(t===void 0?Ot:t):l.workspace.getConfiguration(t===void 0?void 0:Ot,r).get(t===void 0?Ot:t,n)}getAny(t,r,n){return n===void 0?l.workspace.getConfiguration(void 0,r).get(t):l.workspace.getConfiguration(void 0,r).get(t,n)}changed(t,r,n){var i;return(i=t==null?void 0:t.affectsConfiguration(`${Ot}.${r}`,n))!=null?i:!0}inspect(t,r){return l.workspace.getConfiguration(t===void 0?void 0:Ot,r).inspect(t===void 0?Ot:t)}inspectAny(t,r){return l.workspace.getConfiguration(void 0,r).inspect(t)}async migrate(t,r,n){const i=Ce.inspect(t);if(i===void 0)return!1;let o=!1;return i.globalValue!==void 0&&(await this.update(r,n.migrationFn!=null?n.migrationFn(i.globalValue):i.globalValue,l.ConfigurationTarget.Global),o=!0),i.workspaceValue!==void 0&&(await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceValue):i.workspaceValue,l.ConfigurationTarget.Workspace),o=!0),i.workspaceFolderValue!==void 0&&(await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceFolderValue):i.workspaceFolderValue,l.ConfigurationTarget.WorkspaceFolder),o=!0),!o&&n.fallbackValue!==void 0&&(await this.update(r,n.fallbackValue,l.ConfigurationTarget.Global),o=!0),o}async migrateIfMissing(t,r,n){const i=Ce.inspect(t);if(i===void 0)return;const o=Ce.inspect(r);i.globalValue!==void 0&&(o===void 0||o.globalValue===void 0)&&await this.update(r,n.migrationFn!=null?n.migrationFn(i.globalValue):i.globalValue,l.ConfigurationTarget.Global),i.workspaceValue!==void 0&&(o===void 0||o.workspaceValue===void 0)&&await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceValue):i.workspaceValue,l.ConfigurationTarget.Workspace),i.workspaceFolderValue!==void 0&&(o===void 0||o.workspaceFolderValue===void 0)&&await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceFolderValue):i.workspaceFolderValue,l.ConfigurationTarget.WorkspaceFolder)}name(t){return t}update(t,r,n){return l.workspace.getConfiguration(Ot).update(t,r,n)}updateAny(t,r,n,i){return l.workspace.getConfiguration(void 0,n===l.ConfigurationTarget.Global?void 0:i).update(t,r,n)}updateEffective(t,r){const n=Ce.inspect(t);return n.workspaceFolderValue!==void 0?r===n.workspaceFolderValue?Promise.resolve(void 0):Ce.update(t,r,l.ConfigurationTarget.WorkspaceFolder):n.workspaceValue!==void 0?r===n.workspaceValue?Promise.resolve(void 0):Ce.update(t,r,l.ConfigurationTarget.Workspace):n.globalValue===r||n.globalValue===void 0&&r===n.defaultValue?Promise.resolve(void 0):Ce.update(t,_p(r,n.defaultValue)?void 0:r,l.ConfigurationTarget.Global)}}const Ce=new Ss;class Sp{constructor(t,r,n,i,o){this.providerService=t,this.uri=r,this.id=n,this.name=i,this.provider={id:o.id,name:o.name}}get canonicalUri(){return this.providerService.getVirtualCanonicalRootUri(this.uri)}createRelativeUri(t){return this.providerService.createRelativeUri(this.uri,t)}async getMetadata(){const t=await this.providerService.getMetadata(this.uri);if(!t)throw new Error(`Unable to find metadata for ${this.uri.toString()}`);return t}}var pn;(function(e){e[e.Open=0]="Open",e[e.Closed=1]="Closed",e[e.Merged=2]="Merged"})(pn||(pn={}));var Ee;(function(e){e[e.Branch=0]="Branch",e[e.Tag=1]="Tag",e[e.Commit=2]="Commit",e[e.PullRequest=3]="PullRequest",e[e.Tree=4]="Tree"})(Ee||(Ee={}));var Ut;(function(e){e[e.Clone=-1]="Clone",e[e.Repository=0]="Repository",e[e.PullRequest=1]="PullRequest",e[e.Branch=2]="Branch",e[e.Commit=3]="Commit"})(Ut||(Ut={}));var qe;(function(e){e[e.Repository=0]="Repository",e[e.PullRequest=1]="PullRequest",e[e.Branch=2]="Branch",e[e.Commit=3]="Commit",e[e.File=4]="File"})(qe||(qe={}));const Cp="";function xp(...e){if(e.length===1){const t=e[0];return t===void 0?Cp:typeof t=="string"?t:typeof t=="number"||typeof t=="boolean"?String(t):JSON.stringify(t)}return JSON.stringify(e)}function kp(e){return e!==void 0&&typeof e.then=="function"}function xt(e){return(t,r,n)=>{let i;if(typeof n.value=="function"?i=n.value:typeof n.get=="function"&&(i=n.get),i===void 0)throw new Error("Not supported");const o=`$gate$${r}`;n.value=function(...a){const s=a.length===0?o:`${o}$${(e!=null?e:xp)(...a)}`;Object.prototype.hasOwnProperty.call(this,s)||Object.defineProperty(this,s,{configurable:!1,enumerable:!1,writable:!0,value:void 0});let u=this[s];if(u===void 0){let c;try{if(c=i.apply(this,a),c==null||!kp(c))return c;this[s]=u=c.then(d=>(this[s]=void 0,d)).catch(d=>{throw this[s]=void 0,d})}catch(d){throw this[s]=void 0,d}}return u}}}function*Cs(e,t){for(const r of e)yield*t(r)}function*Ep(e,t){for(const r of e)t(r)&&(yield r)}function*Tr(e,t){for(const r of e){const n=t(r);n!=null&&(yield n)}}function Rp(e,t){let r="";const n=e[Symbol.iterator]();let i=n.next();if(i.done)return r;for(;;){const o=i.value.toString();if(i=n.next(),i.done){r+=o;break}r+=o,r+=t}return r}function*Pr(e,t){for(const r of e)yield t(r)}function*Dp(...e){for(const t of e)for(const r of t)yield r}function*Ap(e){const t=new Set;for(const r of e)t.has(r)||(t.add(r),yield r)}const ct="";var De;(function(e){e.Off="off",e.Error="error",e.Warn="warn",e.Info="info",e.Debug="debug"})(De||(De={}));var xs;(function(e){e[e.Off=0]="Off",e[e.Error=1]="Error",e[e.Warn=2]="Warn",e[e.Info=3]="Info",e[e.Debug=4]="Debug"})(xs||(xs={}));const Tp="Remote Repositories",li="[RemoteHub]",kt=class{static configure(e,t){this._isDebugging=e.extensionMode===l.ExtensionMode.Development,this.logLevel=t}static enabled(e){return this.level>=this.toOrderedLevel(e)}static get logLevel(){return this._logLevel}static set logLevel(e){var t,r;this._logLevel=e,e===De.Off?((t=this.output)==null||t.dispose(),this.output=void 0):this.output=(r=this.output)!=null?r:l.window.createOutputChannel(Tp)}static get level(){return this.toOrderedLevel(this.logLevel)}static toOrderedLevel(e){switch(e){case De.Off:return 0;case De.Error:return 1;case De.Warn:return 2;case De.Info:return 3;case De.Debug:return 4}}static get isDebugging(){return this._isDebugging}static debug(e,...t){this.logLevel<De.Debug&&!kt.isDebugging||(kt.isDebugging&&console.log(this.timestamp,li,e!=null?e:ct,...t),this.output!==void 0&&this.logLevel===De.Debug&&this.output.appendLine(`${this.timestamp} ${e!=null?e:ct}${this.toLoggableParams(!0,t)}`))}static error(e,t,...r){if(!(this.level<1&&!kt.isDebugging)){if(t===void 0){const n=e.stack;if(n){const i=/.*\s*?at\s(.+?)\s/.exec(n);i!==null&&(t=i[1])}}kt.isDebugging&&console.error(this.timestamp,li,t!=null?t:ct,...r,e),this.output!==void 0&&this.logLevel!==De.Off&&this.output.appendLine(`${this.timestamp} ${t!=null?t:ct}${this.toLoggableParams(!1,r)}
${e==null?void 0:e.toString()}`)}}static log(e,...t){this.level<3&&!kt.isDebugging||(kt.isDebugging&&console.log(this.timestamp,li,e!=null?e:ct,...t),this.output!==void 0&&(this.logLevel===De.Info||this.logLevel===De.Debug)&&this.output.appendLine(`${this.timestamp} ${e!=null?e:ct}${this.toLoggableParams(!1,t)}`))}static warn(e,...t){this.logLevel<De.Warn&&!kt.isDebugging||(kt.isDebugging&&console.warn(this.timestamp,li,e!=null?e:ct,...t),this.output!==void 0&&this.logLevel!==De.Off&&this.output.appendLine(`${this.timestamp} ${e!=null?e:ct}${this.toLoggableParams(!1,t)}`))}static showOutputChannel(){var e;(e=this.output)==null||e.show()}static toLoggable(e,t){if(typeof e!="object")return String(e);if(e instanceof l.Uri)return`Uri(${e.toString(!0)})`;try{return JSON.stringify(e,t)}catch{return"<error>"}}static toLoggableName(e){var t,r,n;let i;if(typeof e=="function"){if(e.prototype===void 0||e.prototype.constructor===void 0)return e.name;i=(t=e.prototype.constructor.name)!=null?t:ct}else i=(n=(r=e.constructor)==null?void 0:r.name)!=null?n:ct;const o=i.indexOf("_");return o===-1?i:i.substr(o+1)}static get timestamp(){const e=new Date;return`[${e.toISOString().replace(/T/," ").replace(/\..+/,ct)}:${`00${e.getUTCMilliseconds()}`.slice(-3)}]`}static toLoggableParams(e,t){if(t.length===0||e&&this.logLevel!==De.Debug&&!kt.isDebugging)return ct;const r=t.map(n=>this.toLoggable(n)).join(", ");return r.length!==0?` \u2014 ${r}`:ct}};let q=kt;q._logLevel=De.Off;const Pp=new TextDecoder,Ip=new TextEncoder;async function ui(e){const t=typeof e=="string"?Ip.encode(e):e;let r;if(globalThis.crypto.subtle)r=await globalThis.crypto.subtle.digest({name:"sha-1"},t);else{const n=new Ds;n.update(t),r=n.digest()}return globalThis.btoa(encodeURIComponent(Pp.decode(r)))}var ks;(function(e){e[e.BLOCK_SIZE=64]="BLOCK_SIZE"})(ks||(ks={}));function vo(e,t,r=32){const n=r-t,i=~((1<<n)-1);return(e<<t|(i&e)>>>n)>>>0}function Es(e,t=0,r=e.byteLength,n=0){for(let i=0;i<r;i++)e[t+i]=n}const Rs=class{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(64+3),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._finished=!1}update(e){const t=this._buff;let r=this._buffLen,n=0;const i=e.byteLength;for(;n<i;){const o=Math.min(64-r,i-n);for(let a=0;a<o;a++)t[r++]=e[n++];r>=64&&(this._step(),r-=64,this._totalLen+=64)}this._buffLen=r}digest(){this._finished||(this._finished=!0,this._totalLen+=this._buffLen,this._wrapUp());const e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this._h0,!1),t.setUint32(4,this._h1,!1),t.setUint32(8,this._h2,!1),t.setUint32(12,this._h3,!1),t.setUint32(16,this._h4,!1),e}_wrapUp(){this._buff[this._buffLen++]=128,Es(this._buff,this._buffLen),this._buffLen>56&&(this._step(),Es(this._buff));const e=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(e/4294967296),!1),this._buffDV.setUint32(60,e%4294967296,!1),this._step()}_step(){const e=Rs._bigBlock32,t=this._buffDV;for(let d=0;d<64;d+=4)e.setUint32(d,t.getUint32(d,!1),!1);for(let d=64;d<320;d+=4)e.setUint32(d,vo(e.getUint32(d-12,!1)^e.getUint32(d-32,!1)^e.getUint32(d-56,!1)^e.getUint32(d-64,!1),1),!1);let r=this._h0,n=this._h1,i=this._h2,o=this._h3,a=this._h4,s,u,c;for(let d=0;d<80;d++)d<20?(s=n&i|~n&o,u=1518500249):d<40?(s=n^i^o,u=1859775393):d<60?(s=n&i|n&o|i&o,u=2400959708):(s=n^i^o,u=3395469782),c=vo(r,5)+s+a+u+e.getUint32(d*4,!1)&4294967295,a=o,o=i,i=vo(n,30),n=r,r=c;this._h0=this._h0+r&4294967295,this._h1=this._h1+n&4294967295,this._h2=this._h2+i&4294967295,this._h3=this._h3+o&4294967295,this._h4=this._h4+a&4294967295}};let Ds=Rs;Ds._bigBlock32=new DataView(new ArrayBuffer(320));function Fp(e){const t=globalThis.atob(e),r=t.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=t.charCodeAt(i);return n}const $p=e=>e.charCodeAt(0);function Ty(e){return Uint8Array.from(globalThis.atob(e).toString(),$p)}const{fromCharCode:Op}=String;function Py(e){let t="";for(let r=0,{length:n}=e;r<n;r++)t+=Op(e[r]);return globalThis.btoa(t)}const Up=new TextDecoder,Np=new TextEncoder,Mp=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function Lp(e){const t=Np.encode(e),r=new Array(t.length);for(let n=0;n<t.length;++n)r[n]=Mp[t[n]];return r.join("")}function Bp(e){const t=e.match(/(\w{2})/g);if(t===null)return"";const r=new Uint8Array(t.map(n=>parseInt(n,16)));return Up.decode(r)}function Hp(e,t){if(e===t)return-1;let r=0;for(;e[r]===t[r];)r++;return r}const As=47;function Y(e,t=!1){if(e===void 0)return;const r=e.path.endsWith("/");return!r&&(!e.fragment||t)?e.toString():e.with({path:r?e.path.slice(0,-1):e.path,fragment:""}).toString()}function Wp(e){return`${e.scheme}-${e.authority}${e.path.endsWith("/")?e.path.slice(0,-1):e.path}`}function it(e){const t=e.path;let r=0,n=-1,i=!0;for(let o=t.length-1;o>=0;--o)if(t.charCodeAt(o)===As){if(!i){r=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":t.slice(r,n)}function Iy(e){const t=e.path;if(t.length===1)return"/";let r,n=-1,i=!0;for(let o=t.length-1;o>=1;--o)if(r=t.charCodeAt(o),r===As){if(!i){n=o;break}}else i=!1;return n===-1?"/":t.slice(0,n)}function zp(e){const t=e.path.lastIndexOf("/");return t===-1?e.with({path:"/"}):e.with({path:e.path.substring(0,t)})}function jp(e,t){return wo(e,t).path}function wo(e,t){return t.path.startsWith(e.path)?l.Uri.joinPath(e,t.path.substr(e.path.length)):l.Uri.joinPath(e,t.path)}function di(e,t){return typeof t=="string"?(t.startsWith("/")||(t=`/${t}`),yo(e,t)&&e.path.substr(t.length+(t.endsWith("/")?0:1)).split("/").length===1):yo(e,t)&&e.path.substr(t.path.length+(t.path.endsWith("/")?0:1)).split("/").length===1}function yo(e,t){return typeof t=="string"?(t.startsWith("/")||(t=`/${t}`),t.length===1||e.path.startsWith(t.endsWith("/")?t:`${t}/`)):t.scheme===e.scheme&&t.authority===e.authority&&(t.path.length===1||e.path.startsWith(t.path.endsWith("/")?t.path:`${t.path}/`))}class Ts extends Error{constructor(t){super(t.message);this.original=t,Error.captureStackTrace(this,Ts)}}class Ir extends Error{constructor(t,r){super(t.message);this.original=t,this.name=r,Error.captureStackTrace(this,Ir)}}class gn extends Error{constructor(t){super(t);Error.captureStackTrace(this,gn)}}class mn extends Error{constructor(t,r){super(t.message);this.original=t,this.duplicate=r,Error.captureStackTrace(this,mn)}}class hi extends Error{constructor(t){super(t.message);this.original=t,Error.captureStackTrace(this,hi)}}class bo extends Error{constructor(t=!1){super(t?"Unable to synchronize the repository":"Unable to fetch the repository");Error.captureStackTrace(this,bo)}}class fi extends Error{constructor(){super("Sync operation will result in conflicts");Error.captureStackTrace(this,fi)}}var Fy=ze(5102),qp=Object.defineProperty,Vp=Object.getOwnPropertyDescriptor,Gp=(e,t,r,n)=>{for(var i=n>1?void 0:n?Vp(t,r):t,o=e.length-1,a;o>=0;o--)(a=e[o])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&qp(t,r,i),i},Nt;(function(e){e[e.Abort=0]="Abort",e[e.KeepCurrent=1]="KeepCurrent",e[e.DiscardCurrent=2]="DiscardCurrent",e[e.Merge=3]="Merge"})(Nt||(Nt={}));const je=class{constructor(e,t){this.metadataStore=e,this.telemetryService=t,this._providers=new Map,this._onDidChangeProviders=new l.EventEmitter,this._repositories=new Map,this._onDidChangeRepositories=new l.EventEmitter,this._onDidChangeRepository=new l.EventEmitter,this._onDidRefresh=new l.EventEmitter,this._onWillRefresh=new l.EventEmitter,this.pendingMetadataRequests=new Map,this.disposable=l.Disposable.from(l.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this),e.onDidChange(r=>this.onMetadataChanged(r)))}get onDidChangeProviders(){return this._onDidChangeProviders.event}get onDidChangeRepositories(){return this._onDidChangeRepositories.event}get onDidChangeRepository(){return this._onDidChangeRepository.event}get onDidRefresh(){return this._onDidRefresh.event}get onWillRefresh(){return this._onWillRefresh.event}dispose(){this.disposable.dispose(),this._providers.clear(),this._repositories.clear()}onMetadataChanged(e){const t=this._repositories.get(Y(e));!t||this._onDidChangeRepository.fire({repository:t})}async onWorkspaceFoldersChanged(e){if(e.added.length)for(const t of e.added){const r=Y(t.uri);if(t.uri.scheme!==je.scheme||this._repositories.has(r))continue;const n=this.getProvider(t.uri);if(!n)continue;this._repositories.set(r,null);const i=await this.getMetadata(t.uri),o=new Sp(this,t.uri,i.repo,t.name,n);this._repositories.set(r,o),this._onDidChangeRepositories.fire({added:[o],removed:[]}),this.telemetryService.sendEvent("repository.opened",{provider:n.id,repositories:this._repositories.size.toString()})}if(e.removed.length)for(const t of e.removed){const r=Y(t.uri);if(t.uri.scheme!==je.scheme||!this._repositories.has(r))continue;const n=this._repositories.get(r);this._repositories.delete(r),n&&(this._onDidChangeRepositories.fire({added:[],removed:[n]}),this.telemetryService.sendEvent("repository.closed",{repositories:this._repositories.size.toString()}))}$o(wn.HasVirtualFolders,this._repositories.size!==0),$o(wn.VirtualFolderProviders,Rp(Ap(Pr(this.getRepositories(),t=>t.provider.id)),","))}get hasProviders(){return this._providers.size!==0}get registeredProviders(){return[...Pr(this._providers.values(),e=>({id:e.id,name:e.name}))]}get repositories(){return[...this.getRepositories()]}register(e,t,r,n,i){var o;if(this._providers.has(e))throw new Error(`Provider '${e}' has already been registered`);const a={id:e,name:t,provider:r,fs:n,index:i};return this._providers.set(e,a),this._onDidChangeProviders.fire({added:[a],removed:[]}),this.telemetryService.sendEvent("provider.registered",{provider:e}),this.onWorkspaceFoldersChanged({added:(o=l.workspace.workspaceFolders)!=null?o:[],removed:[]}),{dispose:()=>{this._providers.delete(e);const s=[];for(const[u,c]of[...this._repositories])(c==null?void 0:c.provider.id)===e&&(this._repositories.delete(u),s.push(c));this._onDidChangeRepositories.fire({added:[],removed:s}),this._onDidChangeProviders.fire({added:[],removed:[a]})}}}refresh(){if(this._providers.size===0)return;const e=[];for(const t of this._providers.values())e.push(...Pr(this.getRepositories(t.id),r=>r.uri));this._onWillRefresh.fire(e),this.metadataStore.refresh(),this._onDidRefresh.fire(e)}getRegisteredProvider(e){const t=this.getProvider(e);return t?{id:t.id,name:t.name}:void 0}getRepository(e,t){const r=l.workspace.getWorkspaceFolder(e);if(!r||r.uri.scheme!==je.scheme)return;const n=this._repositories.get(Y(r.uri));if(!(t!==void 0&&(n==null?void 0:n.provider.id)!==t))return n!=null?n:void 0}getRepositories(e){return Ep(this._repositories.values(),t=>t!==null&&(!e||t.provider.id===e))}getOpenUris(e,t){const r=[];for(const n of t)r.push(...l.workspace.textDocuments.map(i=>i.uri.scheme===e&&yo(i.uri,n)?i.uri:void 0).filter(i=>Boolean(i)));return r}hasProvider(e,t){const r=typeof e=="string"?e:je.getProviderId(e),n=this._providers.get(r);return t!==void 0&&(n==null?void 0:n.id)!==t?!1:n!==void 0}getProvider(e){const t=typeof e=="string"?e:je.getProviderId(e);return this._providers.get(t)}getRepositoryProvider(e){var t;const r=(t=this.getProvider(e))==null?void 0:t.provider;if(r)return r;throw new Error(this.createNoProviderErrorMessage(e))}createNoProviderErrorMessage(e){return`No provider registered with id '${typeof e=="string"?e:je.getProviderId(e)}'`}getFileSystemProvider(e){var t;const r=(t=this.getProvider(e))==null?void 0:t.fs;if(r)return r;throw new Error(`No provider registered with id '${je.getProviderId(e)}'`)}findRemoteUrlHandler(e,t){if(t){const r=this.getProvider(t),n=r==null?void 0:r.provider.canOpenRemoteUrl(e);return n!==void 0?{provider:r,urlType:n}:void 0}for(const r of this._providers.values()){const n=r.provider.canOpenRemoteUrl(e);if(n!==void 0)return{provider:r,urlType:n}}}getRemoteWorkspaceSourceProviders(e){var t,r,n,i;return e?(i=(n=(t=this.getProvider(e))==null?void 0:(r=t.provider).getRemoteWorkspaceSourceProviders)==null?void 0:n.call(r))!=null?i:[]:[...Cs(this._providers.values(),o=>{var a,s,u;return(u=(s=(a=o.provider).getRemoteWorkspaceSourceProviders)==null?void 0:s.call(a))!=null?u:[]})]}async getBestIndexedCommit(e){var t;const r=this.getProvider(e);return(t=r==null?void 0:r.index)==null?void 0:t.getBestIndexedCommit(r.provider,e)}async createWorkspaceForRemoteUrl(e,t,r=Le.CurrentWindow){var n;const i=this.findRemoteUrlHandler(e,t);return(n=i==null?void 0:i.provider)==null?void 0:n.provider.createWorkspaceForRemoteUrl(e,r)}createProviderUri(e,t,r){return this.getProviderUri(this.getRepositoryProvider(e).createVirtualUri(je.baseVirtualWorkspaceUri,t,r))}createRelativeProviderUri(e,t){return this.getProviderUri(this.createRelativeUri(e,t))}createRelativeUri(e,t){const r=this.getProviderRootUri(e);let n=`${r.path}/`;n.endsWith("/")&&(n=n.slice(0,-1));const i=r.with({path:`${r.path}/${t.startsWith("/")?t.substr(1):t}`});return e.scheme===je.scheme?this.getVirtualUri(i):i}createRelativeVirtualUri(e,t){return this.getVirtualUri(this.createRelativeUri(e,t))}createVirtualUri(e,t,r){return this.getRepositoryProvider(e).createVirtualUri(je.baseVirtualWorkspaceUri,t,r)}async getBestExternalUri(e,t){var r,n,i,o;const{provider:a,repo:s,HEAD:u,defaultBranch:c,pullRequest:d}=await this.getMetadata(e);switch(t){case Ut.Clone:return this.getExternalUri(a.id,{repo:s,clone:!0});case Ut.Repository:return this.getExternalUri(a.id,{repo:s});case Ut.PullRequest:return d?this.getExternalUri(a.id,{repo:s,pullRequest:d.id}):void 0;case Ut.Commit:return this.getExternalUri(a.id,{repo:s,sha:u.sha});case Ut.Branch:return this.getExternalUri(a.id,{repo:s,branch:(n=(r=u.branch)==null?void 0:r.name)!=null?n:c.name})}return this.getExternalUri(a.id,{repo:s,...d?{pullRequest:d.id}:u.detached?{sha:u.sha}:{branch:(o=(i=u.branch)==null?void 0:i.name)!=null?o:c.name}})}getCanonicalUri(e){let{authority:t}=e;const r=t.indexOf(je.authoritySeparator);return r!==-1&&(t=t.substr(0,r)),e.with({authority:t})}getExternalUri(e,t){var r,n;return(n=(r=this.getRepositoryProvider(e)).getExternalUri)==null?void 0:n.call(r,t)}getProviderUri(e){return e.scheme!==je.scheme?e:e.with({scheme:je.getProviderId(e)})}getProviderRootUri(e){return e=this.getProviderUri(e),this.getRepositoryProvider(e).getProviderRootUri(e)}getRelativeFilePath(e,t){return t=this.getProviderUri(t),this.getRepositoryProvider(t).getRelativeFilePath(e,t)}getVirtualUri(e){return e.scheme===je.scheme?e:e.with({scheme:je.scheme})}getVirtualCanonicalRootUri(e){const t=this.getVirtualUri(this.getProviderRootUri(e));let{authority:r}=t;const n=r.indexOf(je.authoritySeparator);return n!==-1&&(r=r.substr(0,n)),t.with({authority:r})}getVirtualRootUri(e){return this.getVirtualUri(this.getProviderRootUri(e))}getVirtualWorkspaceUri(e){var t;return(t=l.workspace.getWorkspaceFolder(this.getVirtualUri(e)))==null?void 0:t.uri}createIGitRepository(e,t,r,n){var i,o;return(o=(i=this.getRepositoryProvider(e)).createIGitRepository)==null?void 0:o.call(i,e,t,r,n)}async getCommitOperations(e,t,r){let n;return(r==null?void 0:r.staged)?(n=await t.getStagedChanges(e),n.length===0&&r.staged==="auto"&&(n=await t.getChanges(e))):n=await t.getChanges(e),n.map(o=>{const a=this.getRelativeFilePath(e,o.uri);switch(o.type){case xe.Created:return{type:o.type,path:a,fileType:o.fileType,content:t.getContent(o.uri)};case xe.Changed:return{type:o.type,path:a,fileType:o.fileType,content:t.getContent(o.uri)};case xe.Deleted:return{type:o.type,path:a,fileType:o.fileType,content:void 0}}})}async getMetadata(e){return{...await this.getMetadataCore(this.getVirtualRootUri(e)),path:this.getRelativeFilePath(e,e)}}async getMetadataCore(e){const t=Y(e);let r=this.pendingMetadataRequests.get(t);if(r)return r;const{revision:n,cachedMetadata:i}=await this.metadataStore.get(e);if(i!==void 0)return i;const o=this.getProvider(e);if(!o)throw new Error(this.createNoProviderErrorMessage(e));const a=o.index?await o.index.getBestIndexedCommit(o.provider,e):void 0;r=o.provider.createMetadata(e,n!=null?n:a),this.pendingMetadataRequests.set(t,r);try{const s=await r;return a&&(s.index={sha:a}),await this.updateMetadata(e,s),s}finally{this.pendingMetadataRequests.delete(t)}}async updateMetadata(e,t){await this.metadataStore.set(this.getVirtualUri(e),t.HEAD.sha,t)}async clone(e){const t=await this.getBestExternalUri(e,Ut.Clone);if(!t)throw new Error("No url found for clone");if(Qt)return void l.env.openExternal(l.Uri.parse(`${l.env.uriScheme}://vscode.git/clone?url=${encodeURIComponent(t.toString(!0))}`));try{const r=l.extensions.getExtension("vscode.git");if(r)await(r==null?void 0:r.activate()),await l.commands.executeCommand("git.clone",t.toString(!0));else throw new Error("Git extension not found")}catch(r){q.error(r,"Unable to clone repository")}}createBranch(e,t,r,n){return this.getRepositoryProvider(e).createBranch(e,t,r,n)}createCommit(e,t,r,n){return this.getRepositoryProvider(e).createCommit(e,t,r,n)}createPullRequest(e,t,r,n,i){return this.getRepositoryProvider(e).createPullRequest(e,t,r,n,i)}fetch(e,t){return this.getRepositoryProvider(e).fetch(e,t)}fork(e){return this.getRepositoryProvider(e).fork(e)}getBranches(e,t){return this.getRepositoryProvider(e).getBranches(e,t)}getCommit(e,t){return this.getRepositoryProvider(e).getCommit(e,t)}getCommits(e,t){var r;return(r=this.getRepositoryProvider(e))==null?void 0:r.getCommits(e,t)}getFileContent(e,t,r){return this.getRepositoryProvider(e).getFileContent(e,t,r)}getFork(e){return this.getRepositoryProvider(e).getFork(e)}async getIncomingChanges(e){var t,r,n;return(n=(r=(t=this.getRepositoryProvider(e)).getIncomingChanges)==null?void 0:r.call(t,e))!=null?n:[]}getPullRequest(e,t){return this.getRepositoryProvider(e).getPullRequest(e,t)}getTags(e,t){return this.getRepositoryProvider(e).getTags(e,t)}async getTarGz(e){var t,r;return(r=(t=this.getRepositoryProvider(e)).getTarGz)==null?void 0:r.call(t,e)}pushCommit(e,t,r,n){return this.getRepositoryProvider(e).pushCommit(e,t,r,n)}switchTo(e,t,r){return this.getRepositoryProvider(e).switchTo(e,t,r)}async sync(e,t,r){const n=this._repositories.get(Y(e));n&&this._onDidChangeRepository.fire({repository:n,state:{syncing:!0}});try{return await this.getRepositoryProvider(e).sync(e,t,{conflictResolution:0,...r})}finally{n&&this._onDidChangeRepository.fire({repository:n,state:{syncing:!1}})}}stat(e){return this.getFileSystemProvider(e).stat(e)}readDirectory(e){return this.getFileSystemProvider(e).readDirectory(e)}readFile(e){return this.getFileSystemProvider(e).readFile(e)}provideFileSearchResults(e,t,r){return this.getFileSystemProvider(t.folder).provideFileSearchResults(e,t,r)}provideTextSearchResults(e,t,r,n){return this.getFileSystemProvider(t.folder).provideTextSearchResults(e,t,r,n)}static decodeAuthority(e,t){const[r,n]=e.authority.split(je.authoritySeparator);let i;if(n)try{const o=JSON.parse(Bp(n));i=t?t(o):o}catch{}return{scheme:r,metadata:i}}static encodeAuthority(e,t){const r=t?`${je.authoritySeparator}${Lp(JSON.stringify(t))}`:"";return`${e}${r}`}static getProviderId(e){const{authority:t}=e,r=t.indexOf(je.authoritySeparator);return r!==-1?t.substr(0,r):t}static isCanonicalUri(e){return e.authority.indexOf(je.authoritySeparator)===-1}};let Fe=je;Fe.scheme="vscode-vfs",Fe.authoritySeparator="+",Fe.baseVirtualWorkspaceUri=l.Uri.parse(`${je.scheme}://`),Gp([xt()],Fe.prototype,"getMetadataCore",1);function Mt(){}Mt.prototype={diff:function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=n.callback;typeof n=="function"&&(i=n,n={}),this.options=n;var o=this;function a(w){return i?(setTimeout(function(){i(void 0,w)},0),!0):w}t=this.castInput(t),r=this.castInput(r),t=this.removeEmpty(this.tokenize(t)),r=this.removeEmpty(this.tokenize(r));var s=r.length,u=t.length,c=1,d=s+u,f=[{newPos:-1,components:[]}],h=this.extractCommon(f[0],r,t,0);if(f[0].newPos+1>=s&&h+1>=u)return a([{value:this.join(r),count:r.length}]);function p(){for(var w=-1*c;w<=c;w+=2){var _=void 0,D=f[w-1],C=f[w+1],U=(C?C.newPos:0)-w;D&&(f[w-1]=void 0);var F=D&&D.newPos+1<s,z=C&&0<=U&&U<u;if(!F&&!z){f[w]=void 0;continue}if(!F||z&&D.newPos<C.newPos?(_=Kp(C),o.pushComponent(_.components,void 0,!0)):(_=D,_.newPos++,o.pushComponent(_.components,!0,void 0)),U=o.extractCommon(_,r,t,w),_.newPos+1>=s&&U+1>=u)return a(Zp(o,_.components,r,t,o.useLongestToken));f[w]=_}c++}if(i)(function w(){setTimeout(function(){if(c>d)return i();p()||w()},0)})();else for(;c<=d;){var g=p();if(g)return g}},pushComponent:function(t,r,n){var i=t[t.length-1];i&&i.added===r&&i.removed===n?t[t.length-1]={count:i.count+1,added:r,removed:n}:t.push({count:1,added:r,removed:n})},extractCommon:function(t,r,n,i){for(var o=r.length,a=n.length,s=t.newPos,u=s-i,c=0;s+1<o&&u+1<a&&this.equals(r[s+1],n[u+1]);)s++,u++,c++;return c&&t.components.push({count:c}),t.newPos=s,u},equals:function(t,r){return this.options.comparator?this.options.comparator(t,r):t===r||this.options.ignoreCase&&t.toLowerCase()===r.toLowerCase()},removeEmpty:function(t){for(var r=[],n=0;n<t.length;n++)t[n]&&r.push(t[n]);return r},castInput:function(t){return t},tokenize:function(t){return t.split("")},join:function(t){return t.join("")}};function Zp(e,t,r,n,i){for(var o=0,a=t.length,s=0,u=0;o<a;o++){var c=t[o];if(c.removed){if(c.value=e.join(n.slice(u,u+c.count)),u+=c.count,o&&t[o-1].added){var f=t[o-1];t[o-1]=t[o],t[o]=f}}else{if(!c.added&&i){var d=r.slice(s,s+c.count);d=d.map(function(p,g){var w=n[u+g];return w.length>p.length?w:p}),c.value=e.join(d)}else c.value=e.join(r.slice(s,s+c.count));s+=c.count,c.added||(u+=c.count)}}var h=t[a-1];return a>1&&typeof h.value=="string"&&(h.added||h.removed)&&e.equals("",h.value)&&(t[a-2].value+=h.value,t.pop()),t}function Kp(e){return{newPos:e.newPos,components:e.components.slice(0)}}var Qp=new Mt;function $y(e,t,r){return Qp.diff(e,t,r)}function Ps(e,t){if(typeof e=="function")t.callback=e;else if(e)for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}var Is=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Fs=/\S/,pi=new Mt;pi.equals=function(e,t){return this.options.ignoreCase&&(e=e.toLowerCase(),t=t.toLowerCase()),e===t||this.options.ignoreWhitespace&&!Fs.test(e)&&!Fs.test(t)},pi.tokenize=function(e){for(var t=e.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),r=0;r<t.length-1;r++)!t[r+1]&&t[r+2]&&Is.test(t[r])&&Is.test(t[r+2])&&(t[r]+=t[r+2],t.splice(r+1,2),r--);return t};function Oy(e,t,r){return r=Ps(r,{ignoreWhitespace:!0}),pi.diff(e,t,r)}function Uy(e,t,r){return pi.diff(e,t,r)}var gi=new Mt;gi.tokenize=function(e){var t=[],r=e.split(/(\n|\r\n)/);r[r.length-1]||r.pop();for(var n=0;n<r.length;n++){var i=r[n];n%2&&!this.options.newlineIsToken?t[t.length-1]+=i:(this.options.ignoreWhitespace&&(i=i.trim()),t.push(i))}return t};function Xp(e,t,r){return gi.diff(e,t,r)}function Ny(e,t,r){var n=Ps(r,{ignoreWhitespace:!0});return gi.diff(e,t,n)}var $s=new Mt;$s.tokenize=function(e){return e.split(/(\S.+?[.!?])(?=\s+|$)/)};function My(e,t,r){return $s.diff(e,t,r)}var Os=new Mt;Os.tokenize=function(e){return e.split(/([{}:;,]|\s+)/)};function Ly(e,t,r){return Os.diff(e,t,r)}function mi(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?mi=function(t){return typeof t}:mi=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mi(e)}function Lt(e){return Jp(e)||Yp(e)||eg(e)||tg()}function Jp(e){if(Array.isArray(e))return _o(e)}function Yp(e){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(e))return Array.from(e)}function eg(e,t){if(!!e){if(typeof e=="string")return _o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _o(e,t)}}function _o(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function tg(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var rg=Object.prototype.toString,Fr=new Mt;Fr.useLongestToken=!0,Fr.tokenize=gi.tokenize,Fr.castInput=function(e){var t=this.options,r=t.undefinedReplacement,n=t.stringifyReplacer,i=n===void 0?function(o,a){return typeof a=="undefined"?r:a}:n;return typeof e=="string"?e:JSON.stringify(So(e,null,null,i),i,"  ")},Fr.equals=function(e,t){return Mt.prototype.equals.call(Fr,e.replace(/,([\r\n])/g,"$1"),t.replace(/,([\r\n])/g,"$1"))};function By(e,t,r){return Fr.diff(e,t,r)}function So(e,t,r,n,i){t=t||[],r=r||[],n&&(e=n(i,e));var o;for(o=0;o<t.length;o+=1)if(t[o]===e)return r[o];var a;if(rg.call(e)==="[object Array]"){for(t.push(e),a=new Array(e.length),r.push(a),o=0;o<e.length;o+=1)a[o]=So(e[o],t,r,n,i);return t.pop(),r.pop(),a}if(e&&e.toJSON&&(e=e.toJSON()),mi(e)==="object"&&e!==null){t.push(e),a={},r.push(a);var s=[],u;for(u in e)e.hasOwnProperty(u)&&s.push(u);for(s.sort(),o=0;o<s.length;o+=1)u=s[o],a[u]=So(e[u],t,r,n,u);t.pop(),r.pop()}else a=e;return a}var vi=new Mt;vi.tokenize=function(e){return e.slice()},vi.join=vi.removeEmpty=function(e){return e};function Hy(e,t,r){return vi.diff(e,t,r)}function wi(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=e.split(/\r\n|[\n\v\f\r\x85]/),n=e.match(/\r\n|[\n\v\f\r\x85]/g)||[],i=[],o=0;function a(){var c={};for(i.push(c);o<r.length;){var d=r[o];if(/^(\-\-\-|\+\+\+|@@)\s/.test(d))break;var f=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(d);f&&(c.index=f[1]),o++}for(s(c),s(c),c.hunks=[];o<r.length;){var h=r[o];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(h))break;if(/^@@/.test(h))c.hunks.push(u());else{if(h&&t.strict)throw new Error("Unknown line "+(o+1)+" "+JSON.stringify(h));o++}}}function s(c){var d=/^(---|\+\+\+)\s+(.*)$/.exec(r[o]);if(d){var f=d[1]==="---"?"old":"new",h=d[2].split("	",2),p=h[0].replace(/\\\\/g,"\\");/^".*"$/.test(p)&&(p=p.substr(1,p.length-2)),c[f+"FileName"]=p,c[f+"Header"]=(h[1]||"").trim(),o++}}function u(){var c=o,d=r[o++],f=d.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),h={oldStart:+f[1],oldLines:typeof f[2]=="undefined"?1:+f[2],newStart:+f[3],newLines:typeof f[4]=="undefined"?1:+f[4],lines:[],linedelimiters:[]};h.oldLines===0&&(h.oldStart+=1),h.newLines===0&&(h.newStart+=1);for(var p=0,g=0;o<r.length&&!(r[o].indexOf("--- ")===0&&o+2<r.length&&r[o+1].indexOf("+++ ")===0&&r[o+2].indexOf("@@")===0);o++){var w=r[o].length==0&&o!=r.length-1?" ":r[o][0];if(w==="+"||w==="-"||w===" "||w==="\\")h.lines.push(r[o]),h.linedelimiters.push(n[o]||`
`),w==="+"?p++:w==="-"?g++:w===" "&&(p++,g++);else break}if(!p&&h.newLines===1&&(h.newLines=0),!g&&h.oldLines===1&&(h.oldLines=0),t.strict){if(p!==h.newLines)throw new Error("Added line count did not match for hunk at line "+(c+1));if(g!==h.oldLines)throw new Error("Removed line count did not match for hunk at line "+(c+1))}return h}for(;o<r.length;)a();return i}function ng(e,t,r){var n=!0,i=!1,o=!1,a=1;return function s(){if(n&&!o){if(i?a++:n=!1,e+a<=r)return a;o=!0}if(!i)return o||(n=!0),t<=e-a?-a++:(i=!0,s())}}function Us(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof t=="string"&&(t=wi(t)),Array.isArray(t)){if(t.length>1)throw new Error("applyPatch only works with a single input.");t=t[0]}var n=e.split(/\r\n|[\n\v\f\r\x85]/),i=e.match(/\r\n|[\n\v\f\r\x85]/g)||[],o=t.hunks,a=r.compareLine||function(Vt,lt,St,Ct){return lt===Ct},s=0,u=r.fuzzFactor||0,c=0,d=0,f,h;function p(Vt,lt){for(var St=0;St<Vt.lines.length;St++){var Ct=Vt.lines[St],an=Ct.length>0?Ct[0]:" ",io=Ct.length>0?Ct.substr(1):Ct;if(an===" "||an==="-"){if(!a(lt+1,n[lt],an,io)&&(s++,s>u))return!1;lt++}}return!0}for(var g=0;g<o.length;g++){for(var w=o[g],_=n.length-w.oldLines,D=0,C=d+w.oldStart-1,U=ng(C,c,_);D!==void 0;D=U())if(p(w,C+D)){w.offset=d+=D;break}if(D===void 0)return!1;c=w.offset+w.oldStart+w.oldLines}for(var F=0,z=0;z<o.length;z++){var ue=o[z],Q=ue.oldStart+ue.offset+F-1;F+=ue.newLines-ue.oldLines;for(var de=0;de<ue.lines.length;de++){var we=ue.lines[de],he=we.length>0?we[0]:" ",pe=we.length>0?we.substr(1):we,st=ue.linedelimiters[de];if(he===" ")Q++;else if(he==="-")n.splice(Q,1),i.splice(Q,1);else if(he==="+")n.splice(Q,0,pe),i.splice(Q,0,st),Q++;else if(he==="\\"){var pt=ue.lines[de-1]?ue.lines[de-1][0]:null;pt==="+"?f=!0:pt==="-"&&(h=!0)}}}if(f)for(;!n[n.length-1];)n.pop(),i.pop();else h&&(n.push(""),i.push(`
`));for(var gt=0;gt<n.length-1;gt++)n[gt]=n[gt]+i[gt];return n.join("")}function Wy(e,t){typeof e=="string"&&(e=wi(e));var r=0;function n(){var i=e[r++];if(!i)return t.complete();t.loadFile(i,function(o,a){if(o)return t.complete(o);var s=Us(a,i,t);t.patched(i,s,function(u){if(u)return t.complete(u);n()})})}n()}function Ns(e,t,r,n,i,o,a){a||(a={}),typeof a.context=="undefined"&&(a.context=4);var s=Xp(r,n,a);s.push({value:"",lines:[]});function u(D){return D.map(function(C){return" "+C})}for(var c=[],d=0,f=0,h=[],p=1,g=1,w=function(C){var U=s[C],F=U.lines||U.value.replace(/\n$/,"").split(`
`);if(U.lines=F,U.added||U.removed){var z;if(!d){var ue=s[C-1];d=p,f=g,ue&&(h=a.context>0?u(ue.lines.slice(-a.context)):[],d-=h.length,f-=h.length)}(z=h).push.apply(z,Lt(F.map(function(gt){return(U.added?"+":"-")+gt}))),U.added?g+=F.length:p+=F.length}else{if(d)if(F.length<=a.context*2&&C<s.length-2){var Q;(Q=h).push.apply(Q,Lt(u(F)))}else{var de,we=Math.min(F.length,a.context);(de=h).push.apply(de,Lt(u(F.slice(0,we))));var he={oldStart:d,oldLines:p-d+we,newStart:f,newLines:g-f+we,lines:h};if(C>=s.length-2&&F.length<=a.context){var pe=/\n$/.test(r),st=/\n$/.test(n),pt=F.length==0&&h.length>he.oldLines;!pe&&pt&&r.length>0&&h.splice(he.oldLines,0,"\\ No newline at end of file"),(!pe&&!pt||!st)&&h.push("\\ No newline at end of file")}c.push(he),d=0,f=0,h=[]}p+=F.length,g+=F.length}},_=0;_<s.length;_++)w(_);return{oldFileName:e,newFileName:t,oldHeader:i,newHeader:o,hunks:c}}function ig(e){var t=[];e.oldFileName==e.newFileName&&t.push("Index: "+e.oldFileName),t.push("==================================================================="),t.push("--- "+e.oldFileName+(typeof e.oldHeader=="undefined"?"":"	"+e.oldHeader)),t.push("+++ "+e.newFileName+(typeof e.newHeader=="undefined"?"":"	"+e.newHeader));for(var r=0;r<e.hunks.length;r++){var n=e.hunks[r];n.oldLines===0&&(n.oldStart-=1),n.newLines===0&&(n.newStart-=1),t.push("@@ -"+n.oldStart+","+n.oldLines+" +"+n.newStart+","+n.newLines+" @@"),t.push.apply(t,n.lines)}return t.join(`
`)+`
`}function og(e,t,r,n,i,o,a){return ig(Ns(e,t,r,n,i,o,a))}function ag(e,t,r,n,i,o){return og(e,e,t,r,n,i,o)}function sg(e,t){return e.length!==t.length?!1:Co(e,t)}function Co(e,t){if(t.length>e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function cg(e){var t=ko(e.lines),r=t.oldLines,n=t.newLines;r!==void 0?e.oldLines=r:delete e.oldLines,n!==void 0?e.newLines=n:delete e.newLines}function zy(e,t,r){e=Ms(e,r),t=Ms(t,r);var n={};(e.index||t.index)&&(n.index=e.index||t.index),(e.newFileName||t.newFileName)&&(Ls(e)?Ls(t)?(n.oldFileName=yi(n,e.oldFileName,t.oldFileName),n.newFileName=yi(n,e.newFileName,t.newFileName),n.oldHeader=yi(n,e.oldHeader,t.oldHeader),n.newHeader=yi(n,e.newHeader,t.newHeader)):(n.oldFileName=e.oldFileName,n.newFileName=e.newFileName,n.oldHeader=e.oldHeader,n.newHeader=e.newHeader):(n.oldFileName=t.oldFileName||e.oldFileName,n.newFileName=t.newFileName||e.newFileName,n.oldHeader=t.oldHeader||e.oldHeader,n.newHeader=t.newHeader||e.newHeader)),n.hunks=[];for(var i=0,o=0,a=0,s=0;i<e.hunks.length||o<t.hunks.length;){var u=e.hunks[i]||{oldStart:Infinity},c=t.hunks[o]||{oldStart:Infinity};if(Bs(u,c))n.hunks.push(Hs(u,a)),i++,s+=u.newLines-u.oldLines;else if(Bs(c,u))n.hunks.push(Hs(c,s)),o++,a+=c.newLines-c.oldLines;else{var d={oldStart:Math.min(u.oldStart,c.oldStart),oldLines:0,newStart:Math.min(u.newStart+a,c.oldStart+s),newLines:0,lines:[]};lg(d,u.oldStart,u.lines,c.oldStart,c.lines),o++,i++,n.hunks.push(d)}}return n}function Ms(e,t){if(typeof e=="string"){if(/^@@/m.test(e)||/^Index:/m.test(e))return wi(e)[0];if(!t)throw new Error("Must provide a base reference or pass in a patch");return Ns(void 0,void 0,t,e)}return e}function Ls(e){return e.newFileName&&e.newFileName!==e.oldFileName}function yi(e,t,r){return t===r?t:(e.conflict=!0,{mine:t,theirs:r})}function Bs(e,t){return e.oldStart<t.oldStart&&e.oldStart+e.oldLines<t.oldStart}function Hs(e,t){return{oldStart:e.oldStart,oldLines:e.oldLines,newStart:e.newStart+t,newLines:e.newLines,lines:e.lines}}function lg(e,t,r,n,i){var o={offset:t,lines:r,index:0},a={offset:n,lines:i,index:0};for(zs(e,o,a),zs(e,a,o);o.index<o.lines.length&&a.index<a.lines.length;){var s=o.lines[o.index],u=a.lines[a.index];if((s[0]==="-"||s[0]==="+")&&(u[0]==="-"||u[0]==="+"))ug(e,o,a);else if(s[0]==="+"&&u[0]===" "){var c;(c=e.lines).push.apply(c,Lt(lr(o)))}else if(u[0]==="+"&&s[0]===" "){var d;(d=e.lines).push.apply(d,Lt(lr(a)))}else s[0]==="-"&&u[0]===" "?Ws(e,o,a):u[0]==="-"&&s[0]===" "?Ws(e,a,o,!0):s===u?(e.lines.push(s),o.index++,a.index++):xo(e,lr(o),lr(a))}js(e,o),js(e,a),cg(e)}function ug(e,t,r){var n=lr(t),i=lr(r);if(qs(n)&&qs(i)){if(Co(n,i)&&Vs(r,n,n.length-i.length)){var o;(o=e.lines).push.apply(o,Lt(n));return}else if(Co(i,n)&&Vs(t,i,i.length-n.length)){var a;(a=e.lines).push.apply(a,Lt(i));return}}else if(sg(n,i)){var s;(s=e.lines).push.apply(s,Lt(n));return}xo(e,n,i)}function Ws(e,t,r,n){var i=lr(t),o=dg(r,i);if(o.merged){var a;(a=e.lines).push.apply(a,Lt(o.merged))}else xo(e,n?o:i,n?i:o)}function xo(e,t,r){e.conflict=!0,e.lines.push({conflict:!0,mine:t,theirs:r})}function zs(e,t,r){for(;t.offset<r.offset&&t.index<t.lines.length;){var n=t.lines[t.index++];e.lines.push(n),t.offset++}}function js(e,t){for(;t.index<t.lines.length;){var r=t.lines[t.index++];e.lines.push(r)}}function lr(e){for(var t=[],r=e.lines[e.index][0];e.index<e.lines.length;){var n=e.lines[e.index];if(r==="-"&&n[0]==="+"&&(r="+"),r===n[0])t.push(n),e.index++;else break}return t}function dg(e,t){for(var r=[],n=[],i=0,o=!1,a=!1;i<t.length&&e.index<e.lines.length;){var s=e.lines[e.index],u=t[i];if(u[0]==="+")break;if(o=o||s[0]!==" ",n.push(u),i++,s[0]==="+")for(a=!0;s[0]==="+";)r.push(s),s=e.lines[++e.index];u.substr(1)===s.substr(1)?(r.push(s),e.index++):a=!0}if((t[i]||"")[0]==="+"&&o&&(a=!0),a)return r;for(;i<t.length;)n.push(t[i++]);return{merged:n,changes:r}}function qs(e){return e.reduce(function(t,r){return t&&r[0]==="-"},!0)}function Vs(e,t,r){for(var n=0;n<r;n++){var i=t[t.length-r+n].substr(1);if(e.lines[e.index+n]!==" "+i)return!1}return e.index+=r,!0}function ko(e){var t=0,r=0;return e.forEach(function(n){if(typeof n!="string"){var i=ko(n.mine),o=ko(n.theirs);t!==void 0&&(i.oldLines===o.oldLines?t+=i.oldLines:t=void 0),r!==void 0&&(i.newLines===o.newLines?r+=i.newLines:r=void 0)}else r!==void 0&&(n[0]==="+"||n[0]===" ")&&r++,t!==void 0&&(n[0]==="-"||n[0]===" ")&&t++}),{oldLines:t,newLines:r}}function jy(e){for(var t=[],r,n,i=0;i<e.length;i++)r=e[i],r.added?n=1:r.removed?n=-1:n=0,t.push([n,r.value]);return t}function qy(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];n.added?t.push("<ins>"):n.removed&&t.push("<del>"),t.push(hg(n.value)),n.added?t.push("</ins>"):n.removed&&t.push("</del>")}return t.join("")}function hg(e){var t=e;return t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/"/g,"&quot;"),t}function Eo(e,t){let r={};for(let o=0;o<t.length;o++){const a=t[o];r[a]?r[a].push(o):r[a]=[o]}let i=[{buffer1index:-1,buffer2index:-1,chain:null}];for(let o=0;o<e.length;o++){const a=e[o],s=r[a]||[];let u=0,c=i[0];for(let d=0;d<s.length;d++){const f=s[d];let h;for(h=u;h<i.length&&!(i[h].buffer2index<f&&(h===i.length-1||i[h+1].buffer2index>f));h++);if(h<i.length){const p={buffer1index:o,buffer2index:f,chain:i[h]};if(u===i.length?i.push(c):i[u]=c,u=h+1,c=p,u===i.length)break}}i[u]=c}return i[i.length-1]}function fg(e,t){const r=Eo(e,t);let n=[],i=e.length,o=t.length,a={common:[]};function s(){a.common.length&&(a.common.reverse(),n.push(a),a={common:[]})}for(let u=r;u!==null;u=u.chain){let c={buffer1:[],buffer2:[]};for(;--i>u.buffer1index;)c.buffer1.push(e[i]);for(;--o>u.buffer2index;)c.buffer2.push(t[o]);(c.buffer1.length||c.buffer2.length)&&(s(),c.buffer1.reverse(),c.buffer2.reverse(),n.push(c)),i>=0&&a.common.push(e[i])}return s(),n.reverse(),n}function Gs(e,t){const r=Eo(e,t);let n=[],i=e.length,o=t.length;for(let a=r;a!==null;a=a.chain){const s=i-a.buffer1index-1,u=o-a.buffer2index-1;i=a.buffer1index,o=a.buffer2index,(s||u)&&n.push({buffer1:[i+1,s],buffer1Content:e.slice(i+1,i+1+s),buffer2:[o+1,u],buffer2Content:t.slice(o+1,o+1+u)})}return n.reverse(),n}function Vy(e,t){const r=Eo(e,t);let n=[],i=e.length,o=t.length;function a(s,u,c){let d=[];for(let f=0;f<c;f++)d.push(s[u+f]);return{offset:u,length:c,chunk:d}}for(let s=r;s!==null;s=s.chain){const u=i-s.buffer1index-1,c=o-s.buffer2index-1;i=s.buffer1index,o=s.buffer2index,(u||c)&&n.push({buffer1:a(e,s.buffer1index+1,u),buffer2:a(t,s.buffer2index+1,c)})}return n.reverse(),n}function pg(e,t,r){let n=[];function i(u,c){n.push({ab:c,oStart:u.buffer1[0],oLength:u.buffer1[1],abStart:u.buffer2[0],abLength:u.buffer2[1]})}Gs(t,e).forEach(u=>i(u,"a")),Gs(t,r).forEach(u=>i(u,"b")),n.sort((u,c)=>u.oStart-c.oStart);let o=[],a=0;function s(u){u>a&&(o.push({stable:!0,buffer:"o",bufferStart:a,bufferLength:u-a,bufferContent:t.slice(a,u)}),a=u)}for(;n.length;){let u=n.shift(),c=u.oStart,d=u.oStart+u.oLength,f=[u];for(s(c);n.length;){const h=n[0],p=h.oStart;if(p>d)break;d=Math.max(d,p+h.oLength),f.push(n.shift())}if(f.length===1){if(u.abLength>0){const h=u.ab==="a"?e:r;o.push({stable:!0,buffer:u.ab,bufferStart:u.abStart,bufferLength:u.abLength,bufferContent:h.slice(u.abStart,u.abStart+u.abLength)})}}else{let h={a:[e.length,-1,t.length,-1],b:[r.length,-1,t.length,-1]};for(;f.length;){u=f.shift();const C=u.oStart,U=C+u.oLength,F=u.abStart,z=F+u.abLength;let ue=h[u.ab];ue[0]=Math.min(F,ue[0]),ue[1]=Math.max(z,ue[1]),ue[2]=Math.min(C,ue[2]),ue[3]=Math.max(U,ue[3])}const p=h.a[0]+(c-h.a[2]),g=h.a[1]+(d-h.a[3]),w=h.b[0]+(c-h.b[2]),_=h.b[1]+(d-h.b[3]);let D={stable:!1,aStart:p,aLength:g-p,aContent:e.slice(p,g),oStart:c,oLength:d-c,oContent:t.slice(c,d),bStart:w,bLength:_-w,bContent:r.slice(w,_)};o.push(D)}a=d}return s(t.length),o}function Ro(e,t,r,n){n=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/},n);const o=typeof e=="string",a=typeof t=="string",s=typeof r=="string";o&&(e=e.split(n.stringSeparator)),a&&(t=t.split(n.stringSeparator)),s&&(r=r.split(n.stringSeparator));let u=[];const c=pg(e,t,r);let d=[];function f(){d.length&&u.push({ok:d}),d=[]}function h(p,g){if(p.length!==g.length)return!1;for(let w=0;w<p.length;w++)if(p[w]!==g[w])return!1;return!0}return c.forEach(p=>{p.stable?d.push(...p.bufferContent):n.excludeFalseConflicts&&h(p.aContent,p.bContent)?d.push(...p.aContent):(f(),u.push({conflict:{a:p.aContent,aIndex:p.aStart,o:p.oContent,oIndex:p.oStart,b:p.bContent,bIndex:p.bStart}}))}),f(),u}function Gy(e,t,r,n){n=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/,label:{}},n);const o=Ro(e,t,r,n);let a=!1,s=[];return o.forEach(u=>{u.ok?s=s.concat(u.ok):u.conflict&&(a=!0,s.push(`<<<<<<<${n.label.a?` ${n.label.a}`:""}`),s=s.concat(u.conflict.a),s.push(`|||||||${n.label.o?` ${n.label.o}`:""}`),s=s.concat(u.conflict.o),s.push("======="),s=s.concat(u.conflict.b),s.push(`>>>>>>>${n.label.b?` ${n.label.b}`:""}`))}),{conflict:a,result:s}}function gg(e,t,r,n){n=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/},n);const o=Ro(e,t,r,n);let a=!1,s=[];for(let u=0;u<o.length;u++){const c=o[u];c.ok?s=s.concat(c.ok):(a=!0,s=s.concat([`
<<<<<<<<<
`],c.conflict.a,[`
=========
`],c.conflict.b,[`
>>>>>>>>>
`]))}return{conflict:a,result:s}}function Zy(e,t,r,n){n=Object.assign({excludeFalseConflicts:!1,stringSeparator:/\s+/},n);const o=Ro(e,t,r,n);let a=!1,s=[];for(let u=0;u<o.length;u++){const c=o[u];if(c.ok)s=s.concat(c.ok);else{const d=fg(c.conflict.a,c.conflict.b);for(let f=0;f<d.length;f++){let h=d[f];h.common?s=s.concat(h.common):(a=!0,s=s.concat([`
<<<<<<<<<
`],h.buffer1,[`
=========
`],h.buffer2,[`
>>>>>>>>>
`]))}}}return{conflict:a,result:s}}function Ky(e,t){let r=[],n=0;function i(o){for(;n<o;)r.push(e[n]),n++}for(let o=0;o<t.length;o++){let a=t[o];i(a.buffer1.offset);for(let s=0;s<a.buffer2.chunk.length;s++)r.push(a.buffer2.chunk[s]);n+=a.buffer1.length}return i(e.length),r}function Qy(e){return e.map(t=>({buffer1:{offset:t.buffer1.offset,length:t.buffer1.length},buffer2:{chunk:t.buffer2.chunk}}))}function Xy(e){return e.map(t=>({buffer1:t.buffer2,buffer2:t.buffer1}))}function Zs(e,t,r){return Us(e,t,r)}function Ks(e,t,r){let n=`
`;const i=e.match(/(?:\r?\n)/g);if(i!==null&&i.length!==0){const u=i.filter(c=>c===`\r
`).length;n=u>i.length-u?`\r
`:`
`}const o=gg(e,t,r,{excludeFalseConflicts:!0,stringSeparator:/\r?\n/}),a=o.result;let s=!1;if(o.conflict){let u;const c=[];let d=0;for(const p of a)p===`
<<<<<<<<<
`?u={start:d,separator:d,end:d}:p===`
=========
`?u.separator=d:p===`
>>>>>>>>>
`&&(u.end=d,c.push(u)),d++;let f=0,h=0;for(const p of c)a.splice(p.start-f,1),f++,h=p.end-p.separator+1,a.splice(p.separator-f,h),f+=h;c.length&&(s=!0)}return{conflicts:s,mergedContent:a.join(n)}}function Do(e){const t=performance.now()*.001;let r=Math.floor(t),n=Math.floor(t%1*1e9);return e!==void 0&&(r=r-e[0],n=n-e[1],n<0&&(r--,n+=1e9)),[r,n]}let Ao=0;function mg(){return Ao===Number.MAX_SAFE_INTEGER&&(Ao=0),++Ao}const ur=class{constructor(e,t,...r){this.context=e,this.instance=`[${mg().toString().padStart(5)}] `;var n,i,o,a,s;let u;if(typeof(t==null?void 0:t.log)=="boolean"?u={}:u=t==null?void 0:t.log,this.logLevel=(n=t==null?void 0:t.logLevel)!=null?n:De.Debug,this.time=Do(),u){if(!q.enabled(this.logLevel))return;r.length?To(this.logLevel,`${this.instance}${(i=u.prefix)!=null?i:""}${e}${(o=u.message)!=null?o:""}`,...r):To(this.logLevel,`${this.instance}${(a=u.prefix)!=null?a:""}${e}${(s=u.message)!=null?s:""}`)}}log(e){this.logCore(this.context,e)}restart(e){this.logCore(this.context,e),this.time=Do()}stop(e){this.restart(e)}logCore(e,t){var r,n,i,o;if(!q.enabled(this.logLevel))return;const[a,s]=Do(this.time),u=a*1e3+Math.floor(s/1e6);To(u>500?De.Warn:this.logLevel,`${this.instance}${(r=t==null?void 0:t.prefix)!=null?r:""}${e}${(n=t==null?void 0:t.message)!=null?n:""}${(i=t==null?void 0:t.took)!=null?i:" \u2022 took "}${u} ms${(o=t==null?void 0:t.suffix)!=null?o:""}`)}static start(e,t,...r){var n;(n=ur.watches.get(e))==null||n.log(),ur.watches.set(e,new ur(e,t,...r))}static log(e,t){var r;(r=ur.watches.get(e))==null||r.log(t)}static restart(e,t){const r=ur.watches.get(e);if(!r)throw new Error(`Unable to restart ${e} as it has never been started`);r.restart(t)}static stop(e,t){var r;(r=ur.watches.get(e))==null||r.stop(t)}};let Ae=ur;Ae.watches=new Map;function To(e,t,...r){switch(e){case De.Warn:q.warn(t,...r);break;case De.Info:q.log(t,...r);break;default:q.debug(t,...r);break}}let Po=0;function vg(){return Po===Number.MAX_SAFE_INTEGER&&(Po=0),String(++Po)}class wg{constructor(){this.id=vg()}async synchronize(t){let r;const n=this.promise;this.promise=new Promise(i=>r=i),await n;try{return await t()}finally{r()}}}class bi{constructor(t){this.lock=new wg,this.readers=new Set,this.counter=0,this._id=t!=null?t:this.lock.id}get id(){return this._id}getNextCounter(){return this.counter===Number.MAX_SAFE_INTEGER&&(this.counter=0),++this.counter}async synchronizeRead(t,r){let n;const i=new Ae(`Reader(${this.getNextCounter()}|${this.id})`,{log:{prefix:"(A) ",message:r?` \u2022 ${r}`:""}});let o;await this.lock.synchronize(async()=>{this.writer&&await this.writer,o=new Promise(a=>n=a),this.readers.add(o)}),i.restart({prefix:"(L) ",suffix:r?` \u2022 ${r}`:"",took:" waited for "});try{return await t()}finally{i.stop({prefix:"(U) ",suffix:r?` \u2022 ${r}`:"",took:" locked for "}),o!==void 0&&this.readers.delete(o),n()}}async synchronizeWrite(t,r){let n;const i=new Ae(`Writer(${this.getNextCounter()}|${this.id})`,{log:{prefix:"(A) ",message:r?` \u2022 ${r}`:""}});await this.lock.synchronize(async()=>{if(this.writer&&await this.writer,this.readers.size){const o=[...this.readers];this.readers.clear(),await Promise.all(o)}this.writer=new Promise(o=>n=o)}),i.restart({prefix:"(L) ",suffix:r?` \u2022 ${r}`:"",took:" waited for "});try{return await t()}finally{i.stop({prefix:"(U) ",suffix:r?` \u2022 ${r}`:"",took:" locked for "}),n(),this.writer=void 0}}}class yg{constructor(){this.locks=new Map}async synchronizeRead(t,r,n){let i=this.locks.get(t);return i===void 0&&(i=new bi(String(t)),this.locks.set(t,i)),i.synchronizeRead(r,n)}async synchronizeWrite(t,r,n){let i=this.locks.get(t);return i===void 0&&(i=new bi(String(t)),this.locks.set(t,i)),i.synchronizeWrite(r,n)}}var bg=Object.defineProperty,_g=Object.getOwnPropertyDescriptor,Sg=(e,t,r,n)=>{for(var i=n>1?void 0:n?_g(t,r):t,o=e.length-1,a;o>=0;o--)(a=e[o])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&bg(t,r,i),i};const ut=(0,P.loadMessageBundle)(),Qs=`===================================================================
`,Et=new TextDecoder,Cg=new TextEncoder;var xe;(function(e){e[e.Changed=1]="Changed",e[e.Created=2]="Created",e[e.Deleted=3]="Deleted"})(xe||(xe={}));function xg(e){return e&&"type"in e&&"uri"in e&&"uri"in e&&"fileType"in e&&"revision"in e&&"timestamp"in e}function _i(e,t,r){return{type:e.type,rootUri:t,uri:r!=null?r:e.uri}}const $r=class{constructor(e,t,r,n,i){this.providerService=e,this.storageService=t,this.fileStorageService=r,this.workspaceId=n,this._onDidChange=new l.EventEmitter,this.cache=new Map,this.lock=new yg,this.scopedStores=new Map,i===void 0&&($r._instance=this,this.disposable=l.Disposable.from(this.providerService.onDidRefresh(()=>this.cache.clear())))}static get instance(){return this._instance}get onDidChange(){return this._onDidChange.event}dispose(){var e;(e=this.disposable)==null||e.dispose()}async getWorkspaceProvidersWithChanges(){var e,t;const r=new Map;for(const n of(e=l.workspace.workspaceFolders)!=null?e:[])if(n.uri.scheme===Fe.scheme&&await this.hasChanges(n.uri)){const i=(t=this.providerService.getRepository(n.uri))==null?void 0:t.provider;if(!i)continue;r.set(i.id,i)}return[...r.values()]}async hasAnyWorkspaceChanges(){var e;const t=[];for(const r of(e=l.workspace.workspaceFolders)!=null?e:[])r.uri.scheme===Fe.scheme&&await this.hasChanges(r.uri)&&t.push(r.uri);return t.length>0?t:void 0}async acceptAll(e){const t=`ChangeStore.acceptAll(${e.toString()})`;q.log(t);const r=[];await this.lock.synchronizeWrite(Y(e),async()=>{const n=await this.getWorkingOperations(e);for(const i of n){i.fileType===l.FileType.File&&await this.discardWorkingContent(e,i.uri);let o;i.type===2&&i.fileType===l.FileType.Directory&&(n.some(a=>di(a.uri,i.uri))||(o={type:3,uri:i.uri,rootUri:e})),r.push(o!=null?o:_i(i,e))}await this.discardWorkingOperations(e)},t),r.length!==0&&this._onDidChange.fire(r)}async discard(e){const t=this.providerService.getVirtualWorkspaceUri(e);if(t===void 0)return;const r=`ChangeStore.discard(${e.toString()})`;q.log(r);const n=[];await this.lock.synchronizeWrite(Y(t),async()=>this.discardCore(t,e,n),r),n.length!==0&&this._onDidChange.fire(n)}async discardCore(e,t,r){q.debug(`ChangeStore.discardCore(${t.toString()})`);const n=await this.getWorkingOperations(e);if(n.length===0)return;const i=Y(t),o=n.findIndex(f=>Y(f.uri)===i);if(o===-1)return;const[a]=n.splice(o,1);await this.saveWorkingOperations(e,n),await this.discardWorkingContent(e,t);let s;switch(a.type){case 2:s=3;break;case 3:s=2;break;default:s=a.type;break}r.push({type:s,rootUri:e,uri:t});const u=zp(t),c=Y(u),d=n.find(f=>Y(f.uri)===c);(d==null?void 0:d.type)===2&&(n.some(f=>di(f.uri,u))||await this.discardCore(e,u,r))}async discardAll(e){const t=`ChangeStore.discardAll(${e.toString()})`;q.log(t);const r=[];await this.lock.synchronizeWrite(Y(e),async()=>{const n=await this.getWorkingOperations(e);for(const i of n){i.fileType===l.FileType.File&&await this.discardWorkingContent(e,i.uri);let o;switch(i.type){case 2:o=3;break;case 3:o=2;break;default:o=i.type;break}r.push({type:o,rootUri:e,uri:i.uri})}await this.discardWorkingOperations(e)},t),r.length!==0&&this._onDidChange.fire(r)}async stage(e){const t=this.providerService.getVirtualWorkspaceUri(e);if(t===void 0)return;const r=`ChangeStore.stage(${e.toString()})`;q.log(r);const n=[];await this.lock.synchronizeWrite(Y(t),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(e,t);i!==void 0&&await this.spliceOperation(e,o,{...i,staged:!0,timestamp:Date.now()},n)},r),n.length!==0&&this._onDidChange.fire(n)}async stageAll(e){const t=`ChangeStore.stageAll(${e.toString()})`;q.log(t);const r=[];await this.lock.synchronizeWrite(Y(e),async()=>{const n=(await this.getWorkingOperations(e)).map(i=>({...i,staged:!0,timestamp:Date.now()}));n.length!==0&&(await this.saveWorkingOperations(e,n),r.push(...n.map(i=>_i(i,e))))},t),r.length!==0&&this._onDidChange.fire(r)}async unstage(e){const t=this.providerService.getVirtualWorkspaceUri(e);if(t===void 0)return;const r=`ChangeStore.unstage(${e.toString()})`;q.log(r);const n=[];await this.lock.synchronizeWrite(Y(t),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(e,t);i!==void 0&&await this.spliceOperation(e,o,{...i,staged:!1,timestamp:Date.now()},n)},r),n.length!==0&&this._onDidChange.fire(n)}async unstageAll(e){const t=`ChangeStore.unstageAll(${e.toString()})`;q.log(t);const r=[];await this.lock.synchronizeWrite(Y(e),async()=>{const n=(await this.getWorkingOperations(e)).map(i=>({...i,staged:!1,timestamp:Date.now()}));n.length!==0&&(await this.saveWorkingOperations(e,n),r.push(...n.map(i=>_i(i,e))))},t),r.length!==0&&this._onDidChange.fire(r)}async hasChanges(e){return this.lock.synchronizeRead(Y(e),async()=>(await this.getWorkingOperations(e)).length!==0,`ChangeStore.hasChanges(${e.toString()})`)}async hasMergeConflicts(e){return this.lock.synchronizeRead(Y(e),async()=>(await this.getWorkingOperations(e)).some(t=>t.conflicts!==void 0),`ChangeStore.hasMergeConflicts(${e.toString()})`)}async hasStagedChanges(e){return this.lock.synchronizeRead(Y(e),async()=>(await this.getWorkingOperations(e)).some(t=>t.staged&&t.conflicts===void 0),`ChangeStore.hasStagedChanges(${e.toString()})`)}async hasWorkingChanges(e){return this.lock.synchronizeRead(Y(e),async()=>(await this.getWorkingOperations(e)).some(t=>!t.staged&&t.conflicts===void 0),`ChangeStore.hasWorkingChanges(${e.toString()})`)}async getChange(e){const t=this.getUriScope(e);if(t)return this.getScopedChangeStore(t).getChange(e);const r=this.providerService.getVirtualRootUri(e);if(r!==void 0)return this.lock.synchronizeRead(Y(r),async()=>{const{operation:n}=await this.getWorkingOperation(e,r);return n},`ChangeStore.getChange(${e.toString()})`)}async getChanges(e,t){const r=this.getUriScope(e);return r?this.getScopedChangeStore(r).getChanges(e,t):this.lock.synchronizeRead(Y(e),async()=>{let n=await this.getWorkingOperations(e);if((t==null?void 0:t.excludeConflicts)||(t==null?void 0:t.predicate)){const{excludeConflicts:i,predicate:o}=t;n=n.filter(a=>{var s;return(!i||a.conflicts===void 0)&&((s=o==null?void 0:o(a))!=null?s:!0)})}return n},`ChangeStore.getChanges(${e.toString()})`)}async getGroupedChanges(e,t){const r=this.getUriScope(e);return r?this.getScopedChangeStore(r).getGroupedChanges(e,t):this.lock.synchronizeRead(Y(e),async()=>{var n,i;const o=await this.getWorkingOperations(e),a={conflicts:[],staged:[],working:[]};for(const s of o)!((i=(n=t==null?void 0:t.predicate)==null?void 0:n.call(t,s))!=null?i:!0)||(s.conflicts?a.conflicts.push(s):s.staged?a.staged.push(s):a.working.push(s));return a},`ChangeStore.getChangesByType(${e.toString()})`)}async getContent(e){const t=this.providerService.getVirtualRootUri(e);if(t===void 0)throw new Error(`Unable to find content for ${e.toString()}; Repository not found`);return this.lock.synchronizeRead(Y(t),async()=>{const r=Et.decode(await this.getWorkingContent(t,e));if(r!==void 0)return r;throw new Error(`Unable to find content for ${e.toString()}`)},`ChangeStore.getContent(${e.toString()}}`)}async getMergeConflicts(e,t){return this.lock.synchronizeRead(Y(e),async()=>(await this.getWorkingOperations(e)).filter(n=>{var i,o;return n.conflicts!==void 0&&((o=(i=t==null?void 0:t.predicate)==null?void 0:i.call(t,n))!=null?o:!0)}),`ChangeStore.getMergeConflicts(${e.toString()})`)}async getStagedChanges(e,t){return this.lock.synchronizeRead(Y(e),async()=>(await this.getWorkingOperations(e)).filter(n=>{var i,o;return n.staged&&n.conflicts===void 0&&((o=(i=t==null?void 0:t.predicate)==null?void 0:i.call(t,n))!=null?o:!0)}),`ChangeStore.getStagedChanges(${e.toString()})`)}async getWorkingChanges(e,t){return this.lock.synchronizeRead(Y(e),async()=>(await this.getWorkingOperations(e)).filter(n=>{var i,o;return!n.staged&&n.conflicts===void 0&&((o=(i=t==null?void 0:t.predicate)==null?void 0:i.call(t,n))!=null?o:!0)}),`ChangeStore.getWorkingChanges(${e.toString()})`)}async applyChangeset(e,t,r,n){var i;let o;xg(r)?o=r:n=n!=null?n:r,q.log(`ChangeStore.applyChangeset${e.toString()}`,t.workspaceId,t.uri,o==null?void 0:o.uri,n==null?void 0:n.save);const a=this.getScopedChangeStore(t.workspaceId),s=(i=t.patch)!=null?i:await a.createPatch(t.uri,o==null?void 0:o.uri);await this.applyPatchCore(e,s,{...n,getIncomingContent:async u=>{const c=this.getScopedUri(this.providerService.createRelativeVirtualUri(t.uri,u),t.workspaceId);return Et.decode(await l.workspace.fs.readFile(c))},merge:async(u,c,d)=>{try{const f=this.providerService.getProviderUri(u),h=Et.decode(await l.workspace.fs.readFile(f)),p=this.getScopedUri(this.providerService.createRelativeVirtualUri(t.uri,c),t.workspaceId),g=Et.decode(await l.workspace.fs.readFile(p));return{...Ks(d,h,g),baseUri:f,incomingUri:p}}catch(f){throw new Error(`Unable to apply patch to ${c}: ${f.message}`)}}})}async applyPatch(e,t,r){return q.log(`ChangeStore.applyPatch(${e.toString()})`,r==null?void 0:r.save),this.applyPatchCore(e,t,r)}async applyPatchCore(e,t,r={}){const n=`ChangeStore.applyPatchCore(${e.toString()})`;q.debug(n,r==null?void 0:r.save);const i=new l.WorkspaceEdit,o=[],a=new Map;async function s(h){var p;const g=Y(h),w=l.workspace.textDocuments.find(_=>Y(_.uri)===g);return(p=w==null?void 0:w.getText())!=null?p:Et.decode(await l.workspace.fs.readFile(h))}async function u(h){try{const p=await l.workspace.fs.stat(h);return Boolean(p)}catch{return!1}}async function c(h,p,g){let w=Zs("",g,{fuzzFactor:0});if(w===!1){if(!r.getIncomingContent)throw new Error(`Unable to apply patch to ${p}`);w=await r.getIncomingContent(p)}i.createFile(h,{overwrite:!0}),i.replace(h,new l.Range(0,0,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),w)}async function d(h,p,g,w){const _=await s(h);let D=Zs(_,g,{fuzzFactor:1});if(D===!1){if(r.merge===void 0)throw new Error(`Unable to apply patch to ${p}; Resulted in conflicts`);const C={title:ut("apply patch failed prompt confirm","Merge")},U={title:ut("apply patch failed prompt cancel","Skip File"),isCloseAffordance:!0};if(await l.window.showWarningMessage(ut("apply patch failed prompt",`Unable to apply changes to '{0}'.

Do you want to retry by merging the files?`,p),{modal:!0},C,U)!==C)return;const z=await r.merge(h,p,_);D=z.mergedContent,z.conflicts&&a.set(Y(h),{type:w,baseUri:z.baseUri,incomingUri:z.incomingUri})}i.replace(h,new l.Range(0,0,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),D)}const f=wi(t,{});for(const h of f)if(h.oldFileName==="/dev/null"){if(!h.newFileName)continue;const p=h.newFileName.startsWith("b/")?h.newFileName.substr(2):h.newFileName,g=this.providerService.createRelativeVirtualUri(e,p);o.push(Y(g)),!await u(g)?await c(g,p,h):await d(g,p,h,2)}else if(h.newFileName==="/dev/null"){if(!h.oldFileName)continue;const p=h.oldFileName.startsWith("a/")?h.oldFileName.substr(2):h.oldFileName,g=this.providerService.createRelativeVirtualUri(e,p);await u(g)&&i.deleteFile(g)}else if(h.oldFileName===h.newFileName){if(!h.newFileName)continue;const p=this.providerService.createRelativeVirtualUri(e,h.newFileName);o.push(Y(p)),!await u(p)?await c(p,h.newFileName,h):await d(p,h.newFileName,h,1)}else throw new Error(`Unable to apply patch to ${h.oldFileName}; Renames aren't currently supported`);if(await l.workspace.applyEdit(i),r.save&&o.length)for(const h of o){const p=l.workspace.textDocuments.find(g=>Y(g.uri)===h);await(p==null?void 0:p.save())}a.size&&setTimeout(async()=>{const h=[];await this.lock.synchronizeWrite(Y(e),async()=>{const p=await this.getWorkingOperations(e);if(p.length===0)return;let g=-1;for(const w of p){g++;const _=a.get(Y(w.uri));_!==void 0&&await this.spliceOperation(w.uri,g,{...w,conflicts:{baseUri:_.baseUri,incomingUri:_.incomingUri,status:[w.type,_.type]},timestamp:Date.now()},h)}},n),h.length!==0&&this._onDidChange.fire(h)},0)}async createChangeset(e){q.log(`ChangeStore.createChangeset${e.toString()})`);const t=await this.createPatch(e);return t?{workspaceId:this.workspaceId,uri:e,patch:t}:void 0}async createPatch(e,t){if(q.log(`ChangeStore.createPatch${e.toString()})`,t),t===void 0){if((await this.getWorkingOperations(e)).length===0)return"";const o=[];for(const a of await this.getWorkingOperations(e)){const s=await this.createPatchCore(e,a);o.push(s)}return o.join("")}const{operation:r}=await this.getWorkingOperation(t,e);if(r===void 0)throw new Error(`Unable to create patch for ${t.toString(!0)}`);return await this.createPatchCore(e,r)}async createPatchCore(e,t){const r=this.providerService.getRelativeFilePath(e,t.uri),n=`diff --git a/${r} b/${r}`;if(t.type===2){let u=await this.getContent(t.uri),c;!u.endsWith(`
`)&&!u.endsWith(`\r
`)?c=`
\\ No newline at end of file`:c="";let d=0;return u=u.replace(/\r?\n/g,f=>(d++,`${f}+`)),`${n}
new file mode 100644
--- /dev/null
+++ b/${r}
@@ -0,0 +1,${d} @@
+${u}${c}`}if(t.type===3){let u=Et.decode(await l.workspace.fs.readFile(this.providerService.getProviderUri(t.uri))),c=0;return u=u.replace(/\r?\n/g,d=>(c++,`${d}-`)),`${n}
deleted file mode 100644
--- a/${r}
+++ /dev/null
@@ -1,${c} +0,0 @@
-${u}`}const i=await this.getContent(t.uri),o=Et.decode(await l.workspace.fs.readFile(this.providerService.getProviderUri(t.uri))),a=ag(r,o,i),s=a.indexOf(Qs);return`${n}
${a.substr(s+Qs.length)}`}async keep(e,t){const r=this.providerService.getVirtualWorkspaceUri(e);if(r===void 0)return;const n=`ChangeStore.keep(${e.toString()})`;q.log(n,t);const i=[];await this.lock.synchronizeWrite(Y(r),async()=>{const{operation:o,index:a}=await this.getWorkingOperation(e,r);if(o===void 0)return;if(t===void 0&&o.conflicts){const[,u]=o.conflicts.status;switch(u){case 1:switch(o.type){case 1:case 2:case 3:await this.spliceOperation(e,a,{...o,conflicts:void 0,timestamp:Date.now()},i);break}break;case 2:switch(o.type){case 1:case 3:await this.spliceOperation(e,a,{...o,conflicts:void 0,timestamp:Date.now()},i);break;case 2:await this.spliceOperation(e,a,{...o,type:1,size:o.size,hash:o.hash,originalHash:o.originalHash,conflicts:void 0,timestamp:Date.now()},i);break}break;case 3:switch(o.type){case 3:await this.discardCore(r,e,i);break;case 1:await this.spliceOperation(e,a,{...o,type:2,originalHash:void 0,conflicts:void 0,timestamp:Date.now()},i);break;case 2:await this.spliceOperation(e,a,{...o,conflicts:void 0,timestamp:Date.now()},i);break}break}return}if(t===void 0)return;switch(t.type){case 1:switch(o.type){case 3:await this.spliceOperation(e,a,{...o,type:3,size:void 0,hash:void 0,originalHash:void 0,conflicts:void 0,timestamp:Date.now()},i);return;case 2:break;case 1:break}break;case 2:switch(o.type){case 1:case 3:return;case 2:break}break;case 3:switch(o.type){case 3:return this.discardCore(r,e,i);case 1:await this.spliceOperation(e,a,{...o,type:2,originalHash:void 0,conflicts:void 0,timestamp:Date.now()},i);return;case 2:return}}const s=t!==void 0?await l.workspace.fs.readFile(t.providerUri):void 0;await this.spliceOperation(e,a,{...o,type:1,originalHash:s!==void 0?await ui(s):o.originalHash,conflicts:void 0,timestamp:Date.now()},i)},n),i.length!==0&&this._onDidChange.fire(i)}async merge(e,t,r){const n=this.providerService.getVirtualWorkspaceUri(e);if(n===void 0)return;const i=`ChangeStore.merge(${e.toString()})`;q.log(i,t,r);const o=[];await this.lock.synchronizeWrite(Y(n),async()=>{const{operation:a,index:s}=await this.getWorkingOperation(e,n);if(a===void 0)return;switch(t.type){case 1:switch(a.type){case 3:return void this.spliceOperation(e,s,{...a,type:3,size:void 0,hash:void 0,originalHash:void 0,conflicts:{baseUri:r.providerUri,incomingUri:t.providerUri,status:[a.type,t.type]},timestamp:Date.now()},o);case 2:break;case 1:break}break;case 2:switch(a.type){case 3:case 1:return;case 2:break}break;case 3:switch(a.type){case 3:return this.discardCore(n,e,o);case 1:return void this.spliceOperation(e,s,{...a,type:2,originalHash:void 0,conflicts:{baseUri:void 0,incomingUri:t.providerUri,status:[a.type,t.type]},timestamp:Date.now()},o);case 2:return}}const u=await this.getWorkingContent(n,e),c=await l.workspace.fs.readFile(r.providerUri),d=await l.workspace.fs.readFile(t.providerUri),f=Ks(Et.decode(u),Et.decode(c),Et.decode(d));await this.writeFileCore(n,e,o,Cg.encode(f.mergedContent),d!=null?d:new Uint8Array(0),f.conflicts?{baseUri:r.providerUri,incomingUri:t.providerUri,status:[a.type,t.type]}:void 0)},i),o.length!==0&&this._onDidChange.fire(o)}async resolveDiffCommand(e,t,r,n){let i;const o=this.providerService.getVirtualRootUri(e);return o!==void 0&&({operation:i}=await this.getWorkingOperation(e,o)),(i==null?void 0:i.type)===3?this.resolveOpenCommand(t):((i==null?void 0:i.type)===2&&(t=t.with({query:"~"})),{command:"vscode.diff",title:"Open Changes",arguments:[t,e,r,n]})}resolveOpenCommand(e,t){return{command:"vscode.open",title:"Open File",arguments:[e,t]}}getScopedUri(e,t){const r=typeof t=="string"?t:t.workspaceId;return r===this.workspaceId?e:e.with({fragment:r})}getUriScope(e){return e.fragment||void 0}getScopedChangeStore(e){const t=typeof e=="string"?e:e.workspaceId;q.log(`ChangeStore.getScopedChangeStore(${t})`);let r=this.scopedStores.get(t);return r===void 0&&(r=t===this.workspaceId?new $r.ScopedChangeStore(this,t,this.workspaceId):new $r.ScopedChangeStore(new $r(this.providerService,this.storageService.with(t),this.fileStorageService.with(t),this.workspaceId,t),t,this.workspaceId),this.scopedStores.set(t,r)),r}async stat(e){const t=this.getUriScope(e);if(t)return this.getScopedChangeStore(t).stat(e);const r=this.providerService.getVirtualRootUri(e);if(r!==void 0)return this.lock.synchronizeRead(Y(r),async()=>{var n;const{operation:i}=await this.getWorkingOperation(e,r);if(i!==void 0){if(i.type===3)throw l.FileSystemError.FileNotFound(`The ${i.fileType===l.FileType.Directory?"folder":"file"} has been deleted.`);return{type:i.fileType,size:(n=i.size)!=null?n:0,ctime:0,mtime:i.timestamp}}},`ChangeStore.stat(${e.toString()}`)}async readFile(e){const t=this.getUriScope(e);if(t)return this.getScopedChangeStore(t).readFile(e);const r=new Ae(`ChangeStore.readFile(${e.toString()})`,{log:!0});try{const n=this.providerService.getVirtualRootUri(e);return n===void 0?void 0:await this.lock.synchronizeRead(Y(n),()=>this.getWorkingContent(n,e),r.context)}finally{r.stop()}}async createDirectory(e){const t=this.providerService.getVirtualWorkspaceUri(e);if(t===void 0)return;const r=new Ae(`ChangeStore.createDirectory(${e.toString()})`,{log:!0});try{const n=[];if(await this.lock.synchronizeWrite(Y(t),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(e,t),a=await this.providerService.getMetadata(e);await this.spliceOperation(e,o,i===void 0?{type:2,uri:e,fileType:l.FileType.Directory,revision:a.HEAD.sha,timestamp:Date.now(),size:0,hash:"",originalHash:void 0}:{...i,timestamp:Date.now()},n)},r.context),n.length===0)return;this._onDidChange.fire(n)}finally{r.stop()}}async deleteDirectory(e){const t=this.providerService.getVirtualWorkspaceUri(e);if(t===void 0)return;const r=new Ae(`ChangeStore.deleteDirectory(${e.toString()})`,{log:!0});try{const n=[];if(await this.lock.synchronizeWrite(Y(t),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(e,t);if((i==null?void 0:i.type)===2)return this.discardCore(t,e,n);const a=await this.providerService.getMetadata(e);await this.discardWorkingContent(t,e),await this.spliceOperation(e,o,{type:3,uri:e,fileType:l.FileType.Directory,revision:a.HEAD.sha,timestamp:Date.now(),size:void 0,hash:void 0,originalHash:void 0},n)},r.context),n.length===0)return;this._onDidChange.fire(n)}finally{r.stop()}}async updateDirectoryEntries(e,t){const r=this.providerService.getVirtualWorkspaceUri(e);if(r===void 0)return t;const n=new Ae(`ChangeStore.updateDirectoryEntries(${e.toString()})`,{log:!0},t.length);try{return await this.lock.synchronizeRead(Y(r),async()=>{const i=jp(r,e),o=await this.getWorkingOperations(r);for(const a of o)switch(a.type){case 1:break;case 2:{if(di(a.uri,i)){const s=this.providerService.getRelativeFilePath(e,a.uri);t.push([s,a.fileType])}break}case 3:{if(di(a.uri,i)){const s=this.providerService.getRelativeFilePath(e,a.uri),u=t.findIndex(([c])=>c===s);u!==-1&&t.splice(u,1)}break}}return t},n.context)}finally{n.stop()}}async writeFile(e,t,r,n){const i=this.providerService.getVirtualWorkspaceUri(e);if(i===void 0)return;const o=new Ae(`ChangeStore.writeFile(${e.toString()})`,{log:!0},t.length,n);try{const a=[];if(await this.lock.synchronizeWrite(Y(i),async()=>this.writeFileCore(i,e,a,t,r,n),o.context),a.length===0)return;this._onDidChange.fire(a)}finally{o.stop()}}async writeFileCore(e,t,r,n,i,o){const a=new Ae(`ChangeStore.writeFileCore(${t.toString()})`,{log:!0},n.length,o);try{const{operation:s,index:u}=await this.getWorkingOperation(t,e),c=await ui(n),d=await ui(i);if(Ae.log(a.context,{message:" Operations & Hashing"}),c===d&&(s==null?void 0:s.type)===1)return this.discardCore(e,t,r);if(c===(s==null?void 0:s.hash)&&d===(s==null?void 0:s.originalHash))return;const f=await this.providerService.getMetadata(t);await this.saveWorkingContent(e,t,n),await this.spliceOperation(t,u,s===void 0?{type:1,uri:t,fileType:l.FileType.File,revision:f.HEAD.sha,timestamp:Date.now(),size:n.byteLength,hash:c,originalHash:d,conflicts:o,staged:!1}:{...s,revision:f.HEAD.sha,timestamp:Date.now(),size:n.byteLength,hash:c,originalHash:d,conflicts:o,staged:!1},r)}finally{a.stop()}}async createFile(e,t){const r=this.providerService.getVirtualWorkspaceUri(e);if(r===void 0)return;const n=new Ae(`ChangeStore.createFile(${e.toString()})`,{log:!0},t.length);try{const i=[];if(await this.lock.synchronizeWrite(Y(r),async()=>{const{operation:o,index:a}=await this.getWorkingOperation(e,r),s=await ui(t),u=await this.providerService.getMetadata(e);await this.saveWorkingContent(r,e,t),await this.spliceOperation(e,a,o===void 0?{type:2,uri:e,fileType:l.FileType.File,revision:u.HEAD.sha,timestamp:Date.now(),size:t.byteLength,hash:s,originalHash:s}:{...o,type:2,revision:u.HEAD.sha,timestamp:Date.now(),size:t.byteLength,hash:s},i)},n.context),i.length===0)return;this._onDidChange.fire(i)}finally{n.stop()}}async deleteFile(e){const t=this.providerService.getVirtualWorkspaceUri(e);if(t===void 0)return;const r=new Ae(`ChangeStore.deleteFile(${e.toString()})`,{log:!0});try{const n=[];if(await this.lock.synchronizeWrite(Y(t),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(e,t);if((i==null?void 0:i.type)===2)return this.discardCore(t,e,n);const a=await this.providerService.getMetadata(e);await this.discardWorkingContent(t,e),await this.spliceOperation(e,o,{type:3,uri:e,fileType:l.FileType.File,revision:a.HEAD.sha,timestamp:Date.now(),size:void 0,hash:void 0,originalHash:void 0},n)},r.context),n.length===0)return;this._onDidChange.fire(n)}finally{r.stop()}}async getWorkingOperation(e,t){const r=await this.getWorkingOperations(t);if(r.length===0)return{operation:void 0,index:-1};const n=Y(e);let i;const o=r.find((a,s)=>Y(a.uri)!==n?!1:(i=s,!0));return o===void 0?{operation:void 0,index:-1}:{operation:o,index:i}}async getWorkingOperations(e){const t=Y(e);let r=this.cache.get(t);return r===void 0&&(r=this.fromStorage(await this.storageService.get(this.getOperationsStorageKey(t))),this.cache.set(t,r)),r}async discardWorkingOperations(e){return q.debug(`ChangeStore.discardWorkingOperations(${e.toString()})`),this.saveWorkingOperations(e,[])}async saveWorkingOperations(e,t){q.debug(`ChangeStore.saveWorkingOperations(${e.toString()})`,t.length);const r=Y(e);this.cache.set(r,t);try{await this.storageService.store(this.getOperationsStorageKey(r),this.toStorage(t))}catch(n){throw this.cache.delete(r),q.error(n,`Failed to save repository changes for ${r}`),n}}getOperationsStorageKey(e){return`operations/${e}`}async getWorkingContent(e,t){return this.fileStorageService.get(this.getFileStorageKey(e,t))}async discardWorkingContent(e,t){return q.debug(`ChangeStore.discardWorkingContent(${t.toString()})`),this.fileStorageService.delete(this.getFileStorageKey(e,t))}async saveWorkingContent(e,t,r){return q.debug(`ChangeStore.saveWorkingContent(${t.toString()})`,r.length),this.fileStorageService.store(this.getFileStorageKey(e,t),r)}getFileStorageKey(e,t){return`changestore/${Wp(t)}`}async spliceOperation(e,t,r,n){const i=this.providerService.getVirtualWorkspaceUri(e);if(i===void 0)return;const o=await this.getWorkingOperations(i);t!==-1?o.splice(t,1,r):o.push(r),await this.saveWorkingOperations(i,o),n.push(_i(r,i,e))}fromStorage(e){if(!e)return[];try{const t=JSON.parse(e,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&n!==null?typeof n=="string"?l.Uri.parse(n):l.Uri.from(n):n);return Array.isArray(t)?t:t.operations}catch(t){throw q.error(t,"Failed to deserialize ChangeStore operations"),t}}toStorage(e){const t={schemaVersion:$r.operationsStorageSchemaVersion,operations:e};return JSON.stringify(t)}};let vn=$r;vn.operationsStorageSchemaVersion=1,vn.ScopedChangeStore=class{constructor(e,t,r){this.changeStore=e,this.scope=t,this.workspaceId=r}createPatch(e,t){return this.changeStore.createPatch(this.stripUriScope(e),this.stripUriScope(t))}getChange(e){return this.changeStore.getChange(this.stripUriScope(e))}getChanges(e,t){return this.changeStore.getChanges(this.stripUriScope(e),t)}async getGroupedChanges(e,t){return this.changeStore.getGroupedChanges(this.stripUriScope(e),t)}async stat(e){const r=this.changeStore.getUriScope(e)!==this.workspaceId,n=await this.changeStore.stat(this.stripUriScope(e));return n!==void 0&&r&&(n.permissions=l.FilePermission.Readonly),n}readFile(e){return this.changeStore.readFile(this.stripUriScope(e))}resolveDiffCommand(e,t,r,n){return this.changeStore.resolveDiffCommand(this.changeStore.getScopedUri(e,this.scope),this.changeStore.getScopedUri(t,this.scope),r,n)}stripUriScope(e){return e===void 0||!e.fragment?e:e.with({fragment:""})}},Sg([xt()],vn.prototype,"getWorkingOperations",1);function Xs(e){switch(e){case 1:return ut("change type changed","Modified");case 2:return ut("change type created","Added");case 3:return ut("change type deleted","Deleted")}}function kg(e){const[t,r]=e;switch(t){case 1:switch(r){case 1:case 2:return ut("conflict status changed both","Modified by Both");case 3:return ut("conflict status deleted them","Deleted by Incoming")}break;case 2:switch(r){case 1:case 2:return ut("conflict status created both","Added by Both");case 3:return ut("conflict status deleted them","Deleted by Incoming")}break;case 3:switch(r){case 1:case 2:return ut("conflict status deleted us","Deleted by Current");case 3:return ut("conflict status deleted both","Deleted by Both")}break}}var Eg=ze(3730);const Io=class{constructor(e){this.sharedProperties={},Io._instance=this,this.reporter=new Eg.Z(e.extension.id,e.extension.packageJSON.version,Io.aiKey,!0)}static get instance(){return this._instance}dispose(){this.reporter.dispose()}sendEvent(e,t,r){this.reporter.sendTelemetryEvent(e,{...this.sharedProperties,...t},r)}sendErrorEvent(e,t,r){this.reporter.sendTelemetryErrorEvent(e,{...this.sharedProperties,...t},r)}sendException(e,t,r){this.reporter.sendTelemetryException(e,{...this.sharedProperties,...t},r)}setSharedProperty(e,t){this.sharedProperties[e]=t}};let Or=Io;Or.aiKey="AIF-d9b70cd4-b9f9-4d70-929b-a071c400b217";const dr=(0,P.loadMessageBundle)();let Qt;var Fo;(function(e){function t(r){const n=Ag(r);return Qt=l.env.uiKind===l.UIKind.Web,q.log(`Running on the ${Qt?"web":"desktop"}${r.extensionRuntime!==l.ExtensionRuntime.Node?"in a webworker":""}; workspaceId: ${n}`),n}e.configure=t})(Fo||(Fo={}));function Rg(){var e,t;return(t=(e=l.workspace.workspaceFolders)==null?void 0:e.every(r=>r.uri.scheme===Fe.scheme))!=null?t:!1}var Le;(function(e){e.CurrentWindow="currentWindow",e.NewWindow="newWindow",e.AddToWorkspace="addToWorkspace"})(Le||(Le={}));const Dg=/\/workspaceStorage\/(?<id>[^/]+)/i;function Ag(e){var t;if(e.storageUri===void 0)return"";const r=Dg.exec(e.storageUri.path);if((t=r==null?void 0:r.groups)==null?void 0:t.id)return r.groups.id;let n=e.storageUri.path;const i=Hp(e.globalStorageUri.path,n),o=`/${e.extension.id}`;return n.endsWith(o)?n=n.slice(i,-o.length):n=n.substr(i),n}async function vt(e){var t,r,n;if(Or.instance.sendEvent("openWorkspace",{location:e.location}),e.location===Le.AddToWorkspace){const o=(r=(t=l.workspace.workspaceFolders)==null?void 0:t.length)!=null?r:0;return void l.workspace.updateWorkspaceFolders(o,0,{uri:e.uri,name:e.name})}if(e.location===Le.CurrentWindow){const o=await vn.instance.getWorkspaceProvidersWithChanges();if(o.length){const a={title:dr("continue","Continue")},s={title:dr("cancel","Cancel"),isCloseAffordance:!0};if(await l.window.showWarningMessage(Qt?dr("open folder uncommitted changes web",`You have uncommitted changes.

If you want to see your changes on {0} or from other browsers or machines, commit them before leaving this workspace. Otherwise, you can re-open this workspace anytime and pick up right where you left off.

Do you want to continue opening a new workspace?`,o.map(c=>c.name).join(", ")):dr("open folder uncommitted changes",`You have uncommitted changes.

If you want to see your changes on {0} or from other machines, commit them before leaving this workspace. Otherwise, you can re-open this workspace anytime and pick up right where you left off.

Do you want to continue opening a new workspace?`,o.map(c=>c.name).join(", ")),{modal:!0},a,s)!==a){Or.instance.sendEvent("openWorkspace.abort",{reason:"abandoned uncommitted changes prompt"});return}}}e.filesToOpen&&await((n=zu())==null?void 0:n.setFilesToOpen(e.uri,e.filesToOpen));let i;if(l.env.remoteName)if(l.env.remoteName==="wsl")i=!0;else{const o=dr("open folder location local","Open from Local Machine"),a=dr("open folder location remote","Open from Remote Machine"),s=await l.window.showInformationMessage(dr("open folder location",`Do you want to open the remote repository from your local or remote machine?

Opening from the current remote connection will allow you to continue working on the remote repository from any other machine connected to this remote machine.`),{modal:!0},o,a);if(!s){Or.instance.sendEvent("openWorkspace.abort",{reason:"abandoned local/remote prompt"});return}s===o&&(i=!0)}return Or.instance.sendEvent("openWorkspace.success",{location:e.location,forceLocalWindow:String(i)}),void l.commands.executeCommand("vscode.openFolder",e.uri,{forceNewWindow:e.location===Le.NewWindow,forceLocalWindow:i})}var wn;(function(e){e.HasVirtualFolders="remoteHub:hasVirtualFolders",e.HasSearchIndexes="remoteHub:hasSearchIndexes",e.VirtualFolderProviders="remoteHub:virtualFolderProviders"})(wn||(wn={}));const Js=new Map;function Ur(e){return e==="isWeb"?Qt:e==="remoteName"?l.env.remoteName:e==="virtualWorkspace"?Rg():e.startsWith("config.")?Ce.getAny(e.substr(7)):Js.get(e)}async function $o(e,t){Js.set(e,t),await l.commands.executeCommand("setContext",e,t)}class Tg{constructor(t){this.menuItem=t}get label(){return`${this.menuItem.icon?`${this.menuItem.icon} `:""}${this.menuItem.title}`}get detail(){return this.menuItem.extension.builtin?"Built-in":this.menuItem.extension.name||this.menuItem.extension.id}async execute(t){return void await l.commands.executeCommand(this.menuItem.command,t)}}var Oo;(function(e){async function t(r,n,i){const o=Pg(r).map(u=>new Tg(u)),a=l.window.createQuickPick(),s=[];try{return await new Promise(c=>{s.push(a.onDidHide(()=>c(void 0)),a.onDidAccept(()=>{if(a.activeItems.length!==0){const[d]=a.activeItems;c(d)}})),a.title=i,a.placeholder=n,a.items=o,a.show()})}finally{a.dispose(),s.forEach(u=>void u.dispose())}}e.show=t})(Oo||(Oo={}));function Pg(e){var t,r,n,i,o;const a=new Map,[,s]=e.split(".");for(const c of l.extensions.all){const{name:d,displayName:f,contributes:h}=c.packageJSON;if(!h)continue;const p=(r=(t=h.virtualWorkspaces)==null?void 0:t.menus)==null?void 0:r.continueOn;if(p==null?void 0:p.length){const g=new Map(((n=h.commands)!=null?n:[]).map(w=>[w.command,w]));for(const w of p){if(!w.command)continue;if(a.has(w.command)){q.warn(`Duplicate 'continueOn' menu command: ${w.command}`);continue}const _=g.get(w.command);if(!_){q.warn(`Unable to find 'continueOn' menu command: ${w.command}`);continue}if(!Ig(w.when))continue;const D=(o=(i=w.group)==null?void 0:i.lastIndexOf("@"))!=null?o:-1;a.set(w.command,{extension:{id:d,name:f,builtin:d===s},command:_.command,title:_.title,icon:typeof _.icon=="string"?_.icon:void 0,group:D>0?w.group.substr(0,D):w.group,order:D>0?Number(w.group.substr(D+1)):0,category:_.category})}}}function u(c,d){const f=c.group,h=d.group;if(f!==h){if(!f)return 1;if(!h||f==="navigation")return-1;if(h==="navigation")return 1;const p=f.localeCompare(h);if(p!==0)return p}return c.order<d.order?-1:c.order>d.order?1:c.title.localeCompare(d.title)}return[...a.values()].sort(u)}function Ig(e){if(!e)return!0;function t(r){return r==="isWeb"||r==="remoteName"||r==="virtualWorkspace"||r.startsWith("remoteHub:")||r.startsWith("config.")}return e.split("&&").every(r=>{const n=/^(?:(!)?(\S+)|(\S+)\s?(==|!=|=~)\s?(\S+))$/.exec(r.trim());if(!n)return!0;const[,i,o,a,s,u]=n;if(o){if(o==="false")return!1;if(!t(o))return!0;const c=Ur(o);return i?!c:c}if(a&&s&&u)switch(s){case"==":return!t(a)||!t(u)||Ur(a)==Ur(u);case"!=":return!t(a)||!t(u)||Ur(a)!=Ur(u);case"=~":{if(!t(a))return!0;const c=Ur(a);try{return new RegExp(u.slice(1,-1)).test(String(c!=null?c:""))}catch{return!1}}}return!0})}class Uo{constructor(t){this.defaultDelay=t}dispose(){this.cancelTimeout()}debounce(t,r=this.defaultDelay){return this.task=t,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((n,i)=>{this.resolver=n,this.rejecter=i}).then(()=>{if(this.completionPromise=void 0,this.resolver=void 0,this.task){const n=this.task;return this.task=void 0,n()}})),this.timeout=setTimeout(()=>{var n;this.timeout=void 0,(n=this.resolver)==null||n.call(this,void 0)},r),this.completionPromise}cancel(){var t;this.cancelTimeout(),this.completionPromise&&((t=this.rejecter)==null||t.call(this,new Error("Canceled")),this.completionPromise=void 0)}cancelTimeout(){this.timeout!==void 0&&(clearTimeout(this.timeout),this.timeout=void 0)}}const No=Symbol("QuickPickGoBack");var Mo;(function(e){async function t(r,n,i,o,a,s){const u=r.getRemoteWorkspaceSourceProviders();let c=[];u.length===0?c=[]:c=u.map(w=>new Ys(w));const d=await n.getRemoteWorkspaceSourceProvider();if(d){const w=await d.provideSources();c.push(...w.map(_=>({label:`${_.icon?`${_.icon} `:""}${_.name}`,description:_.description,detail:_.detail,url:_.url,workspace:_.url?void 0:_.workspace})))}let f=await l.env.clipboard.readText();r.findRemoteUrlHandler(f)||(f="");const h=l.window.createQuickPick(),p=[];let g=i;try{for(;;){const w=await new Promise(_=>{p.push(h.onDidHide(()=>_(void 0)),h.onDidChangeValue(D=>{D=D.trim(),D.length===0?(h.ignoreFocusOut=!1,h.items=c):(h.ignoreFocusOut=!0,h.activeItems.length===0||h.activeItems[0]instanceof yn?h.items=[new yn(r,D),...c]:h.items=c)}),h.onDidAccept(()=>{if(h.activeItems.length!==0){const[D]=h.activeItems;(!(D instanceof yn)||D.validate())&&_(D)}}),h.onDidChangeActive(()=>{if(g!==void 0||!(s==null?void 0:s.allowAddToWorkspace))return;const[D]=h.activeItems;let C=!0;if(D===void 0?C=Boolean(h.value):C=D instanceof yn,C){if(h.buttons.length===1)return;h.buttons=[Nr.AddToWorkspace]}else{if(h.buttons.length===0)return;h.buttons=[]}}),h.onDidTriggerButton(D=>{if(D===Nr.AddToWorkspace){const[C]=h.activeItems;if(!(C instanceof yn))return;C.validate()&&(g=Le.AddToWorkspace,_(C))}})),h.title=a,h.placeholder=o,h.matchOnDescription=!0,h.items=c,h.sortByLabel=!1,h.value=f,h.show(),f&&h._onDidChangeValueEmitter.fire(h.value)});if(w instanceof Ys){const _=await w.show(g,w.placeholder,a,s);if(_===No)continue;return _}return[w,g]}}finally{h.dispose(),p.forEach(w=>void w.dispose())}}e.show=t})(Mo||(Mo={}));class Ys{constructor(t){this.provider=t}get label(){return`${this.provider.icon?`${this.provider.icon} `:""}${this.provider.label}`}get placeholder(){return this.provider.placeholder}async show(t,r,n,i){const o=l.window.createQuickPick(),a=new Uo(500),s=[a];async function u(g,w,_){return(await g.provideSources(w,_)).map(C=>({label:`${C.icon?`${C.icon} `:""}${C.name}`,description:C.description,detail:C.detail,url:C.url,workspace:C.workspace}))}const c=u(this.provider,void 0,{sort:"updated"});let d=t,f,h=!1;async function p(g){f=void 0;const w=o.activeItems;o.items=g!=null?g:await c,h&&w.length!==0&&(o.activeItems=o.items.filter(_=>w.some(D=>D.url===_.url))),o.busy=!1}try{const g=await new Promise(w=>{s.push(o.onDidHide(()=>w(void 0)),o.onDidChangeValue(_=>{h=!1,_=_.trim(),o.busy=!0;let D=_,C;const U=_.indexOf("/");U!==-1&&(C=_.substring(0,U),D=_.substr(U+1));const F=a.debounce(_?()=>u(this.provider,D,{user:C,sort:"stars"}):()=>c);f===void 0&&(f=F.then(async z=>p(z)))}),o.onDidAccept(()=>{if(o.activeItems.length!==0){const[_]=o.activeItems;w(_)}}),o.onDidChangeActive(()=>{if(h=o.activeItems.length!==0,d!==void 0||!(i==null?void 0:i.allowAddToWorkspace))return;const[_]=o.activeItems;if(_===void 0){if(o.buttons.length===1)return;o.buttons=[l.QuickInputButtons.Back]}else{if(o.buttons.length===2)return;o.buttons=[l.QuickInputButtons.Back,Nr.AddToWorkspace]}}),o.onDidTriggerButton(_=>{if(_===l.QuickInputButtons.Back){w(No);return}if(_===Nr.AddToWorkspace){const[D]=o.activeItems;if(D===void 0)return;d=Le.AddToWorkspace,w(D)}})),o.title=n,o.placeholder=r,o.matchOnDetail=!0,o.ignoreFocusOut=!0,o.sortByLabel=!1,o.buttons=[l.QuickInputButtons.Back],o.busy=!0,o.show(),f=a.debounce(async()=>c,0).then(_=>p(_))});return g===No?g:[g,d]}finally{o.dispose(),s.forEach(g=>void g.dispose())}}}class yn{constructor(t,r){this.url=r,this.alwaysShow=!0,this.handler=t.findRemoteUrlHandler(r)}get label(){if(this.handler)switch(this.handler.urlType){case qe.Branch:return`Open Branch from ${this.handler.provider.name} Repository`;case qe.Commit:return`Open Commit from ${this.handler.provider.name} Repository`;case qe.File:return`Open File from ${this.handler.provider.name} Repository`;case qe.PullRequest:return`Open Pull Request from ${this.handler.provider.name} Repository`;default:return`Open ${this.handler.provider.name} Repository`}return"Enter a Remote Url"}get description(){return this.url}validate(){return this.handler!==void 0}}var Nr;(function(e){e.AddToWorkspace={iconPath:new l.ThemeIcon("plus"),tooltip:"Add to Workspace"}})(Nr||(Nr={}));const Ze=(0,P.loadMessageBundle)();function Fg(e,t,r,n,i){async function o(s){const[u,c]=await Mo.show(e,r,s,Ze("open repo placeholder","Enter a remote url, or select a remote provider"),s===Le.AddToWorkspace?Ze("open repo title add to workspace","Add Remote Repository to Workspace"):Ze("open repo title current window","Open Remote Repository"),{allowAddToWorkspace:!1});if(!u){i.sendEvent("openRepository.abort",{reason:"abandoned"});return}try{let d;if(u.workspace)d=u.workspace;else if(d=await e.createWorkspaceForRemoteUrl(u.url,void 0,c!=null?c:s),!d){i.sendEvent("openRepository.abort",{reason:"aborted invalid url"});return}await vt(d)}catch(d){if(i.sendException(d),d instanceof Ir){za(d.name);return}q.error(d)}}async function a(s,u,c){if(c==null?void 0:c.workspaceFolder){const f=e.getRepository(c.workspaceFolder,u);if(f!==void 0)return f}const d=u?e.repositories.filter(f=>f.provider.id===u):e.repositories;if(d.length!==0){if(d.length>1){const f=await l.window.showQuickPick(d.map(h=>({label:h.name,description:h.provider.name,repository:h})),{placeHolder:s});return f?f.repository:void 0}return d[0]}}return[l.commands.registerCommand("remoteHub.openRepository",()=>(i.sendEvent("command.openRepository"),o())),l.commands.registerCommand("remoteHub.continueOn.openRepository",()=>(i.sendEvent("command.continueOn.openRepository"),o())),l.commands.registerCommand("remoteHub.addRepositoryToWorkspace",()=>{i.sendEvent("command.continueOn.openRepository")}),l.commands.registerCommand("remoteHub.continueOn.addRepositoryToWorkspace",()=>{i.sendEvent("command.continueOn.openRepository")}),l.commands.registerCommand("remoteHub.continueOn",async()=>{const s=await a(Ze("continue on choose repository placeholder","Choose which repository to continue working on elsewhere"));if(s===void 0)return;i.sendEvent("command.continueOn");const u=await Oo.show(n,Ze("continue on placeholder","Choose how you would like to continue working"),Ze("continue on title","Continue '{0}' on",s.name));if(!u){i.sendEvent("command.continueOn.abort",{reason:"abandoned"});return}if(await t.hasChanges(s.uri)){const f={title:Ze("continue","Continue")},h={title:Ze("cancel","Cancel"),isCloseAffordance:!0};if(await l.window.showWarningMessage(Ze("continue on uncommitted changes",`You have uncommitted changes.

Unless you commit those changes, you won't be able see them from elsewhere.`),{modal:!0},f,h)!==f){i.sendEvent("command.continueOn.abort",{reason:"abandoned uncommitted changes prompt"});return}}const c=e.getExternalUri(s.provider.id,{repo:s.id}),{HEAD:d}=await s.getMetadata();await u.execute({provider:s.provider,workspaceFolder:s.uri,name:s.name,url:c==null?void 0:c.toString(!0),ref:d.name})}),l.commands.registerCommand("remoteHub.openOnDesktop",async s=>{if(!Qt)return;const u=await a(Ze("continue on desktop choose repository placeholder","Choose which repository to open on the desktop"),void 0,s);if(u===void 0)return;const c=await e.getBestExternalUri(u.uri);c!==void 0&&(i.sendEvent("command.openOnDesktop"),l.env.openExternal(l.Uri.parse(`${l.env.uriScheme}://${n}/open?url=${encodeURIComponent(c.toString(!0))}`)))}),l.commands.registerCommand("remoteHub.openOnWeb",async s=>{if(Qt)return;const u=await a(Ze("continue on web choose repository placeholder","Choose which repository to open on the web"),void 0,s);if(u===void 0)return;const c=await e.getBestExternalUri(u.uri);c!==void 0&&(i.sendEvent("command.openOnWeb"),l.env.openExternal(c.with({authority:"vscode.dev",path:`${c.authority}${c.path}`})))}),l.commands.registerCommand("remoteHub.openOnRemote",async s=>{i.sendEvent("command.openOnRemote");const{provider:u,...c}=s,d=e.getExternalUri(u.id,c);if(d){await l.env.openExternal(d);return}l.window.showErrorMessage(Ze("open on remote command provider not supported","Unable to open the resource on {0}",s.provider.name))}),l.commands.registerCommand("remoteHub.clone",async s=>{const u=await a(Ze("clone placeholder","Choose which repository to clone"),void 0,s);if(u!==void 0){if(i.sendEvent("command.clone"),s===void 0&&await t.hasChanges(u.uri)){const c={title:Ze("continue","Continue")},d={title:Ze("cancel","Cancel"),isCloseAffordance:!0};if(await l.window.showWarningMessage(Ze("clone uncommitted changes",`You have uncommitted changes.

Unless you commit those changes, you won't be able see them in your local clone.`),{modal:!0},c,d)!==c){i.sendEvent("command.clone.abort",{reason:"abandoned uncommitted changes prompt"});return}}await e.clone(u.uri)}}),l.commands.registerCommand("remoteHub.openInCodespaces",async s=>{const u=await a(Ze("codespaces placeholder","Choose which repository to open on codespaces"),"github",s);if(u===void 0)return;i.sendEvent("command.openInCodespaces");const c=await u.getMetadata();l.env.openExternal(l.Uri.parse(`https://github.com/codespaces?repository=${c.repo.owner}/${c.repo.name}`))}),l.commands.registerCommand("remoteHub.refresh",()=>void e.refresh()),l.commands.registerCommand("remoteHub.enableDebugLogging",()=>Ce.updateEffective("logLevel",De.Debug)),l.commands.registerCommand("remoteHub.disableDebugLogging",()=>Ce.updateEffective("logLevel",De.Warn))]}function Bt(e){return e}async function Lo(e,t){return l.commands.executeCommand(e,t)}class $g{constructor(){this._timeout=0,this._disposable=Ce.onDidChange(this.onConfigurationChanged,this),this.maybeQueueFetch()}dispose(){this._disposable.dispose(),this._timeout&&clearTimeout(this._timeout)}get config(){var t;if(this._config===void 0){const r=Ce.get("autoFetch");this._config={enabled:(t=r.enabled)!=null?t:!0,interval:r.interval*1e3}}return this._config}onConfigurationChanged(t){!Ce.changed(t,"autoFetch")||(this._config=void 0,this.maybeQueueFetch())}async fetchAll(){try{await Lo("remoteHub.fetchAll",{automated:!0})}catch(t){q.error(t,"Autofetch failed")}this.maybeQueueFetch()}maybeQueueFetch(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),!!this.config.enabled&&(this._timeout=setTimeout(()=>this.fetchAll(),this.config.interval))}}var Mr=ze(7360);function Og(e){return e.replace(/[-\\{}*+?|^$.[\]()#]/g,"\\$&")}function Ug(e,t,r={}){if(!e)throw new Error("Cannot create regex from empty string");t||(e=Og(e)),r.wholeWord&&(/\B/.test(e.charAt(0))||(e=`\\b${e}`),/\B/.test(e.charAt(e.length-1))||(e=`${e}\\b`));let n="";return r.global&&(n+="g"),r.matchCase||(n+="i"),r.multiline&&(n+="m"),r.unicode&&(n+="u"),new RegExp(e,n)}var ec=ze(1171);let tc,rc,Bo;const Ng=(e,t,r,n)=>{const i=`${t.join("--")};;;;${r.join("--")}`,o=e.map(u=>u.path).join("::");if(tc===o&&i==rc&&Bo)return Bo;const a=new Set,s=u=>(t.length===0||t.some(c=>ec(u,c,{dot:!0})))&&!r.some(c=>ec(u,c,{dot:!0}));for(const u of e)s(u.path)&&(!n||u.size<n)&&a.add(u.path);return tc=o,rc=i,Bo=a,a},Mg=(e,t,r,n)=>{var i;const o=[];let a;if(typeof e=="string")a=e;else{const d=e;if(d[0]==255&&d[1]==254)a=new TextDecoder("utf-16le").decode(d);else if(d[0]==254&&d[1]==255)a=new TextDecoder("utf-16be").decode(d);else if(a=new TextDecoder("utf8").decode(d),a.slice(0,1e3).includes("\uFFFD")&&d.includes(0))return[]}const s=[];let u=null,c=n.remainingResultQuota;for(;c>=0&&(u=r.exec(a));)s.push({matchStartIndex:u.index,matchedText:u[0]}),c--;if(s.length){const d=new Set,f=new Set,h=[],p=C=>a.slice(h[C].start,h[C].end);let g=0,w=null;const _=/\r?\n/g;for(;w=_.exec(a);)h.push({start:g,end:w.index}),g=w.index+w[0].length;g<a.length&&h.push({start:g,end:a.length});let D=0;for(const{matchStartIndex:C,matchedText:U}of s){if(c<0)break;for(;Boolean(h[D+1])&&C>h[D].end;)D++;let F=D;for(;Boolean(h[F+1])&&C+U.length>h[F].end;)F++;if(n.beforeContext)for(let he=Math.max(0,D-n.beforeContext);he<D;he++)d.add(he);let z="",ue=0;for(let he=D;he<=F;he++){let pe=p(he);((i=n.previewOptions)==null?void 0:i.charsPerLine)&&pe.length>n.previewOptions.charsPerLine&&(ue=Math.max(C-h[D].start-20,0),pe=pe.substr(ue,n.previewOptions.charsPerLine)),z+=`${pe}
`,f.add(he)}const Q=new l.Range(D,C-h[D].start,F,C+U.length-h[F].start),de=new l.Range(0,C-h[D].start-ue,F-D,C+U.length-h[F].start-(F===D?ue:0)),we={uri:l.Uri.file(t),ranges:Q,preview:{text:z,matches:de}};if(o.push(we),n.afterContext)for(let he=F+1;he<=Math.min(F+n.afterContext,h.length-1);he++)d.add(he)}for(const C of d)f.has(C)||o.push({uri:l.Uri.file(t),text:p(C),lineNumber:C+1})}return o};var Lg=ze(5790);/*! pako 2.0.3 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Bg=4,nc=0,ic=1,Hg=2;function Lr(e){let t=e.length;for(;--t>=0;)e[t]=0}const Wg=0,oc=1,zg=2,jg=3,qg=258,Ho=29,bn=256,_n=bn+1+Ho,Br=30,Wo=19,ac=2*_n+1,hr=15,zo=16,Vg=7,jo=256,sc=16,cc=17,lc=18,qo=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Si=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Gg=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),uc=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Zg=512,Ht=new Array((_n+2)*2);Lr(Ht);const Sn=new Array(Br*2);Lr(Sn);const Cn=new Array(Zg);Lr(Cn);const xn=new Array(qg-jg+1);Lr(xn);const Vo=new Array(Ho);Lr(Vo);const Ci=new Array(Br);Lr(Ci);function Go(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}let dc,hc,fc;function Zo(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const pc=e=>e<256?Cn[e]:Cn[256+(e>>>7)],kn=(e,t)=>{e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255},ot=(e,t,r)=>{e.bi_valid>zo-r?(e.bi_buf|=t<<e.bi_valid&65535,kn(e,e.bi_buf),e.bi_buf=t>>zo-e.bi_valid,e.bi_valid+=r-zo):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},Rt=(e,t,r)=>{ot(e,r[t*2],r[t*2+1])},gc=(e,t)=>{let r=0;do r|=e&1,e>>>=1,r<<=1;while(--t>0);return r>>>1},Kg=e=>{e.bi_valid===16?(kn(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},Qg=(e,t)=>{const r=t.dyn_tree,n=t.max_code,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,u=t.stat_desc.max_length;let c,d,f,h,p,g,w=0;for(h=0;h<=hr;h++)e.bl_count[h]=0;for(r[e.heap[e.heap_max]*2+1]=0,c=e.heap_max+1;c<ac;c++)d=e.heap[c],h=r[r[d*2+1]*2+1]+1,h>u&&(h=u,w++),r[d*2+1]=h,!(d>n)&&(e.bl_count[h]++,p=0,d>=s&&(p=a[d-s]),g=r[d*2],e.opt_len+=g*(h+p),o&&(e.static_len+=g*(i[d*2+1]+p)));if(w!==0){do{for(h=u-1;e.bl_count[h]===0;)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[u]--,w-=2}while(w>0);for(h=u;h!==0;h--)for(d=e.bl_count[h];d!==0;)f=e.heap[--c],!(f>n)&&(r[f*2+1]!==h&&(e.opt_len+=(h-r[f*2+1])*r[f*2],r[f*2+1]=h),d--)}},mc=(e,t,r)=>{const n=new Array(hr+1);let i=0,o,a;for(o=1;o<=hr;o++)n[o]=i=i+r[o-1]<<1;for(a=0;a<=t;a++){let s=e[a*2+1];s!==0&&(e[a*2]=gc(n[s]++,s))}},Xg=()=>{let e,t,r,n,i;const o=new Array(hr+1);for(r=0,n=0;n<Ho-1;n++)for(Vo[n]=r,e=0;e<1<<qo[n];e++)xn[r++]=n;for(xn[r-1]=n,i=0,n=0;n<16;n++)for(Ci[n]=i,e=0;e<1<<Si[n];e++)Cn[i++]=n;for(i>>=7;n<Br;n++)for(Ci[n]=i<<7,e=0;e<1<<Si[n]-7;e++)Cn[256+i++]=n;for(t=0;t<=hr;t++)o[t]=0;for(e=0;e<=143;)Ht[e*2+1]=8,e++,o[8]++;for(;e<=255;)Ht[e*2+1]=9,e++,o[9]++;for(;e<=279;)Ht[e*2+1]=7,e++,o[7]++;for(;e<=287;)Ht[e*2+1]=8,e++,o[8]++;for(mc(Ht,_n+1,o),e=0;e<Br;e++)Sn[e*2+1]=5,Sn[e*2]=gc(e,5);dc=new Go(Ht,qo,bn+1,_n,hr),hc=new Go(Sn,Si,0,Br,hr),fc=new Go(new Array(0),Gg,0,Wo,Vg)},vc=e=>{let t;for(t=0;t<_n;t++)e.dyn_ltree[t*2]=0;for(t=0;t<Br;t++)e.dyn_dtree[t*2]=0;for(t=0;t<Wo;t++)e.bl_tree[t*2]=0;e.dyn_ltree[jo*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},wc=e=>{e.bi_valid>8?kn(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Jg=(e,t,r,n)=>{wc(e),n&&(kn(e,r),kn(e,~r)),e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r},yc=(e,t,r,n)=>{const i=t*2,o=r*2;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]},Ko=(e,t,r)=>{const n=e.heap[r];let i=r<<1;for(;i<=e.heap_len&&(i<e.heap_len&&yc(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!yc(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n},bc=(e,t,r)=>{let n,i,o=0,a,s;if(e.last_lit!==0)do n=e.pending_buf[e.d_buf+o*2]<<8|e.pending_buf[e.d_buf+o*2+1],i=e.pending_buf[e.l_buf+o],o++,n===0?Rt(e,i,t):(a=xn[i],Rt(e,a+bn+1,t),s=qo[a],s!==0&&(i-=Vo[a],ot(e,i,s)),n--,a=pc(n),Rt(e,a,r),s=Si[a],s!==0&&(n-=Ci[a],ot(e,n,s)));while(o<e.last_lit);Rt(e,jo,t)},Qo=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems;let a,s,u=-1,c;for(e.heap_len=0,e.heap_max=ac,a=0;a<o;a++)r[a*2]!==0?(e.heap[++e.heap_len]=u=a,e.depth[a]=0):r[a*2+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=u<2?++u:0,r[c*2]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=n[c*2+1]);for(t.max_code=u,a=e.heap_len>>1;a>=1;a--)Ko(e,r,a);c=o;do a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Ko(e,r,1),s=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=s,r[c*2]=r[a*2]+r[s*2],e.depth[c]=(e.depth[a]>=e.depth[s]?e.depth[a]:e.depth[s])+1,r[a*2+1]=r[s*2+1]=c,e.heap[1]=c++,Ko(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],Qg(e,t),mc(r,u,e.bl_count)},_c=(e,t,r)=>{let n,i=-1,o,a=t[0*2+1],s=0,u=7,c=4;for(a===0&&(u=138,c=3),t[(r+1)*2+1]=65535,n=0;n<=r;n++)o=a,a=t[(n+1)*2+1],!(++s<u&&o===a)&&(s<c?e.bl_tree[o*2]+=s:o!==0?(o!==i&&e.bl_tree[o*2]++,e.bl_tree[sc*2]++):s<=10?e.bl_tree[cc*2]++:e.bl_tree[lc*2]++,s=0,i=o,a===0?(u=138,c=3):o===a?(u=6,c=3):(u=7,c=4))},Sc=(e,t,r)=>{let n,i=-1,o,a=t[0*2+1],s=0,u=7,c=4;for(a===0&&(u=138,c=3),n=0;n<=r;n++)if(o=a,a=t[(n+1)*2+1],!(++s<u&&o===a)){if(s<c)do Rt(e,o,e.bl_tree);while(--s!=0);else o!==0?(o!==i&&(Rt(e,o,e.bl_tree),s--),Rt(e,sc,e.bl_tree),ot(e,s-3,2)):s<=10?(Rt(e,cc,e.bl_tree),ot(e,s-3,3)):(Rt(e,lc,e.bl_tree),ot(e,s-11,7));s=0,i=o,a===0?(u=138,c=3):o===a?(u=6,c=3):(u=7,c=4)}},Yg=e=>{let t;for(_c(e,e.dyn_ltree,e.l_desc.max_code),_c(e,e.dyn_dtree,e.d_desc.max_code),Qo(e,e.bl_desc),t=Wo-1;t>=3&&e.bl_tree[uc[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t},em=(e,t,r,n)=>{let i;for(ot(e,t-257,5),ot(e,r-1,5),ot(e,n-4,4),i=0;i<n;i++)ot(e,e.bl_tree[uc[i]*2+1],3);Sc(e,e.dyn_ltree,t-1),Sc(e,e.dyn_dtree,r-1)},tm=e=>{let t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(t&1&&e.dyn_ltree[r*2]!==0)return nc;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return ic;for(r=32;r<bn;r++)if(e.dyn_ltree[r*2]!==0)return ic;return nc};let Cc=!1;const rm=e=>{Cc||(Xg(),Cc=!0),e.l_desc=new Zo(e.dyn_ltree,dc),e.d_desc=new Zo(e.dyn_dtree,hc),e.bl_desc=new Zo(e.bl_tree,fc),e.bi_buf=0,e.bi_valid=0,vc(e)},xc=(e,t,r,n)=>{ot(e,(Wg<<1)+(n?1:0),3),Jg(e,t,r,!0)},nm=e=>{ot(e,oc<<1,3),Rt(e,jo,Ht),Kg(e)},im=(e,t,r,n)=>{let i,o,a=0;e.level>0?(e.strm.data_type===Hg&&(e.strm.data_type=tm(e)),Qo(e,e.l_desc),Qo(e,e.d_desc),a=Yg(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=i&&(i=o)):i=o=r+5,r+4<=i&&t!==-1?xc(e,t,r,n):e.strategy===Bg||o===i?(ot(e,(oc<<1)+(n?1:0),3),bc(e,Ht,Sn)):(ot(e,(zg<<1)+(n?1:0),3),em(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),bc(e,e.dyn_ltree,e.dyn_dtree)),vc(e),n&&wc(e)},om=(e,t,r)=>(e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255,e.pending_buf[e.l_buf+e.last_lit]=r&255,e.last_lit++,t===0?e.dyn_ltree[r*2]++:(e.matches++,t--,e.dyn_ltree[(xn[r]+bn+1)*2]++,e.dyn_dtree[pc(t)*2]++),e.last_lit===e.lit_bufsize-1);var am=rm,sm=xc,cm=im,lm=om,um=nm,dm={_tr_init:am,_tr_stored_block:sm,_tr_flush_block:cm,_tr_tally:lm,_tr_align:um},En=(e,t,r,n)=>{let i=e&65535|0,o=e>>>16&65535|0,a=0;for(;r!==0;){a=r>2e3?2e3:r,r-=a;do i=i+t[n++]|0,o=o+i|0;while(--a);i%=65521,o%=65521}return i|o<<16|0};const hm=()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t},fm=new Uint32Array(hm());var Ge=(e,t,r,n)=>{const i=fm,o=n+r;e^=-1;for(let a=n;a<o;a++)e=e>>>8^i[(e^t[a])&255];return e^-1},fr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},pr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:pm,_tr_stored_block:gm,_tr_flush_block:mm,_tr_tally:Xt,_tr_align:vm}=dm,{Z_NO_FLUSH:gr,Z_PARTIAL_FLUSH:wm,Z_FULL_FLUSH:ym,Z_FINISH:Jt,Z_BLOCK:kc,Z_OK:Dt,Z_STREAM_END:Ec,Z_STREAM_ERROR:dt,Z_DATA_ERROR:bm,Z_BUF_ERROR:Xo,Z_DEFAULT_COMPRESSION:_m,Z_FILTERED:Sm,Z_HUFFMAN_ONLY:xi,Z_RLE:Cm,Z_FIXED:xm,Z_DEFAULT_STRATEGY:km,Z_UNKNOWN:Em,Z_DEFLATED:ki}=pr,Rm=9,Dm=15,Am=8,Tm=29,Jo=256+1+Tm,Pm=30,Im=19,Fm=2*Jo+1,$m=15,Re=3,Yt=258,wt=Yt+Re+1,Om=32,Ei=42,Yo=69,Ri=73,Di=91,Ai=103,mr=113,Rn=666,Ve=1,Dn=2,vr=3,Hr=4,Um=3,er=(e,t)=>(e.msg=fr[t],t),Rc=e=>(e<<1)-(e>4?9:0),tr=e=>{let t=e.length;for(;--t>=0;)e[t]=0};let rr=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const nr=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},Ke=(e,t)=>{mm(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,nr(e.strm)},Te=(e,t)=>{e.pending_buf[e.pending++]=t},An=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255},Nm=(e,t,r,n)=>{let i=e.avail_in;return i>n&&(i=n),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),r),e.state.wrap===1?e.adler=En(e.adler,t,i,r):e.state.wrap===2&&(e.adler=Ge(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)},Dc=(e,t)=>{let r=e.max_chain_length,n=e.strstart,i,o,a=e.prev_length,s=e.nice_match;const u=e.strstart>e.w_size-wt?e.strstart-(e.w_size-wt):0,c=e.window,d=e.w_mask,f=e.prev,h=e.strstart+Yt;let p=c[n+a-1],g=c[n+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do if(i=t,!(c[i+a]!==g||c[i+a-1]!==p||c[i]!==c[n]||c[++i]!==c[n+1])){n+=2,i++;do;while(c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&n<h);if(o=Yt-(h-n),n=h-Yt,o>a){if(e.match_start=t,a=o,o>=s)break;p=c[n+a-1],g=c[n+a]}}while((t=f[t&d])>u&&--r!=0);return a<=e.lookahead?a:e.lookahead},wr=e=>{const t=e.w_size;let r,n,i,o,a;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-wt)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,n=e.hash_size,r=n;do i=e.head[--r],e.head[r]=i>=t?i-t:0;while(--n);n=t,r=n;do i=e.prev[--r],e.prev[r]=i>=t?i-t:0;while(--n);o+=t}if(e.strm.avail_in===0)break;if(n=Nm(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=n,e.lookahead+e.insert>=Re)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=rr(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=rr(e,e.ins_h,e.window[a+Re-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<Re)););}while(e.lookahead<wt&&e.strm.avail_in!==0)},Mm=(e,t)=>{let r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(wr(e),e.lookahead===0&&t===gr)return Ve;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;const n=e.block_start+r;if((e.strstart===0||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,Ke(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-wt&&(Ke(e,!1),e.strm.avail_out===0))return Ve}return e.insert=0,t===Jt?(Ke(e,!0),e.strm.avail_out===0?vr:Hr):(e.strstart>e.block_start&&(Ke(e,!1),e.strm.avail_out===0),Ve)},ea=(e,t)=>{let r,n;for(;;){if(e.lookahead<wt){if(wr(e),e.lookahead<wt&&t===gr)return Ve;if(e.lookahead===0)break}if(r=0,e.lookahead>=Re&&(e.ins_h=rr(e,e.ins_h,e.window[e.strstart+Re-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-wt&&(e.match_length=Dc(e,r)),e.match_length>=Re)if(n=Xt(e,e.strstart-e.match_start,e.match_length-Re),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=Re){e.match_length--;do e.strstart++,e.ins_h=rr(e,e.ins_h,e.window[e.strstart+Re-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=rr(e,e.ins_h,e.window[e.strstart+1]);else n=Xt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(Ke(e,!1),e.strm.avail_out===0))return Ve}return e.insert=e.strstart<Re-1?e.strstart:Re-1,t===Jt?(Ke(e,!0),e.strm.avail_out===0?vr:Hr):e.last_lit&&(Ke(e,!1),e.strm.avail_out===0)?Ve:Dn},Wr=(e,t)=>{let r,n,i;for(;;){if(e.lookahead<wt){if(wr(e),e.lookahead<wt&&t===gr)return Ve;if(e.lookahead===0)break}if(r=0,e.lookahead>=Re&&(e.ins_h=rr(e,e.ins_h,e.window[e.strstart+Re-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=Re-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-wt&&(e.match_length=Dc(e,r),e.match_length<=5&&(e.strategy===Sm||e.match_length===Re&&e.strstart-e.match_start>4096)&&(e.match_length=Re-1)),e.prev_length>=Re&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-Re,n=Xt(e,e.strstart-1-e.prev_match,e.prev_length-Re),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=rr(e,e.ins_h,e.window[e.strstart+Re-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=Re-1,e.strstart++,n&&(Ke(e,!1),e.strm.avail_out===0))return Ve}else if(e.match_available){if(n=Xt(e,0,e.window[e.strstart-1]),n&&Ke(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return Ve}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Xt(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<Re-1?e.strstart:Re-1,t===Jt?(Ke(e,!0),e.strm.avail_out===0?vr:Hr):e.last_lit&&(Ke(e,!1),e.strm.avail_out===0)?Ve:Dn},Lm=(e,t)=>{let r,n,i,o;const a=e.window;for(;;){if(e.lookahead<=Yt){if(wr(e),e.lookahead<=Yt&&t===gr)return Ve;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=Re&&e.strstart>0&&(i=e.strstart-1,n=a[i],n===a[++i]&&n===a[++i]&&n===a[++i])){o=e.strstart+Yt;do;while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<o);e.match_length=Yt-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=Re?(r=Xt(e,1,e.match_length-Re),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Xt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(Ke(e,!1),e.strm.avail_out===0))return Ve}return e.insert=0,t===Jt?(Ke(e,!0),e.strm.avail_out===0?vr:Hr):e.last_lit&&(Ke(e,!1),e.strm.avail_out===0)?Ve:Dn},Bm=(e,t)=>{let r;for(;;){if(e.lookahead===0&&(wr(e),e.lookahead===0)){if(t===gr)return Ve;break}if(e.match_length=0,r=Xt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(Ke(e,!1),e.strm.avail_out===0))return Ve}return e.insert=0,t===Jt?(Ke(e,!0),e.strm.avail_out===0?vr:Hr):e.last_lit&&(Ke(e,!1),e.strm.avail_out===0)?Ve:Dn};function At(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}const Tn=[new At(0,0,0,0,Mm),new At(4,4,8,4,ea),new At(4,5,16,8,ea),new At(4,6,32,32,ea),new At(4,4,16,16,Wr),new At(8,16,32,32,Wr),new At(8,16,128,128,Wr),new At(8,32,128,256,Wr),new At(32,128,258,1024,Wr),new At(32,258,258,4096,Wr)],Hm=e=>{e.window_size=2*e.w_size,tr(e.head),e.max_lazy_match=Tn[e.level].max_lazy,e.good_match=Tn[e.level].good_length,e.nice_match=Tn[e.level].nice_length,e.max_chain_length=Tn[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=Re-1,e.match_available=0,e.ins_h=0};function Wm(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ki,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Fm*2),this.dyn_dtree=new Uint16Array((2*Pm+1)*2),this.bl_tree=new Uint16Array((2*Im+1)*2),tr(this.dyn_ltree),tr(this.dyn_dtree),tr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array($m+1),this.heap=new Uint16Array(2*Jo+1),tr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Jo+1),tr(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ac=e=>{if(!e||!e.state)return er(e,dt);e.total_in=e.total_out=0,e.data_type=Em;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?Ei:mr,e.adler=t.wrap===2?0:1,t.last_flush=gr,pm(t),Dt},Tc=e=>{const t=Ac(e);return t===Dt&&Hm(e.state),t},zm=(e,t)=>!e||!e.state||e.state.wrap!==2?dt:(e.state.gzhead=t,Dt),Pc=(e,t,r,n,i,o)=>{if(!e)return dt;let a=1;if(t===_m&&(t=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),i<1||i>Rm||r!==ki||n<8||n>15||t<0||t>9||o<0||o>xm)return er(e,dt);n===8&&(n=9);const s=new Wm;return e.state=s,s.strm=e,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+Re-1)/Re),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=(1+2)*s.lit_bufsize,s.level=t,s.strategy=o,s.method=r,Tc(e)},jm=(e,t)=>Pc(e,t,ki,Dm,Am,km),qm=(e,t)=>{let r,n;if(!e||!e.state||t>kc||t<0)return e?er(e,dt):dt;const i=e.state;if(!e.output||!e.input&&e.avail_in!==0||i.status===Rn&&t!==Jt)return er(e,e.avail_out===0?Xo:dt);i.strm=e;const o=i.last_flush;if(i.last_flush=t,i.status===Ei)if(i.wrap===2)e.adler=0,Te(i,31),Te(i,139),Te(i,8),i.gzhead?(Te(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Te(i,i.gzhead.time&255),Te(i,i.gzhead.time>>8&255),Te(i,i.gzhead.time>>16&255),Te(i,i.gzhead.time>>24&255),Te(i,i.level===9?2:i.strategy>=xi||i.level<2?4:0),Te(i,i.gzhead.os&255),i.gzhead.extra&&i.gzhead.extra.length&&(Te(i,i.gzhead.extra.length&255),Te(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=Ge(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=Yo):(Te(i,0),Te(i,0),Te(i,0),Te(i,0),Te(i,0),Te(i,i.level===9?2:i.strategy>=xi||i.level<2?4:0),Te(i,Um),i.status=mr);else{let a=ki+(i.w_bits-8<<4)<<8,s=-1;i.strategy>=xi||i.level<2?s=0:i.level<6?s=1:i.level===6?s=2:s=3,a|=s<<6,i.strstart!==0&&(a|=Om),a+=31-a%31,i.status=mr,An(i,a),i.strstart!==0&&(An(i,e.adler>>>16),An(i,e.adler&65535)),e.adler=1}if(i.status===Yo)if(i.gzhead.extra){for(r=i.pending;i.gzindex<(i.gzhead.extra.length&65535)&&!(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=Ge(e.adler,i.pending_buf,i.pending-r,r)),nr(e),r=i.pending,i.pending===i.pending_buf_size));)Te(i,i.gzhead.extra[i.gzindex]&255),i.gzindex++;i.gzhead.hcrc&&i.pending>r&&(e.adler=Ge(e.adler,i.pending_buf,i.pending-r,r)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=Ri)}else i.status=Ri;if(i.status===Ri)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=Ge(e.adler,i.pending_buf,i.pending-r,r)),nr(e),r=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.name.length?n=i.gzhead.name.charCodeAt(i.gzindex++)&255:n=0,Te(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>r&&(e.adler=Ge(e.adler,i.pending_buf,i.pending-r,r)),n===0&&(i.gzindex=0,i.status=Di)}else i.status=Di;if(i.status===Di)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=Ge(e.adler,i.pending_buf,i.pending-r,r)),nr(e),r=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.comment.length?n=i.gzhead.comment.charCodeAt(i.gzindex++)&255:n=0,Te(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>r&&(e.adler=Ge(e.adler,i.pending_buf,i.pending-r,r)),n===0&&(i.status=Ai)}else i.status=Ai;if(i.status===Ai&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&nr(e),i.pending+2<=i.pending_buf_size&&(Te(i,e.adler&255),Te(i,e.adler>>8&255),e.adler=0,i.status=mr)):i.status=mr),i.pending!==0){if(nr(e),e.avail_out===0)return i.last_flush=-1,Dt}else if(e.avail_in===0&&Rc(t)<=Rc(o)&&t!==Jt)return er(e,Xo);if(i.status===Rn&&e.avail_in!==0)return er(e,Xo);if(e.avail_in!==0||i.lookahead!==0||t!==gr&&i.status!==Rn){let a=i.strategy===xi?Bm(i,t):i.strategy===Cm?Lm(i,t):Tn[i.level].func(i,t);if((a===vr||a===Hr)&&(i.status=Rn),a===Ve||a===vr)return e.avail_out===0&&(i.last_flush=-1),Dt;if(a===Dn&&(t===wm?vm(i):t!==kc&&(gm(i,0,0,!1),t===ym&&(tr(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),nr(e),e.avail_out===0))return i.last_flush=-1,Dt}return t!==Jt?Dt:i.wrap<=0?Ec:(i.wrap===2?(Te(i,e.adler&255),Te(i,e.adler>>8&255),Te(i,e.adler>>16&255),Te(i,e.adler>>24&255),Te(i,e.total_in&255),Te(i,e.total_in>>8&255),Te(i,e.total_in>>16&255),Te(i,e.total_in>>24&255)):(An(i,e.adler>>>16),An(i,e.adler&65535)),nr(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Dt:Ec)},Vm=e=>{if(!e||!e.state)return dt;const t=e.state.status;return t!==Ei&&t!==Yo&&t!==Ri&&t!==Di&&t!==Ai&&t!==mr&&t!==Rn?er(e,dt):(e.state=null,t===mr?er(e,bm):Dt)},Gm=(e,t)=>{let r=t.length;if(!e||!e.state)return dt;const n=e.state,i=n.wrap;if(i===2||i===1&&n.status!==Ei||n.lookahead)return dt;if(i===1&&(e.adler=En(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){i===0&&(tr(n.head),n.strstart=0,n.block_start=0,n.insert=0);let u=new Uint8Array(n.w_size);u.set(t.subarray(r-n.w_size,r),0),t=u,r=n.w_size}const o=e.avail_in,a=e.next_in,s=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,wr(n);n.lookahead>=Re;){let u=n.strstart,c=n.lookahead-(Re-1);do n.ins_h=rr(n,n.ins_h,n.window[u+Re-1]),n.prev[u&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=u,u++;while(--c);n.strstart=u,n.lookahead=Re-1,wr(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=Re-1,n.match_available=0,e.next_in=a,e.input=s,e.avail_in=o,n.wrap=i,Dt};var Zm=jm,Km=Pc,Qm=Tc,Xm=Ac,Jm=zm,Ym=qm,ev=Vm,tv=Gm,rv="pako deflate (from Nodeca project)",Pn={deflateInit:Zm,deflateInit2:Km,deflateReset:Qm,deflateResetKeep:Xm,deflateSetHeader:Jm,deflate:Ym,deflateEnd:ev,deflateSetDictionary:tv,deflateInfo:rv};const nv=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var iv=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(!!r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)nv(r,n)&&(e[n]=r[n])}}return e},ov=e=>{let t=0;for(let n=0,i=e.length;n<i;n++)t+=e[n].length;const r=new Uint8Array(t);for(let n=0,i=0,o=e.length;n<o;n++){let a=e[n];r.set(a,i),i+=a.length}return r},Ti={assign:iv,flattenChunks:ov};let Ic=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Ic=!1}const In=new Uint8Array(256);for(let e=0;e<256;e++)In[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;In[254]=In[254]=1;var av=e=>{let t,r,n,i,o,a=e.length,s=0;for(i=0;i<a;i++)r=e.charCodeAt(i),(r&64512)==55296&&i+1<a&&(n=e.charCodeAt(i+1),(n&64512)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(s),o=0,i=0;o<s;i++)r=e.charCodeAt(i),(r&64512)==55296&&i+1<a&&(n=e.charCodeAt(i+1),(n&64512)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|r&63):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|r&63):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|r&63);return t};const sv=(e,t)=>{if(t<65534&&e.subarray&&Ic)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r};var cv=(e,t)=>{let r,n;const i=t||e.length,o=new Array(i*2);for(n=0,r=0;r<i;){let a=e[r++];if(a<128){o[n++]=a;continue}let s=In[a];if(s>4){o[n++]=65533,r+=s-1;continue}for(a&=s===2?31:s===3?15:7;s>1&&r<i;)a=a<<6|e[r++]&63,s--;if(s>1){o[n++]=65533;continue}a<65536?o[n++]=a:(a-=65536,o[n++]=55296|a>>10&1023,o[n++]=56320|a&1023)}return sv(o,n)},lv=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(e[r]&192)==128;)r--;return r<0||r===0?t:r+In[e[r]]>t?r:t},Fn={string2buf:av,buf2string:cv,utf8border:lv};function uv(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Fc=uv;const $c=Object.prototype.toString,{Z_NO_FLUSH:dv,Z_SYNC_FLUSH:hv,Z_FULL_FLUSH:fv,Z_FINISH:pv,Z_OK:Pi,Z_STREAM_END:gv,Z_DEFAULT_COMPRESSION:mv,Z_DEFAULT_STRATEGY:vv,Z_DEFLATED:wv}=pr;function $n(e){this.options=Ti.assign({level:mv,method:wv,chunkSize:16384,windowBits:15,memLevel:8,strategy:vv},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Fc,this.strm.avail_out=0;let r=Pn.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Pi)throw new Error(fr[r]);if(t.header&&Pn.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(typeof t.dictionary=="string"?n=Fn.string2buf(t.dictionary):$c.call(t.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(t.dictionary):n=t.dictionary,r=Pn.deflateSetDictionary(this.strm,n),r!==Pi)throw new Error(fr[r]);this._dict_set=!0}}$n.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let i,o;if(this.ended)return!1;for(t===~~t?o=t:o=t===!0?pv:dv,typeof e=="string"?r.input=Fn.string2buf(e):$c.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(o===hv||o===fv)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(i=Pn.deflate(r,o),i===gv)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=Pn.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Pi;if(r.avail_out===0){this.onData(r.output);continue}if(o>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0},$n.prototype.onData=function(e){this.chunks.push(e)},$n.prototype.onEnd=function(e){e===Pi&&(this.result=Ti.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function ta(e,t){const r=new $n(t);if(r.push(e,!0),r.err)throw r.msg||fr[r.err];return r.result}function yv(e,t){return t=t||{},t.raw=!0,ta(e,t)}function bv(e,t){return t=t||{},t.gzip=!0,ta(e,t)}var _v=$n,Sv=ta,Cv=yv,xv=bv,kv=pr,Ev={Deflate:_v,deflate:Sv,deflateRaw:Cv,gzip:xv,constants:kv};const Ii=30,Rv=12;var Dv=function(t,r){let n,i,o,a,s,u,c,d,f,h,p,g,w,_,D,C,U,F,z,ue,Q,de,we,he;const pe=t.state;n=t.next_in,we=t.input,i=n+(t.avail_in-5),o=t.next_out,he=t.output,a=o-(r-t.avail_out),s=o+(t.avail_out-257),u=pe.dmax,c=pe.wsize,d=pe.whave,f=pe.wnext,h=pe.window,p=pe.hold,g=pe.bits,w=pe.lencode,_=pe.distcode,D=(1<<pe.lenbits)-1,C=(1<<pe.distbits)-1;e:do{g<15&&(p+=we[n++]<<g,g+=8,p+=we[n++]<<g,g+=8),U=w[p&D];t:for(;;){if(F=U>>>24,p>>>=F,g-=F,F=U>>>16&255,F===0)he[o++]=U&65535;else if(F&16){z=U&65535,F&=15,F&&(g<F&&(p+=we[n++]<<g,g+=8),z+=p&(1<<F)-1,p>>>=F,g-=F),g<15&&(p+=we[n++]<<g,g+=8,p+=we[n++]<<g,g+=8),U=_[p&C];r:for(;;){if(F=U>>>24,p>>>=F,g-=F,F=U>>>16&255,F&16){if(ue=U&65535,F&=15,g<F&&(p+=we[n++]<<g,g+=8,g<F&&(p+=we[n++]<<g,g+=8)),ue+=p&(1<<F)-1,ue>u){t.msg="invalid distance too far back",pe.mode=Ii;break e}if(p>>>=F,g-=F,F=o-a,ue>F){if(F=ue-F,F>d&&pe.sane){t.msg="invalid distance too far back",pe.mode=Ii;break e}if(Q=0,de=h,f===0){if(Q+=c-F,F<z){z-=F;do he[o++]=h[Q++];while(--F);Q=o-ue,de=he}}else if(f<F){if(Q+=c+f-F,F-=f,F<z){z-=F;do he[o++]=h[Q++];while(--F);if(Q=0,f<z){F=f,z-=F;do he[o++]=h[Q++];while(--F);Q=o-ue,de=he}}}else if(Q+=f-F,F<z){z-=F;do he[o++]=h[Q++];while(--F);Q=o-ue,de=he}for(;z>2;)he[o++]=de[Q++],he[o++]=de[Q++],he[o++]=de[Q++],z-=3;z&&(he[o++]=de[Q++],z>1&&(he[o++]=de[Q++]))}else{Q=o-ue;do he[o++]=he[Q++],he[o++]=he[Q++],he[o++]=he[Q++],z-=3;while(z>2);z&&(he[o++]=he[Q++],z>1&&(he[o++]=he[Q++]))}}else if((F&64)==0){U=_[(U&65535)+(p&(1<<F)-1)];continue r}else{t.msg="invalid distance code",pe.mode=Ii;break e}break}}else if((F&64)==0){U=w[(U&65535)+(p&(1<<F)-1)];continue t}else if(F&32){pe.mode=Rv;break e}else{t.msg="invalid literal/length code",pe.mode=Ii;break e}break}}while(n<i&&o<s);z=g>>3,n-=z,g-=z<<3,p&=(1<<g)-1,t.next_in=n,t.next_out=o,t.avail_in=n<i?5+(i-n):5-(n-i),t.avail_out=o<s?257+(s-o):257-(o-s),pe.hold=p,pe.bits=g};const zr=15,Oc=852,Uc=592,Nc=0,ra=1,Mc=2,Av=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Tv=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Pv=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Iv=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var On=(e,t,r,n,i,o,a,s)=>{const u=s.bits;let c=0,d=0,f=0,h=0,p=0,g=0,w=0,_=0,D=0,C=0,U,F,z,ue,Q,de=null,we=0,he;const pe=new Uint16Array(zr+1),st=new Uint16Array(zr+1);let pt=null,gt=0,Vt,lt,St;for(c=0;c<=zr;c++)pe[c]=0;for(d=0;d<n;d++)pe[t[r+d]]++;for(p=u,h=zr;h>=1&&pe[h]===0;h--);if(p>h&&(p=h),h===0)return i[o++]=1<<24|64<<16|0,i[o++]=1<<24|64<<16|0,s.bits=1,0;for(f=1;f<h&&pe[f]===0;f++);for(p<f&&(p=f),_=1,c=1;c<=zr;c++)if(_<<=1,_-=pe[c],_<0)return-1;if(_>0&&(e===Nc||h!==1))return-1;for(st[1]=0,c=1;c<zr;c++)st[c+1]=st[c]+pe[c];for(d=0;d<n;d++)t[r+d]!==0&&(a[st[t[r+d]]++]=d);if(e===Nc?(de=pt=a,he=19):e===ra?(de=Av,we-=257,pt=Tv,gt-=257,he=256):(de=Pv,pt=Iv,he=-1),C=0,d=0,c=f,Q=o,g=p,w=0,z=-1,D=1<<p,ue=D-1,e===ra&&D>Oc||e===Mc&&D>Uc)return 1;for(;;){Vt=c-w,a[d]<he?(lt=0,St=a[d]):a[d]>he?(lt=pt[gt+a[d]],St=de[we+a[d]]):(lt=32+64,St=0),U=1<<c-w,F=1<<g,f=F;do F-=U,i[Q+(C>>w)+F]=Vt<<24|lt<<16|St|0;while(F!==0);for(U=1<<c-1;C&U;)U>>=1;if(U!==0?(C&=U-1,C+=U):C=0,d++,--pe[c]==0){if(c===h)break;c=t[r+a[d]]}if(c>p&&(C&ue)!==z){for(w===0&&(w=p),Q+=f,g=c-w,_=1<<g;g+w<h&&(_-=pe[g+w],!(_<=0));)g++,_<<=1;if(D+=1<<g,e===ra&&D>Oc||e===Mc&&D>Uc)return 1;z=C&ue,i[z]=p<<24|g<<16|Q-o|0}}return C!==0&&(i[Q+C]=c-w<<24|64<<16|0),s.bits=p,0};const Fv=0,Lc=1,Bc=2,{Z_FINISH:Hc,Z_BLOCK:$v,Z_TREES:Fi,Z_OK:yr,Z_STREAM_END:Ov,Z_NEED_DICT:Uv,Z_STREAM_ERROR:ht,Z_DATA_ERROR:Wc,Z_MEM_ERROR:zc,Z_BUF_ERROR:Nv,Z_DEFLATED:jc}=pr,qc=1,Vc=2,Gc=3,Zc=4,Kc=5,Qc=6,Xc=7,Jc=8,Yc=9,el=10,$i=11,Wt=12,na=13,tl=14,ia=15,rl=16,nl=17,il=18,ol=19,Oi=20,Ui=21,al=22,sl=23,cl=24,ll=25,ul=26,oa=27,dl=28,hl=29,We=30,fl=31,Mv=32,Lv=852,Bv=592,Hv=15,pl=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function Wv(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const gl=e=>{if(!e||!e.state)return ht;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=qc,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(Lv),t.distcode=t.distdyn=new Int32Array(Bv),t.sane=1,t.back=-1,yr},ml=e=>{if(!e||!e.state)return ht;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,gl(e)},vl=(e,t)=>{let r;if(!e||!e.state)return ht;const n=e.state;return t<0?(r=0,t=-t):(r=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?ht:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,ml(e))},wl=(e,t)=>{if(!e)return ht;const r=new Wv;e.state=r,r.window=null;const n=vl(e,t);return n!==yr&&(e.state=null),n},zv=e=>wl(e,Hv);let yl=!0,aa,sa;const jv=e=>{if(yl){aa=new Int32Array(512),sa=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(On(Lc,e.lens,0,288,aa,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;On(Bc,e.lens,0,32,sa,0,e.work,{bits:5}),yl=!1}e.lencode=aa,e.lenbits=9,e.distcode=sa,e.distbits=5},bl=(e,t,r,n)=>{let i;const o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(t.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(t.subarray(r-n,r-n+i),o.wnext),n-=i,n?(o.window.set(t.subarray(r-n,r),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0},qv=(e,t)=>{let r,n,i,o,a,s,u,c,d,f,h,p,g,w,_=0,D,C,U,F,z,ue,Q,de;const we=new Uint8Array(4);let he,pe;const st=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return ht;r=e.state,r.mode===Wt&&(r.mode=na),a=e.next_out,i=e.output,u=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,c=r.hold,d=r.bits,f=s,h=u,de=yr;e:for(;;)switch(r.mode){case qc:if(r.wrap===0){r.mode=na;break}for(;d<16;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}if(r.wrap&2&&c===35615){r.check=0,we[0]=c&255,we[1]=c>>>8&255,r.check=Ge(r.check,we,2,0),c=0,d=0,r.mode=Vc;break}if(r.flags=0,r.head&&(r.head.done=!1),!(r.wrap&1)||(((c&255)<<8)+(c>>8))%31){e.msg="incorrect header check",r.mode=We;break}if((c&15)!==jc){e.msg="unknown compression method",r.mode=We;break}if(c>>>=4,d-=4,Q=(c&15)+8,r.wbits===0)r.wbits=Q;else if(Q>r.wbits){e.msg="invalid window size",r.mode=We;break}r.dmax=1<<r.wbits,e.adler=r.check=1,r.mode=c&512?el:Wt,c=0,d=0;break;case Vc:for(;d<16;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}if(r.flags=c,(r.flags&255)!==jc){e.msg="unknown compression method",r.mode=We;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=We;break}r.head&&(r.head.text=c>>8&1),r.flags&512&&(we[0]=c&255,we[1]=c>>>8&255,r.check=Ge(r.check,we,2,0)),c=0,d=0,r.mode=Gc;case Gc:for(;d<32;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}r.head&&(r.head.time=c),r.flags&512&&(we[0]=c&255,we[1]=c>>>8&255,we[2]=c>>>16&255,we[3]=c>>>24&255,r.check=Ge(r.check,we,4,0)),c=0,d=0,r.mode=Zc;case Zc:for(;d<16;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}r.head&&(r.head.xflags=c&255,r.head.os=c>>8),r.flags&512&&(we[0]=c&255,we[1]=c>>>8&255,r.check=Ge(r.check,we,2,0)),c=0,d=0,r.mode=Kc;case Kc:if(r.flags&1024){for(;d<16;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}r.length=c,r.head&&(r.head.extra_len=c),r.flags&512&&(we[0]=c&255,we[1]=c>>>8&255,r.check=Ge(r.check,we,2,0)),c=0,d=0}else r.head&&(r.head.extra=null);r.mode=Qc;case Qc:if(r.flags&1024&&(p=r.length,p>s&&(p=s),p&&(r.head&&(Q=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(o,o+p),Q)),r.flags&512&&(r.check=Ge(r.check,n,p,o)),s-=p,o+=p,r.length-=p),r.length))break e;r.length=0,r.mode=Xc;case Xc:if(r.flags&2048){if(s===0)break e;p=0;do Q=n[o+p++],r.head&&Q&&r.length<65536&&(r.head.name+=String.fromCharCode(Q));while(Q&&p<s);if(r.flags&512&&(r.check=Ge(r.check,n,p,o)),s-=p,o+=p,Q)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=Jc;case Jc:if(r.flags&4096){if(s===0)break e;p=0;do Q=n[o+p++],r.head&&Q&&r.length<65536&&(r.head.comment+=String.fromCharCode(Q));while(Q&&p<s);if(r.flags&512&&(r.check=Ge(r.check,n,p,o)),s-=p,o+=p,Q)break e}else r.head&&(r.head.comment=null);r.mode=Yc;case Yc:if(r.flags&512){for(;d<16;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}if(c!==(r.check&65535)){e.msg="header crc mismatch",r.mode=We;break}c=0,d=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Wt;break;case el:for(;d<32;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}e.adler=r.check=pl(c),c=0,d=0,r.mode=$i;case $i:if(r.havedict===0)return e.next_out=a,e.avail_out=u,e.next_in=o,e.avail_in=s,r.hold=c,r.bits=d,Uv;e.adler=r.check=1,r.mode=Wt;case Wt:if(t===$v||t===Fi)break e;case na:if(r.last){c>>>=d&7,d-=d&7,r.mode=oa;break}for(;d<3;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}switch(r.last=c&1,c>>>=1,d-=1,c&3){case 0:r.mode=tl;break;case 1:if(jv(r),r.mode=Oi,t===Fi){c>>>=2,d-=2;break e}break;case 2:r.mode=nl;break;case 3:e.msg="invalid block type",r.mode=We}c>>>=2,d-=2;break;case tl:for(c>>>=d&7,d-=d&7;d<32;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}if((c&65535)!=(c>>>16^65535)){e.msg="invalid stored block lengths",r.mode=We;break}if(r.length=c&65535,c=0,d=0,r.mode=ia,t===Fi)break e;case ia:r.mode=rl;case rl:if(p=r.length,p){if(p>s&&(p=s),p>u&&(p=u),p===0)break e;i.set(n.subarray(o,o+p),a),s-=p,o+=p,u-=p,a+=p,r.length-=p;break}r.mode=Wt;break;case nl:for(;d<14;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}if(r.nlen=(c&31)+257,c>>>=5,d-=5,r.ndist=(c&31)+1,c>>>=5,d-=5,r.ncode=(c&15)+4,c>>>=4,d-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=We;break}r.have=0,r.mode=il;case il:for(;r.have<r.ncode;){for(;d<3;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}r.lens[st[r.have++]]=c&7,c>>>=3,d-=3}for(;r.have<19;)r.lens[st[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,he={bits:r.lenbits},de=On(Fv,r.lens,0,19,r.lencode,0,r.work,he),r.lenbits=he.bits,de){e.msg="invalid code lengths set",r.mode=We;break}r.have=0,r.mode=ol;case ol:for(;r.have<r.nlen+r.ndist;){for(;_=r.lencode[c&(1<<r.lenbits)-1],D=_>>>24,C=_>>>16&255,U=_&65535,!(D<=d);){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}if(U<16)c>>>=D,d-=D,r.lens[r.have++]=U;else{if(U===16){for(pe=D+2;d<pe;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}if(c>>>=D,d-=D,r.have===0){e.msg="invalid bit length repeat",r.mode=We;break}Q=r.lens[r.have-1],p=3+(c&3),c>>>=2,d-=2}else if(U===17){for(pe=D+3;d<pe;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}c>>>=D,d-=D,Q=0,p=3+(c&7),c>>>=3,d-=3}else{for(pe=D+7;d<pe;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}c>>>=D,d-=D,Q=0,p=11+(c&127),c>>>=7,d-=7}if(r.have+p>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=We;break}for(;p--;)r.lens[r.have++]=Q}}if(r.mode===We)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=We;break}if(r.lenbits=9,he={bits:r.lenbits},de=On(Lc,r.lens,0,r.nlen,r.lencode,0,r.work,he),r.lenbits=he.bits,de){e.msg="invalid literal/lengths set",r.mode=We;break}if(r.distbits=6,r.distcode=r.distdyn,he={bits:r.distbits},de=On(Bc,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,he),r.distbits=he.bits,de){e.msg="invalid distances set",r.mode=We;break}if(r.mode=Oi,t===Fi)break e;case Oi:r.mode=Ui;case Ui:if(s>=6&&u>=258){e.next_out=a,e.avail_out=u,e.next_in=o,e.avail_in=s,r.hold=c,r.bits=d,Dv(e,h),a=e.next_out,i=e.output,u=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,c=r.hold,d=r.bits,r.mode===Wt&&(r.back=-1);break}for(r.back=0;_=r.lencode[c&(1<<r.lenbits)-1],D=_>>>24,C=_>>>16&255,U=_&65535,!(D<=d);){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}if(C&&(C&240)==0){for(F=D,z=C,ue=U;_=r.lencode[ue+((c&(1<<F+z)-1)>>F)],D=_>>>24,C=_>>>16&255,U=_&65535,!(F+D<=d);){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}c>>>=F,d-=F,r.back+=F}if(c>>>=D,d-=D,r.back+=D,r.length=U,C===0){r.mode=ul;break}if(C&32){r.back=-1,r.mode=Wt;break}if(C&64){e.msg="invalid literal/length code",r.mode=We;break}r.extra=C&15,r.mode=al;case al:if(r.extra){for(pe=r.extra;d<pe;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=sl;case sl:for(;_=r.distcode[c&(1<<r.distbits)-1],D=_>>>24,C=_>>>16&255,U=_&65535,!(D<=d);){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}if((C&240)==0){for(F=D,z=C,ue=U;_=r.distcode[ue+((c&(1<<F+z)-1)>>F)],D=_>>>24,C=_>>>16&255,U=_&65535,!(F+D<=d);){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}c>>>=F,d-=F,r.back+=F}if(c>>>=D,d-=D,r.back+=D,C&64){e.msg="invalid distance code",r.mode=We;break}r.offset=U,r.extra=C&15,r.mode=cl;case cl:if(r.extra){for(pe=r.extra;d<pe;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=We;break}r.mode=ll;case ll:if(u===0)break e;if(p=h-u,r.offset>p){if(p=r.offset-p,p>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=We;break}p>r.wnext?(p-=r.wnext,g=r.wsize-p):g=r.wnext-p,p>r.length&&(p=r.length),w=r.window}else w=i,g=a-r.offset,p=r.length;p>u&&(p=u),u-=p,r.length-=p;do i[a++]=w[g++];while(--p);r.length===0&&(r.mode=Ui);break;case ul:if(u===0)break e;i[a++]=r.length,u--,r.mode=Ui;break;case oa:if(r.wrap){for(;d<32;){if(s===0)break e;s--,c|=n[o++]<<d,d+=8}if(h-=u,e.total_out+=h,r.total+=h,h&&(e.adler=r.check=r.flags?Ge(r.check,i,h,a-h):En(r.check,i,h,a-h)),h=u,(r.flags?c:pl(c))!==r.check){e.msg="incorrect data check",r.mode=We;break}c=0,d=0}r.mode=dl;case dl:if(r.wrap&&r.flags){for(;d<32;){if(s===0)break e;s--,c+=n[o++]<<d,d+=8}if(c!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=We;break}c=0,d=0}r.mode=hl;case hl:de=Ov;break e;case We:de=Wc;break e;case fl:return zc;case Mv:default:return ht}return e.next_out=a,e.avail_out=u,e.next_in=o,e.avail_in=s,r.hold=c,r.bits=d,(r.wsize||h!==e.avail_out&&r.mode<We&&(r.mode<oa||t!==Hc))&&bl(e,e.output,e.next_out,h-e.avail_out),f-=e.avail_in,h-=e.avail_out,e.total_in+=f,e.total_out+=h,r.total+=h,r.wrap&&h&&(e.adler=r.check=r.flags?Ge(r.check,i,h,e.next_out-h):En(r.check,i,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Wt?128:0)+(r.mode===Oi||r.mode===ia?256:0),(f===0&&h===0||t===Hc)&&de===yr&&(de=Nv),de},Vv=e=>{if(!e||!e.state)return ht;let t=e.state;return t.window&&(t.window=null),e.state=null,yr},Gv=(e,t)=>{if(!e||!e.state)return ht;const r=e.state;return(r.wrap&2)==0?ht:(r.head=t,t.done=!1,yr)},Zv=(e,t)=>{const r=t.length;let n,i,o;return!e||!e.state||(n=e.state,n.wrap!==0&&n.mode!==$i)?ht:n.mode===$i&&(i=1,i=En(i,t,r,0),i!==n.check)?Wc:(o=bl(e,t,r,r),o?(n.mode=fl,zc):(n.havedict=1,yr))};var Kv=ml,Qv=vl,Xv=gl,Jv=zv,Yv=wl,ew=qv,tw=Vv,rw=Gv,nw=Zv,iw="pako inflate (from Nodeca project)",zt={inflateReset:Kv,inflateReset2:Qv,inflateResetKeep:Xv,inflateInit:Jv,inflateInit2:Yv,inflate:ew,inflateEnd:tw,inflateGetHeader:rw,inflateSetDictionary:nw,inflateInfo:iw};function ow(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var aw=ow;const _l=Object.prototype.toString,{Z_NO_FLUSH:sw,Z_FINISH:cw,Z_OK:Un,Z_STREAM_END:ca,Z_NEED_DICT:la,Z_STREAM_ERROR:lw,Z_DATA_ERROR:Sl,Z_MEM_ERROR:uw}=pr;function Nn(e){this.options=Ti.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Fc,this.strm.avail_out=0;let r=zt.inflateInit2(this.strm,t.windowBits);if(r!==Un)throw new Error(fr[r]);if(this.header=new aw,zt.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Fn.string2buf(t.dictionary):_l.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=zt.inflateSetDictionary(this.strm,t.dictionary),r!==Un)))throw new Error(fr[r])}Nn.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let o,a,s;if(this.ended)return!1;for(t===~~t?a=t:a=t===!0?cw:sw,_l.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),o=zt.inflate(r,a),o===la&&i&&(o=zt.inflateSetDictionary(r,i),o===Un?o=zt.inflate(r,a):o===Sl&&(o=la));r.avail_in>0&&o===ca&&r.state.wrap>0&&e[r.next_in]!==0;)zt.inflateReset(r),o=zt.inflate(r,a);switch(o){case lw:case Sl:case la:case uw:return this.onEnd(o),this.ended=!0,!1}if(s=r.avail_out,r.next_out&&(r.avail_out===0||o===ca))if(this.options.to==="string"){let u=Fn.utf8border(r.output,r.next_out),c=r.next_out-u,d=Fn.buf2string(r.output,u);r.next_out=c,r.avail_out=n-c,c&&r.output.set(r.output.subarray(u,u+c),0),this.onData(d)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(o===Un&&s===0)){if(o===ca)return o=zt.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},Nn.prototype.onData=function(e){this.chunks.push(e)},Nn.prototype.onEnd=function(e){e===Un&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Ti.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function ua(e,t){const r=new Nn(t);if(r.push(e),r.err)throw r.msg||fr[r.err];return r.result}function dw(e,t){return t=t||{},t.raw=!0,ua(e,t)}var hw=Nn,fw=ua,pw=dw,gw=ua,mw=pr,vw={Inflate:hw,inflate:fw,inflateRaw:pw,ungzip:gw,constants:mw};const{Deflate:ww,deflate:yw,deflateRaw:bw,gzip:_w}=Ev,{Inflate:Sw,inflate:Cw,inflateRaw:xw,ungzip:kw}=vw;var Ew=ww,Rw=yw,Dw=bw,Aw=_w,Tw=Sw,Pw=Cw,Iw=xw,Cl=kw,Fw=pr,ib={Deflate:Ew,deflate:Rw,deflateRaw:Dw,gzip:Aw,Inflate:Tw,inflate:Pw,inflateRaw:Iw,ungzip:Cl,constants:Fw};const ob=null,da=(0,P.loadMessageBundle)(),xl=new TextDecoder,kl=new TextEncoder;class $w{constructor(t,r=0){this.retainFor=r;try{this.weakRef=new WeakRef(t)}catch{}this.retain(t)}retain(t){this.retainTimeout&&clearTimeout(this.retainTimeout),this.strongRef=t,this.retainTimeout=setTimeout(()=>{this.strongRef=void 0,this.retainTimeout=void 0},this.retainFor)}deref(){var t,r;const n=(r=this.strongRef)!=null?r:(t=this.weakRef)==null?void 0:t.deref();return n&&this.retain(n),n}}class Ow{constructor(t){this.root=t,this.ongoingReqests=new Map,this.usageFile=l.Uri.joinPath(this.root,"usageHistory.json"),this._disposable=l.Disposable.from(...this.registerCommands()),this.updateHasIndexesContext()}async updateHasIndexesContext(){return $o(wn.HasSearchIndexes,(await this.listTars()).length>0)}dispose(){this._disposable.dispose()}registerCommands(){return[l.commands.registerCommand("remoteHub.enableIndexing",async()=>{const t={title:da("search download prompt allow","Allow")},r={title:da("search download prompt cancel","Cancel"),isCloseAffordance:!0};if(await l.window.showInformationMessage(da("search download prompt",`In order to provide full-text search capabilities, a local index of the repository must be created.

Do you want to allow a local index to be created? This can be configured with the "Repo Limit" and "Size Limit" settings of Remote Repositories`),{modal:!0},t,r)===t)return await Ce.update("search.download.enabled",!0,l.ConfigurationTarget.Global),{triggerSearch:!0}}),l.commands.registerCommand("remoteHub.deleteLocalRepositoryData",async()=>{const t=i=>{const o=[{power:9,name:"GB"},{power:6,name:"MB"},{power:3,name:"kB"},{power:0,name:"B"}];for(const a of o)if(i>10**a.power)return`${Math.round(i/10**a.power)} ${a.name}`;return"Unknown size"},r=await this.listTars();if(r.length===0){await l.window.showInformationMessage("No Search Indexes Found");return}const n=l.window.createQuickPick();n.canSelectMany=!0,n.items=r.map(({name:i,size:o,path:a})=>({label:i,path:a,description:o?t(o):void 0})),n.show(),n.onDidAccept(async()=>{n.hide();for(const{label:i,path:o}of n.selectedItems){const a=l.workspace.fs.delete(o),s=l.window.setStatusBarMessage(`$(loading) Deleting ${i}`,a);await a,s.dispose()}this.updateHasIndexesContext()}),n.onDidHide(()=>n.dispose())}),l.commands.registerCommand("remoteHub.deleteAllLocalRepositoryData",()=>l.window.withProgress({location:l.ProgressLocation.Notification,title:"Deleting Search Indexes..."},async()=>{await Promise.all([l.workspace.fs.delete(this.root,{recursive:!0})]),this.updateHasIndexesContext()}))]}getTarFromMemory(t){var r;if(t===this.lastReadKey){const n=(r=this.lastReadValue)==null?void 0:r.deref();if(n)return n;q.log("Weakref deallocated.")}}async getTarFromDisk(t){try{const r=await l.workspace.fs.readFile(t);return!r||!r.length?void 0:r}catch(r){if(r.code!=="FileNotFound")throw r;return}}async getTarFromNetwork(t,r){if(Ce.get("search.download.enabled")!==!0)throw Error("Unable to search without an index");const n=await t.getTarGz(r);if(n===void 0)throw Error("Unable to search without an index");return this.updateHasIndexesContext(),n}async getTar(t,r){const{repo:n,HEAD:{sha:i}}=await t.getMetadata(r),o=Object.values(n),a=`${o.join("/")}/${i}`,s=Date.now(),u=()=>`${Date.now()-s}ms`,c=l.Uri.joinPath(this.root,"tars",...o,i),d=c.toString(),f=this.ongoingReqests.get(d);if(q.log(`Geting .tar for ${a}`),f)return f;const h=(async()=>{const p=this.getTarFromMemory(d);if(p)return q.log(`Got .tar from memory in ${u()}`),p;let g=await this.getTarFromDisk(c);if((g==null?void 0:g.length)?q.log(`Got .tar.gz from disk in ${u()}`):(g=await this.getTarFromNetwork(t,r),q.log(`Got .tar.gz from network in ${u()}`),l.workspace.fs.writeFile(c,g).then(()=>q.debug(`Sucessfully wrote tarball to disk in ${u()}`),D=>q.error(D,`Error writing tarball to disk in ${u()}`))),!g||!g.length)throw Error("Internal Error: Invalid search index. Try deleting repository data and running search again: `RemoteHub: Delete Local Repository Data...`");const w=Rl("unzip",()=>Cl(g)),_=Rl("readTar",()=>(0,Lg.t9)(w));return _.entries=_.entries.filter(D=>{var C;return((C=D.header.typeFlag)==null?void 0:C.name)==="Normal"}),_.entries.forEach(D=>{D.header.fullFileName=D.header.fullFileName.replace(/^[^/]+/,"")}),this.lastReadValue=new $w(_,Number(Date.now())-s),this.lastReadKey=d,_})();return h.finally(()=>(this.ongoingReqests.delete(d),this.markCacheEntryUsed(`${a}`).catch(p=>q.log(`Error marking entry used: ${p}`)))).finally(()=>this.cleanUpCache().catch(p=>q.log(`Error cleaning cache: ${p}`))),this.ongoingReqests.set(d,h),h}async readDir(t){try{return(await l.workspace.fs.readDirectory(t)).map(r=>l.Uri.joinPath(t,r[0]))}catch{return[]}}async listTars(){const t=await this.readDir(l.Uri.joinPath(this.root,"tars")).catch(()=>[]),r=(await Promise.all(t.map(i=>this.readDir(i)))).flat(),n=(await Promise.all(r.map(i=>this.readDir(i)))).flat();return Promise.all(n.map(async i=>({name:i.path.replace(/^.*\/tars\//,""),path:i,size:(await l.workspace.fs.stat(i)).size})))}async markCacheEntryUsed(t){let r;try{r=JSON.parse(xl.decode(await l.workspace.fs.readFile(this.usageFile)))}catch(n){q.log("Error reading usage data.",n),r={}}r[t]=Number(Date.now()),await l.workspace.fs.writeFile(this.usageFile,kl.encode(JSON.stringify(r)))}async cleanUpCache(){var t,r;q.log("Cleaning up search cache...");const n=await this.listTars();let i;try{i=JSON.parse(xl.decode(await l.workspace.fs.readFile(this.usageFile)))}catch(f){q.log("Error reading usage data. All existing indexes will be discarded.",f),i={}}const o=[];n.forEach(f=>{var h;const p=/^([^/]*\/[^/]*)\//.exec(f.name);if(!p)throw Error("Unexpected repo entry");const g=p[1],w=(h=i[f.name])!=null?h:0;o.push({...f,lastUsed:w,repo:g})}),o.sort((f,h)=>h.lastUsed-f.lastUsed);let a=0;const s=[],u=new Map,c=(t=Ce.get("search.download.sizeLimit"))!=null?t:100,d=(r=Ce.get("search.download.repoLimit"))!=null?r:4;o.forEach(f=>{var h,p;(f.lastUsed===0||a>c||((h=u.get(f.repo))!=null?h:0)>d)&&s.push(f),a+=f.size,u.set(f.repo,((p=u.get(f.repo))!=null?p:0)+1)}),await Promise.all(s.map(async f=>{await l.workspace.fs.delete(f.path),delete i[f.name],q.log(`Deleted cache entry for ${f.name}`)})),await l.workspace.fs.writeFile(this.usageFile,kl.encode(JSON.stringify(i))),await this.updateHasIndexesContext()}}async function El(e,t,r,n,i,o,a){return ha("provideTextSearchResults",async()=>{const s=Ug(n.pattern,Boolean(n.isRegExp),{matchCase:n.isCaseSensitive,wholeWord:n.isWordMatch,multiline:n.isMultiline,global:!0}),u=await ha("fetch tarball",async()=>l.window.withProgress({location:l.ProgressLocation.Window},_=>(_.report({message:"Fetching index..."}),r.getTar(e,i.folder))));if(a.isCancellationRequested)return{limitHit:!1};const{maxResults:c,maxFileSize:d,includes:f,excludes:h}=i,p=await Uw(e.getVirtualUri(i.folder),u,t);if(a.isCancellationRequested)return{limitHit:!0};let g=c;const w=Ng(p,f,h,d);return ha("searchFiles",async()=>{var _,D;let C=0;for(const U of p){if(!w.has(U.path))continue;const F=Mg(U.contents,U.path,s,{beforeContext:(_=i.beforeContext)!=null?_:0,afterContext:(D=i.afterContext)!=null?D:0,previewOptions:i.previewOptions,remainingResultQuota:g});for(const z of F)o.report({...z,uri:l.Uri.joinPath(i.folder,z.uri.path)});if(g-=F.length,g<=0)return{limitHit:!0};if(C++,C%1e4==0&&(await new Promise(z=>setTimeout(z,0)),a.isCancellationRequested))return{limitHit:!1}}return{limitHit:!1}})})}async function Uw(e,t,r){const n=t.entries,i=await r.getChanges(e,{predicate:c=>c.fileType===l.FileType.File});if(i.length===0)return n.map(c=>({contents:c.dataAsBytes,path:c.header.fullFileName,size:c.dataAsBytes.byteLength}));const o=await Promise.all(Tr(i,c=>{if(c.type===xe.Created)return r.getContent(c.uri).then(d=>({path:c.uri.path,size:d.length,contents:d}))})),a=await Promise.all(Tr(i,c=>{if(c.type===xe.Changed)return r.getContent(c.uri).then(d=>({path:c.uri.path,size:d.length,contents:d}))})),s=new Set(Dp(Pr(a,c=>c.path),Tr(i,c=>{if(c.type===xe.Deleted)return c.uri.path})));return[...Tr(n,c=>{if(!s.has(c.header.fullFileName))return{contents:c.dataAsBytes,path:c.header.fullFileName,size:c.dataAsBytes.byteLength}}),...o,...a]}function Rl(e,t){const r=Date.now(),n=t();return q.log(`${e} time: ${Date.now()-r}`),n}async function ha(e,t){const r=Date.now(),n=await t();return q.log(`${e} time: ${Date.now()-r}`),n}const fa=(0,P.loadMessageBundle)(),Nw={dispose:()=>{}},Mw=/(\/|\\)/g,Mn=class{constructor(e,t,r,n){this.providerService=e,this.azdo=t,this.changeStore=r,this.tarPit=n,this._onDidChangeFile=new l.EventEmitter,this.fsCache=new Map,this.fileSearchCache=new Map,this.pathTypeMap={},this.disposable=l.Disposable.from(l.workspace.registerFileSystemProvider(Mn.scheme,this,{isCaseSensitive:!0,isReadonly:!0}),l.workspace.registerFileSearchProvider(Mn.scheme,this),l.workspace.registerTextSearchProvider(Mn.scheme,this),e.onDidChangeRepository(({repository:i})=>{this.fsCache.clear(),this.updateOpenDocuments([e.getProviderUri(i.uri)])}),e.onDidRefresh(i=>this.updateOpenDocuments(i)))}get onDidChangeFile(){return this._onDidChangeFile.event}dispose(){var e;(e=this.disposable)==null||e.dispose()}getCache(e){return this.fsCache}updateOpenDocuments(e){const t=this.providerService.getOpenUris(Mn.scheme,e);if(t.length===0)return;const r=t.map(n=>({type:l.FileChangeType.Changed,uri:n}));this._onDidChangeFile.fire(r)}watch(){return Nw}async stat(e){const t=await this.providerService.getMetadata(e);if(!t.path)return{type:l.FileType.Directory,mtime:0,ctime:0,size:0};if(t.path in this.pathTypeMap||await this.updateWorkspaceItemMap(t,!0),t.path in this.pathTypeMap)return this.pathTypeMap[t.path]===l.FileType.Directory?{type:l.FileType.Directory,mtime:0,ctime:0,size:0}:{type:l.FileType.File,mtime:0,ctime:0,size:0};throw l.FileSystemError.FileNotFound()}async updateWorkspaceItemMap(e,t){const r=new Array,n=await this.azdo.getRepoItems(e);for(const i of n){const o=i.path.substring(1);if(o!==e.path||t){const a=i.isFolder===!0?l.FileType.Directory:l.FileType.File;this.pathTypeMap[o]=a,r.push([o,a])}}return r}async readDirectory(e){const t=await this.providerService.getMetadata(e);return this.updateWorkspaceItemMap(t,!1)}createDirectory(e){throw l.FileSystemError.NoPermissions()}async readFile(e){return await this.azdo.getFileContent(e)}writeFile(e,t,r){throw l.FileSystemError.NoPermissions()}delete(e,t){throw l.FileSystemError.NoPermissions()}rename(e,t,r){throw l.FileSystemError.NoPermissions()}copy(e,t,r){throw l.FileSystemError.NoPermissions()}async provideFileSearchResults(e,t,r){let n=this.fileSearchCache.get(t.folder.toString(!0));if(n===void 0){const o=await this.azdo.getRepoFileNames(t.folder);if(o===void 0||r.isCancellationRequested)return[];n=[...Pr(o,a=>Mr.prepareSlow(a))],this.fileSearchCache.set(t.folder.toString(!0),n)}if(t.maxResults===void 0||t.maxResults===0||t.maxResults>=n.length)return n.map(a=>l.Uri.joinPath(t.folder,a.target));const i=Mr.go(e.pattern.replace(Mw,"/"),n,{allowTypo:!0,limit:t.maxResults}).map(o=>l.Uri.joinPath(t.folder,o.target));return Mr.cleanup(),i}async provideTextSearchResults(e,t,r,n){const i=[];if(Ce.get("search.download.enabled"))try{return El(this.providerService,this.changeStore,this.tarPit,e,t,r,n)}catch{i.push({text:fa("index error","Error searching with index, falling back to standard search"),type:l.TextSearchCompleteMessageType.Warning})}i.push({text:fa("enable index","To improve search accuracy, [enable indexing](command:remoteHub.enableIndexing)"),type:l.TextSearchCompleteMessageType.Information,trusted:!0}),(e.isCaseSensitive||e.isRegExp||e.isWordMatch)&&i.push({text:fa("flags not supported","Search flags are not supported by GitHub search. Enable indexing for full search features."),type:l.TextSearchCompleteMessageType.Warning});const o=await this.azdo.searchCodeQuery(e.pattern,t.folder,{maxResults:t.maxResults,context:{before:t.beforeContext,after:t.afterContext}});if(o.warnings&&o.warnings.forEach(s=>{i.push({text:s,type:l.TextSearchCompleteMessageType.Warning})}),o===void 0)return{limitHit:!0,message:i};let a;for(const s of o.matches)a=l.Uri.joinPath(t.folder,s.path),r.report({uri:a,ranges:s.ranges,preview:{text:s.preview,matches:s.matches}});return{limitHit:!1,message:i}}async fsQuery(e,t,r){const n=`${Y(e)}:${Lw(t)}`;let i=r==null?void 0:r.get(n);return i!==void 0||(i=await this.azdo.queryRepositoryObject(e,t),i===void 0?r==null||r.delete(n):r==null||r.set(n,i)),i}};let Dl=Mn;Dl.scheme="azdo";function Lw(e){let t=0;if(e.length===0)return t;let r;const n=e.length;for(let i=0;i<n;i++)r=e.charCodeAt(i),t=(t<<5)-t+r,t|=0;return t}var Bw=ze(9669),Hw=ze.n(Bw);const pa=class{constructor(e){this.storageService=e,this._onDidChange=new l.EventEmitter,this.cache=new Map}get onDidChange(){return this._onDidChange.event}async delete(e){const t=Y(e),r=this.cache.has(t);this.cache.delete(t);try{await this.storageService.delete(this.getStorageKey(t))}catch(n){throw q.error(n,`Failed to delete repository metadata for ${t}`),n}!r||this._onDidChange.fire(e)}async get(e){this.assertMatchingScheme(e);const t=Y(e),r=this.cache.get(t);if(r!==void 0)return r;let n;try{n=this.fromStorage(await this.storageService.get(this.getStorageKey(t)))}catch(i){throw q.error(i,`Failed to get repository metadata for ${t}`),i}return n?this.cache.set(t,{revision:n}):this.cache.delete(t),{revision:n}}async set(e,t,r){this.assertMatchingScheme(e);const n=Y(e);if(r!==void 0&&!this.validate(r))throw new Error(`Metadata validation failed for ${e.toString()}`);const i={revision:t,cachedMetadata:r};this.cache.set(n,i);try{await this.storageService.store(this.getStorageKey(n),this.toStorage(t))}catch(o){throw this.cache.delete(n),q.error(o,`Failed to save repository metadata for ${n}`),o}this._onDidChange.fire(e)}refresh(){this.cache.clear()}validate(e){var t,r,n,i,o,a,s,u;return typeof e.version=="number"&&e.version>=pa.schemaVersion&&typeof e.timestamp=="number"&&typeof((t=e.provider)==null?void 0:t.id)=="string"&&typeof e.provider.name=="string"&&typeof e.name=="string"&&e.repo&&typeof e.user=="string"&&typeof e.accessLevel=="number"&&typeof((r=e.HEAD)==null?void 0:r.type)=="number"&&typeof((n=e.HEAD)==null?void 0:n.name)=="string"&&typeof((i=e.HEAD)==null?void 0:i.sha)=="string"&&(typeof((o=e.HEAD.detached)==null?void 0:o.name)=="string"&&typeof((a=e.HEAD.detached)==null?void 0:a.type)=="number"||typeof((s=e.HEAD.branch)==null?void 0:s.name)=="string")&&typeof((u=e.defaultBranch)==null?void 0:u.name)=="string"&&typeof e.defaultBranch.sha=="string"}assertMatchingScheme(e){if(e.scheme!==Fe.scheme)throw new Error(`Uri scheme '${e.scheme}' must match configured scheme '${Fe.scheme}'; uri=${e.toString()}`)}getStorageKey(e){return`metadata/${e}`}fromStorage(e){if(!e)return;const t=JSON.parse(e,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&n!==null?l.Uri.from(n):n);return t==null?void 0:t.revision}toStorage(e){const t={schemaVersion:pa.storageSchemaVersion,revision:e};return JSON.stringify(t)}};let Ln=pa;Ln.schemaVersion=6,Ln.storageSchemaVersion=1;var nt;(function(e){e[e.Admin=100]="Admin",e[e.Maintain=40]="Maintain",e[e.Write=30]="Write",e[e.Triage=20]="Triage",e[e.Read=10]="Read",e[e.None=0]="None"})(nt||(nt={}));var Be;(function(e){e[e.Branch=0]="Branch",e[e.Tag=1]="Tag",e[e.Commit=2]="Commit"})(Be||(Be={}));const Ww=/^[0-9a-f]{40}$/i;function Al(e){return e!==void 0&&Ww.test(e)}const zw=/^[^/](?!.*\/\.)(?!.*\.\.)(?!.*\/\/)(?!.*@\{)[^\000-\037\177 ~^:?*[\\]+[^./]$/;function jw(e){return zw.test(e)}function Je(e){return e===""||e==="~"||e==="HEAD"?e:e.endsWith("^")?`${e.substr(0,7)}^`:e.substr(0,7)}const yt=(0,P.loadMessageBundle)(),qw=/^https:\/\/([^.]+)\.visualstudio\.com(?:\/defaultcollection)?\/([^/]+)?\/?(?:[^/]+)?\/?(?:\/pullrequest\/(?:\d+))?(?:\/commit\/?([^/^?]+))?\/?/i,Tl=/^https:\/\/dev\.azure\.com(?:\/defaultcollection)?\/([^/]+)?\/?([^/]+)?\/?(?:_git)?\/?([^/]+)?\/?(?:\/pullrequest\/(?:\d+))?(?:\/commit\/?([^/^?]+))?\/?/i,Pl=1;function jr(e){const{scheme:t,metadata:r}=Fe.decodeAuthority(e),[,n,i,o,...a]=e.path.split("/");return{scheme:t,repo:{owner:n,project:i,name:o},path:a.join("/")||"",ref:r==null?void 0:r.ref,idx:r==null?void 0:r.idx}}function Vw(e,t){const{repo:r}=t!=null?t:jr(e);return e.with({path:`/${r.owner}/${r.project}/${r.name}`})}function ab(e,t,r){const{repo:{owner:n,name:i}}=e instanceof Uri?jr(e):e;return Uri.parse(`azdo://${VirtualProviderService.encodeAuthority("azdo",{v:Pl,ref:{type:RepositoryRefType.Commit,id:t}})}/${n}/${i}/${r}`)}class Gw{constructor(t){this.providerService=t}dispose(){}canOpenRemoteUrl(t){const r=qw.exec(t),n=Tl.exec(t);if(r){const[,,,i,,o,,a,,s]=r;switch(i||o||a||s){case"pull":break;case"blob":return qe.File;case"tree":return qe.Branch;case"commit":return qe.Commit;default:return qe.Repository}}else if(n){const[,,,i,,o,,a,,s]=n;switch(i||o||a||s){case"pull":break;case"blob":return qe.File;case"tree":return qe.Branch;case"commit":return qe.Commit;default:return qe.Repository}}}async createWorkspaceForRemoteUrl(t,r=Le.CurrentWindow){const n=Tl.exec(t);if(!n)return;const[,i,o,a,s,u,c,d,f,h,p,g]=n,w=s||c||f||p;let _=u||d||h||g||void 0;if(w==="pull")return this.createWorkspaceForPullRequest(r,i,o,a,_);let D;if(w==="blob"){const F=this.createVirtualUri(Fe.baseVirtualWorkspaceUri,{repo:{owner:i,project:o,name:a}});if(D=_,_=void 0,D){const ue=(await this.providerService.getBranches(F,{query:D.split("/")[0]})).branches.map(Q=>`${Q.name}/`).sort((Q,de)=>de.length-Q.length);for(const Q of ue)if(D.startsWith(Q)){_=Q.slice(0,-1),D=D.substr(_.length);break}}}const C=this.providerService.createVirtualUri("azdo",{repo:{owner:i,project:o,name:a}});return{name:(await this.providerService.getMetadata(C)).name,uri:C,location:r,filesToOpen:D?[D]:void 0}}async createWorkspaceForPullRequest(t,r,n,i,o){var a,s,u,c;const d=await this.providerService.getPullRequest(this.providerService.createVirtualUri("azdo",{repo:{owner:r,project:n,name:i}}),o);let f;if(d)if((s=(a=d.refs)==null?void 0:a.head)==null?void 0:s.exists)f=this.providerService.createVirtualUri("azdo",{repo:{owner:d.refs.head.owner,project:d.refs.head.repo,name:d.refs.head.repo},ref:{type:Ee.PullRequest,id:d.id}});else if((c=(u=d.refs)==null?void 0:u.base)==null?void 0:c.exists){const h=yt("pr source branch missing prompt confirm","Open Respository"),p=yt("pr source branch missing prompt cancel","Cancel");if(await l.window.showInformationMessage(yt("pr source branch missing prompt",`Unable to find the source branch for pull request #{0}.

Do you want to open the repository on the target branch instead?`,d.id),h,p)!==h)return;f=this.providerService.createVirtualUri("azdo",{repo:{owner:d.refs.base.owner,project:d.refs.base.owner,name:d.refs.base.repo},ref:{type:Ee.PullRequest,id:d.id}})}else{const h=yt("pr branches missing prompt confirm","Open Respository"),p=yt("pr branches missing prompt cancel","Cancel");if(await l.window.showInformationMessage(yt("pr branches missing prompt",`Unable to find either the source or target branch for pull request #{0}.

Do you want to open the repository on the default branch instead?`,d.id),h,p)!==h)return;f=this.providerService.createVirtualUri("azdo",{repo:{owner:r,project:n,name:i}})}else{const h=yt("pr missing prompt confirm","Open Respository"),p=yt("pr missing prompt cancel","Cancel");if(await l.window.showInformationMessage(yt("pr missing prompt",`Unable to find pull request.

Do you want to open the repository on the default branch instead?`),h,p)!==h)return;f=this.providerService.createVirtualUri("azdo",{repo:{owner:r,project:n,name:i}})}return{name:`${r}/${i}`,uri:f,location:t}}createVirtualUri(t,{repo:r,ref:n},i){if((n==null?void 0:n.type)===Ee.Tree)throw new Error(`Invalid ref type '${n.type}'`);const o=n?{v:Pl,ref:{type:n.type,id:n.id}}:void 0;return t.with({authority:Fe.encodeAuthority("azdo",o),path:`/${r.owner}/${r.project}/${r.name}${(i==null?void 0:i.startsWith("/"))?i:i?`/${i}`:""}`})}getRepositoryDescriptor(t){return jr(t).repo}getExternalUri(t){const r=`https://dev.azure.com/${t.repo.owner}/${t.repo.project}/_git/${t.repo.name}`;return l.Uri.parse(r)}getProviderRootUri(t){return Vw(t)}getRelativeFilePath(t,r){const{path:n}=jr(wo(t,r));return n}async createMetadata(t,r){var n,i,o,a;let{repo:{owner:s,project:u,name:c},ref:d}=jr(t);(!d||d.type===Ee.Commit&&/HEAD/i.test(d.id))&&(d={type:Ee.Commit,id:"HEAD"});const f=await this.getRepositoryInfo(s,u,c,d.type===Ee.PullRequest?{ref:"HEAD",pr:Number(d.id)}:{ref:d.id});if(f===void 0)throw new Error(`Cannot get metadata for Uri(${t.toString(!0)}); Unable to get repository info`);let h;if(r)h=r;else if(d.type===Ee.Commit)h=d.id;else if(h=(i=(n=f.ref)==null?void 0:n.sha)!=null?i:f.defaultBranch.sha,h===void 0)throw new Error(`Cannot get metadata for Uri(${t.toString(!0)}); Unable to get repository info`);let p;return((o=f.ref)==null?void 0:o.prefix)==="refs/heads/"?p={type:Be.Branch,name:f.ref.name,sha:h,branch:{name:f.ref.name,sha:f.ref.sha}}:((a=f.ref)==null?void 0:a.prefix)==="refs/tags/"?p={type:Be.Tag,name:f.ref.name,sha:h,detached:{type:Be.Tag,name:f.ref.name}}:p={type:Be.Commit,name:Je(h),sha:h,detached:{type:Be.Commit,name:Je(h)}},{version:Ln.schemaVersion,timestamp:Date.now(),provider:{id:"azdo",name:"Azure Repos"},name:`${f.repo.owner}/${f.repo.name}`,repo:f.repo,user:f.user,accessLevel:f.accessLevel,HEAD:p,defaultBranch:f.defaultBranch,pullRequest:f.pullRequest}}getMetadata(t){return this.providerService.getMetadata(t)}getRemoteWorkspaceSourceProviders(){return[{name:"Azure Repos",icon:"$(rocket)",label:yt("open repo from","Open Repository from {0}","Azure Repos"),placeholder:yt("pick repo","Choose a repository"),provideSources:async(t,r)=>(await this.searchRepositoriesQuery(t!=null?t:"",r)).map(i=>({name:i.repoWithOwner,icon:"$(repo)",description:`${i.fork?i.fork:""}${i.stars>0?`${i.fork?" \u2022 ":""}$(star-full) ${i.stars}`:""}`,detail:i.description,url:i.url}))}]}async createBranch(t,r,n,i){return"TestBranch"}async createCommit(t,r,n,i){throw new Error}async createPullRequest(t,r,n,i,o){throw new Error}async fetch(t,r){const[n,i]=await this.fetchCore(t,{...r,sync:!1});n&&await this.providerService.updateMetadata(t,i)}async fetchCore(t,r){const n=await this.getMetadata(t);return[!1,n]}async fork(t){throw new Error}async getBranches(t,r){return{branches:[]}}async getCommit(t,r){const n={oid:"123",message:"Hey there!",parents:{nodes:[{oid:"231"}]},author:{name:"you",date:"today",email:""},committer:{name:"you",date:"today"}};return{hash:n.oid,message:n.message,parents:n.parents.nodes.map(i=>i.oid),authorDate:new Date(n.author.date),authorEmail:n.author.email,authorName:n.author.name,commitDate:new Date(n.committer.date)}}async getCommits(t,r){try{throw new Error}catch(n){return}}async getFileContent(t,r,n){try{const i=await this.providerService.getMetadata(t),o=i.repo;let a=`https://dev.azure.com/${o.owner}/${o.project}/_apis/git/repositories/${o.name}/items?api-version=6.0`;i.path&&(a=`${a}&path=${i.path}&includeContent=true`);const s=await qr(a);return(s==null?void 0:s.content)?new TextEncoder().encode(s.content):new TextEncoder().encode("404: Unable to retrieve content")}catch(i){throw q.error(i),i}}async getFork(t){throw new Error}async getIncomingChanges(t){return this.getIncomingChangesCore(t,await this.getMetadata(t))}getIncomingChangesCore(t,r){var n,i,o;return((o=(i=(n=r.state)==null?void 0:n.incomingChanges)==null?void 0:i.length)!=null?o:0)===0?[]:r.state.incomingChanges.map(a=>({uri:l.Uri.joinPath(t,a.path),type:a.type}))}async getObjectDetails(t,r,n){throw new Error}async getPullRequest(t,r){throw new Error}async getPullRequestForBranch(t,r,n){throw new Error}async getRepoItems(t){const r=await qr(`https://dev.azure.com/${t.repo.owner}/${t.repo.project}/_apis/git/repositories/${t.repo.name}/items?api-version=6.0&scopePath=${t.path}&recursionLevel=1&includeContentMetadata=true&$format=json`);return r==null?void 0:r.value}async getRepoFileNames(t){try{const r=await this.providerService.getMetadata(t),n=await this.getRepoItems(r);return Tr(n,i=>i.isFolder?void 0:i.path.substr(1))}catch(r){return[]}}async getTags(t,r){return{tags:[]}}async getTarGz(t){throw new Error}async pushCommit(t,r,n,i){throw new Error}async queryRepositoryObject(t,r){}async searchPullRequestsQuery(t){return[]}async searchRepositoriesQuery(t,r){try{const n=await qr("https://dev.azure.com/homitc/AzDODemo/_apis/git/repositories?api-version=6.0");return n==null?void 0:n.value.map(i=>({repoWithOwner:i.name,description:void 0,url:i.webUrl,fork:void 0,stars:0}))}catch(n){return[]}}async searchCodeQuery(t,r,n){return{matches:[],limitHit:!0}}async switchTo(t,r,n){const{name:i,repo:o,HEAD:{branch:a}}=await this.getMetadata(t);if(!(r!==void 0&&(r.startsWith("refs/heads/")?r=r.substr(11):r.startsWith("refs/tags/")&&(r=r.substr(10)),(a==null?void 0:a.name)===r)))return{name:i,uri:void 0,location:(n==null?void 0:n.openInNewWindow)?Le.NewWindow:Le.CurrentWindow}}async sync(t,r,n){}async getRepositoryInfo(t,r,n,i){const o=`https://dev.azure.com/${t}/${r}/_apis/git/repositories/${n}?api-version=6.0`,a=await qr(o);if(!a)return;if(i={ref:a.defaultBranch.split("/").pop()},i.ref){if(Al(i.ref))throw new Error("Not supported yet :(");{const u=`https://dev.azure.com/${t}/${r}/_apis/git/repositories/${n}/stats/branches?name=${i.ref}&api-version=6.0`,c=await qr(u);let d;if(i.ref===a.defaultBranch)d=c;else{const f=`https://dev.azure.com/${t}/${r}/_apis/git/repositories/${n}/stats/branches?name=${i.ref}&api-version=6.0`;d=await qr(f)}if(d){const f={user:"jepetty",repo:{owner:t,project:r,name:n},repoId:a.id,accessLevel:nt.Admin,defaultBranch:{name:i.ref,sha:d==null?void 0:d.commit.commitId}};return c&&(f.ref={name:c.name,sha:c.commit.commitId,prefix:"refs/heads/"}),f}}}else throw new Error("Not supported yet :(")}}var br;(function(e){e.ADMIN="ADMIN",e.MAINTAIN="MAINTAIN",e.WRITE="WRITE",e.TRIAGE="TRIAGE",e.READ="READ",e.NONE="NONE"})(br||(br={}));function sb(e){switch(e){case br.ADMIN:return AccessLevel.Admin;case br.MAINTAIN:return AccessLevel.Maintain;case br.WRITE:return AccessLevel.Write;case br.TRIAGE:return AccessLevel.Triage;case br.READ:return AccessLevel.Read;default:return AccessLevel.None}}async function cb(e,t,r){const{repo:n}=r!=null?r:jr(t);return t.with({path:`/${n.organization}/${n.project}/_git/${n.name}`})}async function qr(e,t){const r=l.Uri.parse(e);return Zw(e)}async function lb(e,t){let r=Uri.parse(e);const n=new URLSearchParams(r.query);return n.set("api-version","5.1"),r=r.with({query:n.toString()}),Kw(r.toString(),t)}async function Zw(e,t){const r=await Hw().get(e,t);if(r.status!==404)return r.data}async function Kw(e,t,r){return(await axios.post(e,r,t)).data}class ub{dispose(){}}class Qw{constructor(t){this.providerService=t,this.providers=[],this.handledRepositories=new Set,this.services=new Map,this.disposable=l.Disposable.from(t.onDidChangeRepositories(r=>{for(const n of r.added)this.repositoryOpened(n);for(const n of r.removed)this.repositoryClosed(n)}));for(const r of this.providerService.repositories)this.repositoryOpened(r)}dispose(){this.disposable.dispose()}register(t){const r=this.providers.length;return this.providers.push(t),{dispose:()=>this.providers.splice(r,1)}}async repositoryOpened(t){const r=Y(t.uri);if(!this.handledRepositories.has(r)){this.handledRepositories.add(r);for(const n of this.providers){const i=await n.createNavigationService(this.providerService,t);if(i!==void 0){const o=i();this.services.set(r,{service:o});break}}}}repositoryClosed(t){const r=Y(t.uri);this.handledRepositories.delete(r);const n=this.services.get(r);n!==void 0&&(n.service.dispose(),this.services.delete(Y(t.uri)))}}/*! (c) Andrea Giammarchi - ISC */var Ni={};try{(function(e,t){if(new e("q=%2B").get("q")!==t||new e({q:t}).get("q")!==t||new e([["q",t]]).get("q")!==t||new e(`q=
`).toString()!=="q=%0A"||new e({q:" &"}).toString()!=="q=+%26"||new e({q:"%zx"}).toString()!=="q=%25zx")throw e;Ni.URLSearchParams=e})(URLSearchParams,"+")}catch(e){(function(t,r,n){"use strict";var i=t.create,o=t.defineProperty,a=/[!'\(\)~]|%20|%00/g,s=/%(?![0-9a-fA-F]{2})/g,u=/\+/g,c={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"},d={append:function(C,U){g(this._ungap,C,U)},delete:function(C){delete this._ungap[C]},get:function(C){return this.has(C)?this._ungap[C][0]:null},getAll:function(C){return this.has(C)?this._ungap[C].slice(0):[]},has:function(C){return C in this._ungap},set:function(C,U){this._ungap[C]=[r(U)]},forEach:function(C,U){var F=this;for(var z in F._ungap)F._ungap[z].forEach(ue,z);function ue(Q){C.call(U,Q,r(z),F)}},toJSON:function(){return{}},toString:function(){var C=[];for(var U in this._ungap)for(var F=_(U),z=0,ue=this._ungap[U];z<ue.length;z++)C.push(F+"="+_(ue[z]));return C.join("&")}};for(var f in d)o(h.prototype,f,{configurable:!0,writable:!0,value:d[f]});Ni.URLSearchParams=h;function h(C){var U=i(null);switch(o(this,"_ungap",{value:U}),!0){case!C:break;case typeof C=="string":C.charAt(0)==="?"&&(C=C.slice(1));for(var F=C.split("&"),z=0,ue=F.length;z<ue;z++){var Q=F[z],de=Q.indexOf("=");-1<de?g(U,w(Q.slice(0,de)),w(Q.slice(de+1))):Q.length&&g(U,w(Q),"")}break;case n(C):for(var z=0,ue=C.length;z<ue;z++){var Q=C[z];g(U,Q[0],Q[1])}break;case"forEach"in C:C.forEach(p,U);break;default:for(var we in C)g(U,we,C[we])}}function p(C,U){g(this,U,C)}function g(C,U,F){var z=n(F)?F.join(","):F;U in C?C[U].push(z):C[U]=[z]}function w(C){return decodeURIComponent(C.replace(s,"%25").replace(u," "))}function _(C){return encodeURIComponent(C).replace(a,D)}function D(C){return c[C]}})(Object,String,Array.isArray)}(function(e){var t=!1;try{t=!!Symbol.iterator}catch(n){}"forEach"in e||(e.forEach=function(i,o){var a=this,s=Object.create(null);this.toString().replace(/=[\s\S]*?(?:&|$)/g,"=").split("=").forEach(function(u){!u.length||u in s||(s[u]=a.getAll(u)).forEach(function(c){i.call(o,c,u,a)})})}),"keys"in e||(e.keys=function(){return r(this,function(i,o){this.push(o)})}),"values"in e||(e.values=function(){return r(this,function(i,o){this.push(i)})}),"entries"in e||(e.entries=function(){return r(this,function(i,o){this.push([o,i])})}),t&&!(Symbol.iterator in e)&&(e[Symbol.iterator]=e.entries),"sort"in e||(e.sort=function(){for(var i=this.entries(),o=i.next(),a=o.done,s=[],u=Object.create(null),c,d,f;!a;)f=o.value,d=f[0],s.push(d),d in u||(u[d]=[]),u[d].push(f[1]),o=i.next(),a=o.done;for(s.sort(),c=0;c<s.length;c++)this.delete(s[c]);for(c=0;c<s.length;c++)d=s[c],this.append(d,u[d].shift())});function r(n,i){var o=[];return n.forEach(i,o),t?o[Symbol.iterator]():{next:function(){var a=o.shift();return{done:a===void 0,value:a}}}}(function(n){var i=n.defineProperty,o=n.getOwnPropertyDescriptor,a=function(f){function h(w,_){e.append.call(this,w,_),w=this.toString(),f.set.call(this._usp,w?"?"+w:"")}function p(w){e.delete.call(this,w),w=this.toString(),f.set.call(this._usp,w?"?"+w:"")}function g(w,_){e.set.call(this,w,_),w=this.toString(),f.set.call(this._usp,w?"?"+w:"")}return function(w,_){return w.append=h,w.delete=p,w.set=g,i(w,"_usp",{configurable:!0,writable:!0,value:_})}},s=function(f){return function(h,p){return i(h,"_searchParams",{configurable:!0,writable:!0,value:f(p,h)}),p}},u=function(f){var h=f.append;f.append=e.append,URLSearchParams.call(f,f._usp.search.slice(1)),f.append=h},c=function(f,h){if(!(f instanceof h))throw new TypeError("'searchParams' accessed on an object that does not implement interface "+h.name)},d=function(f){var h=f.prototype,p=o(h,"searchParams"),g=o(h,"href"),w=o(h,"search"),_;!p&&w&&w.set&&(_=s(a(w)),n.defineProperties(h,{href:{get:function(){return g.get.call(this)},set:function(D){var C=this._searchParams;g.set.call(this,D),C&&u(C)}},search:{get:function(){return w.get.call(this)},set:function(D){var C=this._searchParams;w.set.call(this,D),C&&u(C)}},searchParams:{get:function(){return c(this,f),this._searchParams||_(this,new URLSearchParams(this.search.slice(1)))},set:function(D){c(this,f),_(this,D)}}}))};try{d(HTMLAnchorElement),/^function|object$/.test(typeof URL)&&URL.prototype&&d(URL)}catch(f){}})(Object)})(Ni.URLSearchParams.prototype,Object);const Xw=Ni.URLSearchParams;var Jw=ze(4098),_r=ze.n(Jw),Il,Ye;(function(e){e.None=0,e.First=1,e.AsOld=e.First,e.Last=2,e.AsNew=e.Last})(Ye||(Ye={}));class Yw{constructor(){this[Il]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){var t;return(t=this._head)==null?void 0:t.value}get last(){var t;return(t=this._tail)==null?void 0:t.value}has(t){return this._map.has(t)}get(t,r=Ye.None){const n=this._map.get(t);if(!!n)return r!==Ye.None&&this.touch(n,r),n.value}set(t,r,n=Ye.None){let i=this._map.get(t);if(i)i.value=r,n!==Ye.None&&this.touch(i,n);else{switch(i={key:t,value:r,next:void 0,previous:void 0},n){case Ye.None:this.addItemLast(i);break;case Ye.First:this.addItemFirst(i);break;case Ye.Last:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(t,i),this._size++}return this}delete(t){return Boolean(this.remove(t))}remove(t){const r=this._map.get(t);if(!!r)return this._map.delete(t),this.removeItem(r),this._size--,r.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const t=this._head;return this._map.delete(t.key),this.removeItem(t),this._size--,t.value}forEach(t,r){const n=this._state;let i=this._head;for(;i;){if(r?t.bind(r)(i.value,i.key,this):t(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){const t=this._state;let r=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){const i={value:r.key,done:!1};return r=r.next,i}return{value:void 0,done:!0}}};return n}values(){const t=this._state;let r=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){const i={value:r.value,done:!1};return r=r.next,i}return{value:void 0,done:!0}}};return n}entries(){const t=this._state;let r=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){const i={value:[r.key,r.value],done:!1};return r=r.next,i}return{value:void 0,done:!0}}};return n}[(Il=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(t){if(t>=this.size)return;if(t===0){this.clear();return}let r=this._head,n=this.size;for(;r&&n>t;)this._map.delete(r.key),r=r.next,n--;this._head=r,this._size=n,r&&(r.previous=void 0),this._state++}addItemFirst(t){if(!this._head&&!this._tail)this._tail=t;else if(this._head)t.next=this._head,this._head.previous=t;else throw new Error("Invalid list");this._head=t,this._state++}addItemLast(t){if(!this._head&&!this._tail)this._head=t;else if(this._tail)t.previous=this._tail,this._tail.next=t;else throw new Error("Invalid list");this._tail=t,this._state++}removeItem(t){if(t===this._head&&t===this._tail)this._head=void 0,this._tail=void 0;else if(t===this._head){if(!t.next)throw new Error("Invalid list");t.next.previous=void 0,this._head=t.next}else if(t===this._tail){if(!t.previous)throw new Error("Invalid list");t.previous.next=void 0,this._tail=t.previous}else{const r=t.next,n=t.previous;if(!r||!n)throw new Error("Invalid list");r.previous=n,n.next=r}t.next=void 0,t.previous=void 0,this._state++}touch(t,r){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(r!==Ye.First&&r!==Ye.Last)){if(r===Ye.First){if(t===this._head)return;const n=t.next,i=t.previous;t===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),t.previous=void 0,t.next=this._head,this._head.previous=t,this._head=t,this._state++}else if(r===Ye.Last){if(t===this._tail)return;const n=t.next,i=t.previous;t===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),t.next=void 0,t.previous=this._tail,this._tail.next=t,this._tail=t,this._state++}}}toJSON(){const t=[];return this.forEach((r,n)=>{t.push([n,r])}),t}fromJSON(t){this.clear();for(const[r,n]of t)this.set(r,n)}}class e0 extends Yw{constructor(t,r=1){super();this._limit=t,this._ratio=Math.min(Math.max(0,r),1)}get limit(){return this._limit}set limit(t){this._limit=t,this.checkTrim()}get ratio(){return this._ratio}set ratio(t){this._ratio=Math.min(Math.max(0,t),1),this.checkTrim()}get(t,r=Ye.AsNew){return super.get(t,r)}peek(t){return super.get(t,Ye.None)}set(t,r){return super.set(t,r,Ye.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}}var Fl;(function(e){e.MIN_VALUE=-2147483648,e.MAX_VALUE=2147483647})(Fl||(Fl={}));var Mi;(function(e){e.MIN_VALUE=0,e.MAX_VALUE=2147483647})(Mi||(Mi={}));var Tt;(function(e){function t(n,i){return n===Number.MAX_VALUE&&(n=Mi.MAX_VALUE),i===Number.MAX_VALUE&&(i=Mi.MAX_VALUE),{line:n,character:i}}e.create=t;function r(n){var i=n;return H.objectLiteral(i)&&H.uinteger(i.line)&&H.uinteger(i.character)}e.is=r})(Tt||(Tt={}));var Qe;(function(e){function t(n,i,o,a){if(H.uinteger(n)&&H.uinteger(i)&&H.uinteger(o)&&H.uinteger(a))return{start:Tt.create(n,i),end:Tt.create(o,a)};if(Tt.is(n)&&Tt.is(i))return{start:n,end:i};throw new Error("Range#create called with invalid arguments["+n+", "+i+", "+o+", "+a+"]")}e.create=t;function r(n){var i=n;return H.objectLiteral(i)&&Tt.is(i.start)&&Tt.is(i.end)}e.is=r})(Qe||(Qe={}));var ga;(function(e){function t(n,i){return{uri:n,range:i}}e.create=t;function r(n){var i=n;return H.defined(i)&&Qe.is(i.range)&&(H.string(i.uri)||H.undefined(i.uri))}e.is=r})(ga||(ga={}));var Li;(function(e){function t(n,i,o,a){return{targetUri:n,targetRange:i,targetSelectionRange:o,originSelectionRange:a}}e.create=t;function r(n){var i=n;return H.defined(i)&&Qe.is(i.targetRange)&&H.string(i.targetUri)&&(Qe.is(i.targetSelectionRange)||H.undefined(i.targetSelectionRange))&&(Qe.is(i.originSelectionRange)||H.undefined(i.originSelectionRange))}e.is=r})(Li||(Li={}));var ma;(function(e){function t(n,i,o,a){return{red:n,green:i,blue:o,alpha:a}}e.create=t;function r(n){var i=n;return H.numberRange(i.red,0,1)&&H.numberRange(i.green,0,1)&&H.numberRange(i.blue,0,1)&&H.numberRange(i.alpha,0,1)}e.is=r})(ma||(ma={}));var $l;(function(e){function t(n,i){return{range:n,color:i}}e.create=t;function r(n){var i=n;return Qe.is(i.range)&&ma.is(i.color)}e.is=r})($l||($l={}));var Ol;(function(e){function t(n,i,o){return{label:n,textEdit:i,additionalTextEdits:o}}e.create=t;function r(n){var i=n;return H.string(i.label)&&(H.undefined(i.textEdit)||ir.is(i))&&(H.undefined(i.additionalTextEdits)||H.typedArray(i.additionalTextEdits,ir.is))}e.is=r})(Ol||(Ol={}));var Bn;(function(e){e.Comment="comment",e.Imports="imports",e.Region="region"})(Bn||(Bn={}));var Ul;(function(e){function t(n,i,o,a,s){var u={startLine:n,endLine:i};return H.defined(o)&&(u.startCharacter=o),H.defined(a)&&(u.endCharacter=a),H.defined(s)&&(u.kind=s),u}e.create=t;function r(n){var i=n;return H.uinteger(i.startLine)&&H.uinteger(i.startLine)&&(H.undefined(i.startCharacter)||H.uinteger(i.startCharacter))&&(H.undefined(i.endCharacter)||H.uinteger(i.endCharacter))&&(H.undefined(i.kind)||H.string(i.kind))}e.is=r})(Ul||(Ul={}));var va;(function(e){function t(n,i){return{location:n,message:i}}e.create=t;function r(n){var i=n;return H.defined(i)&&ga.is(i.location)&&H.string(i.message)}e.is=r})(va||(va={}));var Vr;(function(e){e.Error=1,e.Warning=2,e.Information=3,e.Hint=4})(Vr||(Vr={}));var Bi;(function(e){e.Unnecessary=1,e.Deprecated=2})(Bi||(Bi={}));var wa;(function(e){function t(r){var n=r;return n!=null&&H.string(n.href)}e.is=t})(wa||(wa={}));var Hi;(function(e){function t(n,i,o,a,s,u){var c={range:n,message:i};return H.defined(o)&&(c.severity=o),H.defined(a)&&(c.code=a),H.defined(s)&&(c.source=s),H.defined(u)&&(c.relatedInformation=u),c}e.create=t;function r(n){var i,o=n;return H.defined(o)&&Qe.is(o.range)&&H.string(o.message)&&(H.number(o.severity)||H.undefined(o.severity))&&(H.integer(o.code)||H.string(o.code)||H.undefined(o.code))&&(H.undefined(o.codeDescription)||H.string((i=o.codeDescription)===null||i===void 0?void 0:i.href))&&(H.string(o.source)||H.undefined(o.source))&&(H.undefined(o.relatedInformation)||H.typedArray(o.relatedInformation,va.is))}e.is=r})(Hi||(Hi={}));var Hn;(function(e){function t(n,i){for(var o=[],a=2;a<arguments.length;a++)o[a-2]=arguments[a];var s={title:n,command:i};return H.defined(o)&&o.length>0&&(s.arguments=o),s}e.create=t;function r(n){var i=n;return H.defined(i)&&H.string(i.title)&&H.string(i.command)}e.is=r})(Hn||(Hn={}));var ir;(function(e){function t(o,a){return{range:o,newText:a}}e.replace=t;function r(o,a){return{range:{start:o,end:o},newText:a}}e.insert=r;function n(o){return{range:o,newText:""}}e.del=n;function i(o){var a=o;return H.objectLiteral(a)&&H.string(a.newText)&&Qe.is(a.range)}e.is=i})(ir||(ir={}));var Gr;(function(e){function t(n,i,o){var a={label:n};return i!==void 0&&(a.needsConfirmation=i),o!==void 0&&(a.description=o),a}e.create=t;function r(n){var i=n;return i!==void 0&&H.objectLiteral(i)&&H.string(i.label)&&(H.boolean(i.needsConfirmation)||i.needsConfirmation===void 0)&&(H.string(i.description)||i.description===void 0)}e.is=r})(Gr||(Gr={}));var et;(function(e){function t(r){var n=r;return typeof n=="string"}e.is=t})(et||(et={}));var or;(function(e){function t(o,a,s){return{range:o,newText:a,annotationId:s}}e.replace=t;function r(o,a,s){return{range:{start:o,end:o},newText:a,annotationId:s}}e.insert=r;function n(o,a){return{range:o,newText:"",annotationId:a}}e.del=n;function i(o){var a=o;return ir.is(a)&&(Gr.is(a.annotationId)||et.is(a.annotationId))}e.is=i})(or||(or={}));var Wn;(function(e){function t(n,i){return{textDocument:n,edits:i}}e.create=t;function r(n){var i=n;return H.defined(i)&&zi.is(i.textDocument)&&Array.isArray(i.edits)}e.is=r})(Wn||(Wn={}));var Zr;(function(e){function t(n,i,o){var a={kind:"create",uri:n};return i!==void 0&&(i.overwrite!==void 0||i.ignoreIfExists!==void 0)&&(a.options=i),o!==void 0&&(a.annotationId=o),a}e.create=t;function r(n){var i=n;return i&&i.kind==="create"&&H.string(i.uri)&&(i.options===void 0||(i.options.overwrite===void 0||H.boolean(i.options.overwrite))&&(i.options.ignoreIfExists===void 0||H.boolean(i.options.ignoreIfExists)))&&(i.annotationId===void 0||et.is(i.annotationId))}e.is=r})(Zr||(Zr={}));var Kr;(function(e){function t(n,i,o,a){var s={kind:"rename",oldUri:n,newUri:i};return o!==void 0&&(o.overwrite!==void 0||o.ignoreIfExists!==void 0)&&(s.options=o),a!==void 0&&(s.annotationId=a),s}e.create=t;function r(n){var i=n;return i&&i.kind==="rename"&&H.string(i.oldUri)&&H.string(i.newUri)&&(i.options===void 0||(i.options.overwrite===void 0||H.boolean(i.options.overwrite))&&(i.options.ignoreIfExists===void 0||H.boolean(i.options.ignoreIfExists)))&&(i.annotationId===void 0||et.is(i.annotationId))}e.is=r})(Kr||(Kr={}));var Qr;(function(e){function t(n,i,o){var a={kind:"delete",uri:n};return i!==void 0&&(i.recursive!==void 0||i.ignoreIfNotExists!==void 0)&&(a.options=i),o!==void 0&&(a.annotationId=o),a}e.create=t;function r(n){var i=n;return i&&i.kind==="delete"&&H.string(i.uri)&&(i.options===void 0||(i.options.recursive===void 0||H.boolean(i.options.recursive))&&(i.options.ignoreIfNotExists===void 0||H.boolean(i.options.ignoreIfNotExists)))&&(i.annotationId===void 0||et.is(i.annotationId))}e.is=r})(Qr||(Qr={}));var ya;(function(e){function t(r){var n=r;return n&&(n.changes!==void 0||n.documentChanges!==void 0)&&(n.documentChanges===void 0||n.documentChanges.every(function(i){return H.string(i.kind)?Zr.is(i)||Kr.is(i)||Qr.is(i):Wn.is(i)}))}e.is=t})(ya||(ya={}));var Wi=function(){function e(t,r){this.edits=t,this.changeAnnotations=r}return e.prototype.insert=function(t,r,n){var i,o;if(n===void 0?i=ir.insert(t,r):et.is(n)?(o=n,i=or.insert(t,r,n)):(this.assertChangeAnnotations(this.changeAnnotations),o=this.changeAnnotations.manage(n),i=or.insert(t,r,o)),this.edits.push(i),o!==void 0)return o},e.prototype.replace=function(t,r,n){var i,o;if(n===void 0?i=ir.replace(t,r):et.is(n)?(o=n,i=or.replace(t,r,n)):(this.assertChangeAnnotations(this.changeAnnotations),o=this.changeAnnotations.manage(n),i=or.replace(t,r,o)),this.edits.push(i),o!==void 0)return o},e.prototype.delete=function(t,r){var n,i;if(r===void 0?n=ir.del(t):et.is(r)?(i=r,n=or.del(t,r)):(this.assertChangeAnnotations(this.changeAnnotations),i=this.changeAnnotations.manage(r),n=or.del(t,i)),this.edits.push(n),i!==void 0)return i},e.prototype.add=function(t){this.edits.push(t)},e.prototype.all=function(){return this.edits},e.prototype.clear=function(){this.edits.splice(0,this.edits.length)},e.prototype.assertChangeAnnotations=function(t){if(t===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},e}(),Nl=function(){function e(t){this._annotations=t===void 0?Object.create(null):t,this._counter=0,this._size=0}return e.prototype.all=function(){return this._annotations},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),e.prototype.manage=function(t,r){var n;if(et.is(t)?n=t:(n=this.nextId(),r=t),this._annotations[n]!==void 0)throw new Error("Id "+n+" is already in use.");if(r===void 0)throw new Error("No annotation provided for id "+n);return this._annotations[n]=r,this._size++,n},e.prototype.nextId=function(){return this._counter++,this._counter.toString()},e}(),db=function(){function e(t){var r=this;this._textEditChanges=Object.create(null),t!==void 0?(this._workspaceEdit=t,t.documentChanges?(this._changeAnnotations=new Nl(t.changeAnnotations),t.changeAnnotations=this._changeAnnotations.all(),t.documentChanges.forEach(function(n){if(Wn.is(n)){var i=new Wi(n.edits,r._changeAnnotations);r._textEditChanges[n.textDocument.uri]=i}})):t.changes&&Object.keys(t.changes).forEach(function(n){var i=new Wi(t.changes[n]);r._textEditChanges[n]=i})):this._workspaceEdit={}}return Object.defineProperty(e.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),e.prototype.getTextEditChange=function(t){if(zi.is(t)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var r={uri:t.uri,version:t.version},n=this._textEditChanges[r.uri];if(!n){var i=[],o={textDocument:r,edits:i};this._workspaceEdit.documentChanges.push(o),n=new Wi(i,this._changeAnnotations),this._textEditChanges[r.uri]=n}return n}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var n=this._textEditChanges[t];if(!n){var i=[];this._workspaceEdit.changes[t]=i,n=new Wi(i),this._textEditChanges[t]=n}return n}},e.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new Nl,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},e.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},e.prototype.createFile=function(t,r,n){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var i;Gr.is(r)||et.is(r)?i=r:n=r;var o,a;if(i===void 0?o=Zr.create(t,n):(a=et.is(i)?i:this._changeAnnotations.manage(i),o=Zr.create(t,n,a)),this._workspaceEdit.documentChanges.push(o),a!==void 0)return a},e.prototype.renameFile=function(t,r,n,i){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var o;Gr.is(n)||et.is(n)?o=n:i=n;var a,s;if(o===void 0?a=Kr.create(t,r,i):(s=et.is(o)?o:this._changeAnnotations.manage(o),a=Kr.create(t,r,i,s)),this._workspaceEdit.documentChanges.push(a),s!==void 0)return s},e.prototype.deleteFile=function(t,r,n){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var i;Gr.is(r)||et.is(r)?i=r:n=r;var o,a;if(i===void 0?o=Qr.create(t,n):(a=et.is(i)?i:this._changeAnnotations.manage(i),o=Qr.create(t,n,a)),this._workspaceEdit.documentChanges.push(o),a!==void 0)return a},e}(),Ml;(function(e){function t(n){return{uri:n}}e.create=t;function r(n){var i=n;return H.defined(i)&&H.string(i.uri)}e.is=r})(Ml||(Ml={}));var Ll;(function(e){function t(n,i){return{uri:n,version:i}}e.create=t;function r(n){var i=n;return H.defined(i)&&H.string(i.uri)&&H.integer(i.version)}e.is=r})(Ll||(Ll={}));var zi;(function(e){function t(n,i){return{uri:n,version:i}}e.create=t;function r(n){var i=n;return H.defined(i)&&H.string(i.uri)&&(i.version===null||H.integer(i.version))}e.is=r})(zi||(zi={}));var Bl;(function(e){function t(n,i,o,a){return{uri:n,languageId:i,version:o,text:a}}e.create=t;function r(n){var i=n;return H.defined(i)&&H.string(i.uri)&&H.string(i.languageId)&&H.integer(i.version)&&H.string(i.text)}e.is=r})(Bl||(Bl={}));var jt;(function(e){e.PlainText="plaintext",e.Markdown="markdown"})(jt||(jt={})),function(e){function t(r){var n=r;return n===e.PlainText||n===e.Markdown}e.is=t}(jt||(jt={}));var ba;(function(e){function t(r){var n=r;return H.objectLiteral(r)&&jt.is(n.kind)&&H.string(n.value)}e.is=t})(ba||(ba={}));var Hl;(function(e){e.Text=1,e.Method=2,e.Function=3,e.Constructor=4,e.Field=5,e.Variable=6,e.Class=7,e.Interface=8,e.Module=9,e.Property=10,e.Unit=11,e.Value=12,e.Enum=13,e.Keyword=14,e.Snippet=15,e.Color=16,e.File=17,e.Reference=18,e.Folder=19,e.EnumMember=20,e.Constant=21,e.Struct=22,e.Event=23,e.Operator=24,e.TypeParameter=25})(Hl||(Hl={}));var Wl;(function(e){e.PlainText=1,e.Snippet=2})(Wl||(Wl={}));var zl;(function(e){e.Deprecated=1})(zl||(zl={}));var jl;(function(e){function t(n,i,o){return{newText:n,insert:i,replace:o}}e.create=t;function r(n){var i=n;return i&&H.string(i.newText)&&Qe.is(i.insert)&&Qe.is(i.replace)}e.is=r})(jl||(jl={}));var ql;(function(e){e.asIs=1,e.adjustIndentation=2})(ql||(ql={}));var Vl;(function(e){function t(r){return{label:r}}e.create=t})(Vl||(Vl={}));var Gl;(function(e){function t(r,n){return{items:r||[],isIncomplete:!!n}}e.create=t})(Gl||(Gl={}));var ji;(function(e){function t(n){return n.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}e.fromPlainText=t;function r(n){var i=n;return H.string(i)||H.objectLiteral(i)&&H.string(i.language)&&H.string(i.value)}e.is=r})(ji||(ji={}));var Zl;(function(e){function t(r){var n=r;return!!n&&H.objectLiteral(n)&&(ba.is(n.contents)||ji.is(n.contents)||H.typedArray(n.contents,ji.is))&&(r.range===void 0||Qe.is(r.range))}e.is=t})(Zl||(Zl={}));var Kl;(function(e){function t(r,n){return n?{label:r,documentation:n}:{label:r}}e.create=t})(Kl||(Kl={}));var Ql;(function(e){function t(r,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var a={label:r};return H.defined(n)&&(a.documentation=n),H.defined(i)?a.parameters=i:a.parameters=[],a}e.create=t})(Ql||(Ql={}));var zn;(function(e){e.Text=1,e.Read=2,e.Write=3})(zn||(zn={}));var Xl;(function(e){function t(r,n){var i={range:r};return H.number(n)&&(i.kind=n),i}e.create=t})(Xl||(Xl={}));var _a;(function(e){e.File=1,e.Module=2,e.Namespace=3,e.Package=4,e.Class=5,e.Method=6,e.Property=7,e.Field=8,e.Constructor=9,e.Enum=10,e.Interface=11,e.Function=12,e.Variable=13,e.Constant=14,e.String=15,e.Number=16,e.Boolean=17,e.Array=18,e.Object=19,e.Key=20,e.Null=21,e.EnumMember=22,e.Struct=23,e.Event=24,e.Operator=25,e.TypeParameter=26})(_a||(_a={}));var Sa;(function(e){e.Deprecated=1})(Sa||(Sa={}));var Jl;(function(e){function t(r,n,i,o,a){var s={name:r,kind:n,location:{uri:o,range:i}};return a&&(s.containerName=a),s}e.create=t})(Jl||(Jl={}));var Yl;(function(e){function t(n,i,o,a,s,u){var c={name:n,detail:i,kind:o,range:a,selectionRange:s};return u!==void 0&&(c.children=u),c}e.create=t;function r(n){var i=n;return i&&H.string(i.name)&&H.number(i.kind)&&Qe.is(i.range)&&Qe.is(i.selectionRange)&&(i.detail===void 0||H.string(i.detail))&&(i.deprecated===void 0||H.boolean(i.deprecated))&&(i.children===void 0||Array.isArray(i.children))&&(i.tags===void 0||Array.isArray(i.tags))}e.is=r})(Yl||(Yl={}));var Pt;(function(e){e.Empty="",e.QuickFix="quickfix",e.Refactor="refactor",e.RefactorExtract="refactor.extract",e.RefactorInline="refactor.inline",e.RefactorRewrite="refactor.rewrite",e.Source="source",e.SourceOrganizeImports="source.organizeImports",e.SourceFixAll="source.fixAll"})(Pt||(Pt={}));var eu;(function(e){function t(n,i){var o={diagnostics:n};return i!=null&&(o.only=i),o}e.create=t;function r(n){var i=n;return H.defined(i)&&H.typedArray(i.diagnostics,Hi.is)&&(i.only===void 0||H.typedArray(i.only,H.string))}e.is=r})(eu||(eu={}));var tu;(function(e){function t(n,i,o){var a={title:n},s=!0;return typeof i=="string"?(s=!1,a.kind=i):Hn.is(i)?a.command=i:a.edit=i,s&&o!==void 0&&(a.kind=o),a}e.create=t;function r(n){var i=n;return i&&H.string(i.title)&&(i.diagnostics===void 0||H.typedArray(i.diagnostics,Hi.is))&&(i.kind===void 0||H.string(i.kind))&&(i.edit!==void 0||i.command!==void 0)&&(i.command===void 0||Hn.is(i.command))&&(i.isPreferred===void 0||H.boolean(i.isPreferred))&&(i.edit===void 0||ya.is(i.edit))}e.is=r})(tu||(tu={}));var ru;(function(e){function t(n,i){var o={range:n};return H.defined(i)&&(o.data=i),o}e.create=t;function r(n){var i=n;return H.defined(i)&&Qe.is(i.range)&&(H.undefined(i.command)||Hn.is(i.command))}e.is=r})(ru||(ru={}));var nu;(function(e){function t(n,i){return{tabSize:n,insertSpaces:i}}e.create=t;function r(n){var i=n;return H.defined(i)&&H.uinteger(i.tabSize)&&H.boolean(i.insertSpaces)}e.is=r})(nu||(nu={}));var iu;(function(e){function t(n,i,o){return{range:n,target:i,data:o}}e.create=t;function r(n){var i=n;return H.defined(i)&&Qe.is(i.range)&&(H.undefined(i.target)||H.string(i.target))}e.is=r})(iu||(iu={}));var ou;(function(e){function t(n,i){return{range:n,parent:i}}e.create=t;function r(n){var i=n;return i!==void 0&&Qe.is(i.range)&&(i.parent===void 0||e.is(i.parent))}e.is=r})(ou||(ou={}));var hb=null,au;(function(e){function t(o,a,s,u){return new t0(o,a,s,u)}e.create=t;function r(o){var a=o;return!!(H.defined(a)&&H.string(a.uri)&&(H.undefined(a.languageId)||H.string(a.languageId))&&H.uinteger(a.lineCount)&&H.func(a.getText)&&H.func(a.positionAt)&&H.func(a.offsetAt))}e.is=r;function n(o,a){for(var s=o.getText(),u=i(a,function(g,w){var _=g.range.start.line-w.range.start.line;return _===0?g.range.start.character-w.range.start.character:_}),c=s.length,d=u.length-1;d>=0;d--){var f=u[d],h=o.offsetAt(f.range.start),p=o.offsetAt(f.range.end);if(p<=c)s=s.substring(0,h)+f.newText+s.substring(p,s.length);else throw new Error("Overlapping edit");c=h}return s}e.applyEdits=n;function i(o,a){if(o.length<=1)return o;var s=o.length/2|0,u=o.slice(0,s),c=o.slice(s);i(u,a),i(c,a);for(var d=0,f=0,h=0;d<u.length&&f<c.length;){var p=a(u[d],c[f]);p<=0?o[h++]=u[d++]:o[h++]=c[f++]}for(;d<u.length;)o[h++]=u[d++];for(;f<c.length;)o[h++]=c[f++];return o}})(au||(au={}));var t0=function(){function e(t,r,n,i){this._uri=t,this._languageId=r,this._version=n,this._content=i,this._lineOffsets=void 0}return Object.defineProperty(e.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),e.prototype.getText=function(t){if(t){var r=this.offsetAt(t.start),n=this.offsetAt(t.end);return this._content.substring(r,n)}return this._content},e.prototype.update=function(t,r){this._content=t.text,this._version=r,this._lineOffsets=void 0},e.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var t=[],r=this._content,n=!0,i=0;i<r.length;i++){n&&(t.push(i),n=!1);var o=r.charAt(i);n=o==="\r"||o===`
`,o==="\r"&&i+1<r.length&&r.charAt(i+1)===`
`&&i++}n&&r.length>0&&t.push(r.length),this._lineOffsets=t}return this._lineOffsets},e.prototype.positionAt=function(t){t=Math.max(Math.min(t,this._content.length),0);var r=this.getLineOffsets(),n=0,i=r.length;if(i===0)return Tt.create(0,t);for(;n<i;){var o=Math.floor((n+i)/2);r[o]>t?i=o:n=o+1}var a=n-1;return Tt.create(a,t-r[a])},e.prototype.offsetAt=function(t){var r=this.getLineOffsets();if(t.line>=r.length)return this._content.length;if(t.line<0)return 0;var n=r[t.line],i=t.line+1<r.length?r[t.line+1]:this._content.length;return Math.max(Math.min(n+t.character,i),n)},Object.defineProperty(e.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),e}(),H;(function(e){var t=Object.prototype.toString;function r(p){return typeof p!="undefined"}e.defined=r;function n(p){return typeof p=="undefined"}e.undefined=n;function i(p){return p===!0||p===!1}e.boolean=i;function o(p){return t.call(p)==="[object String]"}e.string=o;function a(p){return t.call(p)==="[object Number]"}e.number=a;function s(p,g,w){return t.call(p)==="[object Number]"&&g<=p&&p<=w}e.numberRange=s;function u(p){return t.call(p)==="[object Number]"&&-2147483648<=p&&p<=2147483647}e.integer=u;function c(p){return t.call(p)==="[object Number]"&&0<=p&&p<=2147483647}e.uinteger=c;function d(p){return t.call(p)==="[object Function]"}e.func=d;function f(p){return p!==null&&typeof p=="object"}e.objectLiteral=f;function h(p,g){return Array.isArray(p)&&p.every(g)}e.typedArray=h})(H||(H={}));var jn;(function(e){function t(n){return typeof n=="string"||n instanceof String}e.string=t;function r(n){return typeof n=="number"||n instanceof Number}e.number=r})(jn||(jn={}));var Ca;(function(e){function t(r){const n=r;return n!=null&&(jn.number(n.value)||jn.string(n.value))&&jn.string(n.target)}e.is=t})(Ca||(Ca={}));class r0 extends l.Diagnostic{constructor(t,r,n,i){super(t,r,n);this.data=i,this.hasDiagnosticCode=!1}}var It;(function(e){const t=Object.prototype.toString;function r(d){return typeof d!="undefined"}e.defined=r;function n(d){return d===!0||d===!1}e.boolean=n;function i(d){return t.call(d)==="[object String]"}e.string=i;function o(d){return t.call(d)==="[object Number]"}e.number=o;function a(d){return d!==null&&typeof d=="object"}e.objectLiteral=a;function s(d){return Array.isArray(d)}e.array=s;function u(d){return s(d)&&d.every(f=>i(f))}e.stringArray=u;function c(d,f){return Array.isArray(d)&&d.every(f)}e.typedArray=c})(It||(It={}));var qi;(function(e){function t(r){const n=r;return n&&It.string(n.language)&&It.string(n.value)}e.is=t})(qi||(qi={}));function n0(e){const t=b=>l.Uri.parse(b),r=e!=null?e:t;function n(b){return r(b)}function i(b){return b.map(o)}function o(b){const X=new r0(f(b.range),b.message,p(b.severity),b.data);return b.code!==void 0&&(wa.is(b.codeDescription)?X.code={value:b.code,target:n(b.codeDescription.href)}:Ca.is(b.code)?(X.hasDiagnosticCode=!0,X.code={value:b.code.value,target:n(b.code.target)}):X.code=b.code),b.source&&(X.source=b.source),b.relatedInformation&&(X.relatedInformation=a(b.relatedInformation)),Array.isArray(b.tags)&&(X.tags=u(b.tags)),X}function a(b){return b.map(s)}function s(b){return new l.DiagnosticRelatedInformation(de(b.location),b.message)}function u(b){if(!b)return;const X=[];for(const Se of b){const Xe=c(Se);Xe!==void 0&&X.push(Xe)}return X.length>0?X:void 0}function c(b){switch(b){case Bi.Unnecessary:return l.DiagnosticTag.Unnecessary;case Bi.Deprecated:return l.DiagnosticTag.Deprecated;default:return}}function d(b){if(!!b)return new l.Position(b.line,b.character)}function f(b){if(!!b)return new l.Range(d(b.start),d(b.end))}function h(b){return b.map(X=>f(X))}function p(b){if(b==null)return l.DiagnosticSeverity.Error;switch(b){case Vr.Error:return l.DiagnosticSeverity.Error;case Vr.Warning:return l.DiagnosticSeverity.Warning;case Vr.Information:return l.DiagnosticSeverity.Information;case Vr.Hint:return l.DiagnosticSeverity.Hint}return l.DiagnosticSeverity.Error}function g(b){if(It.string(b))return new l.MarkdownString(b);if(qi.is(b))return new l.MarkdownString().appendCodeblock(b.value,b.language);if(Array.isArray(b)){const Se=[];for(const Xe of b){const Jn=new l.MarkdownString;qi.is(Xe)?Jn.appendCodeblock(Xe.value,Xe.language):Jn.appendMarkdown(Xe),Se.push(Jn)}return Se}let X;switch(b.kind){case jt.Markdown:return new l.MarkdownString(b.value);case jt.PlainText:return X=new l.MarkdownString,X.appendText(b.value),X;default:return X=new l.MarkdownString,X.appendText(`Unsupported Markup content received. Kind is: ${b.kind}`),X}}function w(b){if(It.string(b))return b;switch(b.kind){case jt.Markdown:return new l.MarkdownString(b.value);case jt.PlainText:return b.value;default:return`Unsupported Markup content received. Kind is: ${b.kind}`}}function _(b){if(!!b)return new l.Hover(g(b.contents),f(b.range))}function D(b){if(!!b)return new l.TextEdit(f(b.range),b.newText)}function C(b){if(!!b)return b.map(D)}function U(b){if(!b)return;const X=new l.SignatureHelp;return It.number(b.activeSignature)?X.activeSignature=b.activeSignature:X.activeSignature=0,It.number(b.activeParameter)?X.activeParameter=b.activeParameter:X.activeParameter=0,b.signatures&&(X.signatures=F(b.signatures)),X}function F(b){return b.map(z)}function z(b){const X=new l.SignatureInformation(b.label);return b.documentation!==void 0&&(X.documentation=w(b.documentation)),b.parameters!==void 0&&(X.parameters=ue(b.parameters)),b.activeParameter!==void 0&&(X.activeParameter=b.activeParameter),X}function ue(b){return b.map(Q)}function Q(b){const X=new l.ParameterInformation(b.label);return b.documentation&&(X.documentation=w(b.documentation)),X}function de(b){if(!!b)return new l.Location(r(b.uri),f(b.range))}function we(b){if(!!b)return st(b)}function he(b){if(!!b)return st(b)}function pe(b){if(!b)return;const X={targetUri:r(b.targetUri),targetRange:f(b.targetSelectionRange),originSelectionRange:f(b.originSelectionRange),targetSelectionRange:f(b.targetSelectionRange)};if(!X.targetSelectionRange)throw new Error("targetSelectionRange must not be undefined or null");return X}function st(b){if(!!b)return It.array(b)?b.length===0?[]:Li.is(b[0])?b.map(Xe=>pe(Xe)):b.map(Se=>de(Se)):Li.is(b)?[pe(b)]:de(b)}function pt(b){if(!!b)return b.map(X=>de(X))}function gt(b){if(!!b)return b.map(Vt)}function Vt(b){const X=new l.DocumentHighlight(f(b.range));return It.number(b.kind)&&(X.kind=lt(b.kind)),X}function lt(b){switch(b){case zn.Text:return l.DocumentHighlightKind.Text;case zn.Read:return l.DocumentHighlightKind.Read;case zn.Write:return l.DocumentHighlightKind.Write}return l.DocumentHighlightKind.Text}function St(b,X){if(!!b)return b.map(Se=>ju(Se,X))}function Ct(b){return b<=_a.TypeParameter?b-1:l.SymbolKind.Property}function an(b){switch(b){case Sa.Deprecated:return l.SymbolTag.Deprecated;default:return}}function io(b){if(b==null)return;const X=[];for(const Se of b){const Xe=an(Se);Xe!==void 0&&X.push(Xe)}return X.length===0?void 0:X}function ju(b,X){const Se=new l.SymbolInformation(b.name,Ct(b.kind),f(b.location.range),b.location.uri?r(b.location.uri):X);return qu(Se,b),b.containerName&&(Se.containerName=b.containerName),Se}function _y(b){if(b!=null)return b.map(ja)}function ja(b){var X;const Se=new l.DocumentSymbol(b.name,(X=b.detail)!=null?X:"",Ct(b.kind),f(b.range),f(b.selectionRange));if(qu(Se,b),b.children!==void 0&&b.children.length>0){const Xe=[];for(const Jn of b.children)Xe.push(ja(Jn));Se.children=Xe}return Se}function qu(b,X){b.tags=io(X.tags),X.deprecated&&(b.tags?b.tags.includes(l.SymbolTag.Deprecated)||(b.tags=b.tags.concat(l.SymbolTag.Deprecated)):b.tags=[l.SymbolTag.Deprecated])}function qa(b){const X={title:b.title,command:b.command};return b.arguments&&(X.arguments=b.arguments),X}function Sy(b){if(!!b)return b.map(qa)}const Gt=new Map;Gt.set(Pt.Empty,l.CodeActionKind.Empty),Gt.set(Pt.QuickFix,l.CodeActionKind.QuickFix),Gt.set(Pt.Refactor,l.CodeActionKind.Refactor),Gt.set(Pt.RefactorExtract,l.CodeActionKind.RefactorExtract),Gt.set(Pt.RefactorInline,l.CodeActionKind.RefactorInline),Gt.set(Pt.RefactorRewrite,l.CodeActionKind.RefactorRewrite),Gt.set(Pt.Source,l.CodeActionKind.Source),Gt.set(Pt.SourceOrganizeImports,l.CodeActionKind.SourceOrganizeImports);function Va(b){if(b==null)return;let X=Gt.get(b);if(X)return X;const Se=b.split(".");X=l.CodeActionKind.Empty;for(const Xe of Se)X=X.append(Xe);return X}function Cy(b){if(b!=null)return b.map(X=>Va(X))}function xy(b){if(b==null)return;const X=new l.CodeAction(b.title);return b.kind!==void 0&&(X.kind=Va(b.kind)),b.diagnostics&&(X.diagnostics=i(b.diagnostics)),b.edit&&(X.edit=Vu(b.edit)),b.command&&(X.command=qa(b.command)),b.isPreferred!==void 0&&(X.isPreferred=b.isPreferred),X}function Vu(b){if(!b)return;const X=new l.WorkspaceEdit;return b.documentChanges?b.documentChanges.forEach(Se=>{if(Zr.is(Se))X.createFile(r(Se.uri),Se.options);else if(Kr.is(Se))X.renameFile(r(Se.oldUri),r(Se.newUri),Se.options);else if(Qr.is(Se))X.deleteFile(r(Se.uri),Se.options);else if(Wn.is(Se))X.set(r(Se.textDocument.uri),C(Se.edits));else throw new Error(`Unknown workspace edit change received:
${JSON.stringify(Se,void 0,4)}`)}):b.changes&&Object.keys(b.changes).forEach(Se=>{X.set(r(Se),C(b.changes[Se]))}),X}function Gu(b){return new l.Color(b.red,b.green,b.blue,b.alpha)}function Zu(b){return new l.ColorInformation(f(b.range),Gu(b.color))}function ky(b){if(Array.isArray(b))return b.map(Zu)}function Ku(b){const X=new l.ColorPresentation(b.label);return X.additionalTextEdits=C(b.additionalTextEdits),b.textEdit&&(X.textEdit=D(b.textEdit)),X}function Ey(b){if(Array.isArray(b))return b.map(Ku)}function Qu(b){if(b)switch(b){case Bn.Comment:return l.FoldingRangeKind.Comment;case Bn.Imports:return l.FoldingRangeKind.Imports;case Bn.Region:return l.FoldingRangeKind.Region}}function Xu(b){return new l.FoldingRange(b.startLine,b.endLine,Qu(b.kind))}function Ry(b){if(Array.isArray(b))return b.map(Xu)}function Ga(b){return new l.SelectionRange(f(b.range),b.parent?Ga(b.parent):void 0)}function Dy(b){if(!Array.isArray(b))return[];const X=[];for(const Se of b)X.push(Ga(Se));return X}return{asUri:n,asDiagnostics:i,asDiagnostic:o,asRange:f,asRanges:h,asPosition:d,asDiagnosticSeverity:p,asDiagnosticTag:c,asHover:_,asTextEdit:D,asTextEdits:C,asSignatureHelp:U,asSignatureInformations:F,asSignatureInformation:z,asParameterInformations:ue,asParameterInformation:Q,asDeclarationResult:we,asDefinitionResult:he,asLocation:de,asReferences:pt,asDocumentHighlights:gt,asDocumentHighlight:Vt,asDocumentHighlightKind:lt,asSymbolKind:Ct,asSymbolTag:an,asSymbolTags:io,asSymbolInformations:St,asSymbolInformation:ju,asDocumentSymbols:_y,asDocumentSymbol:ja,asCommand:qa,asCommands:Sy,asCodeAction:xy,asCodeActionKind:Va,asCodeActionKinds:Cy,asWorkspaceEdit:Vu,asFoldingRangeKind:Qu,asFoldingRange:Xu,asFoldingRanges:Ry,asColor:Gu,asColorInformation:Zu,asColorInformations:ky,asColorPresentation:Ku,asColorPresentations:Ey,asSelectionRange:Ga,asSelectionRanges:Dy}}var Ft;(function(e){function t(r=!1){return{hoverProvider:r,declarationProvider:r,definitionProvider:r,typeDefinitionProvider:r,referencesProvider:r,documentSymbolProvider:r,foldingRangeProvider:r,diagnosticProvider:r}}e.create=t})(Ft||(Ft={}));var bt;(function(e){const t="v0.1",r="https://prod.richnav.vsengsaas.visualstudio.com/api";async function n(w,_){const D=await _r()(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});if(D.status===200)return D.json()}async function i(w,_){return(await _r()(w,{method:"Post",body:_})).json()}function o(w,_){return`${r}/${t}/HttpLanguageService/${w}/${_}`}async function a(w){const _=await _r()(`${r}/${t}/WorkspaceSnapshot?commitId=${w}`);if(_.ok)return _.json()}e.getWorkspaceSnapshot=a;async function s(w){const _=new Xw;_.append("uriString",w.toString(!0));const D=await i(`${r}/${t}/WorkspaceSnapshot/latest`,_);if(D!==void 0)return{workspaceId:D.WorkspaceId,snapshotId:D.SnapshotId,commitId:D.commitId}}e.getLatestWorkspaceSnapshot=s;async function u(w,_){return n(o(w,"textDocument/capabilities"),_)}e.capabilities=u;async function c(w,_){return n(o(w,"textDocument/hover"),_)}e.provideHover=c;async function d(w,_){return n(o(w,"textDocument/definition"),_)}e.provideDefinition=d;async function f(w,_){return n(o(w,"textDocument/declaration"),_)}e.provideDeclaration=f;async function h(w,_){return n(o(w,"textDocument/typeDefinition"),_)}e.provideTypeDefinition=h;async function p(w,_){return n(o(w,"textDocument/references"),_)}e.provideReferences=p;async function g(w,_){return n(o(w,"textDocument/foldingRange"),_)}e.providerFoldingRanges=g})(bt||(bt={}));class su{constructor(){}async getBestIndexedCommit(t,r){var n;const i=Fe.decodeAuthority(r).metadata;if(i===void 0||i.idx!=="latest")return;const o=(n=t.getExternalUri)==null?void 0:n.call(t,{repo:t.getRepositoryDescriptor(r)});if(o===void 0)return;const a=await bt.getLatestWorkspaceSnapshot(o);if(a!==void 0)return a.commitId}}class i0{async createNavigationService(t,r){const n=await t.getMetadata(r.uri),i=await bt.getWorkspaceSnapshot(n.HEAD.sha);if(i!==void 0)return()=>new Vi(t,r,i)}}const $t=class{constructor(e,t,r){this.providerService=e,this.repository=t,this.workspaceSnapshot=r,this.metadata=this.providerService.getMetadata(this.repository.uri),this.converter=new Promise((i,o)=>{const a=`vsck://${r.workspaceId}/${this.workspaceSnapshot.snapshotId}/source/`;this.metadata.then(s=>{i(n0(u=>{const c=l.Uri.parse(u);if(s===void 0)return c;let d=c.path;c.toString(!0).startsWith(a)&&(d=c.toString(!0).substr(a.length));try{return this.repository.createRelativeUri(d)}catch(f){return c}}))},o)}),this.registeredFeatures=new Map,this.pendingCapabilitiesRequests=new Map,this.capabilitiesCache=new e0(2048);const n=async i=>{if(Fe.scheme!==i.uri.scheme)return;const o=t.uri,a=i.uri.toString(),s=Y(o);if(!a.startsWith(s)||this.pendingCapabilitiesRequests.has(a))return;const u=await this.getSha();let c=this.capabilitiesCache.get(a);if(c===null)return;if(c===void 0){const g=this.capabilities(i.uri);this.pendingCapabilitiesRequests.set(a,g),c=await g,this.pendingCapabilitiesRequests.delete(a),this.capabilitiesCache.set(a,c===void 0?null:c)}if(c===void 0||!l.workspace.textDocuments.some(g=>g===i))return;const d=i.languageId,h=[{scheme:this.repository.uri.scheme,pattern:i.uri.fsPath,language:i.languageId,exclusive:!0}],p=[];$t.registerCapability(d,"hoverProvider",c)&&p.push(l.languages.registerHoverProvider(h,{provideHover:async(g,w)=>(await this.converter).asHover(await bt.provideHover(u,this.createTextDocumentPositionParams(g.uri,w)))})),$t.registerCapability(d,"definitionProvider",c)&&p.push(l.languages.registerDefinitionProvider(h,{provideDefinition:async(g,w)=>(await this.converter).asDefinitionResult(await bt.provideDefinition(u,this.createTextDocumentPositionParams(g.uri,w)))})),$t.registerCapability(d,"declarationProvider",c)&&p.push(l.languages.registerDeclarationProvider(h,{provideDeclaration:async(g,w)=>(await this.converter).asDeclarationResult(await bt.provideDeclaration(u,this.createTextDocumentPositionParams(g.uri,w)))})),$t.registerCapability(d,"typeDefinitionProvider",c)&&p.push(l.languages.registerTypeDefinitionProvider(h,{provideTypeDefinition:async(g,w)=>(await this.converter).asDefinitionResult(await bt.provideDeclaration(u,this.createTextDocumentPositionParams(g.uri,w)))})),$t.registerCapability(d,"referencesProvider",c)&&p.push(l.languages.registerReferenceProvider(h,{provideReferences:async(g,w,_)=>{const D={position:{line:w.line,character:w.character},textDocument:{uri:this.createDocumentUri(g.uri).toString(!0)},context:{includeDeclaration:_.includeDeclaration}};return(await this.converter).asReferences(await bt.provideReferences(u,D))}})),$t.registerCapability(d,"foldingRangeProvider",c)&&p.push(l.languages.registerFoldingRangeProvider(h,{provideFoldingRanges:async g=>(await this.converter).asFoldingRanges(await bt.providerFoldingRanges(u,this.createTextDocumentParams(g.uri)))})),this.registeredFeatures.set(a,l.Disposable.from(...p)),this.updateStatusBarItem()};l.workspace.onDidOpenTextDocument(n),l.workspace.textDocuments.forEach(n),l.workspace.onDidCloseTextDocument(i=>{const o=i.uri.toString(),a=this.registeredFeatures.get(o);a!==void 0&&(this.registeredFeatures.delete(i.uri.toString()),a.dispose()),this.pendingCapabilitiesRequests.delete(o)}),l.window.onDidChangeActiveTextEditor(()=>{this.updateStatusBarItem()})}static registerCapability(e,t,r){var n;const i=this.disabledCapabilities.get(e);if(i==null?void 0:i[t])return!1;const o=this.localCapabilities.get(e);return(o==null?void 0:o[t])?!1:(n=r[t])!=null?n:!1}dispose(){for(const e of this.registeredFeatures.values())e.dispose();this.registeredFeatures.clear()}async updateStatusBarItem(){const e=l.window.activeTextEditor;if(e===void 0){$t.statusBarItem.hide();return}const t=this.providerService.getVirtualUri(e.document.uri).toString(),r=this.pendingCapabilitiesRequests.get(t);r!==void 0&&(await r,e!==l.window.activeTextEditor)||(this.registeredFeatures.has(t)?$t.statusBarItem.show():$t.statusBarItem.hide())}async capabilities(e){var t;const r=await this.getSha();return(t=await bt.capabilities(r,this.createTextDocumentParams(e)))!=null?t:void 0}provideDocumentSymbols(){return Promise.resolve([])}createTextDocumentParams(e){return{textDocument:{uri:this.createDocumentUri(e).toString(!0)}}}createTextDocumentPositionParams(e,t){return{position:{line:t.line,character:t.character},textDocument:{uri:this.createDocumentUri(e).toString(!0)}}}createDocumentUri(e){const t=this.repository.uri.toString(!0),r=e.toString(!0);return l.Uri.file(r.substr(t.length))}async getSha(){return(await this.metadata).HEAD.sha}};let Vi=$t;Vi.localCapabilities=new Map([["javascript",Object.assign(Ft.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})],["javascriptreact",Object.assign(Ft.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})],["typescript",Object.assign(Ft.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})],["typescriptreact",Object.assign(Ft.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})]]),Vi.disabledCapabilities=new Map([["javascript",Object.assign(Ft.create(),{declarationProvider:!0})],["javascriptreact",Object.assign(Ft.create(),{declarationProvider:!0})],["typescript",Object.assign(Ft.create(),{declarationProvider:!0})],["typescriptreact",Object.assign(Ft.create(),{declarationProvider:!0})]]),Vi.statusBarItem=function(){const e=l.window.createStatusBarItem(l.StatusBarAlignment.Right);return e.text="Indexed",e.tooltip=["The source file is indexed and provides","enhanced code comprehension features","like Go to Declaration and Find all","references."].join(`
`),e.hide(),e}();class o0{constructor(t){this.providerService=t}getProvider(t){return this.providerService.getRegisteredProvider(t)}getProviderUri(t){return this.providerService.getProviderUri(t)}getProviderRootUri(t){return this.providerService.getProviderRootUri(t)}isProviderUri(t,r){return t.scheme!==Fe.scheme&&this.providerService.hasProvider(t,r)}getVirtualUri(t){return this.providerService.getVirtualUri(t)}getVirtualWorkspaceUri(t){return this.providerService.getVirtualWorkspaceUri(t)}}var a0=Object.defineProperty,s0=Object.getOwnPropertyDescriptor,xa=(e,t,r,n)=>{for(var i=n>1?void 0:n?s0(t,r):t,o=e.length-1,a;o>=0;o--)(a=e[o])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&a0(t,r,i),i};const c0={dispose:()=>{}};class Gi{constructor(t,r){this.providerService=t,this.changeStore=r,this._onDidChangeFile=new l.EventEmitter,this.disposable=l.Disposable.from(l.workspace.registerFileSystemProvider(Fe.scheme,this,{isCaseSensitive:!0}),l.workspace.registerFileSearchProvider(Fe.scheme,this),l.workspace.registerTextSearchProvider(Fe.scheme,this),t.onDidChangeRepository(({repository:n})=>this.updateOpenDocuments([n.uri])),t.onDidRefresh(n=>this.updateOpenDocuments(n)),r.onDidChange(n=>{this._onDidChangeFile.fire(n.map(i=>{switch(i.type){case xe.Created:return{type:l.FileChangeType.Created,uri:i.uri};case xe.Changed:return{type:l.FileChangeType.Changed,uri:i.uri};case xe.Deleted:return{type:l.FileChangeType.Deleted,uri:i.uri}}}))}))}get onDidChangeFile(){return this._onDidChangeFile.event}dispose(){var t;(t=this.disposable)==null||t.dispose()}updateOpenDocuments(t){const r=this.providerService.getOpenUris(Fe.scheme,t);if(r.length===0)return;const n=[...r.map(i=>({type:l.FileChangeType.Changed,uri:i})),...t.map(i=>({type:l.FileChangeType.Changed,uri:i}))];this._onDidChangeFile.fire(n)}watch(t,r){return c0}async stat(t){const r=new Ae(`fs.stat(${t.toString()})`,{log:!0});try{let n=await this.changeStore.stat(t);return n!==void 0||(r.log({message:": Provider query"}),n=await this.providerService.stat(this.providerService.getProviderUri(t))),n}finally{r.stop()}}async readDirectory(t){const r=new Ae(`fs.readDirectory(${t.toString()})`,{log:!0});try{let n=await this.providerService.readDirectory(this.providerService.getProviderUri(t));return r.log({message:": Provider query"}),n=await this.changeStore.updateDirectoryEntries(t,n),n}finally{r.stop()}}async createDirectory(t){const r=new Ae(`fs.createDirectory(${t.toString()})`,{log:!0,logLevel:De.Info});try{await this.changeStore.createDirectory(t)}catch(n){throw q.error(n,r.context),n}finally{r.stop()}}async readFile(t){const r=new Ae(`fs.readFile(${t.toString()})`,{log:!0});try{const n=await this.changeStore.readFile(t);return n!==void 0?n:(r.log({message:": ChangeStore query",suffix:" \u2022 Not found; querying provider..."}),await this.providerService.readFile(this.providerService.getProviderUri(t)))}finally{r.stop()}}async writeFile(t,r,n){const i=new Ae(`fs.writeFile(${t.toString()})`,{log:!0,logLevel:De.Info},r.length,n);try{let o;try{if(o=await this.stat(t),!n.overwrite)throw l.FileSystemError.FileExists()}catch(a){if(a instanceof l.FileSystemError&&a.code==="FileNotFound"){if(!n.create)throw l.FileSystemError.FileNotFound()}else throw a}try{if(o===void 0)await this.changeStore.createFile(t,r);else{const a=await this.providerService.readFile(this.providerService.getProviderUri(t));i.log({message:": Provider original query"}),await this.changeStore.writeFile(t,r,a)}}catch(a){throw q.error(a,i.context),a}}finally{i.stop()}}async delete(t,r){const n=new Ae(`fs.delete(${t.toString()})`,{log:!0,logLevel:De.Info},r);try{switch((await this.stat(t)).type){case l.FileType.File:await this.changeStore.deleteFile(t);break;case l.FileType.Directory:{await this.deleteDirectory(t,r);break}default:throw l.FileSystemError.NoPermissions()}}catch(i){throw q.error(i,n.context),i}finally{n.stop()}}async deleteDirectory(t,r){const n=new Ae(`fs.deleteDirectory(${t.toString()})`,{log:!0,logLevel:De.Info},r);try{const i=await this.readDirectory(t);if(i.length!==0){if(!r.recursive&&i.some(([,o])=>o===l.FileType.Directory))throw l.FileSystemError.NoPermissions();for(const[o,a]of i)a===l.FileType.Directory?await this.deleteDirectory(l.Uri.joinPath(t,o),r):await this.changeStore.deleteFile(l.Uri.joinPath(t,o))}await this.changeStore.deleteDirectory(t)}catch(i){throw q.error(i,n.context),i}finally{n.stop()}}async rename(t,r,n){const i=new Ae(`fs.rename(${t.toString()} -> ${r.toString()})`,{log:!0,logLevel:De.Info},n);try{switch((await this.stat(t)).type){case l.FileType.File:{const a=await this.readFile(t);await this.writeFile(r,a,{create:!0,overwrite:n.overwrite}),await this.delete(t,{recursive:!1});break}case l.FileType.Directory:{await this.renameDirectory(t,r,n);break}default:throw l.FileSystemError.NoPermissions()}}catch(o){throw q.error(o,i.context),o}finally{i.stop()}}async renameDirectory(t,r,n){const i=new Ae(`fs.renameDirectory(${t.toString()} -> ${r.toString()})`,{log:!0,logLevel:De.Info},n);try{await this.copyDirectory(t,r,n),await this.delete(t,{recursive:!0})}catch(o){throw q.error(o,i.context),o}finally{i.stop()}}async copy(t,r,n){const i=new Ae(`fs.copy(${t.toString()} -> ${r.toString()})`,{log:!0,logLevel:De.Info},n);try{switch((await this.stat(t)).type){case l.FileType.File:{const a=await this.readFile(t);await this.writeFile(r,a,{create:!0,overwrite:n.overwrite});break}case l.FileType.Directory:{await this.copyDirectory(t,r,n);break}default:throw l.FileSystemError.NoPermissions()}}catch(o){throw q.error(o,i.context),o}finally{i.stop()}}async copyDirectory(t,r,n){const i=new Ae(`fs.copyDirectory(${t.toString()} -> ${r.toString()})`,{log:!0,logLevel:De.Info},n);try{if(await this.exists(r))throw l.FileSystemError.FileExists();try{await this.createDirectory(r);const o=await this.readDirectory(t);for(const[a,s]of o)s===l.FileType.Directory?await this.copyDirectory(l.Uri.joinPath(t,a),l.Uri.joinPath(r,a),n):await this.copy(l.Uri.joinPath(t,a),l.Uri.joinPath(r,a),n)}catch(o){throw q.error(o,i.context),o}}finally{i.stop()}}async exists(t){try{return await this.stat(t),!0}catch(r){if(r instanceof l.FileSystemError&&r.code==="FileNotFound")return!1;throw r}}provideFileSearchResults(t,r,n){return this.providerService.provideFileSearchResults(t,{...r,folder:this.providerService.getProviderUri(r.folder)},n)}provideTextSearchResults(t,r,n,i){return this.providerService.provideTextSearchResults(t,{...r,folder:this.providerService.getProviderUri(r.folder)},{report:o=>n.report({...o,uri:this.providerService.getVirtualUri(o.uri)})},i)}}xa([xt()],Gi.prototype,"stat",1),xa([xt()],Gi.prototype,"readDirectory",1),xa([xt()],Gi.prototype,"readFile",1);const ka=(0,P.loadMessageBundle)(),l0={dispose:()=>{}},u0=/(\/|\\)/g,d0=new TextEncoder,Xr=class{constructor(e,t,r,n){this.providerService=e,this.github=t,this.changeStore=r,this.tarPit=n,this._onDidChangeFile=new l.EventEmitter,this.fsCache=new Map,this.contentCache=new Map,this.fileSearchCache=new Map,this.disposable=l.Disposable.from(l.workspace.registerFileSystemProvider(Xr.scheme,this,{isCaseSensitive:!0,isReadonly:!0}),l.workspace.registerFileSearchProvider(Xr.scheme,this),l.workspace.registerTextSearchProvider(Xr.scheme,this),l.workspace.onDidCloseTextDocument(i=>this.onTextDocumentClosed(i.uri)),e.onDidChangeRepository(({repository:i})=>{this.clearCaches(),this.updateOpenDocuments([e.getProviderUri(i.uri)])}),e.onDidRefresh(i=>{this.clearCaches(),this.updateOpenDocuments(i)}))}get onDidChangeFile(){return this._onDidChangeFile.event}dispose(){var e;(e=this.disposable)==null||e.dispose()}clearCaches(){this.fsCache.clear(),this.contentCache.clear()}onTextDocumentClosed(e){e.scheme===Xr.scheme&&this.contentCache.delete(Y(e))}updateOpenDocuments(e){const t=this.providerService.getOpenUris(Xr.scheme,e);if(t.length===0)return;const r=t.map(n=>({type:l.FileChangeType.Changed,uri:n}));this._onDidChangeFile.fire(r)}watch(){return l0}async stat(e){var t,r,n;const i=await this.fsQuery(e,"stat",`__typename
				...on Blob {
					byteSize
				}`,this.fsCache);if(i===void 0&&e.query!=="~")throw l.FileSystemError.FileNotFound();const o=await this.providerService.getMetadata(e);return{type:lu((t=i==null?void 0:i.__typename)!=null?t:"blob"),size:(r=i==null?void 0:i.byteSize)!=null?r:0,ctime:0,mtime:(n=o==null?void 0:o.timestamp)!=null?n:Date.now()}}async readDirectory(e){var t;const r=await this.fsQuery(e,"readDirectory",`... on Tree {
					entries {
						name
						type
					}
				}`,this.fsCache);return((t=r==null?void 0:r.entries)!=null?t:[]).map(n=>[n.name,lu(n.type)])}createDirectory(e){throw l.FileSystemError.NoPermissions()}async readFile(e){var t,r;const n=Y(e);let i=(t=this.contentCache.get(n))==null?void 0:t.content;if(i!==void 0)return i;const o=await this.fsQuery(e,"readFile",`... on Blob {
			oid
			isBinary
			isTruncated
			text
		}`);return(o==null?void 0:o.isBinary)||(o==null?void 0:o.isTruncated)?i=await this.github.getFileContent(e):i=d0.encode((r=o==null?void 0:o.text)!=null?r:""),this.contentCache.set(n,{content:i,timestamp:Date.now()}),i}writeFile(e,t,r){throw l.FileSystemError.NoPermissions()}delete(e,t){throw l.FileSystemError.NoPermissions()}rename(e,t,r){throw l.FileSystemError.NoPermissions()}copy(e,t,r){throw l.FileSystemError.NoPermissions()}async provideFileSearchResults(e,t,r){let n=this.fileSearchCache.get(t.folder.toString(!0));if(n===void 0){const o=await this.github.getRepoFileNames(t.folder);if(o===void 0||r.isCancellationRequested)return[];n=[...Pr(o,a=>Mr.prepareSlow(a))],this.fileSearchCache.set(t.folder.toString(!0),n)}if(t.maxResults===void 0||t.maxResults===0||t.maxResults>=n.length)return n.map(a=>l.Uri.joinPath(t.folder,a.target));const i=Mr.go(e.pattern.replace(u0,"/"),n,{allowTypo:!0,limit:t.maxResults}).map(o=>l.Uri.joinPath(t.folder,o.target));return Mr.cleanup(),i}async provideTextSearchResults(e,t,r,n){const i=[];if(Ce.get("search.download.enabled"))try{return El(this.providerService,this.changeStore,this.tarPit,e,t,r,n)}catch{i.push({text:ka("index error","Error searching with index, falling back to standard search"),type:l.TextSearchCompleteMessageType.Warning})}i.push({text:ka("enable index","To improve search accuracy, [enable indexing](command:remoteHub.enableIndexing)"),type:l.TextSearchCompleteMessageType.Information,trusted:!0}),(e.isCaseSensitive||e.isRegExp||e.isWordMatch)&&i.push({text:ka("flags not supported","Search flags are not supported by GitHub search. Enable indexing for full search features."),type:l.TextSearchCompleteMessageType.Warning});const o=await this.github.searchCodeQuery(e.pattern,t.folder,{maxResults:t.maxResults,context:{before:t.beforeContext,after:t.afterContext}});if(o.warnings&&o.warnings.forEach(s=>{i.push({text:s,type:l.TextSearchCompleteMessageType.Warning})}),o===void 0)return{limitHit:!0,message:i};let a;for(const s of o.matches)a=l.Uri.joinPath(t.folder,s.path),r.report({uri:a,ranges:s.ranges,preview:{text:s.preview,matches:s.matches}});return{limitHit:!1,message:i}}async fsQuery(e,t,r,n){if(n===void 0)return this.github.queryRepositoryObject(e,t,r);const i=`${t}:${Y(this.providerService.getCanonicalUri(e))}`;let o=n==null?void 0:n.get(i);return o!==void 0||(o=await this.github.queryRepositoryObject(e,t,r),n==null||n.set(i,o===void 0?null:o)),o!=null?o:void 0}};let cu=Xr;cu.scheme="github";function lu(e){switch(e&&(e=e.toLocaleLowerCase()),e){case"blob":return l.FileType.File;case"tree":return l.FileType.Directory;default:return l.FileType.Unknown}}function Zi(){return typeof navigator=="object"&&"userAgent"in navigator?navigator.userAgent:typeof process=="object"&&"version"in process?`Node.js/${process.version.substr(1)} (${process.platform}; ${process.arch})`:"<environment undetectable>"}var h0=ze(5186);/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function uu(e){return Object.prototype.toString.call(e)==="[object Object]"}function du(e){var t,r;return uu(e)===!1?!1:(t=e.constructor,t===void 0?!0:(r=t.prototype,!(uu(r)===!1||r.hasOwnProperty("isPrototypeOf")===!1)))}function f0(e){return e?Object.keys(e).reduce((t,r)=>(t[r.toLowerCase()]=e[r],t),{}):{}}function hu(e,t){const r=Object.assign({},e);return Object.keys(t).forEach(n=>{du(t[n])?n in e?r[n]=hu(e[n],t[n]):Object.assign(r,{[n]:t[n]}):Object.assign(r,{[n]:t[n]})}),r}function fu(e){for(const t in e)e[t]===void 0&&delete e[t];return e}function Ea(e,t,r){if(typeof t=="string"){let[i,o]=t.split(" ");r=Object.assign(o?{method:i,url:o}:{url:i},r)}else r=Object.assign({},t);r.headers=f0(r.headers),fu(r),fu(r.headers);const n=hu(e||{},r);return e&&e.mediaType.previews.length&&(n.mediaType.previews=e.mediaType.previews.filter(i=>!n.mediaType.previews.includes(i)).concat(n.mediaType.previews)),n.mediaType.previews=n.mediaType.previews.map(i=>i.replace(/-preview/,"")),n}function p0(e,t){const r=/\?/.test(e)?"&":"?",n=Object.keys(t);return n.length===0?e:e+r+n.map(i=>i==="q"?"q="+t.q.split("+").map(encodeURIComponent).join("+"):`${i}=${encodeURIComponent(t[i])}`).join("&")}const g0=/\{[^}]+\}/g;function m0(e){return e.replace(/^\W+|\W+$/g,"").split(/,/)}function v0(e){const t=e.match(g0);return t?t.map(m0).reduce((r,n)=>r.concat(n),[]):[]}function pu(e,t){return Object.keys(e).filter(r=>!t.includes(r)).reduce((r,n)=>(r[n]=e[n],r),{})}function gu(e){return e.split(/(%[0-9A-Fa-f]{2})/g).map(function(t){return/%[0-9A-Fa-f]/.test(t)||(t=encodeURI(t).replace(/%5B/g,"[").replace(/%5D/g,"]")),t}).join("")}function Jr(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function qn(e,t,r){return t=e==="+"||e==="#"?gu(t):Jr(t),r?Jr(r)+"="+t:t}function Yr(e){return e!=null}function Ra(e){return e===";"||e==="&"||e==="?"}function w0(e,t,r,n){var i=e[r],o=[];if(Yr(i)&&i!=="")if(typeof i=="string"||typeof i=="number"||typeof i=="boolean")i=i.toString(),n&&n!=="*"&&(i=i.substring(0,parseInt(n,10))),o.push(qn(t,i,Ra(t)?r:""));else if(n==="*")Array.isArray(i)?i.filter(Yr).forEach(function(a){o.push(qn(t,a,Ra(t)?r:""))}):Object.keys(i).forEach(function(a){Yr(i[a])&&o.push(qn(t,i[a],a))});else{const a=[];Array.isArray(i)?i.filter(Yr).forEach(function(s){a.push(qn(t,s))}):Object.keys(i).forEach(function(s){Yr(i[s])&&(a.push(Jr(s)),a.push(qn(t,i[s].toString())))}),Ra(t)?o.push(Jr(r)+"="+a.join(",")):a.length!==0&&o.push(a.join(","))}else t===";"?Yr(i)&&o.push(Jr(r)):i===""&&(t==="&"||t==="?")?o.push(Jr(r)+"="):i===""&&o.push("");return o}function y0(e){return{expand:b0.bind(null,e)}}function b0(e,t){var r=["+","#",".","/",";","?","&"];return e.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,function(n,i,o){if(i){let s="";const u=[];if(r.indexOf(i.charAt(0))!==-1&&(s=i.charAt(0),i=i.substr(1)),i.split(/,/g).forEach(function(c){var d=/([^:\*]*)(?::(\d+)|(\*))?/.exec(c);u.push(w0(t,s,d[1],d[2]||d[3]))}),s&&s!=="+"){var a=",";return s==="?"?a="&":s!=="#"&&(a=s),(u.length!==0?s:"")+u.join(a)}else return u.join(",")}else return gu(o)})}function mu(e){let t=e.method.toUpperCase(),r=(e.url||"/").replace(/:([a-z]\w+)/g,"{$1}"),n=Object.assign({},e.headers),i,o=pu(e,["method","baseUrl","url","headers","request","mediaType"]);const a=v0(r);r=y0(r).expand(o),/^http/.test(r)||(r=e.baseUrl+r);const s=Object.keys(e).filter(d=>a.includes(d)).concat("baseUrl"),u=pu(o,s);if(!/application\/octet-stream/i.test(n.accept)&&(e.mediaType.format&&(n.accept=n.accept.split(/,/).map(d=>d.replace(/application\/vnd(\.\w+)(\.v3)?(\.\w+)?(\+json)?$/,`application/vnd$1$2.${e.mediaType.format}`)).join(",")),e.mediaType.previews.length)){const d=n.accept.match(/[\w-]+(?=-preview)/g)||[];n.accept=d.concat(e.mediaType.previews).map(f=>{const h=e.mediaType.format?`.${e.mediaType.format}`:"+json";return`application/vnd.github.${f}-preview${h}`}).join(",")}return["GET","HEAD"].includes(t)?r=p0(r,u):"data"in u?i=u.data:Object.keys(u).length?i=u:n["content-length"]=0,!n["content-type"]&&typeof i!="undefined"&&(n["content-type"]="application/json; charset=utf-8"),["PATCH","PUT"].includes(t)&&typeof i=="undefined"&&(i=""),Object.assign({method:t,url:r,headers:n},typeof i!="undefined"?{body:i}:null,e.request?{request:e.request}:null)}function _0(e,t,r){return mu(Ea(e,t,r))}function vu(e,t){const r=Ea(e,t),n=_0.bind(null,r);return Object.assign(n,{DEFAULTS:r,defaults:vu.bind(null,r),merge:Ea.bind(null,r),parse:mu})}const S0=`octokit-endpoint.js/6.0.11 ${Zi()}`,C0=vu(null,{method:"GET",baseUrl:"https://api.github.com",headers:{accept:"application/vnd.github.v3+json","user-agent":S0},mediaType:{format:"",previews:[]}});class x0 extends Error{constructor(t){super(t);Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="Deprecation"}}var k0=ze(778),E0=ze.n(k0);const R0=E0()(e=>console.warn(e));class Sr extends Error{constructor(t,r,n){super(t);Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="HttpError",this.status=r,Object.defineProperty(this,"code",{get(){return R0(new x0("[@octokit/request-error] `error.code` is deprecated, use `error.status`.")),r}}),this.headers=n.headers||{};const i=Object.assign({},n.request);n.request.headers.authorization&&(i.headers=Object.assign({},n.request.headers,{authorization:n.request.headers.authorization.replace(/ .*$/," [REDACTED]")})),i.url=i.url.replace(/\bclient_secret=\w+/g,"client_secret=[REDACTED]").replace(/\baccess_token=\w+/g,"access_token=[REDACTED]"),this.request=i}}const D0="5.4.15";function A0(e){return e.arrayBuffer()}function wu(e){(du(e.body)||Array.isArray(e.body))&&(e.body=JSON.stringify(e.body));let t={},r,n;return(e.request&&e.request.fetch||_r())(e.url,Object.assign({method:e.method,body:e.body,headers:e.headers,redirect:e.redirect},e.request)).then(o=>{n=o.url,r=o.status;for(const s of o.headers)t[s[0]]=s[1];if(r===204||r===205)return;if(e.method==="HEAD"){if(r<400)return;throw new Sr(o.statusText,r,{headers:t,request:e})}if(r===304)throw new Sr("Not modified",r,{headers:t,request:e});if(r>=400)return o.text().then(s=>{const u=new Sr(s,r,{headers:t,request:e});try{let c=JSON.parse(u.message);Object.assign(u,c);let d=c.errors;u.message=u.message+": "+d.map(JSON.stringify).join(", ")}catch(c){}throw u});const a=o.headers.get("content-type");return/application\/json/.test(a)?o.json():!a||/^text\/|charset=utf-8$/.test(a)?o.text():A0(o)}).then(o=>({status:r,url:n,headers:t,data:o})).catch(o=>{throw o instanceof Sr?o:new Sr(o.message,500,{headers:t,request:e})})}function Da(e,t){const r=e.defaults(t);return Object.assign(function(i,o){const a=r.merge(i,o);if(!a.request||!a.request.hook)return wu(r.parse(a));const s=(u,c)=>wu(r.parse(r.merge(u,c)));return Object.assign(s,{endpoint:r,defaults:Da.bind(null,r)}),a.request.hook(s,a)},{endpoint:r,defaults:Da.bind(null,r)})}const Ki=Da(C0,{headers:{"user-agent":`octokit-request.js/${D0} ${Zi()}`}}),T0="4.6.2";class P0 extends Error{constructor(t,r){const n=r.data.errors[0].message;super(n);Object.assign(this,r.data),Object.assign(this,{headers:r.headers}),this.name="GraphqlError",this.request=t,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}const I0=["method","baseUrl","url","headers","request","query","mediaType"],F0=["query","method","url"],yu=/\/api\/v3\/?$/;function $0(e,t,r){if(r){if(typeof t=="string"&&"query"in r)return Promise.reject(new Error('[@octokit/graphql] "query" cannot be used as variable name'));for(const a in r)if(!!F0.includes(a))return Promise.reject(new Error(`[@octokit/graphql] "${a}" cannot be used as variable name`))}const n=typeof t=="string"?Object.assign({query:t},r):t,i=Object.keys(n).reduce((a,s)=>I0.includes(s)?(a[s]=n[s],a):(a.variables||(a.variables={}),a.variables[s]=n[s],a),{}),o=n.baseUrl||e.endpoint.DEFAULTS.baseUrl;return yu.test(o)&&(i.url=o.replace(yu,"/api/graphql")),e(i).then(a=>{if(a.data.errors){const s={};for(const u of Object.keys(a.headers))s[u]=a.headers[u];throw new P0(i,{headers:s,data:a.data})}return a.data.data})}function Aa(e,t){const r=e.defaults(t);return Object.assign((i,o)=>$0(r,i,o),{defaults:Aa.bind(null,r),endpoint:Ki.endpoint})}const gb=Aa(Ki,{headers:{"user-agent":`octokit-graphql.js/${T0} ${Zi()}`},method:"POST",url:"/graphql"});function O0(e){return Aa(e,{method:"POST",url:"/graphql"})}async function U0(e){const t=e.split(/\./).length===3?"app":/^v\d+\./.test(e)?"installation":"oauth";return{type:"token",token:e,tokenType:t}}function N0(e){return e.split(/\./).length===3?`bearer ${e}`:`token ${e}`}async function M0(e,t,r,n){const i=t.endpoint.merge(r,n);return i.headers.authorization=N0(e),t(i)}const L0=function(t){if(!t)throw new Error("[@octokit/auth-token] No token passed to createTokenAuth");if(typeof t!="string")throw new Error("[@octokit/auth-token] Token passed to createTokenAuth is not a string");return t=t.replace(/^(token|bearer) +/i,""),Object.assign(U0.bind(null,t),{hook:M0.bind(null,t)})},bu="3.4.0";class Ta{constructor(t={}){const r=new h0.Collection,n={baseUrl:Ki.endpoint.DEFAULTS.baseUrl,headers:{},request:Object.assign({},t.request,{hook:r.bind(null,"request")}),mediaType:{previews:[],format:""}};if(n.headers["user-agent"]=[t.userAgent,`octokit-core.js/${bu} ${Zi()}`].filter(Boolean).join(" "),t.baseUrl&&(n.baseUrl=t.baseUrl),t.previews&&(n.mediaType.previews=t.previews),t.timeZone&&(n.headers["time-zone"]=t.timeZone),this.request=Ki.defaults(n),this.graphql=O0(this.request).defaults(n),this.log=Object.assign({debug:()=>{},info:()=>{},warn:console.warn.bind(console),error:console.error.bind(console)},t.log),this.hook=r,t.authStrategy){const{authStrategy:o,...a}=t,s=o(Object.assign({request:this.request,log:this.log,octokit:this,octokitOptions:a},t.auth));r.wrap("request",s.hook),this.auth=s}else if(!t.auth)this.auth=async()=>({type:"unauthenticated"});else{const o=L0(t.auth);r.wrap("request",o.hook),this.auth=o}this.constructor.plugins.forEach(o=>{Object.assign(this,o(this,t))})}static defaults(t){return class extends this{constructor(...n){const i=n[0]||{};if(typeof t=="function"){super(t(i));return}super(Object.assign({},t,i,i.userAgent&&t.userAgent?{userAgent:`${i.userAgent} ${t.userAgent}`}:null))}}}static plugin(...t){var r;const n=this.plugins;return r=class extends this{},r.plugins=n.concat(t.filter(o=>!n.includes(o))),r}}Ta.VERSION=bu,Ta.plugins=[];var _u;(function(e){e[e.Force=0]="Force",e[e.ForceWithLease=1]="ForceWithLease"})(_u||(_u={}));var en;(function(e){e[e.Head=0]="Head",e[e.RemoteHead=1]="RemoteHead",e[e.Tag=2]="Tag"})(en||(en={}));var Vn;(function(e){e[e.INDEX_MODIFIED=0]="INDEX_MODIFIED",e[e.INDEX_ADDED=1]="INDEX_ADDED",e[e.INDEX_DELETED=2]="INDEX_DELETED",e[e.INDEX_RENAMED=3]="INDEX_RENAMED",e[e.INDEX_COPIED=4]="INDEX_COPIED",e[e.MODIFIED=5]="MODIFIED",e[e.DELETED=6]="DELETED",e[e.UNTRACKED=7]="UNTRACKED",e[e.IGNORED=8]="IGNORED",e[e.INTENT_TO_ADD=9]="INTENT_TO_ADD",e[e.ADDED_BY_US=10]="ADDED_BY_US",e[e.ADDED_BY_THEM=11]="ADDED_BY_THEM",e[e.DELETED_BY_US=12]="DELETED_BY_US",e[e.DELETED_BY_THEM=13]="DELETED_BY_THEM",e[e.BOTH_ADDED=14]="BOTH_ADDED",e[e.BOTH_DELETED=15]="BOTH_DELETED",e[e.BOTH_MODIFIED=16]="BOTH_MODIFIED"})(Vn||(Vn={}));var Su;(function(e){e.BadConfigFile="BadConfigFile",e.AuthenticationFailed="AuthenticationFailed",e.NoUserNameConfigured="NoUserNameConfigured",e.NoUserEmailConfigured="NoUserEmailConfigured",e.NoRemoteRepositorySpecified="NoRemoteRepositorySpecified",e.NotAGitRepository="NotAGitRepository",e.NotAtRepositoryRoot="NotAtRepositoryRoot",e.Conflict="Conflict",e.StashConflict="StashConflict",e.UnmergedChanges="UnmergedChanges",e.PushRejected="PushRejected",e.RemoteConnectionError="RemoteConnectionError",e.DirtyWorkTree="DirtyWorkTree",e.CantOpenResource="CantOpenResource",e.GitNotFound="GitNotFound",e.CantCreatePipe="CantCreatePipe",e.PermissionDenied="PermissionDenied",e.CantAccessRemote="CantAccessRemote",e.RepositoryNotFound="RepositoryNotFound",e.RepositoryIsLocked="RepositoryIsLocked",e.BranchNotFullyMerged="BranchNotFullyMerged",e.NoRemoteReference="NoRemoteReference",e.InvalidBranchName="InvalidBranchName",e.BranchAlreadyExists="BranchAlreadyExists",e.NoLocalChanges="NoLocalChanges",e.NoStashFound="NoStashFound",e.LocalChangesOverwritten="LocalChangesOverwritten",e.NoUpstreamBranch="NoUpstreamBranch",e.IsInSubmodule="IsInSubmodule",e.WrongCase="WrongCase",e.CantLockRef="CantLockRef",e.CantRebaseMultipleBranches="CantRebaseMultipleBranches",e.PatchDoesNotApply="PatchDoesNotApply",e.NoPathFound="NoPathFound",e.UnknownPath="UnknownPath"})(Su||(Su={}));function B0(e,t){return e.reduce((n,i)=>{const o=t(i),a=n.get(o);return a===void 0?n.set(o,[i]):a.push(i),n},new Map)}function Pa(e,t,r=n=>n){return[...e.reduce((i,o)=>{const a=t(o),s=i.get(a);if(s===void 0)i.set(a,o);else{const u=r(s,o);u!==void 0&&i.set(a,u)}return i},new Map).values()]}const H0="github-pr-owner-number";function W0(e){return`branch.${e}.${H0}`}const z0=(0,P.loadMessageBundle)(),j0=new TextDecoder;class q0{constructor(t,r,n,i,o,a){this.providerService=t,this.rootUri=r,this.sourceControl=n,this.metadata=i,this.changeStore=o,this.github=a,this._onDidChangeSelection=new l.EventEmitter,this._onDidChangeState=new l.EventEmitter;var s;this.disposable=l.Disposable.from(this.sourceControl.onDidChangeSelection(()=>this._onDidChangeSelection.fire()),this.providerService.onDidRefresh(d=>{const f=Y(this.rootUri);!d.some(h=>Y(h)===f)||this.updateState()}),this.changeStore.onDidChange(()=>this.updateState()),this._onDidChangeSelection,this._onDidChangeState),this._inputBox={get value(){return n.inputBox.value}},this._ui={get selected(){return n.selected},onDidChange:this._onDidChangeSelection.event};const{repo:{owner:u,name:c}}=i;this.remote={name:"origin",fetchUrl:`https://github.com/${u}/${c}.git`,isReadOnly:i.accessLevel>=nt.Write},this.remotes=[this.remote],i.pullRequest&&(i.pullRequest.repo.owner!==u||i.pullRequest.repo.name!==c)&&this.remotes.push({name:"upstream",fetchUrl:`https://github.com/${i.pullRequest.repo.owner}/${i.pullRequest.repo.name}.git`,isReadOnly:!0}),this._state={HEAD:((s=i.HEAD.detached)==null?void 0:s.type)===Be.Tag?{type:en.Tag,name:i.HEAD.detached.name,commit:i.HEAD.sha}:i.HEAD.branch?{type:en.Head,commit:i.HEAD.sha,name:i.HEAD.branch.name,upstream:{name:i.HEAD.branch.name,remote:this.remote.name}}:void 0,mergeChanges:[],indexChanges:[],workingTreeChanges:[],onDidChange:this._onDidChangeState.event,rebaseCommit:void 0,refs:[],remotes:this.remotes,submodules:[]},this.updateState()}dispose(){this.disposable.dispose()}get inputBox(){return this._inputBox}get state(){return this._state}get ui(){return this._ui}async updateState(){const t=await this.changeStore.getGroupedChanges(this.rootUri,{predicate:a=>a.fileType===l.FileType.File}),r=t.conflicts.map(a=>({uri:a.uri,status:Ia(a.type),originalUri:a.uri,renameUri:a.uri})),n=t.staged.map(a=>({uri:a.uri,status:Ia(a.type),originalUri:a.uri,renameUri:a.uri})),i=t.working.map(a=>({uri:a.uri,status:Ia(a.type),originalUri:a.uri,renameUri:a.uri})),o=Ce.get("staging.enabled");this._state={...this._state,mergeChanges:r,indexChanges:o?n:[],workingTreeChanges:o?i:[...n,...i]},this._onDidChangeState.fire()}getConfigs(){return Promise.resolve([])}async getConfig(t){if(!this.metadata.HEAD.branch)return"";if(t===W0(this.metadata.HEAD.branch.name)){const r=await this.github.getPullRequestForBranch(this.rootUri,this.metadata.HEAD.branch.name);if(r!==void 0)return`${r.repo.owner}#${r.repo.name}#${r.id}`}return""}setConfig(t,r){return Promise.resolve("")}getGlobalConfig(t){throw new Error("Method not implemented.")}async getObjectDetails(t,r){return this.github.getObjectDetails(this.rootUri,t,Cu(r))}detectObjectType(t){return Promise.resolve({mimetype:"text/plain"})}buffer(t,r){throw new Error("Method not implemented.")}async show(t,r){const n=await this.github.getFileContent(this.rootUri,t,Cu(r));return j0.decode(n)}async getCommit(t){const r=await this.github.getCommit(this.rootUri,t);if(r===void 0)throw new Error(`Unable to find commit for ref "${t}"`);return r}clean(t){throw new Error("Method not implemented.")}apply(t,r){throw new Error("Method not implemented.")}diff(t){throw new Error("Method not implemented.")}diffWithHEAD(t){if(t)return"";throw new Error("Method not implemented.")}diffWith(t,r){throw new Error("Method not implemented.")}diffIndexWithHEAD(t){throw new Error("Method not implemented.")}diffIndexWith(t,r){throw new Error("Method not implemented.")}diffBlobs(t,r){throw new Error("Method not implemented.")}diffBetween(t,r,n){throw new Error("Method not implemented.")}hashObject(t){throw new Error("Method not implemented.")}async createBranch(t,r,n){n||(n=this.metadata.HEAD.sha);const i=await this.github.createBranch(this.rootUri,t,n);r&&await this.checkout(i)}deleteBranch(t,r){throw new Error("Method not implemented.")}async getBranch(t){const{branches:r}=await this.github.getBranches(this.rootUri,{query:t,limit:1}),[n]=r;if(n===void 0)throw new Error(`Unable to find branch named "${t}"`);return{type:n.type,name:n.name,commit:n.commit,remote:this.remote.name,upstream:{name:n.name,remote:n.commitUrl}}}async getBranches(t){var r,n;const{branches:i}=await this.github.getBranches(this.rootUri,{query:(n=(r=t.contains)!=null?r:t.pattern)!=null?n:"",limit:t.count});if(i.length===0)throw new Error(`Unable to find branches for "${t.contains}"`);return i.map(o=>({type:o.type,name:o.name,commit:o.commit}))}setBranchUpstream(t,r){throw new Error("Method not implemented.")}getMergeBase(t,r){throw new Error("Method not implemented.")}async status(){}async checkout(t){const r=await this.github.switchTo(this.rootUri,t,{openInNewWindow:!1});throw r!==void 0&&await vt(r),new Error("User aborted")}addRemote(t,r){var n;let i;const o=this.remotes.findIndex(a=>a.name===t);return o!==-1&&([i]=this.remotes.splice(o,1)),this.remotes.push({name:t,fetchUrl:r,isReadOnly:(n=i==null?void 0:i.isReadOnly)!=null?n:!1}),Promise.resolve()}removeRemote(t){const r=this.remotes.findIndex(n=>n.name===t);return r!==-1&&this.remotes.splice(r,1),Promise.resolve()}renameRemote(t,r){const n=this.remotes.findIndex(o=>o.name===t);if(n===-1)return Promise.resolve();const[i]=this.remotes.splice(n,1);return this.remotes.push({...i,name:r}),Promise.resolve()}async fetch(t,r,n){return this.github.fetch(this.rootUri)}async pull(t){return this.github.sync(this.rootUri,this.changeStore,{conflictResolution:Nt.Merge})}push(t,r,n){throw new Error("Method not implemented.")}blame(t){throw new Error("Method not implemented.")}async log(t){if((t==null?void 0:t.maxEntries)!==1||(t==null?void 0:t.path)!==void 0)throw new Error("The specified log options are not yet supported.");return[await this.getCommit(this.metadata.HEAD.sha)]}async commit(t,r){if((r==null?void 0:r.amend)!==void 0||(r==null?void 0:r.empty)!==void 0||(r==null?void 0:r.signCommit)!==void 0||(r==null?void 0:r.signoff)!==void 0)throw new Error("The specified commit options are not yet supported.");const n=await this.providerService.getCommitOperations(this.rootUri,this.changeStore,{staged:(r==null?void 0:r.all)===!1});if(!n.length){l.window.showInformationMessage(z0("no changes to commit","There are no changes to commit."));return}await this.github.createCommit(this.rootUri,t,n)}}const V0=/^\/?([a-zA-Z])(?::\/)(.*)$/,G0=/\\/g;function Cu(e){e=l.Uri.file(e).fsPath.replace(G0,"/");const t=V0.exec(e);return t!==null&&([,,e]=t),e.startsWith("/")?e.substr(1):e}function Ia(e){switch(e){case xe.Changed:return Vn.MODIFIED;case xe.Created:return Vn.INTENT_TO_ADD;case xe.Deleted:return Vn.DELETED}}var Z0=Object.defineProperty,K0=Object.getOwnPropertyDescriptor,Q0=(e,t,r,n)=>{for(var i=n>1?void 0:n?K0(t,r):t,o=e.length-1,a;o>=0;o--)(a=e[o])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&Z0(t,r,i),i};const at=(0,P.loadMessageBundle)(),xu=/^https:\/\/github\.com\/(?<owner>[^/]+)\/(?<repo>[^/]+?)(?:\/(?:tree\/(?<tree>.+)|blob\/(?<blob>.+)|commit\/(?<commit>[0-9a-f]{40})|pull\/(?<pull>[0-9]+)))?(?:\/|\.git$|(?:#(?<hash>.*))?$)/i,Qi=1;function Gn(e){const{scheme:t,metadata:r}=Fe.decodeAuthority(e,a=>{if(a.v!==void 0)return a;if(typeof a.pr=="string")return{v:Qi,ref:{type:Ee.PullRequest,id:a.pr},idx:a.idx};if(typeof a.ref=="string")return{v:Qi,ref:{type:Ee.Tree,id:a.ref},idx:a.idx}}),[,n,i,...o]=e.path.split("/");return{scheme:t,repo:{owner:n,name:i},path:o.join("/")||"",ref:r==null?void 0:r.ref,idx:r==null?void 0:r.idx}}function X0(e,t){const{repo:r}=t!=null?t:Gn(e);return e.with({path:`/${r.owner}/${r.name}`})}function Fa(e,t,r){const{repo:{owner:n,name:i}}=e instanceof l.Uri?Gn(e):e;return l.Uri.parse(`github://${Fe.encodeAuthority("github",{v:Qi,ref:{type:Ee.Commit,id:t}})}/${n}/${i}/${r}`)}class ku{constructor(t){this.providerService=t}dispose(){}async ensureAuthenticated(){if(this._session===void 0){async function t(){try{return await l.authentication.getSession("github",["repo"],{createIfNone:!0})}catch{try{const n=await l.authentication.getSession("github",["repo"],{createIfNone:!1});if(n!==void 0)return n}catch{}return new Promise(async n=>{async function i(){const a=await l.authentication.getSession("github",["repo"],{createIfNone:!0});a!==void 0&&n(a)}if(l.authentication.providers.some(a=>a.id==="github")){await i();return}const o=l.authentication.onDidChangeSessions(async a=>{a.provider.id==="github"&&(o.dispose(),await i())})})}}this._session=await t();const r=l.authentication.onDidChangeSessions(n=>{if(this._session===void 0){r.dispose();return}n.provider.id==="github"&&(this._session=void 0,this._octokit=void 0,this._octokitDefaults=void 0,r.dispose())})}return this._session}async octokit(t){if(this._octokitDefaults===void 0){const n=await this.ensureAuthenticated();this._octokitDefaults=Ta.defaults({auth:`token ${n.accessToken}`})}const r=new this._octokitDefaults(t);return(q.logLevel===De.Debug||q.isDebugging)&&r.hook.wrap("request",async(n,i)=>{var o;const a=new Ae(`[GITHUB] ${i.method} ${i.url}`);try{return await n(i)}finally{let s;try{if(typeof i.query=="string"){const u=/(^[^({\n]+)/.exec(i.query);s=` ${(o=u==null?void 0:u[1].trim())!=null?o:i.query}`}}catch{}a.stop({message:s})}}),r}async graphql(t,r){return this._octokit===void 0&&(this._octokit=await this.octokit()),this._octokit.graphql(t,r)}async request(t,r){return this._octokit===void 0&&(this._octokit=await this.octokit()),this._octokit.request(t,r)}createIGitRepository(t,r,n,i){return new q0(this.providerService,t,r,n,i,this)}async createMetadata(t,r){var n,i,o,a;let{repo:{owner:s,name:u},ref:c}=Gn(t);(!c||c.type===Ee.Commit&&/HEAD/i.test(c.id))&&(c={type:Ee.Commit,id:"HEAD"});const d=await this.getRepositoryInfo(s,u,c.type===Ee.PullRequest?{ref:"HEAD",pr:Number(c.id)}:{ref:c.id});if(d===void 0)throw new Error(`Cannot get metadata for Uri(${t.toString(!0)}); Unable to get repository info`);let f;if(r)f=r;else if(c.type===Ee.Commit||c.type===Ee.Tree&&d.ref===void 0)f=c.id;else if(f=(i=(n=d.ref)==null?void 0:n.sha)!=null?i:d.defaultBranch.sha,f===void 0)throw new Error(`Cannot get metadata for Uri(${t.toString(!0)}); Unable to get repository info`);let h;return((o=d.ref)==null?void 0:o.prefix)==="refs/heads/"?h={type:Be.Branch,name:d.ref.name,sha:f,branch:{name:d.ref.name,sha:d.ref.sha}}:((a=d.ref)==null?void 0:a.prefix)==="refs/tags/"?h={type:Be.Tag,name:d.ref.name,sha:f,detached:{type:Be.Tag,name:d.ref.name}}:h={type:Be.Commit,name:Je(f),sha:f,detached:{type:Be.Commit,name:Je(f)}},{version:Ln.schemaVersion,timestamp:Date.now(),provider:{id:"github",name:"GitHub"},name:`${d.repo.owner}/${d.repo.name}`,repo:d.repo,user:d.user,accessLevel:d.accessLevel,HEAD:h,defaultBranch:d.defaultBranch,pullRequest:d.pullRequest}}getMetadata(t){return this.providerService.getMetadata(t)}getRemoteWorkspaceSourceProviders(){return[{name:"GitHub",icon:"$(github)",label:at("open repo from","Open Repository from {0}","GitHub"),placeholder:at("pick repo","Choose a repository"),provideSources:async(t,r)=>(await this.searchRepositoriesQuery(t!=null?t:"",r)).map(i=>({name:i.repoWithOwner,icon:"$(repo)",description:`${i.fork?`$(repo-forked) ${i.fork}`:""}${i.stars>0?`${i.fork?" \u2022 ":""}$(star-full) ${i.stars}`:""}`,detail:i.description,url:i.url}))},{name:"GitHub",icon:"$(github)",label:at("open pr from","Open Pull Request from {0}","GitHub"),placeholder:at("pick pr","Choose a pull request"),provideSources:async(t,r)=>(await this.searchPullRequestsQuery(t!=null?t:"")).map(i=>({name:i.title,icon:"$(git-pull-request)",description:i.reasons.length!==0?i.reasons.sort().join(", "):void 0,detail:`${i.repoWithOwner} #${i.number}`,url:i.url}))}]}canOpenRemoteUrl(t){const r=xu.exec(t);if((r==null?void 0:r.groups)===void 0)return;const{blob:n,commit:i,pull:o,tree:a}=r.groups;return o?qe.PullRequest:i?qe.Commit:a?qe.Branch:n?qe.File:qe.Repository}async createWorkspaceForRemoteUrl(t,r=Le.CurrentWindow){const n=xu.exec(t);if((n==null?void 0:n.groups)===void 0)return;let{owner:i,repo:o,blob:a,commit:s,pull:u,tree:c}=n.groups;const d=await this.validateNameAndOwner(i,o);if(d===void 0)return;if({owner:i,name:o}=d,u)return this.createWorkspaceForPullRequest(r,i,o,u);let f,h;if(a){const w=this.createVirtualUri(Fe.baseVirtualWorkspaceUri,{repo:{owner:i,name:o}});if(f=a,f){const _=f.split("/")[0],[D,C]=await Promise.all([this.getBranches(w,{query:_}),this.getTags(w,{query:_})]),U=[...D.branches,...C.tags].map(F=>`${F.name}/`).sort((F,z)=>z.length-F.length);for(const F of U)if(f.startsWith(F)){h={type:Ee.Tree,id:F.slice(0,-1)},f=f.substr(h.id.length);break}h===void 0&&Al(_)&&(h={type:Ee.Tree,id:_},f=f.substr(h.id.length))}}else s?h={type:Ee.Commit,id:s}:c&&(h={type:Ee.Tree,id:c});const p=this.providerService.createVirtualUri("github",{repo:{owner:i,name:o},ref:h});return{name:(await this.getMetadata(p)).name,uri:p,location:r,filesToOpen:f?[f]:void 0}}async createWorkspaceForPullRequest(t,r,n,i){var o,a,s,u;const c=await this.getPullRequestCore(r,n,i);let d;if(c)if((a=(o=c.refs)==null?void 0:o.head)==null?void 0:a.exists)d=this.providerService.createVirtualUri("github",{repo:{owner:c.refs.head.owner,name:c.refs.head.repo},ref:{type:Ee.PullRequest,id:c.id}});else if((u=(s=c.refs)==null?void 0:s.base)==null?void 0:u.exists){const f=at("pr source branch missing prompt confirm","Open Respository"),h=at("pr source branch missing prompt cancel","Cancel");if(await l.window.showInformationMessage(at("pr source branch missing prompt",`Unable to find the source branch for pull request #{0}.

Do you want to open the repository on the target branch instead?`,c.id),f,h)!==f)return;d=this.providerService.createVirtualUri("github",{repo:{owner:c.refs.base.owner,name:c.refs.base.repo},ref:{type:Ee.PullRequest,id:c.id}})}else{const f=at("pr branches missing prompt confirm","Open Respository"),h=at("pr branches missing prompt cancel","Cancel");if(await l.window.showInformationMessage(at("pr branches missing prompt",`Unable to find either the source or target branch for pull request #{0}.

Do you want to open the repository on the default branch instead?`,c.id),f,h)!==f)return;d=this.providerService.createVirtualUri("github",{repo:{owner:r,name:n}})}else{const f=at("pr missing prompt confirm","Open Respository"),h=at("pr missing prompt cancel","Cancel");if(await l.window.showInformationMessage(at("pr missing prompt",`Unable to find pull request.

Do you want to open the repository on the default branch instead?`),f,h)!==f)return;d=this.providerService.createVirtualUri("github",{repo:{owner:r,name:n}})}return{name:`${r}/${n}`,uri:d,location:t}}createVirtualUri(t,{repo:r,ref:n},i){const o=n?{v:Qi,ref:{type:n.type===Ee.Branch||n.type===Ee.Tag?Ee.Tree:n.type,id:n.id}}:void 0;return t.with({authority:Fe.encodeAuthority("github",o),path:`/${r.owner}/${r.name}${(i==null?void 0:i.startsWith("/"))?i:i?`/${i}`:""}`})}getRepositoryDescriptor(t){return Gn(t).repo}getExternalUri(t){const r=`https://github.com/${t.repo.owner}/${t.repo.name}`;return t.pullRequest?l.Uri.parse(`${r}/pull/${t.pullRequest}`):t.sha?l.Uri.parse(`${r}/commit/${t.sha}`):t.branch?l.Uri.parse(`${r}/tree/${t.branch}`):t.clone?l.Uri.parse(`${r}.git`):l.Uri.parse(r)}getProviderRootUri(t){return X0(t)}getRelativeFilePath(t,r){const{path:n}=Gn(wo(t,r));return n}async createBranch(t,r,n,i){try{const{repo:{owner:o,name:a}}=i!=null?i:await this.getMetadata(t);return r.startsWith("refs/heads/")||(r=`refs/heads/${r}`),(await this.request("POST /repos/{owner}/{repo}/git/refs",{owner:o,repo:a,ref:r,sha:n})).data.ref.substr(11)}catch(o){throw o instanceof Sr&&o.status===422?o.message==="Reference already exists"?new mn(o,!0):new mn(o,!1):(q.error(o),o)}}async createCommit(t,r,n,i){try{const o=await this.getMetadata(t),{repo:{owner:a,name:s}}=i!=null?i:o,u=await this.request("GET /repos/{owner}/{repo}/git/trees/{tree_sha}",{owner:a,repo:s,tree_sha:o.HEAD.sha,recursive:"true"}),c=[];for(const h of n)if(h.fileType===l.FileType.File)switch(h.type){case xe.Created:{c.push({path:h.path,mode:"100644",type:"blob",content:await h.content});break}case xe.Changed:{const p=u.data.tree.find(g=>g.path===h.path);if(p!==void 0){const{path:g,mode:w,type:_}=p;c.push({path:g,mode:w,type:_,content:await h.content})}else c.push({path:h.path,mode:"100644",type:"blob",content:await h.content});break}case xe.Deleted:{c.push({path:h.path,mode:"100644",type:"blob",sha:null});break}}const d=await this.request("POST /repos/{owner}/{repo}/git/trees",{owner:a,repo:s,base_tree:u.data.sha,tree:c});return(await this.request("POST /repos/{owner}/{repo}/git/commits",{owner:a,repo:s,message:r,tree:d.data.sha,parents:[o.HEAD.sha]})).data.sha}catch(o){throw q.error(o),o}}async createPullRequest(t,r,n,i,o){var a,s,u;try{const{repo:{owner:c,name:d},HEAD:{branch:f},defaultBranch:h}=await this.getMetadata(t),p=await this.request("POST /repos/{owner}/{repo}/pulls",{owner:c,repo:d,base:`refs/heads/${(a=f==null?void 0:f.name)!=null?a:h.name}`,head:o?`${o.repo.owner}:${r}`:r,title:n,draft:(s=i==null?void 0:i.draft)!=null?s:!1,maintainer_can_modify:(u=i==null?void 0:i.canMaintainerModify)!=null?u:!0});return{id:p.data.number.toString(),uri:l.Uri.parse(p.data.html_url)}}catch(c){throw q.error(c),c}}async fetch(t,r){const[n,i]=await this.fetchCore(t,{...r,sync:!1});n&&await this.providerService.updateMetadata(t,i)}async fetchCore(t,r){var n,i,o,a,s,u,c,d,f,h,p;const g=await this.getMetadata(t);if(g.HEAD.detached)return q.log(`Fetching upstream: Skipped detached HEAD; rootUri=${t.toString(!0)}`),[!1,g];const w=await this.getBranchTips(t);if(!w)throw q.warn(`Fetching upstream: Unable to fetch branch tips; rootUri=${t.toString(!0)}`),new bo(r.sync);if(!r.force&&((n=w.defaultBranch)==null?void 0:n.sha)!==void 0&&w.defaultBranch.sha===g.defaultBranch.sha&&((i=w.branch)==null?void 0:i.sha)!==void 0&&w.branch.sha===g.HEAD.branch.sha)return q.log(`Fetching upstream: No changes detected; rootUri=${t.toString(!0)}`),[!1,g];let _;if(((o=w.defaultBranch)==null?void 0:o.sha)!==void 0&&w.defaultBranch.sha!==g.defaultBranch.sha&&(_={defaultBranch:{...g.defaultBranch,sha:w.defaultBranch.sha}}),((a=w.branch)==null?void 0:a.sha)===void 0)return q.log(`Fetching upstream: Unable to find branch tip; rootUri=${t.toString(!0)}`),_!==void 0?[!0,{...g,..._}]:[!1,g];if(w.branch.sha!==g.HEAD.branch.sha&&(_={..._,HEAD:{...g.HEAD,branch:{...g.HEAD.branch,sha:w.branch.sha},detached:void 0}}),w.branch.sha===g.HEAD.sha)return q.log(`Fetching upstream: Up to date; rootUri=${t.toString(!0)}`),g.state!==void 0||_!==void 0?[!0,{...g,..._,state:void 0}]:[!1,g];try{const D=await this.request("GET /repos/{owner}/{repo}/compare/{base}...{head}",{owner:g.repo.owner,repo:g.repo.name,base:(s=r==null?void 0:r.to)!=null?s:g.HEAD.sha,head:(d=(c=(u=_==null?void 0:_.HEAD)==null?void 0:u.branch)==null?void 0:c.sha)!=null?d:g.HEAD.branch.sha}),C=[];for(const U of(f=D.data.files)!=null?f:[])switch(U.status){case"added":case"copied":C.push({path:U.filename,type:xe.Created});break;case"removed":C.push({path:U.filename,type:xe.Deleted});break;case"modified":C.push({path:U.filename,type:xe.Changed});break;case"renamed":C.push({path:U.filename,type:xe.Created}),C.push({path:U.previous_filename,type:xe.Deleted});break;default:q.warn(`Fetching upstream: Unknown file status encountered '${U.status}'; rootUri=${t.toString(!0)}`);break}return q.log(`Fetching upstream: Changes detected; rootUri=${t.toString(!0)}`),[!0,{...g,..._,state:{ahead:(h=D.data.behind_by)!=null?h:0,behind:(p=D.data.ahead_by)!=null?p:0,incomingChanges:C}}]}catch(D){return q.error(D,`Fetching upstream failed; rootUri=${t.toString(!0)}`),_!==void 0?[!0,{...g,..._}]:[!1,g]}}async fork(t){try{const{repo:{owner:r,name:n}}=await this.getMetadata(t),i=await this.request("POST /repos/{owner}/{repo}/forks",{owner:r,repo:n});let o;for(;;){try{if(o=await this.getRepositoryInfo(i.data.owner.login,i.data.name),o!==void 0)break}catch{}await new Promise(a=>setTimeout(a,250))}return{name:`${i.data.owner.login}/${i.data.name}`,repo:{owner:i.data.owner.login,name:i.data.name},url:i.data.url}}catch(r){throw q.error(r),r}}async getBranches(t,r){var n,i,o;try{const{repo:{owner:a,name:s}}=await this.getMetadata(t),u=`query getBranches(
	$owner: String!
	$repo: String!
	$branchQuery: String!
	$cursor: String
	$limit: Int = 100
) {
	repository(owner: $owner, name: $repo) {
		refs(query: $branchQuery, refPrefix: "refs/heads/", first: $limit, after: $cursor) {
			pageInfo {
				endCursor
				hasNextPage
			}
			nodes {
				name
				target {
					oid
				}
			}
		}
	}
}`,c=await this.graphql(u,{owner:a,repo:s,branchQuery:(n=r==null?void 0:r.query)!=null?n:"",cursor:r==null?void 0:r.cursor,limit:Math.min(100,(i=r==null?void 0:r.limit)!=null?i:100)});if(c===void 0)return{branches:[]};const d=(o=c.repository)==null?void 0:o.refs;if(d===void 0)return{branches:[]};const f=d.nodes.map(h=>({type:en.Head,name:h.name,commit:h.target.oid,commitUrl:h.target.commitUrl}));return{paging:{cursor:d.pageInfo.endCursor,more:d.pageInfo.hasNextPage},branches:f}}catch(a){return{branches:[]}}}async getCommit(t,r){var n;try{const{HEAD:i,repo:{owner:o,name:a}}=await this.getMetadata(t),s=`query getCommit(
	$owner: String!
	$repo: String!
	$ref: GitObjectID!
) {
	repository(name: $repo owner: $owner) {
		object(oid: $ref) {
			...on Commit {
				oid
				message
				parents(first: 100) {
					nodes {
						oid
					}
				}
				author {
					date
					email
					name
				}
				committer {
					date
				}
			}
		}
	}
}`;r.toUpperCase()==="HEAD"&&(r=i.sha);const u=await this.graphql(s,{owner:o,repo:a,ref:r});if(u===void 0)return;const c=(n=u.repository)==null?void 0:n.object;return c===void 0?void 0:{hash:c.oid,message:c.message,parents:c.parents.nodes.map(d=>d.oid),authorDate:new Date(c.author.date),authorEmail:c.author.email,authorName:c.author.name,commitDate:new Date(c.committer.date)}}catch(i){return}}async getCommits(t,r){var n,i,o;try{const{HEAD:a,repo:{owner:s,name:u}}=await this.getMetadata(t),c=`query getCommits(
	$owner: String!
	$repo: String!
	$ref: GitObjectID!
	$path: String
	$cursor: String
	$limit: Int = 100
) {
	repository(name: $repo, owner: $owner) {
		object(oid: $ref) {
			... on Commit {
				history(first: $limit, path: $path, after: $cursor) {
					pageInfo {
						endCursor
						hasNextPage
					}
					nodes {
						... on Commit {
							...commit
						}
					}
				}
			}
		}
	}
}

fragment commit on Commit {
	oid
	message
	parents(first: 100) {
		nodes {
			oid
		}
	}
	author {
		date
		email
		name
	}
	committer {
		date
	}
}
`;let d=r==null?void 0:r.ref;(d==null?void 0:d.toUpperCase())==="HEAD"&&(d=a.sha);const f=await this.graphql(c,{owner:s,repo:u,ref:d,cursor:r==null?void 0:r.cursor,path:r==null?void 0:r.path,limit:Math.min(100,(n=r==null?void 0:r.limit)!=null?n:100)});if(f===void 0)return;const h=(o=(i=f.repository)==null?void 0:i.object)==null?void 0:o.history;if(h===void 0)return;const p=h.nodes.map(g=>({hash:g.oid,message:g.message,parents:g.parents.nodes.map(w=>w.oid),authorDate:new Date(g.author.date),authorEmail:g.author.email,authorName:g.author.name,commitDate:new Date(g.committer.date)}));return{paging:{cursor:h.pageInfo.endCursor,more:h.pageInfo.hasNextPage},commits:p}}catch(a){return}}async getFileContent(t,r,n){try{const{repo:{owner:i,name:o}}=await this.getMetadata(t),a=await this.getObjectDetails(t,r,n);if(a===void 0)throw new Error(`Cannot read contents of Uri(${t.toString(!0)})`);const s=await this.request("GET /repos/{owner}/{repo}/git/blobs/{file_sha}",{owner:i,repo:o,file_sha:a.object});return Fp(s.data.content)}catch(i){throw q.error(i),i}}async getFork(t){var r,n,i;try{const{repo:{owner:o,name:a}}=await this.getMetadata(t),s=`query getFork(
	$owner: String!
	$repo: String!
) {
	repository(owner: $owner, name: $repo) {
		forks(affiliations: OWNER, first: 1) {
			nodes {
				owner {
					login
				}
				name
				url
			}
		}
	}
}`,u=await this.graphql(s,{owner:o,repo:a});if(u===void 0)return;const[c]=(i=(n=(r=u.repository)==null?void 0:r.forks)==null?void 0:n.nodes)!=null?i:[];return c===void 0?void 0:{name:`${c.owner.login}/${c.name}`,repo:{owner:c.owner.login,name:c.name},url:c.url}}catch(o){return}}async getIncomingChanges(t){return this.getIncomingChangesCore(t,await this.getMetadata(t))}getIncomingChangesCore(t,r){var n,i,o;return((o=(i=(n=r.state)==null?void 0:n.incomingChanges)==null?void 0:i.length)!=null?o:0)===0?[]:r.state.incomingChanges.map(a=>({uri:l.Uri.joinPath(t,a.path),type:a.type}))}async getObjectDetails(t,r,n){var i;try{const{repo:{owner:o,name:a},path:s,HEAD:{sha:u}}=await this.providerService.getMetadata(t);n=n?this.providerService.getRelativeFilePath(t,this.providerService.createRelativeUri(t,n)):s,r===void 0&&(r=u);const d=(await this.request("GET /repos/{owner}/{repo}/git/trees/{tree_sha}",{owner:o,repo:a,tree_sha:r,recursive:"true"})).data.tree.find(f=>f.path===n);if(d===void 0||d.mode===void 0||d.sha===void 0)throw new Error(`Cannot get details of ${n} in ${r}`);return{mode:d.mode,object:d.sha,size:(i=d.size)!=null?i:0}}catch(o){throw q.error(o),o}}async getPullRequest(t,r){const{repo:{owner:n,name:i}}=await this.getMetadata(t);return this.getPullRequestCore(n,i,r)}async getPullRequestCore(t,r,n){var i,o,a,s,u,c,d;try{const f=`query getPullRequest(
	$owner: String!
	$repo: String!
	$number: Int!
) {
	repository(name: $repo, owner: $owner) {
		pullRequest(number: $number) {
			author {
				login
				avatarUrl
				url
			}
			permalink
			number
			title
			state
			updatedAt
			closedAt
			mergedAt
			repository {
				name
				owner {
					login
				}
			}
			baseRef {
				name
			}
			baseRefName
			baseRefOid
			baseRepository {
				name
				owner {
					login
				}
			}
			headRef {
				name
			}
			headRefName
			headRefOid
			headRepository {
				name
				owner {
					login
				}
			}
			headRepositoryOwner {
				login
			}
		}
	}
}`,h=await this.graphql(f,{owner:t,repo:r,number:Number(n)}),p=(i=h==null?void 0:h.repository)==null?void 0:i.pullRequest;return p?{author:{name:p.author.login,avatarUrl:p.author.avatarUrl,url:p.author.url},closedAt:p.closedAt?new Date(p.closedAt):void 0,mergedAt:p.mergedAt?new Date(p.mergedAt):void 0,id:p.number.toString(),repo:{name:p.repository.name,owner:p.repository.owner.login},state:Xi(p.state),title:p.title,updatedAt:new Date(p.updatedAt),url:p.permalink,refs:{base:{owner:p.baseRepository.owner.login,repo:p.baseRepository.name,branch:p.baseRefName,sha:p.baseRefOid,exists:p.baseRef!=null},head:{owner:(u=(s=(o=p.headRepository)==null?void 0:o.owner.login)!=null?s:(a=p.headRepositoryOwner)==null?void 0:a.login)!=null?u:"<unknown>",repo:(d=(c=p.headRepository)==null?void 0:c.name)!=null?d:p.baseRepository.name,branch:p.headRefName,sha:p.headRefOid,exists:p.headRef!=null}}}:void 0}catch(f){q.error(f);return}}async getPullRequestForBranch(t,r,n){var i,o,a,s,u;try{const{repo:{owner:c,name:d}}=await this.getMetadata(t),f=`query getPullRequestForBranch(
	$owner: String!
	$repo: String!
	$branch: String!
	$maxCount: Int!
	$states: [PullRequestState!]
) {
	repository(name: $repo, owner: $owner) {
		refs(query: $branch, refPrefix: "refs/heads/", first: 1) {
			nodes {
				associatedPullRequests(first: $maxCount, orderBy: {field: UPDATED_AT, direction: DESC}, states: $states) {
					nodes {
						author {
							login
							avatarUrl
							url
						}
						permalink
						number
						title
						state
						updatedAt
						closedAt
						mergedAt
						repository {
							isFork
							name
							owner {
								login
							}
						}
					}
				}
			}
		}
	}
}`,h=await this.graphql(f,{owner:c,repo:d,branch:r,maxCount:(i=n==null?void 0:n.maxCount)!=null?i:1,states:n==null?void 0:n.include}),p=(u=(s=(a=(o=h==null?void 0:h.repository)==null?void 0:o.refs.nodes[0])==null?void 0:a.associatedPullRequests)==null?void 0:s.nodes)==null?void 0:u.filter(w=>!w.repository.isFork||w.repository.owner.login===c);if(p==null||p.length===0)return;p.length>1&&p.sort((w,_)=>(w.repository.owner.login===c?-1:1)-(_.repository.owner.login===c?-1:1)||(w.state==="OPEN"?-1:1)-(_.state==="OPEN"?-1:1)||new Date(_.updatedAt).getTime()-new Date(w.updatedAt).getTime());const[g]=p;return{author:{name:g.author.login,avatarUrl:g.author.avatarUrl,url:g.author.url},closedAt:g.closedAt?new Date(g.closedAt):void 0,mergedAt:g.mergedAt?new Date(g.mergedAt):void 0,id:g.number.toString(),repo:{name:g.repository.name,owner:g.repository.owner.login},state:Xi(g.state),title:g.title,updatedAt:new Date(g.updatedAt),url:g.permalink}}catch(c){q.error(c);return}}async getRepoFileNames(t){try{const{repo:{owner:r,name:n},HEAD:{sha:i}}=await this.getMetadata(t),o=await this.request("GET /repos/{owner}/{repo}/git/trees/{tree_sha}",{owner:r,repo:n,recursive:"1",tree_sha:i});return Tr(o.data.tree,a=>a.type==="blob"?a.path:void 0)}catch(r){return[]}}async getTags(t,r){var n,i,o;try{const{repo:{owner:a,name:s}}=await this.getMetadata(t),u=`query getTags(
	$owner: String!
	$repo: String!
	$tagQuery: String!
	$cursor: String
	$limit: Int = 100
) {
	repository(owner: $owner, name: $repo) {
		refs(query: $tagQuery, refPrefix: "refs/tags/", first: $limit, after: $cursor, orderBy: { field: TAG_COMMIT_DATE, direction: DESC }) {
			pageInfo {
				endCursor
				hasNextPage
			}
			nodes {
				name
				target {
					oid
				}
			}
		}
	}
}`,c=await this.graphql(u,{owner:a,repo:s,tagQuery:(n=r==null?void 0:r.query)!=null?n:"",cursor:r==null?void 0:r.cursor,limit:Math.min(100,(i=r==null?void 0:r.limit)!=null?i:100)});if(c===void 0)return{tags:[]};const d=(o=c.repository)==null?void 0:o.refs;if(d===void 0)return{tags:[]};const f=d.nodes.map(h=>({type:en.Tag,name:h.name,commit:h.target.oid,commitUrl:h.target.commitUrl}));return{paging:{cursor:d.pageInfo.endCursor,more:d.pageInfo.hasNextPage},tags:f}}catch(a){return{tags:[]}}}async getTarGz(t){const{repo:{owner:r,name:n},HEAD:{sha:i}}=await this.getMetadata(t),o=await this.ensureAuthenticated();if(Qt){const u=Ce.get("search.download.corsProxy")||void 0;if(typeof u=="string"){let h=u;h.startsWith("https://")||(h=`https://${h}`),h.endsWith("/")||(h=`${h}/`);const p=`${h}api.github.com/repos/${r}/${n}/tarball/${i}`,g=await _r()(p,{headers:{Authorization:`Bearer ${o.accessToken}`}});return new Uint8Array(await g.arrayBuffer())}const c=u==null?void 0:u["github.com"],d=`https://${c!=null?c:"vscode.dev"}/indexes/github/${r}/${n}/${i}`,f=await _r()(d,{headers:{"x-proxy-authorization":`Bearer ${o.accessToken}`},credentials:"include"});return new Uint8Array(await f.arrayBuffer())}const a=`https://api.github.com/repos/${r}/${n}/tarball/${i}`,s=await _r()(a,{headers:{Authorization:`Bearer ${o.accessToken}`}});return new Uint8Array(await s.arrayBuffer())}async pushCommit(t,r,n,i){q.log(`Pushing commit ${r} to upstream; rootUri=${t.toString(!0)}`);try{const o=await this.getMetadata(t),{repo:{owner:a,name:s}}=i!=null?i:o;if(n===void 0&&o.HEAD.detached)throw new gn("Unable to commit; no current branch");(n==null?void 0:n.startsWith("refs/heads/"))&&(n=n.substr(11));const u=await this.request("PATCH /repos/{owner}/{repo}/git/refs/{ref}",{owner:a,repo:s,ref:`heads/${n!=null?n:o.HEAD.branch.name}`,sha:r});return n===void 0&&!o.HEAD.detached&&await this.fastForwardTo(t,r,o),u.data.ref}catch(o){throw o instanceof Sr&&o.status===422&&o.message.includes("Update is not a fast forward")?new hi(o):(q.error(o),o)}}async queryRepositoryObject(t,r,n){var i,o;try{const{repo:{owner:a,name:s},HEAD:{sha:u},path:c}=await this.providerService.getMetadata(t),d=`query ${r}(
	$owner: String!
	$repo: String!
	$path: String
) {
	repository(owner: $owner, name: $repo) {
		object(expression: $path) {
			${n}
		}
	}
}`,f=await this.graphql(d,{owner:a,repo:s,path:`${u}:${c}`});return(o=(i=f==null?void 0:f.repository)==null?void 0:i.object)!=null?o:void 0}catch(a){return}}async searchPullRequestsQuery(t){try{let r=function(a,s){return{number:a.number,title:a.title,repoWithOwner:a.repository.nameWithOwner,reasons:s?[s]:[],url:a.url}};const n=`query searchPullRequests(
	$authored: String!
	$assigned: String!
	$reviewRequested: String!
	$mentioned: String!
) {
	viewer {
		repositories(first: 100, orderBy: { field: STARGAZERS, direction: DESC }) {
			nodes {
				pullRequests(first: 100, states: OPEN, orderBy: { field: UPDATED_AT, direction: DESC }) {
					nodes {
						number
						title
						url
						repository {
							nameWithOwner
						}
					}
				}
			}
		}
	}
	authored: search(first: 100, query: $authored, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
	assigned: search(first: 100, query: $assigned, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
	reviewRequested: search(first: 100, query: $reviewRequested, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
	mentioned: search(first: 100, query: $mentioned, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
}`;t=t.trim();const i=await this.graphql(n,{authored:(t?`${t} is:pr is:open archived:false author:@me`:"is:pr is:open archived:false author:@me").trim(),assigned:(t?`${t} is:pr is:open archived:false assignee:@me`:"is:pr is:open archived:false assignee:@me").trim(),reviewRequested:(t?`${t} is:pr is:open archived:false review-requested:@me`:"is:pr is:open archived:false review-requested:@me").trim(),mentioned:(t?`${t} is:pr is:open archived:false mentions:@me`:"is:pr is:open archived:false mentions:@me").trim()});return i===void 0?[]:Pa([...i.assigned.nodes.map(a=>r(a,"assigned")),...i.reviewRequested.nodes.map(a=>r(a,"review requested")),...i.mentioned.nodes.map(a=>r(a,"mentioned")),...i.authored.nodes.map(a=>r(a,"authored")),...Cs(i.viewer.repositories.nodes,a=>a.pullRequests.nodes.map(s=>r(s)))],a=>a.url,(a,s)=>(s.reasons.length!==0&&a.reasons.push(...s.reasons),a))}catch(r){return[]}}async searchRepositoriesQuery(t,r){try{const n=`query searchRepositories(
	$search: String!
) {
	viewer {
		repositories(first: 100, orderBy: { field: UPDATED_AT, direction: DESC }) {
			nodes {
				nameWithOwner
				description
				url
				parent {
					nameWithOwner
				}
				stargazerCount
			}
		}
	}
	search(first: 100, query: $search, type: REPOSITORY) {
		nodes {
			...on Repository {
				nameWithOwner
				description
				url
				parent {
					nameWithOwner
				}
				stargazerCount
			}
		}
	}
}`;(r==null?void 0:r.user)&&(t+=` user:${r.user}`),(r==null?void 0:r.sort)&&(t+=` sort:${r.sort}`);const i=await this.graphql(n,{search:t.trim()});return i===void 0?[]:Pa((r==null?void 0:r.user)?[...i.search.nodes,...i.viewer.repositories.nodes]:[...i.viewer.repositories.nodes,...i.search.nodes],a=>a.url).map(a=>{var s,u,c;return{repoWithOwner:a.nameWithOwner,description:(s=a.description)!=null?s:void 0,url:a.url,fork:(c=(u=a.parent)==null?void 0:u.nameWithOwner)!=null?c:void 0,stars:a.stargazerCount}})}catch(n){return[]}}async searchCodeQuery(t,r,n){var i,o,a;const{repo:{owner:s,name:u},HEAD:c,defaultBranch:d}=await this.getMetadata(r),f=[];((i=c.branch)==null?void 0:i.name)!==d.name&&f.push(at("cant search branch","Unable to search {0}, falling back to {1}. Enable indexing for results specific to {0}.",(a=(o=c.branch)==null?void 0:o.name)!=null?a:c.detached.name,d.name));try{const p=await(await this.octokit({request:{headers:{accept:"application/vnd.github.v3.text-match+json"}}})).request("GET /search/code",{q:`${t} repo:${s}/${u}`}),g=new l.Range(0,0,0,0),w=[];let _=0,D;for(const C of p.data.items)for(const U of C.text_matches){if(_++,n.maxResults!==void 0&&_>n.maxResults)return{matches:w,limitHit:!0};D={path:C.path,ranges:[],preview:U.fragment,matches:[]};for(const F of U.matches){let z=0,ue=0,Q=0;for(let de=0;de<F.indices[1];de++)de===F.indices[0]&&(ue=Q),U.fragment[de]===`
`?(z++,Q=0):Q++;D.ranges.push(g),D.matches.push(new l.Range(z,ue,z,Q))}w.push(D)}return{matches:w,limitHit:!1,warnings:f}}catch(h){return{matches:[],limitHit:!0}}}async switchTo(t,r,n){const{name:i,repo:o,HEAD:{branch:a}}=await this.getMetadata(t);if(!(r!==void 0&&((r==null?void 0:r.startsWith("refs/heads/"))?r=r.substr(11):(r==null?void 0:r.startsWith("refs/tags/"))&&(r=r.substr(10)),(a==null?void 0:a.name)===r)))return{name:i,uri:this.providerService.createVirtualUri(t,{repo:o,ref:r?{type:Ee.Tree,id:r}:void 0}),location:(n==null?void 0:n.openInNewWindow)?Le.NewWindow:Le.CurrentWindow}}async sync(t,r,n){var i,o,a;const[,s]=await this.fetchCore(t,{sync:!0,to:n.to});if(!s.HEAD.detached){if(((o=(i=s==null?void 0:s.state)==null?void 0:i.behind)!=null?o:0)>0&&await r.hasChanges(t)){q.log(`Syncing upstream changes; rootUri=${t.toString(!0)}`);const u=this.getIncomingChangesCore(t,s),c=[];let d;if(u.length>0){d=await r.getChanges(t);for(const f of d){const h=this.providerService.getRelativeFilePath(t,f.uri),p=u.find(g=>g.uri.path===f.uri.path);if(p!==void 0){c.push({path:h,current:f,incoming:p});break}}}if(c.length>0)switch(n.conflictResolution){case Nt.KeepCurrent:q.log(`Syncing upstream changes(keep): ${c.length} conflicts; rootUri=${t.toString(!0)}`);for(const f of c)await r.keep(f.current.uri,{type:f.incoming.type,providerUri:Fa(s,s.HEAD.branch.sha,f.path)});break;case Nt.DiscardCurrent:q.log(`Syncing upstream changes(discard): ${c.length} conflicts; rootUri=${t.toString(!0)}`);for(const f of c)await r.discard(f.current.uri);break;case Nt.Merge:q.log(`Syncing upstream changes(merge): ${c.length} conflicts; rootUri=${t.toString(!0)}`);for(const f of c)await r.merge(f.current.uri,{type:f.incoming.type,providerUri:Fa(s,s.HEAD.branch.sha,f.path)},{providerUri:Fa(s,s.HEAD.sha,f.path)});break;case Nt.Abort:default:throw q.log(`Syncing upstream changes(abort): ${c.length} conflicts; rootUri=${t.toString(!0)}`),await this.providerService.updateMetadata(t,s),new fi}}await this.fastForwardTo(t,(a=n.to)!=null?a:s.HEAD.branch.sha,s)}}async fastForwardTo(t,r,n){if(n.HEAD.detached)throw new gn("Unable to fast-forward; no current branch");n.HEAD.sha===r&&n.state===void 0||(q.log(`Fast forward to ${r}; rootUri=${t.toString(!0)}`),await this.providerService.updateMetadata(t,{...n,HEAD:{...n.HEAD,detached:void 0,sha:r},state:void 0,timestamp:Date.now()}),r!==n.HEAD.branch.sha&&await this.fetchCore(t,{sync:!1,to:r}))}async getBranchTips(t,r){try{const{repo:{owner:n,name:i},HEAD:{branch:o}}=await this.getMetadata(t);r===void 0&&(r=o?`refs/heads/${o.name}`:"");const a=`query getBranchTips(
	$owner: String!
	$repo: String!
	$ref: String!
) {
	repository(owner: $owner, name: $repo) {
		defaultBranchRef {
			target {
				oid
			}
		}
		ref(qualifiedName: $ref) {
			target {
				oid
			}
		}
	}
}`,s=await this.graphql(a,{owner:n,repo:i,ref:r});if(!(s==null?void 0:s.repository))return;const{defaultBranchRef:u,ref:c}=s.repository;return!u&&!c?void 0:{defaultBranch:u?{sha:u.target.oid}:void 0,branch:c?{sha:c.target.oid}:void 0}}catch(n){return}}async getRepositoryInfo(t,r,n){var i,o,a,s,u,c,d,f,h,p,g,w,_;try{const D=`query getRepository(
	$owner: String!
	$repo: String!
	$ref: String = ""
	$pr: Boolean!
	$number: Int = 0
) {
	viewer {
		login
	}
	repository(owner: $owner, name: $repo) {
		name
		owner {
			login
		}
		defaultBranchRef {
			name
			target {
				oid
			}
		}
		ref(qualifiedName: $ref) {
			name
			prefix
			target {
				oid
			}
		}
		viewerPermission
		parent {
			name
			owner {
				login
			}
			defaultBranchRef {
				name
				target {
					oid
				}
			}
			viewerPermission
			pullRequest(number: $number) @include(if: $pr) {
				number
				title
				state
				maintainerCanModify
				baseRef {
					name
				}
				baseRefName
				baseRefOid
				baseRepository {
					name
					owner {
						login
					}
					defaultBranchRef {
						name
						target {
							oid
						}
					}
					viewerPermission
				}
				headRef {
					name
				}
				headRefName
				headRefOid
				headRepository {
					name
					owner {
						login
					}
					defaultBranchRef {
						name
						target {
							oid
						}
					}
					viewerPermission
				}
				mergeCommit {
					oid
				}
			}
		}
		pullRequest(number: $number) @include(if: $pr) {
			number
			title
			state
			maintainerCanModify
			baseRef {
				name
			}
			baseRefName
			baseRefOid
			baseRepository {
				name
				owner {
					login
				}
				defaultBranchRef {
					name
					target {
						oid
					}
				}
				viewerPermission
			}
			headRef {
				name
			}
			headRefName
			headRefOid
			headRepository {
				name
				owner {
					login
				}
				defaultBranchRef {
					name
					target {
						oid
					}
				}
				viewerPermission
			}
			mergeCommit {
				oid
			}
		}
	}
}`;let C;try{C=await this.graphql(D,{owner:t,repo:r,ref:(n==null?void 0:n.ref)!=="HEAD"?n==null?void 0:n.ref:void 0,pr:Boolean(n==null?void 0:n.pr),number:(i=n==null?void 0:n.pr)!=null?i:0})}catch(z){if(!(z instanceof Error)||!z.message.startsWith("Could not resolve to a PullRequest with the number"))throw z;C=z.data}if(C===void 0)return;const U=(u=(o=C.repository)==null?void 0:o.pullRequest)!=null?u:(s=(a=C.repository)==null?void 0:a.parent)==null?void 0:s.pullRequest;if(U==null?void 0:U.headRef){const z=(d=(c=U.headRepository)==null?void 0:c.defaultBranchRef)!=null?d:void 0;return(z==null?void 0:z.name)===void 0?void 0:{user:C.viewer.login,repo:{owner:U.headRepository.owner.login,name:U.headRepository.name},accessLevel:Ru(U.headRepository.viewerPermission),ref:U.headRef?{prefix:"refs/heads/",name:U.headRef.name,sha:U.headRefOid}:(n==null?void 0:n.ref)==="HEAD"?{prefix:"refs/heads/",name:z.name,sha:z.target.oid}:void 0,defaultBranch:{name:z.name,sha:z.target.oid},pullRequest:U?{id:U.number.toString(),repo:{owner:U.baseRepository.owner.login,name:U.baseRepository.name},state:Xi(U.state),title:U.title}:void 0}}const F=(h=(f=C.repository)==null?void 0:f.defaultBranchRef)!=null?h:void 0;return(F==null?void 0:F.name)===void 0?void 0:{user:C.viewer.login,repo:{owner:C.repository.owner.login,name:C.repository.name},accessLevel:Ru((p=C==null?void 0:C.repository)==null?void 0:p.viewerPermission),ref:((g=C.repository)==null?void 0:g.ref)?{prefix:C.repository.ref.prefix,name:C.repository.ref.name,sha:C.repository.ref.target.oid}:(U==null?void 0:U.baseRef)?{prefix:"refs/heads/",name:U==null?void 0:U.baseRef.name,sha:(_=(w=U.mergeCommit)==null?void 0:w.oid)!=null?_:U==null?void 0:U.baseRefOid}:(n==null?void 0:n.ref)==="HEAD"?{prefix:"refs/heads/",name:F.name,sha:F.target.oid}:void 0,defaultBranch:{name:F.name,sha:F.target.oid},pullRequest:U?{id:U.number.toString(),repo:{owner:C.repository.owner.login,name:C.repository.name},state:Xi(U.state),title:U.title}:void 0}}catch(D){if(Eu(D)&&D.errors[0].type==="NOT_FOUND")throw new Ir(D,`${t}/${r}`);return}}async validateNameAndOwner(t,r){try{const n=`query validateNameAndOwner(
	$owner: String!
	$repo: String!
) {
	repository(owner: $owner, name: $repo) {
		name
		owner {
			login
		}
	}
}`,i=await this.graphql(n,{owner:t,repo:r});return(i==null?void 0:i.repository)===void 0?void 0:{owner:i.repository.owner.login,name:i.repository.name}}catch(n){if(Eu(n)&&n.errors[0].type==="NOT_FOUND")throw new Ir(n,`${t}/${r}`);return}}}Q0([xt()],ku.prototype,"ensureAuthenticated",1);function Eu(e){return e instanceof Error&&"name"in e&&e.name==="GraphqlError"}function Xi(e){switch(e){case"OPEN":return pn.Open;case"CLOSED":return pn.Closed;case"MERGED":return pn.Merged}}var Cr;(function(e){e.ADMIN="ADMIN",e.MAINTAIN="MAINTAIN",e.WRITE="WRITE",e.TRIAGE="TRIAGE",e.READ="READ",e.NONE="NONE"})(Cr||(Cr={}));function Ru(e){switch(e){case Cr.ADMIN:return nt.Admin;case Cr.MAINTAIN:return nt.Maintain;case Cr.WRITE:return nt.Write;case Cr.TRIAGE:return nt.Triage;case Cr.READ:return nt.Read;default:return nt.None}}const Du=class{constructor(e,t,r){this.providerService=e,this.storageService=t,this.changeStore=r,this.lock=new bi("PendingRepositoryOpenActions"),this.disposable=l.Disposable.from(e.onDidChangeRepositories(n=>n.added.length&&this.onRepositoriesOpened(n.added)))}dispose(){this.disposable.dispose()}async onRepositoriesOpened(e){for(const t of e){const r=await this.getAndDelete(t);(r==null?void 0:r.applyChangeset)&&await this.applyPendingChangeset(t,r.applyChangeset),(r==null?void 0:r.filesToOpen)&&this.openPendingFiles(t,r.filesToOpen),this.fetchOrSync(t)}}async fetchOrSync(e){if(await this.changeStore.hasChanges(e.uri))await this.providerService.fetch(e.uri,{force:!0});else{const{index:t}=await e.getMetadata();await this.providerService.sync(e.uri,this.changeStore,{to:t==null?void 0:t.sha})}}async get(e){return this.lock.synchronizeRead(()=>this.getCore(e.uri),"PendingRepositoryOpenActions.get")}async getAndDelete(e){q.debug(`RepositoryOpenActionsService.getAndDelete(${e.uri.toString()})`);try{return await this.lock.synchronizeWrite(async()=>{const r=await this.getCore(e.uri);if(r!==void 0)return await this.storeCore(e.uri,void 0),r},"PendingRepositoryOpenActions.getAndDelete")}catch(t){q.error(t,`Failed to get pending actions for ${e.uri.toString()}`);return}}setChangesetToApply(e,t){return q.log(`RepositoryOpenActionsService.setChangesetToApply(${e.toString()})`),this.lock.synchronizeWrite(async()=>{const r=await this.getCore(e);await this.storeCore(e,{...r,applyChangeset:t})},"PendingRepositoryOpenActions.setChangesetToApply")}setFilesToOpen(e,t){return q.log(`RepositoryOpenActionsService.setFilesToOpen(${e.toString()})`,t.length),this.lock.synchronizeWrite(async()=>{const r=await this.getCore(e);await this.storeCore(e,{...r,filesToOpen:t})},"PendingRepositoryOpenActions.setFilesToOpen")}async applyPendingChangeset(e,t){q.log(`RepositoryOpenActionsService.applyPendingChangeset(${e.uri.toString()})`);try{await this.changeStore.applyChangeset(e.uri,t,{save:!0})}catch(r){q.error(r,`Failed to apply pending changeset for ${e.uri.toString()}`)}}openPendingFiles(e,t){if(t.length!==0){q.log(`RepositoryOpenActionsService.openPendingFiles(${e.uri.toString()})`,t.length);for(const r of t)l.commands.executeCommand("vscode.open",l.Uri.joinPath(e.uri,r))}}async getCore(e){return this.fromStorage(await this.storageService.get(this.getStorageKey(e)))}storeCore(e,t){return t===void 0||t.applyChangeset===void 0&&(t.filesToOpen===void 0||t.filesToOpen.length===0)?this.storageService.delete(this.getStorageKey(e)):this.storageService.store(this.getStorageKey(e),this.toStorage(t))}getStorageKey(e){return`actions/${Y(e)}`}fromStorage(e){if(!!e)try{const t=JSON.parse(e,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&n!==null?l.Uri.from(n):n);return{filesToOpen:t.filesToOpen,applyChangeset:t.applyChangeset}}catch(t){return q.error(t,"Failed to deserialize pending repository actions"),{}}}toStorage(e){const t={schemaVersion:Du.storageSchemaVersion,...e};return JSON.stringify(t)}};let Au=Du;Au.storageSchemaVersion=1;const ft=(0,P.loadMessageBundle)();class J0{constructor(t,r){this.providerService=t,this.changeStore=r,this._onDidChangeFileDecorations=new l.EventEmitter,this._decorations=new Map,this.disposable=l.Disposable.from(l.window.registerFileDecorationProvider(this),t.onDidChangeRepository(this.onRefresh,this),t.onDidRefresh(this.onRefresh,this),r.onDidChange(this.onUrisChanged,this))}get onDidChangeFileDecorations(){return this._onDidChangeFileDecorations.event}dispose(){this.disposable.dispose(),this._decorations.clear()}onRefresh(){this._decorations.clear(),this._onDidChangeFileDecorations.fire(void 0)}onUrisChanged(t){this._onDidChangeFileDecorations.fire(t.map(r=>(this._decorations.delete(Y(r.uri)),r.uri)))}async provideFileDecoration(t,r){if(t.scheme!==Fe.scheme)return;const n=Y(t);let i=this._decorations.get(n);if(i!==void 0)return i!=null?i:void 0;const o=await this.providerService.getIncomingChanges(this.providerService.getVirtualRootUri(t));let a;o.length>0&&(a=o.find(u=>Y(u.uri)===n));const s=await this.changeStore.getChange(t);if(s===void 0){if(a!==void 0)switch(a.type){case xe.Created:i={badge:"\u2193A",color:new l.ThemeColor("remoteHub.decorations.incomingAddedForegroundColor"),tooltip:ft("decoration tooltip incoming change added","Pending Incoming Changes (Added)")};break;case xe.Deleted:i={badge:"\u2193D",color:new l.ThemeColor("remoteHub.decorations.incomingDeletedForegroundColor"),tooltip:ft("decoration tooltip incoming change deleted","Pending Incoming Changes (Deleted)")};break;case xe.Changed:i={badge:"\u2193M",color:new l.ThemeColor("remoteHub.decorations.incomingModifiedForegroundColor"),tooltip:ft("decoration tooltip incoming change modified","Pending Incoming Changes (Modified)")};break;default:i={badge:"\u2193~",color:new l.ThemeColor("remoteHub.decorations.incomingModifiedForegroundColor"),tooltip:ft("decoration tooltip incoming change","Pending Incoming Changes")};break}return this._decorations.set(n,i!=null?i:null),i}if(s.conflicts)i={badge:"\u26A0",color:new l.ThemeColor("remoteHub.decorations.conflictForegroundColor"),tooltip:ft("decoration tooltip conflicts","Merge Conflicts ({0})",kg(s.conflicts.status))};else if(a!==void 0)switch(a.type){case xe.Created:i={badge:"\u26A0",color:new l.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:ft("decoration tooltip possible conflict added","Possible Merge Conflicts (Added)")};break;case xe.Deleted:i={badge:"\u26A0",color:new l.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:ft("decoration tooltip possible conflict deleted","Possible Merge Conflicts (Deleted)")};break;case xe.Changed:i={badge:"\u26A0",color:new l.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:ft("decoration tooltip possible conflict","Possible Merge Conflicts")};break;default:i={badge:"\u26A0",color:new l.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:ft("decoration tooltip possible conflict","Possible Merge Conflicts")}}else switch(s.type){case xe.Created:i={badge:"A",color:new l.ThemeColor("remoteHub.decorations.addedForegroundColor"),tooltip:ft("decoration tooltip added","Added")};break;case xe.Changed:i={badge:"M",color:new l.ThemeColor("remoteHub.decorations.modifiedForegroundColor"),tooltip:ft("decoration tooltip modified","Modified")};break;case xe.Deleted:i={badge:"D",color:new l.ThemeColor("remoteHub.decorations.deletedForegroundColor"),tooltip:ft("decoration tooltip deleted","Deleted")};break}return this._decorations.set(n,i!=null?i:null),i}}class tn{constructor(t){this.command=t}get label(){return this.command.title}async execute(){var t;return void await l.commands.executeCommand(this.command.command,...(t=this.command.arguments)!=null?t:[])}}var Ji;(function(e){async function t(r,n,i,o,a,s){let u;Array.isArray(a)?u=a:s===void 0&&(u=[],s=a);const c=l.window.createQuickPick(),d=new Uo(500),f=[d],{defaultBranch:h,HEAD:p}=await r.getMetadata(n);async function g(U){var F;const[z,ue]=await Promise.all([r.getBranches(n,{query:U,limit:100}),r.getTags(n,{query:U,limit:100})]),Q=((s==null?void 0:s.filterBranches)?z.branches.filter(s==null?void 0:s.filterBranches):z.branches).filter(de=>de.name!==h.name);return[...u,...((F=p.branch)==null?void 0:F.name)!==h.name?[{label:`$(git-branch) ${h.name} (default)`,description:`$(git-commit) ${Je(h.sha)}`,alwaysShow:!0,name:void 0,sha:h.sha}]:[],...Q.map(de=>({label:`$(git-branch) ${de.name}`,description:`$(git-commit) ${Je(de.commit)}`,name:de.name,sha:de.commit})),...ue.tags.map(de=>({label:`$(tag) ${de.name}`,description:`$(git-commit) ${Je(de.commit)}`,name:de.name,sha:de.commit}))]}const w=g(void 0);let _,D=!1;async function C(U){_=void 0;const F=c.activeItems;c.items=U!=null?U:await w,D&&F.length!==0&&(c.activeItems=c.items.filter(z=>F.some(ue=>ue.label===z.label))),c.busy=!1}try{return await new Promise(F=>{f.push(c.onDidHide(()=>F(void 0)),c.onDidChangeValue(z=>{D=!1,z=z.trim(),c.busy=!0;const ue=d.debounce(z?()=>g(z):()=>w);_===void 0&&(_=ue.then(async Q=>C(Q)))}),c.onDidAccept(()=>{if(c.activeItems.length!==0){const[z]=c.activeItems;F(z)}})),c.title=o,c.placeholder=i,c.matchOnDescription=!0,c.ignoreFocusOut=!0,c.busy=!0,c.show(),_=d.debounce(async()=>w,0).then(z=>C(z))})}finally{c.dispose(),f.forEach(U=>void U.dispose())}}e.show=t})(Ji||(Ji={}));function $a(e){switch(e){case Be.Branch:return"$(git-branch)";case Be.Tag:return"$(tag)";case Be.Commit:return"$(git-commit)"}}function Y0(e){switch(e){case Be.Branch:return new l.ThemeIcon("git-branch");case Be.Tag:return new l.ThemeIcon("tag");case Be.Commit:return new l.ThemeIcon("git-commit")}}const Z=(0,P.loadMessageBundle)(),ey=new TextDecoder;class ty{constructor(t,r,n,i){this.providerService=t,this.changeStore=r,this.openActionsService=n,this.telemetryService=i,this._onDidCloseRepository=new l.EventEmitter,this._onDidOpenRepository=new l.EventEmitter,this._onDidChangeState=new l.EventEmitter,this._scmProviders=[],this._state="uninitialized",this.disposable=l.Disposable.from(Ce.onDidChange(this.onConfigurationChanged,this),this.providerService.onDidChangeRepositories(this.onRepositoriesChanged,this),this.providerService.onDidChangeRepository(async({repository:a,state:s})=>{const u=this.getScmProvider(this.providerService.getVirtualUri(a.uri));u!==void 0&&await this.updateStatusBarCommands(u,s)}),this.providerService.onDidRefresh(a=>{for(const s of a)this.update(s)}),this.changeStore.onDidChange(a=>this.update(a[0].rootUri)),...this.registerCommands());const o=this.providerService.repositories;o.length&&this.onRepositoriesChanged({added:o,removed:[]})}get onDidCloseRepository(){return this._onDidCloseRepository.event}get onDidOpenRepository(){return this._onDidOpenRepository.event}get onDidChangeState(){return this._onDidChangeState.event}get repositories(){return this._scmProviders.map(t=>t.repository).filter(t=>Boolean(t))}dispose(){var t;(t=this.disposable)==null||t.dispose()}get staging(){return this._staging===void 0&&(this._staging=Ce.get("staging")),this._staging}get state(){return this._state}refresh(){for(const t of this._scmProviders)this.update(t.sourceControl.rootUri)}onConfigurationChanged(t){Ce.changed(t,"staging")&&(this._staging=void 0,Ce.changed(t,"staging.enabled")&&this.refresh())}async onRepositoriesChanged(t){if(t.added.length)for(const r of t.added){const n=await this.update(r.uri);(n==null?void 0:n.repository)&&this._onDidOpenRepository.fire(n.repository)}if(t.removed.length)for(const r of t.removed){const n=this._scmProviders.findIndex(i=>Y(i.sourceControl.rootUri)===Y(r.uri));if(n!==-1){const i=this._scmProviders[n];i.repository&&this._onDidCloseRepository.fire(i.repository),i.sourceControl.dispose(),this._scmProviders.splice(n,1)}}this._scmProviders.length!==0&&(this._state="initialized",this._onDidChangeState.fire(this._state))}registerCommands(){return[l.commands.registerCommand("remoteHub.createPullRequest",t=>{if(t=this.getSourceControlFrom(t),t!==void 0)return this.telemetryService.sendEvent("command.createPullRequest"),void this.createPullRequest(t)}),l.commands.registerCommand("remoteHub.createDraftPullRequest",t=>{if(t=this.getSourceControlFrom(t),t!==void 0)return this.telemetryService.sendEvent("command.createDraftPullRequest"),void this.createPullRequest(t,{draft:!0})}),l.commands.registerCommand("remoteHub.commit",t=>{if(t=this.getSourceControlFrom(t),t!==void 0)return this.telemetryService.sendEvent("command.commit"),void this.commitChanges(t)}),l.commands.registerCommand("remoteHub.discardAllChanges",async t=>{if(Tu(t)){const o=t.resourceStates.filter(Zn);if(o.length!==0){if(await Oa(o))for(const a of o)await this.changeStore.discard(a.resourceUri);else this.telemetryService.sendEvent("command.discardAllChanges.abort",{reason:"aborted"});return}}const r=this.getSourceControlFrom(t);if((r==null?void 0:r.rootUri)===void 0)return;this.telemetryService.sendEvent("command.discardAllChanges");const n=await this.changeStore.getChanges(r.rootUri);await Oa(n)?await this.changeStore.discardAll(r.rootUri):this.telemetryService.sendEvent("command.discardAllChanges.abort",{reason:"aborted"})}),l.commands.registerCommand("remoteHub.discardChanges",async t=>{!Zn(t)||(this.telemetryService.sendEvent("command.discardChanges"),await Oa([t])?await this.changeStore.discard(t.resourceUri):this.telemetryService.sendEvent("command.discardChanges.abort",{reason:"aborted"}))}),l.commands.registerCommand("remoteHub.stageAllChanges",async t=>{const r=this.getSourceControlFrom(t);(r==null?void 0:r.rootUri)!==void 0&&(this.telemetryService.sendEvent("command.stageAllChanges"),await this.changeStore.stageAll(r.rootUri))}),l.commands.registerCommand("remoteHub.stageChanges",t=>{if(!!Zn(t))return this.telemetryService.sendEvent("command.stageChanges"),void this.changeStore.stage(t.resourceUri)}),l.commands.registerCommand("remoteHub.unstageAllChanges",t=>{const r=this.getSourceControlFrom(t);if((r==null?void 0:r.rootUri)!==void 0)return this.telemetryService.sendEvent("command.unstageAllChanges"),void this.changeStore.unstageAll(r.rootUri)}),l.commands.registerCommand("remoteHub.unstageChanges",t=>{if(!!Zn(t))return this.telemetryService.sendEvent("command.unstageChanges"),void this.changeStore.unstage(t.resourceUri)}),l.commands.registerCommand("remoteHub.keepChanges",t=>{if(!!Zn(t))return this.telemetryService.sendEvent("command.keepChanges"),void this.changeStore.keep(t.resourceUri)}),l.commands.registerCommand("remoteHub.openChanges",t=>{var r;const{command:n}=t;if(!!n)return this.telemetryService.sendEvent("command.openChanges"),void l.commands.executeCommand(n.command,...(r=n.arguments)!=null?r:[])}),l.commands.registerCommand("remoteHub.openFile",t=>{var r;if(Pu(t)){const i=this.changeStore.resolveOpenCommand(t.resourceUri,{preserveFocus:!1,preview:!1,viewColumn:l.ViewColumn.Active});return this.telemetryService.sendEvent("command.openFile"),void l.commands.executeCommand(i.command,...(r=i.arguments)!=null?r:[])}const n=l.window.activeTextEditor;if(!!n)return this.telemetryService.sendEvent("command.openFile"),void l.window.showTextDocument(n.document)}),l.commands.registerCommand("remoteHub.createBranch",async t=>{await Lo("remoteHub.createBranchFrom",{...t,fromSha:"HEAD"})}),l.commands.registerCommand("remoteHub.createBranchFrom",async t=>{var r;const n=(r=t==null?void 0:t.uri)!=null?r:await Kn(this._scmProviders,Z("choose repo for create branch placeholder","Choose which repository to create a new branch on"),Z("choose repo for create branch title","Create Branch"));if(n===void 0)return;this.telemetryService.sendEvent("command.createBranchFrom");const i=await this.providerService.getMetadata(n);if(i.accessLevel<nt.Write){this.telemetryService.sendEvent("command.createBranchFrom.abort",{reason:"no permissions"}),l.window.showErrorMessage(Z("no permissions to create branch ","You don't have access to create branches on this repository."));return}let o;if(t==null?void 0:t.fromSha)o=t.fromSha,o==="HEAD"&&(o=i.HEAD.sha);else{const h=await Ji.show(this.providerService,n,Z("choose branch for create placeholder","Choose which branch to create the new branch from"),Z("choose branch for create title","Create Branch \u2022 {0}",i.name));if(!h){this.telemetryService.sendEvent("command.createBranchFrom.abort",{reason:"abandoned branch picker"});return}o=h.sha}let a;try{a=await l.window.withProgress({location:l.ProgressLocation.SourceControl},()=>Ua(this.providerService,n,o,Z("create branch","Please provide a new branch name"),Z("create branch placeholder","New branch name"),Z("create branch title","Create Branch \u2022 {0}",i.name)))}catch(h){q.error(h),l.window.showErrorMessage(Z("unable to create branch","Unable to create the new branch."));return}if(!a){this.telemetryService.sendEvent("command.createBranchFrom.abort",{reason:"abandoned branch name prompt"});return}const s=await this.providerService.switchTo(n,a);if(!s)return;const u=await this.changeStore.createChangeset(n);u&&await this.openActionsService.setChangesetToApply(s.uri,u);const c="Switch",d="Open in New Window",f=await l.window.showInformationMessage("Would you like to switch to the new branch?",c,d);!f||(s.location=f===d?Le.NewWindow:Le.CurrentWindow,await vt(s))}),l.commands.registerCommand("remoteHub.applyPatch",async t=>{if(t=this.getSourceControlFrom(t),(t==null?void 0:t.rootUri)===void 0)return;this.telemetryService.sendEvent("command.applyPatch");let r;const n=l.window.activeTextEditor;if((n==null?void 0:n.document.languageId)!=="diff"){const i=await l.window.showOpenDialog({openLabel:Z("open patch","Open Patch"),title:Z("open patch","Open Patch"),canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{Diff:["diff"],Patch:["patch"]}});if(i===void 0||i.length===0)return;r=ey.decode(await l.workspace.fs.readFile(i[0]))}else r=n.document.getText();try{await this.changeStore.applyPatch(t.rootUri,r)}catch(i){l.window.showErrorMessage(i.toString())}}),l.commands.registerCommand("remoteHub.exportPatch",async t=>{const r=this.getSourceControlFrom(t);if((r==null?void 0:r.rootUri)===void 0)return;let n;Pu(t)&&(n=t.resourceUri),this.telemetryService.sendEvent("command.exportPatch");const i=await this.changeStore.createPatch(r.rootUri,n),o=await l.workspace.openTextDocument({language:"diff",content:i});await l.window.showTextDocument(o)}),l.commands.registerCommand("remoteHub.switchToBranch",async t=>{var r,n;const i=(r=t==null?void 0:t.uri)!=null?r:await Kn(this._scmProviders,Z("choose repo for switch branch placeholder","Choose which repository to switch branches on"),Z("choose repo for switch branch title","Switch to Branch Or Tag"));if(i===void 0)return;this.telemetryService.sendEvent("command.switchToBranch");const o=[],a=await this.providerService.getMetadata(i);if(t==null?void 0:t.commands)switch(a.accessLevel>=nt.Write&&o.push(new tn(Bt({command:"remoteHub.createBranch",title:Z("create branch command","$(add) Create New Branch..."),arguments:[{uri:i}]})),new tn(Bt({command:"remoteHub.createBranchFrom",title:Z("create branch from command","$(add) Create New Branch from..."),arguments:[{uri:i}]}))),a.HEAD.type){case Be.Branch:o.push(new tn(Bt({command:"remoteHub.openOnRemote",title:Z("open branch on remote command","$(globe) Open Branch on {0}...",a.provider.name),arguments:[{provider:a.provider,repo:a.repo,branch:a.HEAD.branch.name}]})));break;case Be.Tag:o.push(new tn(Bt({command:"remoteHub.openOnRemote",title:Z("open tag on remote command","$(globe) Open Tag on {0}...",a.provider.name),arguments:[{provider:a.provider,repo:a.repo,branch:a.HEAD.detached.name}]})));break;case Be.Commit:o.push(new tn(Bt({command:"remoteHub.openOnRemote",title:Z("open commit on remote command","$(globe) Open Commit on {0}...",a.provider.name),arguments:[{provider:a.provider,repo:a.repo,sha:a.HEAD.sha}]})));break}const s=(n=a.HEAD.branch)==null?void 0:n.name,u=await Ji.show(this.providerService,i,Z("choose switch branch placeholder","Choose which branch to switch to"),Z("choose switch branch title","Switch to Branch Or Tag \u2022 {0}",a.name),o,{filterBranches:s?c=>c.name!==s:void 0});if(!u){this.telemetryService.sendEvent("command.switchToBranch.abort",{reason:"abandoned branch picker"});return}return u instanceof tn?void u.execute():void l.window.withProgress({location:l.ProgressLocation.SourceControl},async()=>{const c=await this.providerService.switchTo(i,u.name);if(c!==void 0)return vt(c)})}),l.commands.registerCommand("remoteHub.fetch",async t=>{var r;const n=(r=t==null?void 0:t.uri)!=null?r:await Kn(this._scmProviders,Z("choose repo for fetch placeholder","Choose which repository to fetch"),Z("choose repo for fetch title","Fetch Repository"));if(n!==void 0){this.telemetryService.sendEvent("command.fetch");try{await l.window.withProgress({location:l.ProgressLocation.SourceControl},()=>this.providerService.fetch(n,{force:!0}))}catch(i){l.window.showErrorMessage(Z("fetch failed","Unable to fetch repository"))}}}),l.commands.registerCommand("remoteHub.fetchAll",async t=>{const r=this.providerService.repositories;if(r.length===0)return;(t==null?void 0:t.automated)||this.telemetryService.sendEvent("command.fetchAll"),(await l.window.withProgress({location:l.ProgressLocation.SourceControl},async()=>{const i=[];for(const o of r)try{await this.providerService.fetch(o.uri)}catch(a){i.push(a)}return i})).length&&!(t==null?void 0:t.automated)&&l.window.showErrorMessage(r.length?Z("fetch all failed","Unable to fetch repositories"):Z("fetch failed","Unable to fetch repository"))}),l.commands.registerCommand("remoteHub.pull",async t=>{var r;const n=(r=t==null?void 0:t.uri)!=null?r:await Kn(this._scmProviders,Z("choose repo for pull placeholder","Choose which repository to pull"),Z("choose repo for pull title","Pull Repository"));n!==void 0&&(this.telemetryService.sendEvent("command.pull"),await this.sync(n,{pull:!0}))}),l.commands.registerCommand("remoteHub.sync",async t=>{var r;const n=(r=t==null?void 0:t.uri)!=null?r:await Kn(this._scmProviders,Z("choose repo for sync placeholder","Choose which repository to sync"),Z("choose repo for sync title","Synchronize Repository"));n!==void 0&&(this.telemetryService.sendEvent("command.sync"),await this.sync(n))})]}async sync(t,{pull:r,...n}={pull:!1}){this.telemetryService.sendEvent("sync");try{await l.window.withProgress({location:l.ProgressLocation.SourceControl},()=>this.providerService.sync(t,this.changeStore,n))}catch(i){if(i instanceof fi){const o={title:Z("sync confirm","Continue")},a={title:Z("sync cancel","Cancel"),isCloseAffordance:!0};await l.window.showWarningMessage(r?Z("sync pull",`Pulling in changes may cause conflicts with your uncommitted changes as one of more of those files has changed since you started editing.

Do you want to continue pulling in changes.`):Z("sync",`Syncing changes may cause conflicts with your uncommitted changes as one of more of those files has changed since you started editing.

Do you want to continue syncing changes?`),{modal:!0},o,a)===o?await l.window.withProgress({location:l.ProgressLocation.SourceControl},()=>this.providerService.sync(t,this.changeStore,{conflictResolution:Nt.Merge})):this.telemetryService.sendEvent("sync.abort",{reason:"abandoned"})}else throw q.error(i),this.telemetryService.sendException(i),l.window.showErrorMessage(Z("sync failed","Unable to synchronize repository")),i}}async commitChanges(t){try{await l.window.withProgress({location:l.ProgressLocation.SourceControl},()=>this.commitChangesCore(t))}catch(r){q.error(r),this.telemetryService.sendException(r),l.window.showErrorMessage(Z("commit unable","Unable to commit."))}}async commitChangesCore(t){const r=t.rootUri;this.telemetryService.sendEvent("commit",{staging:String(this.staging.enabled)});const n=await this.providerService.getMetadata(r);let i,o;for(;;){const s=t.inputBox.value;if(await this.changeStore.hasMergeConflicts(r)){t.inputBox.showValidationMessage(Z("commit resolve conflicts","You must resolve any pending conflicts before committing."),l.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("commit.abort",{reason:"aborted conflicts"});return}const u=await this.providerService.getCommitOperations(r,this.changeStore,{staged:this.staging.enabled?this.staging.smart?"auto":!0:!1});if(u.length===0){t.inputBox.showValidationMessage(this.staging.enabled?Z("commit no staged changes","There are no staged changes to commit."):Z("commit no changes","There are no changes to commit."),l.SourceControlInputBoxValidationType.Information),this.telemetryService.sendEvent("commit.abort",{reason:this.staging.enabled?"aborted no staged changes":"aborted no changes"});return}if(!s){t.inputBox.showValidationMessage(Z("specify commit message","You must specify a commit message before committing."),l.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("commit.abort",{reason:"aborted no message"});return}if(o===void 0&&n.accessLevel<nt.Write&&(o=await this.providerService.getFork(r),o===void 0)){const d=Z("fork confirm","Fork Repository");if(await l.window.showInformationMessage(Z("fork","You\u2019re trying to make changes in a project you don\u2019t have write access to. Would you like to create a fork of this project to commit your proposed changes to?"),d)!==d){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned fork prompt"});return}if(o=await l.window.withProgress({location:l.ProgressLocation.Notification,title:Z("fork progress","Forking {0}...",n.name)},()=>this.providerService.fork(r)),o===void 0){l.window.showErrorMessage(Z("unable to fork","Unable to fork repository.")),this.telemetryService.sendEvent("commit.abort",{reason:"aborted fork failed"});return}}const c=await this.providerService.createCommit(r,s,u,o);try{await this.providerService.pushCommit(r,c,i,o)}catch(d){if(d instanceof gn){const f={title:Z("push detached head prompt","Commit to New Branch")},h={title:Z("cancel","Cancel"),isCloseAffordance:!0};if(await l.window.showErrorMessage(Z("push detached head prompt",`Unable to commit your changes because you are not currently on a branch.

Do you want to commit your changes to a new branch?`),{modal:!0},f,h)!==f){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned detached head prompt"});return}if(i=await Ua(this.providerService,r,n.HEAD.sha,Z("push to new branch prompt","Create a new branch to commit your changes to"),Z("push to new branch placeholder","New branch name"),Z("push to new branch title","Commit \u2022 Create Branch \u2022 {0}",n.name),o),i)continue}else if(d instanceof hi){const f={title:Z("push conflicts prompt pull","Pull")},h={title:Z("push conflicts prompt sync","Sync (Pull & Push)")},p={title:Z("cancel","Cancel"),isCloseAffordance:!0},g=await l.window.showErrorMessage(Z("push conflicts prompt",`Changes have been committed since you started editing, so you must merge those changes before you can commit.

Do you want to pull or sync (pull and automatically push again) your changes?`),{modal:!0},f,h,p);if(g!==f&&g!==h){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned conflicts prompt"});return}if(await this.sync(r,{pull:g===f,conflictResolution:Nt.Merge}),g===f)return;continue}}break}if(t.inputBox.value="",o?await this.changeStore.discardAll(r):await this.changeStore.acceptAll(r),!o&&!i)return;async function a(){if(o){const c=Z("commit to fork confirm","Switch to Fork"),d=await l.window.showInformationMessage(Z("commit to fork","Committed changes to your fork of {0}. Would you like to switch to your fork to continue making changes?",n.name),c);this.telemetryService.sendEvent("commit.switchToFork",{confirm:String(d===c)}),d===c&&vt({name:o.name,uri:this.providerService.createVirtualUri(r,{repo:o.repo,ref:n.HEAD.branch?{type:Ee.Branch,id:n.HEAD.branch.name}:void 0}),location:Le.CurrentWindow});return}const s=Z("commit to new branch confirm","Switch to Branch"),u=await l.window.showInformationMessage(Z("commit to new branch","Committed changes to new branch '{0}'. Would you like to switch to your new branch to continue making changes?",i),s);this.telemetryService.sendEvent("commit.switchToBranch",{confirm:String(u===s)}),u===s&&vt({name:n.name,uri:this.providerService.createVirtualUri(r,{repo:n.repo,ref:i?{type:Ee.Branch,id:i}:void 0}),location:Le.CurrentWindow})}a.call(this)}async createPullRequest(t,r){try{await l.window.withProgress({location:l.ProgressLocation.SourceControl},()=>this.createPullRequestCore(t,r))}catch(n){q.error(n),l.window.showErrorMessage(Z("unable to open pr","Unable to open a pull request."))}}async createPullRequestCore(t,r){var n,i;const o=t.rootUri,a=(n=r==null?void 0:r.draft)!=null?n:!1;this.telemetryService.sendEvent("createPullRequest",{draft:String(a)});let s;if(!(r==null?void 0:r.sha)&&(s=await this.providerService.getCommitOperations(o,this.changeStore),!s.length)){l.window.showInformationMessage(Z("no changes","There are no changes.")),this.telemetryService.sendEvent("createPullRequest.abort",{reason:"aborted no changes"});return}const u=t.inputBox.value;if(!u){t.inputBox.showValidationMessage(Z("specify commit message","Please specify a commit message"),l.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("createPullRequest.abort",{reason:"aborted no message"});return}const c=await this.providerService.getMetadata(o);let d=r==null?void 0:r.fork;if(!d&&c.accessLevel<nt.Write&&(d=await this.providerService.getFork(o),d===void 0)){const _={title:Z("fork confirm","Fork Repository")},D={title:Z("cancel","Cancel"),isCloseAffordance:!0};if(await l.window.showInformationMessage(Z("fork",`You\u2019re trying to make changes in a project you don\u2019t have write access to.

Would you like to create a fork of this project to commit your proposed changes to?`),{modal:!0},_,D)!==_){this.telemetryService.sendEvent("createPullRequest.abort",{reason:"abandoned fork prompt"});return}if(d=await l.window.withProgress({location:l.ProgressLocation.Notification,title:Z("fork progress","Forking {0}...",c.name)},()=>this.providerService.fork(o)),d===void 0){l.window.showErrorMessage(Z("unable to fork","Unable to fork repository.")),this.telemetryService.sendEvent("createPullRequest.abort",{reason:"aborted fork failed"});return}}const f=await l.window.showInputBox({ignoreFocusOut:!0,placeHolder:Z("create pr placeholder","Pull request title"),prompt:Z("create pr prompt","Enter a title for the new pull request"),title:Z("create pr title","New Pull Request"),value:u});if(!f){this.telemetryService.sendEvent("createPullRequest.abort",{reason:"abandoned title prompt"});return}let h;(s==null?void 0:s.length)?h=await this.providerService.createCommit(o,u,s,d):h=(i=r==null?void 0:r.sha)!=null?i:c.HEAD.sha;const p=await Ua(this.providerService,o,h,Z("create pr branch prompt","Create a new branch for this pull request"),Z("create pr branch placeholder","New branch name"),Z("create pr branch title","New Pull Request \u2022 Create Branch \u2022 {0}",c.name),d);if(!p){this.telemetryService.sendEvent("createPullRequest.abort",{reason:"abandoned branch prompt"});return}const g=await this.providerService.createPullRequest(o,p,f,{draft:a},d);t.inputBox.value="",d?await this.changeStore.discardAll(o):await this.changeStore.acceptAll(o);async function w(){if(d){const C=Z("created pr from fork confirm","Switch to Fork"),U=await l.window.showInformationMessage(Z("created pr from fork",'Created [Pull Request #{0}]({1} "Open Pull Request #{0} on {2}") for {3}. Would you like to switch to your fork to continue making changes?',g.id,g.uri.toString(!0),c.provider.name,c.name),C);this.telemetryService.sendEvent("createPullRequest.switchToFork",{confirm:String(U===C)}),U===C&&vt({name:d.name,uri:this.providerService.createVirtualUri(o,{repo:d.repo,ref:{type:Ee.PullRequest,id:g.id}}),location:Le.CurrentWindow});return}const _=Z("created pr from branch confirm","Switch to Branch"),D=await l.window.showInformationMessage(Z("created pr from branch",'Created [Pull Request #{0}]({1} "Open Pull Request #{0} on {2}") for {3}. Would you like to switch to your new branch to continue making changes?',g.id,g.uri.toString(!0),c.provider.name,c.name),_);this.telemetryService.sendEvent("createPullRequest.switchToBranch",{confirm:String(D===_)}),D===_&&vt({name:c.name,uri:this.providerService.createVirtualUri(o,{repo:c.repo,ref:{type:Ee.PullRequest,id:g.id}}),location:Le.CurrentWindow})}w.call(this)}async update(t){const r=l.workspace.getWorkspaceFolder(t);if(r===void 0)return;const n=await this.createOrUpdateScmProvider(t,r.name),i=await this.changeStore.getGroupedChanges(t,{predicate:u=>u.fileType===l.FileType.File}),o=await Promise.all(i.conflicts.map(async u=>({type:u.type,resourceUri:u.uri,command:await this.changeStore.resolveDiffCommand(u.uri,u.conflicts.incomingUri,Z("diff title with conflicts","{0} (Incoming Changes \u2194 Current Changes)",it(u.uri)))}))),a=await Promise.all(i.staged.map(async u=>({type:u.type,resourceUri:u.uri,command:await this.changeStore.resolveDiffCommand(u.uri,this.providerService.getProviderUri(u.uri),Z("diff title index","{0} (Index)",it(u.uri)))}))),s=await Promise.all(i.working.map(async u=>({type:u.type,resourceUri:u.uri,decorations:{strikeThrough:u.type===xe.Deleted},command:await this.changeStore.resolveDiffCommand(u.uri,this.providerService.getProviderUri(u.uri),Z("diff title working","{0} (Working Tree)",it(u.uri)))})));return this.ensureMergeConflictsGroup(n).resourceStates=o,this.ensureStagedChangesGroup(n).resourceStates=this.staging.enabled?a:[],this.ensureWorkingChangesGroup(n).resourceStates=this.staging.enabled?s:[...a,...s],n}async createOrUpdateScmProvider(t,r){const n=await this.providerService.getMetadata(t);let i=this.getScmProvider(t);if(i===void 0){r=n.name;const o=l.scm.createSourceControl(`remoteHub:${n.provider.id}`,r,t);o.quickDiffProvider={provideOriginalResource:s=>this.providerService.getProviderUri(s)},n.accessLevel>=nt.Write?(o.acceptInputCommand={command:"remoteHub.commit",title:Z("scm input accept command title commit","Commit"),arguments:[o]},o.inputBox.placeholder=Z("scm input placeholder commit","Message (Ctrl+Enter to commit to '{0}'",r)):(o.acceptInputCommand={command:"remoteHub.createPullRequest",title:Z("scm input accept command title pr","Create a Pull Request"),arguments:[o]},o.inputBox.placeholder=Z("scm input placeholder pr","Message (Ctrl+Enter to create a pull request for '{0}'",r));const a=this.providerService.createIGitRepository(t,o,n,this.changeStore);i={id:n.provider.id,name:n.provider.name,sourceControl:o,groups:[],repository:a},this.ensureMergeConflictsGroup(i),this.ensureStagedChangesGroup(i),this.ensureWorkingChangesGroup(i),this._scmProviders.push(i)}return await this.updateStatusBarCommands(i,{syncing:!1},n),i}async updateStatusBarCommands(t,r,n){var i,o,a;const s=t.sourceControl.rootUri;n=n!=null?n:await this.providerService.getMetadata(s);const{HEAD:u}=n,c=await this.changeStore.hasChanges(s),d=[Bt({command:"remoteHub.switchToBranch",title:`${$a(u.type)} ${u.name}${c?"*":""}`,tooltip:Je(u.sha),arguments:[{uri:s,commands:!0}]})];u.detached||((r==null?void 0:r.syncing)?d.push(Bt({command:"",title:"$(sync~spin)",tooltip:Z("sync command syncing","Syncing Changes..."),arguments:[]})):d.push(Bt({command:"remoteHub.sync",title:`$(sync)${((o=(i=n.state)==null?void 0:i.behind)!=null?o:0)>0?` ${(a=n.state)==null?void 0:a.behind}\u2193`:""}`,tooltip:Z("sync command","Sync (Pull & Push)"),arguments:[{uri:s}]}))),n.pullRequest&&d.push(Bt({command:"remoteHub.openOnRemote",title:`$(git-pull-request) ${n.pullRequest.id}`,tooltip:Z("scm statusbar command open pr",`Open Pull Request #{0} on {1}

{2}`,n.pullRequest.id,n.provider.name,n.pullRequest.title),arguments:[{provider:n.provider,repo:n.pullRequest.repo,pullRequest:n.pullRequest.id}]})),t.sourceControl.statusBarCommands=d}ensureMergeConflictsGroup(t){const r="conflicts";let n=t.groups.find(i=>i.id===r);return n===void 0&&(n=t.sourceControl.createResourceGroup(r,Z("scm group conflicts","Merge Conflicts")),n.hideWhenEmpty=!0,t.groups.push(n)),n}ensureStagedChangesGroup(t){const r="staged";let n=t.groups.find(i=>i.id===r);return n===void 0&&(n=t.sourceControl.createResourceGroup(r,Z("scm group staged","Staged Changes")),n.hideWhenEmpty=!0,t.groups.push(n)),n}ensureWorkingChangesGroup(t){const r="changes";let n=t.groups.find(i=>i.id===r);return n===void 0&&(n=t.sourceControl.createResourceGroup(r,Z("scm group changes","Changes")),t.groups.push(n)),n}getScmProvider(t){const r=Y(t);return this._scmProviders.find(n=>Y(n.sourceControl.rootUri)===r)}getSourceControlFrom(t){if(t===void 0){if(this._scmProviders.length!==1)return;t=this._scmProviders[0].sourceControl}let r;if(ry(t))r=t;else if(Tu(t)){const n=t,i=this._scmProviders.find(o=>o.groups.includes(n));r=i==null?void 0:i.sourceControl}else{const n=t,i=this._scmProviders.find(o=>o.groups.some(a=>a.resourceStates.includes(n)));r=i==null?void 0:i.sourceControl}return r}}function ry(e){return"rootUri"in e&&"inputBox"in e}function Tu(e){return e!==void 0&&"id"in e&&"label"in e&&"resourceStates"in e&&Array.isArray(e.resourceStates)}function Pu(e){return e!==void 0&&"resourceUri"in e&&e.resourceUri instanceof l.Uri}function Zn(e){return"type"in e}async function Oa(e){var t,r,n;if(e.length===0)return!0;let i,o=Z("discard","Discard Changes");if(e.length===1){const s=e[0];s.type===xe.Created?(i=Z("confirm delete",`Are you sure you want to DELETE {0}?
This is IRREVERSIBLE!
This file will be FOREVER LOST.`,it((t=s.resourceUri)!=null?t:s.uri)),o=Z("delete file","Delete file")):s.type===xe.Deleted?(o=Z("restore file","Restore file"),i=Z("confirm restore","Are you sure you want to restore {0}?",it((r=s.resourceUri)!=null?r:s.uri))):i=Z("confirm discard","Are you sure you want to discard changes in {0}?",it((n=s.resourceUri)!=null?n:s.uri))}else e.every(s=>s.type===xe.Created)?i=Z("confirm delete multiple",`Are you sure you want to DELETE {0} files?
This is IRREVERSIBLE!
These files will be FOREVER LOST.`,e.length):e.every(s=>s.type===xe.Deleted)?(o=Z("restore files","Restore files"),i=Z("confirm restore multiple","Are you sure you want to restore {0} files?",e.length)):i=Z("confirm discard multiple","Are you sure you want to discard changes in {0} files?",e.length);return await l.window.showWarningMessage(i,{modal:!0},o)===o}async function Kn(e,t,r){if(e.length===0)return;if(e.length===1)return e[0].sourceControl.rootUri;const n=await l.window.showQuickPick(e.map(({sourceControl:i})=>({label:i.label,uri:i.rootUri})),{placeHolder:t,title:r});if(!!n)return n.uri}async function Ua(e,t,r,n,i,o,a){const s=new Set;let u;const c=l.window.createInputBox();c.ignoreFocusOut=!0;try{return await new Promise((d,f)=>{u=l.Disposable.from(c.onDidHide(()=>d(void 0)),c.onDidChangeValue(h=>{if(h=h.trim(),!h){c.validationMessage=Z("scm create branch prompt validation missing name","Please enter a valid branch name");return}if(s.has(h)){c.validationMessage=Z("scm create branch prompt validation already exists","Branch '{0}' already exists",h);return}if(!jw(h)){c.validationMessage=Z("scm create branch prompt validation invalid name","'{0}' isn't a valid branch name",h);return}c.validationMessage=void 0}),c.onDidAccept(async()=>{const h=c.value;try{c.enabled=!1,c.busy=!0;const p=await e.createBranch(t,h,r,a);d(p)}catch(p){if(p instanceof mn){c.enabled=!0,c.busy=!1,c.validationMessage=p.duplicate?Z("scm create branch prompt validation already exists","Branch '{0}' already exists",h):Z("scm create branch prompt validation invalid","Invalid branch name '{0}'",h),s.add(h);return}f(p)}})),c.prompt=n,c.placeholder=i,c.title=o,c.show()})}finally{c.dispose(),u==null||u.dispose()}}class Na{constructor(t,r){this.memento=t,this.scope=r,this._onDidChange=new l.EventEmitter}get onDidChange(){return this._onDidChange.event}async get(t){const r=this.getScoped(t),n=new Ae(`MementoStorage.get(${t}): scopedKey=${r}`,{log:!0});try{return await Promise.resolve(this.memento.get(r))}finally{n.stop()}}async getKeys(t){const r=this.getScoped(t),n=new Ae(`MementoStorage.getKeys(${t}): scopedPrefix=${r}`,{log:!0});try{let i=this.getKeysCore(t);if(this.scope!==void 0){const o=this.scope.length+1;i=i.map(a=>a.substr(o))}return await Promise.resolve(i)}finally{n.stop()}}getKeysCore(t){let r=this.memento.keys;return t&&(r=r.filter(n=>n.startsWith(t))),r}async store(t,r){const n=this.getScoped(t),i=new Ae(`MementoStorage.store(${t}): scopedKey=${n}`,{log:!0});try{return await this.storeCore(t,n,r)}finally{i.stop()}}async storeCore(t,r,n){await this.memento.update(r,n),this._onDidChange.fire({key:t})}async delete(t){const r=this.getScoped(t),n=new Ae(`MementoStorage.delete(${t}): scopedKey=${r}`,{log:!0});try{return await this.storeCore(t,r,void 0)}finally{n.stop()}}async deleteKeys(t){const r=this.getScoped(t),n=new Ae(`MementoStorage.deleteKeys(${t}): scopedPrefix=${r}`,{log:!0});try{const i=[],o=this.scope!==void 0?this.scope.length+1:0,a=this.getKeysCore(r);for(const s of a){const u=o!==0?s.substr(o):s;q.debug(`MementoStorage.deleteKeys(${t}): Deleting key=${u}, scopedKey=${s}`);try{await this.storeCore(u,s,void 0)}catch(c){q.debug(`MementoStorage.deleteKeys(${t}): Failed to delete key=${u}, scopedKey=${s}`),i.push(u)}}if(i.length)throw new Error(`Failed to delete keys: ${i.join(", ")}`)}finally{n.stop()}}with(t){return new Na(this.memento,t)}getScoped(t){return`${this.scope!==void 0?`${this.scope}/`:""}${t!=null?t:""}`}}class Ma{constructor(t,r){this.storageUri=t,this.scope=r,this._onDidChange=new l.EventEmitter}get onDidChange(){return this._onDidChange.event}async get(t){const r=this.getScoped(t),n=new Ae(`ExtFileStorageService.get(${t}): scopedKey=${r}`,{log:!0});try{return await l.workspace.fs.readFile(l.Uri.joinPath(this.storageUri,r))}catch(i){return}finally{n.stop()}}async store(t,r){const n=this.getScoped(t),i=new Ae(`ExtFileStorageService.store(${t}): scopedKey=${n}`,{log:!0});try{return await this.storeCore(t,n,r)}finally{i.stop()}}async storeCore(t,r,n){await l.workspace.fs.writeFile(l.Uri.joinPath(this.storageUri,r),n),this._onDidChange.fire({key:t})}async delete(t){const r=this.getScoped(t),n=new Ae(`ExtFileStorageService.delete(${t}): scopedKey=${r}`,{log:!0});try{return await l.workspace.fs.delete(l.Uri.joinPath(this.storageUri,r))}finally{n.stop()}}with(t){return new Ma(this.storageUri,t)}getScoped(t){return`${this.scope!==void 0?`${this.scope}/`:""}${t}`}}const He=(0,P.loadMessageBundle)();class qt extends l.TimelineItem{static is(t){return t instanceof qt}constructor(t,r,n,i,{dateType:o,showAuthor:a,dateFormatter:s}){var u;const c=n.message.indexOf(`
`),d=c!==-1?`${n.message.substring(0,c)} \u2026`:n.message,f=o==="authored"?n.authorDate:n.commitDate;super(d,(u=f==null?void 0:f.getTime())!=null?u:0);this.id=n.hash,this.contextValue=`vscode-vfs:${r}:file:commit`,this.command=i,a&&(this.description=n.authorName),this.detail=He("timeline item detail",`{0} ({1}) \u2014 {2}
{3}

{4}`,n.authorName,n.authorEmail,Je(n.hash),s.format(f),n.message),this.iconPath=new l.ThemeIcon("git-commit"),this.rootUri=t,this.providerId=r,this.hash=n.hash,this.parents=n.parents,this.message=n.message}}class rn extends l.TimelineItem{static is(t){return t instanceof rn}constructor(t,r,n,i,o,{dateFormatter:a,staged:s}){const u=s?He("timeline staged changes","Staged Changes"):He("timeline uncommitted changes","Uncommitted Changes");super(u,n.timestamp);this.id=s?"index":"working",this.contextValue=`vscode-vfs:${r}:file:${this.id}`,this.command=o,this.iconPath=new l.ThemeIcon("git-commit"),s?this.detail=He("timeline index detail",`{0}  \u2014 {1}
{2}

{3}`,He("timeline you","You"),He("timeline index","Index"),a.format(new Date(n.timestamp)),Xs(n.type)):this.detail=He("timeline working detail",`{0}  \u2014 {1}
{2}

{3}`,He("timeline you","You"),He("timeline working","Working Tree"),a.format(new Date(n.timestamp)),Xs(n.type)),this.rootUri=t,this.providerId=r,this.hash=s?"~":"",this.parents=i,this.message=u}}class ny{constructor(t,r){this.providerService=t,this.changeStore=r,this._onDidChange=new l.EventEmitter,this.id="github-file-history",this.label=He("timeline.source","GitHub File History"),this.debouncer=new Uo(500),this.disposable=l.Disposable.from(this.debouncer,t.onDidChangeProviders(this.onProvidersChanged,this),t.onDidChangeRepositories(this.onRepositoriesChanged,this),t.onDidChangeRepository(this.onRepositoryChanged,this),t.onDidRefresh(this.onRefresh,this),r.onDidChange(this.onUrisChanged,this),Ce.onDidChangeAny(this.onConfigurationChanged,this),...this.registerCommands()),t.hasProviders&&this.ensureProviderRegistration()}get onDidChange(){return this._onDidChange.event}dispose(){var t;(t=this.providerDisposable)==null||t.dispose(),this.disposable.dispose()}onConfigurationChanged(t){(t.affectsConfiguration("git.timeline.date")||t.affectsConfiguration("git.timeline.showAuthor"))&&this.fireChanged()}onProvidersChanged(t){this.ensureProviderRegistration(),this.fireChanged()}onRefresh(t){if(this.rootUri===void 0)return;const r=Y(this.rootUri);!t.some(n=>Y(n)===r)||this.fireChanged()}onRepositoriesChanged(t){if(this.rootUri===void 0)return;const r=Y(this.rootUri);(t.added.some(n=>Y(n.uri)===r)||t.removed.some(n=>Y(n.uri)===r))&&this.fireChanged()}onRepositoryChanged(t){this.rootUri===void 0||Y(this.rootUri)!==Y(t.repository.uri)||this.fireChanged()}onUrisChanged(t){if(this.rootUri===void 0)return;const r=Y(this.rootUri);t.some(n=>Y(n.rootUri)===r)&&this.fireChanged()}async provideTimeline(t,r,n){var i;try{this.rootUri=this.providerService.getVirtualRootUri(t);for(const g of this.providerService.repositories)if(g.uri.path===this.rootUri.path){this.rootUri=g.uri;break}const o=this.providerService.getRelativeFilePath(this.rootUri,t),a=await this.providerService.getMetadata(this.rootUri);if(!a||n.isCancellationRequested)return{items:[]};const s=await this.providerService.getCommits(this.rootUri,{ref:a.HEAD.sha,path:o||void 0,cursor:r.cursor,limit:typeof r.limit=="number"?r.limit:void 0});if(s===void 0||s.commits.length===0||n.isCancellationRequested)return{items:[]};const u=((i=s.paging)==null?void 0:i.more)?{cursor:s.paging.cursor}:void 0,c=new Intl.DateTimeFormat(l.env.language,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}),d=Ce.getAny("git.timeline.date",void 0,"committed"),f=Ce.getAny("git.timeline.showAuthor",void 0,!0),h=s.commits.map(g=>new qt(this.rootUri,a.provider.id,g,this.resolveDiffCommand(g,a,t,o),{dateType:d,showAuthor:f,dateFormatter:c})),p=r.cursor===void 0?await this.changeStore.getChange(t):void 0;if(p){const g=Boolean(p.staged&&Ce.get("staging.enabled")),w=new rn(this.rootUri,a.provider.id,p,[s.commits[0].hash],await this.changeStore.resolveDiffCommand(p.uri,this.providerService.getProviderUri(p.uri),g?He("diff title index","{0} (Index)",it(p.uri)):He("diff title working","{0} (Working Tree)",it(p.uri))),{dateFormatter:c,staged:g});h.splice(0,0,w)}return{items:h,paging:u}}catch(o){return q.error(o),{items:[]}}}ensureProviderRegistration(){this.providerDisposable===void 0&&(this.providerDisposable=l.workspace.registerTimelineProvider([Fe.scheme,...this.providerService.registeredProviders.map(t=>t.id)],this))}fireChanged(){this.debouncer.debounce(()=>this._onDidChange.fire(void 0))}registerCommands(){let t;return[l.commands.registerCommand("remoteHub.timeline.copyCommitId",(r,n,i)=>{!qt.is(r)||l.env.clipboard.writeText(r.hash)}),l.commands.registerCommand("remoteHub.timeline.copyCommitMessage",(r,n,i)=>{!qt.is(r)||l.env.clipboard.writeText(r.message)}),l.commands.registerCommand("remoteHub.timeline.openDiff",async(r,n,i)=>{var o;!qt.is(r)&&!rn.is(r)||r.command!==void 0&&await l.commands.executeCommand(r.command.command,...(o=r.command.arguments)!=null?o:[])}),l.commands.registerCommand("remoteHub.timeline.openOnGitHub",async(r,n,i)=>{if(!qt.is(r))return;const o=await this.providerService.getMetadata(r.rootUri);await Lo("remoteHub.openOnRemote",{provider:o.provider,repo:o.repo,sha:r.hash})}),l.commands.registerCommand("remoteHub.timeline.selectForCompare",async(r,n,i)=>{!n||!qt.is(r)&&!rn.is(r)||(t={uri:n,left:r},await l.commands.executeCommand("setContext","remoteHub.timeline.selectedForCompare",!0))}),l.commands.registerCommand("remoteHub.timeline.compareWithSelected",async(r,n,i)=>{if(!n||!t||!qt.is(r)&&!rn.is(r)||Y(n)!==Y(t.uri))return;const{left:o}=t,a=this.providerService.getRelativeFilePath(r.rootUri,n),s=await this.providerService.getMetadata(r.rootUri),u=it(n),c=o.parents[0];let d;c===void 0?d=He("timeline diff title ref","{0} ({1})",u,Je(r.hash)):o.hash===""?d=He("timeline diff title working","{0} (Working Tree)",u):o.hash==="~"?d=He("timeline diff title index","{0} (Index)",u):d=He("timeline diff title ref","{0} ({1})",u,Je(o.hash));let f=o.hash===""||o.hash==="~"?n:this.providerService.createProviderUri(n,{repo:s.repo,ref:{type:Ee.Commit,id:c!=null?c:"0000000000000000000000000000000000000000"}},a);c===void 0&&(f=f.with({query:"~"}));const h=r.parents[0];let p;h===void 0?p=He("timeline diff title ref","{0} ({1})",u,Je(r.hash)):h==="~"&&r.hash===""?p=He("timeline diff title working","{0} (Working Tree)",u):r.hash==="~"?p=He("timeline diff title index","{0} (Index)",u):p=He("timeline diff title ref","{0} ({1})",u,Je(r.hash));const g=He("timeline diff title","{0} \u27F7 {1}",d,p),w=r.hash===""||r.hash==="~"?n:this.providerService.createProviderUri(n,{repo:s.repo,ref:{type:Ee.Commit,id:r.hash}},a);await l.commands.executeCommand("vscode.diff",f,w,g)})]}resolveDiffCommand(t,r,n,i,o){const a=it(n),s=t.parents[0];let u;s===void 0?u=He("timeline diff title ref","{0} ({1})",a,Je(t.hash)):t.hash===""?u=He("timeline diff title working","{0} (Working Tree)",a):t.hash==="~"?u=He("timeline diff title index","{0} (Index)",a):u=He("timeline diff title refs","{0} ({1}) \u27F7  {0} ({2})",a,Je(s),Je(t.hash));let c=this.providerService.createProviderUri(n,{repo:r.repo,ref:{type:Ee.Commit,id:s!=null?s:"0000000000000000000000000000000000000000"}},i);s===void 0&&(c=c.with({query:"~"}));const d=t.hash===""||t.hash==="~"?n:this.providerService.createProviderUri(n,{repo:r.repo,ref:{type:Ee.Commit,id:t.hash}},i);return{command:"vscode.diff",title:"Open Comparison",arguments:[c,d,u,o]}}}class iy{constructor(t,r){this.providerService=t,this.telemetryService=r,this.disposable=l.window.registerUriHandler(this)}dispose(){this.disposable.dispose()}async handleUri(t){switch(q.log(`RemoteUriHandler.handleUri: uri=${t.toString(!0)}`),t.path){case"/open":{this.telemetryService.sendEvent("handleUri.open");let r;for(const i of t.query.split("&")){const[o,a]=i.split("=");if(o==="url"){r=decodeURIComponent(a);break}}if(!r){q.warn(`RemoteUriHandler.handleUri: Unable to find url to open in uri=${t.toString(!0)}`),this.telemetryService.sendEvent("handleUri.open.abort",{reason:"aborted url not found"});return}r=r.trim(),q.warn(`RemoteUriHandler.handleUri: Opening url ${r}`);const n=await this.providerService.createWorkspaceForRemoteUrl(r,void 0,Le.NewWindow);if(!n){this.telemetryService.sendEvent("handleUri.open.abort",{reason:"aborted invalid url"});return}vt(n);break}}}}const fe=(0,P.loadMessageBundle)(),La=60,Ba=La*60,Qn=Ba*24,Iu=Qn*7,Fu=Qn*30,$u=Qn*365;function Yi(e,t){typeof e!="number"&&(e=e.getTime());const r=Math.round((new Date().getTime()-e)/1e3);if(r<-30)return fe("date.fromNow.in","in {0}",Yi(new Date().getTime()+r*1e3,{ago:!1,short:t==null?void 0:t.short}));if(r<30)return(t==null?void 0:t.ago)?(t==null?void 0:t.short)?fe("date.fromNow.seconds.short.ago","secs ago"):fe("date.fromNow.seconds.ago","A few seconds ago"):(t==null?void 0:t.short)?fe("date.fromNow.now.short","now"):fe("date.fromNow.now","Just now");let n;return r<La?(n=r,(t==null?void 0:t.ago)?n===1?(t==null?void 0:t.short)?fe("date.fromNow.seconds.singular.short.ago","{0} sec ago",n):fe("date.fromNow.seconds.singular.ago","{0} second ago",n):(t==null?void 0:t.short)?fe("date.fromNow.seconds.plural.short.ago","{0} secs ago",n):fe("date.fromNow.seconds.plural.ago","{0} seconds ago",n):n===1?(t==null?void 0:t.short)?fe("date.fromNow.seconds.singular.short","{0} sec",n):fe("date.fromNow.seconds.singular","{0} second",n):(t==null?void 0:t.short)?fe("date.fromNow.seconds.plural.short","{0} secs",n):fe("date.fromNow.seconds.plural","{0} seconds",n)):r<Ba?(n=Math.floor(r/La),(t==null?void 0:t.ago)?n===1?(t==null?void 0:t.short)?fe("date.fromNow.minutes.singular.short.ago","{0} min ago",n):fe("date.fromNow.minutes.singular.ago","{0} minute ago",n):(t==null?void 0:t.short)?fe("date.fromNow.minutes.plural.short.ago","{0} mins ago",n):fe("date.fromNow.minutes.plural.ago","{0} minutes ago",n):n===1?(t==null?void 0:t.short)?fe("date.fromNow.minutes.singular.short","{0} min",n):fe("date.fromNow.minutes.singular","{0} minute",n):(t==null?void 0:t.short)?fe("date.fromNow.minutes.plural.short","{0} mins",n):fe("date.fromNow.minutes.plural","{0} minutes",n)):r<Qn?(n=Math.floor(r/Ba),(t==null?void 0:t.ago)?n===1?(t==null?void 0:t.short)?fe("date.fromNow.hours.singular.short.ago","{0} hr ago",n):fe("date.fromNow.hours.singular.ago","{0} hour ago",n):(t==null?void 0:t.short)?fe("date.fromNow.hours.plural.short.ago","{0} hrs ago",n):fe("date.fromNow.hours.plural.ago","{0} hours ago",n):n===1?(t==null?void 0:t.short)?fe("date.fromNow.hours.singular.short","{0} hr",n):fe("date.fromNow.hours.singular","{0} hour",n):(t==null?void 0:t.short)?fe("date.fromNow.hours.plural.short","{0} hrs",n):fe("date.fromNow.hours.plural","{0} hours",n)):r<Iu?(n=Math.floor(r/Qn),(t==null?void 0:t.ago)?n===1?fe("date.fromNow.days.singular.ago","{0} day ago",n):fe("date.fromNow.days.plural.ago","{0} days ago",n):n===1?fe("date.fromNow.days.singular","{0} day",n):fe("date.fromNow.days.plural","{0} days",n)):r<Fu?(n=Math.floor(r/Iu),(t==null?void 0:t.ago)?n===1?(t==null?void 0:t.short)?fe("date.fromNow.weeks.singular.short.ago","{0} wk ago",n):fe("date.fromNow.weeks.singular.ago","{0} week ago",n):(t==null?void 0:t.short)?fe("date.fromNow.weeks.plural.short.ago","{0} wks ago",n):fe("date.fromNow.weeks.plural.ago","{0} weeks ago",n):n===1?(t==null?void 0:t.short)?fe("date.fromNow.weeks.singular.short","{0} wk",n):fe("date.fromNow.weeks.singular","{0} week",n):(t==null?void 0:t.short)?fe("date.fromNow.weeks.plural.short","{0} wks",n):fe("date.fromNow.weeks.plural","{0} weeks",n)):r<$u?(n=Math.floor(r/Fu),(t==null?void 0:t.ago)?n===1?(t==null?void 0:t.short)?fe("date.fromNow.months.singular.short.ago","{0} mo ago",n):fe("date.fromNow.months.singular.ago","{0} month ago",n):(t==null?void 0:t.short)?fe("date.fromNow.months.plural.short.ago","{0} mos ago",n):fe("date.fromNow.months.plural.ago","{0} months ago",n):n===1?(t==null?void 0:t.short)?fe("date.fromNow.months.singular.short","{0} mo",n):fe("date.fromNow.months.singular","{0} month",n):(t==null?void 0:t.short)?fe("date.fromNow.months.plural.short","{0} mos",n):fe("date.fromNow.months.plural","{0} months",n)):(n=Math.floor(r/$u),(t==null?void 0:t.ago)?n===1?(t==null?void 0:t.short)?fe("date.fromNow.years.singular.short.ago","{0} yr ago",n):fe("date.fromNow.years.singular.ago","{0} year ago",n):(t==null?void 0:t.short)?fe("date.fromNow.years.plural.short.ago","{0} yrs ago",n):fe("date.fromNow.years.plural.ago","{0} years ago",n):n===1?(t==null?void 0:t.short)?fe("date.fromNow.years.singular.short","{0} yr",n):fe("date.fromNow.years.singular","{0} year",n):(t==null?void 0:t.short)?fe("date.fromNow.years.plural.short","{0} yrs",n):fe("date.fromNow.years.plural","{0} years",n))}const _t=(0,P.loadMessageBundle)(),eo=class{constructor(e,t,r,n){this.providerService=e,this.storageService=t,this.changeStore=r,this.workspaceId=n,this._onDidChange=new l.EventEmitter,this.cache=new Map,this.lock=new bi("WorkspaceRepositories"),this.disposable=l.Disposable.from(this.providerService.onDidChangeRepositories(this.onRepositoriesChanged,this),this.providerService.onDidChangeRepository(this.onRepositoryChanged,this),this.changeStore.onDidChange(this.onChangeStoreChanged,this))}get onDidChange(){return this._onDidChange.event}dispose(){this.disposable.dispose()}onChangeStoreChanged(e){const t=Pa(e.map(r=>r.rootUri),r=>Y(r)).map(r=>this.providerService.getRepository(r)).filter(r=>Boolean(r));this.addOrUpdate(t)}onRepositoriesChanged(e){this.addOrUpdate(e.added)}onRepositoryChanged(e){this.addOrUpdate([e.repository])}async get(e){let t=await this.lock.synchronizeRead(async()=>{let r=this.cache.get("workspaceRepositories");return r===void 0&&(r=[...(await this.getCore()).values()].sort((n,i)=>i.timestamp-n.timestamp),this.cache.set("workspaceRepositories",r)),r},"WorkspaceRepositories.get");if(e){const r=Y(e);t=t.filter(n=>Y(n.canonicalUri)===r)}return t}async getCore(){return this.fromStorage(await this.storageService.get(eo.storageKey))}async getByCanonicalUri(){let e=this.cache.get("groupedWorkspaceRepositories");return e===void 0&&(e=B0(await this.get(),t=>Y(t.canonicalUri)),this.cache.set("groupedWorkspaceRepositories",e)),e}async getRecents(e=10){return(await this.get()).slice(0,e)}async getRemoteWorkspaceSourceProvider(){const e=await this.getRecents();if(e.length!==0)return{name:"Recents",label:"Open Recent Repository",icon:"$(history)",placeholder:_t("pick","Choose a recent repository"),provideSources:function(t,r){return e.map(n=>({name:n.name,icon:"$(repo)",description:Yi(n.timestamp,{ago:!0}),detail:`${n.provider.name}${n.pullRequest?`\xA0\xA0\u2022\xA0\xA0$(git-pull-request) Pull Request #${n.pullRequest.id}`:""}${Fe.isCanonicalUri(n.uri)?"":`\xA0\xA0\u2022\xA0\xA0${$a(n.ref.type)} ${n.ref.name}`}\xA0\xA0\u2022\xA0\xA0${Ou(n.changes)}`,workspace:{uri:n.uri,name:n.name,location:Le.CurrentWindow}}))}}}refresh(){this.cache.clear()}async addOrUpdate(e){await this.lock.synchronizeWrite(async()=>{this.cache.clear();const t=await this.getCore();for(const r of e){const{HEAD:n,pullRequest:i}=await r.getMetadata(),o=await this.changeStore.getChanges(r.uri);t.set(`${this.workspaceId}/${Y(r.uri)}`,{workspaceId:this.workspaceId,uri:r.uri,canonicalUri:r.canonicalUri,name:r.name,provider:r.provider,ref:{type:n.type,name:n.name},pullRequest:i?{id:i.id}:void 0,changes:oy(o),timestamp:Date.now()})}try{await this.storageService.store(eo.storageKey,this.toStorage(t))}catch(r){throw q.error(r,"Failed to save workspace repositories"),r}},"WorkspaceRepositories.addOrUpdate"),this._onDidChange.fire()}fromStorage(e){if(!e)return new Map;try{const t=JSON.parse(e,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&n!==null?l.Uri.from(n):n);return new Map(t.workspaceRepositories)}catch(t){return q.error(t,"Failed to deserialize workspace repositories"),new Map}}toStorage(e){const t={schemaVersion:eo.storageSchemaVersion,workspaceRepositories:[...e]};return JSON.stringify(t)}};let Ha=eo;Ha.storageKey="workspaceRepositories",Ha.storageSchemaVersion=1;function oy(e){let t=0,r=0,n=0;for(const i of e)switch(i.type){case xe.Created:t++;break;case xe.Changed:r++;break;case xe.Deleted:n++;break}return t||r||n?{added:t,changed:r,deleted:n,timestamp:Date.now()}:void 0}function Ou(e,{compact:t=!0,preamble:r,separator:n=", ",short:i=!1,single:o=!1}={}){if(e===void 0)return _t("no changes","No changes");const{added:a,changed:s,deleted:u}=e;if(a===0&&s===0&&u===0)return _t("no changes","No changes");if(o){const d=a+s+u;return d===1?_t("summary change","{0} change",d):_t("changes changes","{0} changes",d)}let c=`${r!=null?r:""}`;return(a||!t)&&(c+=i?`+${a}`:a===1?_t("file added","{0} file added",a):_t("files added","{0} files added",a),(s||u||!t)&&(c+=n)),(s||!t)&&(c+=i?`~${s}`:s===1?_t("file changed","{0} file changed",s):_t("files changed","{0} files changed",s),(u||!t)&&(c+=n)),(u||!t)&&(c+=i?`-${u}`:u===1?_t("file deleted","{0} file deleted",u):_t("files deleted","{0} files deleted",u)),c}var ay=Object.defineProperty,sy=Object.getOwnPropertyDescriptor,cy=(e,t,r,n)=>{for(var i=n>1?void 0:n?sy(t,r):t,o=e.length-1,a;o>=0;o--)(a=e[o])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&ay(t,r,i),i},nn;(function(e){e.Change="remoteHub:viewItem:change",e.WorkspaceRepository="remoteHub:viewItem:workspaceRepository",e.WorkspaceRepositories="remoteHub:viewItem:workspaceRepositories",e.Message="remoteHub:viewItem:message"})(nn||(nn={}));const Uu=class{constructor(e,t){this.view=e,this.parent=t,this.splatted=!1}static is(e){return e instanceof Uu}get id(){}toString(){return`${q.toLoggableName(this)}${this.id!==void 0?`(${this.id})`:""}`}getParent(){var e,t;return((e=this.parent)==null?void 0:e.splatted)?(t=this.parent)==null?void 0:t.getParent():this.parent}triggerChange(e=!1,t=!1,r){return this.splatted&&this.parent!==void 0&&this.parent!==r?this.parent.triggerChange(e,t):this.view.refreshNode(this,e,t)}};let on=Uu;cy([xt((e=!1,t=!1,r)=>JSON.stringify([e,t,r==null?void 0:r.toString()]))],on.prototype,"triggerChange",1);class ly{constructor(t,r,n,i){this.id=t,this.name=r,this.providerService=n,this.telemetryService=i,this._onDidChangeTreeData=new l.EventEmitter,this.disposables=[];const o=!1;if(q.isDebugging&&o){const a=this.getTreeItem;this.getTreeItem=async function(s){var u;const c=await a.apply(this,[s]),d=s.getParent();return c.tooltip===void 0&&(c.tooltip=new l.MarkdownString(c.label!==void 0&&typeof c.label!="string"?c.label.label:(u=c.label)!=null?u:"")),typeof c.tooltip=="string"?c.tooltip=`${c.tooltip}

---
context: ${c.contextValue}
node: ${s.toString()}${d!==void 0?`
parent: ${d.toString()}`:""}`:c.tooltip.appendMarkdown(`

---

context: \`${c.contextValue}\`\\
node: \`${s.toString()}\`${d!==void 0?`\\
parent: \`${d.toString()}\``:""}`),c}}this.disposables.push(...this.registerCommands()),this.initialize({showCollapseAll:this.showCollapseAll}),setTimeout(()=>this.onConfigurationChanged(),0)}get onDidChangeTreeData(){return this._onDidChangeTreeData.event}get showCollapseAll(){return!0}filterConfigurationChanged(t){return!!Ce.changed(t,`views.${this.configKey}`)}dispose(){l.Disposable.from(...this.disposables).dispose()}get title(){return this._title}set title(t){this._title=t,this.tree!==void 0&&(this.tree.title=t)}get description(){return this._description}set description(t){this._description=t,this.tree!==void 0&&(this.tree.description=t)}get message(){return this._message}set message(t){this._message=t,this.tree!==void 0&&(this.tree.message=t)}getQualifiedCommand(t){return`${this.id}.${t}`}onConfigurationChanged(t){t!==void 0&&this.root!==void 0&&this.refresh(!0)}initialize(t={}){this.tree=l.window.createTreeView(this.id,{...t,treeDataProvider:this}),this.disposables.push(Ce.onDidChange(r=>{!this.filterConfigurationChanged(r)||(this._config=void 0,this.onConfigurationChanged(r))},this),this.tree),this._title=this.tree.title}ensureRoot(t=!1){return(this.root===void 0||t)&&(this.telemetryService.sendEvent("view.open",{view:this.id}),this.root=this.getRoot()),this.root}getChildren(t){return t!==void 0?t.getChildren():this.ensureRoot().getChildren()}getParent(t){return t.getParent()}getTreeItem(t){return t.getTreeItem()}get selection(){return this.tree===void 0||this.root===void 0?[]:this.tree.selection}get visible(){return this.tree!==void 0?this.tree.visible:!1}async refresh(t=!1){var r,n;await((n=(r=this.root)==null?void 0:r.refresh)==null?void 0:n.call(r,t)),this.triggerNodeChange()}async refreshNode(t,r=!1,n=!1){var i;const o=await((i=t.refresh)==null?void 0:i.call(t,r));!n&&o===!0||this.triggerNodeChange(t)}async reveal(t,r){if(this.tree!==void 0)try{await this.tree.reveal(t,r)}catch(n){q.error(n)}}async show(){try{await l.commands.executeCommand(`${this.id}.focus`)}catch(t){q.error(t)}}triggerNodeChange(t){this._onDidChangeTreeData.fire(t!==void 0&&t!==this.root?t:void 0)}get config(){return this._config===void 0&&(this._config=Ce.get("views")[this.configKey]),this._config}}class uy extends on{constructor(t,r,n,i,o,a,s){super(t,r);this._message=n,this._description=i,this._tooltip=o,this._iconPath=a,this._contextValue=s}getChildren(){return[]}getTreeItem(){var t;const r=new l.TreeItem(this._message,l.TreeItemCollapsibleState.None);return r.contextValue=(t=this._contextValue)!=null?t:nn.Message,r.description=this._description,r.tooltip=this._tooltip,r.iconPath=this._iconPath,r}}var dy=Object.defineProperty,hy=Object.getOwnPropertyDescriptor,Wa=(e,t,r,n)=>{for(var i=n>1?void 0:n?hy(t,r):t,o=e.length-1,a;o>=0;o--)(a=e[o])&&(i=(n?a(t,r,i):a(i))||i);return n&&i&&dy(t,r,i),i};const tt=(0,P.loadMessageBundle)(),Nu=class extends on{constructor(e,t,r,n,i,o,a){super(e,t);this.changeStore=r,this.canonical=n,this.workspaceRepository=i,this.operation=o,this.canApplyChanges=a}static getId(e,t,r){return`${Xn.getId(e,t)}:${this.key}(${r.uri.toString()})`}get id(){return Nu.getId(this.canonical.uri,this.workspaceRepository,this.operation)}getChildren(){return[]}async getTreeItem(){const e=this.view.providerService.getRelativeFilePath(this.workspaceRepository.uri,this.operation.uri),t=new l.TreeItem(e,l.TreeItemCollapsibleState.None);return t.id=this.id,t.contextValue=`${nn.Change}${this.canApplyChanges?"+apply":""}`,t.resourceUri=this.view.changeStore.getScopedUri(this.operation.uri,this.workspaceRepository),t.command=await this.getDiffCommand(e,!0),t}async getDiffCommand(e,t=!1){if(t||this._command===void 0){const r=Boolean(this.operation.staged&&Ce.get("staging.enabled"));if(this.workspaceRepository.workspaceId===this.view.workspaceId){const n=this.view.providerService.getProviderUri(this.operation.uri);this._command=await this.changeStore.resolveDiffCommand(this.operation.uri,n,r?tt("diff title index","{0} (Index)",it(this.operation.uri),this.workspaceRepository.ref.name):tt("diff title working","{0} (Working Tree)",it(this.operation.uri),this.workspaceRepository.ref.name))}else{const n=await this.view.providerService.getMetadata(this.workspaceRepository.uri),i=this.view.providerService.createProviderUri(this.operation.uri,{repo:n.repo,ref:{type:Ee.Commit,id:this.operation.revision}},e);this._command=await this.changeStore.resolveDiffCommand(this.operation.uri,i,r?tt("diff title changeset index","{0} (Index of {1})",it(this.operation.uri),this.workspaceRepository.ref.name):tt("diff title changeset working","{0} (Working Tree of {1})",it(this.operation.uri),this.workspaceRepository.ref.name))}}return this._command}async openChanges(){var e;const t=await this.getDiffCommand(this.view.providerService.getRelativeFilePath(this.workspaceRepository.uri,this.operation.uri));await l.commands.executeCommand(t.command,...(e=t.arguments)!=null?e:[])}async openFile(){const e=this.view.changeStore.getScopedUri(this.operation.uri,this.workspaceRepository.workspaceId);await l.window.showTextDocument(e)}async applyChanges(){const e=await this.view.getRepositoryToApplyChangesetTo(this.workspaceRepository);if(e!==void 0)try{await this.view.changeStore.applyChangeset(e.uri,this.workspaceRepository,this.operation)}catch(t){l.window.showErrorMessage(t.toString())}}};let Mu=Nu;Mu.key=":changes";const Lu=class extends on{constructor(e,t,r,n,i){super(e,t);this.canonical=r,this.workspaceRepository=n,this.root=i}static getId(e,t){return`${to.getId(e)}:${this.key}(${t.workspaceId}/${t.uri.toString()})`}get id(){return Lu.getId(this.canonical.uri,this.workspaceRepository)}get name(){return this.workspaceRepository.name}get uri(){return this.workspaceRepository.uri}canApplyChanges(){if(!this.canonical.hasActive||l.workspace.getWorkspaceFolder(this.workspaceRepository.uri)!==void 0)return!1;const{changes:t}=this.workspaceRepository;return t!==void 0&&(t.added!==0||t.changed!==0||t.deleted!==0)}async getChildren(){if(this._children===void 0){const e=this.view.changeStore.getScopedChangeStore(this.workspaceRepository),t=await e.getChanges(this.workspaceRepository.uri);this._children=t.map(r=>new Mu(this.view,this,e,this.canonical,this.workspaceRepository,r,this.canApplyChanges()))}return this._children}getTreeItem(){const e=this.workspaceRepository.workspaceId===this.view.workspaceId,{changes:t}=this.workspaceRepository,r=t!==void 0&&(t.added!==0||t.changed!==0||t.deleted!==0),n=Fe.isCanonicalUri(this.workspaceRepository.uri)?tt("repositories view repository default ref","{0} (default)",this.workspaceRepository.ref.name):this.workspaceRepository.ref.name,i=new l.TreeItem(this.root?this.canonical.name:n,this.workspaceRepository.changes?l.TreeItemCollapsibleState.Collapsed:l.TreeItemCollapsibleState.None);return i.id=this.id,i.contextValue=`${nn.WorkspaceRepository}${this.canApplyChanges()?"+apply":""}`,i.description=`${this.root?`${this.workspaceRepository.ref.name}\xA0\xA0\u2022\xA0\xA0`:""}${Yi(this.workspaceRepository.timestamp,{ago:!0})}`,i.iconPath=e?new l.ThemeIcon("check"):this.root?Wu(this.canonical.provider.id):Y0(this.workspaceRepository.ref.type),i.tooltip=new l.MarkdownString(void 0,!0).appendMarkdown(tt("repositories view repository tooltip",`{0}\\
{1} {2} {3}{4}\\
Last accessed {5}

{6}
`,this.canonical.name,py(this.workspaceRepository.ref.type),$a(this.workspaceRepository.ref.type),n,e?` \u2014 _${tt("repositories view repository tooltip active","Active")}_ `:"",Yi(this.workspaceRepository.timestamp,{ago:!0}),Ou(this.workspaceRepository.changes,{preamble:`${tt("repositories view has changes","Has Uncommitted Changes")}\\
`}))),r&&(i.resourceUri=l.Uri.parse("remotehub-view://wsrepo/changes")),i}refresh(e=!1){e&&(this._children=void 0)}async applyAllChanges(){const e=await this.view.getRepositoryToApplyChangesetTo(this.workspaceRepository);if(e!==void 0)try{await this.view.changeStore.applyChangeset(e.uri,this.workspaceRepository)}catch(t){l.window.showErrorMessage(t.toString())}}};let Xn=Lu;Xn.key=":wsrepo",Wa([xt()],Xn.prototype,"refresh",1);const Bu=class extends on{constructor(e,t,r,n){super(e,t);this.canonical=r,this.workspaceRepositories=n}static getId(e){return`remoteHub${this.key}(${e.toString()})`}get id(){return Bu.getId(this.canonical.uri)}get name(){return this.canonical.name}get uri(){return this.canonical.uri}getChildren(){if(this.children===void 0){const e=this.workspaceRepositories;if(e.length===0)return this.view.message=void 0,[new uy(this.view,this,tt("repositories view message empty","No remote repositories could be found."))];this.view.message=void 0,this.children=e.map(t=>new Xn(this.view,this,this.canonical,t,!1))}return this.children}getTreeItem(){const e=this.workspaceRepositories.some(r=>r.workspaceId===this.view.workspaceId),t=new l.TreeItem(this.canonical.name,e?l.TreeItemCollapsibleState.Expanded:l.TreeItemCollapsibleState.Collapsed);return t.contextValue=nn.WorkspaceRepositories,t.iconPath=Wu(this.canonical.provider.id),t}refresh(e=!1){e&&(this.children=void 0)}};let to=Bu;to.key=":wsrepos",Wa([xt()],to.prototype,"refresh",1);class Hu extends on{constructor(t){super(t);this.splatted=!0}async getChildren(){if(this.children===void 0){const t=await this.view.workspaceRepositories.getByCanonicalUri();if(t.size===0)return this.view.message=tt("repositories view message empty","No remote repositories could be found."),[];this.view.message=void 0;const r=[];for(const[n,i]of t){const o=l.Uri.parse(n),a=await this.view.providerService.getMetadata(o),s={uri:o,name:a.name,provider:a.provider,hasActive:i.some(u=>u.workspaceId===this.view.workspaceId)};i.length===1?r.push(new Xn(this.view,this,s,i[0],!0)):r.push(new to(this.view,this,s,i))}this.children=r}return this.children}getTreeItem(){return new l.TreeItem("Repositories",l.TreeItemCollapsibleState.Expanded)}refresh(t=!1){t&&(this.children=void 0)}}Wa([xt()],Hu.prototype,"refresh",1);class fy extends ly{constructor(t,r,n,i,o){super("remoteHub.views.workspaceRepositories",tt("remote view title","Remote Repositories"),t,o);this.workspaceRepositories=r,this.changeStore=n,this.workspaceId=i,this.configKey="workspaceRepositories",this.disposables.push(this.workspaceRepositories.onDidChange(this.onRepositoriesChanged,this),l.window.registerFileDecorationProvider({provideFileDecoration:(a,s)=>{if(!(a.scheme!=="remotehub-view"||a.authority!=="wsrepo"||!a.path.includes("/changes")))return{badge:"\u25CF",color:new l.ThemeColor("remoteHub.decorations.workspaceRepositoriesView.hasUncommittedChangesForegroundColor"),tooltip:tt("repositories view decoration has changes","Has Uncommitted Changes")}}}))}getRoot(){return new Hu(this)}onRepositoriesChanged(){this.refresh(!0)}registerCommands(){return[l.commands.registerCommand(this.getQualifiedCommand("refresh"),()=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.refresh"),this.workspaceRepositories.refresh(),void this.refresh(!0)),this),l.commands.registerCommand(this.getQualifiedCommand("open"),t=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.open"),vt({name:t.name,uri:t.uri,location:Le.CurrentWindow})),this),l.commands.registerCommand(this.getQualifiedCommand("openInNewWindow"),t=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.openInNewWindow"),vt({name:t.name,uri:t.uri,location:Le.NewWindow})),this),l.commands.registerCommand(this.getQualifiedCommand("applyAllChanges"),t=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.applyAllChanges"),t.applyAllChanges()),this),l.commands.registerCommand(this.getQualifiedCommand("openChanges"),t=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.openChanges"),t.openChanges()),this),l.commands.registerCommand(this.getQualifiedCommand("openFile"),t=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.openFile"),t.openFile()),this),l.commands.registerCommand(this.getQualifiedCommand("applyChanges"),t=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.applyChanges"),t.applyChanges()),this)]}async getRepositoryToApplyChangesetTo(t){const r=Y(this.providerService.getVirtualCanonicalRootUri(t.uri)),n=this.providerService.repositories.filter(o=>Y(o.canonicalUri)===r);return await gy(n,tt("apply changeset pick repository placeholder","Choose a repository to apply the changeset to"))}}function py(e){switch(e){case Be.Branch:return tt("type branch","Branch");case Be.Tag:return tt("type tag","Tag");case Be.Commit:return tt("type commit","Commit")}}function Wu(e){switch(e){case"github":return new l.ThemeIcon("github");default:return}}async function gy(e,t){if(e.length!==0){if(e.length>1){const r=await l.window.showQuickPick(e.map(n=>({label:n.name,description:n.provider.name,repository:n})),{placeHolder:t});return r?r.repository:void 0}return e[0]}}const ro=(0,P.loadMessageBundle)();let no;function zu(){return no}async function my(e){var t;q.configure(e,De.Warn);const r=e.extension.packageJSON.displayName,n=(t=l.extensions.getExtension("ms-vscode.remotehub"))!=null?t:l.extensions.getExtension("ms-vscode.remotehub-insiders");if(n!==void 0){const s=n.packageJSON.displayName;q.warn(`${r} was NOT activated because ${s} is also installed`),l.window.showErrorMessage(ro("deprecated version installed warning","{0} cannot be used while {1} is also installed. Please ensure that only {0} is installed.",r,s));return}if(e.extension.id==="GitHub.remotehub-insiders"){const s=l.extensions.getExtension("GitHub.remotehub");if(s!==void 0){const u=s.packageJSON.displayName;q.warn(`${r} was NOT activated because ${u} is also installed`),l.window.showErrorMessage(ro("stable version installed warning","{0} cannot be used while {1} is also installed. Please ensure that only one version is installed.",r,u));return}}const i=Fo.configure(e);Ss.configure(e),q.logLevel=Ce.get("logLevel");const o=new Or(e),a=e.extension.packageJSON.version;await e.globalState.update("version",a),await e.workspaceState.update("version",a);try{const s=new Na(e.globalState),u=s.with(i),c=new Ma(e.globalStorageUri,i),d=new Ln(u),f=new Fe(d,o),h=new vn(f,u,c,i);no=new Au(f,s,h);const p=new ty(f,h,no,o),g=new Ow(e.globalStorageUri),w=new o0(f),_=new Qw(f),D=new Ha(f,s,h,i);return e.subscriptions.push(Ce.onDidChange(C=>{!Ce.changed(C,"logLevel")||(q.logLevel=Ce.get("logLevel"))}),f.onDidChangeRepositories(async C=>{var U;for(const F of C.added)try{const{HEAD:z,defaultBranch:ue,name:Q,provider:de}=await F.getMetadata(),we=((U=z.branch)==null?void 0:U.name)!==ue.name?` (${z.name}) `:" ",he={uri:F.uri,type:"folder",label:`${Q}${we}[${de.name}]`};l.commands.executeCommand("_workbench.addToRecentlyOpened",he)}catch(z){q.error(z,"Failed to add repository to recently opened")}}),new J0(f,h),new $g,new Gi(f,h),new ny(f,h),new iy(f,o),...Fg(f,h,D,e.extension.id,o),...by(_),...vy(f,h,p,g),new fy(f,D,h,i,o),_,g,D,p,no,h,f,o),o.sendEvent("activate"),Promise.resolve(w)}catch(s){q.error(s),s instanceof Ir&&za(s.name);return}}async function za(e){const t=ro("repository not found open","Open Repository");await l.window.showErrorMessage(ro("repository not found","Unable to find repository named '{0}'. Would you like to open another repository?",e),t)===t&&l.commands.executeCommand("remoteHub.openRepository")}function vy(e,t,r,n){return[wy(e,t,r,n),...Ce.get("insiders")?[yy(e,t,r,n)]:[]]}function wy(e,t,r,n){const i=new ku(e),o=new cu(e,i,t,n),a=new su;async function s(){var c,d;const f=(c=l.extensions.getExtension("GitHub.vscode-pull-request-github"))!=null?c:l.extensions.getExtension("GitHub.vscode-pull-request-github-insiders"),h=(d=await(f==null?void 0:f.activate()))==null?void 0:d.registerGitProvider(r),p=e.repositories.filter(g=>g.provider.id==="github");for(const g of p){const w=await e.getBestExternalUri(g.uri,Ut.PullRequest);if(!!w){l.commands.executeCommand("github.api.preloadPullRequest",w);break}}return h}const u=s();return l.Disposable.from(e.register("github","GitHub",i,o,a),i,o,{dispose:async()=>{var c;return void((c=await u)==null?void 0:c.dispose())}})}function yy(e,t,r,n){const i=new Gw(e),o=new Dl(e,i,t,n),a=new su;return l.Disposable.from(e.register("azdo","AzureDevOps",i,o,a),i,o)}function by(e){return[e.register(new i0)]}})(),module.exports=oo})();
