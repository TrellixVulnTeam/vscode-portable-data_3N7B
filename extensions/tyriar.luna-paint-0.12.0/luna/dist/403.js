const a15_0xa4bb=["setRange","ctrlKey","pointerDownMove","ArrowRight","viewportService","ArrowLeft","new","shiftKey","register","492559RaRyqP","altKey","_refreshActionEnabledState","_isVisible","115527rfGlne","width","key","set","137032UbJwsh","_directionalMoveZones","metaKey","7eequjl","imageService","left","classList","87829qAsBdN","onUpdate","pointerUp","bottomright","order","zoom","type","removeChild","getPointerState","createElement","max","enabled","bottomleft","offsetX","move-handle","none","move","add","_allowNewState","setVisible","_imageService","560873QjCiGI","top","1hvAGqs","div","state","_getRange","12945KZYcEm","style","_onStateChange","commit","get","event","render","getCoordsFromEvent","_directionalMoveElements","right","min","range","selectAll","selectionService","_renderer","_cursorCurrent","topleft","keyDown","18WdInTL","Move Selection","ArrowUp","isSelectionTool","topright","round","_cursorOrigin","moveSelection","824165HKJfat","_originalSelection","setTopLeft","pointerDown","currentLayer","_sc","bottom","offsetY","_cropToSelectionAction","fire","_elementContainer","webpackChunkluna","appendChild","_enabled","includes","_container","_viewportService","createDomRenderProgram"],a15_0x1627=function(t,e){return a15_0xa4bb[t-=187]},a15_0x2121ba=a15_0x1627;(function(t,e){const s=a15_0x1627;for(;;)try{if(503111===-parseInt(s(190))*-parseInt(s(193))+-parseInt(s(220))*parseInt(s(218))+parseInt(s(224))*parseInt(s(242))+parseInt(s(277))+parseInt(s(197))+-parseInt(s(250))+parseInt(s(281)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a15_0xa4bb),(self[a15_0x2121ba(261)]=self.webpackChunkluna||[]).push([[403,504],{6173:(t,e,s)=>{"use strict";const i=a15_0x2121ba;s.d(e,{f:()=>n});var o=s(1815),h=s(5120);class n extends h.JT{constructor(t,e,s){const i=a15_0x1627;super(),this.name=t,this[i(203)]=e,this._enabled=s,this._onUpdate=this[i(276)](new o.v),this[i(198)]=this._onUpdate[i(229)]}get[i(208)](){return this[i(263)]}set[i(208)](t){const e=i;this[e(263)]!==t&&(this[e(263)]=t,this._onUpdate[e(259)]())}}},504:(t,e,s)=>{"use strict";const i=a15_0x2121ba;s.r(e),s.d(e,{MoveImageRangeRenderer:()=>n});var o=s(5120),h=s(1003);class n extends o.JT{constructor(t,e,s,i,o){const n=a15_0x1627;super(),this[n(265)]=t,this[n(223)]=e,this._allowNewState=s,this._viewportService=i,this[n(217)]=o,this[n(201)]=2,this[n(232)]=new Map,this._directionalMoveZones=new Map,this[n(280)]=!0,this[n(260)]=document[n(206)](n(221));const r=["topleft",n(246),n(209),"bottomright",n(219),"bottom","left",n(233)];for(const t of r){const e=document[n(206)]("div");e[n(196)][n(214)](n(211),t),this[n(260)][n(262)](e),this[n(232)][n(189)](t,e),this[n(191)][n(189)](t,(0,h.Pq)())}this[n(265)].appendChild(this._elementContainer),this.register({dispose:()=>{const t=n;this[t(265)][t(204)](this[t(260)])}})}[i(216)](t){const e=i;t!==this[e(280)]&&(this[e(260)][e(225)].display=t?"":e(212),this[e(280)]=t)}[i(268)](t){}[i(230)](){const t=i,e=this[t(223)]();if(!e)return;const s=this._imageService[t(254)];if(!s)return;const o=this[t(266)],h=Math.round(this[t(265)].clientWidth/2)-s[t(187)]/2*o[t(202)],n=Math[t(247)](this[t(265)].clientHeight/2)-s.height/2*o[t(202)],r=h+(o.x+e[t(195)])*o.zoom,a=n+(o.y+e[t(219)])*o[t(202)],c=h+(o.x+e[t(233)])*o[t(202)],l=n+(o.y+e[t(256)])*o[t(202)],p=Math[t(247)]((r+c)/2),g=Math[t(247)]((a+l)/2),_=10*window.devicePixelRatio,d={left:Math[t(234)](r+_,Math[t(207)](r,p-_)),top:Math[t(234)](a+_,Math.max(a,g-_)),right:Math[t(207)](c-_,Math[t(234)](c,p+_)),bottom:Math[t(207)](l-_,Math[t(234)](l,g+_))},f={left:r-_,top:a-_,right:c+_,bottom:l+_},u=this._directionalMoveZones[t(228)]("topleft");u[t(195)]=f[t(195)],u[t(233)]=d[t(195)],u[t(219)]=f[t(219)],u[t(256)]=d[t(219)];const v=this[t(232)][t(228)](t(240));v[t(225)].left=r+"px",v[t(225)][t(219)]=a+"px";const b=this[t(191)][t(228)](t(246));b[t(195)]=d[t(233)],b.right=f.right,b[t(219)]=f[t(219)],b.bottom=d[t(219)];const m=this[t(232)].get(t(246));m[t(225)].left=c+"px",m.style[t(219)]=a+"px";const M=this[t(191)][t(228)](t(209));M[t(195)]=f[t(195)],M.right=d[t(195)],M[t(219)]=d.bottom,M[t(256)]=f[t(256)];const x=this[t(232)][t(228)]("bottomleft");x[t(225)].left=r+"px",x.style[t(219)]=l+"px";const w=this[t(191)].get(t(200));w[t(195)]=d[t(233)],w[t(233)]=f[t(233)],w[t(219)]=d[t(256)],w[t(256)]=f[t(256)];const S=this[t(232)].get(t(200));S.style[t(195)]=c+"px",S[t(225)][t(219)]=l+"px";const y=this._directionalMoveZones[t(228)](t(219));y[t(195)]=d[t(195)],y.right=d[t(233)],y[t(219)]=f[t(219)],y[t(256)]=d[t(219)];const C=this[t(232)][t(228)](t(219));C[t(225)].left=p+"px",C[t(225)][t(219)]=a+"px";const k=this._directionalMoveZones[t(228)](t(256));k[t(195)]=d.left,k.right=d.right,k[t(219)]=d[t(256)],k[t(256)]=f.bottom;const I=this._directionalMoveElements[t(228)](t(256));I[t(225)][t(195)]=p+"px",I[t(225)][t(219)]=l+"px";const R=this._directionalMoveZones.get(t(195));R[t(195)]=f[t(195)],R[t(233)]=d[t(195)],R[t(219)]=d[t(219)],R[t(256)]=d[t(256)];const A=this[t(232)][t(228)]("left");A.style[t(195)]=r+"px",A[t(225)].top=g+"px";const T=this[t(191)].get(t(233));T[t(195)]=d[t(233)],T.right=f[t(233)],T[t(219)]=d[t(219)],T[t(256)]=d[t(256)];const Z=this[t(232)][t(228)]("right");Z.style[t(195)]=c+"px",Z[t(225)].top=g+"px"}[i(205)](t){const e=i;if(!this[e(223)]())return this[e(215)]?e(274):e(213);for(const[s,i]of this._directionalMoveZones)if((0,h.RB)(i,t[e(210)],t[e(257)]))return s;const s=this[e(191)].get("topleft"),o=this[e(191)].get("bottomright"),n={left:s[e(195)],top:s[e(219)],right:o.right,bottom:o[e(256)]};return(0,h.RB)(n,t[e(210)],t[e(257)])?e(213):this._allowNewState?e(274):e(213)}}},403:(t,e,s)=>{"use strict";const i=a15_0x2121ba;s.r(e),s.d(e,{default:()=>g});var o=s(1815),h=s(7896),n=s(5120),r=s(1003),a=s(6173),c=s(504);const l=[i(244),i(273),"ArrowDown",i(271)];class p extends n.JT{constructor(t){const e=i;super(),this[e(255)]=t,this.id=e(249),this[e(245)]=!0,this[e(222)]=e(213),this[e(258)]=new a.f("Crop to Selection","crop-to-selection",!1),this.actions=[this[e(258)]],this._onStateChange=this.register(new o.v),this.onStateChange=this[e(226)].event,this[e(276)](this[e(255)].selectionService[e(198)]((()=>this._refreshActionEnabledState()))),this[e(279)]()}[i(253)](t){const e=i;!this[e(255)].selectionService[e(235)]&&this[e(255)][e(194)].selectAll(),this[e(248)]=this[e(255)][e(272)][e(231)](t),this._cursorCurrent=this[e(248)].slice(),this._originalSelection=this[e(255)][e(237)][e(235)],this[e(222)]===e(274)||this[e(251)]&&((this.state===e(219)||"topleft"===this[e(222)]||this[e(222)]===e(246))&&(this._cursorOrigin[1]=this._originalSelection[e(219)]),(this.state===e(256)||this.state===e(209)||this.state===e(200))&&(this[e(248)][1]=this[e(251)].bottom-1),(this[e(222)]===e(195)||this[e(222)]===e(240)||this[e(222)]===e(209))&&(this._cursorOrigin[0]=this[e(251)][e(195)]),(this[e(222)]===e(233)||this[e(222)]===e(246)||this[e(222)]===e(200))&&(this[e(248)][0]=this[e(251)][e(233)]-1))}[i(199)](t){const e=i;this[e(255)][e(237)][e(235)]&&this[e(255)][e(237)][e(227)](e(243),e(249))}pointerMove(t,e){const s=i;if(this[s(238)]&&!e){const e=this[s(238)][s(205)](t);this[s(222)]!==e&&(this[s(222)]=e,this[s(226)][s(259)]())}}[i(270)](t){const e=i;if(!this[e(255)][e(237)][e(235)]||!this._cursorOrigin||!this[e(251)])return;this[e(239)]=this[e(255)][e(272)][e(231)](t);const s=this._cursorCurrent[0]-this[e(248)][0],o=this._cursorCurrent[1]-this._cursorOrigin[1];if(this[e(222)]===e(213))return void this[e(255)].selectionService[e(252)](this._originalSelection[e(195)]+s,this[e(251)][e(219)]+o);let h;if(!t[e(275)]||"topleft"!==this[e(222)]&&"topright"!==this[e(222)]&&this[e(222)]!==e(209)&&"bottomright"!==this[e(222)])h=(0,r.BN)(this[e(251)]),("top"===this.state||this[e(222)]===e(240)||this.state===e(246))&&(h.top+=o,h[e(256)]<=h[e(219)]&&h[e(219)]++,t[e(278)]&&(h[e(256)]-=o)),("bottom"===this[e(222)]||this[e(222)]===e(209)||this[e(222)]===e(200))&&(h.bottom+=o,h[e(256)]<=h.top&&h[e(256)]--,t.altKey&&(h[e(219)]-=o)),("left"===this[e(222)]||this[e(222)]===e(240)||this[e(222)]===e(209))&&(h[e(195)]+=s,h[e(233)]<=h.left&&h[e(195)]++,t[e(278)]&&(h.right-=s)),(this[e(222)]===e(233)||"topright"===this[e(222)]||this[e(222)]===e(200))&&(h.right+=s,h[e(233)]<=h[e(195)]&&h[e(233)]--,t[e(278)]&&(h[e(195)]-=s));else{const i=(0,r.n3)(this[e(251)]);let n;switch(h=(0,r.BN)(this._originalSelection),this.state){case e(240):n=(1/i*-s-o)/2,h[e(195)]-=Math.round(n*i),h[e(219)]-=Math[e(247)](n),t[e(278)]&&(h[e(233)]+=Math[e(247)](n*i),h[e(256)]+=Math[e(247)](n));break;case e(246):n=(s*(1/i)-o)/2,h.right+=Math[e(247)](n*i),h[e(219)]-=Math[e(247)](n),t[e(278)]&&(h.left-=Math[e(247)](n*i),h[e(256)]+=Math[e(247)](n));break;case e(209):n=(1/i*-s+o)/2,h[e(195)]-=Math[e(247)](n*i),h.bottom+=Math[e(247)](n),t[e(278)]&&(h[e(233)]+=Math[e(247)](n*i),h[e(219)]-=Math[e(247)](n));break;case e(200):n=(s*(1/i)+o)/2,h[e(233)]+=Math[e(247)](n*i),h[e(256)]+=Math[e(247)](n),t[e(278)]&&(h[e(195)]-=Math[e(247)](n*i),h.top-=Math.round(n))}}this[e(255)][e(237)][e(235)]=(0,r.FJ)(h)}[i(241)](t){const e=i;if(!this[e(255)][e(194)])return;if(!l[e(264)](t.key))return;const s=this[e(255)][e(237)][e(235)]||this[e(255)][e(194)][e(236)](),o=(h.V5?t[e(192)]:t[e(269)])?10:1;switch(t[e(188)]){case e(244):this[e(255)].selectionService.setTopLeft(s[e(195)],s[e(219)]-o);break;case"ArrowDown":this._sc[e(237)][e(252)](s.left,s[e(219)]+o);break;case e(273):this[e(255)][e(237)][e(252)](s[e(195)]-o,s[e(219)]);break;case e(271):this._sc[e(237)].setTopLeft(s[e(195)]+o,s[e(219)])}}[i(279)](){const t=i,e=this[t(255)].selectionService.range;this[t(258)].enabled=!(!e||0===e[t(195)]&&0===e[t(219)]&&e.right===this[t(255)][t(194)].width&&e[t(256)]===this[t(255)][t(194)].height)}[i(267)](t){const e=i,s=new c.MoveImageRangeRenderer(t,(()=>this._sc.selectionService.range),!1,this._sc[e(272)],this[e(255)][e(194)]);return this[e(255)][e(237)][e(198)]((()=>s[e(216)](void 0!==this._sc[e(237)][e(235)]))),s[e(216)](void 0!==this[e(255)].selectionService[e(235)]),this[e(238)]=s,this._renderer}}const g=p}}]);