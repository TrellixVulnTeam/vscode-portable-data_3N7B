const a4_0x3b21=["imageData","109451FacJYb","visibleRange","12508ucIuvv","imageSize","max","diamond","width","style",'Images "',"right","bottom","rgba(","primaryColor","left","drawShape","update","1DWLFZB","isInteger","getContext","allowOnePixelSmoothing","strokeWidth","bind","top",")->(","getImageData","subarray","clearRect","smoothing","2ONTMal","min","abs","secondaryColor","floor","15LuXRap","default","then","selection","SharedArrayBuffer","indexOf","shapeSize","198977NtcLvS","Could not attain 2d context","shapeDefinition","pow","height","round","triangle","buffer","dimensions",'" dimensions differ',"blendMode","rightTriangle",'Range "',"444576YACyAS"," must be contained within ","includes","189478PlYWkt","200218TfxTaF","type","ellipse","webpackChunkluna","strokeStyle","357612ZqNufZ","targetImage","sqrt","length","set","ceil",'" and "',"data",'" dimensions are equal','Invalid dimensions for image "'],a4_0x9098=function(t,e){return a4_0x3b21[t-=250]},a4_0x41801d=a4_0x9098;(function(t,e){const a=a4_0x9098;for(;;)try{if(282533===-parseInt(a(304))*-parseInt(a(273))-parseInt(a(251))+parseInt(a(271))*parseInt(a(287))+-parseInt(a(299))*-parseInt(a(311))+parseInt(a(254))+-parseInt(a(260))+parseInt(a(255)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a4_0x3b21),(self.webpackChunkluna=self[a4_0x41801d(258)]||[]).push([[324],{324:(t,e,a)=>{"use strict";a.r(e),a.d(e,{run:()=>s});var n=a(371),r=a(517),i=a(3),o=a(742);const s=async(t,e,s)=>{const l=a4_0x9098;let d;switch((0,o.ap)(s,l(261)),s[l(256)]){case l(276):d=new((await a.e(727)[l(306)](a[l(292)](a,727))).default);break;case l(257):d=new((await a.e(459)[l(306)](a[l(292)](a,459))).default);break;case l(317):d=new((await a.e(12)[l(306)](a[l(292)](a,12)))[l(305)]);break;case l(322):d=new((await a.e(243)[l(306)](a[l(292)](a,243)))[l(305)]);break;default:throw new Error('Unrecognized shape "'+s[l(256)]+'"')}const h=(0,i.kq)((0,i.BN)(s[l(319)]));if(s[l(307)]&&(s[l(307)][l(284)]>h.left&&(h[l(284)]=Math.min(s[l(307)][l(284)],h[l(280)])),s[l(307)][l(280)]<h[l(280)]&&(h[l(280)]=Math.max(s[l(307)][l(280)],h[l(284)])),s[l(307)][l(293)]>h.top&&(h[l(293)]=Math[l(300)](s[l(307)].top,h[l(281)])),s[l(307)].bottom<h[l(281)]&&(h.bottom=Math[l(275)](s[l(307)][l(281)],h[l(293)]))),h[l(284)]===h[l(280)]||h.top===h[l(281)])throw new Error("The line can not be drawn outside of the selection and viewport");const x={...s,job:t,progressReporter:e,imageSize:{x:s[l(261)][l(277)],y:s[l(261)][l(315)]},shapeDefinition:d,shapeSize:{x:(0,i.Oq)(s[l(319)]),y:(0,i.rY)(s.dimensions)},shapeOffset:{x:s[l(319)][l(284)]%1,y:s.dimensions.top%1},visibleRange:u(s[l(319)],h)};x[l(291)]=Math[l(300)](x[l(291)],Math[l(265)](Math[l(275)](x[l(310)].x,x[l(310)].y)/2));const g=new OffscreenCanvas(x[l(274)].x,x[l(274)].y)[l(289)]("2d");if(!g)throw new Error(l(312));g[l(259)]=l(282)+x[l(283)][0]+","+x[l(283)][1]+","+x.primaryColor[2]+","+x[l(283)][3]/255+")";const m=2===x[l(278)]?x[l(283)]:x.secondaryColor;let y,p,b,w;g.fillStyle=l(282)+m[0]+","+m[1]+","+m[2]+","+m[3]/255+")",g.lineWidth=2!==x[l(278)]?x[l(291)]:1,x[l(298)]||3!==x[l(278)]?x[l(298)]||1!==x.strokeWidth&&2!==x[l(278)]?({indexList:p,coordList:b,imageData:w,indexListCount:y}=f(x,g)):({indexList:p,coordList:b,imageData:w,indexListCount:y}=c(x,g)):({indexList:p,coordList:b,imageData:w,indexListCount:y}=function(t,e){const a=a4_0x9098,r={...t,style:2,primaryColor:t.secondaryColor},i={...t,style:1},o=f(r,e);e[a(297)](0,0,t.imageSize.x,t[a(274)].y);const s=c(i,e),u=(0,n.X$)(t[a(274)].x*t.imageSize.y,t[a(274)].x*t[a(274)].y*4,!0),l=(0,n.X$)(t[a(274)].x*t[a(274)].y*2,Math.max(t[a(274)].x,t[a(274)].y),!0);let d=0,h=0,x=0,g=0,m=!1;for(x=t[a(272)].top;x<t[a(272)][a(281)];x++)for(h=t.visibleRange[a(284)];h<t[a(272)].right;h++)g=4*(x*t[a(274)].x+h),m=!1,o.imageData[g+3]>t[a(302)][3]/2&&(o.imageData[g+3]=t[a(302)][3],m=!0),s.imageData[g+3]>t[a(283)][3]/2&&((0,n.Yr)(o[a(270)],g,s.imageData,g),m=!0),m&&(l[2*d]=h,l[2*d+1]=x,u[d++]=g);return{imageData:o.imageData,indexListCount:d,indexList:u,coordList:l}}(x,g));const M=p[l(296)](0,y);e[l(286)](.25);const _=new Uint8Array(new SharedArrayBuffer(4*p[l(263)]));let k=0;for(k=0;k<p[l(263)];k++)(0,n.Yr)(_,4*k,x[l(261)][l(267)],p[k]);if(e[l(286)](.5),"replace"===x.blendMode)for(k=0;k<M[l(263)];k++)(0,n.Yr)(x[l(261)].data,M[k],w,4*(b[2*k+1]*x.imageSize.x+b[2*k]));else for(k=0;k<M.length;k++)(0,r.B)(x[l(321)],x[l(261)][l(267)],M[k],w,4*(b[2*k+1]*x.imageSize.x+b[2*k]));e.update(.75);const S=new Uint8Array(new SharedArrayBuffer(4*p[l(263)]));for(k=0;k<p[l(263)];k++)(0,n.Yr)(S,4*k,x[l(261)].data,p[k]);return e[l(286)](1),{undoData:{indexList:M,colorData:_},redoData:{indexList:M,colorData:S},range:h}};function c(t,e){const a=a4_0x9098;if(!t[a(313)][a(290)]||t[a(291)]>1)return f(t,e);if(1===t[a(278)])return function(t,e){const a=a4_0x9098;return t[a(313)][a(285)](t,e),function(t,e){const a=a4_0x9098,r=(0,n.X$)(e[a(274)].x*e[a(274)].y,e[a(274)].x*e.imageSize.y*4,!0),i=(0,n.X$)(e[a(274)].x*e[a(274)].y*2,Math[a(275)](e.imageSize.x,e[a(274)].y),!0);let o=0;const s=e.imageSize.x,c=e[a(274)].y,f=e[a(283)];let u=0,l=0,d=0;const h=new Array(c);for(d=0;d<c;d++)for(h[d]=[],l=0;l<s;l++)u=4*(d*s+l),t[u+3]>f[3]/3?h[d][l]=t[u+3]:(t[u+3]=0,h[d][l]=0);const x=[0,0,0,0,0,0,0,0],g=[0,0];for(d=0;d<c;d++)for(l=0;l<s;l++)if(h[d][l]>0){x[0]=0===l||0===d?0:t[4*((d-1)*s+(l-1))+3],x[1]=0===d?0:t[4*((d-1)*s+l)+3],x[2]=0===d||l===s-1?0:t[4*((d-1)*s+(l+1))+3],x[3]=0===l?0:t[4*(d*s+(l-1))+3],x[4]=l===s-1?0:t[4*(d*s+(l+1))+3],x[5]=0===l||d===c-1?0:t[4*((d+1)*s+(l-1))+3],x[6]=d===c-1?0:t[4*((d+1)*s+l)+3],x[7]=d===c-1||l===s-1?0:t[4*((d+1)*s+(l+1))+3],x[0]>x[1]?(g[0]=0,g[1]=1):(g[0]=1,g[1]=0);for(let t=2;t<8;t++)x[t]>x[g[0]]?(g[1]=g[0],g[0]=t):x[t]>x[g[1]]&&(g[1]=t);switch(g[0]){case 0:h[d-1][l-1]=t[4*((d-1)*s+(l-1))+3];break;case 1:h[d-1][l]=t[4*((d-1)*s+l)+3];break;case 2:h[d-1][l+1]=t[4*((d-1)*s+(l+1))+3];break;case 3:h[d][l-1]=t[4*(d*s+(l-1))+3];break;case 4:h[d][l+1]=t[4*(d*s+(l+1))+3];break;case 5:h[d+1][l-1]=t[4*((d+1)*s+(l-1))+3];break;case 6:h[d+1][l]=t[4*((d+1)*s+l)+3];break;case 7:h[d+1][l+1]=t[4*((d+1)*s+(l+1))+3]}switch(g[1]){case 0:h[d-1][l-1]=t[4*((d-1)*s+(l-1))+3];break;case 1:h[d-1][l]=t[4*((d-1)*s+l)+3];break;case 2:h[d-1][l+1]=t[4*((d-1)*s+(l+1))+3];break;case 3:h[d][l-1]=t[4*(d*s+(l-1))+3];break;case 4:h[d][l+1]=t[4*(d*s+(l+1))+3];break;case 5:h[d+1][l-1]=t[4*((d+1)*s+(l-1))+3];break;case 6:h[d+1][l]=t[4*((d+1)*s+l)+3];break;case 7:h[d+1][l+1]=t[4*((d+1)*s+(l+1))+3]}}const m=[];let y=0;for(d=0;d<c;d++)for(l=0;l<s;l++)if(h[d][l]>0){if(y=0,l>0&&d>0&&h[d-1][l-1]>0&&(m[y++]=0),d>0&&h[d-1][l]>0&&(m[y++]=1),l<s-1&&d>0&&h[d-1][l+1]>0&&(m[y++]=2),l>0&&h[d][l-1]>0&&(m[y++]=3),l<s-1&&h[d][l+1]>0&&(m[y++]=4),l>0&&d<c-1&&h[d+1][l-1]>0&&(m[y++]=5),d<c-1&&h[d+1][l]>0&&(m[y++]=6),l<s-1&&d<c-1&&h[d+1][l+1]>0&&(m[y++]=7),y>2){for(u=y;u<m[a(263)];u++)m[u]=-1;u=m[a(309)](1),-1!==u&&h[d][l]>=h[d-1][l]&&(m[a(253)](0)&&h[d-1][l]<h[d-1][l-1]||m.includes(2)&&h[d-1][l]<h[d-1][l+1])&&(h[d-1][l]=0,t[4*((d-1)*s+l)+3]=0,m[u]=-1),u=m.indexOf(6),-1!==u&&h[d][l]>=h[d+1][l]&&(m[a(253)](5)&&h[d+1][l]<h[d+1][l-1]||m[a(253)](7)&&h[d+1][l]<h[d+1][l+1])&&(h[d+1][l]=0,t[4*((d+1)*s+l)+3]=0,m[u]=-1),u=m[a(309)](3),-1!==u&&h[d][l]>=h[d][l-1]&&(m[a(253)](0)&&h[d][l-1]<h[d-1][l-1]||m[a(253)](5)&&h[d][l-1]<h[d+1][l-1])&&(h[d][l-1]=0,t[4*(d*s+(l-1))+3]=0,m[u]=-1),u=m.indexOf(4),-1!==u&&h[d][l]>=h[d][l+1]&&(m[a(253)](2)&&h[d][l+1]<h[d-1][l+1]||m.includes(7)&&h[d][l+1]<h[d+1][l+1])&&(h[d][l+1]=0,t[4*(d*s+(l+1))+3]=0,m[u]=-1),m[a(253)](1)&&m[a(253)](3)&&m.includes(4)&&(h[d-1][l]=0,t[4*((d-1)*s+l)+3]=0),m[a(253)](3)&&m[a(253)](1)&&m[a(253)](6)&&(h[d][l-1]=0,t[4*(d*s+(l-1))+3]=0),m.includes(4)&&m[a(253)](1)&&m[a(253)](6)&&(h[d][l+1]=0,t[4*(d*s+(l+1))+3]=0),m[a(253)](6)&&m.includes(3)&&m.includes(4)&&(h[d+1][l]=0,t[4*((d+1)*s+l)+3]=0)}}else t[4*(d*s+l)+3]=0;for(y=0,d=0;d<c;d++)for(l=0;l<s;l++)if(h[d][l]>0&&(y=0,l>0&&d>0&&h[d-1][l-1]>0&&(m[y++]=0),d>0&&h[d-1][l]>0&&(m[y++]=1),l<s-1&&d>0&&h[d-1][l+1]>0&&(m[y++]=2),l>0&&h[d][l-1]>0&&(m[y++]=3),l<s-1&&h[d][l+1]>0&&(m[y++]=4),l>0&&d<c-1&&h[d+1][l-1]>0&&(m[y++]=5),d<c-1&&h[d+1][l]>0&&(m[y++]=6),l<s-1&&d<c-1&&h[d+1][l+1]>0&&(m[y++]=7),y>=2)){for(u=y;u<m[a(263)];u++)m[u]=-1;m.includes(4)&&h[d][l]<h[d][l+1]&&(m[a(253)](2)&&h[d][l]<h[d-1][l+1]||m.includes(7)&&h[d][l]<h[d+1][l+1])&&(h[d][l]=0,t[u+3]=0),m[a(253)](3)&&h[d][l]<h[d][l-1]&&(m[a(253)](0)&&h[d][l]<h[d-1][l-1]||m[a(253)](5)&&h[d][l]<h[d+1][l-1])&&(h[d][l]=0,t[u+3]=0)}for(d=e[a(272)][a(293)];d<e.visibleRange[a(281)];d++)for(l=e[a(272)].left;l<e.visibleRange[a(280)];l++)h[d][l]>0&&(u=4*(d*s+l),t[u+3]=f[3],i[2*o]=l,i[2*o+1]=d,r[o++]=u);return{imageData:t,indexListCount:o,indexList:r,coordList:i}}(e[a(295)](0,0,t[a(274)].x,t[a(274)].y)[a(267)],t)}(t,e);2===t.style&&(t[a(302)]=t[a(283)],t[a(278)]=3,t[a(291)]=1);const r={...t,style:2,primaryColor:t[a(302)]},i={...t,style:1},o=f(r,e);e.clearRect(0,0,t.imageSize.x,t[a(274)].y);const s=c(i,e),u=(0,n.X$)(t[a(274)].x*t.imageSize.y,t[a(274)].x*t.imageSize.y*4,!0),l=(0,n.X$)(t[a(274)].x*t[a(274)].y*2,Math.max(t[a(274)].x,t[a(274)].y),!0);let d=0,h=0,x=0,g=0,m=!1;for(x=t[a(272)].top;x<t[a(272)][a(281)];x++)for(h=t[a(272)][a(284)];h<t[a(272)].right;h++)g=4*(x*t[a(274)].x+h),m=!1,o.imageData[g+3]>t.secondaryColor[3]/2&&((0,n.Yr)(o[a(270)],g,t[a(302)],0),m=!0),s[a(270)][g+3]>t[a(283)][3]/2&&((0,n.Yr)(o[a(270)],g,s[a(270)],g),m=!0),m&&(l[2*d]=h,l[2*d+1]=x,u[d++]=g);return{imageData:o[a(270)],indexListCount:d,indexList:u,coordList:l}}function f(t,e){const a=a4_0x9098;t[a(313)][a(285)](t,e);const r=e.getImageData(0,0,t[a(274)].x,t[a(274)].y).data,i=(0,n.X$)(t[a(274)].x*t[a(274)].y,t[a(274)].x*t.imageSize.y*4,!0),o=(0,n.X$)(t[a(274)].x*t.imageSize.y*2,Math.max(t[a(274)].x,t[a(274)].y),!0);let s=0,c=0,f=0,u=0;if(t[a(298)])for(f=t[a(272)].top;f<t[a(272)].bottom;f++)for(c=t[a(272)][a(284)];c<t[a(272)].right;c++)u=4*(f*t[a(274)].x+c),r[u+3]>0&&(o[2*s]=c,o[2*s+1]=f,i[s++]=4*(f*t[a(274)].x+c));else for(f=t[a(272)][a(293)];f<t.visibleRange[a(281)];f++)for(c=t[a(272)][a(284)];c<t[a(272)][a(280)];c++)u=4*(f*t[a(274)].x+c),r[u+3]>t[a(283)][3]/2&&(r[u+3]=t.primaryColor[3],o[2*s]=c,o[2*s+1]=f,i[s++]=4*(f*t[a(274)].x+c));return{imageData:r,indexListCount:s,indexList:i,coordList:o}}function u(t,e){const a=a4_0x9098,n=e.left-Math[a(303)](t[a(284)]),r=n+(0,i.Oq)(e),o=e[a(293)]-Math[a(303)](t[a(293)]);return{left:n,right:r,top:o,bottom:o+(0,i.rY)(e)}}},742:(t,e,a)=>{"use strict";a.d(e,{ap:()=>r,TO:()=>i,zg:()=>o});var n=a(3);function r(t,e){const a=a4_0x9098,n=t[e];if(n[a(277)]<1||n.height<1)throw new Error(a(269)+e+'": '+n[a(277)]+" x "+n[a(315)])}function i(t,e,a){const n=a4_0x9098,r=t[e],i=t[a];if(r.width===i.width&&r[n(315)]===i[n(315)])throw new Error('Images "'+e+n(266)+a+n(268))}function o(t,e,a){const r=a4_0x9098,i=t[e];if(!(0,n.ur)(a,i))throw new Error(r(250)+e+'" '+(0,n.PW)(i)+r(252)+(0,n.PW)(a))}},371:(t,e,a)=>{"use strict";function n(t,e=2*t.length){const a=a4_0x9098;let n;if(t instanceof Float32Array)n=new Float32Array(e);else if(t instanceof Uint8Array)n=new Uint8Array(e);else if(t instanceof Uint16Array)n=new Uint16Array(e);else{if(!(t instanceof Uint32Array))throw new Error("Unrecognized array type");n=new Uint32Array(e)}return n[a(264)](t),n}function r(t,e,a=!1){const n=a4_0x9098;return e<Math[n(314)](2,8)?a?new Uint8Array(new SharedArrayBuffer(t)):new Uint8Array(t):e<Math[n(314)](2,16)?a?new Uint16Array(new SharedArrayBuffer(2*t)):new Uint16Array(t):a?new Uint32Array(new SharedArrayBuffer(4*t)):new Uint32Array(t)}function i(t,e,a,n){t[e]=a[n],t[e+1]=a[n+1],t[e+2]=a[n+2],t[e+3]=a[n+3]}a.d(e,{Rs:()=>n,X$:()=>r,Yr:()=>i})},517:(t,e,a)=>{"use strict";const n=a4_0x41801d;a.d(e,{B:()=>c});var r=a(371);const i=new Float32Array(6);let o;const s={normal:(t,e)=>e,darken:(t,e)=>Math[n(300)](t,e),multiply:(t,e)=>t*e,linearBurn:(t,e)=>Math[n(275)](t+e-1,0),lighten:(t,e)=>Math[n(275)](t,e),screen:(t,e)=>1-(1-t)*(1-e),linearDodgeAdd:(t,e)=>Math.min(t+e,1),overlay:(t,e)=>t<.5?2*t*e:1-2*(1-t)*(1-e),softLight:(t,e)=>e<.5?2*t*e+t*t*(1-2*e):Math[n(262)](t)*(2*e-1)+2*t*(1-e),difference:(t,e)=>Math[n(301)](t-e),exclusion:(t,e)=>t+e-2*t*e};function c(t,e,a,c,u,l=e,d=a){const h=n;if("replace"!==t){if(i[0]=c[u+3]/255,0===i[0])return e[a]=l[d],e[a+1]=l[d+1],e[a+2]=l[d+2],void(e[a+3]=l[d+3]);if(i[1]=l[d+3]/255,0===i[1])return e[a]=c[u],e[a+1]=c[u+1],e[a+2]=c[u+2],void(e[a+3]=c[u+3]);o=s[t],i[3]=o(l[d]/255,c[u]/255),i[4]=o(l[d+1]/255,c[u+1]/255),i[5]=o(l[d+2]/255,c[u+2]/255),i[2]=i[0]+i[1]*(1-i[0]),e[a]=Math[h(316)](f(l[d]/255,i[1],c[u]/255,i[0],i[3])/i[2]*255),e[a+1]=Math[h(316)](f(l[d+1]/255,i[1],c[u+1]/255,i[0],i[4])/i[2]*255),e[a+2]=Math[h(316)](f(l[d+2]/255,i[1],c[u+2]/255,i[0],i[5])/i[2]*255),e[a+3]=Math[h(316)](255*i[2])}else(0,r.Yr)(e,a,c,u)}function f(t,e,a,n,r){return(e-e*n)*t+(n-e*n)*a+e*n*r}},3:(t,e,a)=>{"use strict";function n(t){const e=a4_0x9098;if(t)return{left:t[e(284)],top:t.top,right:t[e(280)],bottom:t[e(281)]}}function r(t,e){return{left:t,top:e,right:t+1,bottom:e+1}}function i(t,e){return{left:0,top:0,right:t,bottom:e}}function o(t,e,a,n){const r=a4_0x9098,i=function(t){const e=a4_0x9098;if(t.left>t[e(280)]){const a=t.right;t[e(280)]=t.left,t[e(284)]=a}if(t[e(293)]>t[e(281)]){const a=t[e(281)];t[e(281)]=t[e(293)],t.top=a}if(t[e(280)]<t[e(284)]){const a=t[e(284)];t[e(284)]=t[e(280)],t.right=a}if(t[e(281)]<t[e(293)]){const a=t.top;t[e(293)]=t.bottom,t[e(281)]=a}return t}({left:t,top:e,right:a,bottom:n});return i[r(280)]++,i[r(281)]++,i}function s(t){const e=a4_0x9098;return t[e(284)]=Math[e(303)](t.left),t[e(280)]=Math[e(265)](t[e(280)]),t[e(293)]=Math[e(303)](t[e(293)]),t[e(281)]=Math.ceil(t.bottom),t}function c(t,e,a){const n=a4_0x9098;if(function(t){const e=a4_0x9098;return t[e(284)]===t[e(280)]||t[e(293)]===t[e(281)]}(t))return t[n(284)]=e,t[n(280)]=e+1,t[n(293)]=a,void(t.bottom=a+1);t[n(284)]=Math[n(300)](t[n(284)],e),t.top=Math.min(t[n(293)],a),t[n(280)]=Math[n(275)](t[n(280)],e+1),t.bottom=Math[n(275)](t[n(281)],a+1)}function f(t,e,a){const n=a4_0x9098;return e>=t[n(284)]&&e<t.right&&a>=t[n(293)]&&a<t.bottom}function u(t,e){const a=a4_0x9098;return e[a(284)]>=t[a(284)]&&e[a(280)]<=t.right&&e[a(293)]>=t[a(293)]&&e.bottom<=t.bottom}function l(t){const e=a4_0x9098;return"("+t[e(284)]+","+t[e(293)]+e(294)+t.right+","+t[e(281)]+")"}function d(t){const e=a4_0x9098;return t[e(280)]-t[e(284)]}function h(t){const e=a4_0x9098;return t[e(281)]-t[e(293)]}a.d(e,{BN:()=>n,Re:()=>r,DI:()=>i,tH:()=>o,kq:()=>s,Hv:()=>c,RB:()=>f,ur:()=>u,PW:()=>l,Oq:()=>d,rY:()=>h})}}]);