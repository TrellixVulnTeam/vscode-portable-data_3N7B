const a26_0x57d7=["right","1SJEYXG",'" dimensions are equal',"max","imageSize","clearRect",'" and "',"floor","1254899eeINfR","288lsIPqE","indexOf","rightTriangle","1835846cYODMY","length","fillStyle","812302AbjCUq","height","rgba(","getImageData","1334964ypjrKy","push","visibleRange","subarray","width","type","blendMode","5734yVxgcL","primaryColor"," x ","left","replace","selection","targetImage","imageData","strokeWidth","shapeDefinition","top","webpackChunkluna",'Images "',"strokeStyle","436771cIELge","smoothing","bottom","default","includes","2teRPAM","data","then","style","update",'Range "',"secondaryColor","drawShape","min","The line can not be drawn outside of the selection and viewport","allowOnePixelSmoothing",'" dimensions differ',"bind","814258uQQGGD","dimensions","Could not attain 2d context"],a26_0x5172=function(e,t){return a26_0x57d7[e-=488]},a26_0x57d2ee=a26_0x5172;(function(e,t){const a=a26_0x5172;for(;;)try{if(982598===-parseInt(a(528))*-parseInt(a(497))+parseInt(a(521))+-parseInt(a(510))+parseInt(a(492))+-parseInt(a(539))*-parseInt(a(522))+-parseInt(a(532))+-parseInt(a(514))*parseInt(a(525)))break;e.push(e.shift())}catch(t){e.push(e.shift())}})(a26_0x57d7),(self[a26_0x57d2ee(489)]=self.webpackChunkluna||[])[a26_0x57d2ee(533)]([[324],{5324:(e,t,a)=>{"use strict";a.r(t),a.d(t,{run:()=>s});var i=a(4371),r=a(7517),n=a(1003),o=a(7742);const s=async(e,t,s)=>{const l=a26_0x5172;let x;switch((0,o.ap)(s,l(545)),s[l(537)]){case"diamond":x=new((await a.e(727)[l(499)](a[l(509)](a,727)))[l(495)]);break;case"ellipse":x=new((await a.e(459)[l(499)](a[l(509)](a,8459)))[l(495)]);break;case"triangle":x=new((await a.e(12).then(a[l(509)](a,4012)))[l(495)]);break;case l(524):x=new((await a.e(243)[l(499)](a[l(509)](a,6243)))[l(495)]);break;default:throw new Error('Unrecognized shape "'+s[l(537)]+'"')}const h=(0,n.kq)((0,n.BN)(s[l(511)]));if(s[l(544)]&&(s[l(544)][l(542)]>h[l(542)]&&(h[l(542)]=Math[l(505)](s[l(544)][l(542)],h[l(513)])),s[l(544)][l(513)]<h.right&&(h[l(513)]=Math[l(516)](s[l(544)][l(513)],h[l(542)])),s[l(544)].top>h.top&&(h[l(488)]=Math[l(505)](s[l(544)].top,h.bottom)),s[l(544)][l(494)]<h[l(494)]&&(h.bottom=Math[l(516)](s[l(544)][l(494)],h.top))),h[l(542)]===h[l(513)]||h.top===h[l(494)])throw new Error(l(506));const g={...s,job:e,progressReporter:t,imageSize:{x:s[l(545)][l(536)],y:s[l(545)].height},shapeDefinition:x,shapeSize:{x:(0,n.Oq)(s[l(511)]),y:(0,n.rY)(s[l(511)])},shapeOffset:{x:s[l(511)].left%1,y:s[l(511)][l(488)]%1},visibleRange:d(s[l(511)],h)};g[l(547)]=Math[l(505)](g.strokeWidth,Math.ceil(Math.max(g.shapeSize.x,g.shapeSize.y)/2));const m=new OffscreenCanvas(g[l(517)].x,g.imageSize.y).getContext("2d");if(!m)throw new Error(l(512));m[l(491)]=l(530)+g[l(540)][0]+","+g[l(540)][1]+","+g[l(540)][2]+","+g[l(540)][3]/255+")";const u=2===g[l(500)]?g[l(540)]:g[l(503)];let y,p,b,w;m[l(527)]=l(530)+u[0]+","+u[1]+","+u[2]+","+u[3]/255+")",m.lineWidth=2!==g.style?g[l(547)]:1,g[l(493)]||3!==g.style?g[l(493)]||1!==g.strokeWidth&&2!==g[l(500)]?({indexList:p,coordList:b,imageData:w,indexListCount:y}=f(g,m)):({indexList:p,coordList:b,imageData:w,indexListCount:y}=c(g,m)):({indexList:p,coordList:b,imageData:w,indexListCount:y}=function(e,t){const a=a26_0x5172,r={...e,style:2,primaryColor:e.secondaryColor},n={...e,style:1},o=f(r,t);t[a(518)](0,0,e[a(517)].x,e[a(517)].y);const s=c(n,t),d=(0,i.X$)(e.imageSize.x*e.imageSize.y,e.imageSize.x*e[a(517)].y*4,!0),l=(0,i.X$)(e[a(517)].x*e[a(517)].y*2,Math[a(516)](e[a(517)].x,e[a(517)].y),!0);let x=0,h=0,g=0,m=0,u=!1;for(g=e[a(534)][a(488)];g<e[a(534)].bottom;g++)for(h=e[a(534)][a(542)];h<e[a(534)][a(513)];h++)m=4*(g*e[a(517)].x+h),u=!1,o[a(546)][m+3]>e[a(503)][3]/2&&(o[a(546)][m+3]=e[a(503)][3],u=!0),s.imageData[m+3]>e[a(540)][3]/2&&((0,i.Yr)(o[a(546)],m,s.imageData,m),u=!0),u&&(l[2*x]=h,l[2*x+1]=g,d[x++]=m);return{imageData:o[a(546)],indexListCount:x,indexList:d,coordList:l}}(g,m));const S=p[l(535)](0,y);t[l(501)](.25);const k=new Uint8Array(new SharedArrayBuffer(4*p[l(526)]));let L=0;for(L=0;L<p[l(526)];L++)(0,i.Yr)(k,4*L,g[l(545)][l(498)],p[L]);if(t[l(501)](.5),g[l(538)]===l(543))for(L=0;L<S[l(526)];L++)(0,i.Yr)(g.targetImage.data,S[L],w,4*(b[2*L+1]*g[l(517)].x+b[2*L]));else for(L=0;L<S[l(526)];L++)(0,r.B)(g[l(538)],g[l(545)][l(498)],S[L],w,4*(b[2*L+1]*g[l(517)].x+b[2*L]));t[l(501)](.75);const z=new Uint8Array(new SharedArrayBuffer(4*p.length));for(L=0;L<p[l(526)];L++)(0,i.Yr)(z,4*L,g.targetImage[l(498)],p[L]);return t[l(501)](1),{undoData:{indexList:S,colorData:k},redoData:{indexList:S,colorData:z},range:h}};function c(e,t){const a=a26_0x5172;if(!e.shapeDefinition[a(507)]||e[a(547)]>1)return f(e,t);if(1===e[a(500)])return function(e,t){const a=a26_0x5172;return e[a(548)][a(504)](e,t),function(e,t){const a=a26_0x5172,r=(0,i.X$)(t[a(517)].x*t[a(517)].y,t.imageSize.x*t.imageSize.y*4,!0),n=(0,i.X$)(t[a(517)].x*t[a(517)].y*2,Math[a(516)](t[a(517)].x,t.imageSize.y),!0);let o=0;const s=t[a(517)].x,c=t[a(517)].y,f=t[a(540)];let d=0,l=0,x=0;const h=new Array(c);for(x=0;x<c;x++)for(h[x]=[],l=0;l<s;l++)d=4*(x*s+l),e[d+3]>f[3]/3?h[x][l]=e[d+3]:(e[d+3]=0,h[x][l]=0);const g=[0,0,0,0,0,0,0,0],m=[0,0];for(x=0;x<c;x++)for(l=0;l<s;l++)if(h[x][l]>0){g[0]=0===l||0===x?0:e[4*((x-1)*s+(l-1))+3],g[1]=0===x?0:e[4*((x-1)*s+l)+3],g[2]=0===x||l===s-1?0:e[4*((x-1)*s+(l+1))+3],g[3]=0===l?0:e[4*(x*s+(l-1))+3],g[4]=l===s-1?0:e[4*(x*s+(l+1))+3],g[5]=0===l||x===c-1?0:e[4*((x+1)*s+(l-1))+3],g[6]=x===c-1?0:e[4*((x+1)*s+l)+3],g[7]=x===c-1||l===s-1?0:e[4*((x+1)*s+(l+1))+3],g[0]>g[1]?(m[0]=0,m[1]=1):(m[0]=1,m[1]=0);for(let e=2;e<8;e++)g[e]>g[m[0]]?(m[1]=m[0],m[0]=e):g[e]>g[m[1]]&&(m[1]=e);switch(m[0]){case 0:h[x-1][l-1]=e[4*((x-1)*s+(l-1))+3];break;case 1:h[x-1][l]=e[4*((x-1)*s+l)+3];break;case 2:h[x-1][l+1]=e[4*((x-1)*s+(l+1))+3];break;case 3:h[x][l-1]=e[4*(x*s+(l-1))+3];break;case 4:h[x][l+1]=e[4*(x*s+(l+1))+3];break;case 5:h[x+1][l-1]=e[4*((x+1)*s+(l-1))+3];break;case 6:h[x+1][l]=e[4*((x+1)*s+l)+3];break;case 7:h[x+1][l+1]=e[4*((x+1)*s+(l+1))+3]}switch(m[1]){case 0:h[x-1][l-1]=e[4*((x-1)*s+(l-1))+3];break;case 1:h[x-1][l]=e[4*((x-1)*s+l)+3];break;case 2:h[x-1][l+1]=e[4*((x-1)*s+(l+1))+3];break;case 3:h[x][l-1]=e[4*(x*s+(l-1))+3];break;case 4:h[x][l+1]=e[4*(x*s+(l+1))+3];break;case 5:h[x+1][l-1]=e[4*((x+1)*s+(l-1))+3];break;case 6:h[x+1][l]=e[4*((x+1)*s+l)+3];break;case 7:h[x+1][l+1]=e[4*((x+1)*s+(l+1))+3]}}const u=[];let y=0;for(x=0;x<c;x++)for(l=0;l<s;l++)if(h[x][l]>0){if(y=0,l>0&&x>0&&h[x-1][l-1]>0&&(u[y++]=0),x>0&&h[x-1][l]>0&&(u[y++]=1),l<s-1&&x>0&&h[x-1][l+1]>0&&(u[y++]=2),l>0&&h[x][l-1]>0&&(u[y++]=3),l<s-1&&h[x][l+1]>0&&(u[y++]=4),l>0&&x<c-1&&h[x+1][l-1]>0&&(u[y++]=5),x<c-1&&h[x+1][l]>0&&(u[y++]=6),l<s-1&&x<c-1&&h[x+1][l+1]>0&&(u[y++]=7),y>2){for(d=y;d<u[a(526)];d++)u[d]=-1;d=u[a(523)](1),-1!==d&&h[x][l]>=h[x-1][l]&&(u[a(496)](0)&&h[x-1][l]<h[x-1][l-1]||u[a(496)](2)&&h[x-1][l]<h[x-1][l+1])&&(h[x-1][l]=0,e[4*((x-1)*s+l)+3]=0,u[d]=-1),d=u.indexOf(6),-1!==d&&h[x][l]>=h[x+1][l]&&(u[a(496)](5)&&h[x+1][l]<h[x+1][l-1]||u[a(496)](7)&&h[x+1][l]<h[x+1][l+1])&&(h[x+1][l]=0,e[4*((x+1)*s+l)+3]=0,u[d]=-1),d=u[a(523)](3),-1!==d&&h[x][l]>=h[x][l-1]&&(u.includes(0)&&h[x][l-1]<h[x-1][l-1]||u.includes(5)&&h[x][l-1]<h[x+1][l-1])&&(h[x][l-1]=0,e[4*(x*s+(l-1))+3]=0,u[d]=-1),d=u[a(523)](4),-1!==d&&h[x][l]>=h[x][l+1]&&(u.includes(2)&&h[x][l+1]<h[x-1][l+1]||u[a(496)](7)&&h[x][l+1]<h[x+1][l+1])&&(h[x][l+1]=0,e[4*(x*s+(l+1))+3]=0,u[d]=-1),u[a(496)](1)&&u[a(496)](3)&&u[a(496)](4)&&(h[x-1][l]=0,e[4*((x-1)*s+l)+3]=0),u[a(496)](3)&&u[a(496)](1)&&u[a(496)](6)&&(h[x][l-1]=0,e[4*(x*s+(l-1))+3]=0),u[a(496)](4)&&u[a(496)](1)&&u.includes(6)&&(h[x][l+1]=0,e[4*(x*s+(l+1))+3]=0),u[a(496)](6)&&u[a(496)](3)&&u[a(496)](4)&&(h[x+1][l]=0,e[4*((x+1)*s+l)+3]=0)}}else e[4*(x*s+l)+3]=0;for(y=0,x=0;x<c;x++)for(l=0;l<s;l++)if(h[x][l]>0&&(y=0,l>0&&x>0&&h[x-1][l-1]>0&&(u[y++]=0),x>0&&h[x-1][l]>0&&(u[y++]=1),l<s-1&&x>0&&h[x-1][l+1]>0&&(u[y++]=2),l>0&&h[x][l-1]>0&&(u[y++]=3),l<s-1&&h[x][l+1]>0&&(u[y++]=4),l>0&&x<c-1&&h[x+1][l-1]>0&&(u[y++]=5),x<c-1&&h[x+1][l]>0&&(u[y++]=6),l<s-1&&x<c-1&&h[x+1][l+1]>0&&(u[y++]=7),y>=2)){for(d=y;d<u[a(526)];d++)u[d]=-1;u[a(496)](4)&&h[x][l]<h[x][l+1]&&(u[a(496)](2)&&h[x][l]<h[x-1][l+1]||u.includes(7)&&h[x][l]<h[x+1][l+1])&&(h[x][l]=0,e[d+3]=0),u[a(496)](3)&&h[x][l]<h[x][l-1]&&(u.includes(0)&&h[x][l]<h[x-1][l-1]||u[a(496)](5)&&h[x][l]<h[x+1][l-1])&&(h[x][l]=0,e[d+3]=0)}for(x=t.visibleRange.top;x<t[a(534)][a(494)];x++)for(l=t[a(534)].left;l<t[a(534)][a(513)];l++)h[x][l]>0&&(d=4*(x*s+l),e[d+3]=f[3],n[2*o]=l,n[2*o+1]=x,r[o++]=d);return{imageData:e,indexListCount:o,indexList:r,coordList:n}}(t[a(531)](0,0,e[a(517)].x,e[a(517)].y)[a(498)],e)}(e,t);2===e[a(500)]&&(e[a(503)]=e[a(540)],e[a(500)]=3,e[a(547)]=1);const r={...e,style:2,primaryColor:e.secondaryColor},n={...e,style:1},o=f(r,t);t[a(518)](0,0,e[a(517)].x,e[a(517)].y);const s=c(n,t),d=(0,i.X$)(e[a(517)].x*e.imageSize.y,e[a(517)].x*e.imageSize.y*4,!0),l=(0,i.X$)(e[a(517)].x*e[a(517)].y*2,Math[a(516)](e.imageSize.x,e.imageSize.y),!0);let x=0,h=0,g=0,m=0,u=!1;for(g=e[a(534)].top;g<e[a(534)].bottom;g++)for(h=e[a(534)].left;h<e[a(534)][a(513)];h++)m=4*(g*e.imageSize.x+h),u=!1,o[a(546)][m+3]>e.secondaryColor[3]/2&&((0,i.Yr)(o[a(546)],m,e.secondaryColor,0),u=!0),s.imageData[m+3]>e.primaryColor[3]/2&&((0,i.Yr)(o.imageData,m,s[a(546)],m),u=!0),u&&(l[2*x]=h,l[2*x+1]=g,d[x++]=m);return{imageData:o[a(546)],indexListCount:x,indexList:d,coordList:l}}function f(e,t){const a=a26_0x5172;e.shapeDefinition[a(504)](e,t);const r=t[a(531)](0,0,e[a(517)].x,e.imageSize.y)[a(498)],n=(0,i.X$)(e[a(517)].x*e[a(517)].y,e[a(517)].x*e[a(517)].y*4,!0),o=(0,i.X$)(e.imageSize.x*e[a(517)].y*2,Math.max(e.imageSize.x,e[a(517)].y),!0);let s=0,c=0,f=0,d=0;if(e[a(493)])for(f=e[a(534)].top;f<e[a(534)][a(494)];f++)for(c=e[a(534)][a(542)];c<e[a(534)][a(513)];c++)d=4*(f*e[a(517)].x+c),r[d+3]>0&&(o[2*s]=c,o[2*s+1]=f,n[s++]=4*(f*e.imageSize.x+c));else for(f=e[a(534)][a(488)];f<e.visibleRange[a(494)];f++)for(c=e[a(534)][a(542)];c<e[a(534)][a(513)];c++)d=4*(f*e[a(517)].x+c),r[d+3]>e[a(540)][3]/2&&(r[d+3]=e[a(540)][3],o[2*s]=c,o[2*s+1]=f,n[s++]=4*(f*e.imageSize.x+c));return{imageData:r,indexListCount:s,indexList:n,coordList:o}}function d(e,t){const a=a26_0x5172,i=t[a(542)]-Math[a(520)](e[a(542)]),r=i+(0,n.Oq)(t),o=t[a(488)]-Math[a(520)](e.top);return{left:i,right:r,top:o,bottom:o+(0,n.rY)(t)}}},7742:(e,t,a)=>{"use strict";a.d(t,{ap:()=>r,TO:()=>n,zg:()=>o});var i=a(1003);function r(e,t){const a=a26_0x5172,i=e[t];if(i[a(536)]<1||i.height<1)throw new Error('Invalid dimensions for image "'+t+'": '+i[a(536)]+a(541)+i[a(529)])}function n(e,t,a){const i=a26_0x5172,r=e[t],n=e[a];if(r[i(536)]===n[i(536)]&&r.height===n.height)throw new Error(i(490)+t+i(519)+a+i(515))}function o(e,t,a){const r=a26_0x5172,n=e[t];if(!(0,i.ur)(a,n))throw new Error(r(502)+t+'" '+(0,i.PW)(n)+" must be contained within "+(0,i.PW)(a))}}}]);