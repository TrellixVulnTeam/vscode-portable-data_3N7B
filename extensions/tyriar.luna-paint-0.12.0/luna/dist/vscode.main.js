const a2_0x521b=["releasePointerCapture","_event","tool.movePixels","openFile","default","dims","Access to clipboard-read was denied","substring","Background","_cachedMovingLayer",'Could not find non-existent static view "',"History entry factory ","_onDimensionsChange","#version 300 es\nlayout(location=0)in vec4 A;out vec2 v_texcoord;void main(){gl_Position=A;v_texcoord=(A.xy+1.)/2.;}","_onSoftDeletedChange","dropEffect","initialIndex","_onDidAddBottomItem","_pointCount","moveSelection","reset","Command Palette","Win32",", right: ","onMimeTypeChange","clientHeight","pointerEvents","Layer Blend Mode: ","_onStateChange","No active image index","_configService","_frameBuffer","This image type doesn't support multiple images","Toggle Pixel Grid","moveImageToBottom","width","move","_listElement","registerTemporaryLayer","visible","shape","_setValue","onShowViewportChange","option","layer-move-down","_setState","_supportsLayers",", top: ","Buffer","setAttribute","layer-duplicate","arrayBuffer","activeTool","NOTEQUAL","luna:textFocused","_tempLayerId","image.canvasSize","ctrl+r","inputBoxNumberOrDimensionsShorthand","_forceSelectionAnimation","OffscreenCanvas","selected","DYNAMIC_DRAW","layer.toggleLayersWindow","_createBlendModeSelect","Resampling not selected",".jif","_layerTexturesUniformLocation","filter","composite","Eraser","grabbed","scaledImageQuality","_onDblClick","getComputedStyle","Move Image to Bottom","_parentLayer","Cannot resize image in single layer task","colorData","onDidChangeVisibility","onLastListenerRemove","Help","_imageLayerIdCounter","layer/rotate90CounterClockwise","_onSliderChange","_imageCanvasRenderProgram","interactive","_hexInputElement","disableWorkers","_toolRenderPrograms","start","pointermove","putImage","drawShape","#top","IpcService","selectAll","_isScrollLocked","_onEntriesChange","Active","createBuffer","color-overlay","image.goToImageAbove","_onStretchEnabledChange","_reportProgress","merge","_savedViewport","createReadonlyHsvColor","createCompositeEntrySync","alignment","_onHistoryAction","onKeyUp","_createColorInfo","uniform4f","Zoom level is ","_onStopAnimating","Gets the color by averaging the values of surrounding pixels.","_imageSet","pointerDown","importScripts","restoreState","Enter save quality between 0 and 100","_dropTargetElement","moving","match","registerHistoryEntryFactory","Move Layer","_scrollInterval","layer/rotate90Clockwise","_imageService","Duplicate Layer","_historyService","_disposables","_needsAttributeUpdate"," * a_position;\n}","LINE_LOOP","Toggle more color details","simple","#181e29","pause","rename","Toggle pixel grid when zoomed in","restoreHistory","file.save","moveLayer","_updateTextureIfNeeded","_lastCoord","layerIndexList","_imageFileId","No current layer","compileShader","setActiveLayer","114656QjuOoS","firstChild","_isStretchEnabled","_frameBufferRenderBuffer","open","file.saveAs"," (HSV)","Uint8Array","No undo entry","_onUpdate","_createLayer","layerId","pauseanimations","_tileScaledDimensionsUniformLocation","all","Delete image","mimeType","_syncHiddenText","bottomStatusBar","_toolService","_uniformValueZoom","_finishEdit","_undoBlendMode","report-issue","Draw Line"," Copy","findIndex","_selectionAnimationFrame","_frameBufferTexture","_zoomUniformLocation","Hexadecimal representation of RGB","convertToBlob","30239ecHyfA","runTask","separator","state","Enter the new name","extName","u_shift","_alpha","linearDodgeAdd","There is no layer to merge down into","sort","from","$debounce$","ctrlKey","rectangle","showToast","previousSibling","imageTextureRange","toRgba","Add New Layer","initialState","redoName","swap","acquireVsCodeApi","round","min","ctrl+shift+s","drop","getShaderInfoLog","Zoom","progress","di$target","Fill","_sliderContainer","Top left","vertexAttribPointer","attribute vec4 a_position;uniform mat4 a;uniform vec2 b;void main(){gl_Position=a*(a_position*vec4(b,0.,1.));}","onerror","color-picker-rect","dragend","colorPicker",".jpe","_onRequestTool","createTexture","_disposed","_rectangleElement","mergeLayerDown","fontFamily","rightItems","_onShowColorDetailsChange","_calculateScrollVelocity","bottom","24-bit","_undoName","defaultVisible","NYI","setImageSoftDeleted","tools","moveImageTo","137Txpaok","_selection","imageResize","newImage","hasStateHandler","Cannot restore state from previous version (","blur","#version 300 es\nprecision mediump float;\n\nuniform float ","There is no layer below this layer","getPropertyValue","layer-new","_isRestoringState","screen","CommandService","layer","has","hand","getColorSetFromPointerEvent","vscode.setContext","_moveActiveImageToIndex","_layerListElement","multiLayer","_activeTool","_colorService","Flip Vertical","snapToPixelGrid","redoDimensions","_name","_startEdit","timeout","ALWAYS","right","getElementsByTagName","undoData","minimap.toggleStretch","Move Image Down","_progress","_mergeLayerDownButton","Cannot serialize history","useProgram","Empty","_replacedRange","undoImage","createReadonlyRgbaColor","saveState","_checkLayerSupport","showViewport","_imageFileService","fallbackDimensions","a_position","tool.text","Layers are not supported for this image type","backup","tool.zoom","_viewportOrigin","Actual Size","undoRange","enable","onAttach","_onDidRemoveBottomItem","_setSoftDeleted",") 0%, rgba(","resolve","_action","type","position","select","_layoutAll","layer.duplicateLayer","activeImageSetIndex","_messageHandler","_backgroundColor","getCoordsFromEvent",".dib","end","_refreshToolState","return this","isArray","_onDidRemoveTopItem","onDidChangeDimensions","eraseRange","Loading chunk ","FRAGMENT_SHADER","options","insertAdjacentElement","16 colors","goToLayerBelow","_positionsArray","read","luna:hasSelection","1197652xrKAWJ","layer.goToTopLayer","querySelector","getContext","onImagesChange","_vertexArrayObject","layer/invertColors","_handleHistoryAction","_onRedo","Crop to Selection","_redoData","moveSelectedPixels","css.toColor: Unsupported css format",") in vec4 a_position;\n\nuniform mat4 ","TEXTURE_2D","push","createTextNode","close","drawImage","canvas","textContent","_onDidEndDrag","startVector","_createPaletteButton","requestRender","layer/resize"," - ","side","log","offsetHeight","Could not find temp layer ","_imageTexture","includes","Cannot run expand canvas to selection without a selection","_getUnusedLayerLabelId","entries","Colors","layerReplace","isReadonly","Focus Canvas","_entryFactories","registerStateHandler","_moveLayerUpButton","TEXTURE_WRAP_S","_getImageOrActiveIndex","tabIndex","redoHandler","webviewRequestId","preview","script","_forwardEventToTool","rgba","selectionStart","onImageChange","random","temporaryLayer","_targetElement","display",") 100%)","serialize","unloadedImages","layer/flipHorizontal","Float32Array","saveAs","minimap","Toggle Layers Window","some","createExtendedEdit","STATIC_DRAW","tool.toggleMoveTool","onDblClick","file.open","hsv"," ||\n      mod(v_position.y / ","_applyCommit"," pixels wide by ","tool.line","requestInputNumber","1-bit","getAttribLocation","leftItems","texParameteri","Left","then","allowUnchecking","ctrl+alt+pagedown","image.moveImageDown","cmdctrl+v","Width not selected","_viewportPosition","Invert Colors","onChange","_goToRelativeLayer","_normalizeWheelDelta","_renderProgramsWithOrder","generatePreview","_addItem","Update Selection","onPixelGridEnabledChange","data-webpack","canUndo","_queueProgress","onFirstListenerAdd","Finish Selection","_blendShader","Undoing temporary layer step without initial step state event","now","selection-topleft","Duplicate Image","_refresh","warn","Merge Layer Down","clearColor","image.rotate90Clockwise","_getFrameBufferTexture","_ignoreStateChangeEvents","_contextKeys","setOption","minimap.toggleShowViewport","Report Issue...","_mimeType","disabled","_checkCanEdit","_layoutDependentViews","Merge","_setHorizontalLine","_resize","expand-canvas-to-selection","onCommit","__decorate","stopPropagation","_updateViaSlider","createFramebuffer","dragging","flipY","_refreshColorDetails","syncGlobalState","apply","Select All","onDidChangeViews","#gui","number","_initialIndex","extHostRequestId","_reportInterval","singleLayer","Erase","subarray",'State handler for id "','Cannot find factory for history entry id "',"factory","_onChangedDimensions","_createWindowView","Mac68K","TEXTURE0","Could not find layer to set","image.rotate180","duplicate","getOwnPropertyDescriptor"," pixels tall","mergeDown","contains","bind","_getValue","updateWorkbenchState","zoom","toHsv","cmd-palette-list","startsWith","pointerdown","keyDown","activeImage"," depends on UNKNOWN service ","File","_config","_clickOrigin","_viewportUpdate","_pixelSizeLocation","_showColorDetails","deleteRenderbuffer","cmdctrl+c","block","prototype","topleft","defaultPosition","onDidAddTopItem"," executed","Layers","_pointCache","selection","SharedArrayBuffer","statusBarPointerColor","_zoom","querySelectorAll","lighten","_data","dataType","Could not serialize layers",";\n\nout vec2 v_position;\n\nvoid main() {\n  gl_Position = ","Go to Top Image","tool.colorPicker","_queueUpdate","layer/rotate180","for","exports","_isEditInProgress","_createToggle","_canvasSelection","getRanges","_isStencilUniformLocation","_redoBlendMode","_restoreEntry","layer/crop","_layerBlendModesUniformLocation","serviceBrand","_blendModeUniformLocation","createDocumentFragment","--vscode-list-activeSelectionForeground","Options for task ","How many bits per pixel should be used for the image?","ctrl+shift+r","isSelectionTool","createEmptyRgbaColor","workbench.action.quickOpen","layers","_elementResizeObserver","_getIndexFromId","toHsl","u_matrix","assign","top","_onPointerCoordChange","crop-to-selection","resume","Quality not selected","active-colors","luna:focused","minimap-viewport","createElement","_windowVisibleContextKey","newLayer","hotExitMaxPixels","nameSpan","image.customizePointerColorStatusBarItem",'No state handler for id "',"version","_width","Toggle Images Window","getImageData","save","Rename layer","normal","onUpdate","_getLayerDragEventId","Unexpected image file ID for single image file","_onPixelGridEnabledChange","channel","framebufferRenderbuffer","pointerId","bindFramebuffer","onload","COLOR_BUFFER_BIT","view-drop-target","charset","slider-tab","in-viewport","isVisible","renderbufferStorage","MODULE_NOT_FOUND","_model","_activeUntilReleaseToolKey","containsCoord","statusbar","_renderTileSet","_onKeyUp","outlineSize","active","canRead","pointerUp","Hand Until Release","quickPick","image.flipVertical","_toolDisposables"," at position ","_rightElement","input-container","remove","Status bar item already added","setService",", 1.) < 1. / ","runSyncAction","getCommand","_isVisible","luna:supportsMultipleImages","colors","deselect","_luna","moveLayerToBottom","activeToolId","attachShader","_rangeNotYetRequested","onShowColorDetailsChange","CLAMP_TO_EDGE","scaledHeight","Flatten Layers","operationName","get","value","afterend","_moveLayerDownButton","radio","finishMovePixels","step","_renderService","_positionsNeedsUpdate","_generatePreview","_maxValue","strokeWidth","staticState","_onmessage"," > ","scrollHeight","images","New Image","_rightItemsElement","layer-merge","_animationFrame","Top right","_extHostRequestHandlers","indexOf","_onStateSync","deleteImage","transform","_gl","uniform2f","_canvasDimensionsUniformLocation",".jpeg","bindVertexArray","ContextKeyService","ColorService","minimap.toggleMinimapWindow","image/bmp","alt+pagedown","drawLine","clientY","canRedo","setNextTemporaryLayerId","set","height","Copied ","_cloneState","_viewportService","_onDidStartDrag","static","div","undoBlendMode",'" to set active',"vscode.executeCommand","map","toLowerCase","onDidEndDrag","Move the active layer down","Copy","_redoImage","_logProgress","header-content","toast-message","Selection","_onStartAnimating","_channel","_viewportElement","onUpdateEmitter","_sc","_isPointerDown","_progressLast","Macintosh","uniform1iv","difference","_operationName",";\n\nvoid main() {\n  gl_Position = ","utf-8","wheel",'" exceeded maximum pixel count allowed (',"--luna-statusBar-icon-brightness","_blendModeOptions","_statusBarService","_stepState"," y=","classList","_onHistoryUnset","#bottom","colorMask","_ctx","Draw Text","anchor","observe","_canvas","pencil","effectAllowed","isSoftDeleted","Move Layer Down","eraseKeepSelection","createMessageHandler","result","not supported","_program","inputBoxString","_widgetContent","toggle-minimap","Fit layer to window [","textureImage","_changeHexInput","onChangedDimensions","finishTemporaryLayer","Toggle the viewport display in the minimap","texImage2D","isPixelGridEnabled","Open","checked","Enter","hardwareConcurrency","view.zoomIn","_undoDimensions","toString","activeToolState","_keyDown","rgb","DEPTH_STENCIL","_layerId","moveLayerToTop","getRightItems","_channelIndex","32-bit","_container","_minValue","Unrecognized array type","image.moveImageUp","_colorDetailsDisposables","_items","_imageTextureRange","setProperty","getProgramParameter","finishText","_stateService","Open Image","Hard edges","onPointerUp","defineProperty","RGBA","slice","visibleCheckbox","requiresTool","task","keyup","data-tool-state","terminate","content","_onUndo","luna-icon"," 0%, rgba(","onStateSync","onRequestTool","moveImageUp","style","createImageBitmap","movePixels","hideView","Customize Pointer Color Status Bar Item","INPUT","framebufferTexture2D","view.togglePixelGrid","StateService","_refreshActiveImage","renderSelection","_uniformValueBlendModes","onSoftDeletedChange","Go to Layer Above","Swap Colors","_attach","Hand","_listeners","history-list","Menu","setPixel","_requestToolIfNeeded","_updateUniformValueMatrix","right-items"," window","_replacedImage","Windows","u_pixelsize","createRgbaColor","exportBlobClone","Duplicate image","image.resize","SRC_ALPHA","_getBeforeRunLayerTaskEvent","showView","_restoreCompositeEntry","_applyData","getAllCommands","getDetailedInfo","linear-gradient(90deg, rgb(255,0,0) 0%, rgb(255,255,0) 16.67%, rgb(0,255,0) 33.33%, rgb(0,255,255) 50%, rgb(0,0,255) 66.67%, rgb(255,0,255) 83.33%, rgb(255,0,0) 100%)","replacedImage","hidden","Duplicate layer","getFineCoordsFromEvent","pointer-color","ArrowLeft","alt+pageup","_finishHistoryEntryCtor","_lastPointerEvent","linear-gradient(90deg, hsl(","primaryColor","catch","buttons","bottomleft","offsetWidth","image/x-ico","bindTexture","No history entry ID to restore","addEntry","mouseright"," not yet supported","Save","focusin","Finish Shape","_textureAUniformLocation","_updateUniformValueZoom","contentRange","createInstance","image/png","_imagesMap","Cannot run crop to selection without a selection","_frameBufferTextures","_pointerDownMoveListener","inputBoxNumber","onPointerDownMove","Go to Bottom Layer","image.goToImageBelow","createRgbColor","_eventInViewport","clear","_onShowViewportChange","Undo","Crop","viewport","image.finishActiveAction","enableVertexAttribArray","Delete Layer","Layer","rgba(","parentNode","imageFile","NEAREST","_sliderTabElement","png","ctrl+y","deleteTexture","_handlePointerDownMove","onLayerVisibilityChange","unregister","removeChild","_startAnimatingProgram","selection.erase","image.cropToSelection","_pointerDownStartTime","Finish Rectangle","Move Selected Pixels","TRIANGLE_FAN","-bit","drawArrays","_rebuildImageCache","hex","onZoomChange","_activeItems","exportBlob","pattern","_onImagesChange","missing","_configEquals","Delete Image","vscode.toggleMenuBar","commandId","container","onDidRemoveTopItem","delete","Move Image to Top","_handlePointerMove","_channelToHex","updateTextureIfNeeded","deserialize","Delete layer","pop","_options","_openImages","LINK_STATUS","ranges","No redo entry","_fillRange","_onPointerDownMove","_lastAnimationFrame","_entries","ArrowRight","_defaultValue","_contextMenuService","Erase (Keep Selection)","forEach","Shape","registerRequestHandler","reduce","_getCanvasBounds","applyCommit","show","_viewService","types","image.deleteImage","_viewElement","Image is readonly because an edit is in progress","stencilFunc","insertBefore","Could not find layer ","_imageListItems","_updateItem","_isReadonly","adjustments.invert","overlay","isInteger","onDispose","_matrixLocation","Window","getColorFromPointerEvent","permissions","config","getAll","index","flipX","redoBlendMode","fontSize","Go to Layer Below","image-move-down","input","drop-target","_getImageDragEventId",".ico","Cannot call exportBlob for ico files","layer.flipVertical","dragstart","nextSibling","_createListItemElement","imageTexture","invertColors","body","_onPointerUp","header","topStatusBar","requestQuickPick","clientWidth","_handlePointerUp","onConfigChanged","size","tool.pencil","string-combo","_contextKeyService","_elementService","onRedo","_rectangleShader","indexList","_renderImages","_updateRenderLayerTiles","tool.eraser","_deleteLayerByIndex","Layer: ","deltaY","_onTemporaryLayerUnregistered","layer.goToLayerBelow","_listItemElements","onLayerChange","data-active-tool","loadedImages","requestAnimationFrame","Red","list-","data","new","cutImage","_layerOffsetUniformLocation","_onAttach","luna-image://","toggle","zoomOut","_contentElement","runAction","offsetX","selection.deselect","Finish Text","code","ceil","tiles",'Cannot run command "',"_commands","layer/flipVertical","_refreshTheme","_validate","_windowResolvedPosition","showError","_activeLayersModelIndex","secondary","deleteProgram","Height not selected","history","_layerListItems","layer.rotate180","TEXTURE_MIN_FILTER","Hex:","blendColorAtRange","erase","_rehydrateExtHostMessage","dataTransfer","256 colors","value must not be falsy","_itemDisposables","_attachedDisposables","color-picker-target","tool","percent","_createMinimapImageBounds","getBoundingClientRect","_undoImage","_isSoftDeleted",")->(","duplicateImage","selection-size","_matrixUniformLocation","MinimapService","join","getParameter","isItalic","FileService","clearRect","button","actions","Image","info","activeEntry","Bottom left","sourceColor","undoHandler","_updateLayer","getTempLayer","Expand Canvas to Selection","Cannot find module '","_rangeBuffer","previewCanvas","triggerHistoryAction","_vscodeApi","cmd-palette-header","selection.eraseKeepSelection","finishLine","toBlob","slider-input-","color-picker-container","setActiveImageByIndex","_timeout","Move Image Up","load","hasImage","True color & alpha channel","webglcontextlost",".js","Create a new layer","toggleAttribute","_nullTexture","_clearUntilReleaseTool","imageSmoothingEnabled","vscode-webview:","_colorUniformLocation","onDidRemoveBottomItem","fill","Unrecognized blend mode","_instantiationService","key","render","onPointerMove","u_color","call","write","currentLayer","WinCE","_commandService","pointerDownMove","Middle","event","pointB","pow","order","_onLayerVisibilityChange","useMovingLayer","_isAnimating","MacPPC","canRunCommand","SELECT","_swapImagePositions","metaKey","Command ","activeLayer","parentLayerId","range","layer.moveLayerUp","_redoDimensions","renderLayer","devicePixelRatio","Bilinear","ctor","createCompositeEntry","scrollTop","text","_targetIndex","error","_positionArray","History","validate","Go to Image Above","absolute","_layersModel","_showViewport","bmp","finishShape","repeat","checkbox","getData","Right",".bmp","pointerout","TRIANGLES","location","editIndex","query","ctrl+shift+n","Rotate 180°","_zoomLocation","COLOR_ATTACHMENT0",'Task "',"Bottom","currentTemporaryLayerId","chunk-","blendFunc","Invalid range - left: ","_screenPixelToCanvasCoord","activeTexture","image/webp","temporaryLayers","unknown","Rename Layer","name","getLayer","keydown","file.new","Rotate 90° Clockwise","_loadModule","setPointerCapture","writeText","flattenLayers","disable","ctrl+a","_ipcService","Zoom In","Image exceeded maximum pixel count allowed (","canSerialize","mouseWheelBehavior","allLayers","section","background","Could not find layer for history entry","Toggle Tools Window","max","label","cmd-palette","_taskWorkerService","pointA","topright","tagName","What pixel color do you want to show?","879912YzUwmx"," failed","_onVisibilityChange","nearestneighbor","fire","_onMimeTypeChange","\", it's disabled","Rectangle","_glSelection","tool.fill","modal","_activeAnimatingRenderPrograms","_activeLayersModel","_handleWheel",", try reopening the editor.","_pointerCoord","Show","onDidAddBottomItem","triggerRequestRender",".view","offsetY","workbenchState","onStartAnimating",".webp","Canvas Size","drawText","_getNonSoftDeletedLayerCount","linkProgram","triggerHistoryUnset","_sanitizeValue","_shiftValue","appendChild","_isDisposed","Draw Rectangle","clientX","tool.selection","_input","--luna-icon-list-active-brightness","pointerMove","minimap-show-viewport","enter","_height","view.fitLayerToWindow","disposables","Value (aka brightness)","_apply","visibleRange","isStretchEnabled","Failed to serialize history","register","goToBottomLayer","ILunaService","Space","getLeftItems","clipboard","webgl2","_cachedVectorLayer","_renderSelection","crop","_frameBufferUniformLocation","filterCommands","currentScript","pending","cmdctrl+z","click","_startTime","Rotate 90° Counter-Clockwise","ctrl+9","vscode-menu","goToLayerAbove","buffer","_workbenchConfigService","updateAnimation","color.toggleDetails","Select where to anchor the existing image","_scrollVelocity","stopImmediatePropagation","_animationRenderPrograms","There is no layer above this layer","KEEP","_createButton","%) 100%)","datalist","Trying to get visible viewport range before element is attached","setBlendMode","altKey","addImage","onWheel","change","New","History entry type ","moveLayerUp","Restore Image (Hot Exit)","createEmptyRgbColor","_activeTemporaryLayers","span","fillContiguous","optionStep","_isWindowAnchor","decorate","disconnect","New Layer","loaded","ctrl+alt+pageup",";\n\nout vec4 outColor;\n\nvoid main() {\n  float c = floor(mod((float(gl_FragCoord.x) + float(gl_FragCoord.y) + ","_temporaryLayerIdCounter","pointer-coords","splice","invokeFunction","_destRange","view.zoomOut","_innerContainer","onTemporaryLayerRegistered",'Duplicate webview request handler "',"_refreshTitle","imageFileId","_onToolChange","_secondaryColorDiv","finishRectangle","toUpperCase","_clipspaceToCanvasCoordsMatrix","__esModule","Enter the width of the image (or wxh shorthand)","_setActiveItem","edit.cut","_renderLayers","uniform1i","message","_removeItem","_createWorker","toRgb","_addOption","_redoName","cancelAnimationFrame","getAttribute","bitness","_startHistoryEntryCtor","_hiddenText","WebGL context loss, please reload the tab","Attempt to dispose a disposed entity","layer/expandCanvasToSelection","edit.copy","__param","requestLayerTaskOptions","softLight","image.goToTopImage","eraseSelection","removeEventListener","generateLayerPreview","There must be at least one image","focus","_headerContentElement","help.reportIssue","Unknown History Entry","Tools","title","view.actualSize","adjustVector","targetIndex","BLEND","setColors","currentValue","_textureBUniformLocation","ChunkLoadError","createRenderbuffer"," static arguments","_progressTimeout","_doExecuteOnLayer","ONE_MINUS_SRC_ALPHA","dimensions","scroll","Cut Image","quality","function","shaderSource","_unloadImageSet","executeOnAllLayers","colors-toggle-details","setData","ctrl+o","uniformMatrix4fv","currentEntry","_inputService","blendMode","_updateBottomLayer","attribute vec4 a_position;attribute vec2 a_texcoord;uniform mat4 a;uniform vec2 b;varying vec2 v_texcoord;void main(){gl_Position=a*(a_position*vec4(b,0.,1.));v_texcoord=a_texcoord;}","FRAMEBUFFER","Move the active layer up","WorkbenchConfigService","dblClick","refreshTheme",",1) 0%, rgba(","setTool","getCellPosition","_imageIdCounter","_getRange","transparent","edit.undo","createHslColor","middle","_positionBuffer","_toolElements","parentElement","edit.paste","Minimap","Show All Commands"," has already been registered","getEventPositionFromCoords","Moving layer exceeded maximum pixel count allowed (","RENDERBUFFER","zoomIn","_onDidChangeViews","Cannot delete last layer","luna-layer://","documentElement","Save As","_target","createDomRenderProgram","fireAndWait","Command: Show All Commands","values","destImage","Deselect","newFromClipboard","onProgress","31NoKrtN","src","Uint16Array",'Deserialize tool service failed to set tool "',"Clipboard contains non-image data. Unable to access it.","requestNewDimensions","_onBeforeRunLayerTask","className","LINEAR","_resetHexInput","text/plain","blend","primary","luna-icon-before","Could not set color to array of length smaller than 4","#version 300 es\nlayout (location = ","postMessage","eraser","setVisible","_isPaused","_texcoordBuffer","_currentCompositeEntry","goToImageAbove","toFixed","bufferData","_info","Cannot set the active image to undefined","_onRequestRender","restore","find","layer.renameLayer","request","_range","#version 300 es\nprecision mediump float;uniform int a;uniform sampler2D b;uniform sampler2D c;in vec2 v_texcoord;out vec4 A;vec3 B(vec4 C,vec4 D,vec3 E){float a=C.a*D.a;return(C.a-a)*C.rgb+(D.a-a)*D.rgb+a*E;}vec4 F(vec4 C,vec4 D,int G){if(D.a==0.){return C;}if(C.a==0.){return D;}if(G==28){return D;}vec3 H;if(G==1){H=D.rgb;}else if(G==3){H=vec3(min(C.r,D.r),min(C.g,D.g),min(C.b,D.b));}else if(G==4){H=C.rgb*D.rgb;}else if(G==6){H=max(C.rgb+D.rgb-1.,0.);}else if(G==8){H=vec3(max(C.r,D.r),max(C.g,D.g),max(C.b,D.b));}else if(G==9){H=vec3(1.-(1.-C.r)*(1.-D.r),1.-(1.-C.g)*(1.-D.g),1.-(1.-C.b)*(1.-D.b));}else if(G==11){H=min(C.rgb+D.rgb,vec3(1.));}else if(G==13){H=vec3(C.r<.5?(2.*C.r*D.r):(1.-2.*(1.-C.r)*(1.-D.r)),C.g<.5?(2.*C.g*D.g):(1.-2.*(1.-C.g)*(1.-D.g)),C.b<.5?(2.*C.b*D.b):(1.-2.*(1.-C.b)*(1.-D.b)));}else if(G==14){H=vec3(D.r<.5?(2.*C.r*D.r+C.r*C.r*(1.-2.*D.r)):(sqrt(C.r)*(2.*D.r-1.)+2.*C.r*(1.-D.r)),D.g<.5?(2.*C.g*D.g+C.g*C.g*(1.-2.*D.g)):(sqrt(C.g)*(2.*D.g-1.)+2.*C.g*(1.-D.g)),D.b<.5?(2.*C.b*D.b+C.b*C.b*(1.-2.*D.b)):(sqrt(C.b)*(2.*D.b-1.)+2.*C.b*(1.-D.b)));}else if(G==20){H=abs(C.rgb-D.rgb);}else if(G==21){H=C.rgb+D.rgb-2.*C.rgb*D.rgb;}float I=D.a+C.a*(1.-D.a);return vec4(B(C,D,H)/I,I);}void main(){vec4 J=texture(b,v_texcoord);vec4 K=texture(c,v_texcoord);A=F(J,K,a);}","redoRange",'" failed: '," (RGB)","setPosition","_matrixNeedsUpdate","views",'", ignoring',"_leftItemsElement","Could not find builtin tool ","precision mediump float;uniform vec4 c;void main(){gl_FragColor=c;}","cmdctrl+shift+p","Tool","Hue","image-list","platform","Image size is ","duplicateLayer","_onPointerDown","Automatic publicPath is not supported in this browser","SharedArrayBuffer is not supported","readonly","Move Pixels","Select how the resize will be performed","Flip Horizontal","_stopAnimatingProgram","onBeforeRunLayerTask","_imageListElement","importBlob",") / 4., 2.));\n  outColor = vec4(c, c, c, 1);\n}","TRIANGLE_STRIP","keys","goToBottomImage","dispatchEvent","_workMatrices","setLayerVisibility","_getAnchorSide","Bottom right","bindRenderbuffer","_fillCommands","untilRelease","fillGlobal","head","_onLayerChange","_tolerance","getService","edit.redo","MAX_TEXTURE_IMAGE_UNITS","#version 300 es\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = vec4(0, 0, 0, 1);\n}","verticalAlignment","split","Move Selection","_option","image-new","_redoRange","image.expandCanvasToSelection","FLOAT","precision mediump float;varying vec2 v_texcoord;uniform int h;uniform int k;uniform vec2 d;uniform vec2 f;uniform vec2 g;uniform int m;uniform vec2 l;uniform int c[7];uniform sampler2D j[7];uniform sampler2D n;uniform vec2 o;vec3 A(vec4 B,vec4 C,vec3 D){float E=B.a*C.a;return(B.a-E)*B.rgb+(C.a-E)*C.rgb+E*D;}vec4 F(vec4 B,vec4 C,int G){if(C.a==0.){return B;}if(B.a==0.){return C;}if(G==28){return C;}vec3 H;if(G==1){H=C.rgb;}else if(G==3){H=vec3(min(B.r,C.r),min(B.g,C.g),min(B.b,C.b));}else if(G==4){H=B.rgb*C.rgb;}else if(G==6){H=max(B.rgb+C.rgb-1.,0.);}else if(G==8){H=vec3(max(B.r,C.r),max(B.g,C.g),max(B.b,C.b));}else if(G==9){H=vec3(1.-(1.-B.r)*(1.-C.r),1.-(1.-B.g)*(1.-C.g),1.-(1.-B.b)*(1.-C.b));}else if(G==11){H=min(B.rgb+C.rgb,vec3(1.));}else if(G==13){H=vec3(B.r<.5?(2.*B.r*C.r):(1.-2.*(1.-B.r)*(1.-C.r)),B.g<.5?(2.*B.g*C.g):(1.-2.*(1.-B.g)*(1.-C.g)),B.b<.5?(2.*B.b*C.b):(1.-2.*(1.-B.b)*(1.-C.b)));}else if(G==14){H=vec3(C.r<.5?(2.*B.r*C.r+B.r*B.r*(1.-2.*C.r)):(sqrt(B.r)*(2.*C.r-1.)+2.*B.r*(1.-C.r)),C.g<.5?(2.*B.g*C.g+B.g*B.g*(1.-2.*C.g)):(sqrt(B.g)*(2.*C.g-1.)+2.*B.g*(1.-C.g)),C.b<.5?(2.*B.b*C.b+B.b*B.b*(1.-2.*C.b)):(sqrt(B.b)*(2.*C.b-1.)+2.*B.b*(1.-C.b)));}else if(G==20){H=abs(B.rgb-C.rgb);}else if(G==21){H=B.rgb+C.rgb-2.*B.rgb*C.rgb;}float I=C.a+B.a*(1.-C.a);return vec4(A(B,C,H)/I,I);}void main(){vec4 B;if(g==f&&d==vec2(0.)){B=texture2D(j[0],v_texcoord);}else{if(v_texcoord.x>=(d.x)/g.x&&v_texcoord.y>=(d.y)/g.y&&v_texcoord.x<((d.x)+f.x)/g.x&&v_texcoord.y<((d.y)+f.y)/g.y){vec2 J=v_texcoord-vec2(d.x/g.x,d.y/g.y);vec2 K=J*vec2(g.x/f.x,g.y/f.y);if(o.x==1.){K.x=1.-K.x;}if(o.y==1.){K.y=1.-K.y;}B=texture2D(j[0],K);}else{if(k==1){discard;}else{B=vec4(0.,0.,0.,0.);}}}if(m==1){vec4 L=texture2D(n,gl_FragCoord.xy/l);B=F(L,B,c[0]);}for(int M=1;M<7;M++){if(M>=h){break;}if(g==f){vec4 C=texture2D(j[M],v_texcoord);B=F(B,C,c[M]);}else{if(v_texcoord.x>=(d.x)/g.x&&v_texcoord.y>=(d.y)/g.y&&v_texcoord.x<((d.x)+f.x)/g.x&&v_texcoord.y<((d.y)+f.y)/g.y){vec2 J=v_texcoord-vec2(d.x/g.x,d.y/g.y);vec2 K=J*vec2(g.x/f.x,g.y/f.y);vec4 C=texture2D(j[M],K);B=F(B,C,c[M]);}}}gl_FragColor=B;}","_onKeyDown","Go to Bottom Image","fitLayerToWindow","_activeRequests","_paletteService","toggleView","run","image.addNewImage","_renderer","isPointerDown","Gets the color of the nearest pixel.","Merge down","_activeUntilReleaseTool","clearEntries","image.flattenLayers","QuickPickService","scaledWidth","trim","getLayerById","KeybindingService","_startHistoryEntryOperationName","onHistoryUpdateValue","setNextLayerId","onTemporaryLayerUnregistered","createReadonlyHslColor","Toggle Move Tool",") {\n    outColor = vec4(0.2, 0.2, 0.2, .2);\n  }\n}","_updateProgress","executeOnSingleLayer","_getActiveImage","8-bit","dispose","image/jpeg","bilinear","getPixel","object","Move Layer to Bottom","_getImageCoordsFromEvent","length","3703123nntBrI","createRenderProgram","STENCIL_TEST","Image is readonly, edit is not supported","_stateHandlers","drawCircle","_onCommit","Move Layer Up","left-items","Smooth edges","onRequestRender","_onDidAddTopItem"," (Error)",".png","Composite entry error","setActiveImageById","runLayerTask","redoData","ARRAY_BUFFER","startLayer","_layerCountUniformLocation","exportImage",'Cannot find image "',"goToImageBelow","pixelCount","The color of all merged layers","stepState","ArrowUp","openBlob","TEXTURE_MAG_FILTER","swapImagePositions","_lastCommittedRange","layer.addNewLayer","allSettled","moveToRange","selection.selectAll","moveImageDown","texture","_undoData","onKeyDown","_openBlob","AddImage","onDimensionsChange","denied","ArrowDown","stencilOp","getType","setLayerName","tool.toggleToolsWindow","add","View","Images","_flippedAxisUniformLocation","isBold","2 colors","layer.moveLayerDown","createItem","mousemove","Unknown","moveLayerTo","[invokeFunction] unknown service '","smoothing","floor","edit","pixel-grid","_updateAttributeBuffers","offsetTop","@IServiceName-decorator can only be used to decorate a parameter","tempLayerId",",1)","_onTemporaryLayerRegistered",'Unknown command id for type "',"TEXTAREA","isBottomLayer","image","Move the active image up","_outOfFrameScroll","--luna-icon-brightness","_checkSupportsMultipleImages","UNSIGNED_BYTE","deleteLayer","_state","getShaderParameter","_pointerDownX","ViewService","image-delete","selectionEnd","secondaryColor","_colorLocation","layer/resizeCanvas","line","_forwardLayerEvents","moveLayerDown","onImageDeleted","redoImage","file","draggable","goToTopLayer","6486IjLyrd","encodeOptions","clipboard-read","Merge the active layer down","list","createVertexArray","_updateMatrixUniform","redo","color-box","webpackChunkluna","ctrl+d","linear-gradient(rgba(0,0,0,0) 0%, rgb(0,0,0) 100%),","createHsvColor","_updateWindowViewPosition","_currentEntryPointer","undo","resize","onEntriesChange","draw","attach","_blendWithframeBufferUniformLocation","reportIssue","The color of the pixel at the pointer (excluding active vectors or moving pixels)","image.flipHorizontal","Toggle Show Viewport","fitToCoords","onHistoryUnset","--luna-editor-backgroundColor","Close ","linear-gradient(180deg, ","_update","dragover","The images window is not supported for this file type","onLayerChangeEmitter","_onPointerMove","Blue","_focusNonActiveImage","_taskService","_imageDimensionsUniformLocation","Alt","WebGL2 is not supported","onPointerDown","_getSliderBackground",'Job dimension not found for task "',"ms ","_contributions","onStateChange","destRange","enabled","cmd+shift+z","Resize","_lunaService","dest","onStopAnimating","_onDispose","slider-with-input","aria-label","linear-gradient(180deg, rgba(","onStretchEnabledChange","palette","_deleteCurrentLayer","openIco","color","append","_blendMode","ctrl+shift+i","Cannot finish temporary layer without at least 1 step",";\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = ","deleteShader","Invert","_sliderGradientElement","isReady","Move the active image down","darken","padStart","activeElement","_inputElement","_getWithCache","Toggle Top Status Bar View","suffix","color.swapColors","openImage","_shiftLocation","registerHistoryEntryHandler","moveImageToTop","hue","view","element","--vscode-breadcrumb-foreground","scaledImage","target","onHistoryAction","imageSet","distance","renameLayer","_finish","contentRect","Layer ","slider","global","readyPromise","boolean","string","50%","exportImageClone","TEXTURE_WRAP_T","Cannot merge the bottom layer down","Hide","_onWheel","onPointerCoordChange","complete","onDidStartDrag","Failed to import image from clipboard","createReadonlyRgbColor","ctrl+m","_selectionService","Color Picker","_multiplyZoom","_finishCompositeEntry","Draw Shape","_windowPosition","_value","pageX","backupClipboardData","_loadedImages","showColorDetails","view.fitToWindow","update","getUniformLocation","Move Layer to Top",'" already exists'," < ","none","Toggle Stretch","_viewsElement","hasOwnProperty","_views","#canvas","Erase Selection","1051123jxjHNq","image.toggleImagesWindow","Validate Selection","replace","setTimeout","Toggle Bottom Status Bar View","onmessage","VERTEX_SHADER","onToolChange","Toggle Minimap Window","focusout","deltaX","Could not restore workbench state (version ","_updatePreviewIfNeeded","Paste Image","getTemporaryLayerById","left","addEventListener","Cannot finish composite entry without an entries array","linearBurn","multiply","_onZoomChange","minimap-stretch","_serializeCompositeEntry","DEPTH_STENCIL_ATTACHMENT","activeImageFileId","layerRange","image.moveImageToBottom","_onProgress",">Luna: ","preventDefault",", bottom: ","resource","_onDidChangeVisibilityEmitter","runCommand","_services","_pointerDownY","STENCIL_BUFFER_BIT","Cut","_renderPrograms","protocol","tool.toggleShapeTool","exclusion","_updateShiftUniform","toStringTag","_updateAttributeBuffersForLayer","abs","_minimapService","image.rotate90CounterClockwise","goToTopImage","_onConfigChanged","contextmenu","_entryHandlers","currentState","create","_previewCache","keyUp","Edit","padEnd","Toggle Palette Window","onVisibilityChange","tool.hand","bindBuffer","_quickPickService"," Layer","Saturation","_layer","Cannot redo readonly entry","Import Blob","commit","InstantiationService","Create a new image","space","pageY","blendFuncSeparate","fitToWindow","_onImageDeleted","_render","_finishHistoryEntryOperationName","Cannot get coords without element","layer/cropToSelection","_color","mouseout","_isPixelGridEnabled"],a2_0x27c6=function(t,e){return a2_0x521b[t-=498]};(function(t,e){const i=a2_0x27c6;for(;;)try{if(622925===-parseInt(i(570))+parseInt(i(1453))+parseInt(i(2281))+-parseInt(i(2045))+-parseInt(i(2313))*parseInt(i(1678))+-parseInt(i(2372))*parseInt(i(1906))+parseInt(i(1808)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a2_0x521b),(()=>{var t,e,i={4738:t=>{const e=a2_0x27c6;t[e(774)]=e(1711)},7542:t=>{const e=a2_0x27c6;t.exports=e(2142)},3318:t=>{const e=a2_0x27c6;t[e(774)]=e(1768)},3716:t=>{const e=a2_0x27c6;t[e(774)]=e(1638)},98:t=>{const e=a2_0x27c6;t.exports=e(1721)},7034:t=>{const e=a2_0x27c6;t[e(774)]=e(2349)},6495:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o,N:()=>r});var s=i(7166),n=i(4378);class o{constructor(t,e,i,s){const n=a2_0x27c6;this[n(875)]=t,this[n(1710)]=e,this[n(2111)]=i,this._f=s}async run(){const t=a2_0x27c6,e=(0,s.Qf)(this[t(2111)],this[t(1710)]);await this[t(2111)].edit((async(e,i,s)=>{const n=t;return await this._f(e,i,s),this[n(1710)]}));const i=(0,s.Qf)(this[t(2111)],this[t(1710)]);return new n.$(this[t(875)],this[t(1710)],this._layer.imageFileId,this[t(2111)].id,e,i)}}class r{constructor(t,e,i,s,n,o,r,a,h){const c=a2_0x27c6;this[c(948)]=t,this._layer=e,this[c(2373)]=i,this._x=s,this._y=n,this[c(2126)]=o,this[c(1755)]=r,this[c(1970)]=a,this._taskWorkerService=h}async run(){const t=a2_0x27c6;let e;return await this._layer.edit((async(t,i,s)=>{const n=a2_0x27c6;return e=await this._taskWorkerService[n(2314)](n(1752),{targetImage:{data:t,width:i,height:s},color:new Uint8Array(this._color),selection:this[n(2373)],x:this._x,y:this._y,tolerance:this[n(1755)],blendMode:this[n(1970)]}),e.range})),new n.$(this._operationName,e[t(1377)],this[t(2111)].imageFileId,this[t(2111)].id,e.undoData,e[t(1825)])}}},4852:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{S:()=>n});class n{constructor(t,e,i,s,n,o){const r=a2_0x27c6;this.operationName=t,this[r(1021)]=e,this[r(1834)]=i,this._imageFileId=s,this._layerId=n,this._tempLayerId=o,this.type=r(715),this.pixelCount=0}async undo(t){const e=a2_0x27c6,i=await t.getLayer(this._imageFileId,this._layerId);if(!i)throw new Error(e(1191)+this[e(998)]);const s=await t[e(1319)](this[e(2277)],this[e(998)],this._tempLayerId);if(!s)throw new Error(e(600)+this[e(998)]);if(s[e(1834)].pop(),0===s[e(1834)][e(1807)])throw new Error(e(675));const n=s[e(1834)][s[e(1834)][e(1807)]-1];return this[e(1498)](s,n),i}async redo(t){const e=a2_0x27c6,i=await t[e(1425)](this[e(2277)],this[e(998)]);if(!i)throw new Error(e(1191)+this[e(998)]);const s=await t.getTempLayer(this[e(2277)],this._layerId,this[e(2184)]);if(!s)throw new Error("Could not find temp layer "+this._layerId);return s.stepState[e(585)](this[e(1834)]),this[e(1498)](s,this.stepState),i}[s(1498)](t,e){const i=s;Object[i(799)](t.currentState,e),t.triggerRequestRender(),t[i(1324)]()}[s(629)](){const t=s;return{id:t(1610),requiresTool:this[t(1021)],operationName:this[t(875)],imageFileId:this[t(2277)],layerId:this._layerId,tempLayerId:this._tempLayerId,stepState:this[t(1834)]}}static[s(2099)](t){const e=s;return new n(t[e(875)],t[e(1021)],t[e(1834)],t.imageFileId,t[e(2292)],t[e(1876)])}}},8286:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{Z:()=>n});class n{constructor(t,e,i,s){const n=a2_0x27c6;this[n(875)]=t,this._imageFileId=e,this[n(998)]=i,this._tempLayerId=s,this[n(544)]=n(715),this[n(1021)]=n(1898),this[n(1832)]=0}async[s(1921)](t){const e=s,i=await t[e(1425)](this._imageFileId,this[e(998)]);if(!i)throw new Error(e(1191)+this[e(998)]);const n=await t[e(1319)](this[e(2277)],this[e(998)],this[e(2184)]);if(!n)throw new Error(e(600)+this[e(998)]);if(0===n[e(1834)][e(1807)])throw new Error(e(1972));const o=n[e(1834)][n.stepState.length-1];return this[e(1498)](n[e(2098)],o),await i[e(2167)](n,!1),n[e(1324)](),i}async[s(1913)](t){const e=s,i=await t[e(1425)](this[e(2277)],this._layerId);if(!i)throw new Error(e(1191)+this[e(998)]);const n=await t[e(1319)](this[e(2277)],this[e(998)],this[e(2184)]);if(!n)throw new Error("Could not find temp layer "+this._layerId);return i[e(625)]=void 0,n[e(1481)](),i}[s(1498)](t,e){Object.assign(t,e)}[s(629)](){const t=s;return{id:t(1328),operationName:this.operationName,imageFileId:this[t(2277)],layerId:this[t(998)],tempLayerId:this[t(2184)]}}static create(t){const e=s;return new n(t[e(875)],t[e(1568)],t[e(2292)],t.tempLayerId)}}},6628:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{$:()=>r});var n=i(1003),o=i(7605);class r{constructor(t,e,i,s,o,r,a,h){const c=a2_0x27c6;this[c(875)]=t,this[c(1448)]=e,this[c(1562)]=i,this[c(521)]=s,this[c(2277)]=o,this[c(998)]=r,this._tempLayerId=a,this._replacedImage=h,this[c(544)]="singleLayer",this[c(1021)]=c(1035),this[c(1832)]=(0,n.U6)(this[c(521)])}async[s(1921)](t){const e=s,i=await t[e(1425)](this[e(2277)],this._layerId);if(!i)throw new Error(e(1191)+this._layerId);const n=await t[e(1319)](this[e(2277)],this._layerId,this._tempLayerId);if(!n)throw new Error("Could not find temp layer "+this._layerId);if(0===n[e(1834)][e(1807)])throw new Error(e(1972));const o=n[e(1834)][n[e(1834)][e(1807)]-1];return n[e(2098)][e(1263)]=o[e(1263)],n[e(2098)][e(1473)]=o.offsetY,n.currentState[e(1206)]=o[e(1206)],n[e(2098)][e(704)]=o[e(704)],await i[e(2167)](n,!1),await i[e(1871)]((async(t,i,s)=>{const n=e;return await this[n(1448)].runTask("putImage",{targetImage:{data:t,width:i,height:s},putImage:{data:this._replacedImage[n(1253)],width:this[n(1058)][n(2164)],height:this[n(1058)][n(918)]},putRange:this[n(521)],replacedImage:void 0,blend:n(2048)}),this[n(1562)]})),n[e(1324)](),i}async redo(t){const e=s,i=await t.getLayer(this[e(2277)],this[e(998)]);if(!i)throw new Error(e(1191)+this[e(998)]);const n=await t.getTempLayer(this[e(2277)],this[e(998)],this._tempLayerId);if(!n)throw new Error(e(600)+this[e(998)]);const o=n.stepState[n[e(1834)][e(1807)]-1];n[e(2098)][e(1263)]=this[e(1562)].left,n[e(2098)][e(1473)]=this[e(1562)][e(800)],n[e(2098)][e(1206)]=o[e(1206)],n.currentState[e(704)]=o[e(704)],i[e(625)]=void 0;const r=await n[e(888)][e(1882)].readyPromise;let a;if(o[e(1785)]===r[e(2164)]&&o[e(873)]===r[e(918)])a=r;else{const t=await this[e(1448)][e(1824)]("layer/resize",{width:o[e(1785)],height:o[e(873)],resampling:o[e(1625)]},r,void 0).result;a=t[e(1958)]}return await i[e(1871)]((async(t,i,s)=>{const o=e;return await this[o(1448)][o(2314)]("putImage",{targetImage:{data:t,width:i,height:s},putImage:{data:a.data,width:a.width,height:a[o(918)]},putRange:this[o(1562)],replacedImage:void 0,blend:o(2048),flipX:n.currentState[o(1206)],flipY:n[o(2098)][o(704)]}),this[o(1562)]})),n[e(1481)](),i}serialize(){const t=s;return{id:"finishMovePixels",operationName:this.operationName,imageFileId:this._imageFileId,layerId:this[t(998)],tempLayerId:this[t(2184)],destRange:this[t(1562)],replacedRange:this._replacedRange,replacedImage:(0,o.t)(this[t(1058)])}}static[s(2099)](t,e){const i=s;return new r(e[i(875)],t,e[i(1953)],e.replacedRange,e[i(1568)],e.layerId,e[i(1876)],(0,o.e)(e[i(1073)]))}}},3817:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{O:()=>n});class n{constructor(t,e,i,s){const n=a2_0x27c6;this.operationName=t,this[n(2277)]=e,this[n(998)]=i,this[n(2184)]=s,this.type=n(715),this[n(1021)]=n(2327),this[n(1832)]=0}async[s(1921)](t){const e=s,i=await t.getLayer(this[e(2277)],this[e(998)]);if(!i)throw new Error(e(1191)+this[e(998)]);const n=await t.getTempLayer(this[e(2277)],this[e(998)],this[e(2184)]);if(!n)throw new Error(e(600)+this._layerId);if(0===n[e(1834)].length)throw new Error(e(1972));const o=n[e(1834)][n[e(1834)][e(1807)]-1];return this[e(1498)](n.currentState,o),await i[e(2167)](n,!1),n[e(1324)](),i}async[s(1913)](t){const e=s,i=await t[e(1425)](this[e(2277)],this[e(998)]);if(!i)throw new Error("Could not find layer "+this._layerId);const n=await t[e(1319)](this[e(2277)],this[e(998)],this[e(2184)]);if(!n)throw new Error(e(600)+this._layerId);return i[e(625)]=void 0,n[e(1481)](),i}[s(1498)](t,e){Object[s(799)](t,e)}[s(629)](){const t=s;return{id:t(1571),operationName:this[t(875)],imageFileId:this[t(2277)],layerId:this._layerId,tempLayerId:this._tempLayerId}}static create(t){const e=s;return new n(t[e(875)],t.imageFileId,t.layerId,t[e(1876)])}}},3089:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{o:()=>n});class n{constructor(t,e,i,s){const n=a2_0x27c6;this.operationName=t,this[n(2277)]=e,this[n(998)]=i,this._tempLayerId=s,this[n(544)]=n(715),this.requiresTool=n(2169),this.pixelCount=0}async[s(1921)](t){const e=s,i=await t[e(1425)](this[e(2277)],this[e(998)]);if(!i)throw new Error(e(1191)+this._layerId);const n=await t[e(1319)](this[e(2277)],this._layerId,this._tempLayerId);if(!n)throw new Error(e(600)+this[e(998)]);if(0===n[e(1834)][e(1807)])throw new Error(e(1972));const o=n.stepState[n.stepState[e(1807)]-1];return this[e(1498)](n[e(2098)],o),await i.registerTemporaryLayer(n,!1),n[e(1324)](),i}async redo(t){const e=s,i=await t.getLayer(this[e(2277)],this[e(998)]);if(!i)throw new Error("Could not find layer "+this[e(998)]);const n=await t[e(1319)](this[e(2277)],this[e(998)],this[e(2184)]);if(!n)throw new Error(e(600)+this[e(998)]);return i[e(625)]=void 0,n[e(1481)](),i}[s(1498)](t,e){Object[s(799)](t,e)}[s(629)](){const t=s;return{id:"finishShape",operationName:this.operationName,imageFileId:this[t(2277)],layerId:this[t(998)],tempLayerId:this[t(2184)]}}static[s(2099)](t){const e=s;return new n(t[e(875)],t.imageFileId,t.layerId,t[e(1876)])}}},707:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{o:()=>n});class n{constructor(t,e,i,s){const n=a2_0x27c6;this[n(875)]=t,this._imageFileId=e,this._layerId=i,this[n(2184)]=s,this[n(544)]="singleLayer",this[n(1021)]=n(1386),this.pixelCount=0}async[s(1921)](t){const e=s,i=await t.getLayer(this._imageFileId,this._layerId);if(!i)throw new Error(e(1191)+this[e(998)]);const n=await t[e(1319)](this[e(2277)],this[e(998)],this[e(2184)]);if(!n)throw new Error(e(600)+this[e(998)]);if(0===n.stepState.length)throw new Error(e(1972));const o=n[e(1834)][n[e(1834)][e(1807)]-1];return this[e(1498)](n.currentState,o),await i[e(2167)](n,!1),n[e(1324)](),i}async[s(1913)](t){const e=s,i=await t[e(1425)](this._imageFileId,this[e(998)]);if(!i)throw new Error(e(1191)+this._layerId);const n=await t[e(1319)](this._imageFileId,this._layerId,this[e(2184)]);if(!n)throw new Error("Could not find temp layer "+this[e(998)]);return i[e(625)]=void 0,n[e(1481)](),i}_apply(t,e){Object[s(799)](t,e)}serialize(){const t=s;return{id:"finishText",operationName:this[t(875)],imageFileId:this[t(2277)],layerId:this[t(998)],tempLayerId:this[t(2184)]}}static[s(2099)](t){const e=s;return new n(t[e(875)],t[e(1568)],t[e(2292)],t[e(1876)])}}},6785:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{x:()=>o});var n=i(7605);class o{constructor(t,e,i,s,n,o){const r=a2_0x27c6;this[r(875)]=t,this[r(2277)]=e,this[r(998)]=i,this._range=s,this[r(1846)]=n,this._redoData=o,this.type=r(715),this[r(1832)]=this[r(1846)][r(1237)][r(1807)]}[s(1921)](t){const e=s;return this._applyData(this[e(1710)],this._undoData,t)}[s(1913)](t){const e=s;return this[e(1069)](this._range,this[e(580)],t)}[s(629)](){const t=s;return{id:t(2276),operationName:this[t(875)],imageFileId:this[t(2277)],layerId:this[t(998)],range:this[t(1710)],undoData:(0,n.t)(this[t(1846)]),redoData:(0,n.t)(this[t(580)])}}async[s(1069)](t,e,i){const n=s,o=await i.getLayer(this[n(2277)],this[n(998)]);if(!o)throw new Error(n(1443));return await o[n(1871)]((i=>{const s=n;let o=0;for(let t=0;t<e.indexList[s(1807)];t++)o=e.indexList[t],i[o]=e[s(2207)][4*t],i[o+1]=e.colorData[4*t+1],i[o+2]=e.colorData[4*t+2],i[o+3]=e[s(2207)][4*t+3];return t})),o}static[s(2099)](t){const e=s;return new o(t[e(875)],t[e(1568)],t[e(2292)],t[e(1377)],(0,n.e)(t[e(513)]),(0,n.e)(t[e(1825)]))}}},4378:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{$:()=>o});var n=i(1003);class o{constructor(t,e,i,s,o,r){const a=a2_0x27c6;this[a(875)]=t,this[a(1377)]=e,this[a(2277)]=i,this._layerId=s,this[a(1846)]=o,this._redoData=r,this[a(544)]=a(715),this[a(1832)]=(0,n.U6)(this.range)}async undo(t){const e=a2_0x27c6;return await this[e(1498)](this[e(1846)],t)}async[s(1913)](t){const e=s;return await this[e(1498)](this[e(580)],t)}async[s(1498)](t,e){const i=s,o=await e[i(1425)](this[i(2277)],this[i(998)]);if(!o)throw new Error("Could not find layer "+this[i(998)]);const r=(0,n.rY)(this[i(1377)]),a=(0,n.Oq)(this[i(1377)]),h=4*a;let c=0,l=0,d=0;return await o[i(1871)](((e,s)=>{const n=i;for(let i=0;i<r;i++)l=i+this[n(1377)][n(800)],c=4*(l*s+this[n(1377)][n(2061)]),d=i*a*4,e[n(917)](t[n(717)](d,d+h),c);return this[n(1377)]})),o}[s(629)](){const t=s;return{id:"layerRange",operationName:this[t(875)],imageFileId:this._imageFileId,layerId:this[t(998)],range:this[t(1377)],undoData:Array[t(2324)](this[t(1846)]),redoData:Array[t(2324)](this[t(580)])}}static[s(2099)](t){const e=s;return new o(t.operationName,t.range,t[e(1568)],t[e(2292)],new Uint8Array(t[e(513)]),new Uint8Array(t[e(1825)]))}}},1375:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{C:()=>n});class n{constructor(t,e,i,s,n,o,r,a){const h=a2_0x27c6;this[h(875)]=t,this[h(1448)]=e,this[h(956)]=i,this[h(2277)]=s,this[h(998)]=n,this[h(2184)]=o,this._width=r,this[h(1494)]=a,this.type=h(715),this[h(1021)]=h(1035),this.pixelCount=this[h(816)]*this[h(1494)]}async undo(t){const e=a2_0x27c6,i=await t[e(1425)](this[e(2277)],this[e(998)]);if(!i)throw new Error(e(1191)+this[e(998)]);const s=await t.getTempLayer(this[e(2277)],this._layerId,this[e(2184)]);if(!s)throw new Error(e(600)+this._layerId);return s.stepState[e(1163)](),s[e(2098)].offsetX=s[e(2333)][e(1263)],s[e(2098)][e(1473)]=s[e(2333)][e(1473)],s[e(2098)].flipX=s[e(2333)][e(1206)],s[e(2098)].flipY=s[e(2333)][e(704)],i.temporaryLayer=void 0,await i[e(1871)]((async(t,i,n)=>{const o=e,r=await s[o(888)][o(1882)].readyPromise,a=this[o(1648)](s);return await this[o(1448)][o(2314)]("putImage",{targetImage:{data:t,width:i,height:n},putImage:{data:r[o(1253)],width:r[o(2164)],height:r.height},putRange:a,replacedImage:void 0,blend:o(2048)}),a})),s[e(1481)](),i}async redo(t){const e=a2_0x27c6,i=await t[e(1425)](this._imageFileId,this._layerId);if(!i)throw new Error("Could not find layer "+this._layerId);const s=await t.getTempLayer(this[e(2277)],this[e(998)],this._tempLayerId);if(!s)throw new Error("Could not find temp layer "+this[e(998)]);return s.stepState[e(585)](this[e(956)]),s[e(2098)].offsetX=this[e(956)][e(1263)],s[e(2098)][e(1473)]=this[e(956)].offsetY,s[e(2098)].flipX=this[e(956)][e(1206)],s.currentState.flipY=this[e(956)][e(704)],i[e(625)]=s,await i.edit((async(t,i,n)=>{const o=e,r=this[o(1648)](s);return await this[o(1448)][o(2314)]("eraseRange",{targetImage:{data:t,width:i,height:n},range:r}),r})),s[e(1324)](),i}[s(1648)](t){const e=s;return{left:t[e(2333)][e(1263)],top:t[e(2333)][e(1473)],right:t.initialState[e(1263)]+t[e(888)][e(1882)][e(2077)][e(2164)],bottom:t.initialState[e(1473)]+t.staticState[e(1882)][e(2077)][e(918)]}}[s(629)](){const t=s;return{id:t(581),operationName:this[t(875)],imageFileId:this[t(2277)],layerId:this[t(998)],tempLayerId:this._tempLayerId,stepState:this._stepState,width:this[t(816)],height:this[t(1494)]}}static[s(2099)](t,e){const i=s;return new n(e.operationName,t,e[i(1834)],e.imageFileId,e.layerId,e[i(1876)],e[i(2164)],e[i(918)])}}},8549:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{i:()=>n});class n{constructor(t,e,i,s,n,o){const r=a2_0x27c6;this[r(875)]=t,this[r(1021)]=e,this[r(956)]=i,this._imageFileId=s,this[r(998)]=n,this._tempLayerId=o,this.type=r(715),this[r(1832)]=0}async[s(1921)](t){const e=s,i=await t[e(1425)](this[e(2277)],this[e(998)]);if(!i)throw new Error("Could not find layer "+this[e(998)]);const n=await t[e(1319)](this._imageFileId,this._layerId,this[e(2184)]);if(!n)throw new Error("Could not find temp layer "+this[e(998)]);return n.stepState[e(1163)](),this[e(1498)](n,n[e(2333)]),i[e(625)]=void 0,n[e(1481)](),i}async[s(1913)](t){const e=s,i=await t[e(1425)](this[e(2277)],this[e(998)]);if(!i)throw new Error("Could not find layer "+this._layerId);const n=await t.getTempLayer(this[e(2277)],this[e(998)],this[e(2184)]);if(!n)throw new Error("Could not find temp layer "+this[e(998)]);return n[e(1834)].push(this._stepState),this._apply(n,this._stepState),await i[e(2167)](n,!1),n[e(1324)](),i}[s(1498)](t,e){const i=s;Object[i(799)](t[i(2098)],e),t[i(1471)]()}serialize(){const t=s;return{id:t(592),requiresTool:this[t(1021)],operationName:this[t(875)],imageFileId:this[t(2277)],layerId:this[t(998)],tempLayerId:this[t(2184)],stepState:this[t(956)]}}static create(t){const e=s;return new n(t[e(875)],t[e(1021)],t[e(1834)],t[e(1568)],t[e(2292)],t[e(1876)])}}},3491:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{M:()=>h,w:()=>c});var n=i(1815),o=i(5120),r=i(7605);let a=0;function h(t){a=Math.max(a,t)}class c extends o.JT{constructor(t,e){const i=a2_0x27c6;super(),this._parentLayer=e,this._onCommit=this[i(1502)](new n.v),this[i(698)]=this[i(1814)][i(1362)],this[i(1705)]=this[i(1502)](new n.v),this[i(1818)]=this._onRequestRender[i(1362)],this[i(959)]=this[i(1502)](new n.v),this[i(1932)]=this[i(959)][i(1362)],this._onHistoryAction=this.register(new n.v),this.onHistoryAction=this._onHistoryAction.event,t?(this.id=t,h(t)):this.id=++a}triggerRequestRender(){const t=a2_0x27c6;this[t(1705)][t(1457)]()}[s(1324)](){const t=s;this[t(2239)][t(1457)]()}[s(1481)](){const t=s;this._onHistoryUnset[t(1457)]()}canSerialize(t){const e=s;if(-1!==t&&this[e(2205)][e(2164)]*this._parentLayer[e(918)]>t)return e(1661)+this[e(2205)][e(2164)]*this[e(2205)][e(918)]+e(890)+t+")"}[s(629)](){const t=s;return{id:this.id,parentLayerId:this._parentLayer.id,type:this.type,staticState:(0,r.t)(this.staticState),initialState:(0,r.t)(this[t(2333)]),currentState:(0,r.t)(this[t(2098)]),stepState:this[t(1834)][t(928)]((t=>(0,r.t)(t)))}}}},9199:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{r:()=>a});var n=i(4852),o=i(8549),r=i(3491);class a extends r.w{constructor(t,e,i,s){const n=a2_0x27c6;super(i,t),this[n(2260)]=e,this.stepState=s}get imageTexture(){}get[s(2330)](){}step(t,e=!1){const i=s,r=this[i(920)](this[i(2098)]);if(this.stepState[i(1807)]>0){let s=!1;if(e){const e=this._historyService.entries[this[i(2260)][i(605)][i(1807)]-1];e[i(875)]===t&&(e[i(1834)]=r,this[i(1834)][this.stepState[i(1807)]-1]=r,s=!0)}!s&&(this[i(2260)][i(1091)](new n.S(t,this[i(1021)],r,this[i(2205)][i(1568)],this[i(2205)].id,this.id)),this.stepState[i(585)](r))}else this._historyService.addEntry(this._startHistoryEntryCtor?new(this[i(1589)])(this._startHistoryEntryOperationName,r,this[i(2205)][i(1568)],this[i(2205)].id,this.id):new o.i(this[i(1789)],this[i(1021)],r,this[i(2205)][i(1568)],this[i(2205)].id,this.id)),this[i(1834)][i(585)](r);this[i(1705)][i(1457)]()}async[s(2114)](){const t=s;await this[t(2260)][t(1384)](this[t(2123)],(async()=>{const e=t;this[e(2260)].addEntry(new(this[e(1080)])(this._finishHistoryEntryOperationName,this[e(2205)][e(1568)],this[e(2205)].id,this.id)),await this[e(644)]()})),this[t(1814)][t(1457)]()}}},2811:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{B:()=>l});var n=i(116),o=i(1003),r=i(7605),a=i(6495),h=i(8286),c=i(9199);class l extends c.r{constructor(t,e,i,s,n,o,r,a=[]){const c=a2_0x27c6;super(t,s,r,a),this.staticState=e,this.initialState=i,this._selectionService=n,this._taskWorkerService=o,this[c(544)]=c(1898),this[c(1021)]="line",this[c(1080)]=h.Z,this._startHistoryEntryOperationName=c(2305),this[c(2123)]="Finish Line",this[c(2098)]=this[c(920)](a[c(1807)]?a[a[c(1807)]-1]:this[c(2333)]),this[c(1997)]((()=>this._updateTextureIfNeeded())),a[c(1807)]>0&&this._updateTextureIfNeeded()}get[s(2330)](){return this._imageTextureRange}get[s(1220)](){return this[s(601)]}[s(882)](t,e=!1){super[s(882)](t,e),this._updateTextureIfNeeded()}async[s(2274)](){const t=s,{image:e,resolve:i,reject:r}=(0,n.W)(this[t(2205)][t(2164)],this._parentLayer[t(918)]);this[t(601)]=e,this[t(1009)]=(0,o.DI)(this[t(2205)][t(2164)],this[t(2205)].height);const a=this[t(2098)];try{await this[t(1448)].runTask(t(913),{targetImage:e.resource,color:this[t(888)][t(1221)]?a[t(1895)]:a.primaryColor,pointA:a.pointA,pointB:a[t(1363)],strokeWidth:a[t(887)],smoothing:a[t(1869)],blendMode:a[t(1636)],selection:this[t(2021)][t(1377)]}),e[t(1977)]=!0,i(e.resource),this[t(1705)].fire()}catch(i){this._imageTexture===e&&(this[t(601)]=void 0),r(i)}}async[s(644)](){const t=s;if(this[t(601)]){const e=await this[t(601)].readyPromise,i=(0,o.DI)(e[t(2164)],e[t(918)]);await this[t(2260)].runAction(new a.Z(this._finishHistoryEntryOperationName,i,this[t(2205)],(async(e,i,s)=>{const n=t;await this[n(1182)](e,i,s)})))}}async[s(1182)](t,e,i){const n=s;if(this[n(601)]){const s=await this._imageTexture[n(2006)],r=(0,o.DI)(s[n(2164)],s.height);await this._taskWorkerService[n(2314)](n(2221),{blend:this.currentState.blendMode,targetImage:{data:t,width:e,height:i},putImage:s,putRange:r,replacedImage:void 0})}}[s(920)](t){const e=s;return{pointA:{...t[e(1449)]},pointB:{...t[e(1363)]},primaryColor:t[e(1083)],secondaryColor:t.secondaryColor,blendMode:t[e(1636)],strokeWidth:t[e(887)],smoothing:t[e(1869)]}}static[s(2099)](t,e,i,s,n){return new l(e,(0,r.e)(t.staticState),(0,r.e)(t.initialState),i,s,n,t.id,t.stepState.map((t=>(0,r.e)(t))))}}},270:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{m:()=>l});var n=i(1003),o=i(7605),r=i(4852),a=i(6628),h=i(1375),c=i(3491);class l extends c.w{constructor(t,e,i,s,o,r,a,h=[]){const c=a2_0x27c6;super(a,t),this[c(888)]=e,this[c(2260)]=s,this[c(2021)]=o,this[c(1448)]=r,this[c(1834)]=h,this.type=c(2252),this[c(2333)]=typeof i===c(1804)?i:{offsetX:e[c(1377)][c(2061)],offsetY:e[c(1377)][c(800)],flipX:!1,flipY:!1,scaledWidth:(0,n.Oq)(e[c(1377)]),scaledHeight:(0,n.rY)(e[c(1377)]),quality:typeof i===c(2008)?i:c(1802)},this.currentState={...h?.length?h[h[c(1807)]-1]:this[c(2333)]},this[c(1997)]((()=>this._updatePreviewIfNeeded())),h[c(1807)]>0&&this._updatePreviewIfNeeded(),this.staticState[c(1882)][c(2006)][c(653)]((()=>this[c(1705)][c(1457)]()))}get data(){const t=a2_0x27c6;return this[t(888)][t(1882)].resource[t(1253)]}get[s(2164)](){const t=s;return this[t(888)][t(1882)].resource[t(2164)]}get[s(918)](){const t=s;return this[t(888)][t(1882)][t(2077)].height}[s(1842)](t){const e=s;this[e(2098)].offsetX===t[e(2061)]&&this.currentState[e(1473)]===t[e(800)]&&this[e(2098)][e(1785)]===(0,n.Oq)(t)&&this[e(2098)][e(873)]===(0,n.rY)(t)||(this.currentState.offsetX=t[e(2061)],this.currentState[e(1473)]=t[e(800)],this.currentState[e(1785)]=(0,n.Oq)(t),this[e(2098)][e(873)]=(0,n.rY)(t),this[e(1705)][e(1457)]())}moveStep(){const t=s,e={...this[t(2098)]};this.stepState[t(1807)]>0?this[t(2260)][t(1091)](new r.S(t(1733),t(1035),e,this[t(2205)][t(1568)],this[t(2205)].id,this.id)):this[t(2260)][t(1091)](new h.C(t(1138),this[t(1448)],e,this[t(2205)].imageFileId,this._parentLayer.id,this.id,this[t(888)].image[t(2077)][t(2164)],this[t(888)][t(1882)].resource[t(918)])),this[t(2058)](),this[t(1834)].push(e),this[t(1705)][t(1457)]()}[s(1550)](t){const e=s,i={...this.currentState};this[e(2260)][e(1091)](new r.S(t,"movePixels",i,this[e(2205)][e(1568)],this[e(2205)].id,this.id)),this[e(2058)](),this.stepState.push(i),this[e(1705)][e(1457)]()}[s(2058)](){const t=s,e=this[t(1995)]?.[t(2077)][t(2164)]||this[t(888)][t(1882)][t(2077)][t(2164)],i=this.scaledImage?.[t(2077)][t(918)]||this[t(888)][t(1882)].resource[t(918)];if(e===this[t(2098)][t(1785)]&&i===this.currentState[t(873)]&&this[t(2201)]===this[t(2098)][t(1625)])return;if(this[t(2201)]=this[t(2098)][t(1625)],this.currentState[t(1785)]===this.staticState.image[t(2077)][t(2164)]&&this[t(2098)][t(873)]===this[t(888)][t(1882)].resource[t(918)])return this[t(1995)]=this.staticState[t(1882)],void this[t(1705)][t(1457)]();let n;const o=new Promise((t=>n=t)),r={width:this.currentState[t(1785)],height:this[t(2098)][t(873)],data:new Uint8Array(0)};this[t(1995)]={isReady:!1,readyPromise:o,resource:r},this[t(888)][t(1882)][t(2006)].then((async e=>{const i=t,s=await this[i(1448)][i(1824)](i(595),{width:this[i(2098)].scaledWidth,height:this[i(2098)][i(873)],resampling:this[i(2098)][i(1625)]},e,void 0)[i(973)];r.data=s.dest[i(1253)],this[i(1995)]&&(this[i(1995)][i(1977)]=!0),n(r),this[i(1705)].fire()}))}async[s(2114)](){const t=s,e=await(this.scaledImage?.[t(2006)]||this[t(888)][t(1882)][t(2006)]),i=Math[t(1445)](this[t(2098)][t(1263)],0),n=Math.max(this.currentState[t(1473)],0),o=Math[t(2338)](this[t(2098)].offsetX+this[t(2098)][t(1785)],this[t(2205)][t(2164)]),r=Math[t(2338)](this.currentState.offsetY+this[t(2098)].scaledHeight,this._parentLayer.height),h=o-i,c=r-n,l={width:h,height:c,data:new Uint8Array(new SharedArrayBuffer(h*c*4))},d={left:this[t(2098)].offsetX,top:this[t(2098)][t(1473)],right:this[t(2098)][t(1263)]+this.currentState[t(1785)],bottom:this[t(2098)].offsetY+this[t(2098)][t(873)]};await this[t(2205)][t(1871)]((async(i,s,n)=>{const o=t;return await this[o(1448)][o(2314)](o(2221),{putRange:d,targetImage:{data:i,width:s,height:n},putImage:e,replacedImage:l,blend:o(2048),flipX:this.currentState[o(1206)],flipY:this[o(2098)][o(704)]}),d})),this[t(2260)][t(1091)](new a.$(t(673),this[t(1448)],d,{left:i,top:n,right:o,bottom:r},this[t(2205)][t(1568)],this[t(2205)].id,this.id,l)),this[t(1814)].fire()}static[s(2099)](t,e,i,n,r){const a=s;return new l(e,(0,o.e)(t.staticState),(0,o.e)(t[a(2333)]),i,n,r,t.id,t[a(1834)][a(928)]((t=>(0,o.e)(t))))}}},807:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{F:()=>l});var n=i(7517),o=i(1003),r=i(7605),a=i(6495),h=i(3817),c=i(9199);class l extends c.r{constructor(t,e,i,s,n,o,r,a=[]){const c=a2_0x27c6;super(t,s,r,a),this.staticState=e,this[c(2333)]=i,this[c(2021)]=n,this._taskWorkerService=o,this[c(544)]="rectangle",this[c(1021)]="rectangle",this[c(1080)]=h.O,this[c(1789)]=c(1486),this[c(2123)]=c(1137),this[c(2098)]=this[c(920)](a.length?a[a[c(1807)]-1]:this[c(2333)])}async[s(644)](){const t=s;await this[t(2260)].runAction(new a.Z(this[t(2123)],this.currentState.range,this[t(2205)],(async(e,i,s)=>{this[t(1182)](e,i,s)})))}async applyCommit(t,e,i){const n=s,r=this.currentState[n(1377)],a=this[n(2098)][n(1636)],h=this[n(778)]();if((0,o.U6)(r)>25e4){const s=[];for(const o of h)for(const r of o.ranges)s[n(585)](this._taskWorkerService[n(2314)](n(1285),{targetImage:{data:t,width:e,height:i},range:r,color:new Uint8Array(o[n(1968)]),blendMode:a}));await Promise.all(s)}else for(const i of h)for(const s of i[n(1167)])this[n(1169)](t,e,s,i[n(1968)],a)}_cloneState(t){const e=s;return{primaryColor:t[e(1083)],secondaryColor:t.secondaryColor,blendMode:t[e(1636)],range:(0,o.BN)(t[e(1377)]),outlineSize:t[e(845)],style:t[e(1033)]}}_fillRange(t,e,i,o,r){for(let a=i[s(800)];a<i.bottom;a++)for(let s=i.left;s<i.right;s++)(0,n.B)(r,t,4*(a*e+s),o,0)}[s(778)](){const t=s,e=[],i=this[t(2098)],n=this[t(888)][t(1221)]?i[t(1895)]:i[t(1083)],r=this[t(888)][t(1221)]?i.primaryColor:i[t(1895)],a=2===i[t(1033)]?n:r,h=2===i[t(1033)]?r:n,c=this[t(2021)][t(1377)]||(0,o.DI)(this[t(2205)][t(2164)],this[t(2205)][t(918)]),l=(0,o.l$)({left:i[t(1377)].left,right:i[t(1377)][t(511)],top:i[t(1377)][t(800)],bottom:Math[t(2338)](i.range.top+i[t(845)],i[t(1377)].bottom)},c),d=(0,o.l$)({left:i[t(1377)][t(2061)],right:i[t(1377)][t(511)],top:Math.max(l.bottom,i[t(1377)].bottom-i.outlineSize),bottom:i[t(1377)][t(2364)]},c),u=(0,o.l$)({left:i[t(1377)][t(2061)],right:i[t(1377)][t(2061)]+i.outlineSize,top:l.bottom,bottom:d[t(800)]},c),m=(0,o.l$)({left:Math[t(1445)](u[t(511)],i[t(1377)][t(511)]-i[t(845)]),right:i[t(1377)][t(511)],top:l[t(2364)],bottom:d[t(800)]},c);return 2!==i.style&&e.push({ranges:[l,d,u,m],color:h}),3===i.style?e.push({ranges:[{left:u[t(511)],right:m[t(2061)],top:l.bottom,bottom:d[t(800)]}],color:a}):2===i.style&&e[t(585)]({ranges:[{left:u[t(2061)],right:m[t(511)],top:l[t(800)],bottom:d[t(2364)]}],color:a}),e}static[s(2099)](t,e,i,n,o){const a=s;return new l(e,(0,r.e)(t[a(888)]),(0,r.e)(t[a(2333)]),i,n,o,t.id,t[a(1834)].map((t=>(0,r.e)(t))))}}},3670:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{n:()=>l});var n=i(116),o=i(1003),r=i(7605),a=i(6495),h=i(3089),c=i(9199);class l extends c.r{constructor(t,e,i,s,n,o,r,a=[]){const c=a2_0x27c6;super(t,s,r,a),this[c(888)]=e,this[c(2333)]=i,this._selectionService=n,this._taskWorkerService=o,this[c(544)]=c(2169),this[c(1021)]="shape",this[c(1080)]=h.o,this[c(1789)]=c(2025),this[c(2123)]=c(1096),this.currentState=this[c(920)](a[c(1807)]?a[a[c(1807)]-1]:this[c(2333)]),this[c(1997)]((()=>this[c(2274)]())),a[c(1807)]>0&&this[c(2274)]()}get[s(2330)](){return this._imageTextureRange}get imageTexture(){return this[s(601)]}[s(882)](t,e=!1){const i=s;super[i(882)](t,e),this[i(2274)]()}async[s(2274)](){const t=s,e=this[t(2098)];(!this._imageTextureRange||!(0,o.ap)(this._imageTextureRange,e[t(1377)]))&&(this[t(1009)]=(0,o.kq)((0,o.BN)(e[t(1377)])));const{image:i,resolve:r,reject:a}=(0,n.W)((0,o.Oq)(this[t(1009)]),(0,o.rY)(this[t(1009)]));this[t(601)]=i;try{await this._taskWorkerService[t(2314)](t(2222),{targetImage:i[t(2077)],primaryColor:this[t(888)].invertColors?e[t(1895)]:e.primaryColor,secondaryColor:this[t(888)][t(1221)]?e[t(1083)]:e[t(1895)],dimensions:e[t(1377)],type:e.type,strokeWidth:this.currentState[t(845)],smoothing:e[t(1869)],style:e[t(1033)],blendMode:e[t(1636)],selection:this[t(2021)][t(1377)],flipX:e.flipX,flipY:e[t(704)]}),i[t(1977)]=!0,r(i[t(2077)]),this[t(1705)][t(1457)]()}catch(e){this[t(601)]===i&&(this._imageTexture=void 0),a(e)}}async[s(644)](){const t=s;this._imageTexture&&this[t(1009)]&&(await this[t(601)].readyPromise,await this[t(2260)][t(1262)](new a.Z(this[t(2123)],this[t(1009)],this._parentLayer,(async(e,i,s)=>{const n=t;await this[n(1182)](e,i,s)}))))}async applyCommit(t,e,i){const n=s;if(!this[n(601)]||!this[n(1009)])return;const o=await this._imageTexture[n(2006)];await this[n(1448)].runTask("putImage",{blend:this.currentState[n(1636)],targetImage:{data:t,width:e,height:i},putImage:o,putRange:this[n(1009)],replacedImage:void 0})}_cloneState(t){const e=s;return{primaryColor:t[e(1083)],secondaryColor:t.secondaryColor,blendMode:t[e(1636)],range:(0,o.BN)(t[e(1377)]),outlineSize:t[e(845)],style:t[e(1033)],smoothing:t[e(1869)],type:t[e(544)],flipX:t[e(1206)],flipY:t[e(704)]}}static[s(2099)](t,e,i,n,o){const a=s;return new l(e,(0,r.e)(t.staticState),(0,r.e)(t.initialState),i,n,o,t.id,t.stepState[a(928)]((t=>(0,r.e)(t))))}}},7233:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{o:()=>l});var n=i(116),o=i(1003),r=i(7605),a=i(6495),h=i(707),c=i(9199);class l extends c.r{constructor(t,e,i,s,n,o,r,a=[]){const c=a2_0x27c6;super(t,s,r,a),this[c(888)]=e,this.initialState=i,this[c(2021)]=n,this[c(1448)]=o,this.type="text",this[c(1021)]=c(1386),this[c(1080)]=h.o,this._startHistoryEntryOperationName=c(963),this._finishHistoryEntryOperationName=c(1265),this[c(2098)]=this[c(920)](a.length?a[a[c(1807)]-1]:this[c(2333)]),this[c(1997)]((()=>this.updateTextureIfNeeded())),(a[c(1807)]>0||i[c(1386)][c(1807)]>0)&&this[c(1160)]()}get[s(2330)](){return this[s(1009)]}get[s(1220)](){return this._imageTexture}[s(882)](t,e=!1){const i=s;super[i(882)](t,e),this[i(1160)]()}async[s(1160)](){const t=s,{image:e,resolve:i,reject:r}=(0,n.W)(this[t(2205)][t(2164)],this[t(2205)][t(918)]);this[t(601)]=e,this[t(1009)]=(0,o.DI)(this[t(2205)][t(2164)],this._parentLayer[t(918)]);const a=this[t(2098)];try{await this._taskWorkerService[t(2314)](t(1478),{targetImage:e[t(2077)],primaryColor:this[t(888)][t(1221)]?a[t(1895)]:a[t(1083)],secondaryColor:this[t(888)][t(1221)]?a[t(1083)]:a[t(1895)],dimensions:a[t(1377)],blendMode:a[t(1636)],selection:this[t(2021)][t(1377)],text:a[t(1386)],isBold:a[t(1861)],isItalic:a[t(1307)],fontSize:a[t(1208)],fontFamily:a.fontFamily,alignment:a.alignment,verticalAlignment:a.verticalAlignment}),e[t(1977)]=!0,i(e[t(2077)]),this[t(1705)].fire()}catch(i){this[t(601)]===e&&(this[t(601)]=void 0,this[t(1705)][t(1457)]()),r(i)}}async _applyCommit(){const t=s;if(this[t(601)]){const e=await this[t(601)].readyPromise,i=(0,o.DI)(e[t(2164)],e.height);await this[t(2260)][t(1262)](new a.Z(this[t(2123)],i,this[t(2205)],(async(e,i,s)=>{const n=t;await this[n(1182)](e,i,s)})))}}async[s(1182)](t,e,i){const n=s;if(this._imageTexture){const s=await this._imageTexture.readyPromise,r=(0,o.DI)(s[n(2164)],s[n(918)]);await this[n(1448)][n(2314)](n(2221),{blend:this[n(2098)][n(1636)],targetImage:{data:t,width:e,height:i},putImage:s,putRange:r,replacedImage:void 0})}}[s(920)](t){const e=s;return{primaryColor:t[e(1083)],secondaryColor:t[e(1895)],blendMode:t.blendMode,range:(0,o.BN)(t[e(1377)]),text:t[e(1386)],isBold:t[e(1861)],isItalic:t[e(1307)],fontSize:t[e(1208)],fontFamily:t[e(2360)],alignment:t[e(2238)],verticalAlignment:t[e(1760)]}}static[s(2099)](t,e,i,n,o){const a=s;return new l(e,(0,r.e)(t[a(888)]),(0,r.e)(t[a(2333)]),i,n,o,t.id,t[a(1834)][a(928)]((t=>(0,r.e)(t))))}}},1038:(t,e,i)=>{const s=a2_0x27c6;var n={"./renderers/moveImageRangeRenderer.js":[504,504],"./tools/colorPicker.js":[6471,471],"./tools/crop.js":[3976,976],"./tools/eraser.js":[2996,996],"./tools/fill.js":[7643,643],"./tools/hand.js":[2333,333],"./tools/line.js":[2844,844],"./tools/movePixels.js":[687,687],"./tools/moveSelection.js":[403,403],"./tools/pencil.js":[5525,525],"./tools/rectangle.js":[7440,440],"./tools/selection.js":[3040,40],"./tools/shape.js":[9113,113],"./tools/text.js":[8488,488],"./tools/zoom.js":[7710,710]};function o(t){const e=a2_0x27c6;if(!i.o(n,t))return Promise[e(542)]().then((()=>{const i=e;var s=new Error(i(1321)+t+"'");throw s[i(1266)]=i(838),s}));var s=n[t],o=s[0];return i.e(s[1]).then((()=>i(o)))}o.keys=()=>Object[s(1742)](n),o.id=1038,t.exports=o},4371:(t,e,i)=>{"use strict";const s=a2_0x27c6;function n(t,e=2*t[s(1807)]){const i=s;let n;if(t instanceof Float32Array)n=new Float32Array(e);else if(t instanceof Uint8Array)n=new Uint8Array(e);else if(t instanceof Uint16Array)n=new Uint16Array(e);else{if(!(t instanceof Uint32Array))throw new Error(i(1005));n=new Uint32Array(e)}return n[i(917)](t),n}function o(t,e,i=!1){const n=s;return e<Math.pow(2,8)?i?new Uint8Array(new SharedArrayBuffer(t)):new Uint8Array(t):e<Math[n(1364)](2,16)?i?new Uint16Array(new SharedArrayBuffer(2*t)):new Uint16Array(t):i?new Uint32Array(new SharedArrayBuffer(4*t)):new Uint32Array(t)}function r(t){const e=s;if(window[e(760)]&&!(t[e(1523)]instanceof SharedArrayBuffer)){const i=new Uint8Array(new SharedArrayBuffer(t[e(1807)]));i[e(917)](t),t=i}return t}function a(t,e,i,s){t[e]=i[s],t[e+1]=i[s+1],t[e+2]=i[s+2],t[e+3]=i[s+3]}function h(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array}i.d(e,{Rs:()=>n,X$:()=>o,pZ:()=>r,Yr:()=>a,fU:()=>h})},7517:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{B:()=>h});var n=i(4371);const o=new Float32Array(6);let r;const a={normal:(t,e)=>e,darken:(t,e)=>Math[s(2338)](t,e),multiply:(t,e)=>t*e,linearBurn:(t,e)=>Math[s(1445)](t+e-1,0),lighten:(t,e)=>Math[s(1445)](t,e),screen:(t,e)=>1-(1-t)*(1-e),linearDodgeAdd:(t,e)=>Math[s(2338)](t+e,1),overlay:(t,e)=>t<.5?2*t*e:1-2*(1-t)*(1-e),softLight:(t,e)=>e<.5?2*t*e+t*t*(1-2*e):Math.sqrt(t)*(2*e-1)+2*t*(1-e),difference:(t,e)=>Math[s(2091)](t-e),exclusion:(t,e)=>t+e-2*t*e};function h(t,e,i,h,l,d=e,u=i){const m=s;if(t!==m(2048)){if(o[0]=h[l+3]/255,0===o[0])return e[i]=d[u],e[i+1]=d[u+1],e[i+2]=d[u+2],void(e[i+3]=d[u+3]);if(o[1]=d[u+3]/255,0===o[1])return e[i]=h[l],e[i+1]=h[l+1],e[i+2]=h[l+2],void(e[i+3]=h[l+3]);r=a[t],o[3]=r(d[u]/255,h[l]/255),o[4]=r(d[u+1]/255,h[l+1]/255),o[5]=r(d[u+2]/255,h[l+2]/255),o[2]=o[0]+o[1]*(1-o[0]),e[i]=Math[m(2337)](c(d[u]/255,o[1],h[l]/255,o[0],o[3])/o[2]*255),e[i+1]=Math[m(2337)](c(d[u+1]/255,o[1],h[l+1]/255,o[0],o[4])/o[2]*255),e[i+2]=Math[m(2337)](c(d[u+2]/255,o[1],h[l+2]/255,o[0],o[5])/o[2]*255),e[i+3]=Math[m(2337)](255*o[2])}else(0,n.Yr)(e,i,h,l)}function c(t,e,i,s,n){return(e-e*s)*t+(s-e*s)*i+e*s*n}},8752:(t,e,i)=>{"use strict";i.d(e,{WC:()=>h,Uq:()=>c,FK:()=>l,B8:()=>s,m4:()=>n,mC:()=>r});var s,n,o,r,a=i(2939);function h(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function c(t,e){const i=a2_0x27c6;if(t.length!==e[i(1807)]||t.type!==e.type)return!1;for(let s=0;s<t[i(1807)];s++)if(t[s]!==e[s])return!1;return!0}function l(t){const e=a2_0x27c6,i=new Float32Array(t);return i[e(544)]=t[e(544)],i}!function(t){const e=a2_0x27c6;function i(){const t=a2_0x27c6,e=new Float32Array(3);return e[t(544)]=t(996),e}function s(t,e,s){const n=i();return n[0]=t,n[1]=e,n[2]=s,n}t[e(1546)]=i,t[e(1110)]=s,t[e(2019)]=function(t,e,i){return s(t,e,i)},t.toHsv=function(t,i){const s=e,n=t[0]/255,o=t[1]/255,h=t[2]/255,c=Math.max(n,o,h),l=c-Math[s(2338)](n,o,h);let d;d=0===l?0:c===n?(o-h)/l%6:c===o?(h-n)/l+2:(n-o)/l+4,d=Math[s(2337)](60*d),d<0&&(d+=360);const u=(0,a.s)(0===c?0:l/c,2),m=(0,a.s)(c,2);return void 0!==i&&(0===u||0===m)&&(d=i),r[s(2236)](d,u,m)},t[e(797)]=function(t){const i=e,s=o.createEmptyHslColor(),n=t[0]/255,r=t[1]/255,a=t[2]/255,h=Math[i(1445)](n,r,a),c=Math.min(n,r,a),l=h-c,d=(h+c)/2;return s[0]=0===l?0:h===n?(r-a)/l%6:h===r?(a-n)/l+2:(n-r)/l+4,s[0]=Math.round(60*s[0]),s[0]<0&&(s[0]+=360),s[1]=0===l?0:l/(1-Math[i(2091)](2*d-1)),s[2]=d,s},t[e(2331)]=function(t,i){return n[e(1061)](t[0],t[1],t[2],i)}}(s||(s={})),function(t){const e=a2_0x27c6;function i(){const t=a2_0x27c6,e=new Float32Array(4);return e[t(544)]=t(621),e}function n(t,e,s,n=255){const o=i();return o[0]=t,o[1]=e,o[2]=s,o[3]=n,o}t[e(792)]=i,t.createRgbaColor=n,t.createReadonlyRgbaColor=function(t,e,i,s=255){return n(t,e,i,s)},t[e(1583)]=function(t){return s[e(2019)](t[0],t[1],t[2])}}(n||(n={})),function(t){const e=a2_0x27c6;function i(){const t=a2_0x27c6,e=new Float32Array(3);return e[t(544)]="hsl",e}function s(t,e,s){const n=i();return n[0]=t,n[1]=e,n[2]=s,n}t.createEmptyHslColor=i,t[e(1651)]=s,t[e(1793)]=function(t,e,i){return s(t,e,i)},t.toRgb=function(t,i=255){const s=e,n=new Float32Array(4);n[3]=i;const o=(1-Math.abs(2*t[2]-1))*t[1],r=o*(1-Math[s(2091)](t[0]/60%2-1)),a=t[2]-o/2;return t[0]<60?(n[0]=o,n[1]=r,n[2]=0):t[0]<120?(n[0]=r,n[1]=o,n[2]=0):t[0]<180?(n[0]=0,n[1]=o,n[2]=r):t[0]<240?(n[0]=0,n[1]=r,n[2]=o):t[0]<300?(n[0]=r,n[1]=0,n[2]=o):(n[0]=o,n[1]=0,n[2]=r),n[0]=Math.round(255*(n[0]+a)),n[1]=Math[s(2337)](255*(n[1]+a)),n[2]=Math[s(2337)](255*(n[2]+a)),n}}(o||(o={})),function(t){const e=a2_0x27c6;function i(){const t=a2_0x27c6,e=new Float32Array(3);return e.type=t(642),e}function o(t,e,s){const n=i();return n[0]=t,n[1]=e,n[2]=s,n}function r(t){const i=e,n=s[i(1546)](),o=t[2]*t[1],r=o*(1-Math.abs(t[0]/60%2-1)),a=t[2]-o;return t[0]<60?(n[0]=o,n[1]=r,n[2]=0):t[0]<120?(n[0]=r,n[1]=o,n[2]=0):t[0]<180?(n[0]=0,n[1]=o,n[2]=r):t[0]<240?(n[0]=0,n[1]=r,n[2]=o):t[0]<300?(n[0]=r,n[1]=0,n[2]=o):(n[0]=o,n[1]=0,n[2]=r),n[0]=Math[i(2337)](255*(n[0]+a)),n[1]=Math.round(255*(n[1]+a)),n[2]=Math[i(2337)](255*(n[2]+a)),n}t.createEmptyHsvColor=i,t[e(1918)]=o,t[e(2236)]=function(t,e,i){return o(t,e,i)},t[e(1583)]=r,t[e(2331)]=function(t,e=255){const i=r(t);return n.createRgbaColor(i[0],i[1],i[2],(0,a.u)(e,255,0))}}(r||(r={}))},1815:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{v:()=>n,B:()=>o});class n{constructor(t){const e=a2_0x27c6;this[e(1164)]=t,this[e(1050)]=[],this[e(2357)]=!1}get event(){const t=a2_0x27c6;return!this[t(2130)]&&(this._event=e=>{const i=t;return 0===this._listeners.length&&this[i(1164)]&&this[i(1164)][i(672)]&&this[i(1164)][i(672)](),this[i(1050)][i(585)](e),{dispose:()=>{const t=i;if(!this[t(2357)])for(let i=0;i<this._listeners[t(1807)];i++)if(this[t(1050)][i]===e)return this[t(1050)].splice(i,1),void(0===this[t(1050)][t(1807)]&&this[t(1164)]&&this[t(1164)][t(2209)]&&this[t(1164)][t(2209)]())}}}),this[t(2130)]}[s(1457)](t,e){const i=s,n=[];for(let t=0;t<this._listeners[i(1807)];t++)n.push(this[i(1050)][t]);for(let s=0;s<n[i(1807)];s++)n[s][i(1355)](void 0,t,e)}async[s(1671)](t,e){const i=s,n=[];for(let t=0;t<this[i(1050)][i(1807)];t++)n[i(585)](this[i(1050)][t]);for(let s=0;s<n[i(1807)];s++)await n[s][i(1355)](void 0,t,e)}[s(1800)](){const t=s;this[t(1050)]&&(this[t(1050)][t(1807)]=0),this[t(2357)]=!0}}function o(t,e){return t(((t,i)=>e.fire(t,i)))}},7166:(t,e,i)=>{"use strict";i.d(e,{uF:()=>n,Qf:()=>o,M_:()=>r});var s=i(1003);function n(t,e){const i=a2_0x27c6,s=typeof t===i(711)?t:t[i(2164)];return e=typeof t===i(711)?e:t[i(918)],{data:new Uint8Array(new(i(760)in window?SharedArrayBuffer:ArrayBuffer)(s*e*4)),width:s,height:e}}function o(t,e){const i=a2_0x27c6,n=(0,s.Oq)(e),o=(0,s.rY)(e),r=new Uint8Array(n*o*4);let a=0,h=0;for(let s=0;s<o;s++)h=s+e[i(800)],a=4*(h*t[i(2164)]+e[i(2061)]),r[i(917)](t[i(1253)][i(717)](a,a+4*n),s*n*4);return r}function r(t,e,i,s,n=!0){const o=a2_0x27c6;if(!n&&e<s&&t<i)return{left:Math[o(2337)]((i-t)/2),top:Math[o(2337)]((s-e)/2),width:t,height:e};const r={left:0,top:0,width:i,height:s};if(e>t){const s=t/e;r[o(2061)]=Math[o(2337)](i*(.5-s/2)),r[o(2164)]=Math[o(2337)](i*s)}else if(t>e){const i=e/t;r.top=Math[o(2337)](s*(.5-i/2)),r[o(918)]=Math[o(2337)](s*i)}return r}},5120:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{JT:()=>o,OF:()=>r,_c:()=>a,Lw:()=>h});var n=i(1815);class o{constructor(){const t=a2_0x27c6;this[t(2261)]=[],this[t(1485)]=!1,this[t(1960)]=this.register(new n.v),this.onDispose=this[t(1960)].event}[s(1800)](){const t=s;if(this._isDisposed)throw new Error(t(1592));this[t(1960)].fire(),this[t(1485)]=!0;for(const e of this[t(2261)])e[t(1800)]();this[t(2261)][t(1807)]=0}[s(1502)](t){const e=s;return this[e(2261)][e(585)](t),t}[s(1131)](t){const e=s,i=this[e(2261)].indexOf(t);-1!==i&&this[e(2261)][e(1560)](i,1)}}function r(t){return{dispose:t}}function a(t){const e=s;if(t){for(const i of t)i[e(1800)]();t.length=0}}function h(t,e,i,n){const o=s;t[o(2062)](e,i);let r=!1;return{dispose:()=>{r||(r=!0,t[o(1600)](e,i,n))}}}},2939:(t,e,i)=>{"use strict";function s(t,e,i=0){return Math[a2_0x27c6(1445)](Math.min(t,e),i)}function n(t,e){const i=Math.pow(10,e);return Math.round(t*i)/i}i.d(e,{u:()=>s,s:()=>n})},116:(t,e,i)=>{"use strict";i.d(e,{d:()=>n,W:()=>o});var s=i(7166);function n(t){return"object"==typeof t&&"readyPromise"in t?t:{resource:t,readyPromise:Promise[a2_0x27c6(542)](t),isReady:!0}}function o(t,e){let i,n;const o=new Promise(((t,e)=>{i=t,n=e})),r=(0,s.uF)(t,e);return{image:{isReady:!1,readyPromise:o,resource:r},resource:r,resolve:i,reject:n}}},7896:(t,e,i)=>{"use strict";const s=a2_0x27c6;i.d(e,{V5:()=>n,jn:()=>o});const n=[s(945),"MacIntel",s(1369),s(723)].includes(navigator[s(1726)]),o=([s(1059),"Win16",s(2151),s(1358)][s(602)](navigator.platform),window[s(1405)][s(2085)]===s(1345))},1003:(t,e,i)=>{"use strict";function s(t){const e=a2_0x27c6;if(t)return{left:t[e(2061)],top:t.top,right:t.right,bottom:t[e(2364)]}}function n(){return{left:-1,top:-1,right:-1,bottom:-1}}function o(t,e){return{left:t,top:e,right:t+1,bottom:e+1}}function r(t,e){return{left:0,top:0,right:t,bottom:e}}function a(t,e,i,s){const n=a2_0x27c6,o=y({left:t,top:e,right:i,bottom:s});return o.right++,o[n(2364)]++,o}function h(t,e){const i=a2_0x27c6;return c(t)?s(e):c(e)?s(t):{left:Math.min(t.left,e.left),top:Math.min(t.top,e.top),right:Math[i(1445)](t[i(511)],e[i(511)]),bottom:Math[i(1445)](t[i(2364)],e[i(2364)])}}function c(t){const e=a2_0x27c6;return t.left===t[e(511)]||t[e(800)]===t[e(2364)]}function l(t,e){const i=a2_0x27c6;return t[i(2061)]=Math.min(Math[i(1445)](t.left,e[i(2061)]),e.right),t[i(800)]=Math[i(2338)](Math[i(1445)](t[i(800)],e.top),e.bottom),t[i(511)]=Math[i(1445)](Math[i(2338)](t.right,e[i(511)]),e[i(2061)]),t.bottom=Math[i(1445)](Math[i(2338)](t[i(2364)],e[i(2364)]),e.top),t}function d(t){const e=a2_0x27c6;return t[e(2061)]=Math[e(1870)](t[e(2061)]),t[e(511)]=Math[e(1267)](t.right),t[e(800)]=Math[e(1870)](t[e(800)]),t[e(2364)]=Math[e(1267)](t.bottom),t}function u(t,e,i){const s=a2_0x27c6,n=e-t.left,o=i-t[s(800)];t.left=t.left+n,t.right=t[s(511)]+n,t[s(800)]=t[s(800)]+o,t.bottom=t[s(2364)]+o}function m(t,e,i){const s=a2_0x27c6;if(c(t))return t[s(2061)]=e,t.right=e+1,t.top=i,void(t.bottom=i+1);t.left=Math.min(t[s(2061)],e),t.top=Math[s(2338)](t[s(800)],i),t.right=Math[s(1445)](t[s(511)],e+1),t.bottom=Math[s(1445)](t.bottom,i+1)}function g(t,e){const i=a2_0x27c6;return t[i(2061)]===e[i(2061)]&&t[i(800)]===e[i(800)]&&t[i(511)]===e.right&&t.bottom===e[i(2364)]}function f(t,e,i){const s=a2_0x27c6;return e>=t.left&&e<t[s(511)]&&i>=t[s(800)]&&i<t.bottom}function p(t,e){const i=a2_0x27c6;return e[i(2061)]>=t[i(2061)]&&e[i(511)]<=t.right&&e[i(800)]>=t[i(800)]&&e.bottom<=t[i(2364)]}function _(t,e){const i=a2_0x27c6;return!(t[i(2364)]<e.top||t[i(800)]>e[i(2364)]||t.right<e.left||t[i(2061)]>e.right)}function y(t){const e=a2_0x27c6;if(t[e(2061)]>t[e(511)]){const i=t[e(511)];t[e(511)]=t[e(2061)],t[e(2061)]=i}if(t.top>t[e(2364)]){const i=t[e(2364)];t[e(2364)]=t[e(800)],t[e(800)]=i}if(t[e(511)]<t[e(2061)]){const i=t[e(2061)];t.left=t[e(511)],t.right=i}if(t.bottom<t[e(800)]){const i=t[e(800)];t[e(800)]=t[e(2364)],t.bottom=i}return t}function w(t){const e=a2_0x27c6;return(t.right-t[e(2061)])*(t[e(2364)]-t[e(800)])}function v(t){const e=a2_0x27c6;return(t[e(511)]-t[e(2061)])/(t[e(2364)]-t.top)}function b(t){const e=a2_0x27c6;return"("+t[e(2061)]+","+t[e(800)]+e(1300)+t[e(511)]+","+t.bottom+")"}function x(t){const e=a2_0x27c6;return t[e(511)]-t[e(2061)]}function I(t){return t[a2_0x27c6(2364)]-t.top}i.d(e,{BN:()=>s,Pq:()=>n,Re:()=>o,DI:()=>r,tH:()=>a,qi:()=>h,Bu:()=>c,l$:()=>l,kq:()=>d,Hd:()=>u,Hv:()=>m,ap:()=>g,RB:()=>f,ur:()=>p,b8:()=>_,FJ:()=>y,U6:()=>w,n3:()=>v,PW:()=>b,Oq:()=>x,rY:()=>I})},7605:(t,e,i)=>{"use strict";i.d(e,{t:()=>n,e:()=>o});var s=i(4371);function n(t){const e=a2_0x27c6;if(!t||typeof t!==e(1804))return t;const i={};for(const s of Object.keys(t)){const n=t[s];typeof n===e(1804)?e(2006)in n?i[s]=r(n):n instanceof Float32Array?i[s]=h(n,e(632)):n instanceof Uint8Array?i[s]=h(n,e(2288)):n instanceof Uint16Array?i[s]=h(n,e(1680)):n instanceof Uint32Array?i[s]=h(n,"Uint32Array"):i[s]=n:i[s]=n}return i}function o(t){const e=a2_0x27c6;if(!t||typeof t!==e(1804)||(0,s.fU)(t))return t;const i={};for(const s of Object[e(1742)](t)){const n=t[s];typeof n!==e(1804)||Array[e(557)](n)?i[s]=n:e(766)in n?n[e(766)]===e(1515)?i[s]=a(n):i[s]=c(n):i[s]=o(n)}return i}function r(t){const e=a2_0x27c6;return{dataType:e(1515),data:n(t[e(2077)])}}function a(t){const e=a2_0x27c6,i=o(t[e(1253)]);return{resource:i,readyPromise:Promise[e(542)](i),isReady:!0}}function h(t,e){return{dataType:e,data:Array[a2_0x27c6(2324)](t)}}function c(t){const e=a2_0x27c6;return new(self[t[e(766)]])(t[e(1253)])}}},s={};function n(t){const e=a2_0x27c6;if(s[t])return s[t].exports;var o=s[t]={exports:{}};return i[t](o,o[e(774)],n),o[e(774)]}n.m=i,n.n=t=>{var e=t&&t[a2_0x27c6(1574)]?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{const i=a2_0x27c6;for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object[i(1017)](t,s,{enumerable:!0,get:e[s]})},n.f={},n.e=t=>{const e=a2_0x27c6;return Promise.all(Object[e(1742)](n.f)[e(1180)](((e,i)=>(n.f[i](t,e),e)),[]))},n.u=t=>""+t+a2_0x27c6(1339),n.miniCssF=t=>(122===t?"vscode.main":t)+".css",n.g=function(){const t=a2_0x27c6;if("object"==typeof globalThis)return globalThis;try{return this||new Function(t(556))()}catch(e){if(typeof window===t(1804))return window}}(),(()=>{const t=a2_0x27c6;n.o=(e,i)=>Object[t(752)][t(2041)][t(1355)](e,i)})(),t={},e="luna:",n.l=(i,s,o)=>{const r=a2_0x27c6;if(t[i])t[i].push(s);else{var a,h;if(void 0!==o)for(var c=document[r(512)]("script"),l=0;l<c[r(1807)];l++){var d=c[l];if(d.getAttribute("src")==i||d[r(1587)](r(669))==e+o){a=d;break}}!a&&(h=!0,(a=document[r(808)](r(619)))[r(833)]=r(950),a[r(509)]=120,n.nc&&a[r(2178)]("nonce",n.nc),a.setAttribute(r(669),e+o),a[r(1679)]=i),t[i]=[s];var u=(e,s)=>{const n=r;a[n(2350)]=a[n(830)]=null,clearTimeout(m);var o=t[i];if(delete t[i],a.parentNode&&a[n(1122)][n(1132)](a),o&&o[n(1177)]((t=>t(s))),e)return e(s)},m=setTimeout(u[r(732)](null,void 0,{type:"timeout",target:a}),12e4);a[r(2350)]=u.bind(null,a[r(2350)]),a[r(830)]=u[r(732)](null,a[r(830)]),h&&document[r(1753)][r(1484)](a)}},n.r=t=>{const e=a2_0x27c6;"undefined"!=typeof Symbol&&Symbol[e(2089)]&&Object[e(1017)](t,Symbol[e(2089)],{value:"Module"}),Object[e(1017)](t,e(1574),{value:!0})},(()=>{const t=a2_0x27c6;var e;n.g[t(2248)]&&(e=n.g.location+"");var i=n.g.document;if(!e&&i&&(i[t(1514)]&&(e=i[t(1514)][t(1679)]),!e)){var s=i[t(512)]("script");s.length&&(e=s[s.length-1][t(1679)])}if(!e)throw new Error(t(1730));e=e.replace(/#.*$/,"")[t(2048)](/\?.*$/,"")[t(2048)](/\/[^\/]+$/,"/"),n.p=e})(),(()=>{const t=a2_0x27c6;var e={122:0};n.f.j=(t,i)=>{const s=a2_0x27c6;var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)i.push(o[2]);else{var r=new Promise(((i,s)=>{o=e[t]=[i,s]}));i[s(585)](o[2]=r);var a=n.p+n.u(t),h=new Error;n.l(a,(i=>{const r=s;if(n.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var a=i&&(i[r(544)]===r(1335)?r(1149):i[r(544)]),c=i&&i[r(1996)]&&i[r(1996)][r(1679)];h.message=r(561)+t+" failed.\n("+a+": "+c+")",h.name=r(1616),h[r(544)]=a,h[r(1709)]=c,o[1](h)}}),s(1415)+t)}};var i=(t,i)=>{const s=a2_0x27c6;for(var o,r,[a,h,c]=i,l=0,d=[];l<a[s(1807)];l++)r=a[l],n.o(e,r)&&e[r]&&d[s(585)](e[r][0]),e[r]=0;for(o in h)n.o(h,o)&&(n.m[o]=h[o]);for(c&&c(n),t&&t(i);d.length;)d.shift()()},s=self[t(1915)]=self[t(1915)]||[];s[t(1177)](i[t(732)](null,0)),s[t(585)]=i.bind(null,s.push[t(732)](s))})(),(()=>{"use strict";const t=a2_0x27c6;var e=n(5120),i=n(1003),s=n(1815);class o extends e.JT{constructor(){const t=a2_0x27c6;super(...arguments),this[t(1257)]=this[t(1502)](new s.v),this[t(538)]=this[t(1257)][t(1362)]}[t(1925)](e){const i=t;this.element=e,this[i(1257)][i(1457)](this[i(1993)])}}class r{constructor(){const e=t;this[e(544)]="readonly",this[e(875)]=e(1606),this[e(1832)]=0}[t(629)](){return{id:t(1422)}}static[t(2099)](t){return new r}}class a extends e.JT{constructor(){const e=t;super(),this[e(1172)]=[],this[e(1920)]=-1,this[e(2097)]=new Map,this[e(610)]=new Map,this._onEntriesChange=this[e(1502)](new s.v),this[e(1923)]=this[e(2227)][e(1362)],this[e(1027)]=this[e(1502)](new s.v),this.onUndo=this[e(1027)][e(1362)],this._onRedo=this.register(new s.v),this[e(1235)]=this._onRedo[e(1362)],this._onRequestTool=this.register(new s.v),this[e(1031)]=this._onRequestTool[e(1362)],this[e(1989)](e(2266),{undo:t=>t[e(1921)](),redo:t=>t[e(1913)]()}),this.registerHistoryEntryFactory("composite",(t=>this[e(1068)](t))),this[e(2254)](e(1422),r[e(2099)])}get activeEntry(){const e=t;return this[e(1172)][this[e(1920)]]}get[t(605)](){return this[t(1172)]}get[t(670)](){const e=t;return this[e(1172)][e(1807)]>1&&0!==this[e(1920)]}get[t(915)](){const e=t;return this._entries[e(1807)]>1&&this._currentEntryPointer!==this._entries[e(1807)]-1}[t(1091)](e,i){const s=t;if(this[s(1699)]){if(e[s(544)]===s(2198))throw new Error("Cannot add composite entry to composite entry");if(e[s(544)]===s(1732))throw new Error("Cannot add readonly entry to composite entry");this[s(1699)].push(e)}else this[s(1172)][++this[s(1920)]]=e,this[s(1172)][s(1807)]=this[s(1920)]+1,!i&&this._onEntriesChange[s(1457)](!0)}async[t(1262)](e){const i=t,s=await e[i(1775)]();s&&this[i(1091)](s)}[t(860)](e){const i=t,s=e[i(1775)]();s&&this[i(1091)](s)}[t(1782)](){const e=t;this[e(1920)]=-1,this._currentCompositeEntry=void 0,this._entries[e(1807)]=0,this[e(2227)][e(1457)](!0)}async[t(1921)](){const e=t;if(-1===this[e(1920)])throw new Error(e(2289));const i=this[e(1172)][this[e(1920)]];if(i[e(544)]===e(1732))throw new Error("Cannot undo readonly entry");if(this[e(1920)]--,await this[e(1054)](i),i[e(544)]===e(2198)){const t=i.entries;for(let i=t.length-1;i>=0;i--)await this[e(2097)].get(t[i][e(544)])[e(1921)](t[i])}else await this[e(2097)][e(876)](i[e(544)]).undo(i);this._onEntriesChange[e(1457)](!1),this[e(1027)][e(1457)](i)}async[t(1913)](){const e=t;if(this[e(1172)][e(1807)]<=this[e(1920)]+1)throw new Error(e(1168));const i=this[e(1172)][this._currentEntryPointer+1];if("readonly"===i[e(544)])throw new Error(e(2112));if(this[e(1920)]++,await this[e(1054)](i),"composite"===i.type)for(const t of i[e(605)])await this[e(2097)][e(876)](t[e(544)]).redo(t);else await this[e(2097)][e(876)](i[e(544)])[e(1913)](i);this[e(2227)][e(1457)](!1),this[e(578)][e(1457)](i)}async[t(1384)](e,i){const s=t;if(this[s(1699)])return i();this._currentCompositeEntry=[];try{await i()}catch(t){return console[s(1388)](s(1822),t),void this[s(2024)](e+s(1820))}this[s(2024)](e)}[t(2237)](e,i){const s=t;if(this[s(1699)])return i();this[s(1699)]=[];try{i()}catch(t){return console[s(1388)](s(1822),t),void this[s(2024)](e+s(1820))}this[s(2024)](e)}[t(2024)](e){const i=t;if(!this[i(1699)])throw new Error(i(2063));const s=this[i(1699)];this[i(1699)]=void 0;const n=s.reduce(((t,e)=>e.pixelCount>t?e[i(1832)]:t),0),o={type:"composite",operationName:e,entries:s,pixelCount:n,serialize:()=>this._serializeCompositeEntry(o)};this[i(1091)](o)}[t(1989)](e,i){const s=t;if(this._entryHandlers[s(876)](e))throw new Error(s(1543)+e+s(1659));this._entryHandlers[s(917)](e,i)}[t(2254)](e,i){const s=t;if(this[s(610)][s(876)](e))throw new Error(s(2140)+e+s(1659));this._entryFactories[s(917)](e,i)}[t(629)](e=0){const i=t;try{for(const t of this[i(1172)])if(t[i(1832)]>e)throw new Error('History entry "'+t[i(875)]+i(952)+t[i(1832)]+i(890)+e+")");const t=[];for(const e of this[i(1172)]){if(!e[i(629)])throw new Error("serialize function does not exist on history entry");t[i(585)](e[i(629)]())}return{currentEntry:this[i(1920)],entries:t}}catch(t){return console[i(680)](i(1501),t),{currentEntry:0,entries:[]}}}[t(1161)](e){const i=t;for(const t of e[i(605)])try{this.addEntry(this[i(781)](t),!0)}catch{this[i(1091)](new r,!0)}this._currentEntryPointer=Math[i(2338)](e[i(1634)],this[i(1172)][i(1807)]-1),this[i(2227)].fire(!1)}[t(781)](e){const i=t;if(!e.id)throw new Error(i(1090));const s=this[i(610)][i(876)](e.id);if(!s)throw new Error(i(719)+e.id+'"');return s(e)}_serializeCompositeEntry(e){const i=t;return{id:i(2198),operationName:e[i(875)],entries:e.entries[i(928)]((t=>{const s=i;if(!t[s(629)])throw console[s(1388)]("Cannot serialize history entry",e),new Error(s(518));return t[s(629)]()})),requiresTool:e[i(1021)]}}[t(1068)](e){const i=t,s=[];for(const t of e[i(605)])s[i(585)](this._restoreEntry(t));const n=s[i(1180)](((t,e)=>e[i(1832)]>t?e[i(1832)]:t),0);try{const t={type:i(2198),operationName:e.operationName,entries:s,pixelCount:n,requiresTool:e[i(1021)],serialize:()=>this[i(2068)](t)};return t}catch{return new r}}async _requestToolIfNeeded(e){const i=t;if(e.type===i(2198)){const t=e[i(605)];for(let e=t[i(1807)]-1;e>=0;e--){const s=t[e];if(s.requiresTool)return void await this[i(2355)][i(1671)](s.requiresTool)}}else e[i(1021)]&&await this._onRequestTool[i(1671)](e.requiresTool)}}var h=n(4371),c=n(7605),l=n(6785);class d{constructor(e,i,s){const n=t;this[n(875)]=e,this._imageFileId=i,this[n(998)]=s,this[n(544)]=n(715),this[n(1832)]=0}async[t(1921)](e){const i=t,s=await e.getLayer(this[i(2277)],this[i(998)]);if(!s)throw new Error(i(1443));return s}async[t(1913)](e){const i=t,s=await e.getLayer(this[i(2277)],this[i(998)]);if(!s)throw new Error(i(1443));return s}serialize(){const e=t;return{id:e(520),operationName:this.operationName,imageFileId:this[e(2277)],layerId:this[e(998)]}}static create(e){const i=t;return new d(e[i(875)],e[i(1568)],e[i(2292)])}}var u=n(3491);class m{constructor(e,i){const s=t;this[s(875)]=e,this[s(2277)]=i,this[s(544)]=s(1123),this[s(1832)]=0}async[t(1921)](e){const i=t;e[i(2369)](this[i(2277)],!0)}async redo(e){e[t(2369)](this._imageFileId,!1)}serialize(){const e=t;return{id:e(1849),operationName:this[e(875)],imageFileId:this._imageFileId}}static[t(2099)](e){return new m(e[t(875)],e.imageFileId)}}class g{constructor(e,i){const s=t;this[s(875)]=e,this[s(2277)]=i,this[s(544)]=s(1123),this[s(1832)]=0}async[t(1921)](e){const i=t;e[i(2369)](this[i(2277)],!1)}async[t(1913)](e){const i=t;e[i(2369)](this[i(2277)],!0)}[t(629)](){const e=t;return{id:"DeleteImage",operationName:this[e(875)],imageFileId:this[e(2277)]}}static[t(2099)](e){return new g(e[t(875)],e.imageFileId)}}class f{constructor(e,i,s){const n=t;this[n(875)]=e,this[n(712)]=i,this._targetIndex=s,this[n(544)]=n(1123),this[n(1832)]=0}[t(1921)](e){const i=t;e[i(1838)](this._targetIndex,this[i(712)])}[t(1913)](e){const i=t;e[i(1838)](this[i(712)],this._targetIndex)}[t(629)](){const e=t;return{id:"MoveImage",operationName:this.operationName,initialIndex:this[e(712)],targetIndex:this[e(1387)]}}static[t(2099)](e){const i=t;return new f(e.operationName,e[i(2145)],e[i(1611)])}}class p extends e.JT{constructor(e,i,n,o){const r=t;super(),this[r(2260)]=e,this[r(2258)]=i,this[r(2021)]=n,this[r(921)]=o,this[r(1194)]=!1,this[r(2030)]=new Map,this._savedViewport=new Map,this[r(1647)]=0,this[r(1148)]=this.register(new s.v),this[r(574)]=this[r(1148)][r(1362)],this._onImageDeleted=this[r(1502)](new s.v),this.onImageDeleted=this[r(2121)][r(1362)],this[r(2260)][r(1989)](r(715),{undo:async t=>{const e=r,i=await t[e(1921)](this);i[e(969)]?this[e(2258)][e(2280)](this._imageService[e(794)][0].id):this._imageService.setActiveLayer(i.id)},redo:async t=>{const e=r,i=await t[e(1913)](this);i[e(969)]?this._imageService[e(2280)](this[e(2258)][e(794)][0].id):this[e(2258)][e(2280)](i.id)}}),this[r(2260)][r(1989)]("imageFile",{undo:async t=>{const e=r;t.undo({setImageSoftDeleted:this._setSoftDeleted.bind(this),swapImagePositions:this._swapImagePositions[e(732)](this,!0)})},redo:async t=>{const e=r;t[e(1913)]({setImageSoftDeleted:this[e(540)][e(732)](this),swapImagePositions:this[e(1372)].bind(this,!0)})}}),this[r(2260)][r(2254)](r(2276),l.x[r(2099)]),this[r(2260)][r(2254)](r(520),d[r(2099)]),this[r(2260)][r(2254)](r(1849),m.create),this[r(2260)][r(2254)]("DeleteImage",g[r(2099)]),this._historyService[r(2254)]("MoveImage",f[r(2099)]),this[r(2021)][r(698)]((()=>{const t=r;void 0!==this[t(549)]&&this[t(2260)].addEntry(new d(t(520),this._getActiveImage()?.id||0,this[t(2258)][t(1357)]?.id||0))})),this._imageService[r(982)]((()=>this._refreshActiveImage()))}async[t(540)](e,i){const s=t,n=this[s(2246)]?.[s(1707)]((t=>t.id===e));n&&(i?(n.isSoftDeleted=i,this._getActiveImage()?.id===e&&await this[s(1942)](this[s(549)],this[s(2246)]),this[s(2121)].fire(e),this[s(1148)][s(1457)]()):(n[s(969)]=i,this._onImagesChange[s(1457)](),this[s(1823)](n.id)))}get[t(1998)](){const e=t;if(this[e(2246)])return this[e(1042)](),_(this[e(2246)])}[t(1042)](){const e=t;if(this[e(2246)]&&this[e(549)]){const t=this[e(2246)][this[e(549)]],i=this._imageService[e(1357)];t&&i&&i[e(1253)]!==t[e(1253)]&&(t[e(1253)]=i[e(1253)],t.width=i.width,t[e(918)]=i.height)}}[t(1836)](e,i,s){const n=t;return this[n(1194)]=s,this[n(2258)][n(1836)](e,i,s)}openImage(e,i,s){const n=t;let o;if(this[n(1194)]=s,Array[n(557)](i)){this[n(1628)]();const t=i;this[n(2297)]=e,this[n(2246)]=t[n(928)]((t=>({...t,id:++this[n(1647)]})));for(const t of this._imageSet)t[n(1253)]=(0,h.pZ)(t.data);const s=t[n(1180)](((t,e,i)=>{const s=n;return e[s(2164)]*e[s(918)]>t[s(2134)]?(t[s(2134)]=e[s(2164)]*e[s(918)],{index:i,dims:e[s(2164)]*e[s(918)]}):t}),{index:0,dims:0})[n(1205)];this[n(549)]=s,o=this[n(2246)][s]}else o=i;this[n(2258)][n(1987)](e,o,!0,this[n(1194)]),Array.isArray(i)&&this[n(1148)][n(1457)]()}[t(2375)](e,i,s){const n=t;if(this._unloadImageSet(),e===n(1088)){this._imageService[n(2375)](i,s,e);const t=this[n(2258)].currentLayer;this[n(2297)]=e,this[n(2246)]=[{data:t[n(1253)],width:i,height:s,bitness:32,id:++this[n(1647)]}],this[n(549)]=0,this._onImagesChange.fire()}else this[n(2258)][n(2375)](i,s,e)}[t(1628)](){const e=t;if(this[e(2246)]){for(const t of _(this[e(2246)]))this._onImageDeleted.fire(t.id);this[e(549)]=void 0}}async[t(1146)](e){const i=t;if(this._imageSet){const t=(await n.e(495)[i(653)](n[i(732)](n,7495))).writeIco,e=await t(_(this[i(2246)]));return new Blob([e])}return this[i(2258)].exportBlob(e)}async[t(1062)](e){const i=t;return this[i(2246)]?this.exportBlob(e):this._imageService[i(1062)](e)}[t(1886)](){const e=t;if(!this._imageSet)throw new Error(e(2161));return this[e(2246)]}[t(692)](){const e=t;if(this[e(1194)])throw new Error(e(1811))}async[t(1332)](e,i){const s=t,n=this[s(1886)]();if(e>=n[s(1807)])throw new Error(s(1830)+e+s(926));if(void 0!==this[s(549)]){const t=n[this.activeImageSetIndex];!i&&(await(this[s(2258)][s(1357)]?.[s(983)]()),this[s(2021)][s(1377)]&&this._selectionService[s(865)]());const e=this[s(2258)][s(629)](-1);this[s(2030)][s(917)](t.id,e),this[s(2235)][s(917)](t.id,{x:this[s(921)].x,y:this[s(921)].y,zoom:this[s(921)][s(735)]})}this.activeImageSetIndex=e;const o=n[e],r=this._loadedImages[s(876)](o.id);r?this[s(2258)][s(1161)](r,!0):this[s(2258)].openImage(o[s(2297)],o,!1,this[s(1194)]);const a=this[s(2235)][s(876)](o.id);a?(this._viewportService.x=a.x,this[s(921)].y=a.y,this[s(921)].zoom=a[s(735)]):this[s(921)][s(2120)](),this[s(1148)].fire()}async[t(1823)](e,i){const s=t,n=this[s(1886)]()[s(2307)]((t=>t.id===e));await this[s(1332)](n,i)}async addImage(e,i,s){const n=t;this[n(692)]();const o=this[n(1886)](),r={id:++this[n(1647)],width:e,height:i,data:new Uint8Array(e*i*4),bitness:s,mimeType:32===s?"image/png":"image/bmp"};r.data.fill(255),o[n(585)](r),await this.setActiveImageByIndex(o.length-1),this._historyService[n(1091)](new m("Add Image",r.id))}async deleteImage(e){const i=t;this[i(692)]();const s=this[i(1886)]();if(s.length<=1)throw new Error(i(1602));const n=this[i(614)](e);if(void 0===n)throw new Error(i(2158));await this._focusNonActiveImage(n,s);const o=s[n];o[i(969)]=!0,this[i(2121)][i(1457)](o.id),this._onImagesChange[i(1457)](),this[i(2260)][i(1091)](new g(i(1151),o.id))}async[t(1301)](e){const i=t;this[i(692)]();const s=this[i(1886)](),n=this._getImageOrActiveIndex(e);if(void 0===n)throw new Error(i(2158));!e&&(e=s[n]);const o={id:++this[i(1647)],width:e[i(2164)],height:e[i(918)],data:e[i(1253)][i(1019)](0),bitness:e.bitness,mimeType:e.mimeType},r=n+1;s[i(1560)](r,0,o),await this[i(1332)](r),this[i(2260)].addEntry(new m(i(678),o.id))}_getImageOrActiveIndex(e){const i=t,s=this._checkSupportsMultipleImages();let n;return e?(n=s[i(2307)]((t=>t.id===e.id)),-1===n&&(n=void 0)):n=this[i(549)],n}async _focusNonActiveImage(e,i){const s=e+1<i[t(1807)]-1?e+1:e-1;await this.setActiveImageByIndex(s)}async[t(2094)](){const e=t;await this[e(1332)](this[e(1886)]().length-1)}async goToBottomImage(){const e=t;await this[e(1332)](0)}async[t(1700)](){const e=t;await this[e(1332)]((this[e(549)]||0)+1)}async[t(1831)](){const e=t;await this[e(1332)]((this[e(549)]||0)-1)}async[t(1990)](){const e=t;this[e(499)](e(1157),this[e(1886)]().length-1)}async[t(2163)](){const e=t;this[e(499)](e(2204),0)}async[t(1032)](){const e=t;void 0!==this[e(549)]&&this[e(499)](e(1334),this[e(549)]+1)}async[t(1844)](){const e=t;void 0!==this[e(549)]&&this[e(499)](e(515),this[e(549)]-1)}async[t(2371)](e,i){const s=t,n=this._checkSupportsMultipleImages(),o=(n[s(2307)]((t=>t.id===e)),n.findIndex((t=>t.id===i)));await this.setActiveImageById(e),this[s(499)]("Move Image",o)}_moveActiveImageToIndex(e,i){const s=t;if(void 0===this[s(549)])return;this[s(692)]();const n=this[s(1886)]();i=Math[s(1445)](Math.min(i,n.length-1),0),this[s(549)]!==i&&(this[s(2260)][s(1091)](new f(e,this.activeImageSetIndex,i)),this[s(1372)](!1,this[s(549)],i))}[t(1372)](e,i,s){const n=t;if(i===s)return;const o=this[n(1886)](),r=this[n(1798)](),a=o[s],h=o[n(1560)](i,1)[0];o[n(1560)](s,0,h),(r?.id===h.id||r?.id===a.id)&&this[n(549)]!==s&&(this[n(549)]=s),this._onImagesChange[n(1457)]()}[t(1798)](){const e=t,i=this[e(1886)]();if(void 0!==this[e(549)])return i[this[e(549)]]}async[t(1425)](e,i){const s=t;if(!this._imageSet){if(0!==e)throw new Error(s(824));return this._imageService.getLayerById(i)}let n=this[s(1798)]();return n?.id!==e&&(await this[s(1823)](e,!0),n=this._getActiveImage()),this._imageService[s(1787)](i)}async[t(1319)](e,i,s){const n=t;return await this[n(1425)](e,i),this[n(2258)][n(2060)](s)}[t(629)](e=0){const i=t;if(void 0!==this[i(549)]){if(-1!==e){const t=this[i(2246)][i(1180)](((t,e)=>{const s=i,n=e[s(2164)]*e[s(918)];return n>t?n:t}),0);if(t>e)throw new Error(i(1437)+t+i(890)+e+")")}const t=Array[i(2324)](this[i(2030)][i(1673)]());return{mimeType:this.mimeType||i(1101),activeImageSetIndex:this[i(549)]||0,loadedImages:t,unloadedImages:this[i(2246)].map((t=>(0,c.t)(t)))}}return{mimeType:this.mimeType||"image/png",activeImageSetIndex:0,loadedImages:[this[i(2258)].serialize(e)],unloadedImages:void 0}}[t(1161)](e){const i=t;if(this[i(2297)]=e[i(2297)],e.unloadedImages){let t=0;for(const s of e[i(1249)][i(1673)]())t=s.layers.reduce(((t,e)=>e.id>t?e.id:t),t),s[i(1421)][i(1177)]((t=>(0,u.M)(t.id)));this[i(2258)][i(1791)](t+1),this._imageSet=e[i(630)][i(928)]((t=>(0,c.e)(t)));for(const t of e.loadedImages)this[i(2030)][i(917)](t.imageFileId,t);this[i(2246)]&&this[i(1332)](e[i(549)])}else this[i(2246)]=void 0,this._imageService[i(1161)](e[i(1249)][0]);this[i(2258)][i(2297)]=this[i(2297)],this[i(1148)].fire()}}function _(e){const i=t;return e[i(2197)]((t=>!0!==t[i(969)]))}var y=n(7517),w=n(2939),v=n(6495);class b{constructor(e,i,s){const n=t;this.operationName=e,this[n(712)]=i,this[n(1387)]=s,this[n(544)]=n(501),this.pixelCount=0}undo(e){const i=t;x(this[i(1387)],this[i(712)],e)}[t(1913)](e){const i=t;x(this[i(712)],this[i(1387)],e)}serialize(){const e=t;return{id:e(2273),operationName:this[e(875)],initialIndex:this[e(712)],targetIndex:this._targetIndex}}static[t(2099)](e){const i=t;return new b(e[i(875)],e[i(2145)],e[i(1611)])}}function x(e,i,s){const n=t;if(i>=s[n(1910)][n(1807)])return!1;const o=s[n(1910)][e];if(!o)return!1;for(s[n(1357)]=e;i>s.currentLayer;)s[n(1910)][s[n(1357)]]=s.list[s[n(1357)]+1],s[n(1910)][++s[n(1357)]]=o;for(;i<s[n(1357)];)s.list[s.currentLayer]=s[n(1910)][s.currentLayer-1],s[n(1910)][--s[n(1357)]]=o;return s.onLayerChangeEmitter[n(1457)](),!0}class I{constructor(e,i,s){const n=t;this[n(948)]=e,this[n(1387)]=i,this[n(839)]=s}[t(1775)](){const e=t;if(this._targetIndex===this._model[e(1357)])return;const i=this[e(839)].currentLayer<this._targetIndex?-1:1;let s=!1;for(let t=this[e(1387)];t!==this[e(839)].currentLayer;t+=i)if(!this[e(839)][e(1910)][t][e(969)]){s=!0;break}if(!s)return;const n=this[e(839)][e(1357)];return x(n,this[e(1387)],this._model)?new b(this[e(948)],n,this[e(1387)]):void 0}}class S{constructor(e,i,s,n){const o=t;this._operationName=e,this[o(998)]=i,this[o(1387)]=s,this[o(839)]=n}run(){const e=t,i=this._model[e(1910)][e(2307)]((t=>t.id===this[e(998)]));if(-1===i||this[e(1387)]===i)return;const s=i<this[e(1387)]?-1:1;let n=!1;for(let t=this[e(1387)];t!==i;t+=s)if(!this._model.list[t][e(969)]){n=!0;break}return n&&x(i,this[e(1387)],this[e(839)])?new b(this[e(948)],i,this[e(1387)]):void 0}}class C extends I{constructor(e,i,s){const n=t,o=i[n(1910)][i[n(1357)]],r=i[n(1910)].filter((t=>!t[n(969)])),a=r[n(899)](o)+s;(a<0||a>=r.length)&&super(e,i[n(1357)],i);const h=r[a];super(e,i[n(1910)][n(899)](h),i)}}class E extends C{constructor(e){super(t(1815),e,1)}}class T extends C{constructor(e){super(t(970),e,-1)}}var L=n(4852);class A{constructor(e,i,s){const n=t;this.operationName=e,this[n(2277)]=i,this._layerId=s,this[n(544)]="singleLayer",this[n(1832)]=0}async undo(e){const i=t,s=await e[i(1425)](this[i(2277)],this._layerId);if(!s)throw new Error(i(1191)+this[i(998)]);return s[i(969)]=!1,s.onUpdateEmitter.fire(),s}async[t(1913)](e){const i=t,s=await e[i(1425)](this._imageFileId,this[i(998)]);if(!s)throw new Error("Could not find layer "+this._layerId);return s.isSoftDeleted=!0,s[i(941)][i(1457)](),s}[t(629)](){const e=t;return{id:e(1888),operationName:this.operationName,imageFileId:this[e(2277)],layerId:this[e(998)]}}static[t(2099)](e){return new A(e[t(875)],e.imageFileId,e.layerId)}}var R=n(8286),D=n(6628),M=n(3817),B=n(3089),k=n(707);class U{constructor(e,i,s){const n=t;this[n(875)]=e,this[n(992)]=i,this[n(1379)]=s,this[n(544)]=n(1922),this[n(1832)]=0}[t(1921)](e){const i=t;e(this[i(992)][i(2164)],this._undoDimensions[i(918)])}redo(e){const i=t;e(this[i(1379)][i(2164)],this._redoDimensions[i(918)])}[t(629)](){const e=t;return{id:e(2374),operationName:this.operationName,undoDimensions:this[e(992)],redoDimensions:this[e(1379)]}}static create(e){const i=t;return new U(e[i(875)],e.undoDimensions,e[i(506)])}}class P{constructor(e,i,s,n,o,r){const a=t;this[a(875)]=e,this._imageFileId=i,this[a(998)]=s,this[a(2184)]=n,this[a(816)]=o,this[a(1494)]=r,this[a(544)]=a(715),this.requiresTool=a(1035),this[a(1832)]=this._width*this[a(1494)]}async[t(1921)](e){const i=t,s=await e.getLayer(this[i(2277)],this._layerId);if(!s)throw new Error(i(1191)+this[i(998)]);const n=await e.getTempLayer(this[i(2277)],this[i(998)],this[i(2184)]);if(!n)throw new Error(i(600)+this[i(998)]);return s[i(625)]=void 0,n.triggerHistoryUnset(),s[i(941)].fire(),s}async[t(1913)](e){const i=t,s=await e[i(1425)](this._imageFileId,this._layerId);if(!s)throw new Error(i(1191)+this[i(998)]);const n=await e.getTempLayer(this[i(2277)],this[i(998)],this[i(2184)]);if(!n)throw new Error(i(600)+this[i(998)]);return s[i(625)]=n,n.triggerHistoryAction(),s.onUpdateEmitter.fire(),s}[t(629)](){const e=t;return{id:e(1739),operationName:this.operationName,imageFileId:this[e(2277)],layerId:this._layerId,tempLayerId:this._tempLayerId,width:this[e(816)],height:this[e(1494)]}}static[t(2099)](e){const i=t;return new P(e[i(875)],e[i(1568)],e.layerId,e[i(1876)],e[i(2164)],e[i(918)])}}var F=n(4378);class N{constructor(e,i,s,n,o){const r=t;this[r(875)]=e,this._imageFileId=i,this._layerId=s,this._undoImage=n,this[r(933)]=o,this[r(544)]=r(715),this[r(1832)]=this._undoImage[r(2164)]*this._undoImage[r(918)]}async[t(1921)](e){const i=t,s=await e[i(1425)](this[i(2277)],this[i(998)]);if(!s)throw new Error("Could not find layer "+this[i(998)]);return await s[i(1871)]((()=>this[i(1298)])),s}async redo(e){const i=t,s=await e[i(1425)](this[i(2277)],this[i(998)]);if(!s)throw new Error(i(1191)+this._layerId);return await s.edit((()=>this[i(933)])),s}[t(629)](){const e=t;return{id:e(607),operationName:this[e(875)],imageFileId:this[e(2277)],layerId:this[e(998)],undoImage:(0,c.t)(this[e(1298)]),redoImage:(0,c.t)(this._redoImage)}}static[t(2099)](e){const i=t;return new N(e.operationName,e.imageFileId,e.layerId,(0,c.e)(e[i(522)]),(0,c.e)(e[i(1902)]))}}var O=n(1375);class V{constructor(e,i,s,n,o){const r=t;this[r(875)]=e,this[r(2277)]=i,this[r(998)]=s,this[r(816)]=n,this[r(1494)]=o,this[r(544)]=r(715),this[r(1832)]=this[r(816)]*this._height}async[t(1921)](e){const i=t,s=await e.getLayer(this[i(2277)],this._layerId);if(!s)throw new Error(i(1191)+this._layerId);return s.isSoftDeleted=!0,s.onUpdateEmitter[i(1457)](),s}async[t(1913)](e){const i=t,s=await e.getLayer(this[i(2277)],this._layerId);if(!s)throw new Error(i(1191)+this[i(998)]);return s.isSoftDeleted=!1,s[i(941)][i(1457)](),s}[t(629)](){const e=t;return{id:e(2375),operationName:this.operationName,imageFileId:this[e(2277)],layerId:this[e(998)],width:this[e(816)],height:this[e(1494)]}}static[t(2099)](e){const i=t;return new V(e.operationName,e.imageFileId,e.layerId,e.width,e[i(918)])}}class H{constructor(e){const i=t;this.operationName=e,this[i(544)]=i(1732),this[i(1832)]=0}serialize(){return{id:t(1987),operationName:this.operationName}}static[t(2099)](e){return new H(e[t(875)])}}class z{constructor(){const e=t;this[e(544)]=e(1732),this.operationName=e(1545),this.pixelCount=0}[t(629)](){return{id:"restoreImage"}}static[t(2099)](t){return new z}}class j{constructor(e,i,s,n){const o=t;this[o(2277)]=e,this[o(998)]=i,this[o(2303)]=s,this[o(780)]=n,this.type=o(715),this[o(1832)]=0,this.operationName=o(2156)+function(e){const i=t;return e[i(2136)](0,1)[i(1572)]()+e.substring(1)}(this[o(780)])}async[t(1921)](e){const i=t,s=await e[i(1425)](this[i(2277)],this[i(998)]);if(!s)throw new Error(i(1191)+this._layerId);return s[i(1636)]=this[i(2303)],s}async redo(e){const i=t,s=await e[i(1425)](this._imageFileId,this[i(998)]);if(!s)throw new Error("Could not find layer "+this[i(998)]);return s[i(1636)]=this[i(780)],s}serialize(){const e=t;return{id:e(1537),imageFileId:this[e(2277)],layerId:this[e(998)],undoBlendMode:this._undoBlendMode,redoBlendMode:this[e(780)]}}static[t(2099)](e){const i=t;return new j(e[i(1568)],e[i(2292)],e[i(925)],e[i(1207)])}}class W{constructor(e,i,s,n){const o=t;this[o(2277)]=e,this[o(998)]=i,this[o(2366)]=s,this[o(1585)]=n,this.type="singleLayer",this[o(1832)]=0,this.operationName="Layer Name: "+function(e){const i=t;return e[i(2136)](0,1)[i(1572)]()+e[i(2136)](1)}(this[o(1585)])}async[t(1921)](e){const i=t,s=await e[i(1425)](this[i(2277)],this[i(998)]);if(!s)throw new Error(i(1191)+this[i(998)]);return s[i(1424)]=this._undoName,s}async[t(1913)](e){const i=t,s=await e[i(1425)](this[i(2277)],this[i(998)]);if(!s)throw new Error(i(1191)+this[i(998)]);return s[i(1424)]=this[i(1585)],s}[t(629)](){const e=t;return{id:e(1855),imageFileId:this[e(2277)],layerId:this[e(998)],undoName:this._undoName,redoName:this[e(1585)]}}static[t(2099)](e){const i=t;return new W(e.imageFileId,e[i(2292)],e.undoName,e[i(2334)])}}class q{constructor(e,i,s){const n=t;this[n(2277)]=e,this[n(998)]=i,this[n(862)]=s,this.type=n(715),this[n(1832)]=0,this[n(875)]=(this[n(862)]?n(1469):n(2013))+n(2109)}async undo(e){const i=t,s=await e[i(1425)](this[i(2277)],this[i(998)]);if(!s)throw new Error(i(1191)+this[i(998)]);return s.isVisible=!this[i(862)],s}async[t(1913)](e){const i=t,s=await e[i(1425)](this[i(2277)],this[i(998)]);if(!s)throw new Error(i(1191)+this[i(998)]);return s.isVisible=this._isVisible,s}[t(629)](){const e=t;return{id:e(1746),imageFileId:this[e(2277)],layerId:this[e(998)],isVisible:this[e(862)]}}static create(e){const i=t;return new q(e[i(1568)],e.layerId,e[i(836)])}}var G=n(8549),X=n(116);class Y{constructor(e,i){const s=t;this[s(1970)]=e,this[s(2111)]=i}[t(1775)](){const e=t;if(this[e(2111)].blendMode===this._blendMode)return;const i=this[e(2111)][e(1636)];return this._layer[e(1636)]=this[e(1970)],new j(this._layer[e(1568)],this[e(2111)].id,i,this[e(1970)])}}class J{constructor(e,i){this[t(507)]=e,this._layer=i}[t(1775)](){const e=t;if(this[e(2111)][e(1424)]===this[e(507)])return;const i=this._layer.name;return this[e(2111)].name=this[e(507)],new W(this[e(2111)][e(1568)],this[e(2111)].id,i,this[e(507)])}}class K{constructor(e,i){const s=t;this[s(862)]=e,this[s(2111)]=i}[t(1775)](){const e=t;if(this[e(2111)][e(836)]!==this[e(862)])return this[e(2111)][e(836)]=this._isVisible,new q(this[e(2111)][e(1568)],this[e(2111)].id,this[e(862)])}}class $ extends e.JT{constructor(e,n,o,r,a){const c=t;super(),this[c(2111)]=e,this[c(765)]=n,this[c(816)]=o,this._height=r,this[c(2260)]=a,this[c(2147)]=0,this[c(758)]=new Set,this._range=(0,i.Pq)(),this[c(870)]=(0,i.Pq)(),this[c(2290)]=this[c(1502)](new s.v),this[c(822)]=this[c(2290)][c(1362)],this[c(1814)]=this[c(1502)](new s.v),this.onCommit=this[c(1814)][c(1362)],this._undoData={colorData:new Uint8Array(200),indexList:(0,h.X$)(50,this[c(816)]*this[c(1494)]*4)},this[c(580)]={colorData:new Uint8Array(200),indexList:(0,h.X$)(50,this[c(816)]*this[c(1494)]*4)}}[t(1053)](e,s,n,o){const r=t;if(e<0||e>=this[r(816)])return;const a=s*this[r(816)]+e;if(this[r(758)][r(2387)](a))return;this._pointCache[r(1857)](a),(0,i.Hv)(this[r(870)],e,s),this[r(2147)]>=this[r(1846)].indexList.length&&(this[r(1846)][r(1237)]=(0,h.Rs)(this[r(1846)][r(1237)]),this[r(1846)][r(2207)]=(0,h.Rs)(this[r(1846)][r(2207)]),this[r(580)].indexList=(0,h.Rs)(this[r(580)].indexList),this[r(580)][r(2207)]=(0,h.Rs)(this[r(580)][r(2207)]));const c=4*(s*this[r(816)]+e),l=4*this._pointCount;this[r(1846)].indexList[this[r(2147)]]=c,this[r(1846)][r(2207)][l]=this[r(765)][c],this[r(1846)][r(2207)][l+1]=this[r(765)][c+1],this[r(1846)][r(2207)][l+2]=this._data[c+2],this._undoData[r(2207)][l+3]=this[r(765)][c+3],this[r(580)][r(1237)][this[r(2147)]]=c,o?((0,y.B)(o,this[r(765)],c,n,0),this[r(580)].colorData[l]=this[r(765)][c],this[r(580)].colorData[l+1]=this[r(765)][c+1],this[r(580)][r(2207)][l+2]=this[r(765)][c+2],this[r(580)][r(2207)][l+3]=this[r(765)][c+3]):(this[r(580)].colorData[l]=this[r(765)][c]=n[0],this._redoData[r(2207)][l+1]=this[r(765)][c+1]=n[1],this[r(580)][r(2207)][l+2]=this[r(765)][c+2]=n[2],this._redoData[r(2207)][l+3]=this[r(765)][c+3]=n[3]),this[r(2147)]++}[t(1813)](e,i,s,n,o){const r=t,a=Math[r(1870)]((s-1)/2),h=s%2==0?1:0;let c=a,l=0,d=1-a;for(n?(this[r(695)](e-a,e+a+h,i,o),h&&this[r(695)](e-a,e+a+h,i+1,o)):(this.setPixel(e+a+h,i,o),this[r(1053)](e-a,i,o),h&&(this[r(1053)](e+a+h,i+1,o),this[r(1053)](e-a,i+1,o))),this[r(1053)](e,i+a+h,o),this[r(1053)](e,i-a,o);c>l&&(l++,d<=0?d=d+2*l+1:(c--,d=d+2*i-2*e+1),!(c<l));)n?(this[r(695)](e-c,e+c+h,i+l+h,o),this._setHorizontalLine(e-c,e+c+h,i-l,o),this._setHorizontalLine(e-l,e+l+h,i+c+h,o),this[r(695)](e-l,e+l+h,i-c,o)):(this[r(1053)](e+c+h,i+l+h,o),this.setPixel(e-c,i+l+h,o),this[r(1053)](e+c+h,i-l,o),this[r(1053)](e-c,i-l,o),this[r(1053)](e+l,i+c+h,o),this[r(1053)](e-l,i+c+h,o),this[r(1053)](e+l,i-c,o),this.setPixel(e-l,i-c,o))}[t(695)](e,i,s,n){const o=t;for(let t=e;t<=i;t++)this[o(1053)](t,s,n),this[o(1053)](t,s,n)}[t(594)](){const e=t;(0,i.Bu)(this[e(870)])||(this[e(1710)]=(0,i.qi)(this[e(1710)],this._rangeNotYetRequested),this._onUpdate[e(1457)](this[e(870)]),this[e(870)]=(0,i.Pq)())}[t(2114)](e){const i=t,s={indexList:this[i(1846)][i(1237)][i(717)](0,this[i(2147)]),colorData:this[i(1846)][i(2207)].subarray(0,4*this[i(2147)])},n={indexList:this[i(580)].indexList[i(717)](0,this[i(2147)]),colorData:this[i(580)].colorData.subarray(0,4*this._pointCount)},o=new l.x(e,this[i(2111)][i(1568)],this[i(2111)].id,this[i(1710)],s,n);this._historyService[i(1091)](o),this[i(1814)][i(1457)](this[i(1710)])}}var Z=n(270);class Q extends e.JT{constructor(e,i,n,o,r,a,h,c,l,d){const u=t;super(),this[u(2260)]=e,this[u(2021)]=i,this._taskWorkerService=n,this.id=o,this[u(1568)]=r,this[u(507)]=a,this[u(608)]=h,this.data=c,this[u(2164)]=l,this[u(918)]=d,this[u(775)]=!1,this[u(1970)]=u(821),this[u(862)]=!0,this[u(1299)]=!1,this.isBottomLayer=!1,this[u(941)]=this[u(1502)](new s.v),this[u(822)]=this[u(941)][u(1362)],this._onSoftDeletedChange=this[u(1502)](new s.v),this[u(1045)]=this[u(2143)][u(1362)],this._onChangedDimensions=this[u(1502)](new s.v),this[u(982)]=this[u(721)][u(1362)],this[u(1455)]=this[u(1502)](new s.v),this[u(2105)]=this[u(1455)][u(1362)],this[u(1705)]=this.register(new s.v),this[u(1818)]=this._onRequestRender[u(1362)],this[u(1878)]=this[u(1502)](new s.v),this[u(1565)]=this[u(1878)].event,this[u(1244)]=this.register(new s.v),this[u(1792)]=this[u(1244)][u(1362)]}get[t(1424)](){return this[t(507)]}set name(e){const i=t;e!==this._name&&(this[i(507)]=e,this.onUpdateEmitter[i(1457)]())}get blendMode(){return this[t(1970)]}set[t(1636)](e){const i=t;e!==this[i(1970)]&&(this._blendMode=e,this.onUpdateEmitter[i(1457)]())}get isSoftDeleted(){return this[t(1299)]}set[t(969)](e){const i=t;e!==this[i(1299)]&&(this[i(1299)]=e,this[i(2143)][i(1457)]())}get[t(836)](){return this[t(862)]}set[t(836)](e){const i=t;e!==this[i(862)]&&(this[i(862)]=e,this._onVisibilityChange[i(1457)](),this[i(941)][i(1457)]())}get[t(1099)](){const e=t;let i=this.height-1;t:for(let t=0;t<this[e(918)];t++)for(let s=0;s<this[e(2164)];s++)if(this[e(1253)][4*(t*this.width+s)+3]>0){i=t;break t}let s=i;t:for(let t=this.height-1;t>i;t--)for(let i=0;i<this[e(2164)];i++)if(this[e(1253)][4*(t*this.width+i)+3]>0){s=t;break t}let n=this[e(2164)]-1;t:for(let t=0;t<this[e(2164)];t++)for(let o=i;o<=s;o++)if(this.data[4*(o*this[e(2164)]+t)+3]>0){n=t;break t}let o=n;t:for(let t=this[e(2164)]-1;t>n;t--)for(let e=i;e<=s;e++)if(this.data[4*(e*this.width+t)+3]>0){o=t;break t}return{left:n,top:i,right:o,bottom:s}}async[t(1871)](e){const s=t;this[s(508)]();try{const t=await e(this.data,this.width,this[s(918)]),i={image:t&&s(1253)in t?t:void 0,range:t&&"left"in t?t:void 0};this._finishEdit(i)}catch(t){throw this[s(2302)]({range:(0,i.DI)(this.width,this[s(918)])}),t}}[t(637)](){const e=t;this[e(508)]();const i=new $(this,this.data,this[e(2164)],this.height,this[e(2260)]);return(0,s.B)(i.onUpdate,this.onUpdateEmitter),i[e(698)]((t=>this._finishEdit({range:t}))),i}async[t(2234)](e){const s=t;if(e[s(836)])return this._historyService[s(1262)](new v.Z(s(694),(0,i.DI)(this[s(2164)],this.height),this,(async(t,i,n)=>{const o=s;!this[o(836)]&&t[o(917)](e[o(1253)],0);let r=0;for(let s=0;s<n;s++)for(let n=0;n<i;n++)r=4*(s*i+n),(0,y.B)(e[o(1636)],t,r,e[o(1253)],r)})))}async[t(2167)](e,i=!0){const n=t;await this[n(983)](),this[n(625)]=e,i&&((0,s.B)(e[n(1818)],this[n(1705)]),e[n(698)]((()=>this.temporaryLayer=void 0))),this[n(1878)].fire(this[n(625)])}unregisterTemporaryLayer(e){const i=t;this[i(625)]===e&&(this[i(625)]=void 0),this[i(1244)][i(1457)](e)}async[t(983)](){const e=t;await(this.temporaryLayer?.[e(2114)]()),this[e(625)]=void 0}async[t(2010)](){const e=t;if(!this[e(625)])return this[e(1253)];const i=new Uint8Array(new SharedArrayBuffer(this[e(1253)].length));if(i[e(917)](this[e(1253)],0),"moving"===this[e(625)][e(544)]){const t=this[e(625)],s=await t[e(888)][e(1882)][e(2006)],n={left:t[e(2098)].offsetX,top:t[e(2098)][e(1473)],right:t[e(2098)][e(1263)]+s[e(2164)],bottom:t[e(2098)].offsetY+s[e(918)]};let o=0;for(let t=n[e(800)];t<n.bottom;t++)for(let r=n[e(2061)];r<n[e(511)];r++){o=4*(t*this[e(2164)]+r);const a=4*((t-n[e(800)])*s[e(2164)]+r-n[e(2061)]);(0,h.Yr)(i,o,s[e(1253)],a)}}else e(1182)in this[e(625)]&&await this.temporaryLayer[e(1182)](i,this.width,this[e(918)]);return i}async[t(1146)](e={}){const s=t;let n,o;if(e?.[s(1367)]&&this.temporaryLayer?.type===s(2252)){const t=this[s(625)];n=await t[s(888)][s(1882)][s(2006)],o=(0,i.DI)(n[s(2164)],n[s(918)])}else await this[s(983)](),n=this,o=e[s(1377)]||(0,i.DI)(this.width,this.height);return tt(function(e,s){const n=t,o=(0,i.Oq)(s),r=(0,i.rY)(s);let a,h=0;if(o===e[n(2164)])h=s[n(800)]*o*4,a=new Uint8ClampedArray(e.data[n(717)](h,h+o*r*4));else{a=new Uint8ClampedArray(o*r*4);for(let t=s.top;t<s[n(800)]+r;t++)h=4*(t*e[n(2164)]+s[n(2061)]),a[n(917)](e[n(1253)].subarray(h,h+4*o),(t-s[n(800)])*o*4)}return new ImageData(a,o,r)}(n,o),e)}async[t(1739)](e,s){const n=t,o=await window[n(1034)](e);let r;"OffscreenCanvas"in window?r=new OffscreenCanvas(o.width,o[n(918)]):(r=document[n(808)](n(589)),r[n(2164)]=o.width,r.height=o[n(918)]);const a=r[n(573)]("2d");a[n(588)](o,0,0);const h=a[n(818)](0,0,o[n(2164)],o[n(918)]),c={data:new Uint8Array(h[n(1253)]),width:h[n(2164)],height:h.height};let l;const d=this._selectionService.range;l=d&&(0,i.Oq)(d)===h[n(2164)]&&(0,i.rY)(d)===h[n(918)]?(0,i.BN)(d):s&&(0,i.Oq)(s)===h[n(2164)]&&(0,i.rY)(s)===h.height?(0,i.BN)(s):(0,i.DI)(h[n(2164)],h[n(918)]);const u={image:(0,X.d)(c),range:l},m=new Z.m(this,u,void 0,this[n(2260)],this[n(2021)],this[n(1448)]);m[n(1834)].push({...m.currentState}),await this[n(2167)](m),this[n(2260)][n(1091)](new P(n(2113),this.imageFileId,this.id,m.id,m[n(888)][n(1882)][n(2077)].width,m.staticState[n(1882)][n(2077)].height));const g=(0,i.l$)((0,i.DI)(h.width,h.height),(0,i.DI)(this[n(2164)],this[n(918)]));return this.onUpdateEmitter[n(1457)](g),m}[t(508)](){const e=t;if(this[e(608)])throw new Error(e(1811));if(this[e(775)])throw new Error(e(1188));this[e(775)]=!0}_finishEdit(e){const i=t;if(e){if(e?.[i(1882)]){const t=this[i(2164)]!==e[i(1882)][i(2164)]||this.width!==e[i(1882)][i(2164)];this[i(1253)]=e[i(1882)].data,this[i(2164)]=e[i(1882)][i(2164)],this.height=e.image[i(918)],t&&this[i(721)].fire(this.width,this[i(918)])}this[i(941)].fire(e[i(1377)]),this[i(775)]=!1}else this._isEditInProgress=!1}[t(1537)](e){const i=t;this._historyService[i(860)](new Y(e,this))}setName(e){const i=t;this[i(2260)][i(860)](new J(e,this))}[t(1696)](t){this._historyService.runSyncAction(new K(t,this))}[t(629)](){const e=t;return{id:this.id,name:this[e(507)],data:Array[e(2324)](this[e(1253)]),blendMode:this[e(1970)],isSoftDeleted:this[e(1299)],isVisible:this[e(862)]}}}async function tt(e,i={}){const s=t,n=await createImageBitmap(e);if(!(s(2189)in window)){const t=document.createElement(s(589));return t.width=n[s(2164)],t[s(918)]=n[s(918)],t[s(573)]("2d")[s(588)](n,0,0),new Promise(((e,n)=>{const o=s;t[o(1329)]((t=>{if(!t)return n(t);e(t)}),i.encodeOptions?.[o(544)],i.encodeOptions?.[o(1625)])}))}const o=new OffscreenCanvas(n.width,n.height);return o[s(573)]("2d")[s(588)](n,0,0),o[s(2312)](i[s(1907)])}class et extends e.JT{constructor(){const e=t;super(),this.currentLayer=0,this.isReadonly=!1,this[e(1910)]=[],this[e(1939)]=this.register(new s.v),this[e(1247)]=this.onLayerChangeEmitter[e(1362)]}}var it=n(2811),st=n(807),nt=n(3670),ot=n(7233);class rt extends e.JT{constructor(e,i,n){const o=t;super(),this._historyService=e,this[o(2021)]=i,this[o(1448)]=n,this[o(2164)]=0,this[o(918)]=0,this.activeImageFileId=0,this._imageLayerIdCounter=0,this._temporaryLayerIdCounter=0,this[o(690)]=o(1101),this[o(1276)]=0,this[o(1547)]=new Map,this[o(2290)]=this[o(1502)](new s.v),this[o(822)]=this[o(2290)][o(1362)],this[o(721)]=this.register(new s.v),this.onChangedDimensions=this[o(721)].event,this[o(1754)]=this[o(1502)](new s.v),this[o(1247)]=this[o(1754)][o(1362)],this._onLayerVisibilityChange=this[o(1502)](new s.v),this[o(1130)]=this[o(1366)][o(1362)],this[o(1705)]=this[o(1502)](new s.v),this.onRequestRender=this[o(1705)][o(1362)],this._onTemporaryLayerRegistered=this[o(1502)](new s.v),this[o(1565)]=this._onTemporaryLayerRegistered[o(1362)],this[o(1244)]=this[o(1502)](new s.v),this[o(1792)]=this[o(1244)].event,this._onMimeTypeChange=this[o(1502)](new s.v),this.onMimeTypeChange=this._onMimeTypeChange[o(1362)];const r=new et;(0,s.B)(r[o(1247)],this._onLayerChange),this[o(1394)]=[r],this[o(2260)][o(1989)](o(501),{undo:t=>t.undo(this[o(1465)]),redo:t=>t[o(1913)](this[o(1465)])}),this[o(2260)][o(1989)](o(1922),{undo:t=>t[o(1921)](this[o(1922)][o(732)](this)),redo:t=>t[o(1913)](this.resize.bind(this))}),this._historyService[o(2254)](o(1987),H[o(2099)]),this._historyService.registerHistoryEntryFactory(o(2071),F.$.create),this[o(2260)][o(2254)](o(607),N.create),this[o(2260)][o(2254)](o(2374),U[o(2099)]),this[o(2260)][o(2254)](o(1537),j[o(2099)]),this._historyService.registerHistoryEntryFactory(o(1855),W[o(2099)]),this._historyService.registerHistoryEntryFactory(o(1746),q[o(2099)]),this[o(2260)].registerHistoryEntryFactory("deleteLayer",A[o(2099)]),this[o(2260)][o(2254)]("newImage",V[o(2099)]),this[o(2260)].registerHistoryEntryFactory(o(2273),b.create),this[o(2260)][o(2254)]("restoreImage",z.create),this[o(2260)][o(2254)](o(1739),P[o(2099)]),this[o(2260)][o(2254)](o(592),G.i[o(2099)]),this[o(2260)].registerHistoryEntryFactory(o(1610),L.S.create),this[o(2260)][o(2254)](o(1328),R.Z[o(2099)]),this[o(2260)][o(2254)](o(881),D.$[o(2099)][o(732)](null,this[o(1448)])),this[o(2260)].registerHistoryEntryFactory(o(581),O.C[o(2099)][o(732)](null,this[o(1448)])),this[o(2260)][o(2254)](o(1571),M.O[o(2099)]),this[o(2260)][o(2254)](o(1397),B.o.create),this[o(2260)][o(2254)](o(1012),k.o.create),this[o(1565)]((t=>this[o(1547)][o(917)](t.id,t))),this[o(1792)]((t=>this[o(1547)][o(1156)](t.id)))}get[t(1357)](){const e=t;return this._activeLayersModel[e(1910)][this[e(1465)][e(1357)]]}get[t(794)](){const e=t;return this[e(1465)].list[e(2197)]((t=>!t[e(969)]))}get[t(2297)](){return this[t(690)]}set[t(2297)](e){const i=t;this[i(690)]=e,this[i(1458)][i(1457)](e)}get _activeLayersModel(){const e=t;return this._layersModel[this[e(1276)]]}[t(629)](e=0){const i=t;if(-1!==e&&this[i(2164)]*this.height>e)throw new Error(i(1437)+this.width*this[i(918)]+i(890)+e+")");for(const t of this[i(1547)].values())if(t[i(1438)]){const i=t.canSerialize(e);if(i)throw new Error(i)}const s=[];for(const t of this._activeTemporaryLayers[i(1673)]())s[i(585)](t[i(629)]());const n={dimensions:{width:this.width,height:this[i(918)]},currentLayer:this._activeLayersModel.currentLayer,imageFileId:this[i(2070)],isReadonly:this[i(1465)][i(608)],layers:this[i(1465)][i(1910)][i(928)]((t=>t.serialize())),temporaryLayers:s,currentTemporaryLayerId:this[i(1357)]?.[i(625)]?.id};if(0===n[i(794)][i(1807)])throw new Error(i(767));return n}[t(1161)](e,i){const n=t;if(this[n(2164)]=e[n(1622)].width,this.height=e[n(1622)][n(918)],this[n(2070)]=e[n(1568)],i&&(this[n(1465)].list.length=0,this._activeTemporaryLayers[n(1112)]()),this._activeLayersModel[n(1910)][n(1807)]>0)throw new Error("Cannot restore layers when layer(s) exist");for(const t of e.layers){const i=new Q(this[n(2260)],this[n(2021)],this._taskWorkerService,t.id,e[n(1568)],t[n(1424)],e.isReadonly,new Uint8Array(t.data),e[n(1622)][n(2164)],e[n(1622)][n(918)]);i[n(1636)]=t[n(1636)],i[n(969)]=t[n(969)],i[n(836)]=t[n(836)],this[n(1465)][n(1910)][n(585)](i),this[n(1899)](i),this[n(2211)]=Math[n(1445)](this[n(2211)],t.id+1)}this[n(1465)][n(608)]=e[n(608)],this[n(1465)][n(1357)]=e[n(1357)];for(const t of e[n(1421)]){const e=this.getLayerById(t[n(1376)]);let i;switch(t.type){case n(1898):i=it.B[n(2099)];break;case n(2252):i=Z.m[n(2099)];break;case"rectangle":i=st.F.create;break;case"shape":i=nt.n.create;break;case n(1386):i=ot.o.create}const o=i(t,e,this._historyService,this._selectionService,this._taskWorkerService);o[n(2098)][n(1263)]=t[n(2098)][n(1263)],o[n(2098)].offsetY=t[n(2098)][n(1473)],(0,s.B)(o.onRequestRender,this[n(1357)][n(1705)]),this._activeTemporaryLayers[n(917)](t.id,o)}if(void 0!==e[n(1414)]){const t=this[n(2060)](e[n(1414)]);this[n(1357)]?.[n(2167)](t)}this[n(1637)](),this[n(2290)].fire(),this._onChangedDimensions[n(1457)](this[n(2164)],this[n(918)]),this[n(1754)][n(1457)]()}[t(1791)](t){this._imageLayerIdCounter=t-1}acquireTemporaryLayerId(){return++this[t(1558)]}[t(916)](e){this[t(1558)]=e-1}async[t(1836)](e,i,s){const n=t;this[n(2070)]=0,this[n(2297)]=e;const o=await window[n(1034)](i);let r;n(2189)in window?r=new OffscreenCanvas(o[n(2164)],o[n(918)]):(r=document[n(808)](n(589)),r.width=o[n(2164)],r[n(918)]=o[n(918)]);const a=r[n(573)]("2d");a[n(588)](o,0,0);const h=a[n(818)](0,0,o[n(2164)],o[n(918)]);this[n(1987)](e,{data:new Uint8Array(h.data[n(1523)]),width:o[n(2164)],height:o.height},!0,s)}[t(1987)](e,i,s,n,o=t(1014)+(n?" (Readonly)":"")){const r=t;this[r(2070)]="id"in i?i.id:0,this[r(2297)]=e||"image/png";for(const t of this[r(1465)][r(1910)])t[r(969)]=!0,t[r(1800)]();this[r(1465)][r(1910)].length=0,this._activeTemporaryLayers[r(1112)]();const a=this.width!==i[r(2164)]||this.height!==i.height;this.width=i.width,this[r(918)]=i.height,this[r(1465)][r(608)]=n,this._activeLayersModel.list[r(585)](this._createLayer(i[r(1253)])),this[r(1637)](),s&&(this[r(2260)][r(1782)](),this._historyService.addEntry(new H(o))),this[r(2290)][r(1457)](),a&&this._onChangedDimensions[r(1457)](this[r(2164)],this[r(918)]),this[r(1754)][r(1457)]()}[t(2375)](e,i,s){const n=t;this.mimeType=s;const o=window[n(760)]?SharedArrayBuffer:ArrayBuffer,r=new Uint8Array(new o(e*i*4));r[n(1348)](255);const a={data:r,width:e,height:i};this.openImage(void 0,a,!0,!1,n(893))}async exportBlob(e){const i=t;if("image/x-ico"===this[i(2297)])throw new Error(i(1215));return await this[i(1432)](),this[i(1465)][i(1910)][this[i(1465)].currentLayer][i(1146)](e)}async[t(1062)](e){const i=t;if(this[i(2297)]===i(1088))throw new Error(i(1215));const s=await this[i(2010)]();return tt(new ImageData(new Uint8ClampedArray(s[i(1253)]),s[i(2164)],s[i(918)]),e)}[t(1829)](){const e=t;return this.flattenLayers(),{data:this[e(1465)][e(1910)][this[e(1465)].currentLayer].data[e(1019)](0,this.width*this.height*4),width:this[e(2164)],height:this[e(918)]}}async[t(2010)](){const e=t,i=this.layers[e(2197)]((t=>t.isVisible));if(0===i[e(1807)])return{data:new Uint8Array(0),width:0,height:0};const s={data:(await i[0][e(2010)]())[e(1019)](0,this[e(2164)]*this[e(918)]*4),width:this.width,height:this[e(918)]};for(let t=1;t<i.length;t++){const n=i[t],o=await n[e(2010)]();let r=0;for(let t=0;t<this[e(918)];t++)for(let i=0;i<this.width;i++)r=4*(t*this[e(2164)]+i),(0,y.B)(n[e(1636)],s[e(1253)],r,o,r)}return s}[t(1803)](e,i){const s=t,n=this.layers[s(2197)]((t=>t[s(836)]));if(0===n.length)return;const o=4*(i*this.width+e),r=n[0][s(1253)][s(717)](o,o+4);let a;for(let t=1;t<n[s(1807)];t++)a=n[t],(0,y.B)(a.blendMode,r,0,a.data,o);return r}[t(2175)](){const e=t;return this[e(2297)]!==e(1088)}[t(525)](){const e=t;if(!this[e(2175)]())throw new Error(e(531))}_checkCanEdit(){const e=t;if(this._activeLayersModel.isReadonly)throw new Error(e(1811))}[t(2280)](e){const i=t;this.currentLayer?.id!==e&&(this[i(525)](),this[i(1465)][i(1357)]=this[i(796)](e),this[i(1754)][i(1457)]())}async[t(810)](){const e=t;this._checkCanEdit(),this[e(525)](),await(this[e(1357)]?.[e(983)]());const i=window.SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s=this[e(2291)](new Uint8Array(new i(this[e(2164)]*this[e(918)]*4)));this[e(1465)][e(1910)][e(1560)](++this[e(1465)].currentLayer,0,s),this[e(2260)][e(1091)](new V(e(1554),s[e(1568)],s.id,s[e(2164)],s[e(918)])),this[e(2290)].fire(),this[e(1754)][e(1457)]()}async[t(1888)](e){const i=t;if(this[i(692)](),this[i(525)](),this._activeLayersModel[i(1910)][i(1807)]<=1)throw new Error("Cannot delete the last layer");await(this[i(1357)]?.[i(983)]()),e?this._deleteLayerByIndex(this[i(796)](e)):this[i(1966)](),this[i(1754)].fire()}async[t(1728)](e){const i=t;let s;this[i(692)](),void 0===e?(s=this.currentLayer,e=s.id):s=this[i(1787)](e),this.layers[i(1807)]>0&&this[i(525)](),await s[i(983)]();const n=(0,h.X$)(s[i(1253)][i(1807)],255,!0);let o;if(n[i(917)](s[i(1253)],0),s.name[i(2253)](/ Copy$/)){let t=1;o=s[i(1424)]+" 1";do{o=o[i(2048)](/ \d+$/," "+ ++t)}while(this[i(1465)][i(1910)][i(636)]((t=>t[i(1424)]===o)))}else{const t=s[i(1424)].match(/ Copy (\d)+$/);if(t&&t[1]){let e=parseInt(t[1]);do{o=s[i(1424)][i(2048)](/ \d+$/," "+ ++e)}while(this[i(1465)][i(1910)][i(636)]((t=>t.name===o)))}else o=s[i(1424)]+i(2306)}const r=++this[i(2211)],a=new Q(this[i(2260)],this._selectionService,this[i(1448)],r,this[i(2070)],o,this._activeLayersModel[i(608)],n,this[i(2164)],this.height);this[i(1899)](a);const c=this._getIndexFromId(e);this[i(1465)][i(1910)][i(1560)](c+1,0,a),this[i(2280)](r),this._historyService[i(1091)](new V(i(2259),s[i(1568)],r,s[i(2164)],s[i(918)])),this[i(2290)][i(1457)](),this[i(1754)][i(1457)]()}async[t(2359)](){const e=t;if(this[e(692)](),this[e(525)](),0===this[e(1465)][e(1357)]||this[e(794)][0]===this.currentLayer)throw new Error(e(2012));const i=this._activeLayersModel[e(1910)][this[e(1465)][e(1357)]];await i[e(983)]();const s=this[e(794)][e(899)](i),n=this[e(794)][s-1],o=this._activeLayersModel[e(1910)].indexOf(n);await this[e(2260)][e(1384)](e(681),(async()=>{const t=e;i[t(1696)](!0),n[t(1696)](!0),await this[t(1465)][t(1910)][o].merge(i),this[t(1966)](),this[t(1465)][t(1357)]=o,this[t(1357)]?.[t(1696)](!0)}))}[t(2e3)](e,i){const s=t;let n;this[s(692)](),void 0===i?(n=this[s(1357)],i=n.id):n=this[s(1787)](i),n.setName(e),this[s(1754)][s(1457)]()}[t(1905)](){const e=t;this[e(525)](),this[e(2280)](this[e(794)][this[e(794)][e(1807)]-1].id)}[t(1503)](){const e=t;this._checkLayerSupport(),this[e(2280)](this.layers[0].id)}[t(1522)](){const e=t;this[e(525)](),this[e(662)](1)}[t(566)](){const e=t;this[e(525)](),this[e(662)](-1)}_goToRelativeLayer(e){const i=t,s=this[i(1357)];if(!s)throw new Error(i(2278));const n=this.layers,o=n[i(899)](s);if(-1===o)throw new Error("Could not find current layer");const r=(0,w.u)(o+e,n.length-1,0);this[i(2280)](n[r].id)}[t(999)](){const e=t;this[e(692)](),this[e(525)](),this[e(2260)][e(860)](new I(e(2035),this[e(1465)][e(1910)][e(1807)]-1,this[e(1465)]))}moveLayerToBottom(){const e=t;this._checkCanEdit(),this[e(525)](),this[e(2260)][e(860)](new I("Move Layer to Bottom",0,this._activeLayersModel))}[t(1544)](){const e=t;this[e(692)](),this[e(525)](),this[e(2260)][e(860)](new E(this._activeLayersModel))}moveLayerDown(){const e=t;this[e(692)](),this[e(525)](),this[e(2260)][e(860)](new T(this._activeLayersModel))}[t(1867)](e,i){const s=t;this[s(692)](),this._checkLayerSupport();const n=this[s(1465)].list[s(2307)]((t=>t.id===i));-1!==n&&this[s(2260)][s(860)](new S(s(2255),e,n,this._activeLayersModel))}[t(841)](e,i){const s=t;return e>=0&&e<this[s(2164)]&&i>=0&&i<this[s(918)]}[t(1922)](e,i){const s=t;this[s(692)](),this[s(2164)]===e&&this[s(918)]===i||(this[s(2164)]=e,this[s(918)]=i,this[s(2290)].fire(),this[s(721)][s(1457)](e,i))}[t(2291)](e){const i=t;this[i(794)][i(1807)]>0&&this._checkLayerSupport(),e=(0,h.pZ)(e);const s=++this._imageLayerIdCounter,n=new Q(this[i(2260)],this._selectionService,this[i(1448)],s,this[i(2070)],1===s?i(2137):i(2003)+this[i(604)](),this[i(1465)][i(608)],e,this[i(2164)],this[i(918)]);return this[i(1899)](n),n}[t(1899)](e){const i=t;(0,s.B)(e.onUpdate,this._onUpdate),(0,s.B)(e[i(1045)],this[i(1754)]),(0,s.B)(e[i(982)],this._onChangedDimensions),(0,s.B)(e.onVisibilityChange,this._onLayerVisibilityChange),(0,s.B)(e[i(1818)],this[i(1705)]),(0,s.B)(e[i(1565)],this[i(1878)]),(0,s.B)(e[i(1792)],this[i(1244)])}_getUnusedLayerLabelId(){const e=t,i=this[e(794)].map((t=>t[e(1424)]))[e(2197)]((t=>t.match(/^Layer \d+$/)))[e(928)]((t=>parseInt(t[e(2136)](6))));let s=1;for(;i[e(602)](s);)s++;return s}[t(1966)](){const e=t;this[e(1241)](this[e(1465)][e(1357)])}[t(1241)](e){const i=t;if(1===this[i(1479)]())throw new Error(i(1665));if(this[i(1465)][i(1357)]===e){let t=this[i(1465)].currentLayer-1;for(;t>0&&this[i(1465)][i(1910)][t][i(969)];)t--;if(t<0)for(t=this[i(1465)][i(1357)]+1;t<this._activeLayersModel[i(1910)][i(1807)]-1&&this[i(1465)][i(1910)][t][i(969)];)t++;this[i(1465)].currentLayer=Math[i(1445)](t,0)}const s=this._activeLayersModel[i(1910)][e];s[i(969)]=!0,this[i(2260)][i(1091)](new A(i(1119),s[i(1568)],s.id)),this[i(1637)]()}async[t(1432)](){const e=t;this._checkLayerSupport(),this._getNonSoftDeletedLayerCount()>1&&(await this._historyService[e(1384)](e(874),(async()=>{const t=e;for(let e=this[t(794)][t(1807)]-1;e>=1;e--){const i=this[t(794)][e];await i[t(983)](),await this[t(794)][e-1][t(2234)](i),this[t(1241)](e)}})),this[e(2290)].fire(),this[e(1754)][e(1457)]())}[t(1637)](){const e=t;this[e(1465)][e(1910)][0].isBottomLayer=!0;for(let t=1;t<this[e(1465)][e(1910)][e(1807)];t++)this._activeLayersModel[e(1910)][t][e(1881)]=!1}[t(796)](e){const i=t,s=this[i(1465)][i(1910)][i(2307)]((t=>t.id===e));if(-1===s)throw new Error(i(725));return s}[t(1787)](e){const i=t;return this._activeLayersModel[i(1910)][this[i(796)](e)]}[t(2060)](e){const i=t;return this._activeTemporaryLayers[i(876)](e)}_getNonSoftDeletedLayerCount(){const e=t;let i=0;for(const t of this._activeLayersModel[e(1910)])!t[e(969)]&&i++;return i}async eraseSelection(e=!1){const i=t;if(!this[i(2021)][i(1377)])return;const s=this[i(1357)];s&&(await(this[i(1357)]?.[i(983)]()),await this[i(2260)][i(1384)](i(2044),(async()=>{const t=i;this[t(2021)][t(1391)](s.width,s.height),this[t(2021)][t(2114)](t(2047));const n=this[t(2021)][t(1377)];n&&(await this[t(2260)][t(1262)](new v.Z("Erase Selection",n,s,((e,i)=>{const s=t;for(let t=n[s(800)];t<n[s(2364)];t++){const o=t*i*4;e.fill(0,o+4*n[s(2061)],o+4*n[s(511)])}}))),!e&&this._selectionService[t(865)]())})))}[t(2225)](){const e=t,s=(0,i.DI)(this.width,this[e(918)]);return this[e(2021)][e(546)]("Select All",s),s}}class at extends e.JT{constructor(e){const i=t;super(),this._attachedDisposables=[],this[i(2202)]=this[i(1502)](new s.v),this[i(640)]=this[i(2202)].event,this._onKeyDown=this[i(1502)](new s.v),this[i(1847)]=this[i(1769)][i(1362)],this[i(844)]=this[i(1502)](new s.v),this[i(2240)]=this[i(844)][i(1362)],this[i(1729)]=this[i(1502)](new s.v),this[i(1947)]=this._onPointerDown[i(1362)],this[i(1170)]=this[i(1502)](new s.v),this.onPointerDownMove=this[i(1170)][i(1362)],this._onPointerMove=this[i(1502)](new s.v),this[i(1353)]=this[i(1940)][i(1362)],this[i(1223)]=this[i(1502)](new s.v),this.onPointerUp=this[i(1223)][i(1362)],this[i(2014)]=this[i(1502)](new s.v),this[i(1540)]=this[i(2014)][i(1362)],e[i(538)]((t=>this[i(1048)](t))),this[i(1502)]({dispose:()=>this[i(1105)]?.[i(1800)]()})}get[t(1778)](){return!!this._pointerDownMoveListener}[t(1048)](i){const s=t;(0,e._c)(this[s(1292)]),this._attachedDisposables[s(1807)]=0,this[s(1502)]((0,e.Lw)(document[s(1222)],s(1426),(t=>this[s(1769)][s(1457)](t)))),this[s(1502)]((0,e.Lw)(document[s(1222)],s(1023),(t=>this[s(844)][s(1457)](t)))),this[s(1502)]((0,e.Lw)(i,s(739),(t=>{const n=s;i[n(1430)](t[n(828)]),this[n(1105)]=(0,e.Lw)(i,n(2220),(t=>this[n(1170)].fire(t))),this[n(1729)][n(1457)](t)}))),this[s(1502)]((0,e.Lw)(i,"pointerup",(t=>{const e=s;i.releasePointerCapture(t[e(828)]),this._pointerDownMoveListener?.dispose(),this._pointerDownMoveListener=void 0,this[e(1223)][e(1457)](t)}))),this[s(1502)]((0,e.Lw)(i,"dblclick",(t=>this[s(2202)].fire(t)))),this[s(1502)]((0,e.Lw)(i,s(2096),(t=>t[s(2075)]()))),this[s(1502)]((0,e.Lw)(i,"pointermove",(t=>this[s(1940)][s(1457)](t)))),this[s(1502)]((0,e.Lw)(i,s(951),(t=>this._onWheel[s(1457)](t)),{passive:!0}))}}var ht=n(8752);class ct{constructor(e,i=255){const n=t;this[n(2126)]=e,this._cached=new Map,this._onUpdate=new s.v,this.onUpdate=this._onUpdate[n(1362)],this[n(2320)]=i,this.onUpdate((()=>this._cached[n(1112)]()))}[t(1800)](){const e=t;this[e(2290)][e(1800)]()}get[t(1316)](){return this[t(2126)]}set[t(1316)](e){const i=t;this._color=e,this[i(2290)].fire()}get a(){return this._alpha}set a(e){const i=t,s=(0,w.u)(e,255,0);this[i(2320)]!==s&&(this[i(2320)]=s,this[i(2290)][i(1457)]())}get[t(1991)](){return this.hsv[0]}set hue(e){const i=t;switch(this._color[i(544)]){case i(642):if(e===this[i(2126)][0])return;this[i(2126)]=ht.mC[i(1918)](e,this[i(2126)][1],this._color[2]);break;case i(996):{const t=ht.B8[i(736)](this[i(2126)]);if(e===t[0])return;this[i(2126)]=ht.mC.createHsvColor(e,t[1],t[2]);break}}this._onUpdate[i(1457)]()}get[t(642)](){const e=t;switch(this._color.type){case e(642):return this._color;case e(996):return this[e(1983)](this[e(2126)],e(642),ht.B8[e(736)])}}set[t(642)](e){const i=t,s=this[i(2126)][i(544)]===i(642)?this[i(2126)]:ht.B8[i(736)](this._color);(0,ht.Uq)(s,e)||(this[i(2126)]=e,this[i(2290)].fire())}get[t(996)](){const e=t;switch(this[e(2126)].type){case e(642):return this[e(1983)](this._color,e(996),ht.mC[e(1583)]);case e(996):return this[e(2126)]}}set rgb(e){const i=t,s="rgb"===this._color.type?this[i(2126)]:ht.mC[i(1583)](this._color);(0,ht.Uq)(s,e)||(this._color=e,this._onUpdate.fire())}get[t(621)](){const e=t;switch(this._color[e(544)]){case e(642):return this[e(1983)](this[e(2126)],"rgba",(t=>ht.mC[e(2331)](t,this[e(2320)])));case e(996):return this._getWithCache(this[e(2126)],e(621),(t=>ht.B8.toRgba(t,this[e(2320)])))}}set[t(621)](e){const i=t,s=this[i(2126)][i(544)]===i(996)?this[i(2126)]:ht.mC[i(1583)](this[i(2126)]);s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&this[i(2320)]===e[3]||(this[i(2126)]=ht.m4[i(1583)](e),this[i(2320)]=e[3],this[i(2290)][i(1457)]())}[t(1983)](e,i,s){const n=t,o=this._cached[n(876)](i);if(o)return o;const r=s(e);return this._cached[n(917)](i,r),r}}class lt extends e.JT{constructor(){const e=t;super(),this[e(1690)]=this.register(new ct(ht.B8[e(1110)](0,0,0),255)),this[e(1277)]=this[e(1502)](new ct(ht.B8[e(1110)](255,255,255),255)),this[e(2290)]=this[e(1502)](new s.v),this[e(822)]=this[e(2290)].event,(0,s.B)(this[e(1690)][e(822)],this[e(2290)]),(0,s.B)(this[e(1277)].onUpdate,this._onUpdate)}[t(2335)](){const e=t,i=this[e(1277)][e(1316)],s=this[e(1277)].a;this[e(1277)][e(1316)]=this.primary[e(1316)],this[e(1277)].a=this[e(1690)].a,this[e(1690)][e(1316)]=i,this.primary.a=s,this[e(2290)].fire()}[t(1613)](e,i){const s=t;this[s(1273)](e),this[s(1273)](i),(!(0,ht.Uq)(this[s(1690)].rgba,e)||!(0,ht.Uq)(this[s(1277)].rgba,i))&&(this[s(1690)][s(621)]=e,this[s(1277)].rgba=i,this._onUpdate[s(1457)]())}[t(1201)](e){const i=t;return 1&e[i(1085)]?this[i(1690)][i(621)]:2&e[i(1310)]?this[i(1277)][i(621)]:void 0}[t(2389)](e){const i=t;return 1&e[i(1085)]?[this[i(1690)][i(621)],this[i(1277)][i(621)]]:[this.secondary[i(621)],this[i(1690)].rgba]}[t(1273)](e){const i=t;if(4!==e[i(1807)])throw new Error(i(1692))}}let dt=Float32Array;function ut(t,e,i,s,n,o,r=new dt(16)){return r[0]=2/(e-t),r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2/(s-i),r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2/(n-o),r[11]=0,r[12]=(t+e)/(t-e),r[13]=(i+s)/(i-s),r[14]=(n+o)/(n-o),r[15]=1,r}function mt(t,e,i,s,n=new dt(16)){var o=t[0],r=t[1],a=t[2],h=t[3],c=t[4],l=t[5],d=t[6],u=t[7],m=t[8],g=t[9],f=t[10],p=t[11],_=t[12],y=t[13],w=t[14],v=t[15];return t!==n&&(n[0]=o,n[1]=r,n[2]=a,n[3]=h,n[4]=c,n[5]=l,n[6]=d,n[7]=u,n[8]=m,n[9]=g,n[10]=f,n[11]=p),n[12]=o*e+c*i+m*s+_,n[13]=r*e+l*i+g*s+y,n[14]=a*e+d*i+f*s+w,n[15]=h*e+u*i+p*s+v,n}const gt=[0,0,0,1,1,0,1,0,0,1,1,1];function ft(e,i,s){const n=t,o=e.createProgram();if(e[n(869)](o,_t(pt(e,e[n(2052)],i))),e[n(869)](o,_t(pt(e,e[n(562)],s))),e[n(1480)](o),e[n(1011)](o,e[n(1166)]))return o;console[n(1388)](e.getProgramInfoLog(o)),e[n(1278)](o)}function pt(e,i,s){const n=t,o=_t(e.createShader(i));if(e[n(1627)](o,s),e[n(2279)](o),e[n(1890)](o,e.COMPILE_STATUS))return o;console[n(1388)](e[n(2341)](o),{source:s}),e[n(1974)](o)}function _t(e){if(!e)throw new Error(t(1290));return e}function yt(){return[new Float32Array(16),new Float32Array(16)]}function wt(e,i,s,n,o){const r=t;ut(0,e.canvas.width/window.devicePixelRatio,e[r(589)][r(918)]/window[r(1381)],0,-1,1,o[0]),mt(o[0],Math[r(2337)](e[r(589)][r(2164)]/window[r(1381)]/2)-s[r(2164)]/2*n.zoom+n.x*n.zoom,Math[r(2337)](e[r(589)].height/window.devicePixelRatio/2)-s[r(918)]/2*n[r(735)]+n.y*n[r(735)],0,o[1]),e.uniformMatrix4fv(i,!1,o[1])}function vt(e,i=e[t(589)][t(2164)],s=e.canvas[t(918)]){const n=t,o=_t(e[n(2356)]());return e[n(1089)](e[n(584)],o),e[n(651)](e[n(584)],e[n(613)],e[n(872)]),e[n(651)](e[n(584)],e[n(2011)],e.CLAMP_TO_EDGE),e[n(651)](e[n(584)],e[n(1283)],e[n(1124)]),e[n(651)](e[n(584)],e[n(1837)],e[n(1124)]),e[n(985)](e[n(584)],0,e.RGBA,i,s,0,e.RGBA,e[n(1887)],null),o}const bt=t(1693)+0+t(583)+t(798)+";\n\nvoid main() {\n  gl_Position = u_matrix * a_position;\n}",xt=t(1759);class It extends e.JT{constructor(e,i,s){const n=t;super(),this._gl=e,this[n(2258)]=i,this._viewportService=s,this[n(1365)]=2,this[n(567)]=new Float32Array(8),this[n(1745)]=yt(),this[n(884)]=!0,this._matrixNeedsUpdate=!0;const o=this[n(903)];this[n(975)]=_t(ft(o,bt,xt)),this._vertexArrayObject=_t(o[n(1911)]()),o[n(907)](this._vertexArrayObject),this._positionBuffer=_t(o[n(2229)]()),this[n(1199)]=_t(o.getUniformLocation(this._program,"u_matrix")),o[n(2107)](o[n(1826)],this[n(1653)]),o[n(1118)](0),o.vertexAttribPointer(0,2,o[n(1767)],!1,0,0),this.register(this[n(2258)][n(982)]((()=>{const t=n;this[t(884)]=!0,this[t(1716)]=!0}))),this[n(1502)](this._viewportService.onUpdate((()=>{const t=n;this[t(1716)]=!0,this[t(884)]=!0})))}render(){const e=t;if(!this[e(2258)][e(1357)])return;const i=this._gl;i[e(519)](this._program),i.bindVertexArray(this[e(575)]),this._updateAttributeBuffers(i,this._viewportService),this[e(1912)](i,this[e(921)]),i[e(1141)](i[e(2264)],0,4)}[t(1873)](e,i){const s=t;this[s(884)]&&(e[s(907)](this[s(575)]),e[s(2107)](e[s(1826)],this[s(1653)]),1===window.devicePixelRatio?(this[s(567)][0]=this[s(567)][2]=-.5,this[s(567)][1]=this[s(567)][7]=-.5,this[s(567)][4]=this[s(567)][6]=this._imageService[s(2164)]*i[s(735)]+.5,this._positionsArray[3]=this[s(567)][5]=this[s(2258)][s(918)]*i[s(735)]+.5):(this[s(567)][0]=this[s(567)][2]=0,this[s(567)][1]=this[s(567)][7]=0,this._positionsArray[4]=this[s(567)][6]=this[s(2258)][s(2164)]*i[s(735)],this._positionsArray[3]=this[s(567)][5]=this[s(2258)][s(918)]*i[s(735)]),e.bufferData(e[s(1826)],this[s(567)],e[s(638)]),this[s(884)]=!1)}[t(1912)](e,i){const s=t;this._matrixNeedsUpdate&&(wt(e,this[s(1199)],this[s(2258)],i,this[s(1745)]),this._matrixNeedsUpdate=!1)}}var St=n(3318),Ct=n.n(St),Et=n(3716),Tt=n.n(Et),Lt=n(4738),At=n.n(Lt),Rt=n(7542),Dt=n.n(Rt),Mt=n(98),Bt=n.n(Mt),kt=n(7034),Ut=n.n(kt);const Pt=new Map([[t(821),1],[t(2048),28],[t(1979),3],[t(2065),4],[t(2064),6],[t(764),8],[t(2384),9],[t(2321),11],[t(1196),13],[t(1597),14],[t(947),20],["exclusion",21]]),Ft=new Int32Array([0,1,2,3,4,5,6]);let Nt=0;class Ot extends e.JT{constructor(e,s,n){const o=t;super(),this[o(903)]=e,this[o(2258)]=s,this[o(921)]=n,this[o(1365)]=1,this._frameBufferTextures=[],this[o(2262)]=!1,this[o(1578)]=new Map,this[o(2301)]=new Float32Array(2),this._uniformValueBlendModes=new Int32Array(8);const r=this._gl;this[o(975)]=_t(ft(r,Tt(),Ct())),this[o(575)]=_t(r[o(1911)]()),r.bindVertexArray(this[o(575)]),0===Nt&&(Nt=r[o(1306)](r[o(1758)]));const a=r[o(649)](this[o(975)],o(529));this[o(1653)]=_t(r.createBuffer()),r.bindBuffer(r[o(1826)],this[o(1653)]),r[o(1702)](r.ARRAY_BUFFER,new Float32Array(gt),r[o(638)]),r[o(1118)](a),r[o(2348)](a,2,r[o(1767)],!1,0,0);const h=r[o(649)](this[o(975)],"a_texcoord");this._texcoordBuffer=_t(r[o(2229)]()),r[o(2107)](r.ARRAY_BUFFER,this[o(1698)]),r[o(1702)](r[o(1826)],new Float32Array(gt),r[o(638)]),r.enableVertexAttribArray(h),r[o(2348)](h,2,r.FLOAT,!1,0,0),this[o(1303)]=_t(r[o(2034)](this[o(975)],"a")),this._zoomLocation=_t(r[o(2034)](this[o(975)],"b")),this[o(783)]=_t(r.getUniformLocation(this[o(975)],"c")),this[o(905)]=_t(r[o(2034)](this[o(975)],"l")),this[o(1512)]=_t(r[o(2034)](this._program,"n")),this[o(1926)]=_t(r.getUniformLocation(this[o(975)],"m")),this[o(1828)]=_t(r[o(2034)](this[o(975)],"h")),this[o(1256)]=_t(r[o(2034)](this[o(975)],"d")),this[o(2294)]=_t(r[o(2034)](this[o(975)],"f")),this[o(1944)]=_t(r.getUniformLocation(this[o(975)],"g")),this._layerTexturesUniformLocation=_t(r[o(2034)](this[o(975)],"j")),this._isStencilUniformLocation=_t(r[o(2034)](this[o(975)],"k")),this[o(1860)]=_t(r[o(2034)](this[o(975)],"o")),this[o(2160)]=_t(r.createFramebuffer()),this[o(1342)]=_t(r.createTexture()),r[o(1419)](r[o(724)]),r[o(1089)](r[o(584)],this[o(1342)]),r[o(651)](r[o(584)],r[o(1283)],r[o(1686)]),r[o(651)](r.TEXTURE_2D,r[o(1837)],r[o(1124)]),r[o(651)](r[o(584)],r[o(613)],r.CLAMP_TO_EDGE),r[o(651)](r.TEXTURE_2D,r[o(2011)],r[o(872)]),r.texImage2D(r[o(584)],0,r[o(1018)],1,1,0,r[o(1018)],r[o(1887)],new Uint8Array([255,255,255,255])),this[o(1502)](this[o(2258)][o(822)]((t=>{const e=o;typeof t===e(1804)&&typeof this[e(2262)]===e(1804)?this._needsAttributeUpdate=(0,i.qi)(t,this[e(2262)]):this[e(2262)]=!0}))),this[o(1502)](this[o(2258)][o(982)]((()=>{this[o(2262)]=!0,this._updateUniformValueZoom()}))),this[o(1502)](this[o(921)].onZoomChange((()=>{this[o(1098)]()}))),this[o(1873)](),this[o(1098)](),this[o(1055)]()}[t(1922)](){const e=t,i=this[e(903)];for(;this._frameBufferTextures[e(1807)]>0;)i.deleteTexture(this._frameBufferTextures.pop());this[e(2284)]&&(i[e(749)](this[e(2284)]),this._frameBufferRenderBuffer=void 0),this[e(674)]?.[e(1922)](),this[e(1236)]?.[e(1922)](),this[e(1055)]()}[t(1352)](){const e=t,s=this[e(2258)][e(794)];if(0===s[e(1807)])return;this._needsAttributeUpdate&&(!0===this[e(2262)]?this[e(1873)]():this[e(1873)](this[e(2262)]));const n=this[e(903)];n.useProgram(this[e(975)]),n[e(907)](this[e(575)]),n[e(829)](n[e(1639)],null),n[e(1433)](n[e(1612)]);const o=this._viewportService,r=this[e(2258)];let a=-1,h=null;const c=[],l=[],d=[],u=[],m=[];let g=!1;for(const t of s){if(!t.isVisible)continue;const s=this[e(1578)][e(876)](t.id);if(s){const o=t===this[e(2258)][e(1357)];let r;o?r=l:g?((0===m[e(1807)]||7===m[m[e(1807)]-1][0][e(1807)])&&m[e(585)]([]),r=m[m[e(1807)]-1]):((0===c[e(1807)]||7===c[c[e(1807)]-1][0][e(1807)])&&c[e(585)]([]),r=c[c[e(1807)]-1]);for(let t=0;t<s[e(1268)].length;t++)!r[t]&&(r[t]=[]),r[t][e(585)](s[e(1268)][t]);if(o)if(g=!0,t.temporaryLayer?.[e(544)]!==e(1898)&&"shape"!==t[e(625)]?.type&&t[e(625)]?.[e(544)]!==e(1386)||!this[e(2258)].currentLayer[e(625)].imageTexture?.[e(1977)]){if(t[e(625)]?.type===e(2252)&&t.temporaryLayer[e(888)][e(1882)].isReady){const s=t[e(625)];if(this[e(2138)]?.temporaryLayer!==s){if(this[e(2138)]?.renderLayer){for(const t of this[e(2138)][e(1380)][e(1268)])n[e(1128)](t[e(1845)]);this._cachedMovingLayer=void 0}const t=(s[e(1995)]?.[e(1977)]?s[e(1995)]?.resource:void 0)||s[e(888)][e(1882)][e(2077)],o=_t(n.createTexture());n.activeTexture(n[e(724)]+0),n[e(1089)](n[e(584)],o),n[e(651)](n[e(584)],n[e(1283)],n.LINEAR),n[e(651)](n.TEXTURE_2D,n[e(1837)],n.NEAREST),n.texParameteri(n[e(584)],n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n[e(651)](n[e(584)],n[e(2011)],n.CLAMP_TO_EDGE),n[e(985)](n[e(584)],0,n[e(1018)],t.width,t.height,0,n[e(1018)],n[e(1887)],t[e(1253)]),this[e(2138)]={temporaryLayer:s,renderLayer:{tiles:[{blendMode:Pt[e(876)](this[e(2258)].currentLayer[e(1636)]),texture:o,textureImage:t,range:(0,i.DI)(t[e(2164)],t[e(918)]),width:t[e(2164)],height:t[e(918)],scaledWidth:s[e(2098)].scaledWidth,scaledHeight:s[e(2098)][e(873)],offsetX:s[e(2098)][e(1263)],offsetY:s[e(2098)][e(1473)],flipX:s[e(2098)][e(1206)],flipY:s[e(2098)][e(704)]}]}}}else{const t=this[e(2138)].renderLayer.tiles[0];if(t[e(1263)]=s[e(2098)].offsetX,t.offsetY=s[e(2098)][e(1473)],t[e(1206)]=s[e(2098)][e(1206)],t[e(704)]=s[e(2098)][e(704)],t.blendMode=Pt.get(this[e(2258)][e(1357)][e(1636)]),t[e(1785)]=s[e(2098)][e(1785)],t[e(873)]=s[e(2098)][e(873)],s.scaledImage?.isReady&&t[e(980)]!==s[e(1995)].resource){n[e(1128)](t[e(1845)]);const i=_t(n[e(2356)]());n[e(1419)](n[e(724)]+0),n[e(1089)](n.TEXTURE_2D,i),n[e(651)](n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n[e(651)](n[e(584)],n.TEXTURE_MAG_FILTER,n.NEAREST),n[e(651)](n[e(584)],n[e(613)],n[e(872)]),n.texParameteri(n[e(584)],n[e(2011)],n[e(872)]),n[e(985)](n.TEXTURE_2D,0,n[e(1018)],s[e(1995)][e(2077)].width,s[e(1995)][e(2077)][e(918)],0,n[e(1018)],n[e(1887)],s.scaledImage.resource.data),t.texture=i,t[e(980)]=s[e(1995)][e(2077)]}}0!==this[e(2138)][e(1380)].tiles[0][e(873)]&&0!==this[e(2138)].renderLayer.tiles[0].scaledWidth&&d[e(585)](this._cachedMovingLayer[e(1380)][e(1268)])}}else{const s=t[e(625)];if(this[e(1509)]?.[e(625)]!==s){if(this[e(1509)]?.[e(1380)]){for(const t of this[e(1509)][e(1380)][e(1268)])n[e(1128)](t[e(1845)]);this._cachedVectorLayer=void 0}const t=(s.imageTexture?.[e(1977)]?s.imageTexture?.resource:void 0)||void 0,o=s[e(2330)];if(t&&o){const r=_t(n[e(2356)]());n[e(1419)](n[e(724)]+0),n.bindTexture(n.TEXTURE_2D,r),n[e(651)](n[e(584)],n[e(1283)],n[e(1686)]),n[e(651)](n[e(584)],n[e(1837)],n[e(1124)]),n[e(651)](n[e(584)],n.TEXTURE_WRAP_S,n[e(872)]),n[e(651)](n[e(584)],n[e(2011)],n[e(872)]),n[e(985)](n.TEXTURE_2D,0,n[e(1018)],t[e(2164)],t[e(918)],0,n.RGBA,n[e(1887)],t[e(1253)]),this[e(1509)]={temporaryLayer:s,renderLayer:{tiles:[{blendMode:Pt.get(this[e(2258)].currentLayer[e(1636)]),texture:r,textureImage:t,width:t.width,height:t[e(918)],range:(0,i.DI)(t.width,t.height),offsetX:o[e(2061)],offsetY:o[e(800)]}]}}}}else{const t=this[e(1509)][e(1380)].tiles[0];t[e(1636)]=Pt.get(this[e(2258)][e(1357)].blendMode);const o=(s[e(1220)]?.isReady?s[e(1220)]?.[e(2077)]:void 0)||void 0,r=s[e(2330)];if(o&&r&&t[e(980)]!==o){n.deleteTexture(t.texture);const s=_t(n.createTexture());n[e(1419)](n[e(724)]+0),n[e(1089)](n.TEXTURE_2D,s),n[e(651)](n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n[e(651)](n[e(584)],n[e(1837)],n[e(1124)]),n[e(651)](n[e(584)],n[e(613)],n[e(872)]),n[e(651)](n.TEXTURE_2D,n.TEXTURE_WRAP_T,n[e(872)]),n[e(985)](n.TEXTURE_2D,0,n[e(1018)],o[e(2164)],o[e(918)],0,n[e(1018)],n[e(1887)],o[e(1253)]),t[e(1845)]=s,t[e(980)]=o,t[e(2164)]=o.width,t[e(918)]=o.height,t[e(1377)]=(0,i.DI)(o[e(2164)],o[e(918)]),t.offsetX=r[e(2061)],t[e(1473)]=r[e(800)]}}this[e(1509)]&&u[e(585)](this._cachedVectorLayer.renderLayer.tiles)}}}const f=[];f[e(585)](...c),l[e(1807)]>0&&f[e(585)](l),d[e(1807)]>0&&f[e(585)](d),f.push(...m);for(const[t,i]of f[e(605)]()){let s;if(t<f[e(1807)]-1?(s=this[e(684)](n,++a),n.bindFramebuffer(n.FRAMEBUFFER,this[e(2160)]),n.framebufferTexture2D(n[e(1639)],n[e(1411)],n[e(584)],s,0)):n[e(829)](n.FRAMEBUFFER,null),i===l&&"rectangle"===this[e(2258)][e(1357)][e(625)]?.[e(544)]){const c=this[e(2258)][e(1357)][e(625)];!s&&(s=this[e(684)](n,++a),n.bindFramebuffer(n[e(1639)],this[e(2160)]),n[e(1039)](n[e(1639)],n[e(1411)],n.TEXTURE_2D,s,0)),this[e(843)](n,i,!1,!1,r,o),n[e(1089)](n[e(584)],null),!this[e(1236)]&&(this._rectangleShader=new Ht(n,this[e(921)]));const l=Pt[e(876)](c[e(2098)][e(1636)]),d=c[e(778)](),u=this[e(1236)].draw(this._imageService[e(1357)],d);!this[e(674)]&&(this[e(674)]=new Vt(n)),t<f[e(1807)]-1?(s=this._blendShader.blend(s,u,l),h&&(s=this[e(674)].blend(h,s,i[0][0][e(1636)]))):h?(s=this[e(674)].blend(s,u,l),this._blendShader[e(1689)](h,s,i[0][0][e(1636)],!1)):this[e(674)].blend(s,u,l,!1),n[e(519)](this[e(975)]),n[e(907)](this[e(575)])}else if(i!==l||this[e(2258)][e(1357)][e(625)]?.[e(544)]!==e(1898)&&this[e(2258)].currentLayer[e(625)]?.[e(544)]!==e(2169)&&this[e(2258)][e(1357)].temporaryLayer?.[e(544)]!==e(1386)||!this._imageService.currentLayer[e(625)][e(1220)])i===l&&d[e(1807)]>0?(n[e(1419)](n[e(724)]+7),n.bindTexture(n[e(584)],h||this[e(1342)]),this._frameBufferRenderBuffer?n.bindRenderbuffer(n[e(1662)],this._frameBufferRenderBuffer):(this[e(2284)]=_t(n[e(1617)]()),n[e(1749)](n[e(1662)],this._frameBufferRenderBuffer),n[e(837)](n[e(1662)],n[e(997)],n[e(589)][e(2164)],n.canvas[e(918)])),n[e(827)](n.FRAMEBUFFER,n[e(2069)],n[e(1662)],this[e(2284)]),n[e(1112)](n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT|n[e(2082)]),n.enable(n[e(1810)]),n[e(1189)](n[e(510)],1,255),n.stencilOp(n[e(1532)],n[e(1532)],n.REPLACE),n[e(961)](!1,!1,!1,!1),this._renderTileSet(n,d,!1,!0,r,o),n[e(1189)](n[e(2182)],1,255),n[e(1853)](n[e(1532)],n[e(1532)],n[e(1532)]),n[e(961)](!0,!0,!0,!0),this[e(843)](n,i,!1,!1,r,o),n.bindTexture(n.TEXTURE_2D,null),n[e(1433)](n[e(1810)]),h&&(n[e(827)](n[e(1639)],n[e(2069)],n.RENDERBUFFER,null),n[e(1749)](n[e(1662)],null),!this._blendShader&&(this[e(674)]=new Vt(n)),s=this[e(674)][e(1689)](h,s,i[0][0][e(1636)]),n[e(519)](this._program),n[e(907)](this._vertexArrayObject))):(n[e(1419)](n[e(724)]+7),n[e(1089)](n[e(584)],h||this._nullTexture),this[e(843)](n,i,!!h,!1,r,o),n.bindTexture(n.TEXTURE_2D,null));else{const c=this[e(2258)][e(1357)].temporaryLayer;!s&&(s=this[e(684)](n,++a),n[e(829)](n[e(1639)],this[e(2160)]),n[e(1039)](n[e(1639)],n[e(1411)],n[e(584)],s,0)),this._renderTileSet(n,i,!1,!1,r,o),n.bindTexture(n[e(584)],null);const l=vt(n);n[e(1039)](n[e(1639)],n[e(1411)],n[e(584)],l,0),this[e(843)](n,u,!1,!1,r,o);const d=Pt[e(876)](c[e(2098)].blendMode);n[e(1089)](n[e(584)],null),n[e(827)](n[e(1639)],n.DEPTH_STENCIL_ATTACHMENT,n[e(1662)],null),n.bindRenderbuffer(n.RENDERBUFFER,null),!this[e(674)]&&(this[e(674)]=new Vt(n)),t<f[e(1807)]-1?(s=this[e(674)][e(1689)](s,l,d),h&&(s=this[e(674)].blend(h,s,i[0][0][e(1636)]))):h?(s=this[e(674)][e(1689)](s,l,d),this[e(674)][e(1689)](h,s,i[0][0][e(1636)],!1)):this[e(674)][e(1689)](s,l,d,!1),n[e(519)](this[e(975)]),n.bindVertexArray(this[e(575)])}s&&(h=s)}}[t(684)](e,i){const s=t;for(;this[s(1104)][s(1807)]<i+1;)this[s(1104)][s(585)](vt(e));return this._frameBufferTextures[i]}[t(843)](e,i,s,n,o,r){const a=t,h=new Float32Array(16),c=Math[a(2337)](e[a(589)].width/window[a(1381)]/2)-o.width/2*r[a(735)]+r.x*r.zoom,l=Math.round(e.canvas.height/window[a(1381)]/2)-o[a(918)]/2*r[a(735)]+r.y*r[a(735)];for(const t of i){const i=t[0];mt(this[a(1573)],c+i[a(1377)].left*r[a(735)],l+i[a(1377)].top*r[a(735)],0,h),e[a(904)](this[a(905)],e[a(589)].width,e[a(589)][a(918)]),e[a(1579)](this._frameBufferUniformLocation,7),e[a(1579)](this._blendWithframeBufferUniformLocation,s?1:0),e[a(1633)](this._matrixUniformLocation,!1,h),e[a(946)](this[a(2196)],Ft),e[a(904)](this[a(1410)],this._uniformValueZoom[0],this[a(2301)][1]);let d=0;for(;d<t[a(1807)];d++)this[a(1044)][d]=t[d][a(1636)],e[a(1419)](e[a(724)]+d),e.bindTexture(e[a(584)],t[d][a(1845)]);for(;d<=6;d++)e[a(1419)](e[a(724)]+d),e[a(1089)](e[a(584)],this[a(1342)]);e[a(946)](this[a(783)],this._uniformValueBlendModes),e[a(1579)](this[a(1828)],t[a(1807)]),e.uniform2f(this[a(1256)],i[a(1263)]||0,i[a(1473)]||0),e[a(904)](this[a(2294)],i[a(1785)]??i[a(2164)],i[a(873)]??i[a(918)]),e[a(904)](this[a(1944)],o[a(2164)],o[a(918)]),e[a(1579)](this[a(779)],n?1:0),e[a(904)](this._flippedAxisUniformLocation,i[a(1206)]?1:0,i[a(704)]?1:0),e[a(1141)](e[a(1404)],0,6)}}[t(1873)](e){const i=t;if(0===this[i(2258)][i(794)][i(1807)])return;this[i(2262)]=!1;const s=this._gl;s[i(907)](this[i(575)]);for(const t of this._imageService[i(794)])this[i(2090)](s,t,e)}_updateAttributeBuffersForLayer(e,i,s){const n=t;e[n(907)](this[n(575)]);let o=this[n(1578)][n(876)](i.id);!o&&(o={tiles:[]},this[n(1578)][n(917)](i.id,o)),this._updateRenderLayerTiles(e,o,i,s)}[t(1239)](e,s,n,o){const r=t,a=n[r(2164)],h=Math[r(1267)](n.height/128);let c=0;s[r(1268)][r(1807)]=h;for(let t=0;t<h;t++){const l=c,d=Math.round(n[r(918)]/h*(t+1)),u=d-c;c=d;const m={top:l,bottom:d,left:0,right:a};if(s[r(1268)][t]){if(o&&!(0,i.b8)(o,m))continue;e[r(1128)](s[r(1268)][t].texture)}const g=_t(e.createTexture());s[r(1268)][t]={width:a,height:u,range:m,texture:g,blendMode:Pt[r(876)](n[r(1636)])||1},n[r(1263)]&&(s[r(1268)][t][r(1263)]=n[r(1263)]),n[r(1473)]&&(s[r(1268)][t][r(1473)]=n[r(1473)]),e.activeTexture(e[r(724)]+0),e.bindTexture(e.TEXTURE_2D,g),e[r(651)](e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[r(1686)]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e[r(1124)]),e[r(651)](e[r(584)],e[r(613)],e[r(872)]),e.texParameteri(e[r(584)],e[r(2011)],e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,a,u,0,e[r(1018)],e.UNSIGNED_BYTE,n[r(1253)],l*n[r(2164)]*4)}}_updateUniformValueZoom(){const e=t;this._uniformValueZoom[0]=this._viewportService[e(735)]*this[e(2258)][e(2164)],this[e(2301)][1]=this._viewportService.zoom*this[e(2258)][e(918)]}[t(1055)](){const e=t;this[e(1573)]=ut(0,this._gl[e(589)].width/window[e(1381)],this._gl[e(589)].height/window[e(1381)],0,-1,1)}}class Vt{constructor(e){const i=t;this[i(903)]=e;const s=this._gl;this[i(975)]=_t(ft(s,Dt(),At())),this._vertexArrayObject=_t(s[i(1911)]()),s[i(907)](this[i(575)]),this[i(2160)]=_t(s.createFramebuffer()),this[i(2309)]=vt(s),s[i(829)](s.FRAMEBUFFER,this[i(2160)]);const n=s[i(2229)]();s[i(2107)](s[i(1826)],n),s[i(1702)](s[i(1826)],new Float32Array([-1,-1,-1,1,1,-1,1,-1,-1,1,1,1]),s[i(638)]),s[i(1118)](0),s.vertexAttribPointer(0,2,s.FLOAT,!1,0,0),this[i(1097)]=_t(s.getUniformLocation(this[i(975)],"b")),this._textureBUniformLocation=_t(s[i(2034)](this[i(975)],"c")),this[i(785)]=_t(s[i(2034)](this._program,"a"))}[t(1689)](e,i,s,n=!0){const o=t,r=this[o(903)];return r[o(519)](this[o(975)]),r[o(907)](this[o(575)]),n?(r[o(829)](r[o(1639)],this[o(2160)]),r.framebufferTexture2D(r[o(1639)],r[o(1411)],r[o(584)],this._frameBufferTexture,0)):r[o(829)](r[o(1639)],null),r[o(1419)](r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,e),r[o(1579)](this[o(1097)],0),r[o(1419)](r[o(724)]+1),r[o(1089)](r[o(584)],i),r[o(1579)](this[o(1615)],1),r[o(1579)](this[o(785)],s),r[o(1141)](r.TRIANGLES,0,6),r[o(1419)](r.TEXTURE0),r[o(1089)](r[o(584)],null),r[o(1419)](r.TEXTURE0+1),r[o(1089)](r[o(584)],null),r[o(829)](r.FRAMEBUFFER,null),this[o(2309)]}[t(1922)](){const e=t;this._gl[e(1128)](this[e(2309)]),this[e(2309)]=vt(this[e(903)])}}class Ht{constructor(e,i){const s=t;this._gl=e,this[s(921)]=i,this[s(1745)]=yt();const n=this._gl;this[s(975)]=_t(ft(n,Ut(),Bt())),this[s(575)]=_t(n.createVertexArray()),n[s(907)](this._vertexArrayObject),this._colorUniformLocation=_t(n[s(2034)](this[s(975)],"c")),this[s(1303)]=_t(n[s(2034)](this._program,"a")),this[s(2310)]=_t(n[s(2034)](this[s(975)],"b")),this._frameBuffer=_t(n[s(702)]()),this[s(2309)]=vt(n),n[s(829)](n[s(1639)],this[s(2160)]),this[s(1322)]=_t(n[s(2229)]()),n[s(2107)](n[s(1826)],this[s(1322)]),n[s(1118)](0),n[s(2348)](0,2,n[s(1767)],!1,0,0)}[t(1924)](e,i){const s=t,n=this._gl;n.useProgram(this._program),n[s(907)](this[s(575)]),n.bindFramebuffer(n[s(1639)],this[s(2160)]),n[s(1039)](n[s(1639)],n[s(1411)],n.TEXTURE_2D,this[s(2309)],0),n[s(1112)](n[s(831)]),wt(n,this[s(1303)],e,this[s(921)],this._workMatrices),n[s(904)](this[s(2310)],this[s(921)][s(735)],this._viewportService[s(735)]);for(const t of i){n[s(2242)](this[s(1346)],t[s(1968)][0]/255,t.color[1]/255,t[s(1968)][2]/255,t[s(1968)][3]/255),n[s(2107)](n.ARRAY_BUFFER,this[s(1322)]);const e=new Float32Array(12*t[s(1167)].length);for(let i=0;i<t[s(1167)].length;i++){const n=t[s(1167)][i],o=12*i;e[o]=e[o+2]=e[o+8]=n.left,e[o+1]=e[o+5]=e[o+7]=n[s(800)],e[o+4]=e[o+6]=e[o+10]=n[s(511)],e[o+3]=e[o+9]=e[o+11]=n.bottom}n.bufferData(n[s(1826)],e,n[s(2191)]),n[s(1141)](n.TRIANGLES,0,e.length/2)}return this[s(2309)]}[t(1922)](){const e=t;this[e(903)].deleteTexture(this[e(2309)]),this[e(2309)]=vt(this[e(903)])}}const zt=t(1693)+0+t(583)+t(798)+t(949)+t(798)+t(2263),jt="#version 300 es\nprecision mediump float;\n\nuniform vec4 "+t(1354)+t(1973)+t(1354)+";\n}";class Wt extends e.JT{constructor(e,i,s){const n=t;super(),this[n(903)]=e,this[n(2258)]=i,this[n(921)]=s,this[n(1365)]=2,this._positionsArray=new Float32Array(48),this[n(1745)]=yt(),this._positionsNeedsUpdate=!0,this[n(1716)]=!0,this[n(551)]=new Float32Array(4);const o=this[n(903)];this[n(975)]=_t(ft(o,zt,jt)),this[n(575)]=_t(o[n(1911)]()),o.bindVertexArray(this[n(575)]),this._positionBuffer=_t(o.createBuffer()),this._colorLocation=_t(o[n(2034)](this[n(975)],"u_color")),this[n(1199)]=_t(o.getUniformLocation(this[n(975)],n(798))),this[n(1643)](),o[n(2107)](o[n(1826)],this[n(1653)]),o[n(1118)](0),o.vertexAttribPointer(0,2,o[n(1767)],!1,0,0),this[n(1502)](this[n(2258)][n(982)]((()=>{const t=n;this[t(884)]=!0,this[t(1716)]=!0}))),this[n(1502)](this[n(921)][n(822)]((()=>{const t=n;this[t(1716)]=!0,this[t(884)]=!0})))}[t(1643)](e=3){const i=t,s=window[i(2203)](document[i(1667)])[i(2381)](i(1933)).trim();if(!s&&e>0)return void setTimeout((()=>this[i(1643)](--e)),0);const n=function(e){const i=t;switch(e[i(1807)]){case 7:return(parseInt(e[i(1019)](1),16)<<8|255)>>>0;case 9:return parseInt(e[i(1019)](1),16)>>>0}throw new Error(i(582))}(s||i(2267));this[i(551)][0]=(n>>24&255)/255,this[i(551)][1]=(n>>16&255)/255,this[i(551)][2]=(n>>8&255)/255,this._backgroundColor[3]=(255&n)/255}[t(1352)](){const e=t;if(!this._imageService.currentLayer)return;const i=this[e(903)];i[e(519)](this._program),i[e(907)](this[e(575)]),i[e(1433)](i[e(1612)]),i.uniform4f(this[e(1896)],this[e(551)][0],this[e(551)][1],this[e(551)][2],this[e(551)][3]),this[e(1873)](i,this[e(921)]),this[e(1912)](i,this[e(921)]),i[e(1141)](i[e(1741)],0,24)}_updateAttributeBuffers(e,i){const s=t;if(!this._positionsNeedsUpdate)return;e.bindVertexArray(this._vertexArrayObject),e[s(2107)](e.ARRAY_BUFFER,this[s(1653)]);const n=this[s(1181)](),o=this._positionsArray;o[0]=o[2]=o[36]=o[38]=o[40]=o[44]=n[s(2061)],o[4]=o[6]=o[32]=o[34]=o[42]=o[46]=0,o[8]=o[10]=o[18]=o[22]=o[26]=o[28]=o[30]=this[s(2258)].width*i.zoom,o[12]=o[14]=o[16]=o[20]=o[24]=n.right,o[1]=o[5]=o[9]=o[13]=n[s(800)],o[3]=o[7]=o[11]=o[15]=o[17]=o[19]=o[45]=o[47]=0,o[21]=o[23]=o[31]=o[35]=o[39]=o[41]=o[43]=this[s(2258)][s(918)]*i.zoom,o[25]=o[27]=o[29]=o[33]=o[37]=n[s(2364)],e.bufferData(e[s(1826)],this[s(567)],e[s(638)]),this[s(884)]=!1}[t(1912)](e,i){const s=t;this[s(1716)]&&(wt(e,this[s(1199)],this[s(2258)],i,this[s(1745)]),this[s(1716)]=!1)}[t(1181)](){const e=t,i=this[e(1418)](-1,-1),s=this[e(1418)](this[e(903)][e(589)].width,this[e(903)][e(589)][e(918)]);return{left:i[0],top:i[1],right:s[0],bottom:s[1]}}_screenPixelToCanvasCoord(e,i){const s=t,n=this._gl;let o=e-n[s(589)][s(2164)]/2,r=i-n[s(589)][s(918)]/2;return o+=this[s(2258)][s(2164)]*this[s(921)][s(735)]/2,r+=this[s(2258)][s(918)]*this._viewportService.zoom/2,o-=this[s(921)].x*this[s(921)][s(735)],r-=this._viewportService.y*this[s(921)][s(735)],[o,r]}}const qt="#version 300 es\nlayout (location = 0"+t(583)+"u_matrix"+t(768)+t(798)+" * a_position;\n  v_position = a_position.xy;\n}",Gt=t(2379)+t(1060)+";\n\nin vec2 v_position;\n\nout vec4 outColor;\n\nvoid main() {\n  if (mod(v_position.x / "+t(1060)+", 1.) < 1. / "+t(1060)+t(643)+t(1060)+t(859)+t(1060)+t(1795);class Xt extends e.JT{constructor(e,i,s){const n=t;super(),this[n(903)]=e,this[n(2258)]=i,this[n(921)]=s,this[n(1365)]=2,this._positionsArray=new Float32Array(8),this[n(1745)]=yt(),this[n(884)]=!0,this[n(1716)]=!0;const o=this[n(903)];this[n(975)]=_t(ft(o,qt,Gt)),this[n(575)]=_t(o.createVertexArray()),o[n(907)](this._vertexArrayObject),this[n(1653)]=_t(o[n(2229)]()),this._matrixLocation=_t(o[n(2034)](this._program,n(798))),this[n(747)]=_t(o[n(2034)](this[n(975)],n(1060))),o[n(2107)](o.ARRAY_BUFFER,this[n(1653)]),o.enableVertexAttribArray(0),o[n(2348)](0,2,o[n(1767)],!1,0,0),this[n(1502)](this[n(2258)][n(982)]((()=>{const t=n;this[t(884)]=!0,this[t(1716)]=!0}))),this[n(1502)](this[n(921)][n(822)]((()=>{const t=n;this[t(1716)]=!0,this[t(884)]=!0})))}[t(1352)](){const e=t;if(!this[e(2258)][e(1357)])return;if(!this._viewportService[e(986)]||this._viewportService[e(735)]<4)return;const i=this[e(903)];i[e(519)](this[e(975)]),i[e(907)](this[e(575)]),i[e(537)](i[e(1612)]),i[e(2119)](i[e(1065)],i[e(1621)],i.ONE,i[e(1621)]),this[e(1873)](i,this[e(921)]),this[e(1912)](i,this[e(921)]),i.uniform1f(this._pixelSizeLocation,this[e(921)][e(735)]/1),i[e(1141)](i[e(1139)],0,4)}[t(1873)](e,i){const s=t;this._positionsNeedsUpdate&&(e[s(907)](this._vertexArrayObject),e[s(2107)](e[s(1826)],this[s(1653)]),this[s(567)][4]=this[s(567)][6]=this[s(2258)][s(2164)]*i.zoom,this[s(567)][3]=this[s(567)][5]=this[s(2258)][s(918)]*i.zoom,e[s(1702)](e.ARRAY_BUFFER,this[s(567)],e[s(638)]),this[s(884)]=!1)}[t(1912)](e,i){const s=t;this[s(1716)]&&(wt(e,this[s(1199)],this._imageService,i,this[s(1745)]),this[s(1716)]=!1)}}const Yt="#version 300 es\nlayout (location = 0"+t(583)+"u_matrix"+t(949)+t(798)+t(2263),Jt=t(2379)+t(2319)+t(1557)+t(2319)+t(1740);class Kt extends e.JT{constructor(e,i,n,o){const r=t;super(),this[r(903)]=e,this[r(2258)]=i,this._selectionService=n,this[r(921)]=o,this[r(1365)]=2,this._positionsArray=new Float32Array(8),this[r(1745)]=yt(),this[r(884)]=!1,this[r(1716)]=!0,this[r(1483)]=0,this._isAnimating=!1,this[r(938)]=this[r(1502)](new s.v),this[r(1475)]=this[r(938)][r(1362)],this[r(2244)]=this[r(1502)](new s.v),this[r(1959)]=this[r(2244)][r(1362)];const a=this._gl;this[r(975)]=_t(ft(a,Yt,Jt)),this._vertexArrayObject=_t(a.createVertexArray()),a[r(907)](this[r(575)]),this[r(1653)]=_t(a[r(2229)]()),this[r(1199)]=_t(a.getUniformLocation(this[r(975)],r(798))),this[r(1988)]=_t(a[r(2034)](this[r(975)],r(2319))),a[r(2107)](a.ARRAY_BUFFER,this[r(1653)]),a.enableVertexAttribArray(0),a.vertexAttribPointer(0,2,a[r(1767)],!1,0,0),this.register(this._selectionService[r(822)]((()=>{const t=r;this[t(884)]=!0,this._isAnimating!==!!this[t(2021)][t(1377)]&&(this[t(1368)]=!!this._selectionService.range,this[t(1368)]?this[t(938)][t(1457)]():this[t(2244)][t(1457)]())}))),this[r(1502)](this._imageService.onChangedDimensions((()=>{this[r(1716)]=!0,this._positionsNeedsUpdate=!0}))),this[r(1502)](this[r(921)].onUpdate((()=>{const t=r;this[t(1716)]=!0,this[t(884)]=!0})))}render(){const e=t;if(!this[e(2258)][e(1357)])return;const i=this[e(2021)][e(1377)];if(!i)return;const s=this[e(903)];s[e(519)](this[e(975)]),s[e(907)](this[e(575)]),s[e(537)](s[e(1612)]),s[e(1416)](s[e(1065)],s.ONE_MINUS_SRC_ALPHA),this[e(1873)](s,i,this[e(921)]),this[e(1912)](s,this._viewportService),s.drawArrays(s[e(2264)],0,4)}updateAnimation(){const e=t;this[e(2088)](this[e(903)])}[t(1873)](e,i,s){const n=t;this[n(884)]&&(e.bindVertexArray(this[n(575)]),e[n(2107)](e[n(1826)],this[n(1653)]),1===window.devicePixelRatio?(this[n(567)][0]=this[n(567)][2]=i[n(2061)]*s[n(735)]-.5,this[n(567)][4]=this[n(567)][6]=i[n(511)]*s[n(735)]+.5,this[n(567)][1]=this._positionsArray[7]=i[n(800)]*s[n(735)]-.5,this[n(567)][3]=this[n(567)][5]=i[n(2364)]*s[n(735)]+.5):(this._positionsArray[0]=this[n(567)][2]=i[n(2061)]*s[n(735)],this[n(567)][4]=this[n(567)][6]=i[n(511)]*s[n(735)],this[n(567)][1]=this[n(567)][7]=i.top*s[n(735)],this[n(567)][3]=this._positionsArray[5]=i.bottom*s[n(735)]),e.bufferData(e.ARRAY_BUFFER,this[n(567)],e.STATIC_DRAW),this[n(884)]=!1)}_updateMatrixUniform(e,i){const s=t;this._matrixNeedsUpdate&&(wt(e,this[s(1199)],this[s(2258)],i,this[s(1745)]),this._matrixNeedsUpdate=!1)}[t(2088)](e){const i=t;e[i(519)](this._program),e[i(907)](this[i(575)]),this[i(1483)]=(this[i(1483)]+1)%8,e.uniform1f(this._shiftLocation,this._shiftValue)}}const $t=t(1693)+0+") in vec4 a_position;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n  gl_Position = u_matrix"+t(2263);class Zt extends e.JT{constructor(e,i,s,n,o){const r=t;super(),this._gl=e,this[r(2258)]=i,this[r(2021)]=s,this[r(2300)]=n,this[r(921)]=o,this[r(1365)]=2,this._positionArray=new Float32Array(8),this._workMatrices=yt(),this[r(884)]=!1,this._matrixNeedsUpdate=!0;const a=this[r(903)];this._program=_t(ft(a,$t,"#version 300 es\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = vec4(0.5, 0.5, 1, 0.5);\n}")),this[r(575)]=_t(a.createVertexArray()),a[r(907)](this[r(575)]),this[r(1653)]=_t(a[r(2229)]()),this[r(1199)]=_t(a[r(2034)](this[r(975)],"u_matrix")),a.bindBuffer(a.ARRAY_BUFFER,this._positionBuffer),a.enableVertexAttribArray(0),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),this[r(1502)](this[r(2021)][r(822)]((()=>this[r(884)]=!0))),this[r(1502)](this[r(921)].onUpdate((()=>{const t=r;this[t(884)]=!0,this[t(1716)]=!0})))}render(){const e=t;if(!this[e(2258)][e(1357)])return;if(!this[e(2300)].activeTool?.[e(791)])return;const i=this[e(2021)].range;if(!i)return;const s=this[e(903)];s[e(519)](this[e(975)]),s[e(907)](this._vertexArrayObject),function(e,i){const s=t;switch(i){case s(821):e[s(537)](e.BLEND),e[s(2119)](e[s(1065)],e[s(1621)],e.ONE,e.ONE_MINUS_SRC_ALPHA);break;default:throw new Error(s(1349))}}(s,e(821)),this[e(1873)](s,i,this[e(921)]),this[e(1912)](s,this[e(921)]),s[e(1141)](s.TRIANGLE_FAN,0,4)}[t(1873)](e,i,s){const n=t;this._positionsNeedsUpdate&&(e[n(2107)](e[n(1826)],this[n(1653)]),this[n(1389)][0]=this[n(1389)][2]=i[n(2061)]*s[n(735)],this[n(1389)][4]=this[n(1389)][6]=i[n(511)]*s.zoom,this[n(1389)][1]=this[n(1389)][7]=i[n(800)]*s[n(735)],this[n(1389)][3]=this[n(1389)][5]=i[n(2364)]*s[n(735)],e[n(1702)](e[n(1826)],this[n(1389)],e[n(2191)]),this[n(884)]=!1)}[t(1912)](e,i){const s=t;this[s(1716)]&&(wt(e,this[s(1199)],this._imageService,i,this._workMatrices),this[s(1716)]=!1)}}class Qt extends e.JT{constructor(i,s,n,o,r){const a=t;if(super(),this[a(1003)]=i,this[a(2258)]=s,this[a(2021)]=n,this[a(2300)]=o,this._viewportService=r,this[a(2084)]=[],this[a(1530)]=[],this._activeAnimatingRenderPrograms=new Set,this[a(896)]=0,this[a(2308)]=0,this[a(2188)]=!1,this[a(1171)]=0,this._isPaused=!1,this[a(2218)]=[],this._toolDisposables=[],this[a(966)]=document[a(808)]("canvas"),this[a(777)]=document[a(808)](a(589)),this._canvasSelection.classList[a(1857)]("animation"),this[a(2040)]=document[a(808)](a(924)),this[a(2040)][a(958)].add(a(1717)),this[a(1003)][a(1969)](this._canvas,this[a(777)],this[a(2040)]),this[a(1502)]({dispose:()=>{const t=a;this[t(966)].parentElement&&this[t(1003)].removeChild(this[t(966)]),this._canvas[t(1655)]&&this[t(1003)].removeChild(this[t(777)]),this[t(1003)][t(1132)](this[t(2040)])}}),this.register(this._viewportService[a(1850)](((t,e)=>{const i=a;this[i(696)](t,e),this[i(1352)](),this[i(1043)](!0)}))),this[a(1502)](this[a(921)][a(822)]((()=>{const t=a;this[t(1352)](),this[t(1043)](!0)}))),this[a(1502)](this[a(2021)][a(822)]((()=>this.renderSelection(!0)))),this.register(this._imageService[a(822)]((()=>this[a(1352)]()))),this[a(1502)](this[a(2258)][a(1818)]((()=>this[a(1352)]()))),this[a(1502)](this[a(2258)][a(1247)]((()=>this.render()))),this[a(1502)](this[a(2300)].onToolChange((t=>this[a(1645)](t)))),this[a(1502)]((0,e.Lw)(this._canvas,a(1338),(()=>this[a(1275)](a(1591))))),!(a(760)in window)){const t=a(1731);throw this[a(1275)](t),new Error(t)}const h=this[a(966)].getContext(a(1508),{antialias:!1,premultipliedAlpha:!1,stencil:!0});if(!h){const t=a(1946);throw this.showError(t),new Error(t)}this._gl=h,this[a(1461)]=_t(this._canvasSelection[a(573)](a(1508),{antialias:!1})),this[a(696)](this[a(1003)][a(1227)],this[a(1003)][a(2154)]),this._gl[a(682)](0,0,0,0),this[a(903)].clear(this._gl.COLOR_BUFFER_BIT),this[a(1461)][a(682)](0,0,0,0),this[a(1461)][a(1112)](this[a(903)].COLOR_BUFFER_BIT),this._renderPrograms[a(585)](new Wt(this[a(903)],this._imageService,this[a(921)])),this._renderPrograms[a(585)](new It(this._gl,this[a(2258)],this[a(921)])),this[a(2214)]=new Ot(this._gl,this[a(2258)],this[a(921)]),this[a(2084)][a(585)](new Xt(this[a(903)],this._imageService,this._viewportService)),this[a(1530)][a(585)](new Zt(this[a(1461)],this[a(2258)],this._selectionService,this[a(2300)],this[a(921)])),this[a(1530)][a(585)](new Kt(this[a(1461)],this[a(2258)],this._selectionService,this[a(921)]));for(const t of this[a(1530)])t[a(1475)]&&t[a(1959)]&&(t[a(1475)]((()=>this[a(1133)](t))),t[a(1959)]((()=>this[a(1736)](t))));const c=new MutationObserver((()=>{const t=a;this._refreshTheme(),this[t(1352)]()}));c[a(965)](document.documentElement,{attributes:!0,attributeFilter:[a(1033)]}),this[a(1502)]({dispose:()=>c[a(1553)]()}),this._refreshTheme(),this[a(1352)]();let l=this[a(2258)][a(822)]((()=>{const t=a;this[t(1003)][t(958)][t(1857)](t(1555)),l?.[t(1800)](),l=void 0}));this[a(1502)]({dispose:()=>l?.[a(1800)]()})}[t(1272)](){const e=t;for(const t of this[e(2084)])t[e(1643)]?.()}[t(696)](e,i){const s=t,n=e*window[s(1381)],o=i*window[s(1381)];this[s(966)][s(2164)]=n,this._canvas[s(918)]=o,this[s(966)][s(1033)][s(2164)]=e+"px",this[s(966)].style[s(918)]=i+"px",this._canvasSelection.width=n,this[s(777)][s(918)]=o,this[s(777)][s(1033)][s(2164)]=e+"px",this[s(777)][s(1033)].height=i+"px",this._gl[s(1116)](0,0,n,o),this[s(1461)][s(1116)](0,0,n,o),this[s(2040)][s(1033)].position=s(1393),this._viewsElement.style.left="0",this._viewsElement[s(1033)][s(800)]="0",this[s(2040)][s(1033)].right="0",this[s(2040)].style[s(2364)]="0",this[s(2214)]?.[s(1922)]()}pause(){this[t(1697)]=!0}[t(803)](){const e=t;this[e(1697)]&&(this[e(1697)]=!1,this.render(),this.renderSelection(!0))}[t(1352)](){const e=t;0===this[e(896)]&&(this[e(896)]=window[e(1250)]((()=>this[e(2122)]())))}[t(1043)](e=!1){const i=t;if(this[i(1697)]&&!e)return window[i(1586)](this[i(2308)]),void(this._selectionAnimationFrame=0);this[i(2188)]=this[i(2188)]||e,0===this._selectionAnimationFrame&&(this[i(2308)]=window.requestAnimationFrame((()=>this[i(1510)]())))}[t(2122)](){const e=t;this._renderProgramsWithOrder(this._renderPrograms,1),!this[e(2300)].activeTool?.[e(791)]&&this[e(664)](this._toolRenderPrograms,1),this._imageCanvasRenderProgram[e(1352)](),this[e(664)](this._renderPrograms,2),!this[e(2300)].activeTool?.[e(791)]&&this[e(664)](this._toolRenderPrograms,2),this[e(896)]=0}[t(1510)](){const e=t,i=!!this._selectionService[e(1377)];if(this[e(777)][e(1033)][e(627)]=e(i?751:2038),this._selectionAnimationFrame=0,!i)return void(this[e(2188)]=!1);const s=this[e(1171)]<=Date[e(676)]()-50;if(!this[e(2188)]&&!s)return this[e(2188)]=!1,void this[e(1043)]();if(this[e(2188)]=!1,s){for(const t of this[e(1530)])t[e(1525)]&&t[e(1525)]();this[e(1171)]=Date[e(676)]()}this[e(1464)].size>0&&this[e(664)](this[e(1530)],2),this[e(2300)][e(2181)]?.[e(791)]&&this[e(664)](this[e(2218)],2),this[e(1043)]()}[t(664)](e,i){const s=t;for(const t of e)t[s(1365)]===i&&t.render()}[t(1133)](e){const i=t;this[i(1464)][i(1857)](e),this[i(1043)]()}[t(1736)](e){const i=t;this[i(1464)][i(1156)](e)}setTool(i){const s=t;(0,e._c)(this._toolDisposables),this._toolDisposables[s(1807)]=0;for(const t of this[s(2218)])t[s(1800)]&&t.dispose();let n;this[s(2218)][s(1807)]=0,i[s(1809)]?n=i[s(1809)](this._gl):i[s(1670)]&&(n=i[s(1670)](this[s(2040)])),n&&(Array[s(557)](n)?this._toolRenderPrograms[s(585)](...n):this._toolRenderPrograms.push(n),i.onRequestRender&&this[s(852)][s(585)](i[s(1818)]((()=>this[s(1352)]())))),n&&this[s(1352)]()}[t(1275)](e){const i=t;this._canvas[i(1655)]&&this[i(1003)].removeChild(this[i(966)]);const s=document[i(808)]("div");s[i(590)]=e,s.style[i(545)]=i(1393),s[i(1033)][i(2061)]=i(2009),s.style[i(800)]=i(2009),s.style[i(902)]="translate(-50%, -50%)",this[i(1003)][i(958)][i(856)](i(1555)),this[i(1003)].appendChild(s)}[t(2328)](e){const i=t,s=document[i(808)](i(924));s[i(590)]=e,s[i(958)][i(1857)](i(936)),this._container[i(1484)](s),setTimeout((()=>{s.classList.add("fade"),setTimeout((()=>{s[a2_0x27c6(856)]()}),500)}),250)}}class te extends e.JT{constructor(e,i,s,n,o){const r=t;super(),this[r(1234)]=e,this[r(2258)]=i,this[r(2021)]=s,this._toolService=n,this[r(921)]=o,this.register(this[r(1234)].onAttach((t=>this[r(1048)](t)))),this[r(1502)]({dispose:()=>this[r(1777)]?.[r(1800)]()})}render(){this[t(1777)]?.render()}pause(){const e=t;this[e(1777)]?.[e(2268)]()}[t(803)](){const e=t;this[e(1777)]?.[e(803)]()}[t(1048)](e){const i=t;this[i(1777)]?.[i(1800)](),this[i(1777)]=new Qt(e,this[i(2258)],this[i(2021)],this._toolService,this[i(921)])}[t(1275)](e){const i=t;this[i(1777)]?.[i(1275)](e)}[t(2328)](e){const i=t;this[i(1777)]?.[i(2328)](e)}}class ee{constructor(e,i,s,n,o){const r=t;this._selectionService=e,this[r(875)]=i,this[r(1021)]=s,this.undoRange=n,this[r(1765)]=o,this[r(544)]="selection",this[r(1832)]=0}[t(1921)](){const e=t;this[e(1498)](this[e(536)])}redo(){const e=t;this[e(1498)](this[e(1765)])}[t(1498)](e){const i=t;this[i(2021)][i(1377)]=e?{left:e[i(2061)],top:e[i(800)],right:e[i(511)],bottom:e[i(2364)]}:void 0}[t(629)](){const e=t;return{id:"selection",operationName:this[e(875)],requiresTool:this[e(1021)],undoRange:this[e(536)],redoRange:this._redoRange}}static[t(2099)](e,i){const s=t;return new ee(e,i[s(875)],i[s(1021)],i[s(536)],i[s(1712)])}}class ie extends e.JT{constructor(e){const i=t;super(),this[i(2260)]=e,this[i(2290)]=this[i(1502)](new s.v),this.onUpdate=this._onUpdate.event,this[i(1814)]=this[i(1502)](new s.v),this.onCommit=this[i(1814)][i(1362)],this._historyService.registerHistoryEntryHandler(i(759),{undo:t=>{const e=i;t[e(1921)](this[e(1710)]),this[e(1839)]=t[e(536)]},redo:t=>{const e=i;t[e(1913)](this[e(1710)]),this[e(1839)]=t[e(536)]}}),this._historyService[i(2254)](i(759),ee[i(2099)][i(732)](null,this))}get[t(1377)](){return this[t(1710)]}set range(e){const i=t;if(e&&(e[i(2061)]>e[i(511)]||e.top>e.bottom))throw new Error(i(1417)+e[i(2061)]+i(2152)+e.right+i(2176)+e[i(800)]+i(2076)+e[i(2364)]);this[i(1710)]=e,this._onUpdate.fire()}setTopLeft(e,s){const n=t;if(!this[n(1710)])return;const o=(0,i.BN)(this[n(1377)]);(0,i.Hd)(o,e,s),this[n(1377)]=o}[t(1391)](e,i){const s=t;this[s(1710)]&&(this[s(1710)][s(2061)]>=e||this[s(1710)][s(800)]>=i||this[s(1710)][s(2364)]<=0||this._range[s(511)]<=0?this[s(1710)]=void 0:this.range={left:Math.max(this[s(1710)][s(2061)],0),top:Math.max(this[s(1710)][s(800)],0),right:Math[s(2338)](this._range.right,e),bottom:Math[s(2338)](this._range[s(2364)],i)})}[t(865)](){const e=t;this[e(1377)]=void 0,this[e(2114)]("Deselect")}[t(546)](e,i){const s=t;this[s(1377)]=i,this[s(2114)](e)}[t(2114)](e,i){const s=t;if(function(e,i){const s=t;return i&&e?e.left===i.left&&e[s(800)]===i.top&&e[s(511)]===i[s(511)]&&e[s(2364)]===i.bottom:!e&&!i}(this[s(1839)],this.range))return;const n=new ee(this,e,i,this[s(1839)],this[s(1377)]);this[s(2260)][s(2237)](e,(()=>{const t=s;this[t(2260)][t(1091)](n),this[t(1814)][t(1457)]()})),this[s(1839)]=this[s(1377)]}[t(841)](e,i){const s=t;return!this[s(1710)]||e>=this[s(1710)].left&&e<this._range[s(511)]&&i>=this[s(1710)][s(800)]&&i<this._range[s(2364)]}[t(629)](){return this._range}[t(1161)](e){this[t(1377)]=e}}var se=n(7166);class ne{constructor(e,i,s){const n=t;this[n(875)]=e,this[n(2111)]=i,this._f=s}async[t(1775)](){const e=t,s={data:(0,se.Qf)(this[e(2111)],(0,i.DI)(this[e(2111)][e(2164)],this[e(2111)][e(918)])),width:this[e(2111)][e(2164)],height:this[e(2111)][e(918)]};let n;await this[e(2111)][e(1871)]((async(t,e,i)=>(n=await this._f(t,e,i),n)));const o={data:(0,se.Qf)(n,(0,i.DI)(n.width,n[e(918)])),width:n[e(2164)],height:n[e(918)]};return new N(this[e(875)],this[e(2111)][e(1568)],this[e(2111)].id,s,o)}}class oe{constructor(e,i,s,n){const o=t;this[o(948)]=e,this[o(2258)]=i,this._width=s,this[o(1494)]=n}[t(1775)](){const e=t;if(this[e(2258)].width===this[e(816)]&&this[e(2258)][e(918)]===this._height)return;const i={width:this._imageService[e(2164)],height:this[e(2258)][e(918)]},s={width:this[e(816)],height:this[e(1494)]},n=new U(this._operationName,i,s);return n.redo(this[e(2258)][e(1922)][e(732)](this[e(2258)])),n}}class re extends e.JT{constructor(e,i,n,o){const r=t;super(),this[r(2260)]=e,this[r(2258)]=i,this[r(2021)]=n,this[r(1448)]=o,this[r(2073)]=this[r(1502)](new s.v),this[r(1677)]=this[r(2073)].event,this[r(1684)]=this[r(1502)](new s.v),this[r(1737)]=this[r(1684)].event}async[t(1629)](e,i){const s=t,n=this[s(2258)][s(794)];if(0===n[s(1807)])return;await this[s(1684)][s(1671)](this[s(1066)](e));const o={left:0,top:0,right:this._imageService[s(2164)],bottom:this[s(2258)].height},r="Image: "+ae(e);await this[s(2260)][s(1384)](r,(async()=>{const t=s;let a;for(const t of n)a=await this._doExecuteOnLayer(e,i,t,r,o);a&&(a.dest[t(2164)]!==o[t(511)]||a[t(1958)].height!==o[t(2364)])&&this[t(2260)][t(860)](new oe(t(1956),this[t(2258)],a[t(1958)].width,a[t(1958)].height)),a?.[t(759)]!==this[t(2021)][t(1377)]&&(this[t(2021)][t(1377)]=a?.selection,this[t(2021)][t(2114)](t(667)))}))}async[t(1797)](e,i){const s=t,n=this._imageService[s(1357)];if(!n)return;await this[s(1684)][s(1671)](this[s(1066)](e));const o={left:0,top:0,right:n[s(2164)],bottom:n[s(918)]},r=s(1242)+ae(e);await this._historyService[s(1384)](r,(async()=>{const t=s,a=await this[t(1620)](e,i,n,r,o);if(a?.[t(759)]!==this[t(2021)].range&&(this._selectionService[t(1377)]=a?.selection,this[t(2021)].commit(t(667))),a&&(a.dest.width!==o[t(511)]||a.dest.height!==o[t(2364)]))throw new Error(t(2206))}))}async[t(1620)](e,i,n,o,r){const a=t;let h;return await this._historyService[a(1262)](new ne(o,n,(async(t,n,o)=>{const r=a,c=this[r(1448)][r(1824)](e,i,{data:t,width:n,height:o},this._selectionService.range);return(0,s.B)(c[r(1677)],this[r(2073)]),h=await c[r(973)],h[r(1958)]}))),h}[t(1066)](t){return{finishSelection:"layer/expandCanvasToSelection"!==t}}}function ae(e){const i=t;switch(e){case i(782):return i(1115);case"layer/cropToSelection":return"Crop to Selection";case i(1593):return i(1320);case i(631):return"Flip Horizontal";case i(1271):return"Flip Vertical";case i(576):return i(660);case i(595):return i(1956);case i(1897):return"Resize Canvas";case"layer/rotate180":return i(1409);case i(2257):return i(1428);case i(2212):return i(1519);default:return i(1866)}}function he(){return new Worker(n.p+"task.worker.worker.js")}const ce=new Map;ce[t(917)](t(1285),(e=>(0,i.rY)(e[t(1377)]))),ce.set("cutImage",(e=>e[t(1255)][t(918)])),ce.set("drawLine",(()=>1)),ce[t(917)](t(2222),(()=>1)),ce[t(917)]("drawText",(()=>1)),ce.set(t(560),(t=>(0,i.rY)(t.range))),ce.set(t(1549),(()=>1)),ce[t(917)](t(1752),(()=>1)),ce[t(917)](t(665),(e=>e[t(1674)][t(918)])),ce.set(t(2221),(t=>(0,i.rY)(t.putRange)));let le=!1;class de extends e.JT{get[t(2217)](){return le}set[t(2217)](t){le=t}[t(1824)](t,e,i,s){return new me(t,e,i,s)}[t(2314)](t,e){return new ge(t,e,this._getJobDimension(t,e)).result}_getJobDimension(e,i){const s=t,n=ce[s(876)](e);if(!n)throw new Error(s(1949)+e+'"');return n(i)}async generateLayerPreview(e,i,s){const n=t,o={sourceImage:e,destImage:(0,se.uF)(i,s)};await this[n(2314)](n(665),o);const r=new ImageData(new Uint8ClampedArray(o[n(1674)][n(1253)]),o.destImage.width,o[n(1674)][n(918)]);return createImageBitmap(r)}}class ue extends e.JT{constructor(e,i){const n=t;super(),this[n(507)]=e,this._progress=i,this._progressLast=0,this._progressTimeout=0,this[n(2073)]=this[n(1502)](new s.v),this.onProgress=this[n(2073)][n(1362)],this[n(1518)]=performance.now(),this[n(714)]=setInterval((()=>this[n(934)]()),1e3)}[t(2001)](){const e=t;this._reportInterval&&(clearInterval(this[e(714)]),this._reportInterval=0,this[e(934)]())}[t(1796)](e,i){const s=t;this[s(516)][e]=i,this[s(671)]()}[t(671)](){const e=t;!this._progressTimeout&&(this[e(1619)]=window.setTimeout((()=>{this[e(2233)](),this._progressTimeout=0}),0))}[t(2233)](){const e=t,i=this[e(516)][e(1180)](((t,e)=>t+e),0)/this[e(516)][e(1807)];this._progressLast!==i&&(this[e(2073)][e(1457)](i),this[e(944)]=i)}[t(934)](){const e=t,i=this[e(516)].reduce(((t,e)=>t+e),0)/this[e(516)][e(1807)],s=Math[e(2337)](i/.05),n=20-s;let o="["+"█"[e(1398)](s)+" ".repeat(n)+"]";if(1===i){const t=" "+(performance[e(676)]()-this[e(1518)]).toFixed(0)+e(1950);o="["+t[e(1980)](t[e(1807)]+Math.floor((20-t[e(1807)])/2),"█")[e(2103)](20,"█")+"]"}console.info(o+" "+Math[e(2337)](100*i)[e(993)]()[e(1980)](3," ")+"% "+this[e(507)])}}class me extends ue{constructor(e,s,n,o){const r=t,a=r(2164)in s&&"height"in s;let h=a?s[r(2164)]:n[r(2164)],c=a?s.height:n[r(918)];switch(e){case r(2125):if(!o)throw new Error(r(1103));h=(0,i.Oq)(o),c=(0,i.rY)(o);break;case r(1593):if(!o)throw new Error(r(603));const t=(0,i.DI)(n[r(2164)],n[r(918)]),e=(0,i.qi)(t,o);h=(0,i.Oq)(e),c=(0,i.rY)(e);break;case r(2257):case r(2212):h=n[r(918)],c=n[r(2164)]}const l=h*c*4,d=r(1958)in s?s[r(1958)]:{data:new Uint8Array(new SharedArrayBuffer(l)),width:h,height:c},u=[],m=Math[r(2338)](navigator[r(990)]||1,Math[r(1445)](d.height/100,1));super(e,new Float32Array(m));for(let t=0;t<m;t++){const i={id:t,yStart:Math.floor(t/m*d[r(918)]),yEnd:Math.min(Math.floor((t+1)/m*d[r(918)]),d[r(918)]),xStart:Math[r(1870)](t/m*d[r(2164)]),xEnd:Math.min(Math.floor((t+1)/m*d[r(2164)]),d[r(2164)])};u[r(585)](this[r(1582)](e,s,n,d,o,i))}this[r(973)]=Promise[r(2295)](u)[r(653)]((()=>{const t=r;return this[t(2001)](),{selection:this[t(759)],dest:d}})).catch((t=>{throw this[r(2001)](),t}))}[t(1582)](t,e,i,s,o,r){return new Promise((async(a,h)=>{const c=a2_0x27c6;let l;if(le){const t=await n.e(174)[c(653)](n[c(732)](n,9174));l=new fe(t[c(972)])}else l=new he;const d={type:c(1827),taskName:t,source:i,dest:s,selection:o,options:e,job:r};l[c(1694)](d),l.onmessage=e=>{const i=c;switch(e[i(1253)][i(544)]){case i(2016):this[i(1796)](r.id,1),this[i(759)]=e[i(1253)].selection,a(),l[i(1025)]();break;case"error":this[i(1796)](r.id,1),h('Task "'+t+i(1713)+e.data[i(1580)]),l.terminate();break;case"progress":this[i(1796)](r.id,e[i(1253)][i(1295)])}}}))}}class ge extends ue{constructor(e,i,s){const n=t,o=[],r=Math.min(navigator[n(990)]||1,Math.max(Math.ceil(s/100),1));super(e,new Float32Array(r));for(let t=0;t<r;t++){const a=Math.floor(t/r*s),h=Math[n(1870)]((t+1)/r*s),c={id:t,start:a,end:h,size:h-a};o[n(585)](this[n(1582)](e,i,c))}this.result=Promise[n(2295)](o)[n(653)]((t=>{const e=n;return this[e(2001)](),0===t[e(1807)]?void 0:t[0]}))[n(1084)]((t=>{throw this[n(2001)](),t}))}[t(1582)](t,e,i){return new Promise((async(s,o)=>{const r=a2_0x27c6;let a;if(le){const t=await n.e(174)[r(653)](n.bind(n,9174));a=new fe(t[r(972)])}else a=new he;const h={type:r(2219),taskName:t,args:e,job:i};a[r(2051)]=e=>{const n=r;switch(e[n(1253)][n(544)]){case n(2016):this[n(1796)](i.id,1),s(e[n(1253)][n(973)]),a[n(1025)]();break;case n(1388):this[n(1796)](i.id,1),o(n(1412)+t+'" failed: '+e[n(1253)][n(1580)]),a[n(1025)]();break;case n(2343):this[n(1796)](i.id,e.data.percent)}},a.postMessage(h)}))}}class fe{constructor(e){const i=t;this.onmessage=()=>{},this._messageHandler=e(this[i(889)].bind(this))}[t(1694)](e){this[t(550)]({data:e})}[t(1025)](){}[t(889)](e){this[t(2051)]({data:e})}}const pe=new Map([[t(2353),{file:t(2353)}],["crop",{file:t(1511)}],["eraser",{file:t(1695)}],[t(1348),{file:t(1348)}],[t(2388),{file:t(2388)}],[t(1898),{file:"line"}],[t(1035),{file:t(1035)}],[t(2148),{file:t(2148)}],["pencil",{file:t(967)}],[t(2327),{file:t(2327)}],[t(759),{file:t(759)}],[t(2169),{file:"shape"}],[t(1386),{file:t(1386)}],[t(735),{file:t(735)}]]);class _e extends e.JT{constructor(e,i,n,o,r,a,h,c,l){const d=t;super(),this._configService=e,this[d(2260)]=i,this[d(2258)]=n,this[d(1635)]=o,this[d(1773)]=r,this._selectionService=a,this._taskService=h,this[d(1448)]=c,this[d(921)]=l,this._isPointerDown=!1,this._pointerDownStartTime=0,this[d(1891)]=0,this[d(2081)]=0,this._onToolChange=this[d(1502)](new s.v),this[d(2053)]=this[d(1569)].event,this[d(942)]={configService:this[d(2159)],historyService:this._historyService,imageService:this[d(2258)],paletteService:this[d(1773)],selectionService:this[d(2021)],taskService:this._taskService,taskWorkerService:this[d(1448)],viewportService:this[d(921)]},this[d(1635)].onPointerDown((t=>{const e=d;this[e(943)]=!0,document[e(1222)][e(958)][e(1259)]("mouseleft",0===t[e(1310)]),document[e(1222)][e(958)][e(1259)](e(1092),2===t[e(1310)]),this._lastPointerEvent=t})),this[d(1635)][d(1107)]((t=>this[d(1081)]=t)),this._inputService[d(1353)]((t=>this[d(1081)]=t)),this[d(1635)][d(1016)]((()=>{const t=d;this[t(943)]=!1,document.body[t(958)][t(856)]("mouseleft"),document[t(1222)][t(958)][t(856)](t(1092))})),this[d(1502)](this[d(921)][d(822)]((()=>{const t=d;if(this[t(1081)]){const e=this[t(1781)]||this.activeTool;e?.[t(1491)]?.(this[t(1081)],this[t(943)]),this[t(943)]&&e?.[t(1360)]?.(this._lastPointerEvent)}}))),this._inputService[d(2240)]((t=>{const e=d;t.key===this[e(840)]&&(this._activeUntilReleaseToolKey=void 0,this[e(1343)]())})),this[d(2260)][d(1031)]((t=>this.setTool(t))),this[d(2258)][d(1565)]((t=>{const e=d;"moving"===t[e(544)]&&this[e(1645)](e(1035))})),this[d(2260)].onUndo((()=>this[d(577)]())),this[d(2260)][d(1235)]((()=>this[d(577)]())),this[d(1635)][d(1947)]((t=>{const e=d;this[e(1136)]=Date[e(676)](),this[e(1891)]=t[e(1263)],this[e(2081)]=t[e(1473)]})),this._forwardEventToTool(this[d(1635)][d(640)],d(1642)),this[d(620)](this._inputService.onKeyDown,d(740)),this[d(620)](this._inputService[d(2240)],d(2101)),this._forwardEventToTool(this._inputService[d(1947)],d(2247)),this[d(620)](this[d(1635)][d(1107)],d(1360)),this._forwardEventToTool(this._inputService.onPointerMove,"pointerMove"),this[d(1502)](this[d(1635)][d(1016)]((t=>{const e=d,i=Math[e(2091)](this[e(1891)]-t[e(1263)]),s=Math[e(2091)](this[e(2081)]-t[e(1473)]);let n=!1;i<10&&s<10&&Date.now()-this._pointerDownStartTime<150&&(n=!0),(this._activeUntilReleaseTool||this[e(2181)])?.[e(848)]?.(t,n),void 0===this[e(840)]&&this._clearUntilReleaseTool()})))}get[t(2181)](){return this[t(502)]}async[t(1645)](e,i){const s=t;if(e===this[s(502)]?.id)return;if(i?.untilRelease&&this[s(1781)])return;if(!i?.[s(1751)]&&this[s(502)]?.[s(1800)](),typeof e!==s(2008))return void(i?.[s(1751)]?(this[s(1781)]=e,this._activeUntilReleaseToolKey=i[s(1751)]):this[s(502)]=e);const n=pe.get(e);if(!n)throw new Error(s(1720)+e);if(!n.factory){this[s(502)]=void 0;const t=await this[s(1429)](s(2370),n.file);n[s(720)]=e=>new t(e)}const o=n[s(720)](this._sc);i?.[s(1751)]?(this._activeUntilReleaseTool=o,this[s(840)]=i[s(1751)]):this[s(502)]=o,document[s(1222)][s(2178)]("data-active-tool",o.id),this._refreshToolState(o),o[s(1952)]&&o[s(1952)]((()=>this[s(555)](o))),this[s(1569)][s(1457)](o)}[t(555)](e){const i=t;e.state?document[i(1222)][i(2178)](i(1024),e[i(2316)]):document[i(1222)].removeAttribute("data-tool-state")}[t(1343)](){const e=t;this[e(1781)]&&!this._isPointerDown&&(this[e(840)]||(this[e(1781)]=void 0,this[e(2181)]&&(document[e(1222)][e(2178)](e(1248),this.activeTool.id),this._refreshToolState(this.activeTool),this[e(1569)][e(1457)](this.activeTool))))}async[t(1429)](e,i){const s=t,o=await n(1038)("./"+e+"/"+i+s(1339));if(!o)throw new Error("Could not load tool "+i+s(1467));return o[s(2133)]}[t(620)](e,i){const s=t;this[s(1502)](e((t=>{const e=s,n=this[e(1781)]||this[e(2181)],o=n?n[i]:void 0;o&&o.bind(n)(t,this[e(1635)]?.[e(1778)])})))}[t(577)](){const e=t;this[e(1081)]&&window[e(2049)]((()=>{const t=e;this._lastPointerEvent&&(this[t(1781)]||this.activeTool)?.[t(1491)]?.(this._lastPointerEvent,this._isPointerDown)}))}[t(629)](){const e=t;return{activeToolId:this[e(502)]?.id,activeToolState:this.activeTool?.[e(629)]?.()}}[t(1161)](e){const i=t;e[i(868)]&&this[i(1645)](e[i(868)])[i(653)]((()=>{const t=i;e.activeToolState&&(this[t(502)]?this._activeTool.deserialize?this._activeTool[t(1161)](e[t(994)]):console.error('No matching deserialize call for tool "'+e[t(868)]+'"'):console[t(1388)](t(1681)+e[t(868)]+'"'))}))}}var ye=n(7896);const we=new Uint16Array([1,2,3,4,5,6,7,8,9,10,11,12,13,15,17,19,21,24,27,30,34,38,43,48,54,60,64,70,76,82,90,100]);class ve extends e.JT{constructor(e,i,n,o){const r=t;super(),this._configService=e,this._elementService=i,this._imageService=n,this[r(1439)]=r(1623),this[r(762)]=20,this[r(2128)]=!0,this[r(2226)]=!1,this._x=0,this._y=0,this[r(1528)]={x:0,y:0},this[r(2256)]=0,this._onUpdate=this[r(1502)](new s.v),this[r(822)]=this[r(2290)].event,this[r(2141)]=this[r(1502)](new s.v),this[r(1850)]=this[r(2141)][r(1362)],this._onPixelGridEnabledChange=this[r(1502)](new s.v),this[r(668)]=this._onPixelGridEnabledChange[r(1362)],this[r(2066)]=this[r(1502)](new s.v),this[r(1144)]=this._onZoomChange[r(1362)],this._onPointerCoordChange=this[r(1502)](new s.v),this.onPointerCoordChange=this[r(801)][r(1362)],this._configService[r(1229)]((t=>this.mouseWheelBehavior=t[r(1439)])),this[r(1502)](this._imageService.onChangedDimensions((()=>this[r(2120)]()))),this[r(1502)](this._elementService.onAttach((t=>{const e=r;this[e(795)]?.disconnect(),this._elementResizeObserver=new ResizeObserver((([t])=>{const i=e;this._onDimensionsChange.fire(t[i(2002)][i(2164)],t[i(2002)][i(918)]),this[i(2290)][i(1457)]()})),this._elementResizeObserver[e(965)](t)}))),this.register({dispose:()=>{const t=r;this[t(795)]?.[t(1553)]()}}),this[r(1502)](o[r(1540)]((t=>this[r(1466)](t)))),this[r(1502)](o[r(1107)]((t=>this[r(1129)](t)))),this[r(1502)](o[r(1353)]((t=>this[r(1158)](t)))),this[r(1502)](o[r(1016)]((()=>this._handlePointerUp())))}get[t(1499)](){const e=t,i=this._elementService[e(1993)];if(!i)throw new Error(e(1536));const s=i.offsetWidth/this[e(735)],n=i[e(599)]/this.zoom,o=this._imageService[e(2164)]/2-this._x,r=this[e(2258)][e(918)]/2-this._y;return{left:Math[e(1445)](o-s/2,0),right:Math.min(o+s/2,this[e(2258)][e(2164)]),top:Math[e(1445)](r-n/2,0),bottom:Math.min(r+n/2,this._imageService[e(918)])}}get zoom(){const e=t;return parseFloat(this._zoom[e(1701)](2))}set[t(735)](e){const i=t;e<=0||(this[i(762)]=e,this._onUpdate[i(1457)](),this[i(2066)][i(1457)]())}get[t(986)](){return this._isPixelGridEnabled}set[t(986)](e){const i=t;e!==this._isPixelGridEnabled&&(this[i(2128)]=e,this._onUpdate.fire(),this[i(825)][i(1457)]())}get x(){return this._x}set x(e){const i=t,s=this[i(2258)][i(2164)]/2;this._x=(0,w.u)(e,s,-s),this[i(2290)][i(1457)]()}get y(){return this._y}set y(e){const i=t,s=this._imageService[i(918)]/2;this._y=(0,w.u)(e,s,-s),this[i(2290)][i(1457)]()}[t(1663)](e=.2){return this[t(2023)](e)}[t(1260)](e=.2){return this[t(2023)](-e)}[t(2120)](){const e=t,i=this[e(1234)][e(1993)];if(!i)return;const s=(i[e(1087)]-10)/this[e(2258)][e(2164)],n=(i[e(599)]-10)/this[e(2258)][e(918)];this[e(735)]=Math[e(2338)](s,n),this._x=0,this._y=0,this[e(2226)]=!0,this._onUpdate[e(1457)]()}[t(1771)](){const e=t,s=this[e(2258)][e(1357)];if(!s)return;const n=s[e(1099)];(0,i.Bu)(n)||this[e(1931)]([n[e(2061)],n[e(800)]],[n[e(511)],n[e(2364)]])}fitToCoords(e,i){const s=t,n=this[s(1234)][s(1993)];if(!n)return;const o=(n[s(1087)]-10)/(i[0]-e[0]),r=(n[s(599)]-10)/(i[1]-e[1]);this[s(735)]=Math[s(2338)](o,r,100),this._x=-((i[0]+e[0])/2-this[s(2258)].width/2),this._y=-((i[1]+e[1])/2-this[s(2258)][s(918)]/2),this[s(2290)][s(1457)]()}[t(1466)](e){const i=t;if(this._elementService.element){if(this[i(1439)]===i(1623)&&e[i(2326)]||"zoom"===this[i(1439)]&&!e[i(2326)]){const t=this[i(735)],s=ye.V5?e[i(1243)]<0?this.zoomIn(-e[i(1243)]/20):this[i(1260)](e[i(1243)]/20):e[i(1243)]<0?this.zoomIn():this.zoomOut(),n=s/t;if(t!==s){const t=(e[i(2028)]-this[i(1234)][i(1993)][i(1227)]/2)*(n-1),o=(e[i(2118)]-this[i(1234)][i(1993)][i(2154)]/2)*(n-1);this.x-=t/s,this.y-=o/s}}else!ye.V5&&e.shiftKey?this.x-=this._normalizeWheelDelta(e[i(1243)])/this[i(735)]:(this.x-=this[i(663)](e[i(2056)])/this[i(735)],this.y-=this[i(663)](e[i(1243)])/this[i(735)]);this[i(2226)]=!1,e[i(2075)]()}}[t(663)](e){const i=t;return ye.V5?e:Math[i(2091)](e)<100?40*e:e}_handlePointerDownMove(e){const i=t,s=this[i(1234)][i(1993)];s&&(e[i(1263)]<30?this[i(1528)].x=this[i(2363)](30-e[i(1263)]):e[i(1263)]>s.clientWidth-30?this._scrollVelocity.x=-this[i(2363)](e[i(1263)]-s[i(1227)]-30):this[i(1528)].x=0,e.offsetY<30?this[i(1528)].y=this[i(2363)](30-e[i(1473)]):e[i(1473)]>s[i(2154)]-30?this[i(1528)].y=-this[i(2363)](e[i(1473)]-s.clientHeight-30):this[i(1528)].y=0,!this._scrollInterval&&(this._outOfFrameScroll(),this._scrollInterval=setInterval((()=>this[i(1884)]()),16)))}[t(1158)](e){const i=t,s=this[i(1806)](e);if(void 0!==s||void 0!==this[i(1468)])return void 0===s||void 0===this[i(1468)]?(this[i(1468)]=s,void this[i(801)][i(1457)](this[i(1468)])):void(s[0]===this[i(1468)][0]&&s[1]===this[i(1468)][1]||(this._pointerCoord=s,this[i(801)][i(1457)](this._pointerCoord)))}_calculateScrollVelocity(e){const i=t;return 1+Math.pow(Math[i(1445)](e/20,3),2)}[t(1228)](){const e=t;this[e(1528)].x=0,this[e(1528)].y=0,clearInterval(this._scrollInterval),this[e(2256)]=0}_outOfFrameScroll(){const e=t;this[e(2226)]||(this[e(1528)].x&&(this.x+=1*this[e(1528)].x/this[e(735)]),this._scrollVelocity.y&&(this.y+=1*this[e(1528)].y/this[e(735)]))}[t(2023)](e){const i=t,s=this[i(762)]+this._zoom*e;if(s<=.02)return this[i(762)]=.02,this[i(762)];let n=-1;if(e>0){for(const t of we)if(t>this[i(762)]){n=t;break}if(-1===n)return this[i(762)];this[i(762)]=n<s?n:s}else{for(const t of we){if(t>=this[i(762)])break;n=t}this[i(762)]=n>s?n:s}return this[i(2290)].fire(),this[i(2066)][i(1457)](),this[i(762)]}[t(552)](e){const i=t,s=this[i(1076)](e);return[Math[i(1870)](s[0]),Math[i(1870)](s[1])]}[t(1076)](e){const i=t,s=this[i(1234)].element;if(!s)throw new Error("Cannot get coords without element");let n=e.offsetX-Math.floor(s[i(1227)]/2),o=e.offsetY-Math[i(1870)](s[i(2154)]/2);return n/=this[i(735)],o/=this.zoom,n+=this[i(2258)].width/2,o+=this[i(2258)][i(918)]/2,n-=this.x,o-=this.y,[n,o]}getSnapSettingCoordsFromEvent(e,i){const s=t;return i&&!this[s(2159)][s(1203)][s(505)]?this.getFineCoordsFromEvent(e):this[s(552)](e)}[t(1660)](e){const i=t,s=this[i(1234)][i(1993)];if(!s)throw new Error(i(2124));let n=e[0],o=e[1];return n+=.5,o+=.5,n+=this.x,o+=this.y,n-=this[i(2258)][i(2164)]/2,o-=this[i(2258)][i(918)]/2,n*=this.zoom,o*=this[i(735)],n+=Math[i(1870)](s[i(1227)]/2),o+=Math[i(1870)](s[i(2154)]/2),n=Math[i(2337)](n),o=Math.round(o),[n,o]}[t(1806)](e){const i=t,s=this.getCoordsFromEvent(e);if(!(s[0]<0||s[0]>=this[i(2258)][i(2164)]||s[1]<0||s[1]>=this[i(2258)][i(918)]))return s}[t(629)](){const e=t;return{x:this._x,y:this._y,zoom:this[e(762)]}}[t(1161)](e){const i=t;this._x=e.x,this._y=e.y,this[i(762)]=e[i(735)],this[i(2290)][i(1457)](),this._onZoomChange[i(1457)]()}}class be extends e.JT{constructor(e){const i=t;super(),this[i(744)]=e,this[i(2095)]=this[i(1502)](new s.v),this[i(1229)]=this[i(2095)].event}get[t(1203)](){return this[t(744)]}set[t(1203)](e){const i=t;!this[i(1150)](e)&&(this[i(744)]=e,this._onConfigChanged[i(1457)](this._config))}[t(1150)](e){const i=t,s=Object.keys(this[i(744)]);if(s[i(1807)]!==Object[i(1742)](e)[i(1807)])return!1;for(const t of s)if(this[i(744)][t]!==e[t])return!1;return!0}}class xe extends e.JT{constructor(e){const i=t;super(),this[i(2159)]=this.register(new be(e)),this[i(1234)]=this[i(1502)](new o),this[i(1773)]=this[i(1502)](new lt),this[i(2260)]=this[i(1502)](new a),this[i(1448)]=this[i(1502)](new de),this[i(2021)]=this[i(1502)](new ie(this._historyService)),this[i(2258)]=this[i(1502)](new rt(this[i(2260)],this[i(2021)],this[i(1448)])),this[i(1635)]=this.register(new at(this[i(1234)])),this[i(921)]=this[i(1502)](new ve(this[i(2159)],this[i(1234)],this[i(2258)],this[i(1635)])),this[i(527)]=this[i(1502)](new p(this[i(2260)],this[i(2258)],this[i(2021)],this[i(921)])),this._taskService=this[i(1502)](new re(this[i(2260)],this[i(2258)],this[i(2021)],this[i(1448)])),this[i(2300)]=this.register(new _e(this._configService,this._historyService,this._imageService,this._inputService,this[i(1773)],this[i(2021)],this[i(1943)],this[i(1448)],this[i(921)])),this._renderService=this.register(new te(this[i(1234)],this[i(2258)],this[i(2021)],this[i(2300)],this[i(921)])),this[i(1203)]=new Ie(this[i(2159)]),this[i(1903)]=new Se(this[i(2260)],this[i(527)],this[i(2258)],this._selectionService,this[i(2300)],this[i(921)]),this[i(1280)]=new Ce(this._historyService),this[i(1882)]=new Ee(this[i(527)]),this[i(2386)]=new Te(this._imageService,this[i(2021)],this[i(1448)]),this[i(1965)]=new Ae(this[i(1773)]),this[i(1352)]=new Re(this[i(883)]),this[i(759)]=new De(this._imageService,this[i(2021)]),this.task=new Me(this[i(1943)],this._taskWorkerService),this.test=new Be(this._viewportService),this[i(1294)]=new ke(this[i(2300)]),this[i(1116)]=new Ue(this[i(1234)],this[i(921)])}}class Ie{constructor(e){this[t(2159)]=e}get[t(1673)](){const e=t;return this._configService[e(1203)]}set[t(1673)](e){this[t(2159)].config=e}}class Se{constructor(e,i,s,n,o,r){const a=t;this[a(2260)]=e,this[a(527)]=i,this[a(2258)]=s,this[a(2021)]=n,this[a(2300)]=o,this[a(921)]=r}get[t(2297)](){const e=t;return this._imageService[e(2297)]}get[t(2153)](){const e=t;return this[e(2258)][e(2153)]}exportBlob(e){const i=t;return this._imageFileService[i(1146)](e)}[t(1062)](e){return this[t(527)].exportBlobClone(e)}[t(1829)](){const e=t;return this[e(2258)][e(1829)]()}[t(2010)](){const e=t;return this[e(2258)][e(2010)]()}async[t(2132)](e,i,s){const o=t,r=i[o(929)]();switch(r){case".ico":const t=(await n.e(959)[o(653)](n[o(732)](n,6959)))[o(1967)],i=await t(e);await Promise[o(1841)](i.map((t=>t.readyPromise))),await this[o(1165)](o(1088),i[o(928)]((t=>t[o(2077)])),s);break;default:let a;switch(r){case o(2195):case o(2354):case".jpg":case o(906):a=o(1801);break;case o(1821):a="image/png";break;case o(1402):case o(553):a=o(911);break;case o(1476):a=o(1420);break;default:throw new Error('Unrecognized file extension "'+r+'"')}await this[o(1848)](a,new Blob([e],{type:a}),s)}}async[t(1987)](e,i,s){const n=t;this[n(527)].openImage(e,i,s),this[n(921)][n(2120)]()}async[t(1165)](e,i,s){const n=t;this[n(527)].openImage(e,i,s),this[n(921)][n(2120)]()}async[t(1848)](e,i,s){const n=t;await this[n(2258)].openBlob(e,i,s),this[n(921)][n(2120)]()}[t(2375)](e,i,s){const n=t,o=s===n(1214)?"image/x-ico":"image/png";this[n(527)][n(2375)](o,e,i),this._viewportService[n(2120)]()}[t(2249)](e){const i=t;if(e.version<8)throw new Error(i(2377)+e[i(815)]+")");this[i(2021)].deserialize(e[i(1222)].selection),this[i(2260)].deserialize(e[i(1222)][i(1280)]),this[i(921)].deserialize(e[i(1222)][i(1116)]),this[i(527)].deserialize(e[i(1222)][i(1903)]),this[i(2300)][i(1161)](e[i(1222)][i(1294)])}saveState(e){const i=t;return{version:8,body:{file:this[i(527)].serialize(e),history:this[i(2260)].serialize(e),selection:this._selectionService.serialize(),tool:this._toolService[i(629)](),viewport:this[i(921)].serialize()}}}}class Ce{constructor(e){this[t(2260)]=e}get[t(1314)](){const e=t;return this[e(2260)][e(1314)]}get[t(605)](){const e=t;return this._historyService[e(605)]}get[t(915)](){return this._historyService.canRedo}get[t(670)](){const e=t;return this[e(2260)][e(670)]}get[t(1923)](){return this[t(2260)].onEntriesChange}[t(1913)](){const e=t;return this._historyService[e(1913)]()}undo(){const e=t;return this[e(2260)][e(1921)]()}async[t(1384)](e,i){return this[t(2260)].createCompositeEntry(e,i)}[t(2237)](e,i){const s=t;return this._historyService[s(2237)](e,i)}}class Ee{constructor(e){this[t(527)]=e}get[t(1998)](){const e=t;return this[e(527)][e(1998)]}get[t(574)](){const e=t;return this[e(527)][e(574)]}get[t(1901)](){const e=t;return this._imageFileService[e(1901)]}get[t(741)](){return this[t(527)].activeImageSetIndex}async setActiveImage(e){const i=t;if(e!==this[i(527)].activeImageSetIndex){if(void 0===e)throw new Error(i(1704));await this[i(527)][i(1332)](e)}}[t(1539)](e,i,s){return this[t(527)].addImage(e,i,s)}[t(901)](e){const i=t;return this[i(527)][i(901)](e)}[t(1301)](e){const i=t;return this._imageFileService[i(1301)](e)}goToTopImage(){const e=t;return this[e(527)][e(2094)]()}[t(1743)](){const e=t;return this._imageFileService[e(1743)]()}[t(1700)](){const e=t;return this[e(527)][e(1700)]()}[t(1831)](){const e=t;return this[e(527)][e(1831)]()}[t(1990)](){const e=t;return this[e(527)][e(1990)]()}moveImageToBottom(){const e=t;return this[e(527)][e(2163)]()}[t(1032)](){return this[t(527)].moveImageUp()}[t(1844)](){const e=t;return this[e(527)][e(1844)]()}[t(2371)](e,i){const s=t;return this._imageFileService[s(2371)](e,i)}}class Te{constructor(e,i,s){const n=t;this[n(2258)]=e,this[n(2021)]=i,this._taskWorkerService=s}get[t(2164)](){const e=t;return this[e(2258)][e(2164)]}get height(){return this[t(2258)].height}get[t(559)](){return this[t(2258)].onChangedDimensions}get[t(623)](){const e=t;return this[e(2258)][e(822)]}get onLayerChange(){const e=t;return this._imageService[e(1247)]}get onLayerVisibilityChange(){const e=t;return this._imageService[e(1130)]}get[t(794)](){const e=t;return this[e(2258)][e(794)].map((t=>new Le(t,this._selectionService,this[e(1448)])))||[]}get[t(1375)](){const e=t,i=this[e(2258)][e(1357)];if(i)return new Le(i,this[e(2021)],this._taskWorkerService)}set[t(1375)](e){const i=t;if(void 0===e)throw new Error("Cannot set the active layer to undefined");this[i(2258)].setActiveLayer(e.id)}[t(810)](){const e=t;return this[e(2258)][e(810)]()}[t(1888)](e){const i=t;return this[i(2258)][i(1888)](e?.id)}[t(1728)](e){const i=t;return this[i(2258)][i(1728)](e?.id)}mergeLayerDown(){const e=t;return this[e(2258)][e(2359)]()}[t(1432)](){const e=t;return this[e(2258)][e(1432)]()}[t(2e3)](e,i){const s=t;return this._imageService[s(2e3)](e,i?.id)}[t(1905)](){const e=t;this[e(2258)][e(1905)]()}[t(1503)](){const e=t;this[e(2258)][e(1503)]()}[t(1522)](){const e=t;this[e(2258)][e(1522)]()}[t(566)](){const e=t;this[e(2258)][e(566)]()}[t(999)](){const e=t;this[e(2258)][e(999)]()}[t(867)](){this[t(2258)].moveLayerToBottom()}[t(1544)](){const e=t;this._imageService[e(1544)]()}[t(1900)](){const e=t;this[e(2258)][e(1900)]()}moveLayerTo(e,i){this[t(2258)].moveLayerTo(e.id,i.id)}async[t(983)](){const e=t;await(this._imageService[e(1357)]?.[e(983)]())}[t(1803)](e,i,s){const n=t;if(e<0||e>=this[n(2164)]||i<0||i>=this[n(918)])return;const o=this[n(2258)][n(1357)];if(o){if(!s){const t=4*(i*o[n(2164)]+e);return o.data[n(717)](t,t+4)}return this[n(2258)][n(1803)](e,i)}}}class Le{constructor(e,i,s){const n=t;this[n(2111)]=e,this._selectionService=i,this[n(1448)]=s,this._previewCache=new Map,this._layer[n(822)]((()=>this[n(2100)][n(1112)]()))}get onDispose(){const e=t;return this[e(2111)][e(1045)]}get onUpdate(){const e=t;return this._layer[e(822)]}get id(){return this[t(2111)].id}get[t(1424)](){return this[t(2111)].name}set[t(1424)](e){const i=t;this[i(2111)][i(1424)]=e}get[t(1636)](){return this[t(2111)].blendMode}set[t(1636)](e){this[t(2111)].setBlendMode(e)}get isVisible(){const e=t;return this[e(2111)][e(836)]}set[t(836)](e){const i=t;this[i(2111)][i(1696)](e)}[t(665)](e,i){const s=t,n=e+"x"+i,o=this[s(2100)][s(876)](n);if(o)return o;const r={data:this._layer[s(1253)],width:this[s(2111)][s(2164)],height:this[s(2111)][s(918)]},a=this[s(1448)][s(1601)](r,e,i);return this[s(2100)].set(n,a),a}[t(1146)](e){const i=t;return this[i(2111)][i(1146)](e)}async[t(1739)](e,s){const n=t,o=await this[n(2111)].importBlob(e,s);this[n(2021)].range=(0,i.BN)(o[n(888)].range),this[n(2021)][n(2114)]("Set Paste Image Selection")}}class Ae{constructor(e){this[t(1773)]=e}get[t(661)](){const e=t;return this[e(1773)][e(822)]}get[t(1690)](){const e=t;return this._paletteService[e(1690)]}get secondary(){const e=t;return this[e(1773)][e(1277)]}[t(2335)](){this[t(1773)].swap()}}class Re{constructor(e){this[t(883)]=e}[t(2268)](){const e=t;this[e(883)][e(2268)]()}[t(803)](){this._renderService.resume()}[t(1275)](e){const i=t;this[i(883)][i(1275)](e)}showToast(e){const i=t;this._renderService[i(2328)](e)}}class De{constructor(e,i){const s=t;this._imageService=e,this[s(2021)]=i}get onUpdate(){const e=t;return this[e(2021)][e(822)]}get range(){const e=t;return this[e(2021)][e(1377)]}[t(865)](){const e=t;this[e(2021)][e(865)]()}[t(1286)](){const e=t;return this[e(2258)][e(1599)]()}[t(971)](){const e=t;return this[e(2258)][e(1599)](!0)}selectAll(){const e=t;return this[e(2258)][e(2225)]()}}class Me{constructor(e,i){const s=t;this[s(1943)]=e,this[s(1448)]=i}get[t(2217)](){const e=t;return this[e(1448)][e(2217)]}set[t(2217)](e){const i=t;this[i(1448)][i(2217)]=e}get[t(1677)](){const e=t;return this._taskService[e(1677)]}[t(1629)](e,i){const s=t;return this[s(1943)][s(1629)](e,i)}[t(1797)](e,i){const s=t;return this[s(1943)][s(1797)](e,i)}}class Be{constructor(e){this[t(921)]=e}[t(1646)](e,i){const s=t,[n,o]=this[s(921)][s(1660)]([e,i]);return{x:n,y:o}}}class ke{constructor(e){this[t(2300)]=e}get[t(2053)](){const e=t;return this[e(2300)][e(2053)]}get[t(2181)](){const e=t;return this._toolService[e(2181)]?.id}get[t(1311)](){const e=t;return this[e(2300)].activeTool?.[e(1311)]||[]}get[t(563)](){const e=t;return this[e(2300)][e(2181)]?.[e(563)]||[]}get[t(1313)](){const e=t;return this[e(2300)][e(2181)]?.[e(1313)]||[]}async[t(1645)](e,i){const s=t;await this[s(2300)][s(1645)](e,i)}}class Ue{constructor(e,i){this[t(1234)]=e,this._viewportService=i}get onUpdate(){return this[t(921)].onUpdate}get[t(1144)](){const e=t;return this[e(921)][e(1144)]}get[t(668)](){const e=t;return this[e(921)][e(668)]}get[t(2015)](){const e=t;return this._viewportService[e(2015)]}get x(){return this[t(921)].x}set x(e){this[t(921)].x=e}get y(){return this._viewportService.y}set y(e){this[t(921)].y=e}get[t(1499)](){return this._viewportService.visibleRange}get[t(735)](){const e=t;return this._viewportService[e(735)]}set zoom(e){this[t(921)].zoom=e}get isPixelGridEnabled(){const e=t;return this[e(921)][e(986)]}set[t(986)](t){this._viewportService.isPixelGridEnabled=t}get[t(1439)](){const e=t;return this[e(921)][e(1439)]}set[t(1439)](e){const i=t;this[i(921)][i(1439)]=e}[t(1925)](e){const i=t;this[i(1234)][i(1925)](e)}[t(1603)](){const e=t;document[e(1981)][e(2378)]()}[t(1663)](e){const i=t;this._viewportService[i(1663)](e)}zoomOut(e){const i=t;this[i(921)][i(1260)](e)}[t(2120)](){const e=t;this._viewportService[e(2120)]()}fitLayerToWindow(){this[t(921)].fitLayerToWindow()}}const Pe=t(2344),Fe="di$dependencies",Ne=new Map;function Oe(e){const i=t;if(Ne.has(e))return Ne.get(e);const s=function(t,e,i){const n=a2_0x27c6;if(3!==arguments[n(1807)])throw new Error(n(1875));Ve(s,t,i)};return s[i(993)]=()=>e,Ne[i(917)](e,s),s}function Ve(e,i,s){const n=t;i[Pe]===i?i[Fe][n(585)]({id:e,index:s}):(i[Fe]=[{id:e,index:s}],i[Pe]=i)}const He=Oe(t(2385)),ze=Oe(t(908)),je=Oe(t(2115));class We{constructor(){this[t(1270)]=new Map}[t(1502)](e,i){const s=t;this._commands[s(917)](e,i)}[t(876)](e){const i=t,s=this[i(1270)][i(876)](e);if(!s)throw new Error('Could not find non-existent command "'+e+'"');return s}[t(1204)](){const e=t;return this[e(1270)][e(1673)]()}}const qe=new We;var Ge=function(t,e){return function(i,s){e(i,s,t)}};let Xe=class{constructor(e,i){const s=t;this[s(1350)]=e,this[s(1233)]=i}[t(861)](e){return qe[t(876)](e)}[t(1070)](){return qe.getAll()}canRunCommand(e){const i=t,s=qe[i(876)](e);if(void 0===s[i(1954)])return!0;const n=this[i(1233)][i(876)](s[i(1954)]);if(!n)return!0;const o=n[i(876)]();return s.negateEnabled?!o:o}[t(2079)](e,...i){const s=t;if(!this[s(1370)](e))return void console[s(680)](s(1269)+e+s(1459));const n=qe[s(876)](e);return console[s(1313)](s(1374)+e+s(756)),this[s(1350)].invokeFunction(n.run,...i)}[t(1513)](e,i){const s=t,n=qe.getAll(),o=[];for(const t of n)if((t.section+": "+t[s(1446)])[s(929)]().includes(e[s(929)]())&&(o[s(585)](t),o.length===i))return o;return o}};Xe=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object[o(728)](i,s):n;if(typeof Reflect===o(1804)&&"function"==typeof Reflect[o(1552)])h=Reflect[o(1552)](e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([Ge(0,je),Ge(1,ze)],Xe);const Ye=Oe(t(1641));class Je extends e.JT{constructor(){const e=t;super(...arguments),this[e(784)]=void 0,this[e(2095)]=this[e(1502)](new s.v),this.onConfigChanged=this[e(2095)][e(1362)],this[e(744)]={statusBarPointerColor:e(1357)}}get[t(1203)](){return this[t(744)]}set[t(1203)](e){const i=t;!this._configEquals(e)&&(this[i(744)]=e,this[i(2095)][i(1457)](this[i(744)]))}[t(1150)](e){const i=t,s=Object.keys(this[i(744)]);if(s[i(1807)]!==Object[i(1742)](e)[i(1807)])return!1;for(const t of s)if(this[i(744)][t]!==e[t])return!1;return!0}}class Ke{constructor(){this[t(784)]=void 0,this._contextKeys=new Map}[t(876)](e){const i=t;return this._contextKeys[i(876)](e)}[t(732)](e,i){const s=t,n=new $e(i);return this[s(686)][s(917)](e,n),n}}class $e extends e.JT{constructor(e){const i=t;super(),this[i(1174)]=e,this[i(2290)]=this[i(1502)](new s.v),this[i(822)]=this[i(2290)].event,this[i(2027)]=this[i(1174)]}set(e){const i=t;this._value!==e&&(this[i(2027)]=e,this[i(2290)][i(1457)](e))}[t(2149)](){const e=t;this[e(917)](this[e(1174)])}get(){return this[t(2027)]}}const Ze=Oe("ContextMenuService"),Qe=Oe(t(1308));class ti{constructor(...e){const i=t;this[i(1172)]=new Map;for(const[t,s]of e)this[i(917)](t,s)}[t(917)](e,i){const s=t,n=this[s(1172)][s(876)](e);return this._entries.set(e,i),n}[t(1177)](e){const i=t;this._entries[i(1177)](((t,i)=>e(i,t)))}[t(2387)](e){const i=t;return this[i(1172)][i(2387)](e)}get(t){return this._entries.get(t)}}class ei{constructor(){const e=t;this[e(2080)]=new ti,this[e(2080)][e(917)](je,this)}[t(858)](e,i){const s=t;this[s(2080)][s(917)](e,i)}getService(e){const i=t;return this[i(2080)][i(876)](e)}[t(1100)](e,...i){const s=t,n=(r=e,r[Fe]||[])[s(2323)](((t,e)=>t.index-e[s(1205)])),o=[];var r;for(const t of n){const i=this[s(2080)][s(876)](t.id);if(!i)throw new Error("[createInstance] "+e[s(1424)]+s(742)+t.id+".");o[s(585)](i)}const a=n[s(1807)]>0?n[0][s(1205)]:i[s(1807)];if(i.length!==a)throw new Error("[createInstance] First service dependency of "+e[s(1424)]+s(853)+(a+1)+" conflicts with "+i[s(1807)]+s(1618));return new e(...[...i,...o])}[t(1561)](t,...e){return t({get:t=>{const e=a2_0x27c6,i=this.getService(t);if(!i)throw new Error(e(1868)+t+"'");return i}},...e)}}const ii=Oe(t(1788)),si=Oe(t(1504)),ni=Oe("StatusBarService");class oi extends e.JT{constructor(){const e=t;super(...arguments),this[e(1008)]=new Map([[1,new ri],[0,new ri]]),this._onDidAddTopItem=this.register(new s.v),this[e(755)]=this[e(1819)][e(1362)],this._onDidRemoveTopItem=this[e(1502)](new s.v),this.onDidRemoveTopItem=this[e(558)][e(1362)],this[e(2146)]=this[e(1502)](new s.v),this[e(1470)]=this[e(2146)][e(1362)],this[e(539)]=this.register(new s.v),this[e(1347)]=this[e(539)][e(1362)]}[t(1864)](e){const i=t,s=this[i(1008)][i(876)](e.target),n=0===e[i(2238)]?s[i(650)]:s[i(2361)];if(n[i(2387)](e))throw new Error(i(857));return n[i(1857)](e),(0===e.target?this._onDidAddTopItem:this[i(2146)])[i(1457)](e),{dispose:()=>{this[i(1581)](e)}}}[t(1506)](e){const i=t;return this[i(1008)][i(876)](e)[i(650)][i(1673)]()}[t(1e3)](e){const i=t;return this[i(1008)].get(e)[i(2361)][i(1673)]()}[t(1581)](e){const i=t,s=this[i(1008)].get(e[i(1996)]);(0===e[i(2238)]?s[i(650)]:s[i(2361)])[i(1156)](e),(0===e[i(1996)]?this[i(558)]:this[i(539)])[i(1457)](e)}}class ri{constructor(){const e=t;this[e(650)]=new Set,this[e(2361)]=new Set}}const ai=Oe(t(1784)),hi=Oe(t(1892)),ci=Oe(t(1041));class li{constructor(){this[t(2042)]=new Map}[t(1502)](e,i){const s=t;this[s(2042)][s(917)](e,i)}[t(876)](e){const i=t,s=this[i(2042)][i(876)](e);if(!s)throw new Error(i(2139)+e+'"');return s}[t(1204)](){return this[t(2042)].entries()}}const di=new li;class ui{constructor(){this[t(2042)]=new Map}register(e,i){const s=t;this[s(2042)][s(917)](e,i)}[t(876)](e){const i=t,s=this[i(2042)][i(876)](e);if(!s)throw new Error('Could not find non-existent window view "'+e+'"');return s}[t(1204)](){const e=t;return this._views[e(605)]()}}const mi=new ui;function gi(t,e,i){return s=(s,n)=>{const o=a2_0x27c6(2325)+n,r="$debounce$result$"+n;return function(...n){!this[r]&&(this[r]=i?i():void 0),clearTimeout(this[o]),e&&(this[r]=e(this[r],...n),n=[this[r]]),this[o]=setTimeout((()=>{s[a2_0x27c6(707)](this,n),this[r]=i?i():void 0}),t)}},(t,e,i)=>{const n=a2_0x27c6;let o=null,r=null;if("function"==typeof i[n(877)]?(o="value",r=i[n(877)]):typeof i[n(876)]===n(1626)&&(o=n(876),r=i[n(876)]),!r)throw new Error(n(974));i[o]=s(r,e)};var s}var fi=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(1804)&&typeof Reflect.decorate===o(1626))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h},pi=function(t,e){return function(i,s){e(i,s,t)}};let _i=class extends e.JT{constructor(e,i){const n=t;super(),this._instantiationService=e,this[n(1013)]=i,this[n(2042)]=new Map,this[n(2383)]=!1,this[n(2026)]=new Map,this._windowResolvedPosition=new Map,this[n(2157)]=this.register(new s.v),this[n(1952)]=this[n(2157)][n(1362)],this[n(1664)]=this[n(1502)](new s.v),this.onDidChangeViews=this[n(1664)][n(1362)];for(const[t,e]of di[n(1204)]()){let i;switch(e[n(964)]){case n(800):i=this[n(1350)][n(1100)](e[n(1383)],document[n(572)](n(2223)));break;case n(2364):i=this[n(1350)][n(1100)](e[n(1383)],document[n(572)](n(960)))}i&&this._views[n(917)](t,i)}this[n(2040)]=document.querySelector(n(710));for(const[t,e]of mi[n(1204)]())e[n(2367)]&&this[n(722)](t,e);window[n(2062)](n(1922),(()=>this[n(547)]())),(0,s.B)(this[n(1952)],this._onDidChangeViews),this[n(1013)][n(611)]("viewService",this)}[t(547)](){const e=t;for(const[t,i]of this[e(2026)][e(605)]())if(i){const s=this[e(2042)][e(876)](t);if(s&&"setPosition"in s){if(this[e(1551)](i?.x)&&i?.x[e(1996)]||this[e(1551)](i?.y)&&i?.y[e(1996)])continue;this[e(1919)](s,i||mi[e(876)](t)[e(754)])}}}[t(1774)](e){const i=t,s=this[i(2042)][i(876)](e);s?s.isVisible=!s.isVisible:this[i(722)](e,mi[i(876)](e)),!1===s?.[i(836)]&&this._windowResolvedPosition[i(1156)](e),!this[i(2383)]&&(this[i(2157)][i(1457)](),this[i(693)](e))}[t(1036)](e){const i=t,s=this[i(2042)][i(876)](e);s&&s[i(836)]&&(s[i(836)]=!1,this._windowResolvedPosition[i(1156)](e),!this[i(2383)]&&(this[i(2157)].fire(),this[i(693)](e)))}[t(1067)](e){const i=t,s=this._views.get(e);s?!s.isVisible&&(s[i(836)]=!0,!this[i(2383)]&&(this[i(2157)].fire(),this._layoutDependentViews(e))):this.toggleView(e)}[t(836)](e){const i=t;return this._views.get(e)?.[i(836)]||!1}_createWindowView(e,i){const s=t,n=this[s(1350)].createInstance(i[s(1383)],this[s(2040)]);this[s(1919)](n,i[s(754)]),n[s(2208)]((()=>{const t=s;!1===n[t(836)]&&(n[t(1800)](),this[t(2042)][t(1156)](e),!this[t(2383)]&&(this[t(2157)][t(1457)](),this[t(693)](e)),this._windowResolvedPosition.delete(e))})),n[s(2017)]((t=>{!this._dropTargetElement&&setTimeout((()=>{const e=a2_0x27c6;this[e(2251)]=document[e(808)](e(924)),this[e(2251)][e(958)][e(1857)](e(832)),this[e(2251)][e(1033)][e(2155)]="all",this[e(2251)].addEventListener(e(2340),(i=>{const s=e,o=this._viewsElement[s(1297)](),r=i.clientX+t.offsetX-o[s(2061)]-10+t.width/2>o[s(2164)]/2?s(554):"start",a=i[s(914)]+t[s(1473)]-o.top-10+t[s(918)]/2>o.height/2?s(554):"start";let h,c;h="start"===r?i.clientX+t[s(1263)]-o[s(2061)]-10:o.width-(i[s(1487)]+t[s(1263)])-t[s(2164)]-10,c="start"===a?i.clientY+t[s(1473)]-o.top-10:o[s(918)]-(i.clientY+t[s(1473)])-t[s(918)]+10+1,this[s(1919)](n,{x:{side:r,distance:Math[s(1445)](h,0)},y:{side:a,distance:Math[s(1445)](c,0)}})})),this._dropTargetElement[e(2062)]("dragover",(t=>t[e(2075)]())),this[e(2040)][e(1484)](this[e(2251)])}))})),n[s(930)]((()=>{const t=s;this[t(2251)]&&(this._viewsElement.removeChild(this._dropTargetElement),this[t(2251)]=void 0),this[t(2157)][t(1457)]()})),this[s(2042)][s(917)](e,n)}_updateWindowViewPosition(e,i){const s=t;let n,o,r,a;this._windowPosition.set(e.id,i),this[s(1274)].delete(e.id);const h=this[s(1551)](i.x)?i.x[s(1996)]:void 0,c=this[s(1551)](i.y)?i.y[s(1996)]:void 0,l=this._isWindowAnchor(i.x)?i.x.side:i.x;let d=this._isWindowAnchor(i.x)?(i.x[s(1999)]||0)+10:10;if(h){const t=this[s(1274)][s(876)](h);t&&(d+=(l===s(2219)?t[s(2061)]:t[s(511)])||0,d+=this[s(2042)][s(876)](h)?.[s(918)]||0)}if(l===s(2219)?a=(0,w.u)(d,this[s(2040)].offsetWidth-e[s(2164)]-10,10):o=(0,w.u)(d,this[s(2040)][s(1087)]-e.width-10,10),!h&&c){const t=this[s(1274)][s(876)](c);t&&(a=t.left,o=t.right)}let u=this._isWindowAnchor(i.y)?i.y[s(597)]:i.y,m=this._isWindowAnchor(i.y)?(i.y[s(1999)]||0)+10:10;if(c){const t=this[s(2026)][s(876)](c),i=this[s(1274)][s(876)](c);if(i&&(void 0!==i[s(800)]?m=i[s(800)]-m-this[s(2042)][s(876)](e.id)?.[s(918)]||0:void 0!==i.bottom&&(m+=i.bottom),t)){const e=this[s(1747)](t.y);u===e&&(m+=this[s(2042)].get(c)?.[s(918)]||0),u=e}}if(u===s(2219)?n=(0,w.u)(m,this[s(2040)][s(599)]-e[s(918)]-10,10):r=(0,w.u)(m,this[s(2040)].offsetHeight-e[s(918)]-10,10),!c&&h){const t=this._windowResolvedPosition[s(876)](h);t&&(n=t.top,r=t[s(2364)])}e[s(1715)](n?n+"px":"",o?o+"px":"",r?r+"px":"",a?a+"px":""),this._windowResolvedPosition[s(917)](e.id,{top:n,right:o,bottom:r,left:a}),this._layoutDependentViews(e.id)}[t(693)](e){const i=t;for(const t of this._views[i(1673)]()){if(!(i(1715)in t))continue;const s=this[i(2026)][i(876)](t.id)||mi[i(876)](t.id)[i(754)];t[i(836)]&&(this._isWindowAnchor(s.x)&&s.x[i(1996)]===e||this[i(1551)](s.y)&&s.y[i(1996)]===e)&&this._updateWindowViewPosition(t,s)}}saveState(){const e=t,i=[];for(const t of this[e(2042)][e(1673)]())i[e(585)]({id:t.id,position:this[e(2026)][e(876)](t.id),isVisible:t[e(836)]});return{views:i}}[t(2249)](e){const i=t;this[i(2383)]=!0;for(const t of e.views)t[i(836)]?this[i(1067)](t.id):this.hideView(t.id);for(const t of this[i(2042)][i(1742)]()){let s=!1;for(const n of e[i(1717)][i(1673)]())if(n.id===t){s=!0;break}!s&&this[i(1036)](t)}for(const t of e[i(1717)])if(t[i(836)]){const e=this._views[i(876)](t.id);if(e&&"setPosition"in e){if(this[i(1551)](t[i(545)]?.x)&&t[i(545)]?.x.target||this[i(1551)](t[i(545)]?.y)&&t[i(545)]?.y[i(1996)])continue;this[i(1919)](e,t.position||mi[i(876)](t.id).defaultPosition)}}this[i(2383)]=!1}_isWindowAnchor(e){return!!e&&typeof e!==t(2008)}[t(1747)](e){const i=t;return this[i(1551)](e)?e[i(597)]:e}};fi([gi(500)],_i.prototype,t(547),null),_i=fi([pi(0,je),pi(1,ci)],_i);const yi=Oe(t(1304));class wi extends e.JT{constructor(){const e=t;super(...arguments),this[e(1395)]=!0,this._isStretchEnabled=!0,this[e(1113)]=this[e(1502)](new s.v),this[e(2171)]=this._onShowViewportChange[e(1362)],this._onStretchEnabledChange=this[e(1502)](new s.v),this[e(1964)]=this[e(2232)][e(1362)]}get showViewport(){return this[t(1395)]}set[t(526)](e){const i=t;this[i(1395)]!==e&&(this[i(1395)]=e,this[i(1113)][i(1457)](e))}get[t(1500)](){return this[t(2283)]}set[t(1500)](e){const i=t;this[i(2283)]!==e&&(this._isStretchEnabled=e,this[i(2232)].fire(e))}}const vi=Oe(t(909));let bi=class extends e.JT{constructor(e){const i=t;super(),this[i(748)]=!1,this[i(685)]=!1,this[i(2157)]=this[i(1502)](new s.v),this[i(1952)]=this[i(2157)][i(1362)],this[i(2362)]=this.register(new s.v),this[i(871)]=this[i(2362)][i(1362)],e.registerStateHandler(i(1968),this),this[i(871)]((()=>{const t=i;!this[t(685)]&&this[t(2157)].fire({global:!0})}))}get showColorDetails(){return this[t(748)]}set[t(2031)](e){const i=t;this[i(748)]!==e&&(this[i(748)]=e,this[i(2362)].fire(e))}[t(524)](){return{showColorDetails:this[t(748)]}}[t(2249)](e){const i=t;this._ignoreStateChangeEvents=!0,this[i(2031)]=e[i(2031)],this[i(685)]=!1}};var xi,Ii;bi=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object[o(728)](i,s):n;if(typeof Reflect===o(1804)&&typeof Reflect[o(1552)]===o(1626))h=Reflect[o(1552)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([(xi=0,Ii=ci,function(t,e){Ii(t,e,xi)})],bi);class Si extends e.JT{constructor(){const e=t;super(...arguments),this._stateHandlers=new Map,this._state=new Map,this[e(2157)]=this[e(1502)](new s.v),this[e(1952)]=this._onStateChange[e(1362)],this[e(900)]=this[e(1502)](new s.v),this[e(1030)]=this[e(900)][e(1362)]}get[t(2316)](){const e=t,i=[];for(const[t,s]of this[e(1889)].entries())i[e(585)]({id:t,state:s});return{version:3,entries:i}}[t(611)](e,i){const s=t;if(this[s(1812)].has(e))throw new Error(s(718)+e+s(2036));this[s(1812)][s(917)](e,i),i[s(1952)]((t=>{const n=s,o=this[n(2174)](i,e);this[n(2157)][n(1457)]({id:e,global:typeof t===n(1804)?t[n(2005)]:void 0,state:o})}))}[t(2174)](e,i){const s=t,n=e.saveState();return this[s(1889)][s(917)](i,n),n}[t(2376)](e){const i=t;return this._stateHandlers[i(2387)](e)}restoreState(e){const i=t;if(e)if(3===e[i(815)])for(const t of e.entries){const e=this[i(1812)][i(876)](t.id);e?e.restoreState(t[i(2316)]):console[i(680)](i(814)+t.id+i(1718))}else console[i(680)](i(2057)+e[i(815)]+i(2037)+3+")");else for(const[t,e]of this[i(1812)][i(605)]())this[i(2174)](e,t)}syncGlobalState(e){this[t(2249)](e)}}class Ci{constructor(){this[t(1951)]=[]}[t(1502)](e){const i=t;this._contributions[i(585)](e)}getAll(){return this[t(1951)].values()}clear(){const e=t;this[e(1951)][e(1807)]=0}}const Ei=new Ci;const Ti=Oe(t(2224));class Li{constructor(e){const i=t;this[i(1325)]=e,this[i(784)]=void 0,this[i(898)]=new Map,this[i(1772)]=new Map,window[i(2062)](i(1580),(async t=>{const e=i;if(e(617)in t[e(1253)]){const i=t[e(1253)][e(617)],s=this[e(1772)].get(i);if(!s)throw new Error('Response received without request "'+i+'"');return this[e(1772)][e(1156)](i),void s(this._rehydrateExtHostMessage(t.data))}if(e(713)in t[e(1253)]){const i=this[e(898)][e(876)](t.data[e(544)]);if(!i)throw new Error('No handler for webview request "'+t[e(1253)][e(544)]+'"');const s=await i(this[e(1287)](t.data)),n={type:t.data[e(544)],body:ye.jn?s:(0,c.t)(s),extHostRequestId:t[e(1253)][e(713)]};this[e(1325)].postMessage(n)}}))}registerRequestHandler(e,i){const s=t;if(this[s(898)][s(2387)](e))throw new Error(s(1566)+e+'"');this[s(898)][s(917)](e,i)}async[t(1709)](e,i){const s=t,n=Math[s(2337)](1e6*Math[s(624)]());return new Promise((t=>{const o=s;this[o(1772)][o(917)](n,t),this[o(1325)][o(1694)]({type:e,body:i,webviewRequestId:n})}))}[t(1287)](e){const i=t;if(void 0===e.body)return e[i(1222)];const s=e[i(1222)];for(const t of Object[i(1742)](s)){const e=s[t];typeof e===i(1804)&&i(544)in e&&e[i(544)]===i(2177)&&(s[t]=new Uint8Array(e.data))}return(0,c.e)(s)}}class Ai{[t(1502)](t){}getAll(){return[].values()}}let Ri=class{constructor(e){this[t(2108)]=e}async show(e){const i=t;return this._quickPickService[i(1226)]("",e)}};var Di,Mi;Ri=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object[o(728)](i,s):n;if(typeof Reflect===o(1804)&&typeof Reflect.decorate===o(1626))h=Reflect[o(1552)](e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([(Di=0,Mi=ai,function(t,e){Mi(t,e,Di)})],Ri);class Bi{constructor(){}async[t(2285)](){throw new Error("NYI")}async[t(819)](){throw new Error(t(2368))}async[t(633)](){throw new Error(t(2368))}}async function ki(t){return new Promise((e=>setTimeout(e,t)))}var Ui=function(t,e){return function(i,s){e(i,s,t)}};let Pi=class{constructor(t,e){this._ipcService=t,this._lunaService=e}async[t(1596)](e){const i=t;switch(e){case i(595):{const t=await this[i(1683)]();await ki(50);const e=await this[i(1435)].request(i(850),{items:[{id:"bilinear",label:i(1382),description:i(1817),detail:i(2245)},{id:i(1456),label:"Nearest neighbor",description:i(1015),detail:i(1779)}],options:{placeHolder:i(1734)}});if(void 0===e)throw new Error(i(2194));return{...t,resampling:e}}case"layer/resizeCanvas":{const t=await this.requestNewDimensions();await ki(50);const e=await this._ipcService[i(1709)](i(850),{items:[{id:i(753),label:i(2347),description:"↘"},{id:i(800),label:"Top",description:"↓"},{id:i(1450),label:i(897),description:"↙"},{id:i(2061),label:i(652),description:"→"},{id:i(1652),label:i(1361),description:"·"},{id:i(511),label:i(1401),description:"←"},{id:i(1086),label:i(1315),description:"↗"},{id:i(2364),label:i(1413),description:"↑"},{id:"bottomright",label:i(1748),description:"↖"}],options:{placeHolder:i(1527)}});if(void 0===e)throw new Error("Anchor not selected");return{...t,anchor:e}}default:throw new Error(i(788)+e+i(1093))}}async requestNewDimensions(){const e=t;await ki(50);const i=await this[e(1435)][e(1709)](e(2187),{prompt:e(1575),defaultValue:this[e(1957)].layer[e(2164)],minValue:1});if(void 0===i)throw new Error(e(658));let s,n;if(typeof i===e(711)?(await ki(50),s=i,n=await this[e(1435)][e(1709)](e(1106),{prompt:"Enter the height of the image",defaultValue:this[e(1957)][e(2386)][e(918)],minValue:1})):(s=i[e(2164)],n=i.height),void 0===n)throw new Error(e(1279));return{width:s,height:n}}async[t(1226)](e,i){const s=t;return await ki(50),await this._ipcService.request(s(850),{options:{placeHolder:e},items:i})}async requestInput(e,i){const s=t;return await ki(50),await this[s(1435)][s(1709)](s(976),{prompt:e,defaultValue:i})}async[t(647)](e,i,s,n){const o=t;return await ki(50),await this[o(1435)].request("inputBoxNumber",{prompt:e,defaultValue:i,minValue:s,maxValue:n})}};Pi=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(728)](i,s):n;if(typeof Reflect===o(1804)&&typeof Reflect[o(1552)]===o(1626))h=Reflect[o(1552)](e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([Ui(0,Ti),Ui(1,si)],Pi);const Fi=Oe("HelpService");let Ni=class{constructor(e){this[t(1435)]=e}async[t(1927)](){const e=t;return this[e(1435)][e(1709)](e(1927),void 0)}};var Oi,Vi;Ni=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object[o(728)](i,s):n;if("object"==typeof Reflect&&typeof Reflect[o(1552)]===o(1626))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([(Oi=0,Vi=Ti,function(t,e){Vi(t,e,Oi)})],Ni);class Hi{constructor(){this._entries=[]}[t(1502)](e){const i=t;this[i(1172)][i(585)](e)}getAll(){return this[t(1172)]}clear(){const e=t;this[e(1172)][e(1807)]=0}}const zi=new Hi;function ji(e){const i=t;if(qe[i(1502)](e.id,{id:e.id,label:e.label,section:e[i(1441)],run:e[i(1775)],checked:e[i(988)],negateChecked:e.negateChecked,enabled:e.enabled,negateEnabled:e.negateEnabled}),e[i(1742)])if(Array[i(557)](e[i(1742)]))for(const t of e[i(1742)])zi[i(1502)]({commandId:e.id,keys:t});else zi[i(1502)]({commandId:e.id,keys:e[i(1742)]})}ji({id:t(1195),label:t(1975),section:"Adjustments",run:async e=>{const i=t,s=e[i(876)](si);await s.task[i(1797)](i(576),{selection:s[i(759)].range})},keys:t(1971)});class Wi extends e.JT{constructor(e,i,n){const o=t;super(),this.id=e,this[o(2040)]=i,this[o(862)]=!0,this[o(2078)]=this.register(new s.v),this[o(2208)]=this[o(2078)][o(1362)],this[o(922)]=this.register(new s.v),this[o(2017)]=this[o(922)].event,this[o(591)]=this[o(1502)](new s.v),this.onDidEndDrag=this[o(591)][o(1362)],this[o(1187)]=document[o(808)](o(924)),this[o(1187)].id=n[o(929)]().replace(/ /g,""),this._viewElement[o(958)][o(1857)]("view","window");const r=document.createElement(o(924));r[o(958)][o(1857)](o(1224)),r.addEventListener("mousedown",(()=>this[o(1187)][o(1904)]=!0)),r.addEventListener(o(2127),(()=>this[o(1187)][o(1904)]=!1)),r[o(2062)](o(2096),(t=>t.preventDefault())),this[o(1187)].addEventListener("dragstart",(t=>{const e=o;t[e(1288)]&&(t.dataTransfer[e(2144)]="move",t[e(1288)][e(968)]=e(2165));const i=this[e(1187)][e(1297)]();this._onDidStartDrag[e(1457)]({offsetX:i[e(2061)]-t.clientX,offsetY:i[e(800)]-t[e(914)],width:i[e(2164)],height:i.height})})),this[o(1187)][o(2062)](o(2352),(()=>this[o(591)][o(1457)]())),this[o(1187)][o(2062)](o(2096),(t=>{const e=o,i=t.target;(i.tagName!==e(1038)||!(e(544)in i)||i[e(544)]!==e(1386)&&i.type!==e(711))&&i[e(1451)]!==e(1880)&&t[e(2075)]()}));const a=document[o(808)](o(924));a[o(958)].add("title"),a.textContent=n,this[o(1604)]=document[o(808)]("div"),this[o(1604)][o(958)][o(1857)](o(935));const h=document.createElement(o(1310));h[o(958)].add(o(587),o(1028)),h[o(2178)](o(1962),o(1934)+n+o(1057)),h[o(2062)]("mousedown",(t=>t[o(1529)]())),h[o(2062)](o(1517),(()=>this[o(836)]=!1)),r[o(1969)](a,this[o(1604)],h),this[o(1261)]=document[o(808)](o(924)),this[o(1261)].classList[o(1857)](o(1026)),this._viewElement[o(1969)](r,this[o(1261)]),this[o(2040)][o(1484)](this[o(1187)]),this.register({dispose:()=>{const t=o;this[t(2040)][t(1132)](this[t(1187)])}})}get[t(836)](){return this._isVisible}set isVisible(e){const i=t;this[i(862)]=e,this[i(2078)][i(1457)](e)}get[t(918)](){const e=t;return this[e(1187)][e(1297)]()[e(918)]}get[t(2164)](){const e=t;return this._viewElement[e(1297)]()[e(2164)]}[t(1715)](e,i,s,n){const o=t;this._viewElement[o(1033)][o(800)]=e||"",this[o(1187)].style[o(511)]=i||"",this[o(1187)].style[o(2364)]=s||"",this._viewElement.style[o(2061)]=n||""}}class qi extends e.JT{constructor(i,n,o,r,a,h){const c=t;super(),this[c(866)]=i,this[c(1003)]=n,this[c(1004)]=a,this._maxValue=h,this._onSliderChange=this[c(1502)](new s.v),this.onSliderChange=this._onSliderChange[c(1362)],this._widgetContent=document[c(808)](c(924)),this[c(977)][c(958)][c(1857)](r),this[c(2346)]=document[c(808)]("div"),this._sliderContainer[c(958)].add(c(2004)),this[c(1976)]=document.createElement("div"),this._sliderGradientElement.classList[c(1857)]("slider-gradient"),this[c(1976)][c(1033)][c(1442)]=this[c(1948)](),this[c(1976)].addEventListener(c(1865),(t=>{const e=c;this[e(2346)][e(958)][e(731)](e(846))&&t[e(1085)]&&this._updateViaSlider(t.offsetX)})),this._sliderGradientElement[c(2062)](c(739),(t=>{const e=c;this[e(1976)].setPointerCapture(t[e(828)]),this[e(2346)][e(958)][e(1857)]("active"),this[e(701)](t[e(1263)])})),this[c(1976)][c(2062)]("pointerup",(t=>{const e=c;this[e(1976)].releasePointerCapture(t[e(828)]),this[e(2346)][e(958)][e(856)](e(846))})),this[c(1976)][c(2062)]("wheel",(t=>{const e=c;0!==t[e(1243)]&&this._setValue(this[e(733)]()+(t[e(1243)]>0?-1:1))})),this[c(1125)]=document[c(808)](c(924)),this[c(1125)][c(958)][c(1857)](c(834)),this._sliderContainer[c(1969)](this[c(1976)],this._sliderTabElement),this[c(977)][c(1969)](this._sliderContainer),this[c(1003)].append(this[c(977)]),this[c(679)](),this[c(1502)]((0,e.OF)((()=>this[c(977)][c(856)]()))),this[c(1502)](o((()=>this[c(679)]())))}[t(679)](){const e=t;this._sliderContainer.classList[e(731)]("active")||(this._sliderGradientElement.style[e(1442)]=this[e(1948)](),this._sliderTabElement[e(1033)][e(2061)]=this._getValue()/this[e(886)]*(this[e(1976)][e(1087)]-1)+"px")}[t(701)](e){const i=t,s=Math[i(1445)](Math.min(e/(this[i(1976)][i(1087)]-1),1),0)*this[i(886)];this[i(2170)](s),this[i(1125)][i(1033)][i(2061)]=s/this[i(886)]*(this[i(1976)][i(1087)]-1)+"px",this[i(2213)][i(1457)]()}}class Gi extends qi{constructor(i,s,n,o,r,a,h,c,l){const d=t;super(i,s,n,d(1961),a,h);const u=d(1330)+Math[d(2337)](1e8*Math[d(624)]()),m=document.createElement("label");m[d(590)]=o+":",m[d(2178)](d(773),u),m[d(1608)]=c;const g=document[d(808)](d(1211));g[d(544)]="number",g[d(2338)]=a[d(993)](),g[d(1445)]=h[d(993)](),g.value=r[d(993)](),g.id=u,g[d(2062)](d(1211),(()=>this[d(2170)](parseInt(g.value)))),g[d(2062)](d(2378),(()=>g[d(877)]=this._getValue()[d(993)]())),this[d(1489)]=g;const f=document[d(808)](d(924));if(f[d(958)][d(1857)](d(855)),f.append(g),l){this[d(1590)]=document[d(808)](d(1548)),this[d(1590)][d(958)][d(1857)](d(1074)),this[d(1590)][d(590)]=g.value,g.addEventListener(d(1211),(()=>this._syncHiddenText())),g[d(2062)]("keypress",(()=>this[d(2298)]())),this[d(1502)](this.onSliderChange((()=>this[d(2298)]()))),this[d(1502)](n((()=>this[d(2298)]())));const t=document[d(808)]("div");t[d(958)][d(1857)](d(1985)),t[d(1969)](this[d(1590)],document[d(586)](l)),f[d(1969)](t)}this[d(1502)](n((()=>{const t=d;document[t(1981)]!==g?(g[t(877)]=this[t(733)]()[t(993)](),this[t(2298)]()):this._syncHiddenText()}))),this[d(977)].prepend(m),this._widgetContent.append(f),this.register((0,e.OF)((()=>{m.remove(),g.remove()})))}_syncHiddenText(){const e=t;this[e(1590)]&&(this[e(1590)].textContent=this[e(1489)][e(877)])}}const Xi=["r","g","b","a"];class Yi extends Gi{constructor(e,i,s){const n=t;super(e,i,e[n(1965)][n(661)],s[n(1572)](),e.palette.primary[n(621)][Xi.indexOf(s)],0,255,"a"===s?"Alpha (aka opacity)":("r"===s?n(1251):"g"===s?"Green":n(1941))+n(1714),void 0),this[n(939)]=s,this[n(1001)]=Xi[n(899)](s),this[n(679)]()}_sanitizeValue(e){const i=t;return Math[i(1445)](Math[i(2338)](Math[i(2337)](e)||0,255),0)}[t(733)](){const e=t;return this[e(866)][e(1965)][e(1690)][e(621)][Xi.indexOf(this[e(939)])]}[t(2170)](e){const i=t,s=(0,ht.FK)(this[i(866)][i(1965)].primary.rgba);s[this._channelIndex]=this[i(1482)](e),this._luna[i(1965)][i(1690)][i(621)]=s}[t(1948)](){const e=t;if(void 0===this[e(1001)])return e(1649);const i=this[e(866)][e(1965)].primary.rgb,s=[0===this._channelIndex?0:i[0],1===this[e(1001)]?0:i[1],2===this._channelIndex?0:i[2],3===this[e(1001)]?0:1],n=[0===this._channelIndex?255:i[0],1===this[e(1001)]?255:i[1],2===this[e(1001)]?255:i[2],(this._channelIndex,1)];return"linear-gradient(90deg, rgba("+s[e(1305)](",")+e(541)+n[e(1305)](",")+") 100%)"}}class Ji extends e.JT{constructor(i,s){const n=t;super(),this[n(866)]=i,this[n(1003)]=s,this[n(2358)]=document[n(808)](n(924)),this[n(2358)].classList[n(1857)](n(2351)),this[n(2358)].addEventListener("pointerdown",(t=>{const e=n;this._rectangleElement[e(1430)](t[e(828)]),this[e(1564)][e(958)][e(1857)](e(846)),this[e(701)](t)})),this._rectangleElement[n(2062)]("pointermove",(t=>this[n(701)](t))),this._rectangleElement.addEventListener("pointerup",(t=>{const e=n;this._rectangleElement[e(2129)](t[e(828)]),this._innerContainer[e(958)][e(856)](e(846))})),this[n(626)]=document[n(808)]("div"),this[n(626)].classList[n(1857)](n(1293)),this._innerContainer=document.createElement(n(924)),this[n(1564)][n(958)].add(n(1331)),this[n(1564)].append(this[n(2358)]),this[n(1564)][n(1969)](this[n(626)]),this[n(1003)][n(1969)](this[n(1564)]),this[n(679)](),this[n(1502)]((0,e.OF)((()=>this._innerContainer.remove()))),this[n(1502)](this[n(866)][n(1965)].onChange((()=>{const t=n;!this[t(1564)][t(958)][t(731)](t(846))&&this._refresh()})))}[t(701)](e){const i=t;if(!this[i(1564)][i(958)][i(731)](i(846)))return;const s=(0,w.u)(e.offsetX/(this[i(2358)][i(1087)]-1),1,0),n=1-(0,w.u)(e[i(1473)]/(this[i(2358)][i(599)]-1),1,0),o=this[i(866)][i(1965)].primary[i(642)];this[i(866)].palette[i(1690)].hsv=ht.mC.createReadonlyHsvColor(o[0],s,n),this[i(626)][i(1033)][i(2061)]=s*(this[i(2358)][i(1087)]-1)+"px",this[i(626)][i(1033)].bottom=n*(this[i(2358)][i(599)]-1)+"px",this._refresh()}[t(679)](){const e=t,i=this[e(866)][e(1965)].primary.rgb;this._targetElement.style[e(1442)]="rgba("+i[0]+","+i[1]+","+i[2]+e(1877);const s=this[e(866)].palette[e(1690)][e(642)];!this._innerContainer[e(958)][e(731)](e(846))&&(this._targetElement[e(1033)][e(2061)]=s[1]*(this[e(2358)][e(1087)]-1)+"px",this[e(626)][e(1033)][e(2364)]=s[2]*(this[e(2358)].offsetHeight-1)+"px");const n=ht.mC.toRgb(ht.mC[e(2236)](s[0],1,1));this[e(2358)][e(1033)][e(1442)]=e(1917)+"linear-gradient(to right, rgb(255,255,255) 0%, rgb("+n[0]+","+n[1]+","+n[2]+e(628)}}let Ki=class extends e.JT{constructor(i,s){const n=t;super(),this._luna=i;const o=document[n(808)](n(924));o[n(958)][n(1857)](n(826));const r=document[n(808)](n(1446));r[n(590)]=n(1284),r[n(2178)](n(773),"hex"),r.title=n(2311),this[n(2216)]=document[n(808)](n(1211)),this[n(2216)].id=n(1143),this[n(2216)][n(1147)]="[0-9a-fA-F]*",this[n(2216)][n(1608)]="The primary color's hex value in the format rrggbb. When changing, rgb will be expanded to rrggbb.",this._resetHexInput(),this[n(2216)].addEventListener("input",(()=>{const t=n,e=this[t(2216)][t(877)];if(6===e[t(1807)]){const i=(0,ht.FK)(this[t(866)][t(1965)].primary[t(996)]);i[0]=parseInt(e[t(2136)](0,2),16),i[1]=parseInt(e[t(2136)](2,4),16),i[2]=parseInt(e[t(2136)](4,6),16),this[t(866)][t(1965)][t(1690)].rgb=i}})),this[n(2216)][n(2062)](n(1426),(t=>{const e=n;switch(t[e(1351)]){case"ArrowUp":this._changeHexInput(t,ye.V5&&t[e(1373)]||!ye.V5&&t[e(2326)]?16:1);break;case e(1852):this[e(981)](t,ye.V5&&t.metaKey||!ye.V5&&t[e(2326)]?-16:-1);break;case"ArrowLeft":(ye.V5&&t[e(1373)]||!ye.V5&&t[e(2326)])&&this._changeHexInput(t,-255);break;case e(1173):(ye.V5&&t.metaKey||!ye.V5&&t[e(2326)])&&this[e(981)](t,255)}})),this[n(2216)][n(2062)](n(1541),(()=>{const t=n,e=this._hexInputElement[t(877)];if(e[t(2253)](/^[0-9a-fA-F]+$/))if(3===e[t(1807)]){const i=(0,ht.FK)(this[t(866)][t(1965)][t(1690)][t(996)]);i[0]=parseInt(e.substring(0,1)[t(1398)](2),16),i[1]=parseInt(e[t(2136)](1,2)[t(1398)](2),16),i[2]=parseInt(e.substring(2,3)[t(1398)](2),16),this._luna.palette.primary[t(996)]=i}else this[t(1687)]();else this[t(1687)]()})),o[n(1969)](r,this[n(2216)]),s.appendChild(o),this[n(1502)](this._luna[n(1965)][n(661)]((()=>this[n(1687)]()))),this[n(1502)]((0,e.OF)((()=>o[n(856)]())))}[t(1687)](){const e=t;this[e(2216)]&&(this[e(2216)][e(877)]=this._colorToHex(this._luna[e(1965)][e(1690)][e(996)]))}[t(981)](e,i){const s=t;if(!this[s(2216)])return;const n=this[s(2216)][s(622)],o=this[s(2216)][s(1894)];if(null===n||null===o)return;const r=n<=1,a=n>1&&n<4||o>2&&o<4||n<=1&&o>=4,h=n>=4||o>4;if(!r&&!a&&!h)return;const c=(0,ht.FK)(this[s(866)][s(1965)][s(1690)][s(996)]);r&&(c[0]=Math[s(2338)](255,Math[s(1445)](0,parseInt(this[s(2216)][s(877)][s(2136)](0,2),16)+i))),a&&(c[1]=Math[s(2338)](255,Math.max(0,parseInt(this[s(2216)][s(877)][s(2136)](2,4),16)+i))),h&&(c[2]=Math[s(2338)](255,Math[s(1445)](0,parseInt(this[s(2216)][s(877)][s(2136)](4,6),16)+i))),this._luna[s(1965)][s(1690)][s(996)]=c,e[s(2075)](),this[s(2216)][s(622)]=n,this._hexInputElement.selectionEnd=o}_colorToHex(e){const i=t;return""+this[i(1159)](e[0])+this[i(1159)](e[1])+this[i(1159)](e[2])}[t(1159)](e){const i=t;return e[i(993)](16).padStart(2,"0")[i(1572)]()}};var $i,Zi;Ki=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if("object"==typeof Reflect&&typeof Reflect[o(1552)]===o(1626))h=Reflect[o(1552)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([($i=0,Zi=si,function(t,e){Zi(t,e,$i)})],Ki);const Qi=["h","s","v"];class ts extends Gi{constructor(e,i,s){const n=t;super(e,i,e[n(1965)][n(661)],s[n(1572)](),Math[n(2337)](e[n(1965)][n(1690)][n(642)][Qi[n(899)](s)]*("h"===s?1:100)),0,"h"===s?360:100,n("h"===s?1724:"s"===s?2110:1497)+n(2287),"h"===s?void 0:"%"),this[n(939)]=s,this[n(1001)]=Qi[n(899)](s),this[n(679)]()}_sanitizeValue(e){const i=t;return Math[i(1445)](Math.min(Math[i(2337)](e)||0,this[i(886)]),0)}[t(733)](){const e=t,i=this[e(866)][e(1965)][e(1690)].hsv[Qi[e(899)](this._channel)];return Math[e(2337)](i*("h"===this[e(939)]?1:100))}[t(2170)](e){const i=t,s=this[i(1482)](e);if("h"===this[i(939)])this[i(866)][i(1965)][i(1690)].hue=s;else{const t=this[i(866)][i(1965)][i(1690)][i(642)];let e;e="s"===this[i(939)]?ht.mC[i(2236)](t[0],s/100,t[2]):ht.mC.createReadonlyHsvColor(t[0],t[1],s/100),this[i(866)][i(1965)].primary[i(642)]=e}}[t(1948)](){const e=t;if(void 0===this[e(1001)])return e(1649);if("h"===this._channel)return e(1072);const i=this._luna[e(1965)][e(1690)][e(642)],s=[0===this[e(1001)]?0:i[0],1===this[e(1001)]?0:Math[e(2337)](100*i[1]),2===this[e(1001)]?0:Math[e(2337)](100*i[2])],n=[0===this[e(1001)]?360:i[0],1===this._channelIndex?100:Math[e(2337)](100*i[1]),2===this[e(1001)]?100:Math[e(2337)](100*i[2])];return e(1082)+s[0]+","+s[1]+"%,"+s[2]+"%) 0%, hsl("+n[0]+","+n[1]+"%,"+n[2]+e(1534)}}class es extends qi{constructor(e,i){const s=t;super(e,i,e[s(1965)].onChange,s(1991),0,360)}[t(733)](){const e=t;return this[e(866)][e(1965)][e(1690)][e(1991)]}[t(2170)](e){const i=t;this[i(866)][i(1965)][i(1690)].hue=e>360?e%360:e}[t(1948)](){return t(1072)}}var is=function(t,e){return function(i,s){e(i,s,t)}};let ss=class extends Wi{constructor(i,s,n,o,r){const a=t;super(a(864),i,"Colors"),this[a(866)]=s,this[a(503)]=n,this[a(1359)]=o,this._windowVisibleContextKey=r[a(732)](0,!0),this[a(1502)](this[a(2208)]((t=>this[a(809)][a(917)](t))));const h=this[a(776)](a(1630),a(1526),this[a(503)][a(2031)],a(2265));this[a(503)][a(871)]((t=>{const e=a;h[e(988)]=t,this[e(705)]()})),this[a(1604)].append(h),this[a(866)].palette.primary[a(621)]=ht.m4[a(523)](0,0,0,255),this[a(866)].palette[a(1277)][a(621)]=ht.m4[a(523)](255,255,255,255);const c=document.createElement(a(924));c[a(958)][a(1857)](a(805)),this._primaryColorDiv=this[a(2241)](a(1690)),this._secondaryColorDiv=this._createColorInfo("secondary");const l=document.createElement(a(1310));l[a(958)].add(a(2335),a(1028)),this.register((0,e.Lw)(l,a(1517),(()=>o[a(2079)](a(1986))))),c[a(1969)](this._primaryColorDiv[a(1655)],this._secondaryColorDiv[a(1655)],l);const d=document[a(808)]("div");d[a(958)][a(1857)](a(2061)),d[a(1969)](c);const u=document[a(808)](a(924));u[a(958)][a(1857)](a(1652)),this[a(854)]=document.createElement("div"),this[a(854)][a(958)][a(1857)](a(511)),this[a(1502)](new Ji(this[a(866)],u)),this.register(new es(this[a(866)],u)),this._contentElement[a(1969)](d,u,this._rightElement),this[a(1502)]((0,e.OF)((()=>{const t=a;(0,e._c)(this[t(1007)]),this._colorDetailsDisposables=void 0,d[t(856)](),u[t(856)]()}))),this[a(679)](),this[a(1502)](this._luna.palette[a(661)]((()=>this[a(679)]())))}[t(2241)](e){const i=t,s=document[i(808)](i(924));s.id=e,s[i(958)][i(1857)](e);const n=document[i(808)](i(924));return n[i(958)][i(1857)](i(2230)),s[i(1484)](n),n}[t(679)](){const e=t,i=this._luna[e(1965)][e(1690)].rgba,s=i[0]+","+i[1]+","+i[2];this._primaryColorDiv[e(1033)][e(1442)]=e(1963)+s+e(1644)+s+","+i[3]/255+e(628);const n=this._luna.palette[e(1277)].rgba,o=n[0]+","+n[1]+","+n[2];this[e(1570)][e(1033)].background=e(1963)+o+e(1644)+o+","+n[3]/255+e(628)}_createToggle(e,i,s,n){const o=t,r=document[o(808)](o(1211));return r[o(544)]=o(1399),r.id=e,r[o(988)]=s,r[o(1608)]=n,r.classList[o(1857)](e,"luna-icon"),r[o(2062)](o(1517),(()=>this[o(1359)][o(2079)](i))),r}[t(705)](){const i=t;if(this[i(503)][i(2031)]){if(!this[i(1007)]&&!this._hexInputElement){this._colorDetailsDisposables=[];for(const t of Xi)this._colorDetailsDisposables[i(585)](new Yi(this[i(866)],this[i(854)],t));this._colorDetailsDisposables[i(585)](new Ki(this._luna,this._rightElement));for(const t of Qi)this[i(1007)].push(new ts(this._luna,this._rightElement,t))}}else(0,e._c)(this._colorDetailsDisposables),this[i(1007)]=void 0,this[i(2216)]=void 0}};ss=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object[o(728)](i,s):n;if(typeof Reflect===o(1804)&&typeof Reflect[o(1552)]===o(1626))h=Reflect[o(1552)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([is(1,si),is(2,vi),is(3,He),is(4,ze)],ss);class ns extends e.JT{constructor(e){const i=t;super(),this._luna=e,this[i(685)]=!1,this._onStateChange=this.register(new s.v),this[i(1952)]=this[i(2157)][i(1362)],this[i(866)].palette[i(661)]((()=>{const t=i;!this._ignoreStateChangeEvents&&this[t(2157)][t(1457)]({global:!0})}))}[t(524)](){const e=t;return{primary:Array[e(2324)](this[e(866)][e(1965)].primary[e(621)]),secondary:Array.from(this[e(866)][e(1965)][e(1277)].rgba)}}[t(2249)](e){const i=t;this[i(685)]=!0,this[i(866)][i(1965)][i(1690)].rgba=ht.m4.createReadonlyRgbaColor(e[i(1690)][0],e[i(1690)][1],e[i(1690)][2],e.primary[3]),this[i(866)][i(1965)][i(1277)][i(621)]=ht.m4[i(523)](e[i(1277)][0],e.secondary[1],e[i(1277)][2],e[i(1277)][3]),this[i(685)]=!1}}Ei[t(1502)]({start(e){const i=t,s=e[i(876)](si);e[i(876)](ci).registerStateHandler(i(1965),new ns(s))}}),ji({id:"color.toggleColorsWindow",label:"Toggle Colors Window",section:"Window",checked:0,run:e=>e[t(876)](hi)[t(1774)](t(864))}),ji({id:t(1986),label:t(1047),section:t(606),run:e=>e.get(si)[t(1965)].swap(),keys:"x"}),ji({id:t(1526),label:"Toggle Color Details",section:t(606),run:t=>{const e=t.get(vi);e.showColorDetails=!e.showColorDetails}}),mi[t(1502)](t(864),{ctor:ss,defaultVisible:!0,defaultPosition:{x:t(2219),y:t(554)}});class os extends e.JT{constructor(e,i){const s=t;super(),this._contentElement=document[s(808)]("div"),this._contentElement.id=i[s(929)]().replace(/ /g,""),this[s(1261)][s(958)].add(s(1992),s(1463)),e[s(1484)](this[s(1261)]),this[s(1502)]({dispose:()=>{const t=s;e.removeChild(this[t(1261)])}})}}let rs=class extends os{constructor(e,i){const s=t;super(e,s(2150)),this[s(1359)]=i,this[s(1246)]=[];const n=document[s(808)](s(924));n[s(958)].add(s(1326)),this._inputElement=document[s(808)]("input"),this[s(1982)][s(544)]=s(1386),this[s(1982)][s(2062)](s(1211),(()=>this[s(1750)]())),this[s(1982)][s(2062)](s(1426),(t=>this._keyDown(t))),n[s(1484)](this[s(1982)]);const o=document[s(808)]("ul");o[s(958)][s(1857)](s(737));for(let t=0;t<18;t++)this._listItemElements.push(this[s(1219)]());o[s(1969)](...this._listItemElements),this[s(1750)](),this[s(1261)][s(958)][s(1857)](s(1447)),this[s(1261)][s(1969)](n,o),this._inputElement.focus()}_createListItemElement(){return document[t(808)]("li")}_fillCommands(){const e=t,i=this[e(1359)].filterCommands(this._inputElement[e(877)],18);let s=0;for(;s<i[e(1807)];s++){const t=i[s],n=this[e(1246)][s];n.textContent=t[e(1441)]+": "+t[e(1446)],n.classList.remove(e(1074))}for(;s<18;s++)this[e(1246)][s][e(958)].add("hidden")}[t(995)](e){const i=t;if(e[i(1351)]===i(989)){const t=this._commandService[i(1513)](this[i(1982)][i(877)],18);return t[i(1807)]>0&&this[i(1359)][i(2079)](t[0].id),void this[i(1800)]()}}};var as;let hs;async function cs(e){const s=t,n=document.activeElement;if(n?.[s(1451)]===s(1038)){const t=n;let e;return e=null===t.selectionStart||null===t[s(1894)]||t[s(622)]===t[s(1894)]?t.value:t[s(877)][s(2136)](t[s(622)],t[s(1894)]),void navigator.clipboard[s(1431)](e)}const o=e[s(876)](si);if(!o[s(759)][s(1377)])return;const r=o[s(2386)][s(1375)];if(!r)return;const a=await r[s(1146)]({range:o.selection[s(1377)],useMovingLayer:!0});hs=o[s(759)][s(1377)],await as.write(a),o.render[s(2328)](s(919)+(0,i.Oq)(o.selection[s(1377)])+"x"+(0,i.rY)(o[s(759)][s(1377)])+" to clipboard")}var ls,ds;rs=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object[o(728)](i,s):n;if(typeof Reflect===o(1804)&&typeof Reflect[o(1552)]===o(1626))h=Reflect.decorate(e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([(ls=1,ds=He,function(t,e){ds(t,e,ls)})],rs),ji({id:t(1672),label:t(1658),section:"Command",run:e=>{const i=t;e[i(876)](je)[i(1100)](rs,document[i(1222)])},keys:[t(1722),"f1"]}),function(e){const i=t;e.write=async function(t){const e=a2_0x27c6,i=new ClipboardItem({"image/png":t});if(!(e(1356)in navigator.clipboard))throw new Error("navigator.clipboard.write not supported");await navigator[e(1507)][e(1356)]([i])},e[i(847)]=async function(){const t=a2_0x27c6;return(await navigator.permissions[t(1407)]({name:t(1908)})).state!==t(1851)||(console[t(1388)](t(2135)),!1)},e.read=async function(){const t=i;if((await navigator[t(1202)].query({name:"clipboard-read"}))[t(2316)]===t(1851))return void console[t(1388)](t(2135));const e=await navigator[t(1507)][t(568)]();for(const i of e){if(i[t(1185)].includes(t(1101)))return await i[t(1854)]("image/png");console[t(598)](t(1682))}}}(as||(as={})),Ei.register({start(e){const i=t,s=e[i(876)](si),n=e[i(876)](ze).bind(9,!1),o=e.get(ze)[i(732)](8,!1);s[i(1280)][i(1923)]((()=>{const t=i;n.set(s[t(1280)][t(915)]),o[t(917)](s[t(1280)][t(670)])}))}}),ji({id:t(1577),label:t(2083),section:t(2102),run:function(e){const i=t,s=e[i(876)](si);return s.history.createCompositeEntry(i(1624),(async()=>{const t=i;await cs(e),await s[t(759)][t(1286)]()}))},keys:"cmdctrl+x"}),ji({id:t(1594),label:t(932),section:t(2102),run:cs,keys:t(750)}),ji({id:t(1656),label:"Paste",section:"Edit",run:async function(e){const i=t,s=e[i(876)](si),n=s[i(2386)][i(1375)];if(!n)return;if(!as[i(847)]())return;await s.layer[i(983)]();const o=await as.read();o&&await s.history[i(1384)](i(2059),(()=>n.importBlob(o,hs)))},keys:t(657)}),ji({id:t(1757),label:"Redo",section:t(2102),run:e=>e[t(876)](si).history[t(1913)](),keys:ye.V5?t(1955):t(1127),enabled:9}),ji({id:t(1650),label:t(1114),section:t(2102),run:e=>e.get(si).history[t(1921)](),keys:t(1516),enabled:8}),ji({id:t(1427),label:t(1542),section:"File",run:e=>e[t(876)](si).file[t(2375)](20,15),keys:"ctrl+n"}),ji({id:t(641),label:t(987),section:t(743),run:async e=>e[t(876)](Qe).open(),keys:t(1632)}),ji({id:t(2272),label:t(1094),section:t(743),run:async e=>e.get(Qe)[t(819)](),keys:"ctrl+s"}),ji({id:t(2286),label:t(1668),section:"File",run:async e=>e.get(Qe)[t(633)](),keys:t(2339)});var us=function(t,e){return function(i,s){e(i,s,t)}};let ms=class e extends Wi{constructor(e,i,s){const n=t;super(n(1280),e,n(1390)),this[n(866)]=i,this._contextKeyService=s,this[n(1246)]=[],this[n(809)]=this[n(1233)].bind(6,!0),this.register(this[n(2208)]((t=>this[n(809)][n(917)](t)))),this._listElement=document[n(808)]("ul"),this[n(2166)].classList[n(1857)](n(1051)),this.register(this._luna[n(1280)][n(1923)]((()=>this[n(2122)]()))),this[n(2122)](),this[n(1261)].appendChild(this._listElement)}_render(){const i=t,s=document[i(786)](),n=this[i(866)][i(1280)][i(1314)];let o,r=!1,a=!1;for(const[t,h]of this[i(866)].history.entries[i(605)]()){let c;if(t<this[i(1246)][i(1807)])c=this[i(1246)][t];else{c=document[i(808)]("li"),c[i(615)]=0;const n=async()=>{const s=i;if(!this[s(866)].history[s(1314)])return;const n=t-this[s(866)][s(1280)][s(605)][s(899)](this[s(866)][s(1280)][s(1314)]),o=n>0?e[s(616)]?e[s(616)]:this[s(866)][s(1280)].redo:e[s(1317)]?e[s(1317)]:this._luna[s(1280)].undo;for(let t=0;t<Math[s(2091)](n);t++)await o()};c[i(2062)]("click",(()=>n())),c.addEventListener("keydown",(t=>{const e=i;switch(t[e(1351)]){case e(1835):c[e(2329)]?.[e(1603)](),t[e(2075)](),t[e(1529)]();break;case e(1852):c.nextSibling?.[e(1603)](),t[e(2075)](),t[e(1529)]();break;case e(989):case e(1505):n(),t[e(2075)](),t[e(1529)]()}})),s.appendChild(c),this[i(1246)].push(c)}c[i(590)]=h[i(875)],c.classList.toggle(i(1913),r),a=h===n,c[i(958)].toggle(i(846),a),a&&(r=!0,o=c)}for(this[i(2166)].appendChild(s);this[i(1246)].length>this[i(866)].history[i(605)].length;)this[i(2166)].removeChild(this._listItemElements[i(1163)]());o?(this._contentElement[i(1385)]+this[i(2166)].offsetTop>o[i(1874)]||this[i(1261)].scrollTop<o.offsetTop-this._contentElement[i(599)])&&(this[i(1261)][i(1385)]=o[i(1874)]-this[i(2166)][i(1874)]):this[i(1261)][i(1385)]=this[i(1261)][i(891)]}};ms=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(1804)&&"function"==typeof Reflect[o(1552)])h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([us(1,si),us(2,ze)],ms),mi[t(1502)]("history",{ctor:ms,defaultVisible:!0,defaultPosition:{x:t(554),y:"start"}}),ji({id:"history.toggleHistoryWindow",label:"Toggle History Window",section:t(1200),checked:6,run:e=>e[t(876)](hi)[t(1774)](t(1280))});let gs=class extends e.JT{constructor(e){const i=t;super(),this._lunaService=e,this.target=1,this[i(2238)]=1,this[i(1685)]="image-dimensions",this.hasImage=!0,this.commandId=i(1064),this._onUpdate=this.register(new s.v),this.onUpdate=this[i(2290)][i(1362)],this[i(1957)][i(2386)][i(559)]((()=>this[i(1936)]())),this[i(1936)]()}[t(1936)](){const e=t;(this[e(816)]!==this[e(1957)][e(2386)][e(2164)]||this._height!==this[e(1957)][e(2386)].height)&&(this._width=this[e(1957)][e(2386)][e(2164)],this._height=this[e(1957)].layer[e(918)],this.text=this[e(816)]+" x "+this[e(1494)],this[e(1608)]=e(1727)+this[e(816)]+e(645)+this[e(1494)]+" pixels tall",this[e(2290)][e(1457)]())}};var fs,ps;gs=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(1804)&&typeof Reflect[o(1552)]===o(1626))h=Reflect.decorate(e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([(fs=0,ps=si,function(t,e){ps(t,e,fs)})],gs);var _s=function(t,e){return function(i,s){e(i,s,t)}};let ys=class extends Wi{constructor(i,s,n,o,r,a){const h=t;super(h(892),i,h(1859)),this[h(866)]=s,this[h(1359)]=n,this[h(1233)]=o,this[h(1175)]=r,this[h(2108)]=a,this._imageListItems=new Map,this._imagesMap=new Map,this[h(809)]=this[h(1233)][h(732)](2,!0),this[h(1502)](this[h(2208)]((t=>this[h(809)][h(917)](t)))),this[h(1738)]=document.createElement(h(924)),this[h(1738)][h(958)].add(h(1725));const c=document.createElement("div");c[h(958)][h(1857)]("actions"),c[h(1969)](this[h(1533)](h(1764),(()=>this[h(1359)][h(2079)](h(1776))),h(2116)),this._createButton(h(1893),(()=>this[h(866)][h(1882)][h(901)]()),"Delete the active image"),this._createButton("image-move-up",(()=>this._luna.image[h(1032)]()),h(1883)),this._createButton(h(1210),(()=>this[h(866)].image[h(1844)]()),h(1978))),this[h(1261)][h(1969)](this._imageListElement,c),this.register(this[h(866)][h(1882)][h(574)]((()=>this[h(1238)]()))),this[h(1502)]({dispose:()=>{const t=h;for(const i of this[t(1192)][t(1673)]())(0,e._c)(i[t(1496)])}}),this[h(1238)]()}_createButton(e,i,s){const n=t,o=document[n(808)](n(1310));o.id=e,o[n(1608)]=s;const r=document[n(808)]("img");return o[n(1484)](r),o[n(958)][n(1857)](e,n(1028)),o[n(2062)](n(1517),i),o}_rebuildImageCache(){const e=t,i=this[e(866)].image[e(1998)];if(this[e(1102)][e(1112)](),i)for(const t of i)this._imagesMap.set(t.id,t)}[t(1238)](){const i=t,s=this[i(866)][i(1882)][i(1998)],n=this[i(866)][i(1882)][i(741)];if(!s||void 0===n)return;this[i(1142)]();let o=null;const r=s;for(let t=r[i(1807)]-1;t>=0;t--){const s=t,a=r[t].id;if(!this[i(1192)].has(a)){const t={container:document[i(808)](i(924)),nameSpan:document[i(808)](i(1548)),previewCanvas:document[i(808)](i(589)),disposables:[]};t[i(1154)][i(958)].add("image-entry"),t.previewCanvas[i(958)].add(i(618)),t.previewCanvas[i(2164)]=40,t[i(1323)][i(918)]=40;let n=!1;t[i(1496)].push(this._luna[i(2386)][i(623)]((()=>n=!0))),this[i(2261)][i(585)](this._luna[i(1280)][i(1923)]((()=>{n&&(this[i(885)](a,t),n=!1)}))),this[i(885)](a,t),t[i(1154)].appendChild(t[i(1323)]),t.container[i(615)]=0,t[i(1154)][i(1904)]=!0,t[i(1496)][i(585)]((0,e.Lw)(t.container,i(1217),(t=>{const e=i;this[e(1261)][e(958)][e(1857)](e(703)),t.dataTransfer&&(t[e(1288)][e(2144)]="move",t[e(1288)][e(968)]=e(2165),t[e(1288)][e(1631)]("text/plain","luna-image://"+l.id)),t[e(1529)]()}))),t[i(1496)].push((0,e.Lw)(t[i(1154)],i(2352),(()=>{const t=i;this._contentElement[t(958)][t(856)]("dragging")}))),t.disposables[i(585)]((0,e.Lw)(t[i(1154)],i(2340),(e=>{const s=i;t[s(1154)].classList[s(856)](s(1212));const n=this._getImageDragEventId(e);n&&(this[s(866)][s(1882)][s(2371)](n,l.id),setTimeout((()=>{const t=s;this[t(1192)].get(n)?.[t(1154)][t(1603)]()}))),e[s(1529)]()}))),t[i(1496)][i(585)]((0,e.Lw)(t[i(1154)],i(1937),(e=>{const s=i,n=this[s(1213)](e);l.id!==n&&(e[s(2075)](),t[s(1154)][s(958)][s(1857)](s(1212)))}))),t[i(1496)].push((0,e.Lw)(t[i(1154)],"dragleave",(e=>{const s=i;t[s(1154)][s(958)][s(856)](s(1212))}))),t[i(812)][i(958)][i(1857)](i(1424)),t[i(1154)].addEventListener(i(1517),(()=>this[i(1576)](a))),t[i(1154)][i(2062)](i(2096),(async t=>{const e=i;switch(t[e(2075)](),t.stopImmediatePropagation(),await this._contextMenuService[e(1183)]([{id:"duplicate",label:e(1063)},{id:"delete",label:e(2296)}])){case e(727):await this[e(866)][e(1882)].duplicateImage(l);break;case"delete":await this[e(866)][e(1882)][e(901)](l)}})),t[i(1154)][i(2062)](i(1426),(async e=>{const n=i;switch(e[n(1351)]){case n(1835):t[n(1154)][n(2329)]?.[n(1603)](),e[n(2075)]();break;case"ArrowDown":t[n(1154)].nextSibling?.[n(1603)](),e[n(2075)]();break;case"Enter":case n(1505):await this[n(1576)](s)}})),t.container[i(1484)](t[i(812)]),this._imageListItems[i(917)](a,t),t.disposables[i(585)](this[i(866)][i(1882)][i(1901)]((e=>{const s=i;if(e===a){this[s(1738)].removeChild(t.container);for(const e of t[s(1496)])e[s(1800)]();this[s(1192)].delete(a)}})))}const h=this._imageListItems[i(876)](a),c=t===n;h[i(1154)][i(958)][i(1259)](i(846),c);const l=this._imagesMap[i(876)](a);this[i(1567)](l,h),null===o?(!h[i(1154)].parentElement||null!==h[i(1154)][i(2329)])&&(this._imageListElement[i(2282)]?this._imageListElement[i(1190)](h.container,this[i(1738)][i(2282)]):this[i(1738)][i(1484)](h[i(1154)])):h[i(1154)].previousSibling!==o&&o[i(564)](i(878),h[i(1154)]),o=h[i(1154)]}}async[t(885)](e,i){const s=t;this._rebuildImageCache();const n=this[s(1102)][s(876)](e);if(!n)return;const o=new ImageData(new Uint8ClampedArray(n[s(1253)]),n[s(2164)],n[s(918)]),r=await createImageBitmap(o),a=i.previewCanvas[s(573)]("2d");a[s(1309)](0,0,40,40),n.width>=40||n.width>=40?a.drawImage(r,0,0,40,40):a[s(588)](r,Math[s(2337)]((40-n[s(2164)])/2),(40-n.height)/2,n[s(2164)],n[s(918)]),this._refreshTitle(n,i)}[t(1567)](e,i){const s=t,n=[-1===e[s(1588)]?"corrupt":e[s(1588)]+s(1140)];e.mimeType&&n[s(585)]("("+("image/bmp"===e[s(2297)]?s(1396):s(1126))+")"),i.nameSpan.textContent=e[s(2164)]+"x"+e[s(918)]+(n[s(1807)]>0?s(596)+n[s(1305)](" "):"")}async[t(1576)](e){const i=t,s=this[i(866)][i(1882)][i(1998)]?.findIndex((t=>t.id===e));-1!==s&&await this[i(866)][i(1882)].setActiveImage(s)}[t(1213)](e){const i=t;if(e[i(1288)]){const t=e[i(1288)][i(1400)]("text/plain");if(t?.[i(738)](i(1258)))return parseInt(t[i(2136)](13))}}};ys=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object[o(728)](i,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect[o(1552)](e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([_s(1,si),_s(2,He),_s(3,ze),_s(4,Ze),_s(5,ai)],ys);let ws=class extends e.JT{constructor(e){const i=t;super(),this._lunaService=e,this[i(1996)]=1,this.alignment=1,this.className=i(1559),this[i(1336)]=!0,this[i(2168)]=!1,this[i(1153)]=i(1064),this._onUpdate=this[i(1502)](new s.v),this[i(822)]=this[i(2290)][i(1362)],this[i(1957)][i(1116)][i(2015)]((t=>this._update(t)))}[t(1936)](e){const i=t;this[i(2168)]=!!e,e&&(this[i(1386)]=e[0]+","+e[1]),this[i(2290)][i(1457)]()}};var vs,bs;ws=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object[o(728)](i,s):n;if(typeof Reflect===o(1804)&&typeof Reflect[o(1552)]===o(1626))h=Reflect[o(1552)](e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([(vs=0,bs=si,function(t,e){bs(t,e,vs)})],ws);var xs=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(728)](i,s):n;if("object"==typeof Reflect&&typeof Reflect[o(1552)]===o(1626))h=Reflect[o(1552)](e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h},Is=function(t,e){return function(i,s){e(i,s,t)}};let Ss=class extends e.JT{constructor(e,i){const n=t;super(),this[n(1957)]=e,this[n(1524)]=i,this.target=1,this[n(2238)]=1,this[n(1685)]=n(1077),this[n(1336)]=!0,this[n(2168)]=!0,this[n(1608)]=n(1928),this[n(1153)]=n(813),this[n(2290)]=this[n(1502)](new s.v),this.onUpdate=this[n(2290)][n(1362)],this[n(1957)][n(1116)][n(2015)]((t=>{const e=n;this._lastCoord=t,this[e(1936)](t)})),this._lunaService[n(2386)][n(623)]((()=>this[n(1936)](this[n(2275)])))}_update(e){const i=t,s="allLayers"===this[i(1524)].config.statusBarPointerColor;let n;e&&(n=this[i(1957)][i(2386)][i(1803)](e[0],e[1],s));const o=n?n[0]+","+n[1]+","+n[2]+","+n[3]:"";this[i(1386)]!==o&&(this[i(1386)]=o,this[i(2290)][i(1457)]())}};xs([gi(50)],Ss[t(752)],"_update",null),Ss=xs([Is(0,si),Is(1,Ye)],Ss),mi[t(1502)](t(892),{ctor:ys,defaultVisible:!1,defaultPosition:{x:t(554),y:{target:t(634),side:t(554)}}}),Ei[t(1502)]({start(e){const i=t,s=e.get(ni),n=e[i(876)](je);s[i(1864)](n[i(1100)](Ss)),s.createItem(n[i(1100)](ws)),s.createItem(n[i(1100)](gs))}}),ji({id:t(2046),label:t(817),section:t(1200),checked:2,run:e=>{const i=t;if(void 0===e.get(si)[i(1882)][i(1998)])throw new Error(i(1938));e[i(876)](hi)[i(1774)](i(892))}}),ji({id:t(1776),label:"Add Image",section:"Image",enabled:10,run:async e=>{const i=t,s=e[i(876)](ai),{width:n,height:o}=await s[i(1683)](),r=await s.requestQuickPick(i(789),[{id:"1",label:i(648),description:i(1862)},{id:"4",label:"4-bit",description:i(565)},{id:"8",label:i(1799),description:i(1289)},{id:"24",label:i(2365),description:"True color"},{id:"32",label:i(1002),description:i(1337)}]);if(void 0!==r)return e[i(876)](si).image[i(1539)](n,o,parseInt(r))}}),ji({id:t(1186),label:t(1151),section:t(1312),enabled:10,run:async e=>e[t(876)](si).image[t(901)]()}),ji({id:t(1598),label:t(769),section:t(1312),run:e=>e[t(876)](si)[t(1882)][t(2094)]()}),ji({id:"image.goToBottomImage",label:t(1770),section:"Image",run:e=>e.get(si)[t(1882)].goToBottomImage()}),ji({id:t(2231),label:t(1392),section:"Image",run:e=>e[t(876)](si).image[t(1700)]()}),ji({id:t(1109),label:"Go to Image Below",section:t(1312),run:e=>e[t(876)](si)[t(1882)][t(1831)]()}),ji({id:"image.moveImageToTop",label:"Move Image to Top",section:"Image",run:t=>t.get(si).image.moveImageToTop()}),ji({id:t(1006),label:t(1334),section:"Image",run:e=>e[t(876)](si)[t(1882)].moveImageUp()}),ji({id:t(656),label:"Move Image Down",section:"Image",run:e=>e.get(si)[t(1882)][t(1844)]()}),ji({id:t(2072),label:t(2204),section:t(1312),run:e=>e.get(si).image[t(2163)]()}),ji({id:t(1135),label:t(579),section:t(1312),run:async e=>{const i=t,s=e[i(876)](si);await s[i(1022)][i(1629)](i(2125),{selection:s[i(759)][i(1377)]})},keys:"ctrl+shift+x",enabled:7}),ji({id:t(1766),label:"Expand Canvas to Selection",section:"Image",run:async e=>{const i=t,s=e[i(876)](si);await s[i(1022)][i(1629)](i(1593),{selection:s[i(759)][i(1377)]}),s[i(1116)][i(2120)]()},enabled:7}),ji({id:t(1064),label:t(1956),section:t(1312),run:async e=>{const i=t,s=await e.get(si),n=await e[i(876)](ai)[i(1596)]("layer/resize");await s[i(1022)][i(1629)](i(595),n)},keys:t(2186)}),ji({id:t(2185),label:t(1477),section:t(1312),run:async e=>{const i=t,s=e[i(876)](si),n=await e[i(876)](ai)[i(1596)]("layer/resizeCanvas");await s[i(1022)][i(1629)](i(1897),n)},keys:t(790)}),ji({id:t(1929),label:t(1735),section:t(1312),run:async e=>{const i=t,s=e[i(876)](si);await s[i(1022)][i(1629)](i(631),{selection:s[i(759)].range})}}),ji({id:t(851),label:"Flip Vertical",section:"Image",run:async e=>{const i=t,s=e[i(876)](si);await s[i(1022)][i(1629)](i(1271),{selection:s[i(759)].range})}}),ji({id:t(726),label:t(1409),section:t(1312),run:async e=>{const i=t,s=e.get(si);await s.task[i(1629)](i(772),{selection:s[i(759)][i(1377)]})},keys:"ctrl+j"}),ji({id:t(683),label:t(1428),section:"Image",run:async e=>{const i=t,s=e[i(876)](si);await s[i(1022)][i(1629)](i(2257),{selection:s[i(759)].range})},keys:"ctrl+h"}),ji({id:t(2093),label:"Rotate 90° Counter Clockwise",section:t(1312),run:async e=>{const i=t,s=e.get(si);await s[i(1022)][i(1629)](i(2212),{selection:s[i(759)].range})},keys:"ctrl+g"}),ji({id:t(1783),label:t(874),section:"Image",run:e=>e.get(si)[t(2386)][t(1432)](),keys:"ctrl+shift+f"}),ji({id:t(1117),label:"Finish Active Action",section:"Image",run:e=>e[t(876)](si)[t(2386)][t(983)](),keys:t(1493)}),ji({id:t(813),label:t(1037),section:t(1312),run:async e=>{const i=t,s=e[i(876)](Ye),n=s.config[i(761)],o=await e[i(876)](ai)[i(1226)](i(1452),[{id:i(1357),label:"Layer",description:n===i(1357)?"Active":void 0,detail:"The color of only the current layer"},{id:i(1440),label:"Image",description:n===i(1440)?i(2228):void 0,detail:i(1833)}]);if(o)switch(o){case"currentLayer":s[i(1203)]={...s.config,statusBarPointerColor:i(1357)};break;case"allLayers":s[i(1203)]={...s[i(1203)],statusBarPointerColor:"allLayers"}}}}),Ei[t(1502)]({start:()=>{const e=t;document[e(763)](e(1472))[e(1177)]((t=>{const i=e;t[i(2062)]("keydown",(t=>{const e=i,s=t[e(1996)]?.[e(1451)];if(s===e(1371)){t[e(700)]();const i=new Event(e(1211),{bubbles:!0});return void t[e(1996)][e(1744)](i)}if("INPUT"!==s)return;const n=t[e(1996)];if(n[e(544)]===e(1386))return void t[e(700)]();if(n[e(544)]!==e(711))return;let o;if(ye.V5&&t[e(1373)]||!ye.V5&&t[e(2326)])switch(t[e(1351)]){case"ArrowUp":o=parseInt(n.value)+10;break;case e(1852):o=parseInt(n.value)-10;break;case e(1078):o=""!==n[e(2338)]?parseInt(n.min):void 0;break;case e(1173):o=""!==n[e(1445)]?parseInt(n[e(1445)]):void 0}else switch(t[e(1351)]){case e(1835):o=parseInt(n[e(877)])+1;break;case e(1852):o=parseInt(n[e(877)])-1}if(void 0===o)return;""!==n.min&&(o=Math.max(o,parseInt(n[e(2338)]))),""!==n.max&&(o=Math[e(2338)](o,parseInt(n[e(1445)]))),n[e(877)]=o.toString(),t[e(2075)](),t.stopImmediatePropagation();const r=new Event(e(1211),{bubbles:!0});n[e(1744)](r)}))}))}});var Cs=function(t,e){return function(i,s){e(i,s,t)}};let Es=class extends Wi{constructor(e,i,s){const n=t;super("palette",e,"Palette"),this[n(866)]=i,this._windowVisibleContextKey=s[n(732)](4,!0),this[n(1502)](this[n(2208)]((t=>this._windowVisibleContextKey.set(t)))),this[n(1261)].append(this[n(593)](255,255,255),this[n(593)](0,0,0),this[n(593)](255,0,0),this[n(593)](255,255,0),this._createPaletteButton(0,255,0),this[n(593)](0,255,255),this[n(593)](0,0,255),this[n(593)](255,0,255),document[n(808)]("br"),this._createPaletteButton(255,255,255,192),this[n(593)](0,0,0,192),this._createPaletteButton(255,0,0,192),this[n(593)](255,255,0,192),this[n(593)](0,255,0,192),this[n(593)](0,255,255,192),this[n(593)](0,0,255,192),this._createPaletteButton(255,0,255,192),document[n(808)]("br"),this._createPaletteButton(255,255,255,128),this[n(593)](0,0,0,128),this._createPaletteButton(255,0,0,128),this._createPaletteButton(255,255,0,128),this[n(593)](0,255,0,128),this[n(593)](0,255,255,128),this[n(593)](0,0,255,128),this[n(593)](255,0,255,128),document[n(808)]("br"),this._createPaletteButton(255,255,255,64),this._createPaletteButton(0,0,0,64),this[n(593)](255,0,0,64),this[n(593)](255,255,0,64),this[n(593)](0,255,0,64),this[n(593)](0,255,255,64),this._createPaletteButton(0,0,255,64),this[n(593)](255,0,255,64))}_createPaletteButton(e,i,s,n=255){const o=t,r=document[o(808)]("div");r[o(958)][o(1857)](o(1914));const a=document[o(808)](o(924));r[o(2062)]("click",(()=>this[o(866)][o(1965)][o(1690)][o(621)]=ht.m4[o(523)](e,i,s,n))),r[o(2062)](o(2096),(t=>{const r=o;this[r(866)][r(1965)][r(1277)][r(621)]=ht.m4[r(523)](e,i,s,n),t[r(2075)]()})),a[o(958)][o(1857)]("color-overlay");const h=o(1121)+e+","+i+","+s+o(1877);return a[o(1033)].background=o(1935)+h+o(1029)+e+","+i+","+s+","+n/255+o(628),r[o(1484)](a),r}};Es=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(728)](i,s):n;if(typeof Reflect===o(1804)&&typeof Reflect.decorate===o(1626))h=Reflect[o(1552)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([Cs(1,si),Cs(2,ze)],Es),mi[t(1502)](t(1965),{ctor:Es,defaultVisible:!1,defaultPosition:{x:t(2219),y:{target:t(864),side:t(554)}}}),ji({id:"palette.togglePaletteWindow",label:t(2104),section:t(1200),checked:4,run:e=>e[t(876)](hi)[t(1774)](t(1965))});let Ts=class extends e.JT{constructor(e){const i=t;super(),this[i(1957)]=e,this.target=1,this[i(2238)]=0,this.className=i(1302),this.hasImage=!0,this.visible=!1,this[i(2290)]=this[i(1502)](new s.v),this.onUpdate=this[i(2290)][i(1362)],this[i(1957)][i(759)].onUpdate((()=>this._update())),this._update()}_update(){const e=t,s=this[e(1957)][e(759)].range;if(!s)return void(this[e(2168)]&&(this[e(1386)]="",this.visible=!1,this[e(2290)][e(1457)]()));const n=(0,i.Oq)(s),o=(0,i.rY)(s);this[e(1386)]=n+" x "+o,this[e(1608)]="Selection size is "+n+e(645)+o+e(729),this[e(2168)]=!0,this[e(2290)][e(1457)]()}};var Ls,As;Ts=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(1804)&&typeof Reflect[o(1552)]===o(1626))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([(Ls=0,As=si,function(t,e){As(t,e,Ls)})],Ts);let Rs=class extends e.JT{constructor(e){const i=t;super(),this[i(1957)]=e,this[i(1996)]=1,this[i(2238)]=0,this[i(1685)]=i(677),this[i(1336)]=!0,this.visible=!1,this._onUpdate=this.register(new s.v),this[i(822)]=this[i(2290)].event,this[i(1957)][i(759)][i(822)]((()=>this[i(1936)]())),this[i(1936)]()}[t(1936)](){const e=t,i=this[e(1957)][e(759)][e(1377)];i?(this.text=i.left+", "+i[e(800)],this.title="Selection top left position is x="+i[e(2061)]+e(957)+i[e(800)],this[e(2168)]=!0,this[e(2290)][e(1457)]()):this[e(2168)]&&(this[e(1386)]="",this[e(2168)]=!1,this._onUpdate[e(1457)]())}};var Ds,Ms;Rs=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object[o(728)](i,s):n;if(typeof Reflect===o(1804)&&typeof Reflect[o(1552)]===o(1626))h=Reflect[o(1552)](e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([(Ds=0,Ms=si,function(t,e){Ms(t,e,Ds)})],Rs),Ei[t(1502)]({start(e){const i=t;e[i(876)](ni).createItem(e[i(876)](je)[i(1100)](Rs)),e.get(ni)[i(1864)](e[i(876)](je)[i(1100)](Ts));const s=e[i(876)](si),n=e[i(876)](ze)[i(732)](7,!1);s[i(759)].onUpdate((()=>{const t=i;n[t(917)](!!s[t(759)][t(1377)])}))}}),ji({id:t(1843),label:t(708),section:"Selection",run:e=>e[t(876)](si).selection.selectAll(),keys:t(1434)}),ji({id:t(1264),label:t(1675),section:"Selection",run:e=>e.get(si).selection[t(865)](),keys:t(1916),enabled:7}),ji({id:t(1134),label:t(716),section:t(937),run:e=>e[t(876)](si)[t(759)][t(1286)](),keys:t(1156),enabled:7}),ji({id:t(1327),label:t(1176),section:"Selection",run:e=>e[t(876)](si)[t(759)].eraseKeepSelection(),enabled:7});class Bs extends e.JT{constructor(e,i,s){const n=t;super(),this.id=e,this._isVisible=!0,this[n(1261)]=document[n(808)](n(924)),this[n(1261)].id=s[n(929)]()[n(2048)](/ /g,""),this[n(1261)][n(958)][n(1857)](n(1992),n(923)),i[n(1484)](this[n(1261)]),i[n(2062)](n(2096),(t=>{const e=n,i=t[e(1996)];(i.tagName!==e(1038)||!(e(544)in i)||"text"!==i.type&&"number"!==i[e(544)])&&i.tagName!==e(1880)&&t[e(2075)]()})),this.register({dispose:()=>{const t=n;i[t(1132)](this[t(1261)])}})}get isVisible(){return this[t(862)]}set[t(836)](e){const i=t;this[i(862)]=e,this[i(1261)].style[i(627)]=this[i(862)]?"":i(2038)}}var ks=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect[o(1552)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h},Us=function(t,e){return function(i,s){e(i,s,t)}};class Ps extends Bs{constructor(e,i,s,n){const o=t;super(0===e?o(1225):"bottomStatusBar",i,0===e?"Top Status Bar":"Bottom Status Bar"),this._target=e,this._statusBarService=s,this[o(1359)]=n,this[o(1291)]=new Map,this[o(1261)][o(958)][o(1857)](o(842)),this[o(1719)]=document.createElement(o(924)),this._leftItemsElement[o(958)][o(1857)](o(1816)),this[o(894)]=document.createElement(o(924)),this[o(894)][o(958)][o(1857)](o(1056)),(0===this[o(1669)]?this[o(955)][o(755)]:this[o(955)].onDidAddBottomItem)((t=>this[o(666)](t))),(0===this[o(1669)]?this._statusBarService[o(1155)]:this[o(955)].onDidRemoveBottomItem)((t=>this[o(1581)](t))),this._contentElement[o(1969)](this[o(1719)],this._rightItemsElement),this[o(1502)]({dispose:()=>{const t=o;for(const e of this[t(1291)][t(1673)]())for(const t of e)t.dispose()}})}[t(666)](e){const i=t,s=[],n=0===e[i(2238)]?this[i(1719)]:this[i(894)],o=document.createElement(i(1548));if(o[i(958)][i(1857)]("item"),e.className&&o[i(958)][i(1857)](e.className),e.hasImage&&o[i(958)][i(1857)](i(1882),i(1691)),e[i(1608)]&&(o.title=e[i(1608)]),o[i(2062)](i(1517),(()=>{const t=i;e.commandId&&this[t(1359)][t(2079)](e[t(1153)])})),e[i(1211)]){const t="status-bar-item-"+Math[i(2337)](1e6*Math.random());switch(e[i(1211)][i(544)]){case i(2007):{const s=e.input;if(!e[i(1336)]){const s=document[i(808)]("label");s[i(590)]=e[i(1386)]+": ",s[i(2178)]("for",t),o[i(1969)](s)}o.addEventListener(i(1517),(()=>s.setOption(!o[i(958)].contains("checked")))),s[i(1790)]((t=>o[i(958)][i(1259)](i(988),t)));break}case i(2008):{const s=e[i(1211)],n=document[i(808)]("label");n[i(590)]=e[i(1386)]+": ",n[i(2178)](i(773),t);const r=document[i(808)]("select");r.id=t;for(const t of s.options){const e=document.createElement(i(2172));e[i(877)]=t,e[i(590)]=t,r[i(1484)](e)}r.value=s[i(1614)],r[i(2062)](i(1541),(t=>{const e=i;s[e(687)](r[e(877)])})),s[i(1790)]((t=>r.value=t)),o.append(n,r);break}case"string-combo":{const s=e.input,n=document.createElement(i(1446));n[i(590)]=e[i(1386)]+": ",n[i(2178)](i(773),t);const r=document[i(808)]("input");r[i(544)]=i(1386),r.id=t;const a=document[i(808)](i(1535));for(const t of s[i(563)]){const e=document[i(808)](i(2172));e.value=t,a[i(1484)](e)}a.id=i(1252)+t,r[i(2178)](i(1910),i(1252)+t),r.value=s[i(1614)],r[i(2062)](i(1541),(t=>{s[i(687)](r.value)})),s[i(1790)]((t=>r[i(877)]=t)),o[i(1969)](n,r,a);break}case i(711):{const s=e.input,n=document[i(808)](i(1446));n.textContent=e[i(1386)]+": ",n[i(2178)]("for",t);const r=document[i(808)]("input");r.id=t,r[i(544)]=i(711),s.min&&(r[i(2338)]=s[i(2338)].toString()),s[i(1445)]&&(r.max=s[i(1445)][i(993)]()),r[i(877)]=s[i(1614)][i(993)](),r.addEventListener(i(1211),(t=>{s[i(687)](parseFloat(r.value))})),r.addEventListener(i(1541),(t=>{const e=i;s[e(687)](parseFloat(r[e(877)]))})),s.onHistoryUpdateValue((t=>r.value=t[i(993)]())),o.append(n,r);break}}}e[i(822)]&&s[i(585)](e[i(822)]((()=>this[i(1193)](e,o)))),this[i(1193)](e,o),n[i(1484)](o),s[i(585)]({dispose:()=>n[i(1132)](o)}),this[i(1291)].set(e,s)}[t(1581)](e){const i=t,s=this[i(1291)].get(e);if(s){for(const t of s)t[i(1800)]();this[i(1291)][i(1156)](e)}}[t(1193)](e,i){const s=t;e.input&&!e[s(1336)]?i[s(572)](s(1446))[s(590)]=e.text+": ":(i[s(590)]=e[s(1386)],i[s(958)][s(1259)]("no-text",0===e[s(1386)]?.length)),e[s(1608)]&&(i[s(1608)]=e[s(1608)]),i[s(1033)][s(627)]=!1===e[s(2168)]?"none":"",i.classList[s(1259)](s(2215),!!e[s(1153)]&&!1!==e[s(1954)]),i.classList[s(1259)](s(988),!!e[s(988)]),void 0!==e.enabled&&i[s(958)][s(1259)](s(691),!e.enabled)}}let Fs=class extends Ps{constructor(t,e,i){super(0,t,e,i)}};Fs=ks([Us(1,ni),Us(2,He)],Fs);let Ns=class extends Ps{constructor(t,e,i){super(1,t,e,i)}};Ns=ks([Us(1,ni),Us(2,He)],Ns),di.register(t(1225),{anchor:t(800),ctor:Fs}),di[t(1502)](t(2299),{anchor:t(2364),ctor:Ns}),ji({id:"window.toggleTopStatusBarView",label:t(1984),section:t(1200),run:e=>e[t(876)](hi)[t(1774)](t(1225))}),ji({id:"window.toggleBottomStatusBarView",label:t(2050),section:t(1200),run:e=>e[t(876)](hi)[t(1774)](t(2299))});class Os extends e.JT{constructor(e,i){const n=t;super(),this[n(543)]=e,this[n(1685)]=i,this[n(1996)]=0,this.alignment=0,this[n(1336)]=!0,this[n(1386)]="",this[n(2290)]=this[n(1502)](new s.v),this[n(822)]=this[n(2290)][n(1362)],this[n(543)][n(822)]&&this[n(1502)](this[n(543)][n(822)]((()=>this[n(1936)]()))),this._update()}_update(){const e=t;switch(this[e(543)].type){case e(802):this[e(1153)]=e(1135);break;case e(697):this[e(1153)]=e(1766);break;default:throw new Error(e(1879)+this[e(543)][e(544)]+'"')}this[e(1608)]=this[e(543)][e(1424)],this[e(1954)]=this[e(543)][e(1954)],this[e(2290)][e(1457)]()}}class Vs{constructor(){this[t(1145)]=[]}[t(2219)](e){const i=t,s=e.get(si),n=e[i(876)](ni);s.tool[i(2053)]((()=>this[i(1936)](s,n)))}[t(1936)](e,i){const s=t;for(const t of this[s(1145)])t[s(1800)]();this[s(1145)][s(1807)]=0;const n=e[s(1294)].actions;for(const t of n)this[s(1145)][s(585)](i[s(1864)](new Os(t,e[s(1294)].activeTool+"-"+t[s(544)])))}}class Hs extends e.JT{constructor(e,i){const n=t;super(),this[n(1703)]=e,this[n(1685)]=i,this[n(1996)]=1,this[n(2238)]=0,this[n(1336)]=!0,this[n(2168)]=!1,this[n(2290)]=this[n(1502)](new s.v),this[n(822)]=this[n(2290)][n(1362)],this.register(this[n(1703)][n(822)]((()=>this._update()))),this[n(1936)]()}_update(){const e=t;this._info.visible?(this[e(1386)]=this[e(1703)].getInfo(),this.title=this[e(1703)][e(1071)](),this[e(2168)]=!0,this[e(2290)][e(1457)]()):this[e(2168)]&&(this[e(1386)]="",this[e(2168)]=!1,this[e(2290)][e(1457)]())}}class zs{constructor(){this[t(1145)]=[]}start(e){const i=t,s=e[i(876)](si),n=e.get(ni);s[i(1294)][i(2053)]((()=>this[i(1936)](s,n)))}[t(1936)](e,i){const s=t;for(const t of this[s(1145)])t[s(1800)]();switch(this[s(1145)][s(1807)]=0,e[s(1294)][s(2181)]){case s(1898):case s(2327):case"shape":case s(1386):for(const t of e[s(1294)][s(1313)])(t.type===s(1230)||t.type===s(753)||t[s(544)]===s(1807)||"angle"===t[s(544)])&&this._activeItems.push(i.createItem(new Hs(t,e[s(1294)][s(2181)]+"-"+t[s(544)])))}}}class js{constructor(){this._activeItems=[]}start(e){const i=t,s=e.get(si),n=e.get(ni);s[i(1294)][i(2053)]((()=>this[i(1936)](s,n)))}[t(1936)](e,i){const s=t;for(const t of this[s(1145)])t[s(1800)]();this[s(1145)][s(1807)]=0;const n=e[s(1294)].options;for(const t of n)switch(t.type){case s(2007):const n=new Ws(e,t);this[s(1145)].push(i.createItem(n));break;case s(2008):const o=t;this[s(1584)](e[s(1294)][s(2181)],i,{text:t[s(1424)]},{type:"string",currentValue:o[s(877)],options:o[s(563)],setOption:e=>t[s(877)]=e,onHistoryUpdateValue:t[s(1790)]});break;case s(1232):const r=t;this._addOption(e[s(1294)][s(2181)],i,{text:t[s(1424)]},{type:"string-combo",currentValue:r[s(877)],options:r[s(563)],setOption:e=>t[s(877)]=e,onHistoryUpdateValue:t.onHistoryUpdateValue});break;case s(711):const a=t;this[s(1584)](e[s(1294)][s(2181)],i,{text:t[s(1424)]},{type:s(711),currentValue:a.value,min:a.min,max:a[s(1445)],setOption:e=>t[s(877)]=e,onHistoryUpdateValue:t.onHistoryUpdateValue});break;default:throw new Error('Unexpected option type "'+t.type+'"')}}[t(1584)](e,i,s,n){const o=t,r={target:0,alignment:0,dispose:()=>{},text:s[o(1336)]?"":s.text,title:s.hasImage?s.text:void 0,className:e+"-"+s[o(1386)][o(929)]()[o(2048)](/ /g,"-"),hasImage:s[o(1336)],input:n};this[o(1145)].push(i[o(1864)](r))}}class Ws extends e.JT{constructor(e,i){const n=t;super(),this[n(1763)]=i,this[n(1996)]=0,this[n(2238)]=0,this[n(1336)]=!0,this.text="",this._onUpdate=this.register(new s.v),this.onUpdate=this[n(2290)].event,this[n(1608)]=i[n(1424)],this[n(1685)]=e[n(1294)][n(2181)]+"-"+i.name[n(929)]()[n(2048)](/ /g,"-"),this.input={type:n(2007),currentValue:i[n(877)],setOption:t=>{const e=n;this[e(988)]=t,this[e(2033)]()},onHistoryUpdateValue:i.onHistoryUpdateValue},this[n(988)]=i[n(877)]}[t(2033)](){const e=t;this[e(988)]||this[e(1763)][e(654)]?(this[e(1763)][e(877)]=this[e(988)],this[e(2290)][e(1457)]()):this._option[e(877)]=!0}}var qs=function(t,e){return function(i,s){e(i,s,t)}};const Gs=new Map([[t(759),"S"],[t(1511),"C"],[t(1035),"M"],[t(967),"P"],[t(2148),"M"],["eraser","E"],[t(2353),"K"],[t(1348),"F"],["line","O"],[t(2327),"O"],[t(2169),"O"],[t(1386),"T"],["hand","H"],[t(735),"Z"]]),Xs=[t(759),"movePixels",t(1511),"moveSelection",t(2315),"pencil",t(1695),t(2353),t(1348),t(2315),t(1898),t(2327),t(2169),t(1386),t(2315),"hand","zoom"];let Ys=class extends Wi{constructor(e,i,s){const n=t;super(n(2370),e,n(1607)),this[n(866)]=i,this[n(1233)]=s,this[n(1654)]=new Map,this._windowVisibleContextKey=this[n(1233)][n(732)](1,!0),this[n(1502)](this[n(2208)]((t=>this[n(809)][n(917)](t))));const o=n(967),r=document.createDocumentFragment();for(const[t,e]of Xs[n(605)]()){if(e===n(2315)){const t=document.createElement("hr");t.classList[n(1857)](n(1028)),r[n(1484)](t);continue}const i=document[n(808)](n(924));i.classList[n(1857)]("tool-container");const s=document.createElement(n(1211));s[n(1424)]=n(1294),s[n(544)]=n(880),s[n(958)][n(1857)](n(1294),e,n(1028));const a=Js(e),h=Gs[n(876)](e);h?s[n(1608)]=a+" ("+h+")":s.title=""+a,s.setAttribute(n(1962),a),this[n(1654)].set(e,s),s[n(988)]=e===o,s.addEventListener(n(1541),(()=>this[n(866)].tool[n(1645)](e))),s.addEventListener("keydown",(s=>{const o=n;switch(s[o(1351)]){case"ArrowUp":i[o(2329)]?.[o(2329)]?.[o(2282)]?.[o(1603)](),s.preventDefault(),s[o(1529)]();break;case"ArrowDown":const n=i[o(1218)]?.nextSibling?.[o(2282)];n?n[o(1603)]():i[o(1218)]?.[o(2282)]?.[o(1603)](),s[o(2075)](),s[o(1529)]();break;case"ArrowLeft":t%2==1&&i[o(2329)]?.firstChild?.[o(1603)](),s.preventDefault(),s.stopImmediatePropagation();break;case o(1173):if(t%2==0){const t=i[o(1218)]?.[o(2282)];t?t[o(1603)]():i[o(2329)]?.[o(2282)]?.[o(1603)]()}s[o(2075)](),s.stopImmediatePropagation();break;case o(989):this[o(866)].tool[o(1645)](e)}})),i.appendChild(s),r[n(1484)](i)}this[n(1261)][n(1484)](r),this[n(1502)](this[n(866)][n(1294)][n(2053)]((t=>{const e=n;this[e(1654)].get(t.id)[e(988)]=!0;for(const[i,s]of this[e(1654)][e(605)]())s.parentElement?.classList[e(1259)](e(988),i===t.id)}))),this[n(866)][n(1294)][n(1645)](o)}};function Js(e){const i=t;return((e[i(2136)](0,1).toUpperCase()+e[i(2136)](1)).match(/[A-Z][a-z]+/g)||[])[i(1305)](" ")}function Ks(e,i,s){const n=t,o=e.get(si);o[n(1294)][n(1645)](i,s),o.viewport.focus()}Ys=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(1804)&&typeof Reflect[o(1552)]===o(1626))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([qs(1,si),qs(2,ze)],Ys),mi[t(1502)](t(2370),{ctor:Ys,defaultVisible:!0,defaultPosition:{x:"start",y:t(2219)}}),Ei.register(new js),Ei[t(1502)](new Vs),Ei[t(1502)](new zs),ji({id:t(1856),label:t(1444),section:"Window",checked:1,run:e=>e[t(876)](hi)[t(1774)](t(2370))}),ji({id:t(770),label:t(2022),section:t(1723),run:e=>Ks(e,t(2353)),keys:"k"}),ji({id:"tool.crop",label:t(1115),section:"Tool",run:e=>Ks(e,t(1511)),keys:"c"}),ji({id:t(1240),label:t(2199),section:t(1723),run:e=>Ks(e,t(1695)),keys:"e"}),ji({id:t(1462),label:t(2345),section:t(1723),run:e=>Ks(e,t(1348)),keys:"f"}),ji({id:t(2106),label:t(1049),section:t(1723),run:e=>Ks(e,t(2388)),keys:"h"}),ji({id:"tool.handUntilRelease",label:t(849),section:t(1723),run:e=>Ks(e,t(2388),{untilRelease:" "}),keys:t(2117)}),ji({id:t(646),label:"Line",section:"Tool",run:e=>Ks(e,t(1898))}),ji({id:t(2086),label:"Toggle Shape Tool",section:t(1723),run:e=>{const i=t,s=e[i(876)](si)[i(1294)];"line"===s[i(2181)]?Ks(e,i(2327)):"rectangle"===s[i(2181)]?Ks(e,"shape"):Ks(e,i(1898))},keys:"o"}),ji({id:t(2131),label:t(1733),section:t(1723),run:e=>Ks(e,t(1035))}),ji({id:"tool.moveSelection",label:t(1762),section:t(1723),run:e=>Ks(e,t(2148))}),ji({id:t(639),label:t(1794),section:"Tool",run:e=>{const i=t;e[i(876)](si)[i(1294)][i(2181)]===i(1035)?Ks(e,"moveSelection"):Ks(e,i(1035))},keys:"m"}),ji({id:t(1231),label:"Pencil",section:"Tool",run:e=>Ks(e,t(967)),keys:"p"}),ji({id:"tool.rectangle",label:t(1460),section:t(1723),run:e=>Ks(e,t(2327)),keys:"o"}),ji({id:"tool.shape",label:t(1178),section:t(1723),run:t=>Ks(t,"shape"),keys:"o"}),ji({id:t(1488),label:t(937),section:t(1723),run:e=>Ks(e,t(759)),keys:"s"}),ji({id:t(530),label:"Text",section:t(1723),run:e=>Ks(e,t(1386)),keys:"t"}),ji({id:t(533),label:t(2342),section:t(1723),run:e=>Ks(e,t(735)),keys:"z"}),ji({id:"view.focusCanvas",label:t(609),section:t(1858),run:e=>e.get(si)[t(1116)].focus()}),ji({id:t(991),label:t(1436),section:t(1858),run:e=>e.get(si)[t(1116)][t(1663)]()}),ji({id:t(1563),label:"Zoom Out",section:t(1858),run:e=>e[t(876)](si)[t(1116)][t(1260)]()}),ji({id:t(1609),label:t(535),section:t(1858),run:e=>e.get(si)[t(1116)][t(735)]=1,keys:t(1520)}),ji({id:t(2032),label:"Fit to Window",section:"View",run:e=>e.get(si)[t(1116)][t(2120)](),keys:"ctrl+0"}),ji({id:t(1495),label:"Fit Layer to Window",section:t(1858),run:e=>e[t(876)](si)[t(1116)].fitLayerToWindow()}),ji({id:t(1040),label:t(2162),section:t(1858),run:e=>{const i=t,s=e[i(876)](si)[i(1116)];s[i(986)]=!s[i(986)]}});let $s=class extends e.JT{constructor(e){const i=t;super(),this[i(1957)]=e,this[i(1996)]=0,this[i(2238)]=1,this[i(1685)]=i(1872),this[i(1336)]=!0,this.text="",this[i(1608)]=i(2270),this[i(1153)]="view.togglePixelGrid",this[i(2290)]=this[i(1502)](new s.v),this.onUpdate=this[i(2290)][i(1362)],this[i(1957)].viewport[i(668)]((()=>this[i(1936)]())),this._update()}_update(){const e=t;this.checked=this[e(1957)][e(1116)].isPixelGridEnabled,this[e(2290)][e(1457)]()}};var Zs,Qs;$s=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if("object"==typeof Reflect&&typeof Reflect[o(1552)]===o(1626))h=Reflect[o(1552)](e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([(Zs=0,Qs=si,function(t,e){Qs(t,e,Zs)})],$s);let tn=class extends e.JT{constructor(e){const i=t;super(),this[i(1957)]=e,this[i(1996)]=1,this.alignment=1,this.className=i(735),this.hasImage=!0,this._onUpdate=this[i(1502)](new s.v),this[i(822)]=this[i(2290)][i(1362)],this[i(1957)].viewport.onZoomChange((()=>this[i(1936)]())),this[i(1936)]()}[t(1936)](){const e=t,i=(100*this._lunaService[e(1116)][e(735)])[e(1701)](0);this[e(1386)]=i+"%",this[e(1608)]=e(2243)+i+"%",this[e(2290)][e(1457)]()}};var en,sn;tn=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object[o(728)](i,s):n;if(typeof Reflect===o(1804)&&typeof Reflect[o(1552)]===o(1626))h=Reflect[o(1552)](e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([(en=0,sn=si,function(t,e){sn(t,e,en)})],tn),Ei.register({start(e){const i=t,s=e.get(ni),n=e.get(je);s.createItem(n[i(1100)](tn)),s[i(1864)](n[i(1100)]($s))}});var nn=function(t,e){return function(i,s){e(i,s,t)}};let on=class extends Wi{constructor(i,s,n,o,r){const a=t;super(a(634),i,a(1657)),this._luna=s,this[a(1233)]=n,this._commandService=o,this._minimapService=r,this[a(1333)]=0,this[a(809)]=this._contextKeyService.bind(5,!0),this[a(1502)](this.onDidChangeVisibility((t=>this[a(809)][a(917)](t))));const h=this._createToggle(a(2067),"minimap.toggleStretch",this[a(2092)][a(1500)],"Toggle small images between actual size and stretching to fit the minimap dimensions");this[a(2092)].onStretchEnabledChange((t=>{const e=a;h[e(988)]=t,this[e(771)](),this[e(746)]()}));const c=this._createToggle(a(1492),a(688),this._minimapService.showViewport,a(984));this._minimapService[a(2171)]((t=>{const e=a;c.checked=t,this[e(746)]()})),this[a(1604)][a(1969)](h,c),this[a(966)]=document[a(808)](a(589)),this[a(966)][a(2164)]=200,this[a(966)][a(918)]=200,this[a(966)][a(1033)].width="200px",this[a(966)][a(1033)][a(918)]="200px",this[a(1502)]((0,e.Lw)(this[a(966)],a(739),(t=>{const e=a;if(!this[e(1111)](t)){const i=this._createMinimapImageBounds();this[e(866)][e(1116)].x=-((t[e(1263)]-i[e(2061)])/i[e(2164)]*this[e(866)][e(2386)][e(2164)]-this[e(866)].layer[e(2164)]/2),this[e(866)][e(1116)].y=-((t[e(1473)]-i[e(800)])/i[e(918)]*this[e(866)][e(2386)][e(918)]-this._luna[e(2386)].height/2)}this[e(966)].setPointerCapture(t[e(828)]),this._canvas.classList[e(1857)]("grabbed"),this[e(745)]=[t[e(1263)],t[e(1473)]],this[e(534)]=[this._luna.viewport.x,this._luna[e(1116)].y]}))),this[a(1502)]((0,e.Lw)(this._canvas,"pointerup",(t=>{const e=a;this._canvas[e(2129)](t[e(828)]),this[e(966)].classList[e(856)](e(2200)),this._clickOrigin=void 0,this[e(534)]=void 0}))),this[a(1502)]((0,e.Lw)(this[a(966)],a(2220),(t=>{const e=a,i=this._luna[e(1116)].visibleRange,s=0===i[e(2061)]&&0===i[e(800)]&&i.right===this[e(866)][e(2386)].width&&i[e(2364)]===this[e(866)][e(2386)][e(918)];if(this._canvas[e(958)][e(1259)](e(835),!s&&this[e(1111)](t)),!this[e(745)]||!this[e(534)])return;const n=this[e(1296)]();this[e(866)][e(1116)].x=this._viewportOrigin[0]+(this[e(745)][0]-n[e(2061)]-(t[e(1263)]-n[e(2061)]))*(this[e(866)][e(2386)][e(2164)]/n[e(2164)]),this[e(866)][e(1116)].y=this._viewportOrigin[1]+(this[e(745)][1]-n.top-(t.offsetY-n[e(800)]))*(this[e(866)].layer[e(918)]/n[e(918)])}))),this[a(1502)]((0,e.Lw)(this[a(966)],a(1403),(t=>{this[a(966)].classList.remove("in-viewport")}))),this[a(1502)]((0,e.Lw)(this[a(966)],a(951),(t=>{const e=a;ye.V5?t[e(1243)]<0?this[e(866)].viewport[e(1663)](-t[e(1243)]/20):this[e(866)].viewport[e(1260)](t[e(1243)]/20):t[e(1243)]<0?this[e(866)][e(1116)][e(1663)]():this[e(866)][e(1116)][e(1260)]()}))),this._ctx=this._canvas.getContext("2d"),this[a(940)]=document[a(808)](a(924)),this._viewportElement.classList[a(1857)](a(807)),this[a(1261)][a(1969)](this[a(966)],this[a(940)]),this.register(this._luna[a(1280)][a(1923)]((()=>this._queueUpdate()))),this.register(this[a(866)][a(2386)].onLayerVisibilityChange((()=>this[a(771)]()))),this[a(1502)](this[a(866)][a(1116)][a(822)]((()=>this[a(746)]()))),this[a(1936)](),this._viewportUpdate()}_queueUpdate(){const e=t;this[e(866)].layer[e(2164)]&&0===this[e(1333)]&&(this[e(1333)]=setTimeout((()=>{const t=e;this[t(1936)](),this[t(1333)]=0})))}async[t(1936)](){const e=t,i=await this[e(866)].file[e(2010)]();if(!i[e(2164)]||!i[e(918)])return void this[e(966)][e(958)][e(1857)]("hidden");this._canvas[e(958)][e(856)](e(1074));const s=new ImageData(new Uint8ClampedArray(i[e(1253)]),i[e(2164)],i[e(918)]),n=await createImageBitmap(s);this._ctx[e(1344)]=i.width>200||i[e(918)]>200,this[e(962)][e(1309)](0,0,200,200);const o=this[e(1296)]();this[e(962)][e(588)](n,o[e(2061)],o[e(800)],o[e(2164)],o[e(918)])}[t(746)](){const e=t;if(!this._luna.layer[e(2164)])return;const s=this._luna.layer,n=this[e(1296)](),o=this[e(866)].viewport[e(1499)],r=0===o[e(2061)]&&0===o[e(800)]&&o[e(511)]===s[e(2164)]&&o[e(2364)]===s.height;this._viewportElement.classList[e(1259)](e(1074),r||!this[e(2092)][e(526)]),this[e(659)]={left:n.left+Math[e(2337)](o[e(2061)]/s[e(2164)]*n[e(2164)]),top:n.top+Math[e(2337)](o[e(800)]/s[e(918)]*n[e(918)]),width:Math[e(2337)]((0,i.Oq)(o)/s[e(2164)]*n[e(2164)]),height:Math[e(2337)]((0,i.rY)(o)/s[e(918)]*n[e(918)])},this[e(940)][e(1033)].left=this[e(659)][e(2061)]+"px",this._viewportElement[e(1033)].top=this._viewportPosition[e(800)]+"px",this[e(940)][e(1033)].width=this[e(659)][e(2164)]+"px",this._viewportElement.style.height=this._viewportPosition.height+"px"}_eventInViewport(e){const i=t;return!!this[i(659)]&&e[i(1263)]>this._viewportPosition.left&&e[i(1263)]<this[i(659)].left+this[i(659)][i(2164)]&&e[i(1473)]>this._viewportPosition.top&&e.offsetY<this[i(659)][i(800)]+this[i(659)].height}_createToggle(e,i,s,n){const o=t,r=document[o(808)]("input");return r[o(544)]="checkbox",r.id=e,r.checked=s,r[o(1608)]=n,r[o(958)][o(1857)](e,o(1028)),r[o(2062)](o(1517),(()=>this._commandService[o(2079)](i))),r}_createMinimapImageBounds(){const e=t;return(0,se.M_)(this[e(866)][e(2386)][e(2164)],this._luna[e(2386)][e(918)],200,200,this._minimapService[e(1500)])}};on=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object[o(728)](i,s):n;if("object"==typeof Reflect&&typeof Reflect[o(1552)]===o(1626))h=Reflect[o(1552)](e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([nn(1,si),nn(2,ze),nn(3,He),nn(4,yi)],on);let rn=class extends e.JT{constructor(e){const i=t;super(),this[i(1184)]=e,this[i(1996)]=0,this.alignment=1,this[i(1685)]=i(978),this[i(1336)]=!0,this[i(1386)]="",this[i(1608)]="Toggle the minimap",this[i(1153)]=i(910),this._onUpdate=this[i(1502)](new s.v),this[i(822)]=this[i(2290)][i(1362)],this[i(1184)][i(709)]((()=>this._update())),this[i(1936)]()}[t(1936)](){const e=t;this.checked=this._viewService[e(836)](e(634)),this[e(2290)][e(1457)]()}};var an,hn;rn=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object[o(728)](i,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect[o(1552)](e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([(an=0,hn=hi,function(t,e){hn(t,e,an)})],rn),mi[t(1502)](t(634),{ctor:on,defaultVisible:!1,defaultPosition:{x:t(554),y:t(554)}}),Ei[t(1502)]({start(e){const i=t,s=e[i(876)](ni),n=e.get(je);s[i(1864)](n[i(1100)](rn))}}),ji({id:t(910),label:t(2054),section:t(1200),checked:5,run:e=>e[t(876)](hi)[t(1774)](t(634))}),ji({id:"minimap.toggleShowViewport",label:t(1930),section:t(1657),run:e=>{const i=t,s=e.get(yi);s[i(526)]=!s[i(526)]}}),ji({id:t(514),label:t(2039),section:t(1657),run:e=>{const i=t,s=e.get(yi);s[i(1500)]=!s[i(1500)]}});var cn=function(t,e){return function(i,s){e(i,s,t)}};let ln=class extends Wi{constructor(i,s,n,o,r){const a=t;super(a(794),i,a(757)),this[a(866)]=s,this._contextKeyService=n,this._contextMenuService=o,this[a(2108)]=r,this[a(1281)]=new Map,this[a(954)]=new Map,this._windowVisibleContextKey=this[a(1233)][a(732)](3,!0),this[a(1502)](this[a(2208)]((t=>this[a(809)][a(917)](t)))),this._layerListElement=document[a(808)](a(924)),this[a(500)][a(958)].add("layer-list");const h=document[a(808)]("div");h[a(958)].add(a(1311)),h[a(1969)](this[a(1533)](a(2382),(()=>this[a(866)][a(2386)][a(810)]()),a(1340)),this[a(1533)]("layer-delete",(()=>this[a(866)][a(2386)][a(1888)]()),"Delete the active layer"),this._createButton(a(2179),(()=>this[a(866)][a(2386)][a(1728)]()),"Duplicate the active layer"),this[a(517)]=this[a(1533)](a(895),(()=>this[a(866)].layer.mergeLayerDown()),a(1909)),this[a(612)]=this._createButton("layer-move-up",(()=>this._luna[a(2386)][a(1544)]()),a(1640)),this[a(879)]=this[a(1533)](a(2173),(()=>this[a(866)][a(2386)].moveLayerDown()),a(931)),this[a(2193)]()),this[a(1261)][a(1969)](this[a(500)],h),this[a(1502)](this[a(866)][a(2386)][a(1247)]((()=>this._renderLayers()))),this.register({dispose:()=>{const t=a;for(const i of this._layerListItems[t(1673)]())(0,e._c)(i.disposables)}}),this[a(1578)]()}[t(1533)](e,i,s){const n=t,o=document.createElement("button");o.id=e,o[n(1608)]=s;const r=document.createElement("img");return o[n(1484)](r),o[n(958)][n(1857)](e,n(1028)),o.addEventListener(n(1517),i),o}[t(2193)](){const e=t,i=document[e(808)](e(546)),s=["normal",e(1979),e(2065),e(2064),"lighten","screen",e(2321),e(1196),"softLight",e(947),e(2087)];for(const t of s){const s=document[e(808)](e(2172));s[e(590)]=t,s[e(877)]=t,this._blendModeOptions.set(t,s),i[e(1484)](s)}return i.addEventListener("change",(()=>{const t=e;this[t(866)].layer[t(1375)]&&(this[t(866)][t(2386)][t(1375)][t(1636)]=i[t(877)])})),i}[t(1578)](){const i=t,s=this._luna[i(2386)].layers,n=this[i(866)][i(2386)][i(1375)];let o=null;for(let t=s.length-1;t>=0;t--){const r=s[t];if(!this._layerListItems[i(2387)](r.id)){const t={container:document[i(808)](i(924)),nameSpan:document.createElement(i(1548)),previewCanvas:document.createElement("canvas"),visibleCheckbox:document[i(808)]("input"),disposables:[]};t[i(1154)][i(958)].add(i(2386)),t.container[i(615)]=0,t[i(1154)][i(1904)]=!0,t[i(1496)][i(585)]((0,e.Lw)(t[i(1154)],i(1217),(t=>{const e=i;this[e(1261)][e(958)][e(1857)](e(703)),t.dataTransfer&&(t.dataTransfer[e(2144)]=e(2165),t[e(1288)][e(968)]="move",t.dataTransfer[e(1631)](e(1688),e(1666)+r.id)),t.stopImmediatePropagation()}))),t[i(1496)].push((0,e.Lw)(t.container,i(2352),(()=>{const t=i;this[t(1261)][t(958)][t(856)](t(703))}))),t[i(1496)][i(585)]((0,e.Lw)(t[i(1154)],i(2340),(e=>{const s=i;t[s(1154)][s(958)].remove("drop-target");const n=this[s(823)](e),o=this[s(866)][s(2386)][s(794)][s(1707)]((t=>t.id===n));o&&this[s(866)][s(2386)][s(1867)](o,r),e[s(1529)]()}))),t[i(1496)].push((0,e.Lw)(t[i(1154)],i(1937),(e=>{const s=i,n=this[s(823)](e);r.id!==n&&(e[s(2075)](),t[s(1154)][s(958)].add(s(1212)))}))),t.disposables[i(585)]((0,e.Lw)(t[i(1154)],"dragleave",(e=>{const s=i;t.container[s(958)][s(856)](s(1212))}))),t[i(1323)].classList[i(1857)](i(618)),t[i(1323)][i(2164)]=40,t[i(1323)][i(918)]=40;let s=!1;t[i(1496)].push(r[i(822)]((()=>{s=!0,this[i(1318)](t,r)}))),t.disposables[i(585)](this._luna[i(1280)][i(1923)]((()=>{s&&(this[i(885)](r,t),s=!1)}))),this[i(885)](r,t),t[i(1154)].appendChild(t[i(1323)]),t[i(812)].classList[i(1857)](i(1424)),t[i(1154)][i(1484)](t.nameSpan),t.visibleCheckbox[i(544)]=i(1399),t[i(1020)][i(958)][i(1857)]("visible"),t[i(1020)][i(2062)](i(1541),(()=>r.isVisible=!r[i(836)])),t[i(1154)][i(1484)](t.visibleCheckbox);const n=e=>{const s=i;e?.[s(1996)]!==t[s(1020)]&&(this._luna.layer[s(1375)]=r)};t[i(1154)].addEventListener("click",(t=>{const e=i;n(t),t[e(1538)]&&this._luna[e(1116)][e(1771)]()})),t.container[i(2062)]("contextmenu",(async t=>{const e=i;switch(t[e(2075)](),t[e(1529)](),await this[e(1175)].show([{id:e(727),label:e(1075)},{id:"delete",label:e(1162)},{id:e(2269),label:e(820)},{id:"mergeDown",label:e(1780)},{id:e(1771),label:e(979)+(ye.V5?"⌥":e(1945))+"+click]"}])){case e(727):await this[e(866)][e(2386)].duplicateLayer(r);break;case"delete":this[e(866)][e(2386)][e(1888)](r);break;case"rename":const t=await this[e(2108)].requestInput(e(2317),r[e(1424)]);t&&this[e(866)].layer.renameLayer(t,r);break;case e(730):this[e(866)][e(2386)].activeLayer=r,await this[e(866)].layer[e(2359)]();break;case e(1771):this[e(866)][e(1116)][e(1771)]()}})),t[i(1154)].addEventListener(i(1426),(e=>{const s=i;switch(e.key){case s(1835):t.container[s(2329)]?.[s(1603)](),e.preventDefault();break;case s(1852):t[s(1154)].nextSibling?.[s(1603)](),e.preventDefault();break;case s(989):case s(1505):n()}})),this[i(1281)].set(r.id,t),t[i(1496)].push(r[i(1198)]((()=>{const e=i;this[e(500)][e(1132)](t[e(1154)]);for(const i of t.disposables)i[e(1800)]();this[e(1281)][e(1156)](r.id)})))}const a=this._layerListItems[i(876)](r.id),h=r.id===n?.id;if(a[i(1154)][i(958)].toggle("active",h),this[i(1318)](a,r),h){const e=t>0?s[t-1]:void 0,n=t<s[i(1807)]-1?s[t+1]:void 0;e?(this._mergeLayerDownButton[i(1341)](i(691),!1),this[i(517)].title=""):(this[i(517)].toggleAttribute(i(691),!0),this[i(517)].title=i(2322)),this[i(612)][i(1341)](i(691),!n),this[i(612)][i(1608)]=n?"":i(1531),this[i(879)][i(1341)](i(691),!e),this[i(879)][i(1608)]=n?"":i(2380)}null===o?(!a[i(1154)][i(1655)]||null!==a[i(1154)][i(2329)])&&(this[i(500)][i(2282)]?this._layerListElement[i(1190)](a.container,this[i(500)][i(2282)]):this[i(500)][i(1484)](a[i(1154)])):a.container[i(2329)]!==o&&o[i(564)]("afterend",a[i(1154)]),o=a[i(1154)]}if(n){const t=this[i(954)][i(876)](n[i(1636)]);t&&(t.selected=!0)}}_updateLayer(e,i){const s=t;e[s(812)].textContent=i.name,e[s(1020)].checked=i.isVisible;const n=this[s(866)].layer[s(1375)];if(i.id===n?.id){const t=this[s(954)].get(n[s(1636)]);t&&(t[s(2190)]=!0)}}[t(823)](e){const i=t,s=e[i(1288)][i(1400)]("text/plain");if(s?.[i(738)](i(1666)))return parseInt(s[i(2136)](13))}[t(885)](e,i){const s=t;e[s(665)](40,40)[s(653)]((t=>{const e=s,n=i.previewCanvas[e(573)]("2d");n[e(1344)]=!1,n[e(1309)](0,0,40,40),n.drawImage(t,0,0)}))}};ln=function(e,i,s,n){const o=t;var r,a=arguments[o(1807)],h=a<3?i:null===n?n=Object[o(728)](i,s):n;if(typeof Reflect===o(1804)&&typeof Reflect[o(1552)]===o(1626))h=Reflect[o(1552)](e,i,s,n);else for(var c=e[o(1807)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(1017)](i,s,h),h}([cn(1,si),cn(2,ze),cn(3,Ze),cn(4,ai)],ln),mi[t(1502)]("layers",{ctor:ln,defaultVisible:!0,defaultPosition:{x:"end",y:{side:t(554),target:"minimap"}}}),ji({id:t(2192),label:t(635),section:"Window",checked:3,run:e=>e[t(876)](hi).toggleView(t(794))}),ji({id:t(1840),label:t(2332),section:"Layer",run:e=>e[t(876)](si)[t(2386)].newLayer(),keys:t(1408)}),ji({id:"layer.deleteLayer",label:t(1119),section:t(1120),run:e=>e[t(876)](si)[t(2386)][t(1888)](),keys:"ctrl+shift+delete"}),ji({id:t(548),label:t(2259),section:t(1120),run:e=>e[t(876)](si)[t(2386)].duplicateLayer(),keys:"ctrl+shift+d"}),ji({id:"layer.mergeLayerDown",label:t(681),section:t(1120),run:e=>e[t(876)](si)[t(2386)][t(2359)](),keys:t(2020)}),ji({id:t(1708),label:t(1423),section:t(1120),run:async e=>{const i=t,s=e[i(876)](si),n=e[i(876)](ai),o=await n.requestInput(i(2317),s[i(2386)].activeLayer?.name||"");o&&s[i(2386)][i(2e3)](o)}}),ji({id:"layer.flipHorizontal",label:t(1735),section:t(1120),run:async e=>{const i=t,s=e.get(si);await s.task[i(1797)](i(631),{selection:s[i(759)].range})}}),ji({id:t(1216),label:t(504),section:t(1120),run:async e=>{const i=t,s=e[i(876)](si);await s[i(1022)][i(1797)](i(1271),{selection:s[i(759)][i(1377)]})}}),ji({id:t(1282),label:"Rotate 180",section:"Layer",run:async e=>{const i=t,s=e[i(876)](si);await s.task[i(1797)](i(772),{selection:s[i(759)][i(1377)]})}}),ji({id:t(571),label:"Go to Top Layer",section:t(1120),run:e=>e[t(876)](si)[t(2386)][t(1905)](),keys:t(1556)}),ji({id:"layer.goToBottomLayer",label:t(1108),section:t(1120),run:e=>e[t(876)](si)[t(2386)].goToBottomLayer(),keys:t(655)}),ji({id:"layer.goToLayerAbove",label:t(1046),section:t(1120),run:e=>e[t(876)](si).layer[t(1522)](),keys:t(1079)}),ji({id:t(1245),label:t(1209),section:"Layer",run:e=>e[t(876)](si)[t(2386)][t(566)](),keys:t(912)}),ji({id:"layer.moveLayerToTop",label:t(2035),section:t(1120),run:e=>e[t(876)](si)[t(2386)][t(999)]()}),ji({id:t(1378),label:t(1815),section:t(1120),run:e=>e.get(si)[t(2386)][t(1544)]()}),ji({id:t(1863),label:t(970),section:"Layer",run:e=>e.get(si)[t(2386)][t(1900)]()}),ji({id:"layer.moveLayerToBottom",label:t(1805),section:t(1120),run:e=>e[t(876)](si)[t(2386)].moveLayerToBottom()});class dn extends e.JT{constructor(){const e=t;super(...arguments),this[e(1996)]=0,this.alignment=1,this.className=e(2304),this[e(1336)]=!0,this[e(1386)]="",this[e(1608)]="Report an issue or give feedback",this[e(1153)]=e(1605)}}async function un(e,i,s,n,o=!1){const r=t;try{switch(await s[r(1903)][r(2132)](e,i,o),i){case r(1214):mn(n)}}catch(t){throw r(993)in t&&s[r(1352)][r(1275)](t[r(993)]()),t}}function mn(e){const i=t;e[i(1067)](i(892)),e[i(1036)](i(794)),e[i(1036)]("minimap")}function gn(){const e=t,i=yn(getComputedStyle(document[e(1667)])[e(2381)]("--vscode-foreground"));void 0!==i&&document[e(1222)][e(1033)][e(1010)](e(1885),i);const s=yn(getComputedStyle(document[e(1667)])[e(2381)](e(787)));void 0!==s&&document[e(1222)][e(1033)][e(1010)](e(1490),s);const n=yn(getComputedStyle(document[e(1667)])[e(2381)](e(1994)));void 0!==n&&document[e(1222)][e(1033)][e(1010)](e(953),n)}function fn(e,i){const s=t;e[s(1203)][s(1673)]=i}function pn(e,i,s){const n=t;e.get(10)?.[n(917)](s),_n(i,n(863),s)}function _n(e,i,s){const n=t;return e.request(n(498),{key:i,value:s})}function yn(e){const i=t;let s,n,o,r;if(e[i(738)]("rgba"))[s,n,o,r]=e[i(2136)](5,e[i(899)](")"))[i(1761)](",").map((t=>+t[i(1786)]()));else{if(7!==e.length)return;s=parseInt(e[i(2136)](1,3),16),n=parseInt(e[i(2136)](3,5),16),o=parseInt(e.substring(5,7),16),r=1}return((s+n+o)*r/765)[i(1701)](2)}Ei[t(1502)]({start(e){const i=t,s=e.get(ni),n=e.get(je);s[i(1864)](n[i(1100)](dn))}}),ji({id:t(1605),label:t(689),section:t(2210),run:e=>e[t(876)](Fi).reportIssue()}),Ei.register({start(e){const i=t,s=e[i(876)](si),n=e[i(876)](ze),o=e[i(876)](Ti),r=e[i(876)](ci),a=e[i(876)](hi);let h;window.focus(),o[i(1179)]("luna.executeCommand",(async t=>{const s=i;let n=!0;try{await e[s(876)](He)[s(2079)](t)}catch(e){console[s(1388)](s(1374)+t+s(1454),e),n=!1}return{success:n}})),o[i(1179)]("updateConfig",(t=>fn(s,t))),o[i(1179)](i(819),(async t=>{const n=i,o=e[n(876)](ai),r=s.file[n(2297)];if(void 0===h&&("image/jpeg"===r||r===n(1420))){if(h=await o[n(647)](n(2250),80,0,100),void 0===h)throw new Error(n(804));h/=100}const a=performance[n(676)](),c=await(t.isAutoSaveEnabled?s[n(1903)][n(1062)]():s[n(1903)][n(1146)]({encodeOptions:{quality:h,type:r}}));return{blobBuffer:new Uint8Array(await c[n(2180)]()),encodeDuration:performance.now()-a}})),o[i(1179)](i(532),(async t=>{const e=i;return t[e(811)]&&t.hotExitMaxPixels<s[e(2386)].width*s.layer.height?{success:!1}:{success:!0,state:s[e(1903)].saveState(t[e(811)]),workbenchState:r[e(2316)]}})),o[i(1179)](i(2285),(async t=>{h=void 0,un(t[i(1253)],t.extName,s,a)})),o[i(1709)]("ready",void 0).then((async t=>{const e=i,h=performance[e(676)]();switch(t[e(544)]){case e(1254):{s[e(1903)][e(2375)](t[e(1622)][e(2164)],t[e(1622)][e(918)],t[e(2318)]);const i=t[e(2318)]===e(1214);pn(n,o,i),i&&mn(a);break}case e(1676):try{let i=t[e(1253)];if(!i){const t=await as.read();t&&(i=new Uint8Array(await t.arrayBuffer()))}i?(s[e(1903)][e(2132)](i,".png",!1),o[e(1709)](e(2029),i)):(s[e(1903)].newImage(t[e(528)].width,t.fallbackDimensions[e(918)]),pn(n,o,!1));break}catch(t){console.error(e(2018),t)}s[e(1903)].newImage(t.fallbackDimensions[e(2164)],t[e(528)][e(918)]),pn(n,o,!1);break;case e(2285):await un(t.data,t.extName,s,a,t[e(608)]),pn(n,o,t[e(2318)]===e(1214));break;case e(1706):if((!t[e(2271)]||0===t[e(2316)][e(1222)].history?.[e(605)]?.[e(1807)])&&(t.state[e(1222)][e(1280)]={currentEntry:0,entries:[(new z)[e(629)]()]}),s[e(1903)][e(2249)](t[e(2316)]),void 0!==t[e(1406)]&&t[e(1406)]!==t[e(2316)][e(1222)][e(1280)][e(1634)]){let i=t.state[e(1222)][e(1280)][e(1634)]-t[e(1406)];if(i>0)for(;0!=i--&&s[e(1280)].canUndo;)await s[e(1280)][e(1921)]();else if(i<0)for(;0!=i++&&s[e(1280)][e(915)];)await s[e(1280)].redo()}pn(n,o,!1)}r.restoreState(t[e(1474)]),fn(s,t[e(1203)]),o[e(1709)]("parseFinished",{duration:performance[e(676)]()-h})})),o[i(1179)](i(706),(t=>{r.syncGlobalState(t)})),r[i(1952)]((t=>o[i(1709)](i(734),t))),o[i(1179)](i(2293),(()=>s.render[i(2268)]())),window[i(2062)](i(1603),(()=>{const t=i;_n(o,t(806),!0),s[t(1352)][t(803)]()})),window[i(2062)](i(2378),(()=>{_n(o,i(806),!1)})),window[i(2062)](i(1095),(t=>{const e=i,s=t[e(1996)];if(s[e(1451)]!==e(1038))_n(o,e(2183),!1);else{const t=s,i=t[e(544)]===e(1386)||t[e(544)]===e(711);_n(o,e(2183),i)}})),window[i(2062)](i(2055),(t=>{_n(o,i(2183),!1)})),s[i(1280)].onEntriesChange((t=>{const e=i;!t||s[e(1280)][e(605)][e(1807)]<=1||s[e(1280)][e(1314)]!==s[e(1280)][e(605)][s[e(1280)].entries[e(1807)]-1]||o[e(1709)]("historyNewEdit",{label:s[e(1280)][e(1314)][e(875)]})})),s[i(1903)][i(2153)]((t=>{o[i(1709)]("setMimeType",t)})),ji({id:"vscode.toggleMenuBar",label:"Toggle Menu Bar",section:i(1858),run:()=>{const t=i;return o[t(1709)](t(927),{command:t(793),args:t(2074)})}}),e[i(876)](ni).createItem({text:i(1052),alignment:0,className:i(1521),hasImage:!0,target:0,dispose:()=>{},commandId:i(1152)}),n.get(7)?.onUpdate((t=>_n(o,i(569),t))),ms.redoHandler=()=>o[i(1709)]("vscode.executeCommand",{command:i(1913)}),ms[i(1317)]=()=>o[i(1709)](i(927),{command:"undo"}),new MutationObserver((()=>gn()))[i(965)](document.documentElement,{attributes:!0,attributeFilter:["style"]}),gn()}});const wn=new ei,vn=new xe({mouseWheelBehavior:t(1623),snapToPixelGrid:!0});vn[t(1022)][t(2217)]=!0,!("SharedArrayBuffer"in window)&&(window[t(760)]=ArrayBuffer),wn[t(858)](si,vn);const bn=window[t(2336)]();window[t(2336)]=void 0,wn[t(858)](Ye,wn.createInstance(Je)),wn[t(858)](Ti,wn.createInstance(Li,bn)),wn[t(858)](ci,wn.createInstance(Si)),wn.setService(ai,wn[t(1100)](Pi)),wn[t(858)](Ze,wn[t(1100)](Ri)),wn[t(858)](ze,wn.createInstance(Ke)),wn[t(858)](He,wn[t(1100)](Xe)),wn[t(858)](Qe,wn[t(1100)](Bi)),wn[t(858)](ni,wn.createInstance(oi)),wn[t(858)](ii,wn[t(1100)](Ai)),wn[t(858)](vi,wn.createInstance(bi)),wn[t(858)](yi,wn.createInstance(wi)),wn[t(858)](hi,wn[t(1100)](_i)),wn.setService(Fi,wn.createInstance(Ni)),new class{constructor(e){const i=t,s=document[i(572)](i(2043));e[i(1756)](si)[i(1116)][i(1925)](s);for(const t of Ei.getAll())e[i(1561)](t.start.bind(t))}}(wn)})()})();