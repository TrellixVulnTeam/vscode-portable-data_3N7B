const a3_0x20d8=["cos","max",'Invalid dimensions for image "'," must be contained within ","height",'" dimensions differ',"targetImage",'" dimensions are equal',"pointA","pointB","2QJxUuw","push","width","isInteger","12852VgBAbf",'Range "',"121MEIkNR","1126682THklRe","smoothing","466403jrfEkf","set",'Images "',"beginPath","webpackChunkluna","9973XNJGXe","abs","subarray"," x ","rgba(","slice","update","sqrt","color","round","getContext","Could not attain 2d context","pow","bottom","blendMode","selection","ceil","moveTo","The line can not be drawn outside of the selection and viewport","lineTo","lineWidth","1784455GNoAID",'": ',"right","data","strokeWidth","21EDvFsl","325197iFwaFe","top","730115GNsPrZ","getImageData","min","sin","stroke",'" and "',"length","left","replace","floor"],a3_0x5f21=function(t,n){return a3_0x20d8[t-=500]},a3_0x5015ad=a3_0x5f21;(function(t,n){const e=a3_0x5f21;for(;;)try{if(925984===-parseInt(e(557))*parseInt(e(530))+-parseInt(e(559))*-parseInt(e(504))+parseInt(e(531))+-parseInt(e(560))+parseInt(e(525))+parseInt(e(562))+-parseInt(e(533))*parseInt(e(553)))break;t.push(t.shift())}catch(n){t.push(t.shift())}})(a3_0x20d8),(self[a3_0x5015ad(503)]=self.webpackChunkluna||[])[a3_0x5015ad(554)]([[51],{51:(t,n,e)=>{"use strict";e.r(n),e.d(n,{run:()=>c});var r=e(371),a=e(517),o=e(19),i=e(939),f=e(3),s=e(742);const c=async(t,n,e)=>{const c=a3_0x5f21;return(0,s.ap)(e,c(549)),!e[c(561)]&&e[c(529)]<=1?function(t){const n=a3_0x5f21,e=t.pointA,s=t[n(552)];e.x=Math[n(513)](e.x),e.y=Math[n(513)](e.y),s.x=Math[n(513)](s.x),s.y=Math[n(513)](s.y);const c=t[n(549)].width,h=t[n(549)][n(555)],u=(0,f.tH)(e.x,e.y,s.x,s.y);if(u.left=(0,i.u)(Math[n(542)](u.left),c,0),u.right=(0,i.u)(Math[n(520)](u[n(527)]),c,0),u.top=(0,i.u)(Math[n(520)](u[n(532)]),h,0),u[n(517)]=(0,i.u)(Math.ceil(u.bottom),h,0),t[n(519)]&&(t[n(519)].left>u[n(540)]&&(u[n(540)]=Math[n(535)](t[n(519)][n(540)],u[n(527)])),t.selection.right<u[n(527)]&&(u[n(527)]=Math[n(544)](t.selection[n(527)],u[n(540)])),t.selection[n(532)]>u[n(532)]&&(u.top=Math[n(535)](t.selection[n(532)],u.bottom)),t[n(519)][n(517)]<u[n(517)]&&(u[n(517)]=Math[n(544)](t[n(519)][n(517)],u[n(532)]))),u.left===u[n(527)]||u[n(532)]===u[n(517)])throw new Error(n(522));let l=(0,r.X$)(Math.max((0,f.Oq)(u),(0,f.rY)(u)),c*h*4,!0),d=new Uint8Array(new SharedArrayBuffer(4*l[n(539)])),M=new Uint8Array(new SharedArrayBuffer(4*l.length)),x=0,g=0;(0,o.j)(t[n(512)],e.x,e.y,s.x,s.y,((e,o,i)=>{const f=n;e<u.left||e>=u[f(527)]||o<u[f(532)]||o>=u[f(517)]||(x>=l.length&&(l=(0,r.Rs)(l),d=(0,r.Rs)(d),M=(0,r.Rs)(M)),g=4*(o*c+e),l[x]=g,(0,r.Yr)(d,4*x,t[f(549)].data,g),t[f(518)]===f(541)?t.targetImage[f(528)].set(i,g):(0,a.B)(t.blendMode,t[f(549)][f(528)],g,i,0),(0,r.Yr)(M,4*x++,t.targetImage[f(528)],g))}),t[n(561)],t[n(529)]);const w=l[n(506)](0,x);return{undoData:{indexList:w,colorData:d[n(506)](0,4*x)},redoData:{indexList:w,colorData:M[n(506)](0,4*x)},range:u}}(e):function(t,n){const e=a3_0x5f21,o=n[e(551)],s=n[e(552)],c=n[e(549)].width,h=n.targetImage[e(547)],u=(0,f.tH)(o.x+.5,o.y+.5,s.x+.5,s.y+.5);u[e(540)]=Math[e(542)](u[e(540)]),u[e(527)]=Math.ceil(u[e(527)]),u[e(532)]=Math[e(542)](u.top),u[e(517)]=Math.ceil(u.bottom);const l=Math[e(520)](n[e(529)]/2);if(u[e(540)]-=l,u[e(527)]+=l,u[e(532)]-=l,u[e(517)]+=l,u[e(540)]=(0,i.u)(Math[e(542)](u.left),c,0),u[e(527)]=(0,i.u)(Math[e(520)](u[e(527)]),c,0),u[e(532)]=(0,i.u)(Math[e(520)](u[e(532)]),h,0),u.bottom=(0,i.u)(Math[e(520)](u[e(517)]),h,0),n.selection&&(n[e(519)].left>u.left&&(u[e(540)]=Math.min(n[e(519)][e(540)],u.right)),n[e(519)][e(527)]<u[e(527)]&&(u[e(527)]=Math[e(544)](n[e(519)][e(527)],u.left)),n[e(519)][e(532)]>u[e(532)]&&(u.top=Math[e(535)](n[e(519)][e(532)],u[e(517)])),n.selection[e(517)]<u.bottom&&(u[e(517)]=Math[e(544)](n.selection[e(517)],u.top))),u[e(540)]===u[e(527)]||u[e(532)]===u.bottom)throw new Error("The line can not be drawn outside of the selection and viewport");const d=(0,f.Oq)(u),M=(0,f.rY)(u),x=.5,g=.5,w=.5,y=.5,p=new OffscreenCanvas(d,M)[e(514)]("2d");if(!p)throw new Error(e(515));p.strokeStyle=e(508)+n[e(512)][0]+","+n[e(512)][1]+","+n.color[2]+","+n[e(512)][3]/255+")",p[e(524)]=n.strokeWidth,p[e(502)](),n[e(561)]||n[e(529)]%2!=0?(p[e(521)](o.x-u[e(540)]+x,o.y-u[e(532)]+g),p[e(523)](s.x-u[e(540)]+w,s.y-u[e(532)]+y)):(p.moveTo(Math[e(513)](o.x-u[e(540)]+x),Math[e(513)](o.y-u[e(532)]+g)),p[e(523)](Math[e(513)](s.x-u[e(540)]+w),Math.round(s.y-u[e(532)]+y))),p[e(537)]();const m=p[e(534)](0,0,d,M),_=(0,r.X$)(c*h,c*h*4,!0),A=(0,r.X$)(c*h*2,Math.max(c,h),!0);let b=0,I=0,U=0,v=0;if(n[e(561)])for(U=0;U<M;U++)for(I=0;I<d;I++)v=4*(U*d+I),m.data[v+3]>0&&(A[2*b]=I,A[2*b+1]=U,_[b++]=4*((u.top+U)*c+u[e(540)]+I));else for(U=0;U<M;U++)for(I=0;I<d;I++)v=4*(U*d+I),m.data[v+3]>n[e(512)][3]/2&&(m.data[v+3]=n.color[3],A[2*b]=I,A[2*b+1]=U,_[b++]=4*((u[e(532)]+U)*c+u[e(540)]+I));const B=_[e(506)](0,b);t[e(510)](.25);const k=new Uint8Array(new SharedArrayBuffer(4*_.length));for(v=0;v<_[e(539)];v++)(0,r.Yr)(k,4*v,n.targetImage.data,_[v]);if(t[e(510)](.5),"replace"===n[e(518)])for(v=0;v<B[e(539)];v++)(0,r.Yr)(n[e(549)][e(528)],B[v],m[e(528)],4*(A[2*v+1]*d+A[2*v]));else for(v=0;v<B.length;v++)(0,a.B)(n[e(518)],n[e(549)][e(528)],B[v],m[e(528)],4*(A[2*v+1]*d+A[2*v]));t[e(510)](.75);const D=new Uint8Array(new SharedArrayBuffer(4*_[e(539)]));for(v=0;v<_[e(539)];v++)(0,r.Yr)(D,4*v,n[e(549)].data,_[v]);return t[e(510)](1),{undoData:{indexList:B,colorData:k},redoData:{indexList:B,colorData:D},range:u}}(n,e)}},742:(t,n,e)=>{"use strict";e.d(n,{ap:()=>a,TO:()=>o,zg:()=>i});var r=e(3);function a(t,n){const e=a3_0x5f21,r=t[n];if(r[e(555)]<1||r[e(547)]<1)throw new Error(e(545)+n+e(526)+r[e(555)]+e(507)+r[e(547)])}function o(t,n,e){const r=a3_0x5f21,a=t[n],o=t[e];if(a[r(555)]===o[r(555)]&&a[r(547)]===o[r(547)])throw new Error(r(501)+n+'" and "'+e+r(550))}function i(t,n,e){const a=a3_0x5f21,o=t[n];if(!(0,r.ur)(e,o))throw new Error(a(558)+n+'" '+(0,r.PW)(o)+a(546)+(0,r.PW)(e))}},371:(t,n,e)=>{"use strict";const r=a3_0x5015ad;function a(t,n=2*t[r(539)]){let e;if(t instanceof Float32Array)e=new Float32Array(n);else if(t instanceof Uint8Array)e=new Uint8Array(n);else if(t instanceof Uint16Array)e=new Uint16Array(n);else{if(!(t instanceof Uint32Array))throw new Error("Unrecognized array type");e=new Uint32Array(n)}return e.set(t),e}function o(t,n,e=!1){const a=r;return n<Math[a(516)](2,8)?e?new Uint8Array(new SharedArrayBuffer(t)):new Uint8Array(t):n<Math[a(516)](2,16)?e?new Uint16Array(new SharedArrayBuffer(2*t)):new Uint16Array(t):e?new Uint32Array(new SharedArrayBuffer(4*t)):new Uint32Array(t)}function i(t,n,e,r){t[n]=e[r],t[n+1]=e[r+1],t[n+2]=e[r+2],t[n+3]=e[r+3]}e.d(n,{Rs:()=>a,X$:()=>o,Yr:()=>i})},517:(t,n,e)=>{"use strict";const r=a3_0x5015ad;e.d(n,{B:()=>s});var a=e(371);const o=new Float32Array(6);let i;const f={normal:(t,n)=>n,darken:(t,n)=>Math.min(t,n),multiply:(t,n)=>t*n,linearBurn:(t,n)=>Math[r(544)](t+n-1,0),lighten:(t,n)=>Math[r(544)](t,n),screen:(t,n)=>1-(1-t)*(1-n),linearDodgeAdd:(t,n)=>Math.min(t+n,1),overlay:(t,n)=>t<.5?2*t*n:1-2*(1-t)*(1-n),softLight:(t,n)=>n<.5?2*t*n+t*t*(1-2*n):Math[r(511)](t)*(2*n-1)+2*t*(1-n),difference:(t,n)=>Math[r(505)](t-n),exclusion:(t,n)=>t+n-2*t*n};function s(t,n,e,s,h,u=n,l=e){const d=r;if(t!==d(541)){if(o[0]=s[h+3]/255,0===o[0])return n[e]=u[l],n[e+1]=u[l+1],n[e+2]=u[l+2],void(n[e+3]=u[l+3]);if(o[1]=u[l+3]/255,0===o[1])return n[e]=s[h],n[e+1]=s[h+1],n[e+2]=s[h+2],void(n[e+3]=s[h+3]);i=f[t],o[3]=i(u[l]/255,s[h]/255),o[4]=i(u[l+1]/255,s[h+1]/255),o[5]=i(u[l+2]/255,s[h+2]/255),o[2]=o[0]+o[1]*(1-o[0]),n[e]=Math[d(513)](c(u[l]/255,o[1],s[h]/255,o[0],o[3])/o[2]*255),n[e+1]=Math[d(513)](c(u[l+1]/255,o[1],s[h+1]/255,o[0],o[4])/o[2]*255),n[e+2]=Math[d(513)](c(u[l+2]/255,o[1],s[h+2]/255,o[0],o[5])/o[2]*255),n[e+3]=Math[d(513)](255*o[2])}else(0,a.Yr)(n,e,s,h)}function c(t,n,e,r,a){return(n-n*r)*t+(r-n*r)*e+n*r*a}},19:(t,n,e)=>{"use strict";function r(t,n,e,r,c,h,u,l=1){u?function(t,n,e,r,a,o,c){const h=a3_0x5f21;c<1&&(t=s(t,c));const u=Math[h(505)](a-e)>Math[h(505)](r-n);let l=0;u&&(l=n,n=e,e=l,l=r,r=a,a=l),n>r&&(l=n,n=r,r=l,l=e,e=a,a=l);const d=r-n;let M=(a-e)/d;0===d&&(M=1);let x=Math[h(513)](n),g=e+M*(x-n),w=f(n+.5);const y=x,p=Math[h(542)](g);let m=i(g)*w;u?(o(p,y,s(t,f(g)*w)),m>0&&o(p+1,y,s(t,m))):(o(y,p,s(t,f(g)*w)),m>0&&o(y,p+1,s(t,m)));let _=g+M;x=Math[h(513)](r),g=a+M*(x-r),w=i(r+.5);const A=x,b=Math[h(542)](g);if(m=i(g)*w,u?(o(b,A,s(t,f(g)*w)),m>0&&o(b+1,A,s(t,i(g)*w))):(o(A,b,s(t,f(g)*w)),m>0&&o(A,b+1,s(t,i(g)*w))),u)for(let n=y+1;n<A;n++)o(Math[h(542)](_),n,s(t,f(_))),m=i(_),m>0&&o(Math.floor(_)+1,n,s(t,m)),_+=M;else for(let n=y+1;n<A;n++)o(n,Math.floor(_),s(t,f(_))),m=i(_),m>0&&o(n,Math[h(542)](_)+1,s(t,m)),_+=M}(t,n,e,r,c,h,l):function(t,n,e,r,i,f,c){const h=a3_0x5f21;c<1&&(t=s(t,c)),Math.abs(i-e)<Math[h(505)](r-n)?n>r?a(t,r,i,n,e,f):a(t,n,e,r,i,f):e>i?o(t,r,i,n,e,f):o(t,n,e,r,i,f)}(t,n,e,r,c,h,l)}function a(t,n,e,r,a,o){const i=r-n;let f=a-e,s=1;f<0&&(s=-1,f=-f);let c=2*f-i,h=e;for(let e=n;e<=r;e++)o(e,h,t),c>0?(h+=s,c+=2*(f-i)):c+=2*f}function o(t,n,e,r,a,o){let i=r-n;const f=a-e;let s=1;i<0&&(s=-1,i=-i);let c=2*i-f,h=n;for(let n=e;n<=a;n++)o(h,n,t),c>0?(h+=s,c+=2*(i-f)):c+=2*i}function i(t){return t%1}function f(t){return 1-t%1}function s(t,n){const e=a3_0x5f21;if(void 0===t)return;const r=t[e(509)](0);return r[3]=Math[e(513)](r[3]*n),r}e.d(n,{j:()=>r})},939:(t,n,e)=>{"use strict";function r(t,n,e=0){const r=a3_0x5f21;return Math[r(544)](Math[r(535)](t,n),e)}e.d(n,{u:()=>r})},3:(t,n,e)=>{"use strict";function r(t){const n=a3_0x5f21;if(t)return{left:t[n(540)],top:t.top,right:t[n(527)],bottom:t[n(517)]}}function a(t,n){return{left:t,top:n,right:t+1,bottom:n+1}}function o(t,n){return{left:0,top:0,right:t,bottom:n}}function i(t,n,e,r){const a=a3_0x5f21,o=function(t){const n=a3_0x5f21;if(t[n(540)]>t.right){const e=t.right;t.right=t[n(540)],t[n(540)]=e}if(t.top>t[n(517)]){const e=t[n(517)];t.bottom=t.top,t[n(532)]=e}if(t.right<t[n(540)]){const e=t[n(540)];t[n(540)]=t[n(527)],t[n(527)]=e}if(t[n(517)]<t.top){const e=t[n(532)];t[n(532)]=t[n(517)],t[n(517)]=e}return t}({left:t,top:n,right:e,bottom:r});return o.right++,o[a(517)]++,o}function f(t){const n=a3_0x5f21;return t[n(540)]=Math[n(542)](t[n(540)]),t[n(527)]=Math[n(520)](t[n(527)]),t.top=Math[n(542)](t[n(532)]),t[n(517)]=Math[n(520)](t.bottom),t}function s(t,n,e){const r=a3_0x5f21;if(function(t){const n=a3_0x5f21;return t[n(540)]===t[n(527)]||t.top===t[n(517)]}(t))return t[r(540)]=n,t.right=n+1,t.top=e,void(t[r(517)]=e+1);t[r(540)]=Math[r(535)](t.left,n),t[r(532)]=Math[r(535)](t[r(532)],e),t[r(527)]=Math[r(544)](t[r(527)],n+1),t[r(517)]=Math[r(544)](t[r(517)],e+1)}function c(t,n,e){const r=a3_0x5f21;return n>=t[r(540)]&&n<t.right&&e>=t[r(532)]&&e<t[r(517)]}function h(t,n){const e=a3_0x5f21;return n[e(540)]>=t.left&&n.right<=t[e(527)]&&n[e(532)]>=t[e(532)]&&n[e(517)]<=t[e(517)]}function u(t){const n=a3_0x5f21;return"("+t[n(540)]+","+t[n(532)]+")->("+t[n(527)]+","+t[n(517)]+")"}function l(t){const n=a3_0x5f21;return t[n(527)]-t[n(540)]}function d(t){const n=a3_0x5f21;return t[n(517)]-t[n(532)]}e.d(n,{BN:()=>r,Re:()=>a,DI:()=>o,tH:()=>i,kq:()=>f,Hv:()=>s,RB:()=>c,ur:()=>h,PW:()=>u,Oq:()=>l,rY:()=>d})}}]);