const a5_0x61ac=["buffer","map","height","left","1gqEHlr","abs","13WQgJIR"," must be contained within ","push","817698bhhRou","SharedArrayBuffer","data","ceil","text","isInteger","targetImage","1199164oSZXIu","isItalic","px "," italic","verticalAlignment","getContext","blendMode","middle","fillText","getImageData","update",'" and "',"fillStyle","font","1729673lzwKZf","pow","right","bottom","rgba(",'" dimensions differ',"max","The text can not be drawn outside of the selection and viewport","set","round","1nvJjwu","624411CQLRvF","376733SXUfSo","24609GTuXMd","primaryColor","sqrt","width"," x "," bold","floor","1TOezzB","webpackChunkluna","Unrecognized array type","alignment","replace","308881tnFQhE","measureText","fontFamily","dimensions","split",'": ',"selection","trim","length","textAlign",'Images "',"min","textBaseline",'" dimensions are equal',"top","fontSize"],a5_0x5943=function(t,n){return a5_0x61ac[t-=163]},a5_0x3ad818=a5_0x5943;(function(t,n){const e=a5_0x5943;for(;;)try{if(967087===parseInt(e(163))*-parseInt(e(200))+-parseInt(e(212))*parseInt(e(197))+parseInt(e(199))*-parseInt(e(232))+parseInt(e(187))+-parseInt(e(173))+-parseInt(e(166))*-parseInt(e(207))+parseInt(e(198)))break;t.push(t.shift())}catch(n){t.push(t.shift())}})(a5_0x61ac),(self[a5_0x3ad818(208)]=self.webpackChunkluna||[])[a5_0x3ad818(165)]([[919],{919:(t,n,e)=>{"use strict";e.r(n),e.d(n,{run:()=>c});var r=e(371),a=e(517),o=e(939),i=e(3),s=e(742);const c=async(t,n,e)=>((0,s.ap)(e,"targetImage"),function(t,n){const e=a5_0x5943,s=n[e(172)][e(203)],c=n[e(172)][e(230)],f={...n[e(215)]};if(f[e(231)]=Math[e(206)](f.left),f[e(189)]=Math.ceil(f.right),f.top=Math.floor(f[e(226)]),f[e(190)]=Math[e(169)](f[e(190)]),f.left=(0,o.u)(Math[e(206)](f[e(231)]),s,0),f[e(189)]=(0,o.u)(Math[e(169)](f[e(189)]),s,0),f[e(226)]=(0,o.u)(Math[e(169)](f[e(226)]),c,0),f[e(190)]=(0,o.u)(Math[e(169)](f[e(190)]),c,0),n.selection&&(n[e(218)][e(231)]>f[e(231)]&&(f[e(231)]=Math[e(223)](n[e(218)][e(231)],f[e(189)])),n[e(218)][e(189)]<f[e(189)]&&(f[e(189)]=Math[e(193)](n[e(218)][e(189)],f.left)),n[e(218)].top>f[e(226)]&&(f[e(226)]=Math[e(223)](n[e(218)][e(226)],f[e(190)])),n[e(218)][e(190)]<f.bottom&&(f[e(190)]=Math.max(n.selection.bottom,f[e(226)]))),f[e(231)]===f[e(189)]||f[e(226)]===f[e(190)])throw new Error(e(194));const u=(0,i.Oq)(f),h=(0,i.rY)(f),l=(0,i.Oq)(n[e(215)]),d=(0,i.rY)(n.dimensions),w=new OffscreenCanvas(u,h)[e(178)]("2d");if(!w)throw new Error("Could not attain 2d context");let x="";n.isBold&&(x+=e(205)),n[e(174)]&&(x+=e(176)),x+=" "+n[e(227)]+e(175)+n[e(214)],w[e(186)]=x[e(219)](),w[e(221)]=e(231),w[e(224)]=e(226),w[e(185)]=e(191)+n[e(201)][0]+","+n[e(201)][1]+","+n[e(201)][2]+","+n[e(201)][3]/255+")";const p=function(t,n,e){const r=a5_0x5943,a=[],o=n[r(216)]("\n");for(const n of o){const o=n[r(216)](" ");let i=o[0];for(let n=1;n<o[r(220)];n++){const s=o[n];t.measureText(i+" "+s).width<e?i+=" "+s:(a[r(165)]({text:i,width:t[r(213)](i).width}),i=s)}a[r(165)]({text:i,width:t[r(213)](i)[r(203)]})}return a}(w,n[e(170)],l),g=n[e(227)];let m;switch(n[e(177)]){case e(226):m=0;break;case e(180):m=Math.round((d-p.length*g)/2);break;case e(190):m=d-g*p[e(220)]}if(m+=n[e(215)][e(226)]-f[e(226)],"justify"===n[e(210)])for(const t of p){const r=t[e(170)].split(" ")[e(229)]((t=>{const n=e;return{text:t,width:w[n(213)](t)[n(203)]}})),a=(l-r.reduce(((t,n)=>t+n.width),0))/(r.length-1);let o=n.dimensions.left-f[e(231)];for(const t of r)w[e(181)](t[e(170)],Math[e(196)](o),m),o+=t.width+a;m+=g}else for(const t of p){let r;switch(n[e(210)]){case e(231):r=0;break;case"center":r=l/2,w[e(221)]="center";break;case e(189):r=l,w[e(221)]=e(189)}r+=n[e(215)][e(231)]-f.left,w[e(181)](t[e(170)],r,m),m+=g}const M=w[e(182)](0,0,u,h),y=(0,r.X$)(s*c,s*c*4,!0),_=(0,r.X$)(s*c*2,Math.max(s,c),!0);let b=0,A=0,I=0,U=0;for(I=0;I<h;I++)for(A=0;A<u;A++)U=4*(I*u+A),M[e(168)][U+3]>0&&(_[2*b]=A,_[2*b+1]=I,y[b++]=4*((f.top+I)*s+f[e(231)]+A));const v=y.subarray(0,b);t[e(183)](.25);const B=new Uint8Array(new SharedArrayBuffer(4*y[e(220)]));for(U=0;U<y[e(220)];U++)(0,r.Yr)(B,4*U,n[e(172)][e(168)],y[U]);if(t[e(183)](.5),"replace"===n[e(179)])for(U=0;U<v[e(220)];U++)(0,r.Yr)(n[e(172)][e(168)],v[U],M[e(168)],4*(_[2*U+1]*u+_[2*U]));else for(U=0;U<v[e(220)];U++)(0,a.B)(n[e(179)],n[e(172)].data,v[U],M.data,4*(_[2*U+1]*u+_[2*U]));t.update(.75);const k=new Uint8Array(new SharedArrayBuffer(4*y[e(220)]));for(U=0;U<y.length;U++)(0,r.Yr)(k,4*U,n[e(172)][e(168)],y[U]);return t[e(183)](1),{undoData:{indexList:v,colorData:B},redoData:{indexList:v,colorData:k},range:f}}(n,e))},742:(t,n,e)=>{"use strict";e.d(n,{ap:()=>a,TO:()=>o,zg:()=>i});var r=e(3);function a(t,n){const e=a5_0x5943,r=t[n];if(r.width<1||r[e(230)]<1)throw new Error('Invalid dimensions for image "'+n+e(217)+r.width+e(204)+r[e(230)])}function o(t,n,e){const r=a5_0x5943,a=t[n],o=t[e];if(a[r(203)]===o[r(203)]&&a[r(230)]===o[r(230)])throw new Error(r(222)+n+r(184)+e+r(225))}function i(t,n,e){const a=a5_0x5943,o=t[n];if(!(0,r.ur)(e,o))throw new Error('Range "'+n+'" '+(0,r.PW)(o)+a(164)+(0,r.PW)(e))}},371:(t,n,e)=>{"use strict";function r(t,n=2*t.length){const e=a5_0x5943;let r;if(t instanceof Float32Array)r=new Float32Array(n);else if(t instanceof Uint8Array)r=new Uint8Array(n);else if(t instanceof Uint16Array)r=new Uint16Array(n);else{if(!(t instanceof Uint32Array))throw new Error(e(209));r=new Uint32Array(n)}return r[e(195)](t),r}function a(t,n,e=!1){return n<Math[a5_0x5943(188)](2,8)?e?new Uint8Array(new SharedArrayBuffer(t)):new Uint8Array(t):n<Math.pow(2,16)?e?new Uint16Array(new SharedArrayBuffer(2*t)):new Uint16Array(t):e?new Uint32Array(new SharedArrayBuffer(4*t)):new Uint32Array(t)}function o(t,n,e,r){t[n]=e[r],t[n+1]=e[r+1],t[n+2]=e[r+2],t[n+3]=e[r+3]}e.d(n,{Rs:()=>r,X$:()=>a,Yr:()=>o})},517:(t,n,e)=>{"use strict";const r=a5_0x3ad818;e.d(n,{B:()=>c});var a=e(371);const o=new Float32Array(6);let i;const s={normal:(t,n)=>n,darken:(t,n)=>Math[r(223)](t,n),multiply:(t,n)=>t*n,linearBurn:(t,n)=>Math.max(t+n-1,0),lighten:(t,n)=>Math[r(193)](t,n),screen:(t,n)=>1-(1-t)*(1-n),linearDodgeAdd:(t,n)=>Math[r(223)](t+n,1),overlay:(t,n)=>t<.5?2*t*n:1-2*(1-t)*(1-n),softLight:(t,n)=>n<.5?2*t*n+t*t*(1-2*n):Math[r(202)](t)*(2*n-1)+2*t*(1-n),difference:(t,n)=>Math[r(233)](t-n),exclusion:(t,n)=>t+n-2*t*n};function c(t,n,e,c,u,h=n,l=e){const d=r;if(t!==d(211)){if(o[0]=c[u+3]/255,0===o[0])return n[e]=h[l],n[e+1]=h[l+1],n[e+2]=h[l+2],void(n[e+3]=h[l+3]);if(o[1]=h[l+3]/255,0===o[1])return n[e]=c[u],n[e+1]=c[u+1],n[e+2]=c[u+2],void(n[e+3]=c[u+3]);i=s[t],o[3]=i(h[l]/255,c[u]/255),o[4]=i(h[l+1]/255,c[u+1]/255),o[5]=i(h[l+2]/255,c[u+2]/255),o[2]=o[0]+o[1]*(1-o[0]),n[e]=Math[d(196)](f(h[l]/255,o[1],c[u]/255,o[0],o[3])/o[2]*255),n[e+1]=Math[d(196)](f(h[l+1]/255,o[1],c[u+1]/255,o[0],o[4])/o[2]*255),n[e+2]=Math[d(196)](f(h[l+2]/255,o[1],c[u+2]/255,o[0],o[5])/o[2]*255),n[e+3]=Math.round(255*o[2])}else(0,a.Yr)(n,e,c,u)}function f(t,n,e,r,a){return(n-n*r)*t+(r-n*r)*e+n*r*a}},939:(t,n,e)=>{"use strict";function r(t,n,e=0){const r=a5_0x5943;return Math[r(193)](Math[r(223)](t,n),e)}e.d(n,{u:()=>r})},3:(t,n,e)=>{"use strict";function r(t){const n=a5_0x5943;if(t)return{left:t.left,top:t.top,right:t.right,bottom:t[n(190)]}}function a(t,n){return{left:t,top:n,right:t+1,bottom:n+1}}function o(t,n){return{left:0,top:0,right:t,bottom:n}}function i(t,n,e,r){const a=a5_0x5943,o=function(t){const n=a5_0x5943;if(t[n(231)]>t[n(189)]){const e=t[n(189)];t[n(189)]=t[n(231)],t[n(231)]=e}if(t[n(226)]>t.bottom){const e=t[n(190)];t[n(190)]=t.top,t[n(226)]=e}if(t[n(189)]<t[n(231)]){const e=t[n(231)];t.left=t.right,t[n(189)]=e}if(t[n(190)]<t.top){const e=t[n(226)];t.top=t[n(190)],t[n(190)]=e}return t}({left:t,top:n,right:e,bottom:r});return o[a(189)]++,o.bottom++,o}function s(t){const n=a5_0x5943;return t[n(231)]=Math[n(206)](t[n(231)]),t.right=Math.ceil(t[n(189)]),t.top=Math[n(206)](t.top),t[n(190)]=Math.ceil(t[n(190)]),t}function c(t,n,e){const r=a5_0x5943;if(function(t){const n=a5_0x5943;return t[n(231)]===t.right||t[n(226)]===t.bottom}(t))return t.left=n,t[r(189)]=n+1,t[r(226)]=e,void(t[r(190)]=e+1);t.left=Math.min(t[r(231)],n),t.top=Math[r(223)](t[r(226)],e),t[r(189)]=Math[r(193)](t[r(189)],n+1),t[r(190)]=Math[r(193)](t[r(190)],e+1)}function f(t,n,e){const r=a5_0x5943;return n>=t[r(231)]&&n<t[r(189)]&&e>=t[r(226)]&&e<t[r(190)]}function u(t,n){const e=a5_0x5943;return n[e(231)]>=t[e(231)]&&n[e(189)]<=t[e(189)]&&n[e(226)]>=t[e(226)]&&n[e(190)]<=t[e(190)]}function h(t){const n=a5_0x5943;return"("+t[n(231)]+","+t[n(226)]+")->("+t[n(189)]+","+t[n(190)]+")"}function l(t){const n=a5_0x5943;return t.right-t[n(231)]}function d(t){const n=a5_0x5943;return t[n(190)]-t[n(226)]}e.d(n,{BN:()=>r,Re:()=>a,DI:()=>o,tH:()=>i,kq:()=>s,Hv:()=>c,RB:()=>f,ur:()=>u,PW:()=>h,Oq:()=>l,rY:()=>d})}}]);