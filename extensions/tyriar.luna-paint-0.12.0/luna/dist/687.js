const a14_0x16b9=["Move Pixels","clientWidth","onBeforeRunLayerTask","_onRequestRender","_qualityOption","setVisible","options","darken","_container","100SknFtx","_renderer","_expandCanvasToSelectionAction","move","76749DRVhgq","fire","push","quality","_finishSelection","slice","register","none","ArrowUp","_activeMovingLayer","ArrowDown","flipX","Nearest Neighbor","selectionService","top","commit","getPointerState","boolean","appendChild","moveToRange","_isYFlipping","resource","252904yYFeHf","5WylsMp","viewportService","linearDodgeAdd","createCompositeEntrySync","bilinear","right","No moving layer","_isVisible","exclusion","Blend Mode","edit","_onStateChange","height","setValueFromHistoryChange","max","triggerRequestRender","MoveImageRangeRenderer","overlay","altKey","_isXFlipping","value","actions","data","width","round","Finish Selection","expand-canvas-to-selection","name","movePixels","_startMove","_isFirstMove","Bilinear","_sc","_getQualityValue","_cursorCurrent","onUpdateEmitter","removeChild","screen","createDomRenderProgram","selectAll","range","723877YDFMxq","webpackChunkluna","_clearMovingLayer","isReady","state","get","bottom","temporaryLayer","hasImage","offsetY","keyDown","moveStep","_activeLayer","createCompositeEntry","currentLayer","new","4787NRVMaM","_cursorOrigin","div","Set Quality Sampling","validate","clientHeight","type","_value","optionStep","bottomleft","softLight","setTopLeft","imageService","18379bjwUxU","nearestneighbor","taskWorkerService","createElement","min","left","92589eJBsyw","lighten","metaKey","_viewportService","setRange","_onOptionsChange","Move Selected Pixels","order","finishSelection","_elementContainer","enabled","_setupActiveTemporaryLayer","onHistoryUnset","_refreshLayerSelectionRange","offsetX","normal","pointerDownMove","set","ArrowLeft","onRequestRender","taskService","getCoordsFromEvent","onTemporaryLayerRegistered","_refreshActionEnabledState","_directionalMoveZones","onUpdate","_allowNewState","style","Quality","dispose","moving","event","_movingLayerOrigin","bottomright","146459ximwkm","historyService","classList","_onUpdate","topleft","display","flipY","key","_getRange","cutImage","pointerMove","_originalSelection","currentState","linearBurn","shiftKey","difference","floor","onHistoryUpdateValue","add","_enabled","_onHistoryUpdateValue","_getQualityString","_imageService","_directionalMoveElements","zoom","ctrlKey","topright","string"],a14_0x37f4=function(t,i){return a14_0x16b9[t-=488]},a14_0x16b647=a14_0x37f4;(function(t,i){const s=a14_0x37f4;for(;;)try{if(335005===parseInt(s(563))+-parseInt(s(634))+parseInt(s(640))+-parseInt(s(621))*parseInt(s(537))+parseInt(s(564))*-parseInt(s(541))+parseInt(s(500))+parseInt(s(605)))break;t.push(t.shift())}catch(i){t.push(t.shift())}})(a14_0x16b9),(self[a14_0x16b647(606)]=self[a14_0x16b647(606)]||[])[a14_0x16b647(543)]([[687,504],{6173:(t,i,s)=>{"use strict";const e=a14_0x16b647;s.d(i,{f:()=>o});var h=s(1815),r=s(5120);class o extends r.JT{constructor(t,i,s){const e=a14_0x37f4;super(),this.name=t,this[e(627)]=i,this[e(519)]=s,this._onUpdate=this.register(new h.v),this[e(491)]=this[e(503)][e(497)]}get[e(650)](){return this._enabled}set[e(650)](t){const i=e;this[i(519)]!==t&&(this[i(519)]=t,this._onUpdate[i(542)]())}}},9904:(t,i,s)=>{"use strict";const e=a14_0x16b647;s.d(i,{FV:()=>n,rP:()=>a,tv:()=>c,Jp:()=>l,X5:()=>p,qv:()=>u});var h=s(1815),r=s(5120),o=s(2939);class n extends r.JT{constructor(t,i,s,e=!0){const r=a14_0x37f4;super(),this[r(591)]=t,this[r(613)]=i,this[r(628)]=s,this.allowUnchecking=e,this[r(627)]=r(558),this[r(520)]=this[r(547)](new h.v),this.onHistoryUpdateValue=this[r(520)][r(497)],this[r(503)]=this[r(547)](new h.v),this[r(491)]=this[r(503)][r(497)]}get[e(584)](){return this[e(628)]}set[e(584)](t){const i=e;this[i(628)]=t,this._onUpdate[i(542)]()}[e(577)](t){const i=e;this._value=t,this[i(520)][i(542)](t)}}class a extends r.JT{constructor(t,i,s){const r=e;super(),this.name=t,this.options=i,this[r(628)]=s,this.type=r(527),this._onHistoryUpdateValue=this[r(547)](new h.v),this[r(517)]=this[r(520)][r(497)],this[r(503)]=this.register(new h.v),this[r(491)]=this[r(503)][r(497)]}get[e(584)](){return this._value}set[e(584)](t){const i=e;this[i(628)]=t,this[i(503)][i(542)]()}[e(577)](t){const i=e;this._value=t,this._onHistoryUpdateValue[i(542)](t)}}class c extends r.JT{constructor(t,i,s){const r=e;super(),this[r(591)]=t,this[r(534)]=i,this[r(628)]=s,this.type="string-combo",this[r(520)]=this[r(547)](new h.v),this[r(517)]=this[r(520)][r(497)],this[r(503)]=this[r(547)](new h.v),this[r(491)]=this[r(503)][r(497)]}get value(){return this[e(628)]}set[e(584)](t){const i=e;this[i(628)]=t,this[i(503)][i(542)]()}[e(577)](t){const i=e;this._value=t,this[i(520)][i(542)](t)}}class l extends a{constructor(){const t=e;super(t(573),["normal","replace",t(535),"multiply",t(513),t(641),t(601),"linearDodgeAdd",t(581),t(631),t(515),t(572)],t(655))}}class p extends r.JT{constructor(t,i,s,r){const o=e;super(),this[o(591)]=t,this[o(628)]=i,this[o(638)]=s,this[o(578)]=r,this.type="number",this[o(520)]=this[o(547)](new h.v),this[o(517)]=this._onHistoryUpdateValue[o(497)],this._onUpdate=this.register(new h.v),this[o(491)]=this[o(503)][o(497)]}get[e(584)](){const t=e;return(0,o.u)(this[t(628)],this[t(578)],this.min)}set[e(584)](t){const i=e;this[i(628)]=t,this[i(503)][i(542)]()}[e(577)](t){const i=e;this[i(628)]=t,this._onHistoryUpdateValue[i(542)](t)}}class u extends p{constructor(t,i,s,h){const r=e;super(t,i,s,h),this[r(627)]="number"}get[e(584)](){const t=e;return(0,o.u)(this[t(628)],this[t(578)],this[t(638)])}set value(t){const i=e;this._value=Math[i(516)](t),this[i(503)][i(542)]()}}},504:(t,i,s)=>{"use strict";const e=a14_0x16b647;s.r(i),s.d(i,{MoveImageRangeRenderer:()=>o});var h=s(5120),r=s(1003);class o extends h.JT{constructor(t,i,s,e,h){const o=a14_0x37f4;super(),this[o(536)]=t,this[o(508)]=i,this[o(492)]=s,this[o(643)]=e,this[o(522)]=h,this[o(647)]=2,this[o(523)]=new Map,this[o(490)]=new Map,this[o(571)]=!0,this[o(649)]=document[o(637)]("div");const n=[o(504),"topright",o(630),"bottomright","top",o(611),o(639),o(569)];for(const t of n){const i=document.createElement(o(623));i[o(502)][o(518)]("move-handle",t),this[o(649)][o(559)](i),this[o(523)][o(657)](t,i),this[o(490)][o(657)](t,(0,r.Pq)())}this._container.appendChild(this[o(649)]),this[o(547)]({dispose:()=>{const t=o;this[t(536)][t(600)](this._elementContainer)}})}[e(533)](t){const i=e;t!==this._isVisible&&(this._elementContainer.style[i(505)]=t?"":i(548),this[i(571)]=t)}[e(644)](t){}render(){const t=e,i=this[t(508)]();if(!i)return;const s=this._imageService[t(619)];if(!s)return;const h=this[t(643)],r=Math[t(588)](this[t(536)][t(529)]/2)-s[t(587)]/2*h[t(524)],o=Math.round(this[t(536)][t(626)]/2)-s[t(576)]/2*h[t(524)],n=r+(h.x+i.left)*h[t(524)],a=o+(h.y+i[t(555)])*h[t(524)],c=r+(h.x+i[t(569)])*h[t(524)],l=o+(h.y+i[t(611)])*h[t(524)],p=Math.round((n+c)/2),u=Math[t(588)]((a+l)/2),g=10*window.devicePixelRatio,_={left:Math[t(638)](n+g,Math[t(578)](n,p-g)),top:Math[t(638)](a+g,Math[t(578)](a,u-g)),right:Math[t(578)](c-g,Math[t(638)](c,p+g)),bottom:Math.max(l-g,Math[t(638)](l,u+g))},v={left:n-g,top:a-g,right:c+g,bottom:l+g},d=this[t(490)][t(610)](t(504));d[t(639)]=v.left,d.right=_.left,d[t(555)]=v.top,d[t(611)]=_[t(555)];const y=this[t(523)][t(610)]("topleft");y[t(493)][t(639)]=n+"px",y[t(493)][t(555)]=a+"px";const m=this._directionalMoveZones.get(t(526));m[t(639)]=_.right,m[t(569)]=v[t(569)],m.top=v.top,m[t(611)]=_.top;const f=this[t(523)][t(610)](t(526));f[t(493)][t(639)]=c+"px",f.style[t(555)]=a+"px";const w=this[t(490)][t(610)](t(630));w[t(639)]=v[t(639)],w[t(569)]=_[t(639)],w[t(555)]=_[t(611)],w.bottom=v.bottom;const x=this[t(523)][t(610)]("bottomleft");x[t(493)][t(639)]=n+"px",x[t(493)][t(555)]=l+"px";const M=this[t(490)][t(610)]("bottomright");M[t(639)]=_[t(569)],M[t(569)]=v.right,M[t(555)]=_[t(611)],M[t(611)]=v[t(611)];const b=this._directionalMoveElements.get(t(499));b[t(493)][t(639)]=c+"px",b[t(493)][t(555)]=l+"px";const S=this[t(490)][t(610)]("top");S.left=_.left,S[t(569)]=_.right,S[t(555)]=v.top,S[t(611)]=_[t(555)];const L=this[t(523)][t(610)](t(555));L[t(493)][t(639)]=p+"px",L[t(493)][t(555)]=a+"px";const R=this[t(490)][t(610)](t(611));R.left=_[t(639)],R[t(569)]=_[t(569)],R[t(555)]=_[t(611)],R[t(611)]=v[t(611)];const C=this[t(523)][t(610)](t(611));C.style[t(639)]=p+"px",C[t(493)][t(555)]=l+"px";const U=this[t(490)].get(t(639));U[t(639)]=v[t(639)],U[t(569)]=_[t(639)],U[t(555)]=_[t(555)],U[t(611)]=_[t(611)];const k=this[t(523)].get(t(639));k.style[t(639)]=n+"px",k[t(493)][t(555)]=u+"px";const A=this[t(490)][t(610)](t(569));A[t(639)]=_.right,A[t(569)]=v.right,A.top=_[t(555)],A[t(611)]=_.bottom;const T=this[t(523)][t(610)]("right");T.style[t(639)]=c+"px",T[t(493)][t(555)]=u+"px"}[e(557)](t){const i=e;if(!this[i(508)]())return this._allowNewState?i(620):"move";for(const[s,e]of this[i(490)])if((0,r.RB)(e,t[i(654)],t[i(614)]))return s;const s=this._directionalMoveZones[i(610)](i(504)),h=this[i(490)][i(610)](i(499)),o={left:s[i(639)],top:s[i(555)],right:h[i(569)],bottom:h[i(611)]};return(0,r.RB)(o,t[i(654)],t[i(614)])?i(540):this[i(492)]?i(620):i(540)}}},687:(t,i,s)=>{"use strict";const e=a14_0x16b647;s.r(i),s.d(i,{default:()=>g});var h=s(1815),r=s(5120),o=s(7896),n=s(1003),a=s(270),c=s(6173),l=s(9904),p=s(504);class u extends r.JT{constructor(t){const i=a14_0x37f4;super(),this._sc=t,this.id=i(592),this[i(609)]=i(540),this._isFirstMove=!0,this._expandCanvasToSelectionAction=new c.f("Expand Canvas to Selection",i(590),!1),this[i(585)]=[this._expandCanvasToSelectionAction],this[i(532)]=new l.rP(i(494),[i(595),i(553)],"Bilinear"),this[i(534)]=[this._qualityOption],this[i(531)]=this[i(547)](new h.v),this[i(659)]=this[i(531)].event,this._onStateChange=this[i(547)](new h.v),this.onStateChange=this[i(575)][i(497)],this[i(547)](this[i(532)][i(491)]((()=>this._updateQuality()))),this[i(547)](this[i(596)][i(633)].onLayerChange((()=>this[i(545)]()))),this[i(547)](this[i(596)][i(660)][i(530)]((async t=>{const s=i;t[s(648)]&&await this[s(545)]()}))),this[i(547)](this[i(596)][i(554)][i(491)]((()=>{const t=i;this[t(653)](),this._refreshActionEnabledState(),this[t(531)][t(542)]()}))),this[i(547)](this._sc[i(633)][i(488)]((t=>this[i(651)](t)))),this._sc[i(633)][i(619)]?.[i(612)]&&this[i(651)](this[i(596)][i(633)][i(619)].temporaryLayer),this[i(489)]()}[e(651)](t){const i=e;t[i(627)]===i(496)&&(this[i(550)]=t,this[i(547)](this._activeMovingLayer.onHistoryAction((()=>this[i(645)]()))),this.register(this._activeMovingLayer[i(652)]((()=>this[i(607)]()))),this[i(538)]?.[i(533)](!0),this[i(653)](),this[i(489)](),this._onRequestRender.fire())}_refreshLayerSelectionRange(){const t=e;if(!this[t(550)])return;const i=this[t(596)].selectionService[t(604)];i&&this[t(550)][t(560)](i)}[e(489)](){const t=e,i=this[t(596)][t(554)][t(604)],s=!(!i||(0,n.ur)((0,n.DI)(this[t(596)][t(633)][t(587)],this._sc[t(633)][t(576)]),i));this[t(539)][t(650)]=s}[e(645)](){const t=e;this[t(550)]&&this[t(532)].setValueFromHistoryChange(this[t(521)](this[t(550)][t(512)][t(544)]))}[e(495)](){const t=e;this[t(545)](),super[t(495)]()}async pointerDown(t){const i=e;if(this[i(617)]=this[i(596)][i(633)][i(619)],!this[i(617)])return;const s=this[i(596)].selectionService[i(604)]||this[i(596)].imageService[i(603)]();this[i(594)]=!this[i(550)],this[i(622)]=this[i(596)][i(565)][i(661)](t),this[i(598)]=this[i(622)][i(546)](),this._movingLayerOrigin=[s[i(639)],s[i(555)]],await this[i(593)](this._activeLayer,s),this[i(583)]=!1,this[i(561)]=!1,this[i(511)]=this[i(596)][i(554)][i(604)],this[i(609)]!==i(620)&&this[i(511)]&&((this[i(609)]===i(555)||"topleft"===this[i(609)]||"topright"===this[i(609)])&&(this[i(622)][1]=this._originalSelection[i(555)]),(this[i(609)]===i(611)||this[i(609)]===i(630)||this[i(609)]===i(499))&&(this[i(622)][1]=this._originalSelection[i(611)]-1),(this[i(609)]===i(639)||this[i(609)]===i(504)||"bottomleft"===this[i(609)])&&(this._cursorOrigin[0]=this[i(511)][i(639)]),("right"===this[i(609)]||this[i(609)]===i(526)||this.state===i(499))&&(this[i(622)][0]=this[i(511)].right-1))}async pointerUp(t){const i=e;if(!this[i(617)])return;if(!this._activeMovingLayer)return;const s=this[i(550)],h=this[i(594)]?i(646):i(528);this[i(596)][i(501)][i(567)](h,(()=>{const t=i;s[t(616)](),this._sc[t(554)].commit(h)})),this[i(594)]=!1,this[i(510)](t,!1)}[e(510)](t,i){const s=e;if(this[s(538)]&&!i){const i=this._renderer.getPointerState(t);this[s(609)]!==i&&(this[s(609)]=i,this[s(575)][s(542)]())}}[e(656)](t){const i=e;if(!this._activeMovingLayer||!this._cursorOrigin||!this[i(498)])return;if(this[i(598)]=this[i(596)][i(565)][i(661)](t),this[i(609)]===i(540)){const t=this[i(498)][0]+this[i(598)][0]-this._cursorOrigin[0],s=this._movingLayerOrigin[1]+this._cursorCurrent[1]-this[i(622)][1];return void this[i(596)][i(554)].setTopLeft(t,s)}if(!this[i(511)])return;const s=this[i(598)][0]-this._cursorOrigin[0],h=this._cursorCurrent[1]-this._cursorOrigin[1];let r;if(!t[i(514)]||this[i(609)]!==i(504)&&"topright"!==this[i(609)]&&this.state!==i(630)&&this[i(609)]!==i(499))r=(0,n.BN)(this[i(511)]),("top"===this[i(609)]||"topleft"===this[i(609)]||this[i(609)]===i(526))&&(r[i(555)]+=h,r[i(611)]<=r.top&&r[i(555)]++,t[i(582)]&&(r.bottom-=h)),("bottom"===this[i(609)]||"bottomleft"===this[i(609)]||"bottomright"===this[i(609)])&&(r.bottom+=h,r[i(611)]<=r[i(555)]&&r.bottom--,t.altKey&&(r[i(555)]-=h)),(this.state===i(639)||this[i(609)]===i(504)||this.state===i(630))&&(r[i(639)]+=s,r[i(569)]<=r[i(639)]&&r.left++,t[i(582)]&&(r[i(569)]-=s)),("right"===this[i(609)]||this.state===i(526)||this[i(609)]===i(499))&&(r.right+=s,r[i(569)]<=r[i(639)]&&r[i(569)]--,t[i(582)]&&(r[i(639)]-=s));else{const e=(0,n.n3)(this[i(511)]);let o;switch(r=(0,n.BN)(this[i(511)]),this[i(609)]){case i(504):o=(1/e*-s-h)/2,r[i(639)]-=Math[i(588)](o*e),r.top-=Math[i(588)](o),t[i(582)]&&(r[i(569)]+=Math[i(588)](o*e),r.bottom+=Math[i(588)](o));break;case i(526):o=(s*(1/e)-h)/2,r[i(569)]+=Math[i(588)](o*e),r[i(555)]-=Math[i(588)](o),t[i(582)]&&(r[i(639)]-=Math[i(588)](o*e),r[i(611)]+=Math[i(588)](o));break;case"bottomleft":o=(1/e*-s+h)/2,r[i(639)]-=Math[i(588)](o*e),r[i(611)]+=Math.round(o),t[i(582)]&&(r.right+=Math[i(588)](o*e),r[i(555)]-=Math[i(588)](o));break;case"bottomright":o=(s*(1/e)+h)/2,r[i(569)]+=Math.round(o*e),r[i(611)]+=Math[i(588)](o),t[i(582)]&&(r[i(639)]-=Math.round(o*e),r[i(555)]-=Math[i(588)](o))}}const o=this[i(583)];this[i(583)]=r.right<r[i(639)],this[i(583)]!==o&&(this[i(550)][i(512)][i(552)]=!this[i(550)].currentState.flipX);const a=this[i(561)];this._isYFlipping=r[i(611)]<r[i(555)],this[i(561)]!==a&&(this[i(550)][i(512)][i(506)]=!this._activeMovingLayer[i(512)][i(506)]),this[i(596)][i(554)][i(604)]=(0,n.FJ)(r)}async[e(615)](t){const i=e;if(!this[i(617)]&&(this._activeLayer=this[i(596)][i(633)][i(619)]),!this[i(617)])return;if(t[i(507)]!==i(549)&&"ArrowDown"!==t[i(507)]&&t.key!==i(658)&&"ArrowRight"!==t[i(507)])return;const s=this._sc[i(554)].range||this._sc[i(633)].selectAll();if(this[i(594)]=!this[i(550)],this[i(594)]&&await this._startMove(this[i(617)],s),!this[i(550)])throw new Error(i(570));const h=(o.V5?t[i(642)]:t[i(525)])?10:1;switch(t[i(507)]){case"ArrowUp":this[i(596)].selectionService[i(632)](s.left,s[i(555)]-h);break;case i(551):this[i(596)][i(554)].setTopLeft(s.left,s[i(555)]+h);break;case i(658):this[i(596)].selectionService[i(632)](s[i(639)]-h,s.top);break;case"ArrowRight":this[i(596)][i(554)].setTopLeft(s[i(639)]+h,s[i(555)])}this[i(550)][i(616)]()}async[e(593)](t,i){const s=e;if((!this[s(550)]||this[s(550)]!==t.temporaryLayer)&&"moving"===t[s(612)]?.[s(627)]&&(this._activeMovingLayer=t.temporaryLayer),this[s(550)]&&this[s(550)]===t[s(612)])return;t[s(612)]&&await t.temporaryLayer[s(556)](),(0,n.l$)(i,(0,n.DI)(t.width,t[s(576)]));const h=(0,n.Oq)(i),r=(0,n.rY)(i);let o;const c=new Promise((t=>o=t)),l={resource:{width:h,height:r,data:new Uint8Array(new SharedArrayBuffer(h*r*4))},readyPromise:c,isReady:!1},p={image:l,range:i};this._activeMovingLayer=new a.m(t,p,this[s(597)](),this[s(596)].historyService,this[s(596)].selectionService,this._sc[s(636)]),await t.registerTemporaryLayer(this[s(550)]),await t[s(574)]((async(t,e,h)=>{const r=s;return await this[r(596)][r(636)].runTask(r(509),{cutImage:{data:l[r(562)][r(586)],width:l[r(562)][r(587)],height:l[r(562)][r(576)]},cutRange:i,targetImage:{data:t,width:e,height:h}}),i})),o(l.resource),l[s(608)]=!0,t[s(599)][s(542)](i)}async[e(545)](){const t=e,i=this._activeLayer||this[t(596)].imageService[t(619)];if(!i)return;if(!this[t(550)]&&i[t(612)]?.[t(627)]===t(496)&&(this[t(550)]=i[t(612)]),!this[t(550)])return;const s=this._activeMovingLayer;await this[t(596)][t(501)][t(618)](t(589),(async()=>{const e=t;await s.commit(),this[e(596)].selectionService[e(625)](i[e(587)],i[e(576)]),this[e(596)][e(554)][e(556)](e(589))})),this[t(607)]()}[e(607)](){const t=e;this._activeLayer=void 0,this[t(550)]=void 0,this[t(538)]?.[t(533)](!1),this[t(531)][t(542)]()}_updateQuality(){const t=e,i=this[t(597)]();this[t(550)]&&this[t(550)][t(512)].quality!==i&&(this[t(550)][t(512)].quality=i,this[t(550)][t(629)](t(624)),this[t(550)][t(579)]())}_getQualityValue(){const t=e;switch(this[t(532)][t(584)]){case t(595):return t(568);case"Nearest Neighbor":return t(635)}}[e(521)](t){const i=e;switch(t){case"bilinear":return i(595);case i(635):return i(553)}}[e(602)](t){const i=e,s=new(p[i(580)])(t,(()=>this[i(596)].selectionService[i(604)]),!1,this[i(596)].viewportService,this._sc.imageService);return this[i(596)].selectionService[i(491)]((()=>s[i(533)](void 0!==this[i(596)][i(554)][i(604)]))),s[i(533)](void 0!==this._sc[i(554)][i(604)]),this[i(538)]=s,this[i(538)]}}const g=u}}]);