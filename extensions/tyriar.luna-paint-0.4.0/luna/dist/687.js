const a9_0x3288=["imageService","_movingLayerOrigin","bottomright","display","onTemporaryLayerRegistered","validate","selectionService","bottom","Move Pixels","onUpdateEmitter","event","removeChild","triggerRequestRender","_value","move","linearBurn","quality","round","expand-canvas-to-selection","151IanyIl","zoom","range","topright","topleft","Move Selected Pixels","selectAll","_directionalMoveZones","_activeLayer","runTask","keyDown","onStateChange","fire","commit","moveToRange","_refreshLayerSelectionRange","register","name","_imageService","clientWidth","none","_cursorOrigin","_onHistoryUpdateValue","top","moving","set","bottomleft","data","136883DURAAO","Quality","_enabled","_elementContainer","_directionalMoveElements","viewportService","_isCursorDown","_isVisible","string","type","_renderer","order","height","get","exclusion","max","left","3011sfVDbr","options","onLayerChange","onHistoryUnset","Nearest Neighbor","_refreshActionEnabledState","_getQualityString","24818gcJfMZ","_getQualityValue","resource","style","ArrowUp","key","render","pointerDown","14NFORxQ","Finish Selection","normal","471143zuZYiW","clientHeight","appendChild","optionStep","getCoordsFromEvent","temporaryLayer","onHistoryAction","movePixels","right","_onUpdate","_container","onHistoryUpdateValue","createCompositeEntry","3vFrGmT","ctrlKey","_sc","getPointerState","div","_onOptionsChange","Bilinear","pointerMove","onBeforeRunLayerTask","_onStateChange","replace","518385IjZciQ","_isFirstMove","477910UYwslF","offsetY","multiply","_originalSelection","_selectionService","_expandCanvasToSelectionAction","onRequestRender","setValueFromHistoryChange","Set Quality Sampling","move-handle","bilinear","onUpdate","currentState","slice","taskWorkerService","dispose","createElement","darken","ArrowLeft","_startMove","width","state","enabled","ArrowDown","_activeMovingLayer","offsetX","lighten","createDomRenderProgram","moveStep","_onRequestRender","Blend Mode","Expand Canvas to Selection","nearestneighbor","_setupActiveTemporaryLayer","setVisible","overlay","setTopLeft","_cursorCurrent","_qualityOption","webpackChunkluna","_viewportService","difference","_finishSelection","min","linearDodgeAdd","ArrowRight","375502leBWJJ","historyService","edit","isReady","screen","currentLayer","push","value"],a9_0x48b8=function(t,e){return a9_0x3288[t-=316]},a9_0x4d4366=a9_0x48b8;(function(t,e){const i=a9_0x48b8;for(;;)try{if(541114===parseInt(i(326))+-parseInt(i(451))*-parseInt(i(459))+parseInt(i(324))+-parseInt(i(399))*-parseInt(i(444))+-parseInt(i(462))+parseInt(i(427))*-parseInt(i(475))+-parseInt(i(372)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a9_0x3288),(self[a9_0x4d4366(365)]=self.webpackChunkluna||[])[a9_0x4d4366(378)]([[687],{6173:(t,e,i)=>{"use strict";const s=a9_0x4d4366;i.d(e,{f:()=>o});var r=i(1815),n=i(5120);class o extends n.JT{constructor(t,e,i){const s=a9_0x48b8;super(),this.name=t,this[s(436)]=e,this[s(429)]=i,this[s(471)]=this[s(415)](new r.v),this.onUpdate=this[s(471)][s(390)]}get enabled(){return this[a9_0x48b8(429)]}set[s(348)](t){const e=s;this[e(429)]!==t&&(this[e(429)]=t,this._onUpdate[e(411)]())}}},9904:(t,e,i)=>{"use strict";const s=a9_0x4d4366;i.d(e,{rP:()=>o,bG:()=>h,Jp:()=>a,qv:()=>c});var r=i(1815),n=i(5120);class o extends n.JT{constructor(t,e,i){const s=a9_0x48b8;super(),this.name=t,this[s(445)]=e,this[s(393)]=i,this[s(436)]=s(435),this[s(421)]=this[s(415)](new r.v),this.onHistoryUpdateValue=this[s(421)][s(390)],this[s(471)]=this[s(415)](new r.v),this[s(337)]=this[s(471)][s(390)]}get value(){return this[a9_0x48b8(393)]}set[s(379)](t){const e=s;this._value=t,this[e(471)][e(411)]()}[s(333)](t){const e=s;this[e(393)]=t,this[e(421)][e(411)](t)}}class h extends o{constructor(){const t=s;super(t(356),[t(461),t(343),t(328),t(395),t(352),t(376),t(370),"overlay","softLight",t(367),t(441)],t(461))}}class a extends o{constructor(){const t=s;super(t(356),["normal",t(323),t(343),t(328),t(395),"lighten","screen",t(370),t(361),"softLight",t(367),t(441)],t(461))}}class c extends n.JT{constructor(t,e,i,n){const o=s;super(),this[o(416)]=t,this._value=e,this.min=i,this[o(442)]=n,this[o(436)]="number",this._onHistoryUpdateValue=this.register(new r.v),this[o(473)]=this[o(421)][o(390)],this[o(471)]=this[o(415)](new r.v),this.onUpdate=this[o(471)][o(390)]}get[s(379)](){return this._value}set value(t){const e=s;this[e(393)]=t,this._onUpdate[e(411)]()}[s(333)](t){const e=s;this[e(393)]=t,this[e(421)][e(411)](t)}}},687:(t,e,i)=>{"use strict";const s=a9_0x4d4366;i.r(e),i.d(e,{default:()=>v});var r=i(1815),n=i(7896),o=i(5120),h=i(1003),a=i(270),c=i(6173),l=i(9904);class u extends o.JT{constructor(t){const e=a9_0x48b8;super(),this[e(477)]=t,this.id=e(469),this[e(347)]=e(394),this[e(325)]=!0,this[e(433)]=!1,this._expandCanvasToSelectionAction=new c.f(e(357),e(398),!1),this.actions=[this[e(331)]],this._qualityOption=new l.rP(e(428),[e(319),"Nearest Neighbor"],e(319)),this.options=[this[e(364)]],this[e(355)]=this[e(415)](new r.v),this[e(332)]=this._onRequestRender.event,this[e(322)]=this.register(new r.v),this[e(410)]=this[e(322)][e(390)],this[e(415)](this[e(364)].onUpdate((()=>this._updateQuality()))),this.register(this[e(477)][e(380)][e(446)]((()=>this[e(368)]()))),this[e(415)](this[e(477)].taskService[e(321)]((t=>{t.finishSelection&&this._finishSelection()}))),this.register(this[e(477)][e(386)][e(337)]((()=>{const t=e;this._refreshLayerSelectionRange(),this[t(449)](),this._onRequestRender[t(411)]()}))),this[e(415)](this[e(477)].imageService[e(384)]((t=>this[e(359)](t)))),this[e(477)].imageService[e(377)]?.[e(467)]&&this[e(359)](this[e(477)][e(380)][e(377)][e(467)])}[s(359)](t){const e=s;"moving"===t[e(436)]&&(this._activeMovingLayer=t,this[e(415)](this[e(350)][e(468)]((()=>this[e(318)]()))),this[e(415)](this[e(350)][e(447)]((()=>this._clearMovingLayer()))),this[e(437)]?.[e(360)](!0),this[e(414)](),this[e(449)](),this._onRequestRender[e(411)]())}[s(414)](){const t=s;if(!this[t(350)])return;const e=this._sc[t(386)][t(401)];e&&this[t(350)][t(413)](e)}[s(449)](){const t=s,e=this[t(477)][t(386)][t(401)],i=!(!e||(0,h.ur)((0,h.DI)(this._sc[t(380)][t(346)],this._sc[t(380)][t(439)]),e));this._expandCanvasToSelectionAction.enabled=i}[s(318)](){const t=s;this._activeMovingLayer&&this[t(364)].setValueFromHistoryChange(this[t(450)](this[t(350)][t(338)][t(396)]))}[s(341)](){this[s(368)](),super.dispose()}async[s(458)](t){const e=s;if(this[e(433)]=!0,this._activeLayer=this._sc[e(380)][e(377)],!this[e(407)])return;let i=this[e(477)][e(386)][e(401)];!i&&(this[e(477)][e(386)][e(405)](),i=this[e(477)][e(386)][e(401)]),this[e(325)]=!this[e(350)],this[e(420)]=this[e(477)][e(432)][e(466)](t),this._cursorCurrent=this[e(420)][e(339)](),this[e(381)]=[i[e(443)],i[e(422)]],await this._startMove(this._activeLayer,i),this[e(329)]=this[e(477)].selectionService[e(401)]}async pointerUp(){const t=s;if(this[t(433)]=!1,!this._activeLayer)return;if(!this[t(350)])return;const e=this[t(350)],i=this[t(325)]?t(404):t(388);await this[t(477)][t(373)][t(474)](i,(()=>{const s=t;e.moveStep(),this._sc[s(386)].commit(i)})),this[t(325)]=!1}[s(320)](t){const e=s;if(this[e(437)]&&!this._isCursorDown){const i=this[e(437)][e(316)](t);this[e(347)]!==i&&(this.state=i,this[e(322)][e(411)]())}}pointerDownMove(t){const e=s;if(!this[e(350)]||!this._cursorOrigin||!this[e(381)])return;if(this[e(363)]=this[e(477)].viewportService[e(466)](t),this[e(347)]===e(394)){const t=this._movingLayerOrigin[0]+this[e(363)][0]-this[e(420)][0],i=this._movingLayerOrigin[1]+this[e(363)][1]-this._cursorOrigin[1];return void this._sc.selectionService.setTopLeft(t,i)}if(!this._originalSelection)return;const i=this[e(363)][0]-this[e(420)][0],r=this._cursorCurrent[1]-this[e(420)][1],n=(0,h.BN)(this[e(329)]);switch(this[e(347)]){case e(403):n[e(443)]+=i,n[e(422)]+=r;break;case e(402):n[e(470)]+=i,n.top+=r;break;case e(425):n[e(443)]+=i,n.bottom+=r;break;case e(382):n.right+=i,n[e(387)]+=r;break;case"top":n[e(422)]+=r;break;case e(387):n.bottom+=r;break;case"left":n[e(443)]+=i;break;case"right":n[e(470)]+=i}this[e(477)][e(386)][e(401)]=(0,h.FJ)(n)}async[s(409)](t){const e=s;if(!this[e(407)]&&(this[e(407)]=this[e(477)][e(380)][e(377)]),!this._activeLayer)return;if(t[e(456)]!==e(455)&&t[e(456)]!==e(349)&&t[e(456)]!==e(344)&&t[e(456)]!==e(371))return;let i=this[e(477)].selectionService[e(401)];if(!i&&(this[e(477)][e(386)][e(405)](),i=this[e(477)][e(386)].range),this._isFirstMove=!this._activeMovingLayer,this[e(325)]&&await this._startMove(this[e(407)],i),!this._activeMovingLayer)throw new Error("No moving layer");const r=(n.V?t.metaKey:t[e(476)])?10:1;switch(t[e(456)]){case e(455):this[e(477)].selectionService[e(362)](i[e(443)],i[e(422)]-r);break;case"ArrowDown":this[e(477)].selectionService.setTopLeft(i.left,i[e(422)]+r);break;case"ArrowLeft":this._sc[e(386)][e(362)](i[e(443)]-r,i.top);break;case e(371):this[e(477)][e(386)][e(362)](i[e(443)]+r,i[e(422)])}this[e(350)][e(354)]()}async[s(345)](t,e){const i=s;if((!this._activeMovingLayer||this[i(350)]!==t[i(467)])&&t[i(467)]?.[i(436)]===i(423)&&(this[i(350)]=t[i(467)]),this[i(350)]&&this[i(350)]===t.temporaryLayer)return;t[i(467)]&&await t[i(467)].commit(this[i(477)][i(386)][i(401)]),(0,h.l$)(e,(0,h.DI)(t.width,t[i(439)]));const r=e.right-e[i(443)],n=e[i(387)]-e[i(422)];let o;const c=new Promise((t=>o=t)),l={resource:{width:r,height:n,data:new Uint8Array(new SharedArrayBuffer(r*n*4))},readyPromise:c,isReady:!1};this[i(350)]=new a.m(t,l,e,this._getQualityValue(),this._sc[i(373)],this._sc[i(340)]),await t.registerTemporaryLayer(this[i(350)]),await t[i(374)]((async(t,s,r)=>{const n=i;return await this[n(477)][n(340)][n(408)]("cutImage",{cutImage:{data:l[n(453)][n(426)],width:l.resource[n(346)],height:l.resource[n(439)]},cutRange:e,targetImage:{data:t,width:s,height:r}}),e})),o(l[i(453)]),l[i(375)]=!0,t[i(389)][i(411)](e)}async[s(368)](){const t=s,e=this[t(407)]||this._sc[t(380)][t(377)];if(!e)return;if(!this[t(350)]&&e.temporaryLayer?.[t(436)]===t(423)&&(this._activeMovingLayer=e.temporaryLayer),!this[t(350)])return;const i=this[t(350)];await this[t(477)][t(373)][t(474)](t(460),(async()=>{const s=t;await i[s(412)](),this._sc[s(386)][s(385)](e[s(346)],e[s(439)]),this[s(477)].selectionService[s(412)](s(460))})),this._clearMovingLayer()}_clearMovingLayer(){const t=s;this[t(407)]=void 0,this[t(350)]=void 0,this[t(437)]?.[t(360)](!1),this[t(355)][t(411)]()}_updateQuality(){const t=s,e=this[t(452)]();this._activeMovingLayer&&this[t(350)].currentState[t(396)]!==e&&(this[t(350)][t(338)].quality=e,this._activeMovingLayer[t(465)](t(334)),this._activeMovingLayer[t(392)]())}[s(452)](){const t=s;switch(this[t(364)][t(379)]){case"Bilinear":return t(336);case"Nearest Neighbor":return"nearestneighbor"}}_getQualityString(t){const e=s;switch(t){case e(336):return e(319);case e(358):return e(448)}}[s(353)](t){const e=s;return this._renderer=new _(t,this[e(477)][e(386)],this[e(477)][e(432)],this[e(477)][e(380)]),this[e(437)]}}const v=u;class _ extends o.JT{constructor(t,e,i,r){const n=s;super(),this[n(472)]=t,this[n(330)]=e,this[n(366)]=i,this[n(417)]=r,this[n(438)]=2,this[n(431)]=new Map,this._directionalMoveZones=new Map,this._isVisible=!0,this[n(430)]=document[n(342)](n(317));const o=[n(403),n(402),n(425),n(382),n(422),n(387),"left",n(470)];for(const t of o){const e=document[n(342)](n(317));e.classList.add(n(335)),this[n(430)][n(464)](e),this[n(431)][n(424)](t,e),this[n(406)][n(424)](t,(0,h.Pq)())}this._container.appendChild(this[n(430)]),this[n(415)]({dispose:()=>{const t=n;this._container[t(391)](this[t(430)])}}),this[n(330)][n(337)]((()=>this[n(360)](void 0!==this[n(330)][n(401)]))),this.setVisible(void 0!==this._selectionService[n(401)])}[s(360)](t){const e=s;t!==this[e(434)]&&(this[e(430)][e(454)][e(383)]=t?"":e(419),this[e(434)]=t)}[s(457)](){const t=s,e=this[t(330)][t(401)];if(!e)return;const i=this[t(417)][t(377)];if(!i)return;const r=this[t(366)],n=Math[t(397)](this[t(472)][t(418)]/2)-i.width/2*r.zoom,o=Math[t(397)](this._container[t(463)]/2)-i[t(439)]/2*r[t(400)],h=n+(r.x+e[t(443)])*r[t(400)],a=o+(r.y+e[t(422)])*r.zoom,c=n+(r.x+e[t(470)])*r[t(400)],l=o+(r.y+e[t(387)])*r[t(400)],u=Math[t(397)]((h+c)/2),v=Math.round((a+l)/2),_=10*window.devicePixelRatio,p={left:Math[t(369)](h+_,Math.max(h,u-_)),top:Math[t(369)](a+_,Math[t(442)](a,v-_)),right:Math[t(442)](c-_,Math.min(c,u+_)),bottom:Math.max(l-_,Math[t(369)](l,v+_))},d={left:h-_,top:a-_,right:c+_,bottom:l+_},g=this._directionalMoveZones[t(440)]("topleft");g[t(443)]=d[t(443)],g[t(470)]=p[t(443)],g.top=d[t(422)],g[t(387)]=p.top;const y=this[t(431)][t(440)](t(403));y[t(454)][t(443)]=h+"px",y.style[t(422)]=a+"px";const m=this[t(406)][t(440)](t(402));m[t(443)]=p[t(470)],m.right=d[t(470)],m[t(422)]=d[t(422)],m[t(387)]=p[t(422)];const f=this[t(431)][t(440)]("topright");f[t(454)][t(443)]=c+"px",f[t(454)][t(422)]=a+"px";const w=this[t(406)][t(440)](t(425));w[t(443)]=d.left,w.right=p[t(443)],w[t(422)]=p[t(387)],w[t(387)]=d.bottom;const x=this[t(431)][t(440)]("bottomleft");x[t(454)].left=h+"px",x.style.top=l+"px";const b=this._directionalMoveZones[t(440)](t(382));b[t(443)]=p[t(470)],b.right=d[t(470)],b[t(422)]=p[t(387)],b[t(387)]=d.bottom;const M=this[t(431)][t(440)](t(382));M[t(454)][t(443)]=c+"px",M[t(454)][t(422)]=l+"px";const S=this[t(406)].get(t(422));S[t(443)]=p[t(443)],S[t(470)]=p[t(470)],S[t(422)]=d.top,S.bottom=p[t(422)];const L=this[t(431)][t(440)](t(422));L[t(454)][t(443)]=u+"px",L.style[t(422)]=a+"px";const R=this[t(406)].get(t(387));R[t(443)]=p.left,R[t(470)]=p.right,R[t(422)]=p.bottom,R[t(387)]=d.bottom;const k=this._directionalMoveElements[t(440)](t(387));k[t(454)][t(443)]=u+"px",k.style[t(422)]=l+"px";const C=this[t(406)].get("left");C[t(443)]=d[t(443)],C[t(470)]=p[t(443)],C[t(422)]=p[t(422)],C[t(387)]=p[t(387)];const A=this._directionalMoveElements[t(440)]("left");A[t(454)][t(443)]=h+"px",A[t(454)][t(422)]=v+"px";const I=this._directionalMoveZones[t(440)](t(470));I[t(443)]=p.right,I[t(470)]=d[t(470)],I[t(422)]=p[t(422)],I[t(387)]=p[t(387)];const T=this[t(431)][t(440)]("right");T[t(454)][t(443)]=c+"px",T[t(454)][t(422)]=v+"px"}[s(316)](t){const e=s;for(const[i,s]of this._directionalMoveZones)if(p(s,t[e(351)],t[e(327)]))return i;return"move"}}function p(t,e,i){const r=s;return e>=t[r(443)]&&e<t.right&&i>=t.top&&i<t[r(387)]}}}]);