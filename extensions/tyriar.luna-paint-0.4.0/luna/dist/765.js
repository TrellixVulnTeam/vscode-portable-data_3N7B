const a9_0x3239=["validate","45wwIUKY","style","value","commit","webpackChunkluna","ArrowUp","_isCursorDown","imageService","expand-canvas-to-selection","getCoordsFromEvent","move","zoom","string","max","bottomleft","onHistoryAction","_selectionService","_movingLayerOrigin","right","selectionService","add","enabled","_elementContainer","edit","_qualityOption","historyService","offsetX","isReady","linearBurn","_getQualityValue","onStateChange","_refreshLayerSelectionRange","round","difference","Bilinear","Finish Selection","_directionalMoveElements","setTopLeft","state","ArrowDown","name","setVisible","_onHistoryUpdateValue","removeChild","_updateQuality","_activeLayer","data","_finishSelection","set","viewportService","ArrowLeft","linearDodgeAdd","get","moving","order","_renderer","onUpdate","exclusion","currentLayer","No moving layer","overlay","Quality","Blend Mode","_onOptionsChange","_getQualityString","bilinear","Nearest Neighbor","createCompositeEntry","width","_onRequestRender","lighten","options","push","8976gesUxV","_refreshExpandCanvasToSelectionEnabled","resource","temporaryLayer","div","bottom","795640VnmyRN","6959MZXKXz","1HdYUYL","_value","Move Selected Pixels","cutImage","fire","7255JFzERz","darken","keyDown","clientWidth","417442OHmiFj","selectAll","onHistoryUpdateValue","_isVisible","key","normal","moveToRange","left","dispose","topright","triggerRequestRender","offsetY","_startMove","Move Pixels","render","_container","_onUpdate","setValueFromHistoryChange","_activeMovingLayer","createElement","event","taskWorkerService","_sc","_imageService","quality","createDomRenderProgram","optionStep","onLayerChange","min","clientHeight","_setupActiveTemporaryLayer","_cursorOrigin","_clearMovingLayer","_expandCanvasToSelectionAction","topleft","onBeforeRunLayerTask","multiply","taskService","classList","19ReGSIi","bottomright","pointerDown","none","_directionalMoveZones","movePixels","register","Set Quality Sampling","getPointerState","_onStateChange","metaKey","height","ArrowRight","346469rLMpRK","49857Tikmvi","move-handle","_viewportService","screen","type","11vXrbpv","top","_enabled","onTemporaryLayerRegistered","_cursorCurrent","_originalSelection","_isFirstMove","pointerUp","onUpdateEmitter","currentState","range","Expand Canvas to Selection"],a9_0x594f=function(t,e){return a9_0x3239[t-=270]},a9_0x801f4a=a9_0x594f;(function(t,e){const s=a9_0x594f;for(;;)try{if(313468===-parseInt(s(362))*-parseInt(s(411))+-parseInt(s(372))*-parseInt(s(363))+parseInt(s(425))*parseInt(s(430))+parseInt(s(424))+-parseInt(s(355))+parseInt(s(368))*-parseInt(s(282))+-parseInt(s(361)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a9_0x3239),(self[a9_0x801f4a(286)]=self[a9_0x801f4a(286)]||[])[a9_0x801f4a(354)]([[765],{9904:(t,e,s)=>{"use strict";const i=a9_0x801f4a;s.d(e,{rP:()=>o,bG:()=>h,Jp:()=>a,qv:()=>c});var r=s(1815),n=s(5120);class o extends n.JT{constructor(t,e,s){const i=a9_0x594f;super(),this[i(322)]=t,this[i(353)]=e,this[i(364)]=s,this.type=i(294),this[i(324)]=this.register(new r.v),this[i(374)]=this[i(324)][i(392)],this._onUpdate=this[i(417)](new r.v),this[i(338)]=this[i(388)][i(392)]}get[i(284)](){return this[i(364)]}set[i(284)](t){const e=i;this[e(364)]=t,this[e(388)][e(367)]()}[i(389)](t){this[i(364)]=t,this._onHistoryUpdateValue.fire(t)}}class h extends o{constructor(){const t=i;super(t(344),[t(377),t(369),t(408),"linearBurn",t(352),t(428),t(333),t(342),"softLight",t(315),t(339)],t(377))}}class a extends o{constructor(){const t=i;super("Blend Mode",["normal","replace",t(369),t(408),t(310),"lighten",t(428),t(333),t(342),"softLight",t(315),t(339)],t(377))}}class c extends n.JT{constructor(t,e,s,n){const o=i;super(),this.name=t,this[o(364)]=e,this.min=s,this[o(295)]=n,this[o(429)]="number",this._onHistoryUpdateValue=this[o(417)](new r.v),this[o(374)]=this._onHistoryUpdateValue[o(392)],this._onUpdate=this.register(new r.v),this.onUpdate=this[o(388)][o(392)]}get value(){return this[i(364)]}set value(t){const e=i;this[e(364)]=t,this[e(388)][e(367)]()}[i(389)](t){const e=i;this[e(364)]=t,this[e(324)][e(367)](t)}}},6765:(t,e,s)=>{"use strict";const i=a9_0x801f4a;s.r(e),s.d(e,{default:()=>u});var r=s(1815),n=s(7896),o=s(5120),h=s(1003),a=s(270);class c extends o.JT{constructor(t,e,s){const i=a9_0x594f;super(),this[i(322)]=t,this.type=e,this._enabled=s,this[i(388)]=this.register(new r.v),this[i(338)]=this[i(388)][i(392)]}get[i(303)](){return this[i(271)]}set[i(303)](t){const e=i;this._enabled!==t&&(this[e(271)]=t,this[e(388)].fire())}}var l=s(9904);class p extends o.JT{constructor(t){const e=i;super(),this[e(394)]=t,this.id=e(416),this[e(320)]=e(292),this[e(275)]=!0,this._isCursorDown=!1,this[e(405)]=new c(e(280),e(290),!1),this.actions=[this[e(405)]],this[e(306)]=new l.rP(e(343),[e(316),e(348)],e(316)),this[e(353)]=[this[e(306)]],this[e(351)]=this[e(417)](new r.v),this.onRequestRender=this._onRequestRender.event,this[e(420)]=this.register(new r.v),this[e(312)]=this._onStateChange.event,this[e(417)](this[e(306)][e(338)]((()=>this[e(326)]()))),this.register(this._sc[e(289)][e(399)]((()=>this[e(329)]()))),this.register(this[e(394)][e(409)][e(407)]((t=>{const s=e;t.finishSelection&&this[s(329)]()}))),this[e(417)](this._sc.selectionService.onUpdate((()=>{const t=e;this[t(313)](),this[t(356)](),this[t(351)][t(367)]()}))),this[e(417)](this[e(394)][e(289)][e(272)]((t=>this._setupActiveTemporaryLayer(t)))),this[e(394)][e(289)][e(340)]?.temporaryLayer&&this[e(402)](this[e(394)].imageService.currentLayer[e(358)])}[i(402)](t){const e=i;t.type===e(335)&&(this[e(390)]=t,this[e(417)](this[e(390)][e(297)]((()=>this[e(345)]()))),this[e(417)](this[e(390)].onHistoryUnset((()=>this[e(404)]()))),this[e(337)]?.setVisible(!0),this._refreshLayerSelectionRange(),this._refreshExpandCanvasToSelectionEnabled(),this._onRequestRender[e(367)]())}[i(313)](){const t=i;if(!this[t(390)])return;const e=this[t(394)][t(301)][t(279)];e&&this._activeMovingLayer[t(378)](e)}[i(356)](){const t=i,e=this._sc.selectionService[t(279)],s=!(!e||(0,h.ur)((0,h.DI)(this[t(394)][t(289)][t(350)],this._sc[t(289)][t(422)]),e));this[t(405)].enabled=s}[i(345)](){const t=i;this[t(390)]&&this[t(306)][t(389)](this[t(346)](this._activeMovingLayer[t(278)].quality))}[i(380)](){const t=i;this._finishSelection(),super[t(380)]()}async[i(413)](t){const e=i;if(this[e(288)]=!0,this[e(327)]=this[e(394)][e(289)][e(340)],!this[e(327)])return;let s=this._sc.selectionService.range;!s&&(this[e(394)][e(301)].selectAll(),s=this[e(394)][e(301)][e(279)]),this[e(275)]=!this[e(390)],this[e(403)]=this[e(394)][e(331)][e(291)](t),this._cursorCurrent=this[e(403)].slice(),this[e(299)]=[s[e(379)],s[e(270)]],await this[e(384)](this[e(327)],s),this._originalSelection=this._sc[e(301)][e(279)]}async[i(276)](){const t=i;if(this[t(288)]=!1,!this._activeLayer)return;if(!this._activeMovingLayer)return;const e=this._activeMovingLayer,s=this._isFirstMove?t(365):t(385);await this[t(394)].historyService[t(349)](s,(()=>{const i=t;e.moveStep(),this[i(394)][i(301)].commit(s)})),this[t(275)]=!1}pointerMove(t){const e=i;if(this[e(337)]&&!this[e(288)]){const s=this[e(337)][e(419)](t);this[e(320)]!==s&&(this.state=s,this[e(420)][e(367)]())}}pointerDownMove(t){const e=i;if(!this._activeMovingLayer||!this[e(403)]||!this[e(299)])return;if(this._cursorCurrent=this[e(394)].viewportService[e(291)](t),this[e(320)]===e(292)){const t=this[e(299)][0]+this[e(273)][0]-this[e(403)][0],s=this[e(299)][1]+this._cursorCurrent[1]-this[e(403)][1];return void this[e(394)][e(301)][e(319)](t,s)}if(!this[e(274)])return;const s=this[e(273)][0]-this[e(403)][0],r=this._cursorCurrent[1]-this[e(403)][1],n=(0,h.BN)(this[e(274)]);switch(this.state){case"topleft":n.left+=s,n[e(270)]+=r;break;case e(381):n[e(300)]+=s,n.top+=r;break;case e(296):n[e(379)]+=s,n.bottom+=r;break;case e(412):n.right+=s,n[e(360)]+=r;break;case"top":n[e(270)]+=r;break;case e(360):n[e(360)]+=r;break;case e(379):n[e(379)]+=s;break;case e(300):n[e(300)]+=s}this._sc[e(301)][e(279)]=(0,h.FJ)(n)}async[i(370)](t){const e=i;if(!this[e(327)]&&(this[e(327)]=this[e(394)].imageService[e(340)]),!this[e(327)])return;if(t[e(376)]!==e(287)&&t.key!==e(321)&&t.key!==e(332)&&t[e(376)]!==e(423))return;let s=this[e(394)][e(301)][e(279)];if(!s&&(this[e(394)][e(301)][e(373)](),s=this[e(394)][e(301)][e(279)]),this[e(275)]=!this[e(390)],this[e(275)]&&await this[e(384)](this[e(327)],s),!this[e(390)])throw new Error(e(341));const r=(n.V?t[e(421)]:t.ctrlKey)?10:1;switch(t.key){case"ArrowUp":this[e(394)].selectionService.setTopLeft(s[e(379)],s[e(270)]-r);break;case e(321):this[e(394)][e(301)][e(319)](s[e(379)],s[e(270)]+r);break;case e(332):this[e(394)][e(301)].setTopLeft(s.left-r,s[e(270)]);break;case e(423):this[e(394)][e(301)].setTopLeft(s[e(379)]+r,s.top)}}async[i(384)](t,e){const s=i;if((!this._activeMovingLayer||this[s(390)]!==t[s(358)])&&t[s(358)]?.[s(429)]===s(335)&&(this[s(390)]=t[s(358)]),this[s(390)]&&this[s(390)]===t.temporaryLayer)return;t[s(358)]&&await t[s(358)].commit(this[s(394)].selectionService[s(279)]),(0,h.l$)(e,(0,h.DI)(t[s(350)],t.height));const r=e[s(300)]-e[s(379)],n=e[s(360)]-e[s(270)];let o;const c=new Promise((t=>o=t)),l={resource:{width:r,height:n,data:new Uint8Array(new SharedArrayBuffer(r*n*4))},readyPromise:c,isReady:!1};this[s(390)]=new a.m(t,l,e,this._getQualityValue(),this[s(394)].historyService,this[s(394)].taskWorkerService),await t.registerTemporaryLayer(this._activeMovingLayer),await t[s(305)]((async(t,i,r)=>{const n=s;return await this._sc[n(393)].runTask(n(366),{cutImage:{data:l[n(357)][n(328)],width:l[n(357)][n(350)],height:l[n(357)][n(422)]},cutRange:e,targetImage:{data:t,width:i,height:r}}),e})),o(l.resource),l[s(309)]=!0,t[s(277)][s(367)](e)}async[i(329)](){const t=i,e=this[t(327)]||this._sc[t(289)][t(340)];if(!e)return;if(!this._activeMovingLayer&&e.temporaryLayer?.type===t(335)&&(this._activeMovingLayer=e.temporaryLayer),!this._activeMovingLayer)return;const s=this[t(390)];await this._sc[t(307)][t(349)](t(317),(async()=>{const i=t;await s[i(285)](),this[i(394)][i(301)][i(281)](e.width,e[i(422)]),this[i(394)][i(301)][i(285)](i(317))})),this[t(404)]()}[i(404)](){const t=i;this[t(327)]=void 0,this._activeMovingLayer=void 0,this[t(337)]?.[t(323)](!1),this[t(351)][t(367)]()}[i(326)](){const t=i,e=this[t(311)]();this[t(390)]&&this[t(390)].currentState[t(396)]!==e&&(this[t(390)].currentState[t(396)]=e,this._activeMovingLayer[t(398)](t(418)),this[t(390)][t(382)]())}[i(311)](){const t=i;switch(this[t(306)][t(284)]){case"Bilinear":return t(347);case t(348):return"nearestneighbor"}}[i(346)](t){const e=i;switch(t){case"bilinear":return e(316);case"nearestneighbor":return e(348)}}[i(397)](t){const e=i;return this._renderer=new v(t,this[e(394)][e(301)],this._sc[e(331)],this[e(394)].imageService),this[e(337)]}}const u=p;class v extends o.JT{constructor(t,e,s,r){const n=i;super(),this[n(387)]=t,this._selectionService=e,this[n(427)]=s,this[n(395)]=r,this[n(336)]=2,this[n(318)]=new Map,this[n(415)]=new Map,this[n(375)]=!0,this[n(304)]=document[n(391)]("div");const o=[n(406),n(381),n(296),"bottomright",n(270),n(360),n(379),n(300)];for(const t of o){const e=document[n(391)](n(359));e[n(410)][n(302)](n(426)),this[n(304)].appendChild(e),this._directionalMoveElements[n(330)](t,e),this[n(415)][n(330)](t,(0,h.Pq)())}this[n(387)].appendChild(this[n(304)]),this[n(417)]({dispose:()=>{const t=n;this[t(387)][t(325)](this[t(304)])}}),this._selectionService.onUpdate((()=>this[n(323)](void 0!==this[n(298)][n(279)]))),this[n(323)](void 0!==this._selectionService.range)}[i(323)](t){const e=i;t!==this[e(375)]&&(this[e(304)][e(283)].display=t?"":e(414),this[e(375)]=t)}[i(386)](){const t=i,e=this[t(298)][t(279)];if(!e)return;const s=this[t(395)][t(340)];if(!s)return;const r=this[t(427)],n=Math[t(314)](this[t(387)][t(371)]/2)-s[t(350)]/2*r[t(293)],o=Math[t(314)](this._container[t(401)]/2)-s[t(422)]/2*r[t(293)],h=n+(r.x+e[t(379)])*r[t(293)],a=o+(r.y+e[t(270)])*r[t(293)],c=n+(r.x+e[t(300)])*r.zoom,l=o+(r.y+e[t(360)])*r.zoom,p=Math[t(314)]((h+c)/2),u=Math[t(314)]((a+l)/2),v=10*window.devicePixelRatio,d={left:Math[t(400)](h+v,Math[t(295)](h,p-v)),top:Math[t(400)](a+v,Math.max(a,u-v)),right:Math[t(295)](c-v,Math[t(400)](c,p+v)),bottom:Math[t(295)](l-v,Math[t(400)](l,u+v))},_={left:h-v,top:a-v,right:c+v,bottom:l+v},g=this[t(415)].get(t(406));g[t(379)]=_[t(379)],g[t(300)]=d[t(379)],g[t(270)]=_[t(270)],g[t(360)]=d[t(270)];const y=this[t(318)][t(334)](t(406));y.style[t(379)]=h+"px",y[t(283)][t(270)]=a+"px";const f=this[t(415)][t(334)]("topright");f[t(379)]=d[t(300)],f[t(300)]=_[t(300)],f.top=_[t(270)],f[t(360)]=d[t(270)];const m=this[t(318)].get(t(381));m[t(283)][t(379)]=c+"px",m[t(283)][t(270)]=a+"px";const w=this[t(415)][t(334)]("bottomleft");w[t(379)]=_[t(379)],w.right=d[t(379)],w[t(270)]=d[t(360)],w[t(360)]=_[t(360)];const x=this[t(318)].get("bottomleft");x.style[t(379)]=h+"px",x[t(283)][t(270)]=l+"px";const S=this[t(415)].get(t(412));S[t(379)]=d[t(300)],S[t(300)]=_[t(300)],S[t(270)]=d.bottom,S.bottom=_[t(360)];const M=this._directionalMoveElements[t(334)]("bottomright");M[t(283)].left=c+"px",M[t(283)][t(270)]=l+"px";const b=this[t(415)].get(t(270));b[t(379)]=d.left,b[t(300)]=d[t(300)],b[t(270)]=_.top,b.bottom=d[t(270)];const L=this[t(318)][t(334)](t(270));L[t(283)][t(379)]=p+"px",L[t(283)][t(270)]=a+"px";const k=this[t(415)].get(t(360));k[t(379)]=d[t(379)],k[t(300)]=d[t(300)],k.top=d[t(360)],k[t(360)]=_[t(360)];const R=this[t(318)][t(334)](t(360));R[t(283)][t(379)]=p+"px",R[t(283)][t(270)]=l+"px";const C=this[t(415)].get(t(379));C[t(379)]=_.left,C[t(300)]=d[t(379)],C[t(270)]=d[t(270)],C[t(360)]=d[t(360)];const U=this[t(318)][t(334)](t(379));U.style[t(379)]=h+"px",U[t(283)][t(270)]=u+"px";const T=this[t(415)][t(334)](t(300));T.left=d[t(300)],T[t(300)]=_[t(300)],T[t(270)]=d.top,T[t(360)]=d[t(360)];const I=this[t(318)][t(334)]("right");I[t(283)].left=c+"px",I[t(283)][t(270)]=u+"px"}[i(419)](t){const e=i;for(const[s,i]of this._directionalMoveZones)if(d(i,t[e(308)],t[e(383)]))return s;return e(292)}}function d(t,e,s){const r=i;return e>=t[r(379)]&&e<t[r(300)]&&s>=t[r(270)]&&s<t[r(360)]}}}]);