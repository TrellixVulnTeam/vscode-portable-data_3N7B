const a11_0xdaca=["render","staticState","screen","shiftKey","left","_finish","getCoordsFromEvent","range","4xYuGDy","5359sGpwIu","triggerRequestRender","_styleOption","darken","set","classList","replace","primaryColor","historyService","round","setVisible","min","zoom","bottomleft","right","_directionalMoveElements","paletteService","offsetX","type","register","linearBurn","offsetY","options","div","createElement","createDomRenderProgram","Fill and outline","onStateChange","13XlCVrq","_rectLayer","onUpdate","registerTemporaryLayer","currentLayer","227QTwoTS","secondary","value","_isCursorDown","softLight","_createRange","Blend Mode","_blendModeOption","multiply","move","state","rectLayer","max","onBeforeRunLayerTask","dispose","54063jArMHM","keyUp","_cursorOriginalRectangle","1123ZxsTPO","width","_cursorOrigin","pointerUp","secondaryColor","get","commit","_rectangleOtherPoint","_onRequestRender","_rectangleOrigin","_isPrimaryPointerActive","sign","linearDodgeAdd","_getStyleValue","top","300367dARcon","_outlineSizeOption","_updateBlendMode","clientHeight","new","31BelWEn","pointerDown","_container","onLayerChange","_elementContainer","appendChild","height","_updateStyle","viewportService","pointerDownMove","push","Outline Size","exclusion","_updateRectangle","330678wvgzHE","_sc","Style","_value","primary","1451UENZsH","keyDown","_cursorCurrent","rectangle","lighten","string","event","Outline","_directionalMoveZones","clientWidth","blendMode","devicePixelRatio","_imageService","_updateColors","topright","topleft","fire","bottom","move-handle","_viewportService","name","style","getColorSetFromPointerEvent","_onStateChange","1413yxFPaz","none","bottomright","1HHHbmg","overlay","removeChild","buttons","normal","imageService","display","webpackChunkluna","_updateOutlineSize","difference","_onUpdate","log","onCommit","_renderer","Fill","_isVisible","abs"],a11_0x230e=function(t,e){return a11_0xdaca[t-=107]},a11_0x2654ea=a11_0x230e;(function(t,e){const s=a11_0x230e;for(;;)try{if(237235===-parseInt(s(231))*-parseInt(s(230))-parseInt(s(136))+-parseInt(s(116))*-parseInt(s(139))+-parseInt(s(178))*-parseInt(s(121))+parseInt(s(173))*-parseInt(s(205))+-parseInt(s(159))*parseInt(s(202))+parseInt(s(154)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a11_0xdaca),(self[a11_0x2654ea(212)]=self[a11_0x2654ea(212)]||[])[a11_0x2654ea(169)]([[440],{9904:(t,e,s)=>{"use strict";const i=a11_0x2654ea;s.d(e,{rP:()=>h,bG:()=>o,Jp:()=>a});var r=s(1815),n=s(5120);class h extends n.JT{constructor(t,e,s){const i=a11_0x230e;super(),this[i(198)]=t,this[i(110)]=e,this._value=s,this[i(249)]=i(183),this._onUpdate=this[i(107)](new r.v),this[i(118)]=this[i(215)][i(184)]}get[i(123)](){return this[i(176)]}set[i(123)](t){const e=i;this[e(176)]=t,this._onUpdate[e(194)]()}}class o extends h{constructor(){const t=i;super(t(127),[t(209),t(234),t(129),t(108),t(182),t(224),t(151),t(206),t(125),t(214),t(171)],"normal")}}class a extends h{constructor(){const t=i;super(t(127),["normal",t(237),"darken",t(129),"linearBurn",t(182),t(224),t(151),t(206),t(125),t(214),t(171)],t(209))}}},7440:(t,e,s)=>{"use strict";const i=a11_0x2654ea;s.r(e),s.d(e,{default:()=>l});var r=s(1815),n=s(5120),h=s(1003),o=s(807),a=s(9904);class c extends n.JT{constructor(t){const e=a11_0x230e;super(),this[e(174)]=t,this.id=e(181),this[e(149)]=!0,this[e(124)]=!1,this[e(131)]="move",this[e(128)]=new a.bG,this._styleOption=new a.rP(e(175),[e(185),"Fill",e(114)],"Outline"),this[e(155)]=new a.rP(e(170),["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],"1"),this[e(110)]=[this._blendModeOption,this[e(233)],this[e(155)]],this[e(147)]=this[e(107)](new r.v),this.onRequestRender=this[e(147)][e(184)],this[e(201)]=this[e(107)](new r.v),this[e(115)]=this[e(201)][e(184)],this[e(107)](this[e(174)][e(247)][e(118)]((()=>this[e(191)]()))),this[e(107)](this[e(233)].onUpdate((()=>this[e(166)]()))),this[e(107)](this[e(155)][e(118)]((()=>this[e(213)]()))),this[e(107)](this._blendModeOption[e(118)]((()=>this[e(156)]()))),this.register(this[e(174)].imageService[e(162)]((()=>this._finish()))),this[e(107)](this[e(174)].taskService[e(134)]((()=>this._finish()))),this[e(107)]({dispose:()=>this[e(227)]()})}[i(179)](t){this[i(172)](t)}[i(137)](t){this[i(172)](t)}async[i(160)](t){const e=i;this[e(124)]=!0;const s=this[e(174)][e(210)][e(120)];if(!s)return;this[e(149)]=!!(1&t[e(208)]);const r=this._sc[e(247)][e(200)](t),n=this[e(174)][e(167)][e(228)](t);if(this[e(141)]=n,this._cursorCurrent=n,!n)return;if(this[e(131)]!==e(158))return void(this._cursorOriginalRectangle=(0,h.BN)(this[e(117)]?.[e(223)][e(229)]));await this[e(227)](),this[e(148)]=n,this._rectangleOtherPoint=n;const a=this[e(126)](this[e(148)],this[e(146)]);this[e(138)]=(0,h.BN)(a),this[e(117)]=new o.F(s,this[e(128)][e(123)],parseInt(this[e(155)][e(123)]),this._getStyleValue(),r[0],r[1],a,this._sc[e(239)],this[e(174)].taskWorkerService),this._rectLayer[e(217)]((()=>this._clearRectLayer())),this[e(218)]&&(this[e(218)][e(132)]=this[e(117)]),await s[e(119)](this[e(117)]),this[e(218)]?.[e(241)](!1),this._rectLayer[e(232)]()}[i(142)](t){const e=i;this[e(124)]=!1,this[e(218)]?.[e(241)](!0)}[i(168)](t){const e=i;if(!(this[e(148)]&&this[e(146)]&&this[e(141)]&&this[e(138)]))return;if(!this[e(174)][e(210)][e(120)])return;const s=this[e(174)][e(167)][e(228)](t);if(this[e(180)]=s,s[0]===this[e(146)][0]&&s[1]===this[e(146)][1])return;if(!this[e(117)])return;const r=this._cursorCurrent[0]-this._cursorOrigin[0],n=this[e(180)][1]-this._cursorOrigin[1];switch(this[e(131)]){case e(158):return this[e(146)]=s,void this[e(172)](t);case e(130):{const t=(0,h.BN)(this[e(138)]);t[e(226)]+=r,t[e(153)]+=n,t[e(245)]+=r,t[e(195)]+=n,(0,h.FJ)(t),this[e(117)][e(223)].range=t;break}default:{const t=(0,h.BN)(this._cursorOriginalRectangle);(this[e(131)]===e(153)||this[e(131)]===e(193)||this[e(131)]===e(192))&&(t[e(153)]+=n),("bottom"===this[e(131)]||this[e(131)]===e(244)||this.state===e(204))&&(t[e(195)]+=n),(this.state===e(226)||this[e(131)]===e(193)||this[e(131)]===e(244))&&(t[e(226)]+=r),(this.state===e(245)||this[e(131)]===e(192)||"bottomright"===this.state)&&(t[e(245)]+=r),(0,h.FJ)(t),this[e(117)].staticState[e(229)]=t;break}}this[e(117)][e(232)]()}pointerMove(t){const e=i;if(this[e(218)]&&!this[e(124)]){const s=this._renderer.getPointerState(t);this[e(131)]!==s&&(this[e(131)]=s,this[e(201)].fire())}}[i(172)](t){const e=i;if(!(this._rectLayer&&this[e(148)]&&this._rectangleOtherPoint&&this._isCursorDown))return;let s=this[e(148)][0]-this._rectangleOtherPoint[0],r=this[e(148)][1]-this[e(146)][1];t[e(225)]&&(Math[e(221)](s)>Math.abs(r)?s=r*(Math.sign(s)!==Math[e(150)](r)?-1:1):r=s*(Math[e(150)](s)!==Math[e(150)](r)?-1:1)),this[e(117)][e(223)][e(229)]=this[e(126)](this[e(148)],[this[e(148)][0]-s,this[e(148)][1]-r]),this._rectLayer[e(232)]()}_updateColors(){const t=i;this[t(117)]&&(this[t(149)]?(this[t(117)][t(223)][t(238)]=this._sc.paletteService.primary,this[t(117)][t(223)].secondaryColor=this[t(174)][t(247)].secondary):(this._rectLayer[t(223)][t(238)]=this[t(174)].paletteService[t(122)],this[t(117)].staticState[t(143)]=this._sc[t(247)][t(177)]),this[t(117)].triggerRequestRender())}[i(166)](){const t=i;this[t(117)]&&(this[t(117)][t(223)][t(199)]=this._getStyleValue(),this[t(117)][t(232)]())}[i(152)](){const t=i;switch(this[t(233)][t(123)]){case t(185):return 1;case t(219):return 2;case"Fill and outline":return 3}}[i(213)](){const t=i;this._rectLayer&&(this[t(117)][t(223)].outlineSize=parseInt(this._outlineSizeOption.value),this[t(117)][t(232)]())}[i(156)](){const t=i;this._rectLayer&&(this[t(117)][t(223)][t(188)]=this[t(128)][t(123)],this[t(117)][t(232)]())}async _finish(){const t=i;await(this._rectLayer?.[t(145)]()),this._clearRectLayer()}_clearRectLayer(){const t=i;this[t(117)]?.[t(135)](),this[t(117)]=void 0,this._renderer&&(this[t(218)][t(132)]=void 0),this[t(138)]=void 0,this[t(218)]?.[t(241)](!1)}[i(126)](t,e){return(0,h.tH)(t[0],t[1],e[0],e[1])}[i(113)](t){const e=i;return this._renderer=new p(t,this[e(117)],this[e(174)][e(167)],this._sc.imageService),this[e(218)]}}const l=c;class p extends n.JT{constructor(t,e,s,r){const n=i;super(),this[n(161)]=t,this[n(132)]=e,this[n(197)]=s,this[n(190)]=r,this.order=2,this[n(246)]=new Map,this[n(186)]=new Map,this[n(220)]=!0,this._elementContainer=document[n(112)](n(111));const o=[n(193),n(192),n(244),"bottomright","top",n(195),n(226),n(245)];for(const t of o){const e=document[n(112)](n(111));e[n(236)].add(n(196)),this._elementContainer[n(164)](e),this._directionalMoveElements[n(235)](t,e),this[n(186)].set(t,(0,h.Pq)())}this._container[n(164)](this[n(163)]),this[n(107)]({dispose:()=>{const t=n;this._container[t(207)](this[t(163)])}})}[i(241)](t){const e=i;t!==this[e(220)]&&(this[e(163)][e(199)][e(211)]=t?"":e(203),this._isVisible=t)}[i(222)](){const t=i;if(console[t(216)]("render"),!this[t(132)])return;const e=this[t(132)][t(223)].range,s=this._imageService[t(120)];if(!s)return;const r=this[t(197)],n=Math[t(240)](this[t(161)][t(187)]/2)-s[t(140)]/2*r[t(243)],h=Math[t(240)](this._container[t(157)]/2)-s[t(165)]/2*r[t(243)],o=n+(r.x+e[t(226)])*r[t(243)],a=h+(r.y+e[t(153)])*r[t(243)],c=n+(r.x+e[t(245)])*r[t(243)],l=h+(r.y+e[t(195)])*r[t(243)],p=Math[t(240)]((o+c)/2),_=Math[t(240)]((a+l)/2),u=10*window[t(189)],d={left:Math[t(242)](o+u,Math[t(133)](o,p-u)),top:Math[t(242)](a+u,Math.max(a,_-u)),right:Math[t(133)](c-u,Math[t(242)](c,p+u)),bottom:Math.max(l-u,Math.min(l,_+u))},g={left:o-u,top:a-u,right:c+u,bottom:l+u},f=this._directionalMoveZones[t(144)]("topleft");f[t(226)]=g[t(226)],f[t(245)]=d.left,f[t(153)]=g.top,f[t(195)]=d[t(153)];const m=this._directionalMoveElements[t(144)](t(193));m[t(199)][t(226)]=o+"px",m[t(199)].top=a+"px";const y=this[t(186)][t(144)](t(192));y[t(226)]=d.right,y.right=g[t(245)],y[t(153)]=g.top,y[t(195)]=d[t(153)];const v=this[t(246)][t(144)](t(192));v[t(199)][t(226)]=c+"px",v[t(199)].top=a+"px";const x=this[t(186)][t(144)](t(244));x[t(226)]=g.left,x[t(245)]=d[t(226)],x[t(153)]=d[t(195)],x[t(195)]=g[t(195)];const M=this[t(246)][t(144)](t(244));M[t(199)].left=o+"px",M[t(199)].top=l+"px";const S=this[t(186)][t(144)](t(204));S.left=d[t(245)],S[t(245)]=g[t(245)],S.top=d[t(195)],S[t(195)]=g[t(195)];const b=this._directionalMoveElements[t(144)](t(204));b[t(199)][t(226)]=c+"px",b.style[t(153)]=l+"px";const w=this[t(186)][t(144)](t(153));w.left=d[t(226)],w[t(245)]=d[t(245)],w[t(153)]=g[t(153)],w.bottom=d[t(153)];const C=this[t(246)][t(144)](t(153));C[t(199)][t(226)]=p+"px",C.style[t(153)]=a+"px";const O=this[t(186)].get(t(195));O[t(226)]=d.left,O[t(245)]=d.right,O[t(153)]=d[t(195)],O.bottom=g[t(195)];const R=this[t(246)][t(144)]("bottom");R[t(199)][t(226)]=p+"px",R[t(199)][t(153)]=l+"px";const L=this[t(186)].get(t(226));L.left=g[t(226)],L[t(245)]=d[t(226)],L[t(153)]=d[t(153)],L[t(195)]=d.bottom;const P=this[t(246)][t(144)]("left");P.style[t(226)]=o+"px",P[t(199)].top=_+"px";const I=this[t(186)][t(144)](t(245));I[t(226)]=d.right,I[t(245)]=g.right,I.top=d[t(153)],I[t(195)]=d[t(195)];const k=this._directionalMoveElements[t(144)](t(245));k.style[t(226)]=c+"px",k[t(199)].top=_+"px"}getPointerState(t){const e=i;if(!this[e(132)])return e(158);for(const[s,i]of this[e(186)])if(_(i,t[e(248)],t.offsetY))return s;const s=this._directionalMoveZones.get("topleft"),r=this[e(186)].get("bottomright");return _({left:s[e(226)],top:s.top,right:r[e(245)],bottom:r[e(195)]},t[e(248)],t[e(109)])?e(130):e(158)}}function _(t,e,s){const r=i;return e>=t.left&&e<t[r(245)]&&s>=t[r(153)]&&s<t[r(195)]}}}]);