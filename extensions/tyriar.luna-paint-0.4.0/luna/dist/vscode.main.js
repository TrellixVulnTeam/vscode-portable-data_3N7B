const a2_0x23b8=["createDocumentFragment","bindFramebuffer","image.flipVertical","Toggle History Window","_updatePalette","createElement","aria-label","onPointerDownMove","setAttribute","_deleteLayerByIndex","moveLayerToBottom","cmdctrl+x","toggle","_setHorizontalLine","classList","Go to Layer Below","initialState","_positionBuffer","onPointerDown","_instantiationService","split","Gets the color of the nearest pixel.","image-dimensions","_pointerCoord","quality","Layer","redoData","restoreHistory","DYNAMIC_DRAW"," pixels tall","zoomOut","undo","_layerTexturesUniformLocation","clientHeight","renderLayer","label","_setActiveItem","nameSpan","SRC_ALPHA","Hard edges","acquireVsCodeApi","activeTool","onKeyUp","_activeItems","a_texcoord","missing",", 1.) < 1. / ","getCoordsFromEvent","11801yZlOsu","Toggle Palette Window","_onDispose","onTemporaryLayerRegistered","_deleteCurrentLayer","getRightItems","_rehydrateExtHostMessage","_renderer","assign","Cannot restore state from previous version (","_onRequestRender","_queueUpdate","importScripts","_render","_toolElements","layer.goToLayerAbove",".css","contains","visibleCheckbox","455402wisfWy","refresh","writeText","_channelToHex","_activeRequests","sqrt","extName","Toggle Bottom Status Bar View","head","ContextKeyService","_commands","order","ms ","currentLayer","function","_updateRenderLayerTiles","_matrixNeedsUpdate","_frameBuffer","zoom",", right: ","finishMovePixels","precision mediump float;uniform vec4 c;void main(){gl_FragColor=c;}","onBeforeRunLayerTask","attribute vec4 a_position;attribute vec2 a_texcoord;uniform mat4 a;uniform vec2 b;varying vec2 v_texcoord;void main(){gl_Position=a*(a_position*vec4(b,0.,1.));v_texcoord=a_texcoord;}","image.rotate90Clockwise","getParameter","framebufferTexture2D","Rotate 90° Clockwise","_onPointerDownMove","all","static","_attach","swap","Invert Colors","tagName","_blendModeOptions","terminate","onDidRemoveBottomItem","Buffer","linearDodgeAdd","layer.flipHorizontal","_generatePreview","_layerListElement","span","enable","blur","Finish Rectangle Pixels","Trying to get visible viewport range before element is attached","_outOfFrameScroll","importBlob","vscode-menu","_createListItemElement","composite","moveLayerDown","serialize","layer/invertColors","data-active-tool","Windows","_onImagesChange","_attachedDisposables","uniform1f","SharedArrayBuffer","TEXTURE_MAG_FILTER","_rangeNotYetRequested","_progressLast","registerStateHandler","_createView","_container","requestOptions","onStateChange","_targetIndex","Move Layer to Top","name","forEach","_multiplyZoom","pixel-grid","tiles","message","images","_updateProgress","WebGL context loss, please reload the tab","History entry type "," x ","exportBlob","_resize","ctrl+0","currentValue","onPixelGridEnabledChange",'Job dimension not found for task "',"validate","visible","layer/cropToSelection","onToolChange","enableVertexAttribArray","Hex:","exportBlobClone","join","blendMode","_tolerance","window","replace","texImage2D","#version 300 es\nlayout(location=0)in vec4 A;out vec2 v_texcoord;void main(){gl_Position=A;v_texcoord=(A.xy+1.)/2.;}","_isAnimating","palette","position","u_shift","has","RENDERBUFFER","activeImageSetIndex","metaKey","permissions","COMPILE_STATUS","__param","_eventInViewport","Win16","_options","mutableRange","Command Palette","fire","u_matrix","_redoData","bindVertexArray","webpackChunkluna","resume","abs","framebufferRenderbuffer","negateEnabled","getElementsByTagName","actions","_forceSelectionAnimation","ctrl+j","NYI","toString","dispatchEvent","list","hotExitMaxPixels","OffscreenCanvas","activeEntry","erase","Space","state","chunk-","_matrixLocation","moveLayerToTop","view.focusCanvas","image/png","_gl","bottomStatusBar","isStretchEnabled","_onCommit","saveAs",'Cannot run command "',"refreshTheme","Toggle Pixel Grid","image-entry","pointerup","_uniformValueZoom","newLayer","focusin","CommandService","_onRedo","_textureAUniformLocation","Command","from","DEPTH_STENCIL_ATTACHMENT","vscode.setContext","setActiveImage","Unrecognized blend mode","observe","pointerout","defaultVisible","_onTemporaryLayerRegistered","pointerdown","_checkLayerSupport","_forwardEventToTool","[createInstance] First service dependency of ","layer/rotate180","clearEntries","textureImage","_animationRenderPrograms","openImages","_onPointerDown","layer.toggleLayersWindow","multiLayer","_createButton","resource","ctrlKey","scrollTop","layer.deleteLayer",'" failed: ',"_startEdit","getInfo","useProgram",") {\n    outColor = vec4(0.2, 0.2, 0.2, .2);\n  }\n}","INPUT","onDispose","triggerHistoryAction"," has already been registered","containsCoord",";\n}","_onProgress","onKeyDown","luna-icon","hidden","temporaryLayers","MAX_TEXTURE_IMAGE_UNITS","scaledWidth","Resampling not selected","minimap-viewport","setLayerVisibility","disposables","_taskWorkerService","deserialize","finishTemporaryLayer","color-box","redoImage","topleft","navigator.clipboard.write not supported","_uniformValueBlendModes","type","file.saveAs","Bottom right","tool.fill","83NVWPYP","_redoDimensions","_sliderGradientElement","body","_goToRelativeLayer"," y=","--vscode-foreground","layer-new","Top","offsetWidth","values","updateWorkbenchState","vscode.toggleMenuBar","match","History","push","setTool","_onLayerVisibilityChange","padStart","_program","includes","Access to clipboard-read was denied","LINE_LOOP","transform","_renderPrograms","backup","_renderProgramsWithOrder","then","Cannot undo readonly entry","_onKeyUp","currentState","TEXTURE_WRAP_S","_onShowViewportChange","_action","selection.selectAll","_texcoordBuffer","RGBA","hasImage","reduce","_update","layer.goToTopLayer","scrollHeight","requiresTool","attach","_createWorker","start","_serializeCompositeEntry","view.fitToWindow","_lunaService","Delete the active layer","image.cropToSelection","arrayBuffer","isAutoSaveEnabled","luna:","Cannot add readonly entry to composite entry",".js","_isPixelGridEnabled","layerId","onRequestTool","location","cmd+shift+z","deltaX","New Image","WinCE","TEXTURE_2D","The primary color's hex value in the format rrggbb. When changing, rgb will be expanded to rrggbb.","50%","_position","_messageHandler","_primaryColorDiv","document","_clickOrigin","_event","insertBefore","merge","alt+pageup","_onZoomChange","_fillRange","Cannot delete the last layer","clear","currentScript","_normalizeWheelDelta","finishRectangle","_width","_renderImages","_getBeforeRunLayerTaskEvent","MODULE_NOT_FOUND","vscode.main","warn","preview","_info","toggleView","imageResize","_contextKeys","insertAdjacentElement","clientWidth","requestAnimationFrame","_shiftValue","Height not selected","target","firstChild","layerIndexList","[createInstance] ","_getFrameBufferTexture","207256FGMYqy","deleteRenderbuffer"," pixels wide by ","element","_onToolChange","_imageDimensionsUniformLocation","_onUndo","FRAGMENT_SHADER","_renderLayers","#version 300 es\nprecision mediump float;\n\nuniform float ","visibleRange","_getImageCoordsFromEvent","_activeTemporaryLayers","_onKeyDown","display","_viewportService","_clipspaceToCanvasCoordsMatrix","colorMask","TEXTURE0","layer/resize","_createToggle","ctrl+shift+p","number","src","set","Palette","Toggle Layers Window","ctrl+shift+s","_scrollVelocity","Top right",", top: ","Image: ","_leftItemsElement","options","onPointerUp","pointerMove","Eraser","_onStateChange","UNSIGNED_BYTE","onPointerCoordChange","onChange","_frameBufferRenderBuffer"," window","register","_layersModel","right","cmd-palette-list","releasePointerCapture","setColors","getColorSetFromPointerEvent",'Could not find non-existent command "',"hex","_supportsLayers","_updateUniformValueMatrix","getCommand","_currentEntryPointer","Rotate 180°","getService","startLayer","image","createDomRenderProgram","_queueProgress"," static arguments"," - ","open","linearBurn","_canvasSelection","getUniformLocation","restoreImage","disabled","Run Command: ","_nullTexture","minimap.toggleShowViewport","title","image.finishActiveAction","in-viewport","_updateAttributeBuffers","absolute","_resetHexInput","Unknown","createRenderbuffer","_inputElement","webgl2","Hide","visibleViews","tempLayerId","Minimap","TaskService","alt+pagedown","scaledHeight","renderbufferStorage","luna-icon-before","onCommit","MacIntel","Cannot finish temporary layer without at least 1 step","deleteLayer","onImagesChange","rightItems","Layers are not supported for this image type","round","grabbed","_onChangedDimensions","range","dimensions","_imageIdCounter","offsetTop","_imageCanvasRenderProgram"," failed.\n(","fill","TRIANGLE_STRIP","Import Blob"," depends on UNKNOWN service ","outlineSize","percent","layer/flipVertical","rgba-input-","workbenchState","createVertexArray","canRedo","199277bZqygO","onLastListenerRemove","ctrl+h","stopImmediatePropagation","offsetHeight","readonly","file","toUpperCase","Set Paste Image Selection","isReadonly","_onEntriesChange","slider","CLAMP_TO_EDGE","_activeTool","redoBlendMode","redo","New Layer","Show","[invokeFunction] unknown service '","_screenPixelToCanvasCoord","onDimensionsChange","topright","left","_frameBufferTextures","uniform4f","_apply","onShowViewportChange","ctrl+alt+pageup","_blendModeUniformLocation","run","image.resize","pointer-coords","normal","top",".ico","item","_defaultValue","clearColor","serialize function does not exist on history entry","secondaryColor","#gui","_onLayerChange","Move Layer Down"," * a_position;\n  v_position = a_position.xy;\n}","ctrl+shift+r","palette.togglePaletteWindow","_workMatrices","renderSelection","_onDidRemoveTopItem","Rotate 90° Counter Clockwise","eraseRange","_onRequestTool","undoData","Close ","Erase Selection","add","_contentElement","_restoreEntry","luna:focused","_entryHandlers","_pointCount","Toggle Top Status Bar View","onerror","_parent","string","_luna","linear-gradient(180deg, ","_isVisible","208076AqkmwL","_onDidChangeVisibilityEmitter","get","_createLayer","nextSibling","_onAttach","decorate","luna:textFocused","stencilOp","Deselect","_openImages","vertexAttribPointer","_positionArray","getImageData","_onPointerCoordChange","_zoom","window.toggleTopStatusBarView","shaderSource","Crop to Selection","Undoing temporary layer step without initial step state event","Unrecognized array type","3sVcTme","setOption","container","file.new","middle","_lastAnimationFrame","_canvasDimensionsUniformLocation","for","setBlendMode","bindRenderbuffer","view.togglePixelGrid","moveLayer","_onDimensionsChange","tool.colorPicker","tool.movePixels","Uint16Array","code","#version 300 es\nprecision mediump float;uniform int a;uniform sampler2D b;uniform sampler2D c;in vec2 v_texcoord;out vec4 A;vec3 B(vec4 C,vec4 D,vec3 E){float a=C.a*D.a;return(C.a-a)*C.rgb+(D.a-a)*D.rgb+a*E;}vec4 F(vec4 C,vec4 D,int G){if(D.a==0.){return C;}if(C.a==0.){return D;}vec3 H;if(G==1){H=D.rgb;}else if(G==3){H=vec3(min(C.r,D.r),min(C.g,D.g),min(C.b,D.b));}else if(G==4){H=C.rgb*D.rgb;}else if(G==6){H=max(C.rgb+D.rgb-1.,0.);}else if(G==8){H=vec3(max(C.r,D.r),max(C.g,D.g),max(C.b,D.b));}else if(G==9){H=vec3(1.-(1.-C.r)*(1.-D.r),1.-(1.-C.g)*(1.-D.g),1.-(1.-C.b)*(1.-D.b));}else if(G==11){H=min(C.rgb+D.rgb,vec3(1.));}else if(G==13){H=vec3(C.r<.5?(2.*C.r*D.r):(1.-2.*(1.-C.r)*(1.-D.r)),C.g<.5?(2.*C.g*D.g):(1.-2.*(1.-C.g)*(1.-D.g)),C.b<.5?(2.*C.b*D.b):(1.-2.*(1.-C.b)*(1.-D.b)));}else if(G==14){H=vec3(D.r<.5?(2.*C.r*D.r+C.r*C.r*(1.-2.*D.r)):(sqrt(C.r)*(2.*D.r-1.)+2.*C.r*(1.-D.r)),D.g<.5?(2.*C.g*D.g+C.g*C.g*(1.-2.*D.g)):(sqrt(C.g)*(2.*D.g-1.)+2.*C.g*(1.-D.g)),D.b<.5?(2.*C.b*D.b+C.b*C.b*(1.-2.*D.b)):(sqrt(C.b)*(2.*D.b-1.)+2.*C.b*(1.-D.b)));}else if(G==20){H=abs(C.rgb-D.rgb);}else if(G==21){H=C.rgb+D.rgb-2.*C.rgb*D.rgb;}float I=D.a+C.a*(1.-D.a);return vec4(B(C,D,H)/I,I);}void main(){vec4 J=texture(b,v_texcoord);vec4 K=texture(c,v_texcoord);A=F(J,K,a);}","TRIANGLE_FAN","pause","255","_onmessage","slice","_reportProgress","createItem","onDidAddTopItem","Could not serialize layers","buttons","KEEP","_primary","selectAll","image.flattenLayers","ctrl+d","_getIndexFromId","setTopLeft","MinimapService","utf-8","replacedImage","_loadModule","Failed to serialize history","Move Selected Pixels","BLEND","goToLayerAbove","size"," conflicts with ","getRanges","Image","TRIANGLES","_updateAttributeBuffersForLayer","onDidAddBottomItem","_addItem","uniformMatrix4fv","image.rotate90CounterClockwise","progress","channel","_requestToolIfNeeded","undoImage","_calculateScrollVelocity","_viewportUpdate",'", ignoring',"active","hardwareConcurrency","info","_doExecuteOnLayer","edit.cut","_createBlendModeSelect","_refreshToolState","canSerialize","_blendShader","request","runSyncAction","webglcontextlost","_lastCommittedRange","createShader","_taskService","_onDidAddBottomItem","_currentCompositeEntry","background","destRange","ArrowDown","ranges","Options for task ","_getCanvasBounds","format","flattenLayers","activeTexture","_updateShiftUniform","leftItems","TEXTURE_WRAP_T","Invalid range - left: ","restoreState","Nearest neighbor","targetIndex","focus","layer.mergeLayerDown","_colorUniformLocation","_selectionService","_replacedImage","pow","Flip Vertical","tabIndex","substr","_layerBlendModesUniformLocation","rgba(","optionStep","Go to Layer Above","getTemporaryLayerById","close","_extHostRequestHandlers","_redoBlendMode","_matrixUniformLocation","Win32","postMessage","now","create","_secondaryColorDiv","undoRange","_backgroundColor","onPointerMove","value","types","COLOR_BUFFER_BIT","Actual Size","runCommand","_isDisposed","querySelector","canvas","Select All","_renderSelection","read","filterCommands","prototype","data-webpack","className","layerReplace","_updateColorViaSlider","onHistoryUpdateValue","_redoImage","_handlePointerUp","COLOR_ATTACHMENT0","_destRange","_frameBufferUniformLocation","Image exceeded maximum pixel count allowed (","removeChild","zoomIn","@IServiceName-decorator can only be used to decorate a parameter","_ctx","ChunkLoadError","_rangeBuffer","Toggle Minimap Window","registerHistoryEntryHandler","ctrl+y","moving","fitToWindow","pointermove","_onPointerUp","_imageListElement","_updateBottomLayer","textContent","_addOption","adjustRectangle","_tempLayer","miniCssF","staticState","scaledImageQuality","default","min","texParameteri","_startTime","img","edit.paste"," * a_position;\n}","onLayerVisibilityChange","u_pixelsize","object","_rightItemsElement","toLowerCase","_selectionAnimationFrame","_imageService","onHistoryAction","bindTexture","header","selection-topleft","_height","layer/expandCanvasToSelection","showViewport","addEventListener","_isSoftDeleted","ceil","putRange","linear-gradient(180deg, rgba(","_fillCommands","index","moveSelection","_forwardLayerEvents","_hexInputElement","serviceBrand","_isRestoringState","status-bar-item-","_toolRenderPrograms","openIco","alignment","Edit","radio","Status Bar","initialIndex","_parentLayer","createProgram","disconnect","rgba","toStringTag","_onHistoryUnset","_channelInputs","Enter","toBlob","palette.swapColors","keydown","_finish","subarray","onStretchEnabledChange",'" already exists',"Cannot set the active layer to undefined","Automatic publicPath is not supported in this browser","_listItemElements","pointerId","_onUpdate","linkProgram","destImage","setPixel","uniform1i","resolve","undoBlendMode","initial","loaded","defineProperty","Open Image","_sanitizeValue","WebGL2 is not supported","stepState",'Cannot find factory for history entry id "',"bind","NEAREST","pop","commit","_onDidRemoveBottomItem","unknown","_historyService","_updateMatrixUniform","FRAMEBUFFER","createExtendedEdit","STATIC_DRAW","onAttach","_validate","undoHandler","drawArrays","isPointerDown","_updatePreviewIfNeeded","_imageListItems","remove","_elementService","_inputService","_vscodeApi","_onPixelGridEnabledChange","registerTemporaryLayer","_entryFactories","entries","_sc","onStartAnimating","factory","Merge Layer Down","Move Pixels","expand-canvas-to-selection","no-text","load","_previewCache","tool.selection","_progress","getContext","buffer","luna.executeCommand","Update Selection","Draw Rectangle","checked","u_color","_colorToHex","tools","image.rotate180","uniform2f","colorData","_showViewport","ctrl+shift+delete","Move Layer Up","_secondary","deselect","workbench.action.quickOpen","Canvas Size","_handleWheel","deleteTexture","_onBeforeRunLayerTask"," Layer","tool.toggleMoveTool","_onWheel","FLOAT","uniform1iv","_onDidAddTopItem","_timeout","getAttribLocation","ArrowLeft","_viewportElement","getAttribute","exclusion","STENCIL_TEST","setActiveLayer","_canvas","_selection","call","_layerListItems","style","nonce","onRequestRender","history-list","section","change","tool.pencil","exportImageClone","window.toggleBottomStatusBarView","__esModule","_undoData","difference","clearRect","parentLayerId","anchor","_positionsNeedsUpdate","tool","_createPaletteButton","_positionsArray","minimap.toggleStretch","_commandService","Merge the active layer down","reset","_getJobDimension","return this","offsetY","Zoom","write","dataType","setProperty","slider-tab","currentEntry","Cannot redo readonly entry","executeOnAllLayers","updateAnimation","catch","isSoftDeleted","_color","scaledImage","platform","onEntriesChange","isPixelGridEnabled","startsWith","Bottom left","_logProgress","_getNonSoftDeletedLayerCount","ctrl+alt+pagedown","_viewportOrigin","layer/rotate90CounterClockwise","getComputedStyle","onProgress","shiftKey","_model","attachShader","view.zoomOut","_channelIndex","pointerUp","layer/rotate90Clockwise","KeybindingService","selectionStart","_listeners","createImageBitmap","isArray","createInstance","_name",") / 4., 2.));\n  outColor = vec4(c, c, c, 1);\n}","_pointCache","onLayerChangeEmitter","mouseleft","deltaY","moveLayerUp","StateService","_animationFrame","requestRender","unregister","Bottom","_itemDisposables","readyPromise","simple","blendColorAtRange","No current layer","setVisible","padEnd","div","setService","multiply","_windowVisibleContextKey","_operationName","length","Enter the width of the image","_views","layer","redoHandler","createFramebuffer","ARRAY_BUFFER","view","history","createTexture","Toggle small images between actual size and stretching to fit the minimap dimensions","previousSibling","button","Toggle Show Viewport","Cut","extHostRequestId","max","saveState","color-overlay","isVisible","keys","delete","generateLayerPreview","redoDimensions","tool.rectangle","onUpdateEmitter","REPLACE","Menu","bottomright","dest","_headerContentElement","File","fireAndWait","isSelectionTool","selected","onload","task.worker.worker.js","compileShader",") 100%)","exports","applyCommit","_zoomLocation","click","onSoftDeletedChange","tool.eraser",'Response received without request "',"crop-to-selection","onStopAnimating","Go to Top Layer","drawRectangle","_createColorInfo","ctrl+s","view.actualSize","singleLayer","_progressTimeout","onZoomChange","imageSet","Layer ","wheel","triggerHistoryUnset","_handlePointerDownMove","blendFunc","bilinear",") 0%, rgba(","boolean","goToLayerBelow","getOwnPropertyDescriptor","_stateService","_target","--vscode-editor-background","Cannot merge the bottom layer down","Paste","edit.copy","_createMinimapImageBounds","height","_entries","screen","complete","_minimapService","webviewRequestId","contextmenu","_onStretchEnabledChange","_elementResizeObserver","_services","_handlePointerMove","_blendMode","currentTemporaryLayerId","di$target","resize","Merge","Layer Blend Mode: ","key","adjustMovePixels","primary","edit.undo","_vertexArrayObject","right-items","triggerRequestRender","dispose","Create a new layer","canUndo",",1)","_colorLocation","Toggle Stretch","color","_replacedRange","Cannot add composite entry to composite entry","onLayerChange","_scrollInterval","_onVisibilityChange","Selection","ctor","addEntry","Zoom level is ","Toggle Move Tool",") in vec4 a_position;\n\nuniform mat4 ","runTask","stencilFunc","_rectangleShader","pixelCount","_initialIndex","Tools","getAll","ctrl+b","image.expandCanvasToSelection","invertColors","movePixels","removeAttribute","_cachedMovingLayer","animation","parentNode","_range","bottom","width","_onHistoryAction","layer.moveLayerToBottom","rectangle","_showError","Rotate 90° Counter-Clockwise","_openBlob","Move the active layer down","_isPaused","Resize",'Could not find non-existent static view "',"select","_blendWithframeBufferUniformLocation","data","Layers","filter","blendFuncSeparate","none","Toggle Images Window","ALWAYS","data-tool-state","viewport","Move Layer to Bottom","ArrowUp","Show All Commands","overlay","_data","commandId","Tool",'State handler for id "',"appendChild","imageSmoothingEnabled","#bottom","charset","edit.redo","input","secondary","moveToRange","_viewportPosition","_startAnimatingProgram","newImage","task","topStatusBar","contentRect","_shiftLocation","202471hplmth","getColorFromPointerEvent","_renderService","bindBuffer","Rotate 180","_viewsElement","Finish Rectangle","previewCanvas","Fill","ctrl+g","clipboard-read","createRenderProgram","History entry factory ","_removeItem"," at position ","Undo","parentElement","onmessage","activeLayer","left-items","_ipcService","STENCIL_BUFFER_BIT","FileService","_layerCountUniformLocation","runAction","selectionEnd","layer.addNewLayer","image.toggleImagesWindow","onWheel","Finish Active Action","encodeOptions","IpcService","_statusBarService","script","onFirstListenerAdd","mergeLayerDown","goToBottomLayer","getRange","createCompositeEntry",";\n\nvoid main() {\n  gl_Position = ","_undoImage","disable","__decorate","--vscode-list-activeSelectionForeground","_imageLayerIdCounter","_renderTileSet","onDidRemoveTopItem","disableWorkers","offsetX","precision mediump float;varying vec2 v_texcoord;uniform int h;uniform int k;uniform vec2 d;uniform vec2 f;uniform vec2 g;uniform int m;uniform vec2 l;uniform int c[7];uniform sampler2D j[7];uniform sampler2D n;vec3 A(vec4 B,vec4 C,vec3 D){float E=B.a*C.a;return(B.a-E)*B.rgb+(C.a-E)*C.rgb+E*D;}vec4 F(vec4 B,vec4 C,int G){if(C.a==0.){return B;}if(B.a==0.){return C;}vec3 H;if(G==1){H=C.rgb;}else if(G==3){H=vec3(min(B.r,C.r),min(B.g,C.g),min(B.b,C.b));}else if(G==4){H=B.rgb*C.rgb;}else if(G==6){H=max(B.rgb+C.rgb-1.,0.);}else if(G==8){H=vec3(max(B.r,C.r),max(B.g,C.g),max(B.b,C.b));}else if(G==9){H=vec3(1.-(1.-B.r)*(1.-C.r),1.-(1.-B.g)*(1.-C.g),1.-(1.-B.b)*(1.-C.b));}else if(G==11){H=min(B.rgb+C.rgb,vec3(1.));}else if(G==13){H=vec3(B.r<.5?(2.*B.r*C.r):(1.-2.*(1.-B.r)*(1.-C.r)),B.g<.5?(2.*B.g*C.g):(1.-2.*(1.-B.g)*(1.-C.g)),B.b<.5?(2.*B.b*C.b):(1.-2.*(1.-B.b)*(1.-C.b)));}else if(G==14){H=vec3(C.r<.5?(2.*B.r*C.r+B.r*B.r*(1.-2.*C.r)):(sqrt(B.r)*(2.*C.r-1.)+2.*B.r*(1.-C.r)),C.g<.5?(2.*B.g*C.g+B.g*B.g*(1.-2.*C.g)):(sqrt(B.g)*(2.*C.g-1.)+2.*B.g*(1.-C.g)),C.b<.5?(2.*B.b*C.b+B.b*B.b*(1.-2.*C.b)):(sqrt(B.b)*(2.*C.b-1.)+2.*B.b*(1.-C.b)));}else if(G==20){H=abs(B.rgb-C.rgb);}else if(G==21){H=B.rgb+C.rgb-2.*B.rgb*C.rgb;}float I=C.a+B.a*(1.-C.a);return vec4(A(B,C,H)/I,I);}void main(){vec4 B;if(g==f&&d==vec2(0.)){B=texture2D(j[0],v_texcoord);}else{if(v_texcoord.x>=(d.x)/g.x&&v_texcoord.y>=(d.y)/g.y&&v_texcoord.x<((d.x)+f.x)/g.x&&v_texcoord.y<((d.y)+f.y)/g.y){vec2 J=v_texcoord-vec2(d.x/g.x,d.y/g.y);vec2 K=J*vec2(g.x/f.x,g.y/f.y);B=texture2D(j[0],K);}else{if(k==1){discard;}else{B=vec4(0.,0.,0.,0.);}}}if(m==1){vec4 L=texture2D(n,gl_FragCoord.xy/l);B=F(L,B,c[0]);}for(int M=1;M<7;M++){if(M>=h){break;}vec4 C=texture2D(j[M],v_texcoord);B=F(B,C,c[M]);}gl_FragColor=B;}","getLayerById","historyNewEdit","event","random","ONE","executeOnSingleLayer","cmd-palette","activeImage","edit","_contextKeyService","indexOf","_restoreCompositeEntry","layer/resizeCanvas","Uint8Array",'" exceeded maximum pixel count allowed (',"_keyDown","file.save","image-list","blend","_stopAnimatingProgram","primaryColor","DEPTH_BUFFER_BIT","runLayerTask","layer-delete","mousemove","_stateHandlers","_sliderTabElement","view.zoomIn","Layer: ","_textureBUniformLocation","Go to Bottom Layer","floor","LINK_STATUS",";\n\nin vec2 v_position;\n\nout vec4 outColor;\n\nvoid main() {\n  if (mod(v_position.x / ","layer/flipHorizontal","StatusBarService","_undoDimensions","history.toggleHistoryWindow","_isStretchEnabled","layer.rotate180",'History entry "',"_layerOffsetUniformLocation","keyup","_finishEdit","operationName","layer.moveLayerToTop","createMessageHandler","selection","TEXTURE_MIN_FILTER","bottomleft","error","_pixelSizeLocation","preventDefault","splice","Background","Smooth edges","_pointerDownMoveListener","Expand Canvas to Selection","Width not selected","exportImage","_viewElement","lighten","cutImage","fillGlobal","ctrl+shift+n","layers","_undoBlendMode","texture","_onPointerMove","Loading chunk ","moveSelectedPixels","_disposed","_isEditInProgress","--vscode-breadcrumb-foreground","ctrl+shift+x","indexList","toFixed","registerHistoryEntryFactory","_toolDisposables","onUndo","new","Cannot resize image in single layer task","removeEventListener","onUpdate","#version 300 es\nlayout (location = ","10px","Cut Image","Flatten Layers","minimap","ctrl+shift+f","bufferData","negateChecked","#canvas","image.canvasSize","getAllCommands","pageY","substring","_layer","mouseright","documentElement","repeat","_tileScaledDimensionsUniformLocation","goToTopLayer","undoDimensions","onChangedDimensions","softLight",'Task "',"cancelAnimationFrame","_disposables","CurrentVersion","_activeAnimatingRenderPrograms","_redoRange","Macintosh","_value","activeElement","invokeFunction","pencil","layer.flipVertical","_isScrollLocked","css.toColor: Unsupported css format","Restore Image (Hot Exit)","layer-move-up","colorPicker","onDidChangeVisibility","append","drawImage"," > ","_updateUniformValueZoom","_glSelection","getPropertyValue","_items","LINEAR","Right","layer.goToLayerBelow","onDidChangeDimensions","Toggle Tools Window","generatePreview",";\n\nout vec2 v_position;\n\nvoid main() {\n  gl_Position = ","View","minimap-stretch","_frameBufferTexture","putImage","layer-move-down","isReady","quickPick",'Could not find non-existent window view "',";\n\nout vec4 outColor;\n\nvoid main() {\n  float c = floor(mod((float(gl_FragCoord.x) + float(gl_FragCoord.y) + ","_reportInterval","_onStartAnimating",",1) 0%, rgba(","afterend","_onSoftDeletedChange","376225NduwHA","Cannot set the active image to undefined","openBlob","_changeHexInput","openImage","Attempt to dispose a disposed entity","vscode.executeCommand","_zoomUniformLocation","_listElement","save","registerRequestHandler","enabled","_contributions","Flip Horizontal","onVisibilityChange","Save As","ctrl+a","map","shift","isBottomLayer","clipboard","getLeftItems","createBuffer","Could not find layer to set","layer-list","option","nearestneighbor","_stepState","cmdctrl+c","Image size is ","temporaryLayer","pointerDownMove","ArrowRight","Toggle pixel grid when zoomed in","Swap Colors","No undo entry"," 0%, rgba(","No history entry ID to restore","content","getShaderInfoLog","_paletteService","ONE_MINUS_SRC_ALPHA","draw","getProgramInfoLog","Window","text","restore","_updatePosition","adjustments.invert","_updateItem","result","_toolService","version","render","eraser","pageX","ctrl+shift+i","Cannot find module '","layerRange"],a2_0x139a=function(t,e){return a2_0x23b8[t-=290]};(function(t,e){const s=a2_0x139a;for(;;)try{if(492990===-parseInt(s(1001))*parseInt(s(418))-parseInt(s(1657))-parseInt(s(1329))+parseInt(s(329))+parseInt(s(1310))*parseInt(s(1553))+parseInt(s(397))+parseInt(s(1203)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a2_0x23b8),(()=>{var t={4738:t=>{const e=a2_0x139a;t[e(862)]=e(435)},7542:t=>{const e=a2_0x139a;t.exports=e(1431)},3318:t=>{const e=a2_0x139a;t.exports=e(1050)},3716:t=>{const e=a2_0x139a;t[e(862)]=e(1352)},98:t=>{const e=a2_0x139a;t[e(862)]=e(1350)},7034:t=>{t[a2_0x139a(862)]="attribute vec4 a_position;uniform mat4 a;uniform vec2 b;void main(){gl_Position=a*(a_position*vec4(b,0.,1.));}"},6495:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{Z:()=>o,N:()=>h});var n=s(7166),r=s(4378);class o{constructor(t,e,s,i){const n=a2_0x139a;this[n(1095)]=t,this._range=e,this[n(1148)]=s,this._f=i}async[i(358)](){const t=i,e=(0,n.Qf)(this._layer,this._range);await this[t(1148)][t(1059)]((async(e,s,i)=>{const n=t;return await this._f(e,s,i),this[n(954)]}));const s=(0,n.Qf)(this[t(1148)],this[t(954)]);return new r.$(this.operationName,this[t(954)],this[t(1148)],e,s)}}class h{constructor(t,e,s,n,r,o,h,a){const c=i;this[c(822)]=t,this._layer=e,this[c(732)]=s,this._x=n,this._y=r,this[c(772)]=o,this[c(1427)]=h,this[c(1541)]=a}async[i(358)](){const t=i;let e;return await this._layer.edit((async(t,s,i)=>{const n=a2_0x139a;return e=await this[n(1541)][n(939)](n(1114),{targetImage:{data:t,width:s,height:i},color:new Uint8Array(this[n(772)]),selection:this[n(732)],x:this._x,y:this._y,tolerance:this._tolerance}),e[n(312)]})),new r.$(this._operationName,e[t(312)],this._layer,e[t(381)],e.redoData)}}},4375:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{Y:()=>n});class n{constructor(t,e,s,i){const n=a2_0x139a;this.operationName=t,this._stepState=e,this[n(1148)]=s,this[n(579)]=i,this[n(1549)]=n(876),this[n(1595)]="movePixels",this[n(942)]=0}async[i(1293)](){const t=i;if(this[t(579)][t(656)][t(660)](),0===this._tempLayer[t(656)].length)throw new Error(t(416));const e=this[t(579)][t(656)][this._tempLayer[t(656)][t(823)]-1];return this[t(354)](this[t(579)][t(1583)],e),this[t(1148)]}async[i(344)](){const t=i;return this[t(579)][t(656)][t(1568)](this[t(1230)]),this[t(354)](this[t(579)].currentState,this[t(1230)]),this[t(1148)]}_apply(t,e){const s=i;Object[s(1318)](t,e),this[s(579)][s(920)](),this[s(579)].triggerHistoryAction()}[i(1383)](){const t=i;return{id:t(915),operationName:this[t(1095)],layerId:this._layer.id,tempLayerId:this[t(579)].id,stepState:this[t(1230)]}}static create(t,e){const s=i,r=t[s(1051)](e.layerId),o=t[s(524)](e[s(295)]);return new n(e[s(1095)],e[s(656)],r,o)}}},5901:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{X:()=>n});class n{constructor(t,e,s,i){const n=a2_0x139a;this[n(1095)]=t,this.stepState=e,this[n(1148)]=s,this._tempLayer=i,this[n(1549)]=n(876),this[n(1595)]=n(959),this[n(942)]=0}async undo(){const t=a2_0x139a;if(this._tempLayer[t(656)].pop(),0===this[t(579)][t(656)][t(823)])throw new Error(t(416));const e=this[t(579)][t(656)][this[t(579)][t(656)][t(823)]-1];return this[t(354)](this[t(579)].currentState,e),this._layer}async[i(344)](){const t=i;return this[t(579)][t(656)].push(this[t(656)]),this[t(354)](this[t(579)][t(1583)],this[t(656)]),this[t(1148)]}[i(354)](t,e){const s=i;Object[s(1318)](t,e),this[s(579)][s(920)](),this[s(579)][s(1526)]()}serialize(){const t=i;return{id:t(578),operationName:this[t(1095)],layerId:this[t(1148)].id,tempLayerId:this[t(579)].id,stepState:this[t(656)]}}static[i(532)](t,e){const s=i,r=t[s(1051)](e[s(1610)]),o=t[s(524)](e[s(295)]);return new n(e[s(1095)],e.stepState,r,o)}}},1405:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{D:()=>n});class n{constructor(t,e,s,i){const n=a2_0x139a;this.operationName=t,this[n(1230)]=e,this._layer=s,this[n(579)]=i,this[n(1549)]=n(876),this.requiresTool=n(959),this[n(942)]=0}async[i(1293)](){const t=i;return this[t(579)][t(656)].pop(),this[t(354)](this._tempLayer[t(1583)],this[t(579)][t(1278)]),this[t(1148)].temporaryLayer=void 0,this._tempLayer[t(882)](),this[t(1148)]}async redo(){const t=i;return this[t(579)].stepState[t(1568)](this[t(1230)]),this._apply(this[t(579)][t(1583)],this._stepState),await this._layer.registerTemporaryLayer(this[t(579)],!1),this._tempLayer[t(1526)](),this[t(1148)]}[i(354)](t,e){const s=i;Object[s(1318)](t,e),this._tempLayer[s(920)]()}[i(1383)](){const t=i;return{id:t(872),operationName:this[t(1095)],layerId:this[t(1148)].id,tempLayerId:this[t(579)].id,stepState:this._stepState}}static[i(532)](t,e){const s=i,r=t.getLayerById(e[s(1610)]),o=t[s(524)](e.tempLayerId);return new n(e.operationName,e.stepState,r,o)}}},6628:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{$:()=>o});var n=s(1003),r=s(7605);class o{constructor(t,e,s,i,r,o,h){const a=a2_0x139a;this[a(1095)]=t,this[a(1541)]=e,this[a(558)]=s,this._replacedRange=i,this[a(1148)]=r,this._tempLayer=o,this[a(515)]=h,this[a(1549)]="singleLayer",this[a(1595)]="movePixels",this.pixelCount=(0,n.U6)(this[a(928)])}async undo(){const t=a2_0x139a;if(0===this[t(579)][t(656)][t(823)])throw new Error(t(304));const e=this[t(579)][t(656)][this[t(579)].stepState[t(823)]-1];return this[t(579)].currentState[t(1049)]=e[t(1049)],this[t(579)][t(1583)][t(760)]=e[t(760)],await this[t(1148)].registerTemporaryLayer(this._tempLayer,!1),await this[t(1148)][t(1059)]((async(e,s,i)=>{const n=t;return await this[n(1541)].runTask(n(1192),{targetImage:{data:e,width:s,height:i},putImage:{data:this._replacedImage[n(969)],width:this[n(515)][n(956)],height:this._replacedImage[n(897)]},putRange:this[n(928)],replacedImage:void 0,blend:!1}),this[n(558)]})),this[t(579)][t(1526)](),this[t(1148)]}async[i(344)](){const t=i,e=this[t(579)][t(656)][this._tempLayer[t(656)][t(823)]-1];this[t(579)].currentState.offsetX=this._destRange.left,this._tempLayer[t(1583)][t(760)]=this[t(558)].top,this[t(1148)][t(1233)]=void 0;const s=await this[t(579)][t(581)][t(1716)][t(812)];let n;if(e[t(1536)]===s.width&&e.scaledWidth===s.width)n=s;else{const i=await this[t(1541)][t(1073)](t(1676),{width:e[t(1536)],height:e.scaledHeight,resampling:e.quality},s,void 0)[t(1253)];n=i[t(852)]}return await this[t(1148)][t(1059)]((async(e,s,i)=>{const r=t;return await this[r(1541)][r(939)](r(1192),{targetImage:{data:e,width:s,height:i},putImage:{data:n.data,width:n.width,height:n[r(897)]},putRange:this[r(558)],replacedImage:void 0,blend:!1}),this[r(558)]})),this[t(579)][t(882)](),this._layer}[i(1383)](){const t=i;return{id:t(1349),operationName:this.operationName,layerId:this[t(1148)].id,tempLayerId:this[t(579)].id,destRange:this[t(558)],replacedRange:this[t(928)],replacedImage:(0,r.t)(this[t(515)])}}static[i(532)](t,e,s){const n=i,h=t[n(1051)](s[n(1610)]),a=t[n(524)](s[n(295)]);return new o(s[n(1095)],e,s[n(496)],s.replacedRange,h,a,(0,r.e)(s[n(455)]))}}},3817:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{O:()=>n});class n{constructor(t,e,s){const i=a2_0x139a;this.operationName=t,this[i(1148)]=e,this[i(579)]=s,this[i(1549)]="singleLayer",this[i(1595)]="rectangle",this.pixelCount=0}async undo(){const t=a2_0x139a;if(0===this._tempLayer.stepState[t(823)])throw new Error("Cannot finish temporary layer without at least 1 step");const e=this[t(579)].stepState[this[t(579)][t(656)][t(823)]-1];return this._apply(this._tempLayer.currentState,e),await this[t(1148)][t(681)](this[t(579)],!1),this[t(579)][t(1526)](),this[t(1148)]}async[i(344)](){const t=i;return this[t(1148)][t(1233)]=void 0,this[t(579)][t(882)](),this[t(1148)]}_apply(t,e){Object.assign(t,e)}[i(1383)](){const t=i;return{id:t(1635),operationName:this[t(1095)],layerId:this[t(1148)].id,tempLayerId:this[t(579)].id}}static create(t,e){const s=i,r=t[s(1051)](e.layerId),o=t[s(524)](e.tempLayerId);return new n(e[s(1095)],r,o)}}},6785:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{x:()=>r});var n=s(7605);class r{constructor(t,e,s,i,n){const r=a2_0x139a;this[r(1095)]=t,this[r(1148)]=e,this[r(954)]=s,this[r(745)]=i,this._redoData=n,this[r(1549)]=r(876),this.pixelCount=this._undoData[r(1126)][r(823)]}[i(1293)](){const t=i;return o(this._layer,this[t(954)],this._undoData),this._layer}redo(){const t=i;return o(this[t(1148)],this[t(954)],this._redoData),this[t(1148)]}[i(1383)](){const t=i;return{id:t(1654),operationName:this[t(1095)],layerId:this[t(1148)].id,range:this[t(954)],undoData:(0,n.t)(this[t(745)]),redoData:(0,n.t)(this[t(1450)])}}static create(t,e){const s=i,o=t[s(1051)](e[s(1610)]);return new r(e.operationName,o,e[s(312)],(0,n.e)(e.undoData),(0,n.e)(e[s(1288)]))}}function o(t,e,s){t.edit((t=>{const i=a2_0x139a;let n=0;for(let e=0;e<s.indexList[i(823)];e++)n=s[i(1126)][e],t[n]=s[i(706)][4*e],t[n+1]=s[i(706)][4*e+1],t[n+2]=s[i(706)][4*e+2],t[n+3]=s[i(706)][4*e+3];return e}))}},4378:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{$:()=>r});var n=s(1003);class r{constructor(t,e,s,i,r){const o=a2_0x139a;this[o(1095)]=t,this[o(312)]=e,this._layer=s,this[o(745)]=i,this[o(1450)]=r,this[o(1549)]=o(876),this[o(942)]=(0,n.U6)(this[o(312)])}async[i(1293)](){const t=i;return await this[t(354)](this._undoData),this[t(1148)]}async[i(344)](){const t=i;return await this[t(354)](this[t(1450)]),this[t(1148)]}async _apply(t){const e=i,s=this[e(312)][e(955)]-this[e(312)][e(362)],n=this[e(312)][e(1702)]-this.range[e(351)],r=4*n;let o=0,h=0,a=0;await this[e(1148)][e(1059)](((i,c)=>{const l=e;for(let e=0;e<s;e++)h=e+this[l(312)][l(362)],o=4*(h*c+this.range[l(351)]),a=e*n*4,i[l(1681)](t[l(636)](a,a+r),o);return this.range}))}[i(1383)](){const t=i;return{id:t(1261),operationName:this[t(1095)],layerId:this._layer.id,range:this[t(312)],undoData:Array[t(1493)](this[t(745)]),redoData:Array[t(1493)](this[t(1450)])}}static[i(532)](t,e){const s=i,n=t[s(1051)](e[s(1610)]);return new r(e[s(1095)],e.range,n,new Uint8Array(e[s(381)]),new Uint8Array(e[s(1288)]))}}},1375:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{C:()=>n});class n{constructor(t,e,s,i,n){const r=a2_0x139a;this[r(1095)]=t,this[r(1541)]=e,this[r(1230)]=s,this[r(1148)]=i,this[r(579)]=n,this[r(1549)]="singleLayer",this[r(1595)]=r(949),this[r(942)]=this[r(579)][r(581)].image[r(1515)][r(956)]*this[r(579)][r(581)][r(1716)][r(1515)].height}[i(1038)](){const t=i;return{left:this._tempLayer[t(1278)][t(1049)],top:this._tempLayer.initialState.offsetY,right:this[t(579)].initialState[t(1049)]+this[t(579)][t(581)][t(1716)][t(1515)][t(956)],bottom:this._tempLayer[t(1278)][t(760)]+this[t(579)][t(581)][t(1716)].resource.height}}async[i(1293)](){const t=i;return this[t(579)][t(656)][t(660)](),this._tempLayer[t(1583)][t(1049)]=this[t(579)][t(1278)][t(1049)],this[t(579)][t(1583)][t(760)]=this[t(579)].initialState[t(760)],this[t(1148)][t(1233)]=void 0,await this[t(1148)][t(1059)]((async(e,s,i)=>{const n=t,r=await this[n(579)][n(581)][n(1716)][n(812)],o=this[n(1038)]();return await this[n(1541)].runTask(n(1192),{targetImage:{data:e,width:s,height:i},putImage:{data:r[n(969)],width:r[n(956)],height:r[n(897)]},putRange:o,replacedImage:void 0,blend:!1}),o})),this[t(579)].triggerHistoryUnset(),this[t(1148)]}async[i(344)](){const t=i;return this[t(579)][t(656)][t(1568)](this[t(1230)]),this[t(579)][t(1583)][t(1049)]=this._stepState[t(1049)],this[t(579)][t(1583)][t(760)]=this._stepState[t(760)],this[t(1148)][t(1233)]=this[t(579)],await this[t(1148)].edit((async(e,s,i)=>{const n=t,r=this.getRange();return await this[n(1541)][n(939)](n(379),{targetImage:{data:e,width:s,height:i},range:r}),r})),this[t(579)][t(1526)](),this[t(1148)]}[i(1383)](){const t=i;return{id:t(1121),operationName:this.operationName,layerId:this[t(1148)].id,tempLayerId:this[t(579)].id,stepState:this[t(1230)]}}static[i(532)](t,e,s){const r=i,o=t[r(1051)](s.layerId),h=t[r(524)](s[r(295)]);return new n(s.operationName,e,s[r(656)],o,h)}}},3491:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{w:()=>h});var n=s(1815),r=s(5120);let o=-1;class h extends r.JT{constructor(t){const e=a2_0x139a;var s;super(),this[e(1479)]=this[e(1700)](new n.v),this[e(302)]=this._onCommit[e(1053)],this._onRequestRender=this[e(1700)](new n.v),this.onRequestRender=this[e(1320)][e(1053)],this[e(629)]=this[e(1700)](new n.v),this.onHistoryUnset=this[e(629)][e(1053)],this[e(957)]=this[e(1700)](new n.v),this[e(597)]=this[e(957)][e(1053)],t?(this.id=t,s=t,o=Math.max(o,s)):this.id=++o}[i(920)](){this[i(1320)].fire()}triggerHistoryAction(){this._onHistoryAction.fire()}[i(882)](){const t=i;this[t(629)][t(1448)]()}}},270:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{m:()=>a});var n=s(6628),r=s(4375),o=s(1375),h=s(3491);class a extends h.w{constructor(t,e,s,n,r,o,h,a,c){const l=a2_0x139a;var d;super(h),this[l(624)]=t,this[l(664)]=r,this._taskWorkerService=o,this[l(1549)]=l(570),this[l(1426)]=l(1429),this[l(1278)]=a||{offsetX:s[l(351)],offsetY:s.top,scaledWidth:s[l(1702)]-s[l(351)],scaledHeight:s[l(955)]-s[l(362)],quality:n||l(885)},this[l(656)]=c||[],this[l(1583)]={...c?.length?c[c[l(823)]-1]:this[l(1278)]},this.onHistoryAction((()=>this[l(674)]())),l(812)in e?(this[l(581)]={image:e,range:s},e[l(812)][l(1580)]((()=>this[l(1320)].fire()))):this[l(581)]={image:(d=e,{resource:d,readyPromise:Promise[i(648)](d),isReady:!0}),range:s}}get[i(969)](){const t=i;return this[t(581)].image[t(1515)][t(969)]}get[i(956)](){const t=i;return this[t(581)][t(1716)][t(1515)][t(956)]}get[i(897)](){const t=i;return this.staticState[t(1716)][t(1515)][t(897)]}[i(993)](t){const e=i;this.currentState[e(1049)]===t[e(351)]&&this[e(1583)][e(760)]===t.top&&this[e(1583)].scaledWidth===t[e(1702)]-t[e(351)]&&this[e(1583)][e(299)]===t[e(955)]-t[e(362)]||(this.currentState[e(1049)]=t.left,this.currentState.offsetY=t[e(362)],this.currentState[e(1536)]=t[e(1702)]-t.left,this[e(1583)][e(299)]=t[e(955)]-t[e(362)],this._onRequestRender[e(1448)]())}moveStep(){const t=i,e={...this[t(1583)]};this.stepState.length>0?this[t(664)][t(935)](new r.Y(t(688),e,this._parentLayer,this)):this._historyService.addEntry(new o.C(t(458),this._taskWorkerService,e,this[t(624)],this)),this[t(674)](),this[t(656)][t(1568)](e),this[t(1320)].fire()}[i(522)](t){const e=i,s={...this.currentState};this._historyService[e(935)](new r.Y(t,s,this[e(624)],this)),this[e(674)](),this.stepState.push(s),this[e(1320)].fire()}_updatePreviewIfNeeded(){const t=i,e=this[t(773)]?.resource.width||this[t(581)][t(1716)][t(1515)][t(956)],s=this[t(773)]?.[t(1515)][t(897)]||this[t(581)][t(1716)][t(1515)].height;if(e===this[t(1583)][t(1536)]&&s===this[t(1583)].scaledHeight&&this[t(582)]===this.currentState.quality)return;if(this.scaledImageQuality=this[t(1583)][t(1286)],this.currentState[t(1536)]===this.staticState.image[t(1515)][t(956)]&&this[t(1583)][t(299)]===this.staticState.image[t(1515)][t(897)])return this[t(773)]=this.staticState[t(1716)],void this._onRequestRender.fire();let n;const r=new Promise((t=>n=t)),o={width:this[t(1583)][t(1536)],height:this.currentState[t(299)],data:new Uint8Array(0)};this.scaledImage={isReady:!1,readyPromise:r,resource:o},this[t(581)].image[t(812)][t(1580)]((async e=>{const s=t,i=await this[s(1541)][s(1073)](s(1676),{width:this[s(1583)][s(1536)],height:this[s(1583)][s(299)],resampling:this.currentState.quality},e,void 0)[s(1253)];o[s(969)]=i[s(852)].data,this[s(773)]&&(this[s(773)].isReady=!0),n(o),this._onRequestRender.fire()}))}async[i(661)](){const t=i,e=await(this[t(773)]?.[t(812)]||this.staticState[t(1716)][t(812)]),s=Math[t(839)](this.currentState.offsetX,0),r=Math[t(839)](this[t(1583)][t(760)],0),o=Math[t(584)](this[t(1583)].offsetX+this.currentState[t(1536)],this._parentLayer[t(956)]),h=Math[t(584)](this.currentState[t(760)]+this[t(1583)][t(299)],this._parentLayer.height),a=o-s,c=h-r,l={width:a,height:c,data:new Uint8Array(new SharedArrayBuffer(a*c*4))},d={left:this[t(1583)][t(1049)],top:this[t(1583)][t(760)],right:this[t(1583)].offsetX+this.currentState[t(1536)],bottom:this.currentState[t(760)]+this[t(1583)][t(299)]};await this._parentLayer.edit((async(s,i,n)=>{const r=t;return await this._taskWorkerService.runTask(r(1192),{putRange:d,targetImage:{data:s,width:i,height:n},putImage:e,replacedImage:l,blend:!1}),d})),this._historyService[t(935)](new n.$("Finish Selection",this._taskWorkerService,d,{left:s,top:r,right:o,bottom:h},this[t(624)],this,l)),this[t(1479)][t(1448)]()}[i(485)](t){const e=i;if(this.width*this[e(897)]>t)return"Moving layer exceeded maximum pixel count allowed ("+this[e(956)]*this[e(897)]+" > "+t+")"}[i(1383)](){const t=i;return{id:this.id,parentLayerId:this[t(624)].id,type:t(570),staticState:c(this.staticState),initialState:this[t(1278)],currentState:this[t(1583)],stepState:this[t(656)]}}static[i(532)](t,e,s,n){const r=i,o=t[r(581)],h={data:new Uint8Array(o.data),width:o.range[r(1702)]-o[r(312)][r(351)],height:o[r(312)].bottom-o[r(312)][r(362)]};return new a(e,h,o[r(312)],void 0,s,n,t.id,t[r(1278)],t.stepState)}}function c(t){const e=i;return{data:Array.from(t.image[e(1515)][e(969)]),range:t[e(312)]}}},807:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{F:()=>d});var n=s(7517),r=s(1003),o=s(6495),h=s(5901),a=s(1405),c=s(3817),l=s(3491);class d extends l.w{constructor(t,e,s,i,n,r,o=[]){const h=a2_0x139a;super(r),this._parentLayer=t,this[h(581)]=e,this[h(1278)]=s,this[h(664)]=i,this[h(1541)]=n,this[h(656)]=o,this[h(1549)]="rectangle",this.currentState=u(o[h(823)]?o[o[h(823)]-1]:this.initialState)}rectangleStep(t,e=!1){const s=a2_0x139a,i=u(this[s(1583)]);if(this[s(656)][s(823)]>0){let n=!1;if(e){const e=this[s(664)].entries[this[s(664)][s(683)][s(823)]-1];e[s(1095)]===t&&(e.stepState=i,this[s(656)][this.stepState[s(823)]-1]=i,n=!0)}!n&&(this[s(664)][s(935)](new h.X(t,i,this._parentLayer,this)),this[s(656)].push(i))}else this[s(664)][s(935)](new a.D(s(699),i,this[s(624)],this)),this[s(656)][s(1568)](i);this._onRequestRender[s(1448)]()}async[i(661)](t){const e=i,s=this[e(1583)][e(312)];await this[e(664)][e(1039)]("Finish Rectangle",(async()=>{const i=e;this[i(664)][i(935)](new c.O(i(1007),this[i(624)],this)),await this._historyService[i(1025)](new o.Z(i(1375),s,this[i(624)],(async(e,s,n)=>{const r=i;await this[r(863)](e,s,n,t)})))})),this[e(1479)][e(1448)]()}async applyCommit(t,e,s,n){const r=i,o=this[r(1583)][r(1426)],h=this[r(1583)].range,a=this[r(463)](n);if((h[r(955)]-h[r(362)])*(h[r(1702)]-h[r(351)])>25e4){const i=[];for(const n of a)for(const h of n[r(498)])i[r(1568)](this[r(1541)][r(939)](r(814),{targetImage:{data:t,width:e,height:s},range:h,color:new Uint8Array(n.color),blendMode:o}));await Promise[r(1358)](i)}else for(const s of a)for(const i of s[r(498)])this[r(1630)](t,e,i,s[r(927)],o)}_fillRange(t,e,s,r,o){const h=i;let a=0;for(let i=s[h(362)];i<s[h(955)];i++)for(let c=s[h(351)];c<s[h(1702)];c++)a=4*(i*e+c),"replace"===o?(t[a]=r[0],t[a+1]=r[1],t[a+2]=r[2],t[a+3]=r[3]):(0,n.B)(o,t,a,r,0)}[i(463)](t){const e=i,s=[],n=this[e(1583)],o=this[e(581)].invertColors?n[e(368)]:n.primaryColor,h=this[e(581)][e(948)]?n[e(1071)]:n.secondaryColor,a=2===n[e(735)]?o:h,c=2===n.style?h:o,l=t||(0,r.DI)(this[e(624)][e(956)],this[e(624)].height),d=(0,r.l$)({left:n[e(312)].left,right:n[e(312)][e(1702)],top:n[e(312)][e(362)],bottom:Math[e(584)](n[e(312)][e(362)]+n[e(322)],n[e(312)].bottom)},l),u=(0,r.l$)({left:n[e(312)][e(351)],right:n[e(312)].right,top:Math[e(839)](d[e(955)],n[e(312)][e(955)]-n.outlineSize),bottom:n[e(312)][e(955)]},l),m=(0,r.l$)({left:n[e(312)][e(351)],right:n[e(312)][e(351)]+n[e(322)],top:d[e(955)],bottom:u[e(362)]},l),f=(0,r.l$)({left:Math[e(839)](m[e(1702)],n[e(312)].right-n[e(322)]),right:n[e(312)].right,top:d[e(955)],bottom:u[e(362)]},l);return 2!==n.style&&s[e(1568)]({ranges:[d,u,m,f],color:c}),3===n[e(735)]?s.push({ranges:[{left:m[e(1702)],right:f[e(351)],top:d.bottom,bottom:u[e(362)]}],color:a}):2===n[e(735)]&&s[e(1568)]({ranges:[{left:m.left,right:f[e(1702)],top:d[e(362)],bottom:u[e(955)]}],color:a}),s}[i(1383)](){const t=i;return{id:this.id,parentLayerId:this[t(624)].id,type:t(959),staticState:this[t(581)],initialState:m(this[t(1278)]),currentState:m(this.currentState),stepState:this[t(656)][t(1220)]((t=>m(t)))}}static[i(532)](t,e,s,n){const r=i;return new d(e,t.staticState,f(t[r(1278)]),s,n,t.id,t[r(656)][r(1220)]((t=>f(t))))}}function u(t){const e=i;return{primaryColor:t.primaryColor,secondaryColor:t[e(368)],blendMode:t.blendMode,range:(0,r.BN)(t[e(312)]),outlineSize:t[e(322)],style:t.style}}function m(t){const e=i;return{primaryColor:Array[e(1493)](t[e(1071)]),secondaryColor:Array[e(1493)](t[e(368)]),blendMode:t[e(1426)],range:(0,r.BN)(t[e(312)]),outlineSize:t[e(322)],style:t[e(735)]}}function f(t){const e=i;return{primaryColor:new Float32Array(t.primaryColor),secondaryColor:new Float32Array(t.secondaryColor),blendMode:t.blendMode,range:(0,r.BN)(t[e(312)]),outlineSize:t.outlineSize,style:t[e(735)]}}},1038:(t,e,s)=>{const i=a2_0x139a;var n={"./tools/colorPicker.js":[6471,471],"./tools/eraser.js":[2996,996],"./tools/fill.js":[7643,643],"./tools/movePixels.js":[687,687],"./tools/moveSelection.js":[403,403],"./tools/pencil.js":[3518,518],"./tools/rectangle.js":[7891,891],"./tools/selection.js":[3040,40],"./tools/zoom.js":[7710,710]};function r(t){const e=a2_0x139a;if(!s.o(n,t))return Promise[e(648)]().then((()=>{const s=e;var i=new Error(s(1260)+t+"'");throw i[s(434)]=s(1639),i}));var i=n[t],r=i[0];return s.e(i[1])[e(1580)]((()=>s(r)))}r[i(843)]=()=>Object.keys(n),r.id=1038,t[i(862)]=r},4371:(t,e,s)=>{"use strict";const i=a2_0x139a;function n(t,e=2*t[i(823)]){const s=i;let n;if(t instanceof Float32Array)n=new Float32Array(e);else if(t instanceof Uint8Array)n=new Uint8Array(e);else if(t instanceof Uint16Array)n=new Uint16Array(e);else{if(!(t instanceof Uint32Array))throw new Error(s(417));n=new Uint32Array(e)}return n[s(1681)](t),n}function r(t,e,s=!1){const n=i;return e<Math.pow(2,8)?s?new Uint8Array(new SharedArrayBuffer(t)):new Uint8Array(t):e<Math[n(516)](2,16)?s?new Uint16Array(new SharedArrayBuffer(2*t)):new Uint16Array(t):s?new Uint32Array(new SharedArrayBuffer(4*t)):new Uint32Array(t)}s.d(e,{R:()=>n,X:()=>r})},7517:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{B:()=>h});const n=new Float32Array(6);let r;const o={normal:(t,e)=>e,darken:(t,e)=>Math[i(584)](t,e),multiply:(t,e)=>t*e,linearBurn:(t,e)=>Math[i(839)](t+e-1,0),lighten:(t,e)=>Math[i(839)](t,e),screen:(t,e)=>1-(1-t)*(1-e),linearDodgeAdd:(t,e)=>Math[i(584)](t+e,1),overlay:(t,e)=>t<.5?2*t*e:1-2*(1-t)*(1-e),softLight:(t,e)=>e<.5?2*t*e+t*t*(1-2*e):Math[i(1334)](t)*(2*e-1)+2*t*(1-e),difference:(t,e)=>Math.abs(t-e),exclusion:(t,e)=>t+e-2*t*e};function h(t,e,s,h,c,l=e,d=s){const u=i;return n[0]=h[c+3]/255,0===n[0]?(e[s]=l[d],e[s+1]=l[d+1],e[s+2]=l[d+2],void(e[s+3]=l[d+3])):(n[1]=l[d+3]/255,0===n[1]?(e[s]=h[c],e[s+1]=h[c+1],e[s+2]=h[c+2],void(e[s+3]=h[c+3])):(r=o[t],n[3]=r(l[d]/255,h[c]/255),n[4]=r(l[d+1]/255,h[c+1]/255),n[5]=r(l[d+2]/255,h[c+2]/255),n[2]=n[0]+n[1]*(1-n[0]),e[s]=Math[u(309)](a(l[d]/255,n[1],h[c]/255,n[0],n[3])/n[2]*255),e[s+1]=Math[u(309)](a(l[d+1]/255,n[1],h[c+1]/255,n[0],n[4])/n[2]*255),e[s+2]=Math[u(309)](a(l[d+2]/255,n[1],h[c+2]/255,n[0],n[5])/n[2]*255),void(e[s+3]=Math[u(309)](255*n[2]))))}function a(t,e,s,i,n){return(e-e*i)*t+(i-e*i)*s+e*i*n}},6374:(t,e,s)=>{"use strict";function i(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}s.d(e,{W:()=>i})},1815:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{v:()=>n,B:()=>r});class n{constructor(t){const e=a2_0x139a;this[e(1445)]=t,this[e(795)]=[],this[e(1122)]=!1}get[i(1053)](){const t=i;return!this[t(1625)]&&(this[t(1625)]=e=>{const s=t;return 0===this[s(795)][s(823)]&&this[s(1445)]?.[s(1035)]&&this[s(1445)][s(1035)](),this[s(795)].push(e),{dispose:()=>{const t=s;if(!this[t(1122)])for(let s=0;s<this[t(795)][t(823)];s++)if(this._listeners[s]===e)return this._listeners[t(1104)](s,1),void(0===this[t(795)][t(823)]&&this[t(1445)]?.[t(330)]&&this[t(1445)][t(330)]())}}}),this._event}fire(t,e){const s=i,n=[];for(let t=0;t<this[s(795)][s(823)];t++)n[s(1568)](this[s(795)][t]);for(let i=0;i<n[s(823)];i++)n[i][s(733)](void 0,t,e)}async fireAndWait(t,e){const s=i,n=[];for(let t=0;t<this[s(795)][s(823)];t++)n[s(1568)](this[s(795)][t]);for(let i=0;i<n[s(823)];i++)await n[i].call(void 0,t,e)}[i(921)](){const t=i;this._listeners&&(this._listeners[t(823)]=0),this[t(1122)]=!0}}function r(t,e){const s=i;return t(((t,i)=>e[s(1448)](t,i)))}},7166:(t,e,s)=>{"use strict";function i(t,e){const s=a2_0x139a,i=typeof t===s(1679)?t:t[s(956)];return e=typeof t===s(1679)?e:t[s(897)],{data:new Uint8Array(new(s(1390)in window?SharedArrayBuffer:ArrayBuffer)(i*e*4)),width:i,height:e}}function n(t,e){const s=a2_0x139a,i=e.bottom-e.top,n=e[s(1702)]-e[s(351)],r=new Uint8Array(n*i*4);let o=0,h=0;for(let a=0;a<i;a++)h=a+e[s(362)],o=4*(h*t[s(956)]+e[s(351)]),r[s(1681)](t[s(969)][s(636)](o,o+4*n),a*n*4);return r}function r(t,e,s,i,n=!0){const r=a2_0x139a;if(!n&&e<i&&t<s)return{left:Math[r(309)]((s-t)/2),top:Math[r(309)]((i-e)/2),width:t,height:e};const o={left:0,top:0,width:s,height:i};if(e>t){const i=t/e;o.left=Math[r(309)](s*(.5-i/2)),o[r(956)]=Math.round(s*i)}else if(t>e){const s=e/t;o[r(362)]=Math[r(309)](i*(.5-s/2)),o.height=Math[r(309)](i*s)}return o}s.d(e,{uF:()=>i,Qf:()=>n,M_:()=>r})},5120:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{JT:()=>r,_c:()=>o,Lw:()=>h});var n=s(1815);class r{constructor(){const t=a2_0x139a;this[t(1159)]=[],this[t(542)]=!1,this[t(1312)]=this.register(new n.v),this.onDispose=this._onDispose[t(1053)]}[i(921)](){const t=i;if(this._isDisposed)throw new Error(t(1208));this._onDispose[t(1448)](),this[t(542)]=!0;for(const e of this[t(1159)])e[t(921)]();this[t(1159)].length=0}[i(1700)](t){return this[i(1159)].push(t),t}[i(809)](t){const e=i,s=this[e(1159)].indexOf(t);-1!==s&&this[e(1159)][e(1104)](s,1)}}function o(t){const e=i;for(const e of t)e.dispose();t[e(823)]=0}function h(t,e,s,i){t.addEventListener(e,s);let n=!1;return{dispose:()=>{n||(n=!0,t[a2_0x139a(1133)](e,s,i))}}}},2939:(t,e,s)=>{"use strict";function i(t,e,s=0){const i=a2_0x139a;return Math[i(584)](Math[i(839)](t,s),e)}s.d(e,{u:()=>i})},7896:(t,e,s)=>{"use strict";const i=a2_0x139a;s.d(e,{V:()=>n});const n=[i(1163),i(303),"MacPPC","Mac68K"][i(1573)](navigator[i(774)]);[i(1386),i(1444),i(529),i(1616)][i(1573)](navigator[i(774)])},1003:(t,e,s)=>{"use strict";function i(t){const e=a2_0x139a;if(t)return{left:t[e(351)],top:t[e(362)],right:t.right,bottom:t[e(955)]}}function n(){return{left:-1,top:-1,right:-1,bottom:-1}}function r(t,e){return{left:t,top:e,right:t+1,bottom:e+1}}function o(t,e){return{left:0,top:0,right:t,bottom:e}}function h(t,e,s,i){const n=a2_0x139a,r=p({left:t,top:e,right:s,bottom:i});return r[n(1702)]++,r[n(955)]++,r}function a(t,e){const s=a2_0x139a;return c(t)?i(e):c(e)?i(t):{left:Math.min(t[s(351)],e[s(351)]),top:Math.min(t[s(362)],e[s(362)]),right:Math[s(839)](t[s(1702)],e[s(1702)]),bottom:Math[s(839)](t[s(955)],e.bottom)}}function c(t){const e=a2_0x139a;return t[e(351)]===t[e(1702)]||t[e(362)]===t[e(955)]}function l(t,e){const s=a2_0x139a;return t[s(351)]=Math[s(584)](Math.max(t[s(351)],e.left),e.right),t.top=Math[s(584)](Math[s(839)](t[s(362)],e[s(362)]),e.bottom),t[s(1702)]=Math[s(839)](Math[s(584)](t[s(1702)],e[s(1702)]),e[s(351)]),t.bottom=Math.max(Math[s(584)](t.bottom,e.bottom),e[s(362)]),t}function d(t,e,s){const i=a2_0x139a,n=e-t[i(351)],r=s-t[i(362)];t[i(351)]=t.left+n,t[i(1702)]=t[i(1702)]+n,t[i(362)]=t[i(362)]+r,t[i(955)]=t[i(955)]+r}function u(t,e,s){const i=a2_0x139a;if(c(t))return t.left=e,t[i(1702)]=e+1,t[i(362)]=s,void(t[i(955)]=s+1);t[i(351)]=Math[i(584)](t.left,e),t[i(362)]=Math[i(584)](t.top,s),t.right=Math.max(t[i(1702)],e+1),t[i(955)]=Math[i(839)](t.bottom,s+1)}function m(t,e,s){const i=a2_0x139a;return e>=t[i(351)]&&e<t[i(1702)]&&s>=t[i(362)]&&s<t[i(955)]}function f(t,e){const s=a2_0x139a;return e[s(351)]>=t[s(351)]&&e[s(1702)]<=t[s(1702)]&&e[s(362)]>=t.top&&e[s(955)]<=t[s(955)]}function g(t,e){const s=a2_0x139a;return!(t.bottom<e.top||t[s(362)]>e[s(955)]||t[s(1702)]<e.left||t[s(351)]>e.right)}function p(t){const e=a2_0x139a;if(t[e(351)]>t[e(1702)]){const s=t.right;t[e(1702)]=t[e(351)],t[e(351)]=s}if(t[e(362)]>t[e(955)]){const s=t[e(955)];t[e(955)]=t[e(362)],t.top=s}if(t[e(1702)]<t[e(351)]){const s=t[e(351)];t[e(351)]=t[e(1702)],t[e(1702)]=s}if(t.bottom<t[e(362)]){const s=t[e(362)];t[e(362)]=t[e(955)],t[e(955)]=s}return t}function _(t){const e=a2_0x139a;return(t[e(1702)]-t[e(351)])*(t[e(955)]-t.top)}s.d(e,{BN:()=>i,Pq:()=>n,Re:()=>r,DI:()=>o,tH:()=>h,qi:()=>a,Bu:()=>c,l$:()=>l,Hd:()=>d,Hv:()=>u,RB:()=>m,ur:()=>f,b8:()=>g,FJ:()=>p,U6:()=>_})},7605:(t,e,s)=>{"use strict";function i(t){const e=a2_0x139a,s={};for(const i of Object[e(843)](t)){const n=t[i];typeof n===e(592)?n instanceof Uint8Array?s[i]=r(n,e(1064)):n instanceof Uint16Array?s[i]=r(n,e(433)):n instanceof Uint32Array?s[i]=r(n,"Uint32Array"):s[i]=n:s[i]=n}return s}function n(t){const e=a2_0x139a,s={};for(const i of Object[e(843)](t)){const n=t[i];typeof n===e(592)&&"dataType"in n?s[i]=o(n):s[i]=n}return s}function r(t,e){return{dataType:e,data:Array.from(t)}}function o(t){const e=a2_0x139a;return new(window[t[e(763)]])(t[e(969)])}s.d(e,{t:()=>i,e:()=>n})}},e={};function s(i){const n=a2_0x139a;if(e[i])return e[i][n(862)];var r=e[i]={exports:{}};return t[i](r,r[n(862)],s),r.exports}s.m=t,s.n=t=>{const e=a2_0x139a;var i=t&&t.__esModule?()=>t[e(583)]:()=>t;return s.d(i,{a:i}),i},s.d=(t,e)=>{const i=a2_0x139a;for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object[i(652)](t,n,{enumerable:!0,get:e[n]})},s.f={},s.e=t=>{const e=a2_0x139a;return Promise[e(1358)](Object.keys(s.f)[e(1591)](((e,i)=>(s.f[i](t,e),e)),[]))},s.u=t=>""+t+a2_0x139a(1608),(()=>{const t=a2_0x139a;s[t(580)]=e=>{const s=t;return""+(122===e?s(1640):e)+s(1326)}})(),s.g=function(){const t=a2_0x139a;if(typeof globalThis===t(592))return globalThis;try{return this||new Function(t(759))()}catch(e){if(typeof window===t(592))return window}}(),(()=>{const t=a2_0x139a;s.o=(e,s)=>Object[t(549)].hasOwnProperty.call(e,s)})(),(()=>{const t=a2_0x139a;var e={},i=t(1606);s.l=(n,r,o)=>{const h=t;if(e[n])e[n][h(1568)](r);else{var a,c;if(void 0!==o)for(var l=document.getElementsByTagName(h(1034)),d=0;d<l[h(823)];d++){var u=l[d];if(u[h(727)]("src")==n||u[h(727)](h(550))==i+o){a=u;break}}!a&&(c=!0,(a=document[h(1267)](h(1034)))[h(989)]=h(454),a.timeout=120,s.nc&&a[h(1270)](h(736),s.nc),a[h(1270)](h(550),i+o),a.src=n),e[n]=[r];var m=(t,s)=>{const i=h;a[i(391)]=a[i(858)]=null,clearTimeout(f);var r=e[n];if(delete e[n],a[i(953)]&&a.parentNode.removeChild(a),r&&r[i(1402)]((t=>t(s))),t)return t(s)},f=setTimeout(m.bind(null,void 0,{type:"timeout",target:a}),12e4);a[h(391)]=m[h(658)](null,a[h(391)]),a[h(858)]=m.bind(null,a[h(858)]),c&&document[h(1337)][h(986)](a)}}})(),s.r=t=>{const e=a2_0x139a;"undefined"!=typeof Symbol&&Symbol[e(628)]&&Object[e(652)](t,Symbol[e(628)],{value:"Module"}),Object[e(652)](t,e(744),{value:!0})},(()=>{const t=a2_0x139a;var e;s.g[t(1322)]&&(e=s.g[t(1612)]+"");var i=s.g[t(1623)];if(!e&&i&&(i[t(1633)]&&(e=i[t(1633)][t(1680)]),!e)){var n=i[t(1457)](t(1034));n[t(823)]&&(e=n[n[t(823)]-1][t(1680)])}if(!e)throw new Error(t(640));e=e[t(1429)](/#.*$/,"")[t(1429)](/\?.*$/,"")[t(1429)](/\/[^\/]+$/,"/"),s.p=e})(),(()=>{const t=a2_0x139a;var e={122:0};s.f.j=(t,i)=>{const n=a2_0x139a;var r=s.o(e,t)?e[t]:void 0;if(0!==r)if(r)i[n(1568)](r[2]);else{var o=new Promise(((s,i)=>{r=e[t]=[s,i]}));i[n(1568)](r[2]=o);var h=s.p+s.u(t),a=new Error;s.l(h,(i=>{const o=n;if(s.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var h=i&&(i.type===o(691)?o(1307):i[o(1549)]),c=i&&i[o(1652)]&&i.target[o(1680)];a[o(1406)]=o(1120)+t+o(317)+h+": "+c+")",a.name=o(565),a.type=h,a[o(487)]=c,r[1](a)}}),n(1471)+t)}};var i=(t,i)=>{const n=a2_0x139a;for(var r,o,[h,a,c]=i,l=0,d=[];l<h.length;l++)o=h[l],s.o(e,o)&&e[o]&&d[n(1568)](e[o][0]),e[o]=0;for(r in a)s.o(a,r)&&(s.m[r]=a[r]);for(c&&c(s),t&&t(i);d[n(823)];)d[n(1221)]()()},n=self.webpackChunkluna=self[t(1452)]||[];n.forEach(i[t(658)](null,0)),n[t(1568)]=i[t(658)](null,n[t(1568)][t(658)](n))})(),(()=>{"use strict";const t=a2_0x139a;var e=s(5120),i=s(1003),n=s(1815);class r extends e.JT{constructor(){const t=a2_0x139a;super(...arguments),this._onAttach=this.register(new n.v),this[t(669)]=this._onAttach[t(1053)]}attach(t){const e=a2_0x139a;this.element=t,this[e(402)][e(1448)](this[e(1660)])}}class o{constructor(){const t=a2_0x139a;this[t(1549)]=t(334),this[t(1095)]="Unknown History Entry",this[t(942)]=0}[t(1383)](){return{id:t(663)}}static[t(532)](t){return new o}}class h extends e.JT{constructor(){const e=t;super(),this[e(898)]=[],this[e(1712)]=-1,this[e(388)]=new Map,this[e(682)]=new Map,this[e(339)]=this[e(1700)](new n.v),this.onEntriesChange=this[e(339)][e(1053)],this._onUndo=this[e(1700)](new n.v),this[e(1130)]=this[e(1663)].event,this._onRedo=this.register(new n.v),this.onRedo=this._onRedo.event,this[e(380)]=this[e(1700)](new n.v),this[e(1611)]=this._onRequestTool[e(1053)],this.registerHistoryEntryHandler(e(813),{undo:t=>t[e(1293)](),redo:t=>t.redo()}),this[e(1128)](e(1381),(t=>this[e(1062)](t))),this[e(1128)]("unknown",o[e(532)])}get[t(1467)](){return this[t(898)][this._currentEntryPointer]}get entries(){return this._entries}get[t(923)](){const e=t;return this._entries[e(823)]>1&&0!==this[e(1712)]}get[t(328)](){const e=t;return this[e(898)].length>1&&this[e(1712)]!==this[e(898)][e(823)]-1}[t(935)](e,s){const i=t;if(this[i(494)]){if(e[i(1549)]===i(1381))throw new Error(i(929));if(e[i(1549)]===i(334))throw new Error(i(1607));this[i(494)][i(1568)](e)}else this[i(898)][++this[i(1712)]]=e,this[i(898)][i(823)]=this[i(1712)]+1,!s&&this[i(339)][i(1448)](!0)}async[t(1025)](e){const s=t,i=await e.run();i&&this[s(935)](i)}[t(488)](e){const s=t,i=e[s(358)]();i&&this[s(935)](i)}[t(1507)](){const e=t;this._currentEntryPointer=-1,this[e(898)][e(823)]=0,this._onEntriesChange.fire(!0)}async[t(1293)](){const e=t;if(-1===this[e(1712)])throw new Error(e(1238));const s=this._entries[this[e(1712)]];if(s[e(1549)]===e(334))throw new Error(e(1581));if(this[e(1712)]--,this._requestToolIfNeeded(s),s[e(1549)]===e(1381))for(const t of s.entries)await this._entryHandlers[e(399)](t[e(1549)]).undo(t);else await this[e(388)][e(399)](s.type)[e(1293)](s);this._onEntriesChange[e(1448)](!1),this[e(1663)].fire(s)}async[t(344)](){const e=t;if(this[e(898)].length<=this[e(1712)]+1)throw new Error("No redo entry");const s=this[e(898)][this[e(1712)]+1];if(s[e(1549)]===e(334))throw new Error(e(767));if(this[e(1712)]++,this[e(473)](s),s.type===e(1381)){const t=s[e(683)];for(let s=t[e(823)]-1;s>=0;s--)await this._entryHandlers[e(399)](t[s][e(1549)])[e(344)](t[s])}else await this._entryHandlers[e(399)](s[e(1549)])[e(344)](s);this[e(339)][e(1448)](!1),this[e(1490)].fire(s)}async createCompositeEntry(e,s){const i=t;if(this[i(494)])return void await s();this._currentCompositeEntry=[],await s();const n=this[i(494)];this._currentCompositeEntry=void 0;const r=n[i(1591)](((t,e)=>e[i(942)]>t?e.pixelCount:t),0),o={type:"composite",operationName:e,entries:n,pixelCount:r,serialize:()=>this[i(1599)](o)};this[i(935)](o)}[t(568)](e,s){const i=t;if(this._entryHandlers[i(399)](e))throw new Error(i(1410)+e+i(1527));this[i(388)][i(1681)](e,s)}[t(1128)](e,s){const i=t;if(this[i(682)][i(399)](e))throw new Error(i(1013)+e+" has already been registered");this._entryFactories.set(e,s)}[t(1383)](e=0){const s=t;try{for(const t of this[s(898)])if(t[s(942)]>e)throw new Error(s(1091)+t[s(1095)]+s(1065)+t.pixelCount+" > "+e+")");const t=[];for(const e of this[s(898)]){if(!e[s(1383)])throw new Error(s(367));t[s(1568)](e[s(1383)]())}return{currentEntry:this[s(1712)],entries:t}}catch(t){return console[s(1641)](s(457),t),{currentEntry:0,entries:[]}}}deserialize(e){const s=t;for(const t of e.entries)try{this[s(935)](this[s(386)](t),!0)}catch{this[s(935)](new o,!0)}this[s(1712)]=Math[s(584)](e[s(766)],this[s(898)][s(823)]-1),this[s(339)][s(1448)](!1)}[t(386)](e){const s=t;if(!e.id)throw new Error(s(1240));const i=this[s(682)][s(399)](e.id);if(!i)throw new Error(s(657)+e.id+'"');return i(e)}_serializeCompositeEntry(e){const s=t;return{id:s(1381),operationName:e[s(1095)],entries:e[s(683)].map((t=>{const i=s;if(!t[i(1383)])throw console[i(1101)]("Cannot serialize history entry",e),new Error("Cannot serialize history");return t[i(1383)]()})),requiresTool:e.requiresTool}}[t(1062)](e){const s=t,i=[];for(const t of e[s(683)])i[s(1568)](this._restoreEntry(t));const n=i[s(1591)](((t,e)=>e[s(942)]>t?e[s(942)]:t),0);try{const t={type:"composite",operationName:e.operationName,entries:i,pixelCount:n,requiresTool:e[s(1595)],serialize:()=>this[s(1599)](t)};return t}catch{return new o}}[t(473)](e){const s=t;if("composite"===e[s(1549)]){const t=e[s(683)];for(let e=t[s(823)]-1;e>=0;e--){const i=t[e];if(i[s(1595)])return void this._onRequestTool[s(1448)](i[s(1595)])}}else e[s(1595)]&&this._onRequestTool[s(1448)](e[s(1595)])}}var a=s(7517),c=s(2939);class l{constructor(e,s,i){const n=t;this[n(1095)]=e,this[n(943)]=s,this._targetIndex=i,this[n(1549)]=n(1513),this[n(942)]=0}[t(1293)](e){const s=t;d(this._targetIndex,this[s(943)],e)}[t(344)](e){const s=t;d(this[s(943)],this[s(1399)],e)}serialize(){const e=t;return{id:e(429),operationName:this.operationName,initialIndex:this[e(943)],targetIndex:this[e(1399)]}}static[t(532)](e){const s=t;return new l(e.operationName,e[s(623)],e[s(510)])}}function d(e,s,i){const n=t;if(s>=i.list[n(823)])return!1;const r=i[n(1464)][e];if(!r)return!1;for(i[n(1342)]=e;s>i.currentLayer;)i[n(1464)][i[n(1342)]]=i[n(1464)][i[n(1342)]+1],i[n(1464)][++i[n(1342)]]=r;for(;s<i.currentLayer;)i[n(1464)][i.currentLayer]=i[n(1464)][i.currentLayer-1],i[n(1464)][--i[n(1342)]]=r;return i[n(802)][n(1448)](),!0}class u{constructor(e,s,i){const n=t;this[n(822)]=e,this[n(1399)]=s,this[n(787)]=i}run(){const e=t;if(this[e(1399)]===this._model[e(1342)])return;const s=this[e(787)][e(1342)]<this[e(1399)]?-1:1;let i=!1;for(let t=this[e(1399)];t!==this._model.currentLayer;t+=s)if(!this[e(787)][e(1464)][t][e(771)]){i=!0;break}if(!i)return;const n=this[e(787)][e(1342)];return d(n,this[e(1399)],this[e(787)])?new l(this._operationName,n,this._targetIndex):void 0}}class m extends u{constructor(e,s,i){const n=t,r=s[n(1464)][s.currentLayer],o=s[n(1464)][n(971)]((t=>!t[n(771)])),h=o[n(1061)](r)+i;(h<0||h>=o[n(823)])&&super(e,s[n(1342)],s);const a=o[h];super(e,s[n(1464)][n(1061)](a),s)}}class f extends m{constructor(t){super("Move Layer Up",t,1)}}class g extends m{constructor(e){super(t(371),e,-1)}}var p=s(5901);class _{constructor(e,s){const i=t;this.operationName=e,this[i(1148)]=s,this.type=i(876),this[i(942)]=0}[t(1293)](){const e=t;return this._layer.isSoftDeleted=!1,this[e(1148)][e(848)][e(1448)](),this[e(1148)]}[t(344)](){const e=t;return this[e(1148)].isSoftDeleted=!0,this[e(1148)][e(848)].fire(),this[e(1148)]}[t(1383)](){const e=t;return{id:e(305),operationName:this[e(1095)],layerId:this._layer.id}}static create(e,s){const i=t,n=e.getLayerById(s.layerId);return new _(s[i(1095)],n)}}var y=s(1405),w=s(6628),v=s(3817);class b{constructor(e,s,i){const n=t;this[n(1095)]=e,this[n(1087)]=s,this[n(1554)]=i,this[n(1549)]=n(911),this[n(942)]=0}[t(1293)](e){const s=t;e(this._undoDimensions[s(956)],this[s(1087)][s(897)])}redo(e){const s=t;e(this[s(1554)][s(956)],this[s(1554)].height)}serialize(){const e=t;return{id:"imageResize",operationName:this[e(1095)],undoDimensions:this[e(1087)],redoDimensions:this[e(1554)]}}static create(e){const s=t;return new b(e[s(1095)],e[s(1154)],e[s(846)])}}class x{constructor(e,s,i){const n=t;this[n(1095)]=e,this[n(1148)]=s,this[n(579)]=i,this[n(1549)]=n(876),this[n(1595)]=n(949),this[n(942)]=this[n(579)].staticState[n(1716)][n(1515)][n(956)]*this._tempLayer[n(581)].image[n(1515)][n(897)]}async[t(1293)](){const e=t;return this[e(1148)][e(1233)]=void 0,this[e(579)].triggerHistoryUnset(),this[e(1148)].onUpdateEmitter.fire(),this[e(1148)]}async[t(344)](){const e=t;return this._layer[e(1233)]=this[e(579)],this[e(579)][e(1526)](),this._layer[e(848)][e(1448)](),this._layer}serialize(){const e=t;return{id:e(1378),operationName:this[e(1095)],layerId:this[e(1148)].id,tempLayerId:this[e(579)].id}}static[t(532)](e,s){const i=t,n=e[i(1051)](s[i(1610)]),r=e.getTemporaryLayerById(s[i(295)]);return new x(s[i(1095)],n,r)}}var S=s(6785),C=s(4378),E=s(7605);class L{constructor(e,s,i,n){const r=t;this[r(1095)]=e,this._layer=s,this[r(1041)]=i,this[r(555)]=n,this[r(1549)]=r(876),this[r(942)]=this[r(1041)].width*this[r(1041)][r(897)]}async undo(){const e=t;return await this._layer[e(1059)]((()=>this[e(1041)])),this._layer}async[t(344)](){const e=t;return await this[e(1148)][e(1059)]((()=>this._redoImage)),this._layer}serialize(){const e=t;return{id:e(552),operationName:this[e(1095)],layerId:this[e(1148)].id,undoImage:(0,E.t)(this._undoImage),redoImage:(0,E.t)(this._redoImage)}}static[t(532)](e,s){const i=t,n=e[i(1051)](s[i(1610)]);return new L(s.operationName,n,(0,E.e)(s[i(474)]),(0,E.e)(s[i(1545)]))}}var I=s(4375),T=s(1375);class A{constructor(e,s){const i=t;this[i(1095)]=e,this._layer=s,this[i(1549)]="singleLayer",this[i(942)]=this._layer[i(956)]*this[i(1148)][i(897)]}[t(1293)](){const e=t;return this[e(1148)].isSoftDeleted=!0,this[e(1148)].onUpdateEmitter.fire(),this[e(1148)]}redo(){const e=t;return this[e(1148)][e(771)]=!1,this[e(1148)].onUpdateEmitter[e(1448)](),this[e(1148)]}[t(1383)](){const e=t;return{id:"newImage",operationName:this[e(1095)],layerId:this[e(1148)].id}}static create(e,s){const i=t,n=e[i(1051)](s[i(1610)]);return new A(s.operationName,n)}}class R{constructor(e){const s=t;this[s(1095)]=e,this[s(1549)]=s(334),this.pixelCount=0}serialize(){const e=t;return{id:e(1207),operationName:this[e(1095)]}}static[t(532)](e){return new R(e[t(1095)])}}class M{constructor(){const e=t;this.type="readonly",this.operationName=e(1171),this[e(942)]=0}[t(1383)](){return{id:t(1725)}}static[t(532)](t){return new M}}class D{constructor(e,s,i){const n=t;this[n(1148)]=e,this[n(1117)]=s,this[n(527)]=i,this.type=n(876),this[n(942)]=0,this[n(1095)]=n(913)+function(e){const s=t;return e[s(519)](0,1)[s(336)]()+e[s(519)](1)}(this[n(527)])}[t(1293)](){const e=t;return this[e(1148)][e(1426)]=this[e(1117)],this[e(1148)]}redo(){const e=t;return this[e(1148)].blendMode=this._redoBlendMode,this[e(1148)]}serialize(){const e=t;return{id:e(426),layerId:this._layer.id,undoBlendMode:this._undoBlendMode,redoBlendMode:this[e(527)]}}static[t(532)](e,s){const i=t,n=e.getLayerById(s[i(1610)]);return new D(n,s[i(649)],s[i(343)])}}class B{constructor(e,s){const i=t;this[i(1148)]=e,this._isVisible=s,this[i(1549)]=i(876),this.pixelCount=0,this.operationName=(this._isVisible?i(346):i(293))+i(717)}[t(1293)](){const e=t;return this[e(1148)][e(842)]=!this[e(396)],this[e(1148)]}redo(){const e=t;return this[e(1148)][e(842)]=this[e(396)],this[e(1148)]}[t(1383)](){const e=t;return{id:e(1539),layerId:this[e(1148)].id,isVisible:this[e(396)]}}static[t(532)](e,s){const i=t,n=e[i(1051)](s[i(1610)]);return new B(n,s.isVisible)}}var U=s(6495);class k{constructor(e,s){const i=t;this._blendMode=e,this[i(1148)]=s}[t(358)](){const e=t;if(this[e(1148)].blendMode===this[e(908)])return;const s=this[e(1148)][e(1426)];return this._layer[e(1426)]=this[e(908)],new D(this._layer,s,this[e(908)])}}class P{constructor(e,s){this[t(396)]=e,this._layer=s}[t(358)](){const e=t;if(this._layer[e(842)]!==this[e(396)])return this[e(1148)][e(842)]=this[e(396)],new B(this[e(1148)],this[e(396)])}}var N=s(4371);class F extends e.JT{constructor(e,s,r,o,h){const a=t;super(),this._layer=e,this[a(982)]=s,this[a(1636)]=r,this._height=o,this._historyService=h,this[a(389)]=0,this._pointCache=new Set,this[a(954)]=(0,i.Pq)(),this._rangeNotYetRequested=(0,i.Pq)(),this._onUpdate=this[a(1700)](new n.v),this[a(1134)]=this[a(643)][a(1053)],this[a(1479)]=this[a(1700)](new n.v),this[a(302)]=this._onCommit.event,this[a(745)]={colorData:new Uint8Array(200),indexList:(0,N.X)(50,this[a(1636)]*this._height*4)},this[a(1450)]={colorData:new Uint8Array(200),indexList:(0,N.X)(50,this[a(1636)]*this[a(601)]*4)}}[t(646)](e,s,n,r){const o=t;if(e<0||e>=this[o(1636)])return;const h=s*this[o(1636)]+e;if(this._pointCache[o(1436)](h))return;this[o(801)][o(384)](h),(0,i.Hv)(this._rangeNotYetRequested,e,s),this[o(389)]>=this[o(745)][o(1126)][o(823)]&&(this[o(745)][o(1126)]=(0,N.R)(this[o(745)].indexList),this[o(745)].colorData=(0,N.R)(this._undoData[o(706)]),this[o(1450)].indexList=(0,N.R)(this[o(1450)][o(1126)]),this[o(1450)][o(706)]=(0,N.R)(this[o(1450)].colorData));const c=4*(s*this[o(1636)]+e),l=4*this._pointCount;this[o(745)].indexList[this[o(389)]]=c,this[o(745)].colorData[l]=this[o(982)][c],this[o(745)].colorData[l+1]=this._data[c+1],this[o(745)][o(706)][l+2]=this[o(982)][c+2],this[o(745)].colorData[l+3]=this._data[c+3],this[o(1450)][o(1126)][this[o(389)]]=c,r?((0,a.B)(r,this[o(982)],c,n,0),this._redoData[o(706)][l]=this[o(982)][c],this[o(1450)][o(706)][l+1]=this[o(982)][c+1],this[o(1450)][o(706)][l+2]=this[o(982)][c+2],this[o(1450)][o(706)][l+3]=this[o(982)][c+3]):(this[o(1450)].colorData[l]=this._data[c]=n[0],this._redoData.colorData[l+1]=this[o(982)][c+1]=n[1],this[o(1450)][o(706)][l+2]=this[o(982)][c+2]=n[2],this._redoData[o(706)][l+3]=this[o(982)][c+3]=n[3]),this[o(389)]++}drawCircle(e,s,i,n,r){const o=t,h=Math[o(1082)]((i-1)/2),a=i%2==0?1:0;let c=h,l=0,d=1-h;for(n?(this[o(1275)](e-h,e+h+a,s,r),a&&this[o(1275)](e-h,e+h+a,s+1,r)):(this.setPixel(e+h+a,s,r),this.setPixel(e-h,s,r),a&&(this.setPixel(e+h+a,s+1,r),this.setPixel(e-h,s+1,r))),this[o(646)](e,s+h+a,r),this[o(646)](e,s-h,r);c>l&&(l++,d<=0?d=d+2*l+1:(c--,d=d+2*s-2*e+1),!(c<l));)n?(this[o(1275)](e-c,e+c+a,s+l+a,r),this[o(1275)](e-c,e+c+a,s-l,r),this[o(1275)](e-l,e+l+a,s+c+a,r),this._setHorizontalLine(e-l,e+l+a,s-c,r)):(this[o(646)](e+c+a,s+l+a,r),this[o(646)](e-c,s+l+a,r),this[o(646)](e+c+a,s-l,r),this[o(646)](e-c,s-l,r),this[o(646)](e+l,s+c+a,r),this[o(646)](e-l,s+c+a,r),this[o(646)](e+l,s-c,r),this[o(646)](e-l,s-c,r))}[t(1275)](e,s,i,n){const r=t;for(let t=e;t<=s;t++)this[r(646)](t,i,n),this[r(646)](t,i,n)}[t(808)](){const e=t;(0,i.Bu)(this[e(1392)])||(this[e(954)]=(0,i.qi)(this._range,this[e(1392)]),this[e(643)][e(1448)](this[e(1392)]),this[e(1392)]=(0,i.Pq)())}[t(661)](e){const s=t,i={indexList:this._undoData[s(1126)][s(636)](0,this[s(389)]),colorData:this[s(745)].colorData.subarray(0,4*this[s(389)])},n={indexList:this._redoData[s(1126)][s(636)](0,this._pointCount),colorData:this[s(1450)][s(706)][s(636)](0,4*this[s(389)])},r=new S.x(e,this[s(1148)],this[s(954)],i,n);this._historyService.addEntry(r),this._onCommit.fire(this[s(954)])}}var O=s(270);class V extends e.JT{constructor(e,s,i,r,o,h,a,c){const l=t;super(),this[l(392)]=e,this[l(664)]=s,this[l(1541)]=i,this.id=r,this.isReadonly=o,this[l(969)]=h,this.width=a,this[l(897)]=c,this[l(1123)]=!1,this._blendMode=l(361),this[l(396)]=!0,this[l(605)]=!1,this[l(1222)]=!1,this[l(848)]=this[l(1700)](new n.v),this[l(1134)]=this[l(848)][l(1053)],this[l(1202)]=this[l(1700)](new n.v),this[l(866)]=this._onSoftDeletedChange[l(1053)],this[l(311)]=this[l(1700)](new n.v),this[l(1155)]=this[l(311)][l(1053)],this[l(932)]=this[l(1700)](new n.v),this[l(1217)]=this[l(932)][l(1053)],this[l(1320)]=this[l(1700)](new n.v),this.onRequestRender=this[l(1320)].event,this[l(1501)]=this.register(new n.v),this[l(1313)]=this[l(1501)][l(1053)],this[l(799)]=1===this.id?l(1105):l(880)+this.id}get[t(1401)](){return this._name}set[t(1401)](e){this[t(799)]=e}get[t(1426)](){return this[t(908)]}set blendMode(e){const s=t;e!==this._blendMode&&(this[s(908)]=e,this[s(848)][s(1448)]())}get isSoftDeleted(){return this._isSoftDeleted}set isSoftDeleted(e){const s=t;e!==this[s(605)]&&(this[s(605)]=e,this._onSoftDeletedChange[s(1448)]())}get isVisible(){return this[t(396)]}set[t(842)](e){const s=t;e!==this[s(396)]&&(this[s(396)]=e,this[s(932)].fire(),this[s(848)][s(1448)]())}async[t(1059)](e){const s=t;this._startEdit();try{const t=await e(this[s(969)],this[s(956)],this[s(897)]),i={image:t&&s(969)in t?t:void 0,range:t&&s(351)in t?t:void 0};this[s(1094)](i)}catch(t){throw this[s(1094)]({range:(0,i.DI)(this[s(956)],this[s(897)])}),t}}[t(667)](){const e=t;this[e(1520)]();const s=new F(this,this[e(969)],this[e(956)],this[e(897)],this[e(664)]);return(0,n.B)(s.onUpdate,this[e(848)]),s[e(302)]((t=>this._finishEdit({range:t}))),s}async merge(e){const s=t;if(e.isVisible)return this[s(664)].runAction(new U.Z(s(912),(0,i.DI)(this[s(956)],this[s(897)]),this,(async(t,i,n)=>{const r=s;!this.isVisible&&t.set(e[r(969)],0);let o=0;for(let s=0;s<n;s++)for(let n=0;n<i;n++)o=4*(s*i+n),(0,a.B)(e[r(1426)],t,o,e[r(969)],o)})))}async[t(681)](e,s=!0){const i=t;await this[i(1543)](),this[i(1233)]=e,s&&((0,n.B)(e[i(737)],this[i(1320)]),e[i(302)]((()=>this.temporaryLayer=void 0))),this[i(1501)][i(1448)](this.temporaryLayer)}async[t(1543)](){const e=t;await(this[e(1233)]?.[e(661)](this[e(392)][e(1446)])),this[e(1233)]=void 0}async[t(1412)](e={}){const s=t;let n,r;if(e?.useMovingLayer&&"moving"===this.temporaryLayer?.[s(1549)]){const t=this.temporaryLayer;n=await t[s(581)][s(1716)].readyPromise,r=(0,i.DI)(n.width,n.height)}else await this[s(1543)](),n=this,r=e.range||(0,i.DI)(this[s(956)],this[s(897)]);return H(function(e,s){const i=t,n=s.right-s[i(351)],r=s.bottom-s[i(362)];let o,h=0;if(n===e.width)h=s[i(362)]*n*4,o=new Uint8ClampedArray(e.data[i(636)](h,h+n*r*4));else{o=new Uint8ClampedArray(n*r*4);for(let t=s.top;t<s[i(362)]+r;t++)h=4*(t*e[i(956)]+s[i(351)]),o[i(1681)](e[i(969)][i(636)](h,h+4*n),(t-s[i(362)])*n*4)}return new ImageData(o,n,r)}(n,r),e)}async[t(1378)](e,s){const n=t,r=await window.createImageBitmap(e);let o;n(1466)in window?o=new OffscreenCanvas(r.width,r[n(897)]):(o=document[n(1267)]("canvas"),o[n(956)]=r[n(956)],o.height=r[n(897)]);const h=o[n(695)]("2d");h.drawImage(r,0,0);const a=h[n(410)](0,0,r[n(956)],r[n(897)]),c={data:new Uint8Array(a.data),width:a[n(956)],height:a[n(897)]};let l;l=s&&s[n(1702)]-s[n(351)]===a.width&&s[n(955)]-s[n(362)]===a.height?(0,i.BN)(s):(0,i.DI)(a[n(956)],a[n(897)]);const d=new O.m(this,c,l,void 0,this._historyService,this[n(1541)]);d[n(656)][n(1568)]({...d[n(1583)]}),await this[n(681)](d),this[n(664)][n(935)](new x(n(320),this,d));const u=(0,i.l$)((0,i.DI)(a.width,a[n(897)]),(0,i.DI)(this[n(956)],this[n(897)]));return this[n(848)][n(1448)](u),d}[t(1520)](){const e=t;if(this[e(338)])throw new Error("Image is readonly, edit is not supported");if(this[e(1123)])throw new Error("Image is readonly because an edit is in progress");this[e(1123)]=!0}[t(1094)](e){const s=t;if(e){if(e?.[s(1716)]){const t=this[s(956)]!==e.image[s(956)]||this[s(956)]!==e[s(1716)][s(956)];this[s(969)]=e.image[s(969)],this[s(956)]=e[s(1716)].width,this.height=e.image.height,t&&this[s(311)][s(1448)](this[s(392)][s(956)],this[s(392)][s(897)])}this.onUpdateEmitter[s(1448)](e.range),this[s(1123)]=!1}else this[s(1123)]=!1}setBlendMode(e){this[t(664)].runSyncAction(new k(e,this))}setVisible(e){const s=t;this[s(664)][s(488)](new P(e,this))}[t(1383)](){const e=t;return{id:this.id,name:this._name,data:Array[e(1493)](this[e(969)]),blendMode:this._blendMode,isSoftDeleted:this._isSoftDeleted,isVisible:this[e(396)]}}}async function H(e,s={}){const i=t,n=await createImageBitmap(e);if(!(i(1466)in window)){const t=document[i(1267)](i(544));return t[i(956)]=n[i(956)],t[i(897)]=n[i(897)],t[i(695)]("2d")[i(1176)](n,0,0),new Promise(((e,n)=>{const r=i;t[r(632)]((t=>{if(!t)return n(t);e(t)}),s[r(1031)]?.[r(1549)],s[r(1031)]?.[r(1286)])}))}const r=new OffscreenCanvas(n[i(956)],n[i(897)]);return r.getContext("2d")[i(1176)](n,0,0),r.convertToBlob(s[i(1031)])}var z=s(807);class W extends e.JT{constructor(e,s){const i=t;super(),this[i(664)]=e,this[i(1541)]=s,this[i(956)]=0,this[i(897)]=0,this[i(314)]=0,this[i(1045)]=0,this[i(1669)]=new Map,this._onUpdate=this[i(1700)](new n.v),this[i(1134)]=this[i(643)][i(1053)],this[i(311)]=this[i(1700)](new n.v),this.onChangedDimensions=this[i(311)].event,this[i(370)]=this[i(1700)](new n.v),this[i(930)]=this._onLayerChange[i(1053)],this._onLayerVisibilityChange=this.register(new n.v),this[i(590)]=this[i(1570)][i(1053)],this[i(1320)]=this[i(1700)](new n.v),this[i(737)]=this[i(1320)].event,this[i(1501)]=this.register(new n.v),this[i(1313)]=this[i(1501)][i(1053)],this[i(1387)]=this[i(1700)](new n.v),this.onImagesChange=this[i(1387)][i(1053)],this[i(1701)]={list:[],currentLayer:0,isReadonly:!1,onLayerChangeEmitter:this._onLayerChange},this[i(664)][i(568)](i(876),{undo:async t=>{const e=i,s=await t[e(1293)]();s[e(771)]?this[e(730)](this[e(1116)][0].id):this.setActiveLayer(s.id)},redo:async t=>{const e=i,s=await t[e(344)]();s[e(771)]?this[e(730)](this.layers[0].id):this[e(730)](s.id)}}),this[i(664)][i(568)](i(1513),{undo:t=>t[i(1293)](this._layersModel),redo:t=>t[i(344)](this._layersModel)}),this[i(664)][i(568)](i(911),{undo:t=>t[i(1293)](this[i(911)][i(658)](this)),redo:t=>t.redo(this[i(911)][i(658)](this))}),this[i(664)][i(1128)](i(1207),R.create),this[i(664)][i(1128)](i(1654),S.x.create[i(658)](null,this)),this[i(664)][i(1128)]("layerRange",C.$[i(532)][i(658)](null,this)),this[i(664)][i(1128)]("layerReplace",L[i(532)][i(658)](null,this)),this._historyService[i(1128)](i(1645),b[i(532)]),this[i(664)][i(1128)](i(426),D.create[i(658)](null,this)),this._historyService.registerHistoryEntryFactory(i(1539),B.create.bind(null,this)),this[i(664)][i(1128)](i(305),_[i(532)][i(658)](null,this)),this[i(664)][i(1128)](i(996),A[i(532)][i(658)](null,this)),this[i(664)][i(1128)](i(429),l[i(532)]),this[i(664)][i(1128)](i(1725),M[i(532)]),this[i(664)][i(1128)](i(1378),x.create[i(658)](null,this)),this._historyService[i(1128)](i(1349),w.$[i(532)][i(658)](null,this,this[i(1541)])),this[i(664)][i(1128)](i(1121),T.C.create[i(658)](null,this,this[i(1541)])),this[i(664)][i(1128)](i(915),I.Y[i(532)][i(658)](null,this)),this[i(664)].registerHistoryEntryFactory("drawRectangle",y.D[i(532)].bind(null,this)),this[i(664)][i(1128)](i(578),p.X[i(532)][i(658)](null,this)),this[i(664)][i(1128)](i(1635),v.O[i(532)][i(658)](null,this)),this[i(1313)]((t=>{this[i(1669)].set(t.id,t)}))}get currentLayer(){const e=t;return this._layersModel[e(1464)][this[e(1701)][e(1342)]]}get[t(1116)](){return this[t(1701)].list.filter((t=>!t.isSoftDeleted))}[t(1383)](e=0){const s=t;if(this.width*this[s(897)]>e)throw new Error(s(560)+this[s(956)]*this[s(897)]+s(1177)+e+")");for(const t of this[s(1669)].values())if(t[s(485)]){const s=t.canSerialize(e);if(s)throw new Error(s)}const i=[];for(const t of this._activeTemporaryLayers.values())i[s(1568)](t[s(1383)]());const n={dimensions:{width:this[s(956)],height:this[s(897)]},currentLayer:this[s(1701)][s(1342)],isReadonly:this[s(1701)][s(338)],layers:this[s(1701)][s(1464)][s(1220)]((t=>t[s(1383)]())),temporaryLayers:i,currentTemporaryLayerId:this.currentLayer?.[s(1233)]?.id};if(0===n[s(1116)][s(823)])throw new Error(s(444));return n}deserialize(e){const s=t;if(this[s(956)]=e[s(313)][s(956)],this.height=e[s(313)][s(897)],this[s(1701)][s(1464)][s(823)]>0)throw new Error("Cannot restore layers when layer(s) exist");for(const t of e[s(1116)]){const i=new V(this,this[s(664)],this[s(1541)],t.id,e[s(338)],new Uint8Array(t[s(969)]),e.dimensions[s(956)],e[s(313)].height);i[s(1401)]=t.name,i.blendMode=t[s(1426)],i[s(771)]=t[s(771)],i.isVisible=t[s(842)],this[s(1701)].list[s(1568)](i),this[s(612)](i),this[s(1045)]=Math[s(839)](this[s(1045)],t.id+1)}this[s(1701)][s(1342)]=e[s(1342)];for(const t of e[s(1534)]){const e=this[s(1051)](t[s(748)]);let i;switch(t[s(1549)]){case s(570):i=O.m.create;break;case s(959):i=z.F[s(532)]}const r=i(t,e,this._historyService,this[s(1541)]);r[s(1583)][s(1049)]=t[s(1583)][s(1049)],r[s(1583)][s(760)]=t.currentState[s(760)],(0,n.B)(r[s(737)],this.currentLayer[s(1320)]),this[s(1669)].set(t.id,r)}if(void 0!==e[s(909)]){const t=this[s(524)](e.currentTemporaryLayerId);this[s(1342)][s(1233)]=t}this[s(575)](),this[s(643)][s(1448)](),this[s(311)][s(1448)](this[s(956)],this[s(897)]),this[s(370)].fire()}async openBlob(e){const s=t,i=await window[s(796)](e);let n;s(1466)in window?n=new OffscreenCanvas(i[s(956)],i[s(897)]):(n=document[s(1267)](s(544)),n[s(956)]=i.width,n[s(897)]=i.height);const r=n[s(695)]("2d");r.drawImage(i,0,0);const o=r.getImageData(0,0,i.width,i.height);this[s(1207)]({data:new Uint8Array(o[s(969)][s(696)]),width:i[s(956)],height:i.height})}[t(1207)](e,s=t(653)){const i=t;for(const t of this[i(1701)][i(1464)])t.isSoftDeleted=!0,t.dispose();this[i(1701)][i(1464)][i(823)]=0;const n=this.width!==e[i(956)]||this[i(897)]!==e.height;this[i(956)]=e[i(956)],this[i(897)]=e[i(897)],this._layersModel.list[i(1568)](this[i(400)](e.data)),this[i(575)](),this[i(664)][i(1507)](),this._historyService[i(935)](new R(s)),this[i(643)][i(1448)](),n&&this._onChangedDimensions.fire(this.width,this[i(897)]),this[i(370)][i(1448)]()}[t(1510)](e,s=0){const i=t;this[i(1701)][i(338)]=!0,this[i(879)]=e.map((t=>({...t,id:++this[i(314)]}))),this[i(1438)]=s,this.openImage(e[s]),this._onImagesChange[i(1448)]()}newImage(e,s){const i=t,n=window[i(1390)]?SharedArrayBuffer:ArrayBuffer,r=new Uint8Array(new n(e*s*4));r[i(318)](255);const o={data:r,width:e,height:s};this[i(1207)](o,i(1615))}async[t(1412)](e){const s=t;return await this.flattenLayers(),this._layersModel.list[this._layersModel[s(1342)]][s(1412)](e)}async[t(1424)](e){const s=t,i=await this[s(742)]();return H(new ImageData(new Uint8ClampedArray(i[s(969)]),i[s(956)],i[s(897)]),e)}[t(1110)](){const e=t;return this[e(502)](),{data:this[e(1701)][e(1464)][this[e(1701)][e(1342)]][e(969)][e(440)](0,this[e(956)]*this[e(897)]*4),width:this[e(956)],height:this.height}}async[t(742)](){const e=t,s=this[e(1701)].list[e(971)]((t=>t[e(842)]));if(0===s[e(823)])return{data:new Uint8Array(0),width:0,height:0};const i={data:s[0].data.slice(0,this[e(956)]*this[e(897)]*4),width:this.width,height:this[e(897)]};for(let t=0;t<s.length;t++){const n=s[t];let r=n.data;if(n[e(1233)]){const t=n[e(969)][e(440)]();if("moving"===n.temporaryLayer.type){const s=n.temporaryLayer,i=await s[e(581)][e(1716)].readyPromise,r={left:s.currentState[e(1049)],top:s.currentState[e(760)],right:s[e(1583)][e(1049)]+i[e(956)],bottom:s[e(1583)].offsetY+i[e(897)]};let o=0;for(let s=r[e(362)];s<r.bottom;s++)for(let h=r[e(351)];h<r[e(1702)];h++){o=4*(s*this[e(956)]+h);const c=4*((s-r[e(362)])*i[e(956)]+h-r[e(351)]);(0,a.B)(n[e(1426)],t,o,i.data,c)}}else n[e(1233)].applyCommit(t,i[e(956)],i.height,void 0);r=t}let o=0;for(let t=0;t<this[e(897)];t++)for(let s=0;s<this[e(956)];s++)o=4*(t*this[e(956)]+s),(0,a.B)(n[e(1426)],i[e(969)],o,r,o)}return i}setActiveImage(e){const s=t;if(!this[s(879)])throw new Error("Cannot set active image when image type doesn't support multiple images");this[s(1438)]=e;const i=this[s(879)][e];this[s(1207)](i),this[s(1387)].fire(),this[s(370)][s(1448)]()}[t(1709)](){return void 0===this.imageSet}[t(1503)](){const e=t;if(!this._supportsLayers())throw new Error(e(308))}[t(730)](e){const s=t;this[s(1503)](),this.currentLayer?.id!==e&&(this._layersModel[s(1342)]=this[s(451)](e),this[s(370)][s(1448)]())}[t(1487)](){const e=t;this[e(1503)]();const s=window[e(1390)]?SharedArrayBuffer:ArrayBuffer,i=this._createLayer(new Uint8Array(new s(this[e(956)]*this.height*4)));this._layersModel[e(1464)].splice(++this[e(1701)][e(1342)],0,i),this[e(664)][e(935)](new A(e(345),i)),this[e(643)][e(1448)](),this[e(370)][e(1448)]()}deleteLayer(e){const s=t;if(this[s(1503)](),this[s(1701)][s(1464)].length<=1)throw new Error(s(1631));e?this[s(1271)](this[s(451)](e)):this[s(1314)](),this[s(370)][s(1448)]()}async[t(1036)](){const e=t;if(this[e(1503)](),0===this[e(1701)].currentLayer||this[e(1116)][0]===this[e(1342)])throw new Error(e(893));const s=this[e(1701)][e(1464)][this._layersModel[e(1342)]];s.isVisible=!0,await s[e(1543)]();const i=this.layers[e(1061)](s),n=this[e(1116)][i-1],r=this[e(1701)][e(1464)].indexOf(n);await this[e(664)][e(1039)](e(687),(async()=>{const t=e;await this[t(1701)][t(1464)][r][t(1627)](s),this._deleteCurrentLayer(),this[t(1701)][t(1342)]=r}))}[t(1153)](){const e=t;this[e(1503)](),this[e(730)](this[e(1116)][this[e(1116)][e(823)]-1].id)}goToBottomLayer(){const e=t;this[e(1503)](),this[e(730)](this.layers[0].id)}goToLayerAbove(){const e=t;this[e(1503)](),this[e(1557)](1)}[t(888)](){const e=t;this[e(1503)](),this[e(1557)](-1)}[t(1557)](e){const s=t,i=this[s(1342)];if(!i)throw new Error(s(815));const n=this[s(1116)],r=n[s(1061)](i);if(-1===r)throw new Error("Could not find current layer");const o=(0,c.u)(r+e,n.length-1,0);this.setActiveLayer(n[o].id)}[t(1473)](){const e=t;this[e(1503)](),this[e(664)][e(488)](new u(e(1400),this[e(1701)][e(1464)][e(823)]-1,this[e(1701)]))}moveLayerToBottom(){const e=t;this._checkLayerSupport(),this[e(664)].runSyncAction(new u(e(978),0,this[e(1701)]))}moveLayerUp(){const e=t;this[e(1503)](),this[e(664)][e(488)](new f(this[e(1701)]))}[t(1382)](){const e=t;this._checkLayerSupport(),this[e(664)][e(488)](new g(this[e(1701)]))}[t(1528)](e,s){const i=t;return e>=0&&e<this[i(956)]&&s>=0&&s<this[i(897)]}resize(e,s){const i=t;this[i(956)]===e&&this[i(897)]===s||(this[i(956)]=e,this[i(897)]=s,this[i(643)][i(1448)](),this[i(311)][i(1448)](e,s))}[t(400)](e){const s=t;if(this[s(1116)][s(823)]>0&&this[s(1503)](),window[s(1390)]&&!(e.buffer instanceof SharedArrayBuffer)){const t=new Uint8Array(new SharedArrayBuffer(e[s(823)]));t.set(e),e=t}const i=new V(this,this[s(664)],this._taskWorkerService,++this[s(1045)],this._layersModel[s(338)],e,this[s(956)],this[s(897)]);return this[s(612)](i),i}[t(612)](e){const s=t;(0,n.B)(e[s(1134)],this[s(643)]),(0,n.B)(e[s(866)],this[s(370)]),(0,n.B)(e[s(1155)],this[s(311)]),(0,n.B)(e[s(1217)],this[s(1570)]),(0,n.B)(e[s(737)],this[s(1320)]),(0,n.B)(e[s(1313)],this[s(1501)])}[t(1314)](){this[t(1271)](this._layersModel.currentLayer)}[t(1271)](e){const s=t;if(1===this._getNonSoftDeletedLayerCount())throw new Error("Cannot delete last layer");this._layersModel.currentLayer===e&&(this[s(1701)][s(1342)]=Math[s(839)](this._layersModel.currentLayer-1,0));const i=this[s(1701)].list[e];i[s(771)]=!0,this._historyService.addEntry(new _("Delete Layer",i)),this._updateBottomLayer()}async flattenLayers(){const e=t;this[e(1503)](),this._getNonSoftDeletedLayerCount()>1&&(await this[e(664)][e(1039)](e(1138),(async()=>{const t=e;for(let e=this[t(1701)][t(1464)][t(823)]-1;e>=1;e--){const s=this[t(1701)][t(1464)][e];await s[t(1543)](),await this[t(1701)][t(1464)][e-1][t(1627)](s),this[t(1271)](e)}})),this._onUpdate.fire(),this[e(370)][e(1448)]())}[t(575)](){const e=t;this[e(1701)].list[0][e(1222)]=!0;for(let t=1;t<this._layersModel.list.length;t++)this[e(1701)][e(1464)][t][e(1222)]=!1}[t(451)](e){const s=t,i=this[s(1701)].list.findIndex((t=>t.id===e));if(-1===i)throw new Error(s(1226));return i}getLayerById(e){const s=t;return this._layersModel[s(1464)][this[s(451)](e)]}getTemporaryLayerById(e){const s=t;return this[s(1669)][s(399)](e)}[t(780)](){const e=t;let s=0;for(const t of this[e(1701)][e(1464)])!t.isSoftDeleted&&s++;return s}}class q extends e.JT{constructor(e){const s=t;super(),this._attachedDisposables=[],this[s(1670)]=this[s(1700)](new n.v),this[s(1531)]=this[s(1670)].event,this[s(1582)]=this.register(new n.v),this.onKeyUp=this[s(1582)][s(1053)],this[s(1511)]=this[s(1700)](new n.v),this[s(1280)]=this[s(1511)][s(1053)],this._onPointerDownMove=this[s(1700)](new n.v),this[s(1269)]=this[s(1357)][s(1053)],this[s(1119)]=this.register(new n.v),this[s(536)]=this[s(1119)].event,this[s(573)]=this[s(1700)](new n.v),this.onPointerUp=this[s(573)][s(1053)],this._onWheel=this[s(1700)](new n.v),this[s(1029)]=this._onWheel.event,e[s(669)]((t=>this[s(1360)](t)))}get[t(673)](){return!!this[t(1107)]}[t(921)](){this._pointerDownMoveListener?.dispose(),super.dispose()}_attach(s){const i=t;(0,e._c)(this[i(1388)]),this._attachedDisposables[i(823)]=0,this[i(1700)]((0,e.Lw)(document[i(1556)],i(634),(t=>this[i(1670)][i(1448)](t)))),this.register((0,e.Lw)(document[i(1556)],i(1093),(t=>this._onKeyUp[i(1448)](t)))),this.register((0,e.Lw)(s,i(1502),(t=>{const n=i;s.setPointerCapture(t[n(642)]),this._pointerDownMoveListener=(0,e.Lw)(s,n(572),(t=>this._onPointerDownMove[n(1448)](t))),this._onPointerDown.fire(t)}))),this[i(1700)]((0,e.Lw)(s,"pointerup",(t=>{const e=i;s[e(1704)](t[e(642)]),this[e(1107)]?.[e(921)](),this[e(1107)]=void 0,this[e(573)][e(1448)](t)}))),this[i(1700)]((0,e.Lw)(s,i(903),(t=>t[i(1103)]()))),this[i(1700)]((0,e.Lw)(s,i(572),(t=>this[i(1119)].fire(t)))),this[i(1700)]((0,e.Lw)(s,"wheel",(t=>this[i(719)][i(1448)](t)),{passive:!0}))}}var j=s(6374);class G extends e.JT{constructor(){const e=t;super(...arguments),this[e(447)]=new Float32Array([255,255,255,255]),this[e(710)]=new Float32Array([0,0,0,255]),this._onUpdate=this.register(new n.v),this[e(1134)]=this[e(643)][e(1053)]}get primary(){return this[t(447)]}set[t(916)](e){const s=t;this[s(670)](e),!(0,j.W)(this[s(916)],e)&&(this[s(447)]=e,this[s(643)][s(1448)]())}get[t(992)](){return this[t(710)]}set secondary(e){const s=t;this[s(670)](e),!(0,j.W)(this[s(992)],e)&&(this[s(710)]=e,this[s(643)][s(1448)]())}[t(1361)](){const e=t,s=this[e(710)];this._secondary=this[e(447)],this._primary=s,this._onUpdate[e(1448)]()}[t(1705)](e,s){const i=t;this._validate(e),this[i(670)](s),(!(0,j.W)(this[i(916)],e)||!(0,j.W)(this[i(992)],s))&&(this._primary=e,this._secondary=s,this._onUpdate[i(1448)]())}[t(1002)](e){const s=t;return 1&e.buttons?this[s(916)]:2&e[s(835)]?this[s(992)]:void 0}[t(1706)](e){const s=t;return 1&e[s(445)]?[this[s(916)],this[s(992)]]:[this[s(992)],this[s(916)]]}[t(670)](e){if(4!==e[t(823)])throw new Error("Could not set color to array of length smaller than 4")}}let X=Float32Array;function J(t,e,s,i,n,r,o=new X(16)){return o[0]=2/(e-t),o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/(i-s),o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2/(n-r),o[11]=0,o[12]=(t+e)/(t-e),o[13]=(s+i)/(s-i),o[14]=(n+r)/(n-r),o[15]=1,o}function Y(t,e,s,i,n=new X(16)){var r=t[0],o=t[1],h=t[2],a=t[3],c=t[4],l=t[5],d=t[6],u=t[7],m=t[8],f=t[9],g=t[10],p=t[11],_=t[12],y=t[13],w=t[14],v=t[15];return t!==n&&(n[0]=r,n[1]=o,n[2]=h,n[3]=a,n[4]=c,n[5]=l,n[6]=d,n[7]=u,n[8]=m,n[9]=f,n[10]=g,n[11]=p),n[12]=r*e+c*s+m*i+_,n[13]=o*e+l*s+f*i+y,n[14]=h*e+d*s+g*i+w,n[15]=a*e+u*s+p*i+v,n}const K=[0,0,0,1,1,0,1,0,0,1,1,1];function Z(e,s,i){const n=t,r=e[n(625)]();if(e[n(788)](r,Q($(e,e.VERTEX_SHADER,s))),e.attachShader(r,Q($(e,e[n(1664)],i))),e[n(644)](r),e.getProgramParameter(r,e[n(1083)]))return r;console[n(1101)](e[n(1246)](r)),e.deleteProgram(r)}function $(e,s,i){const n=t,r=Q(e[n(491)](s));if(e[n(414)](r,i),e[n(860)](r),e.getShaderParameter(r,e[n(1441)]))return r;console[n(1101)](e[n(1242)](r),{source:i}),e.deleteShader(r)}function Q(t){if(!t)throw new Error("value must not be falsy");return t}function tt(){return[new Float32Array(16),new Float32Array(16)]}function et(e,s,i,n,r){const o=t;J(0,e[o(544)].width,e.canvas[o(897)],0,-1,1,r[0]),Y(r[0],Math.round(e[o(544)][o(956)]/2)-i.width/2*n[o(1347)]+n.x*n.zoom,Math.round(e[o(544)][o(897)]/2)-i[o(897)]/2*n[o(1347)]+n.y*n[o(1347)],0,r[1]),e[o(469)](s,!1,r[1])}function st(e,s=e[t(544)].width,i=e[t(544)][t(897)]){const n=t,r=Q(e[n(832)]());return e.bindTexture(e[n(1617)],r),e[n(585)](e[n(1617)],e[n(1584)],e[n(341)]),e.texParameteri(e[n(1617)],e.TEXTURE_WRAP_T,e[n(341)]),e[n(585)](e.TEXTURE_2D,e[n(1099)],e[n(659)]),e[n(585)](e[n(1617)],e[n(1391)],e[n(659)]),e.texImage2D(e[n(1617)],0,e[n(1589)],s,i,0,e[n(1589)],e.UNSIGNED_BYTE,null),r}const it="#version 300 es\nlayout (location = 0"+t(938)+"u_matrix"+t(1040)+"u_matrix * a_position;\n}";class nt extends e.JT{constructor(e,s,i){const n=t;super(),this[n(1476)]=e,this[n(596)]=s,this._viewportService=i,this[n(1340)]=2,this[n(753)]=new Float32Array(8),this[n(375)]=tt(),this[n(750)]=!0,this[n(1345)]=!0;const r=this[n(1476)];this[n(1572)]=Q(Z(r,it,"#version 300 es\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = vec4(0, 0, 0, 1);\n}")),this._vertexArrayObject=Q(r[n(327)]()),r[n(1451)](this._vertexArrayObject),this._positionBuffer=Q(r[n(1225)]()),this[n(1472)]=Q(r[n(1724)](this[n(1572)],n(1449))),r[n(1004)](r.ARRAY_BUFFER,this._positionBuffer),r.enableVertexAttribArray(0),r[n(408)](0,2,r[n(720)],!1,0,0),this[n(1700)](this[n(596)][n(1155)]((()=>{const t=n;this._positionsNeedsUpdate=!0,this[t(1345)]=!0}))),this[n(1700)](this[n(1672)][n(1134)]((()=>{const t=n;this._matrixNeedsUpdate=!0,this[t(750)]=!0})))}render(){const e=t,s=this[e(596)][e(1342)];if(!s)return;const i=this._gl;i[e(1522)](this[e(1572)]),i[e(1451)](this[e(918)]),this[e(1733)](i,s,this._viewportService),this[e(665)](i,s,this[e(1672)]),i.drawArrays(i[e(1575)],0,4)}[t(1733)](e,s,i){const n=t;this[n(750)]&&(e[n(1451)](this[n(918)]),e.bindBuffer(e[n(829)],this[n(1279)]),this[n(753)][0]=this[n(753)][2]=-.5,this[n(753)][1]=this._positionsArray[7]=-.5,this[n(753)][4]=this[n(753)][6]=s[n(956)]*i[n(1347)]+.5,this[n(753)][3]=this._positionsArray[5]=s[n(897)]*i[n(1347)]+.5,e[n(1141)](e[n(829)],this._positionsArray,e[n(668)]),this[n(750)]=!1)}[t(665)](e,s,i){const n=t;this[n(1345)]&&(et(e,this[n(1472)],s,i,this[n(375)]),this[n(1345)]=!1)}}var rt=s(3318),ot=s.n(rt),ht=s(3716),at=s.n(ht),ct=s(4738),lt=s.n(ct),dt=s(7542),ut=s.n(dt),mt=s(98),ft=s.n(mt),gt=s(7034),pt=s.n(gt);const _t=new Map([[t(361),1],["darken",3],[t(820),4],[t(1722),6],[t(1112),8],["screen",9],[t(1368),11],["overlay",13],[t(1156),14],[t(746),20],[t(728),21]]),yt=new Int32Array([0,1,2,3,4,5,6]);let wt=0;class vt extends e.JT{constructor(e,s,i,n){const r=t;super(),this[r(1476)]=e,this[r(596)]=s,this[r(514)]=i,this[r(1672)]=n,this.order=1,this._frameBufferTextures=[],this._renderLayers=new Map,this[r(1486)]=new Float32Array(2),this[r(1548)]=new Int32Array(8);const o=this[r(1476)];this[r(1572)]=Q(Z(o,at(),ot())),this[r(918)]=Q(o[r(327)]()),o[r(1451)](this[r(918)]),0===wt&&(wt=o[r(1354)](o[r(1535)]));const h=o[r(724)](this._program,"a_position");this._positionBuffer=Q(o[r(1225)]()),o[r(1004)](o.ARRAY_BUFFER,this[r(1279)]),o.bufferData(o[r(829)],new Float32Array(K),o[r(668)]),o[r(1422)](h),o.vertexAttribPointer(h,2,o.FLOAT,!1,0,0);const a=o[r(724)](this[r(1572)],r(1306));this[r(1588)]=Q(o[r(1225)]()),o[r(1004)](o[r(829)],this[r(1588)]),o[r(1141)](o[r(829)],new Float32Array(K),o[r(668)]),o[r(1422)](a),o[r(408)](a,2,o[r(720)],!1,0,0),this[r(528)]=Q(o[r(1724)](this[r(1572)],"a")),this[r(864)]=Q(o.getUniformLocation(this[r(1572)],"b")),this._layerBlendModesUniformLocation=Q(o[r(1724)](this[r(1572)],"c")),this[r(424)]=Q(o[r(1724)](this[r(1572)],"l")),this[r(559)]=Q(o[r(1724)](this[r(1572)],"n")),this[r(968)]=Q(o[r(1724)](this._program,"m")),this[r(1024)]=Q(o.getUniformLocation(this[r(1572)],"h")),this[r(1092)]=Q(o[r(1724)](this._program,"d")),this[r(1152)]=Q(o.getUniformLocation(this[r(1572)],"f")),this[r(1662)]=Q(o[r(1724)](this[r(1572)],"g")),this._layerTexturesUniformLocation=Q(o.getUniformLocation(this[r(1572)],"j")),this._isStencilUniformLocation=Q(o[r(1724)](this[r(1572)],"k")),this[r(1346)]=Q(o[r(828)]()),this[r(1728)]=Q(o.createTexture()),o[r(503)](o.TEXTURE0),o[r(598)](o[r(1617)],this[r(1728)]),o[r(585)](o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o[r(1182)]),o.texParameteri(o[r(1617)],o[r(1391)],o[r(659)]),o[r(585)](o[r(1617)],o[r(1584)],o[r(341)]),o[r(585)](o[r(1617)],o[r(506)],o[r(341)]),o[r(1430)](o[r(1617)],0,o[r(1589)],1,1,0,o.RGBA,o.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),this[r(1700)](this._imageService[r(1134)]((t=>this._updateAttributeBuffers(t)))),this[r(1700)](this[r(596)][r(1155)]((()=>{const t=r;this[t(1733)](),this[t(1178)]()}))),this[r(1700)](this[r(1672)][r(878)]((()=>{this._updateUniformValueZoom()}))),this[r(1733)](),this[r(1178)](),this[r(1710)]()}[t(911)](){const e=t,s=this[e(1476)];for(;this[e(352)][e(823)]>0;)s[e(715)](this[e(352)][e(660)]());this[e(1698)]&&(s[e(1658)](this[e(1698)]),this[e(1698)]=void 0),this[e(486)]?.resize(),this[e(941)]?.resize(),this[e(1710)]()}render(){const e=t,s=this[e(596)][e(1116)];if(0===s[e(823)])return;const n=this[e(1476)];n[e(1522)](this[e(1572)]),n[e(1451)](this[e(918)]),n[e(1263)](n[e(666)],null),n[e(1042)](n[e(459)]);const r=this[e(1672)],o=this[e(596)];let h=-1,a=null;const c=[],l=[],d=[],u=[];let m=!1;for(const t of s){if(!t[e(842)])continue;const s=this[e(1665)][e(399)](t.id);if(s){const r=t===this[e(596)][e(1342)];let o;r?o=l:m?((0===u.length||7===u[u[e(823)]-1][0][e(823)])&&u.push([]),o=u[u.length-1]):((0===c.length||7===c[c[e(823)]-1][0][e(823)])&&c[e(1568)]([]),o=c[c.length-1]);for(let t=0;t<s[e(1405)][e(823)];t++)!o[t]&&(o[t]=[]),o[t][e(1568)](s[e(1405)][t]);if(r&&(m=!0,"moving"===t[e(1233)]?.type&&t[e(1233)][e(581)][e(1716)][e(1194)])){const s=t[e(1233)];if(this[e(951)]?.temporaryLayer!==s){if(this[e(951)]?.[e(1296)]){for(const t of this[e(951)][e(1296)][e(1405)])n[e(715)](t[e(1118)]);this[e(951)]=void 0}const t=(s[e(773)]?.isReady?s[e(773)]?.resource:void 0)||s[e(581)].image[e(1515)],r=Q(n.createTexture());n[e(503)](n[e(1675)]+0),n[e(598)](n[e(1617)],r),n[e(585)](n[e(1617)],n[e(1099)],n.LINEAR),n[e(585)](n[e(1617)],n[e(1391)],n[e(659)]),n.texParameteri(n[e(1617)],n.TEXTURE_WRAP_S,n[e(341)]),n.texParameteri(n[e(1617)],n[e(506)],n[e(341)]),n[e(1430)](n[e(1617)],0,n[e(1589)],t.width,t[e(897)],0,n.RGBA,n[e(1695)],t.data),this._cachedMovingLayer={temporaryLayer:s,renderLayer:{tiles:[{blendMode:_t[e(399)](this[e(596)].currentLayer[e(1426)]),texture:r,textureImage:t,range:(0,i.DI)(t[e(956)],t[e(897)]),width:t[e(956)],height:t[e(897)],scaledWidth:s[e(1583)].scaledWidth,scaledHeight:s[e(1583)][e(299)],offsetX:s[e(1583)][e(1049)],offsetY:s[e(1583)][e(760)]}]}}}else{const t=this._cachedMovingLayer[e(1296)][e(1405)][0];if(t.offsetX=s[e(1583)][e(1049)],t[e(760)]=s[e(1583)][e(760)],t[e(1426)]=_t[e(399)](this[e(596)][e(1342)][e(1426)]),t.scaledWidth=s[e(1583)][e(1536)],t.scaledHeight=s[e(1583)].scaledHeight,s.scaledImage?.isReady&&t[e(1508)]!==s[e(773)].resource){n[e(715)](t.texture);const i=Q(n.createTexture());n[e(503)](n[e(1675)]+0),n[e(598)](n[e(1617)],i),n.texParameteri(n[e(1617)],n[e(1099)],n.LINEAR),n[e(585)](n.TEXTURE_2D,n[e(1391)],n.NEAREST),n[e(585)](n[e(1617)],n[e(1584)],n.CLAMP_TO_EDGE),n[e(585)](n[e(1617)],n[e(506)],n.CLAMP_TO_EDGE),n[e(1430)](n[e(1617)],0,n[e(1589)],s[e(773)][e(1515)].width,s[e(773)][e(1515)][e(897)],0,n[e(1589)],n[e(1695)],s.scaledImage.resource[e(969)]),t[e(1118)]=i,t[e(1508)]=s.scaledImage[e(1515)]}}0!==this[e(951)][e(1296)][e(1405)][0].scaledHeight&&0!==this._cachedMovingLayer[e(1296)][e(1405)][0].scaledWidth&&d.push(this[e(951)].renderLayer.tiles)}}}const f=[];f[e(1568)](...c),l[e(823)]>0&&f[e(1568)](l),d.length>0&&f[e(1568)](d),f.push(...u);for(const[t,s]of f[e(683)]()){let i;if(t<f.length-1?(i=this[e(1656)](n,++h),n[e(1263)](n[e(666)],this[e(1346)]),n[e(1355)](n[e(666)],n.COLOR_ATTACHMENT0,n[e(1617)],i,0)):n[e(1263)](n.FRAMEBUFFER,null),s===l&&"rectangle"===this[e(596)][e(1342)].temporaryLayer?.[e(1549)]){const c=this[e(596)][e(1342)][e(1233)];!i&&(i=this._getFrameBufferTexture(n,++h),n[e(1263)](n[e(666)],this[e(1346)]),n[e(1355)](n[e(666)],n[e(557)],n[e(1617)],i,0)),this[e(1046)](n,s,!1,!1,o,r),n[e(598)](n[e(1617)],null),!this[e(941)]&&(this[e(941)]=new xt(n,this[e(1672)]));const l=_t[e(399)](c[e(1583)][e(1426)]),d=c.getRanges(this[e(514)][e(312)]),u=this[e(941)].draw(this[e(596)][e(1342)],d);!this[e(486)]&&(this[e(486)]=new bt(n)),t<f[e(823)]-1?(i=this._blendShader.blend(i,u,l),a&&(i=this[e(486)][e(1069)](a,i,s[0][0].blendMode))):a?(i=this[e(486)][e(1069)](i,u,l),this[e(486)][e(1069)](a,i,s[0][0][e(1426)],!1)):this[e(486)][e(1069)](i,u,l,!1),n[e(1522)](this[e(1572)]),n[e(1451)](this[e(918)])}else s===l&&d[e(823)]>0?(n.activeTexture(n[e(1675)]+7),n[e(598)](n.TEXTURE_2D,a||this._nullTexture),this[e(1698)]?n[e(427)](n[e(1437)],this[e(1698)]):(this._frameBufferRenderBuffer=Q(n[e(290)]()),n.bindRenderbuffer(n.RENDERBUFFER,this[e(1698)]),n[e(300)](n[e(1437)],n.DEPTH_STENCIL,n[e(544)][e(956)],n[e(544)][e(897)])),n[e(1455)](n[e(666)],n[e(1494)],n.RENDERBUFFER,this._frameBufferRenderBuffer),n[e(1632)](n[e(539)]|n[e(1072)]|n[e(1022)]),n.enable(n.STENCIL_TEST),n[e(940)](n[e(975)],1,255),n[e(405)](n.KEEP,n[e(446)],n[e(849)]),n[e(1674)](!1,!1,!1,!1),this._renderTileSet(n,d,!1,!0,o,r),n[e(940)](n.NOTEQUAL,1,255),n[e(405)](n.KEEP,n[e(446)],n[e(446)]),n[e(1674)](!0,!0,!0,!0),this._renderTileSet(n,s,!1,!1,o,r),n[e(598)](n[e(1617)],null),n[e(1042)](n[e(729)]),a&&(n[e(1455)](n[e(666)],n[e(1494)],n[e(1437)],null),n[e(427)](n.RENDERBUFFER,null),!this[e(486)]&&(this[e(486)]=new bt(n)),i=this[e(486)][e(1069)](a,i,s[0][0][e(1426)]),n.useProgram(this[e(1572)]),n[e(1451)](this[e(918)]))):(n[e(503)](n.TEXTURE0+7),n[e(598)](n[e(1617)],a||this[e(1728)]),this[e(1046)](n,s,!!a,!1,o,r),n[e(598)](n[e(1617)],null));i&&(a=i)}}[t(1656)](e,s){const i=t;for(;this[i(352)][i(823)]<s+1;)this._frameBufferTextures.push(st(e));return this[i(352)][s]}[t(1046)](e,s,i,n,r,o){const h=t,a=new Float32Array(16),c=Math[h(309)](e[h(544)][h(956)]/2)-r[h(956)]/2*o[h(1347)]+o.x*o.zoom,l=Math[h(309)](e[h(544)].height/2)-r.height/2*o[h(1347)]+o.y*o[h(1347)];for(const t of s){const s=t[0];Y(this._clipspaceToCanvasCoordsMatrix,c+s[h(312)].left*o[h(1347)],l+s.range[h(362)]*o[h(1347)],0,a),e[h(705)](this[h(424)],e.canvas[h(956)],e[h(544)][h(897)]),e.uniform1i(this[h(559)],7),e[h(647)](this[h(968)],i?1:0),e.uniformMatrix4fv(this[h(528)],!1,a),e.uniform1iv(this[h(1294)],yt),e[h(705)](this[h(864)],this[h(1486)][0],this[h(1486)][1]);let d=0;for(;d<t[h(823)];d++)this[h(1548)][d]=t[d][h(1426)],e.activeTexture(e.TEXTURE0+d),e.bindTexture(e.TEXTURE_2D,t[d][h(1118)]);for(;d<=6;d++)e[h(503)](e.TEXTURE0+d),e[h(598)](e[h(1617)],this[h(1728)]);e[h(721)](this[h(520)],this[h(1548)]),e.uniform1i(this._layerCountUniformLocation,t[h(823)]),e[h(705)](this[h(1092)],s[h(1049)]||0,s[h(760)]||0),e[h(705)](this[h(1152)],s.scaledWidth??s.width,s[h(299)]??s[h(897)]),e[h(705)](this[h(1662)],r[h(956)],r[h(897)]),e[h(647)](this._isStencilUniformLocation,n?1:0),e[h(672)](e[h(465)],0,6)}}[t(1733)](e){const s=t;if(0===this[s(596)].layers.length)return;const i=this[s(1476)];i[s(1451)](this._vertexArrayObject);for(const t of this[s(596)][s(1116)])this[s(466)](i,t,e)}[t(466)](e,s,i){const n=t;e[n(1451)](this[n(918)]);let r=this[n(1665)][n(399)](s.id);!r&&(r={tiles:[]},this[n(1665)].set(s.id,r)),this[n(1344)](e,r,s,i)}[t(1344)](e,s,n,r){const o=t,h=n[o(956)],a=Math[o(606)](n[o(897)]/128);let c=0;for(let t=0;t<a;t++){const l=c,d=Math[o(309)](n[o(897)]/a*(t+1)),u=d-c;c=d;const m={top:l,bottom:d,left:0,right:h};if(s[o(1405)][t]){if(r&&!(0,i.b8)(r,m))continue;e.deleteTexture(s.tiles[t][o(1118)])}const f=Q(e[o(832)]());s.tiles[t]={width:h,height:u,range:m,texture:f,blendMode:_t[o(399)](n[o(1426)])||1},n[o(1049)]&&(s[o(1405)][t][o(1049)]=n[o(1049)]),n[o(760)]&&(s[o(1405)][t][o(760)]=n[o(760)]),e[o(503)](e.TEXTURE0+0),e.bindTexture(e[o(1617)],f),e[o(585)](e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e[o(585)](e[o(1617)],e.TEXTURE_MAG_FILTER,e[o(659)]),e[o(585)](e[o(1617)],e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e[o(585)](e[o(1617)],e.TEXTURE_WRAP_T,e[o(341)]),e[o(1430)](e[o(1617)],0,e.RGBA,h,u,0,e[o(1589)],e.UNSIGNED_BYTE,n[o(969)],l*n[o(956)]*4)}}[t(1178)](){const e=t;this[e(1486)][0]=this[e(1672)][e(1347)]*this[e(596)].width,this[e(1486)][1]=this[e(1672)].zoom*this[e(596)][e(897)]}_updateUniformValueMatrix(){const e=t;this[e(1673)]=J(0,this[e(1476)][e(544)][e(956)],this[e(1476)][e(544)][e(897)],0,-1,1)}}class bt{constructor(e){const s=t;this[s(1476)]=e;const i=this[s(1476)];this[s(1572)]=Q(Z(i,ut(),lt())),this[s(918)]=Q(i[s(327)]()),i[s(1451)](this._vertexArrayObject),this[s(1346)]=Q(i[s(828)]()),this[s(1191)]=st(i),i[s(1263)](i[s(666)],this[s(1346)]);const n=i[s(1225)]();i[s(1004)](i[s(829)],n),i[s(1141)](i[s(829)],new Float32Array([-1,-1,-1,1,1,-1,1,-1,-1,1,1,1]),i[s(668)]),i[s(1422)](0),i.vertexAttribPointer(0,2,i.FLOAT,!1,0,0),this[s(1491)]=Q(i[s(1724)](this[s(1572)],"b")),this._textureBUniformLocation=Q(i.getUniformLocation(this[s(1572)],"c")),this[s(357)]=Q(i.getUniformLocation(this[s(1572)],"a"))}[t(1069)](e,s,i,n=!0){const r=t,o=this[r(1476)];return o.useProgram(this[r(1572)]),o[r(1451)](this._vertexArrayObject),n?(o[r(1263)](o[r(666)],this[r(1346)]),o[r(1355)](o.FRAMEBUFFER,o[r(557)],o[r(1617)],this[r(1191)],0)):o[r(1263)](o.FRAMEBUFFER,null),o[r(503)](o.TEXTURE0),o[r(598)](o.TEXTURE_2D,e),o.uniform1i(this[r(1491)],0),o[r(503)](o.TEXTURE0+1),o[r(598)](o.TEXTURE_2D,s),o[r(647)](this[r(1080)],1),o[r(647)](this._blendModeUniformLocation,i),o[r(672)](o.TRIANGLES,0,6),o[r(503)](o[r(1675)]),o.bindTexture(o.TEXTURE_2D,null),o[r(503)](o[r(1675)]+1),o[r(598)](o.TEXTURE_2D,null),o.bindFramebuffer(o[r(666)],null),this._frameBufferTexture}[t(911)](){const e=t;this[e(1476)][e(715)](this[e(1191)]),this[e(1191)]=st(this[e(1476)])}}class xt{constructor(e,s){const i=t;this[i(1476)]=e,this[i(1672)]=s,this._workMatrices=tt();const n=this._gl;this[i(1572)]=Q(Z(n,pt(),ft())),this[i(918)]=Q(n[i(327)]()),n[i(1451)](this._vertexArrayObject),this._colorUniformLocation=Q(n.getUniformLocation(this[i(1572)],"c")),this[i(528)]=Q(n[i(1724)](this[i(1572)],"a")),this[i(1210)]=Q(n[i(1724)](this._program,"b")),this[i(1346)]=Q(n[i(828)]()),this[i(1191)]=st(n),n[i(1263)](n[i(666)],this[i(1346)]),this[i(566)]=Q(n[i(1225)]()),n[i(1004)](n[i(829)],this[i(566)]),n[i(1422)](0),n[i(408)](0,2,n[i(720)],!1,0,0)}[t(1245)](e,s){const i=t,n=this[i(1476)];n[i(1522)](this[i(1572)]),n[i(1451)](this[i(918)]),n[i(1263)](n[i(666)],this._frameBuffer),n[i(1355)](n[i(666)],n[i(557)],n[i(1617)],this[i(1191)],0),n[i(1632)](n[i(539)]),et(n,this[i(528)],e,this[i(1672)],this._workMatrices),n[i(705)](this._zoomUniformLocation,this[i(1672)][i(1347)],this[i(1672)][i(1347)]);for(const t of s){n.uniform4f(this[i(513)],t[i(927)][0]/255,t[i(927)][1]/255,t[i(927)][2]/255,t[i(927)][3]/255),n[i(1004)](n[i(829)],this[i(566)]);const e=new Float32Array(12*t.ranges[i(823)]);for(let s=0;s<t.ranges.length;s++){const n=t[i(498)][s],r=12*s;e[r]=e[r+2]=e[r+8]=n.left,e[r+1]=e[r+5]=e[r+7]=n[i(362)],e[r+4]=e[r+6]=e[r+10]=n[i(1702)],e[r+3]=e[r+9]=e[r+11]=n[i(955)]}n[i(1141)](n[i(829)],e,n[i(1290)]),n[i(672)](n[i(465)],0,e[i(823)]/2)}return this[i(1191)]}[t(911)](){const e=t;this[e(1476)][e(715)](this._frameBufferTexture),this._frameBufferTexture=st(this[e(1476)])}}const St=t(1135)+0+") in vec4 a_position;\n\nuniform mat4 "+t(1449)+t(1040)+"u_matrix"+t(589),Ct="#version 300 es\nprecision mediump float;\n\nuniform vec4 u_color;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = u_color"+t(1529);class Et extends e.JT{constructor(e,s,i){const n=t;super(),this._gl=e,this[n(596)]=s,this[n(1672)]=i,this.order=2,this[n(753)]=new Float32Array(48),this[n(375)]=tt(),this[n(750)]=!0,this._matrixNeedsUpdate=!0,this._backgroundColor=new Float32Array(4);const r=this[n(1476)];this._program=Q(Z(r,St,Ct)),this._vertexArrayObject=Q(r[n(327)]()),r[n(1451)](this[n(918)]),this._positionBuffer=Q(r[n(1225)]()),this[n(925)]=Q(r[n(1724)](this[n(1572)],n(701))),this._matrixLocation=Q(r.getUniformLocation(this[n(1572)],n(1449))),this.refreshTheme(),r[n(1004)](r[n(829)],this._positionBuffer),r[n(1422)](0),r[n(408)](0,2,r.FLOAT,!1,0,0),this[n(1700)](this[n(596)][n(1155)]((()=>{const t=n;this[t(750)]=!0,this[t(1345)]=!0}))),this[n(1700)](this[n(1672)].onUpdate((()=>{const t=n;this[t(1345)]=!0,this[t(750)]=!0})))}[t(1482)](){const e=t,s=function(e){const s=t;switch(e[s(823)]){case 7:return(parseInt(e[s(440)](1),16)<<8|255)>>>0;case 9:return parseInt(e.slice(1),16)>>>0}throw new Error(s(1170))}(window[e(784)](document[e(1150)]).getPropertyValue(e(892))||"#444444");this[e(535)][0]=(s>>24&255)/255,this[e(535)][1]=(s>>16&255)/255,this[e(535)][2]=(s>>8&255)/255,this[e(535)][3]=(255&s)/255}[t(1256)](){const e=t,s=this._imageService[e(1342)];if(!s)return;const i=this[e(1476)];i[e(1522)](this._program),i[e(1451)](this._vertexArrayObject),i[e(1042)](i[e(459)]),i[e(353)](this[e(925)],this[e(535)][0],this[e(535)][1],this._backgroundColor[2],this[e(535)][3]),this[e(1733)](i,s,this[e(1672)]),this[e(665)](i,s,this[e(1672)]),i[e(672)](i[e(319)],0,24)}_updateAttributeBuffers(e,s,i){const n=t;if(!this[n(750)])return;e[n(1451)](this[n(918)]),e[n(1004)](e[n(829)],this._positionBuffer);const r=this[n(500)](),o=this[n(753)];o[0]=o[2]=o[36]=o[38]=o[40]=o[44]=r[n(351)],o[4]=o[6]=o[32]=o[34]=o[42]=o[46]=0,o[8]=o[10]=o[18]=o[22]=o[26]=o[28]=o[30]=s[n(956)]*i[n(1347)],o[12]=o[14]=o[16]=o[20]=o[24]=r[n(1702)],o[1]=o[5]=o[9]=o[13]=r[n(362)],o[3]=o[7]=o[11]=o[15]=o[17]=o[19]=o[45]=o[47]=0,o[21]=o[23]=o[31]=o[35]=o[39]=o[41]=o[43]=s.height*i.zoom,o[25]=o[27]=o[29]=o[33]=o[37]=r[n(955)],e[n(1141)](e[n(829)],this._positionsArray,e[n(668)]),this[n(750)]=!1}[t(665)](e,s,i){const n=t;this[n(1345)]&&(et(e,this._matrixLocation,s,i,this._workMatrices),this[n(1345)]=!1)}[t(500)](){const e=t,s=this._screenPixelToCanvasCoord(-1,-1),i=this._screenPixelToCanvasCoord(this._gl.canvas.width,this[e(1476)][e(544)][e(897)]);return{left:s[0],top:s[1],right:i[0],bottom:i[1]}}[t(348)](e,s){const i=t,n=this[i(1476)];let r=e-n[i(544)][i(956)]/2,o=s-n[i(544)][i(897)]/2;return r+=this[i(596)][i(956)]*this[i(1672)][i(1347)]/2,o+=this._imageService[i(897)]*this[i(1672)].zoom/2,r-=this[i(1672)].x*this[i(1672)][i(1347)],o-=this[i(1672)].y*this[i(1672)].zoom,[r,o]}}const Lt=t(1135)+0+t(938)+t(1449)+t(1188)+t(1449)+t(372),It=t(1666)+t(591)+t(1084)+"u_pixelsize"+t(1308)+t(591)+" ||\n      mod(v_position.y / "+t(591)+t(1308)+t(591)+t(1523);class Tt extends e.JT{constructor(e,s,i){const n=t;super(),this[n(1476)]=e,this[n(596)]=s,this._viewportService=i,this.order=2,this[n(753)]=new Float32Array(8),this[n(375)]=tt(),this._positionsNeedsUpdate=!0,this._matrixNeedsUpdate=!0;const r=this[n(1476)];this[n(1572)]=Q(Z(r,Lt,It)),this[n(918)]=Q(r[n(327)]()),r[n(1451)](this._vertexArrayObject),this._positionBuffer=Q(r[n(1225)]()),this[n(1472)]=Q(r[n(1724)](this[n(1572)],n(1449))),this[n(1102)]=Q(r.getUniformLocation(this[n(1572)],n(591))),r[n(1004)](r[n(829)],this[n(1279)]),r[n(1422)](0),r[n(408)](0,2,r[n(720)],!1,0,0),this[n(1700)](this[n(596)][n(1155)]((()=>{const t=n;this[t(750)]=!0,this[t(1345)]=!0}))),this[n(1700)](this._viewportService.onUpdate((()=>{const t=n;this[t(1345)]=!0,this[t(750)]=!0})))}render(){const e=t,s=this[e(596)].currentLayer;if(!s)return;if(!this[e(1672)][e(776)]||this[e(1672)][e(1347)]<4)return;const i=this[e(1476)];i[e(1522)](this[e(1572)]),i[e(1451)](this[e(918)]),i[e(1373)](i[e(459)]),i[e(972)](i[e(1300)],i[e(1244)],i.ONE,i[e(1244)]),this[e(1733)](i,s,this._viewportService),this[e(665)](i,s,this[e(1672)]),i[e(1389)](this[e(1102)],this[e(1672)][e(1347)]/1),i[e(672)](i[e(436)],0,4)}_updateAttributeBuffers(e,s,i){const n=t;this[n(750)]&&(e[n(1451)](this[n(918)]),e[n(1004)](e.ARRAY_BUFFER,this[n(1279)]),this._positionsArray[4]=this[n(753)][6]=s[n(956)]*i[n(1347)],this._positionsArray[3]=this[n(753)][5]=s[n(897)]*i[n(1347)],e[n(1141)](e[n(829)],this[n(753)],e[n(668)]),this._positionsNeedsUpdate=!1)}[t(665)](e,s,i){const n=t;this._matrixNeedsUpdate&&(et(e,this[n(1472)],s,i,this._workMatrices),this._matrixNeedsUpdate=!1)}}const At="#version 300 es\nlayout (location = 0"+t(938)+t(1449)+t(1040)+"u_matrix"+t(589),Rt=t(1666)+t(1435)+t(1197)+t(1435)+t(800);class Mt extends e.JT{constructor(e,s,i,r){const o=t;super(),this[o(1476)]=e,this[o(596)]=s,this._selectionService=i,this[o(1672)]=r,this.order=2,this[o(753)]=new Float32Array(8),this._workMatrices=tt(),this[o(750)]=!1,this._matrixNeedsUpdate=!0,this._shiftValue=0,this[o(1432)]=!1,this[o(1199)]=this[o(1700)](new n.v),this[o(685)]=this._onStartAnimating[o(1053)],this._onStopAnimating=this.register(new n.v),this[o(870)]=this._onStopAnimating.event;const h=this[o(1476)];this._program=Q(Z(h,At,Rt)),this[o(918)]=Q(h[o(327)]()),h.bindVertexArray(this[o(918)]),this._positionBuffer=Q(h[o(1225)]()),this[o(1472)]=Q(h[o(1724)](this[o(1572)],o(1449))),this._shiftLocation=Q(h[o(1724)](this[o(1572)],"u_shift")),h[o(1004)](h.ARRAY_BUFFER,this[o(1279)]),h[o(1422)](0),h.vertexAttribPointer(0,2,h[o(720)],!1,0,0),this[o(1700)](this._selectionService[o(1134)]((()=>{const t=o;this[t(750)]=!0,this[t(1432)]!==!!this[t(514)][t(312)]&&(this[t(1432)]=!!this[t(514)][t(312)],this[t(1432)]?this[t(1199)][t(1448)]():this._onStopAnimating[t(1448)]())}))),this[o(1700)](this[o(596)][o(1155)]((()=>{this[o(1345)]=!0,this._positionsNeedsUpdate=!0}))),this.register(this[o(1672)][o(1134)]((()=>{this[o(1345)]=!0,this._positionsNeedsUpdate=!0})))}[t(1256)](){const e=t,s=this[e(596)].currentLayer;if(!s)return;const i=this[e(514)].range;if(!i)return;const n=this._gl;n[e(1522)](this[e(1572)]),n[e(1451)](this[e(918)]),n.enable(n[e(459)]),n[e(884)](n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this[e(1733)](n,i,this._viewportService),this[e(665)](n,s,this._viewportService),n.drawArrays(n[e(1575)],0,4)}[t(769)](){const e=t;this[e(504)](this[e(1476)])}[t(1733)](e,s,i){const n=t;this._positionsNeedsUpdate&&(e[n(1451)](this._vertexArrayObject),e[n(1004)](e.ARRAY_BUFFER,this[n(1279)]),this[n(753)][0]=this[n(753)][2]=s[n(351)]*i[n(1347)]-.5,this[n(753)][4]=this[n(753)][6]=s[n(1702)]*i.zoom+.5,this[n(753)][1]=this[n(753)][7]=s.top*i[n(1347)]-.5,this[n(753)][3]=this[n(753)][5]=s[n(955)]*i[n(1347)]+.5,e.bufferData(e[n(829)],this._positionsArray,e[n(668)]),this[n(750)]=!1)}[t(665)](e,s,i){const n=t;this[n(1345)]&&(et(e,this[n(1472)],s,i,this[n(375)]),this[n(1345)]=!1)}[t(504)](e){const s=t;e[s(1522)](this[s(1572)]),e.bindVertexArray(this[s(918)]),this[s(1650)]=(this._shiftValue+1)%8,e[s(1389)](this[s(1e3)],this._shiftValue)}}const Dt=t(1135)+0+") in vec4 a_position;\n\nuniform mat4 "+t(1449)+t(1040)+"u_matrix"+t(589);class Bt extends e.JT{constructor(e,s,i,n,r){const o=t;super(),this[o(1476)]=e,this[o(596)]=s,this[o(514)]=i,this[o(1254)]=n,this[o(1672)]=r,this[o(1340)]=2,this[o(409)]=new Float32Array(8),this._workMatrices=tt(),this[o(750)]=!1,this[o(1345)]=!0;const h=this[o(1476)];this[o(1572)]=Q(Z(h,Dt,"#version 300 es\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = vec4(0.5, 0.5, 1, 0.5);\n}")),this._vertexArrayObject=Q(h[o(327)]()),h.bindVertexArray(this._vertexArrayObject),this[o(1279)]=Q(h[o(1225)]()),this[o(1472)]=Q(h.getUniformLocation(this[o(1572)],"u_matrix")),h.bindBuffer(h[o(829)],this._positionBuffer),h[o(1422)](0),h[o(408)](0,2,h[o(720)],!1,0,0),this[o(1700)](this._selectionService[o(1134)]((()=>this._positionsNeedsUpdate=!0))),this[o(1700)](this[o(1672)].onUpdate((()=>{this._positionsNeedsUpdate=!0,this._matrixNeedsUpdate=!0})))}[t(1256)](){const e=t,s=this[e(596)][e(1342)];if(!s)return;if(!this._toolService[e(1303)]?.[e(856)])return;const i=this._selectionService[e(312)];if(!i)return;const n=this[e(1476)];n[e(1522)](this[e(1572)]),n[e(1451)](this._vertexArrayObject),function(e,s){const i=t;switch(s){case"normal":e.enable(e.BLEND),e[i(972)](e[i(1300)],e[i(1244)],e[i(1055)],e[i(1244)]);break;default:throw new Error(i(1497))}}(n,e(361)),this[e(1733)](n,i,this[e(1672)]),this[e(665)](n,s,this._viewportService),n[e(672)](n[e(436)],0,4)}[t(1733)](e,s,i){const n=t;this[n(750)]&&(e[n(1004)](e[n(829)],this[n(1279)]),this[n(409)][0]=this[n(409)][2]=s[n(351)]*i[n(1347)],this[n(409)][4]=this[n(409)][6]=s[n(1702)]*i[n(1347)],this[n(409)][1]=this[n(409)][7]=s.top*i[n(1347)],this[n(409)][3]=this[n(409)][5]=s[n(955)]*i.zoom,e.bufferData(e[n(829)],this._positionArray,e[n(1290)]),this[n(750)]=!1)}[t(665)](e,s,i){const n=t;this[n(1345)]&&(et(e,this[n(1472)],s,i,this[n(375)]),this._matrixNeedsUpdate=!1)}}class Ut extends e.JT{constructor(s,i,n,r,o){const h=t;super(),this[h(1396)]=s,this._imageService=i,this._selectionService=n,this[h(1254)]=r,this[h(1672)]=o,this._renderPrograms=[],this[h(1509)]=[],this[h(1161)]=new Set,this[h(807)]=0,this[h(595)]=0,this[h(1459)]=!1,this[h(423)]=0,this[h(964)]=!1,this._toolRenderPrograms=[],this[h(1129)]=[],this._canvas=document.createElement(h(544)),this[h(1723)]=document.createElement(h(544)),this[h(1723)][h(1276)][h(384)](h(952)),this[h(1006)]=document[h(1267)](h(818)),this[h(1006)][h(1276)][h(384)]("views"),this[h(1396)][h(1175)](this._canvas,this._canvasSelection,this[h(1006)]),this[h(1700)]({dispose:()=>{const t=h;this[t(731)][t(1017)]&&this[t(1396)][t(561)](this[t(731)]),this[t(731)].parentElement&&this[t(1396)].removeChild(this[t(1723)]),this[t(1396)][t(561)](this[t(1006)])}}),this[h(1700)](this[h(1672)][h(349)](((t,e)=>{const s=h;this[s(1413)](t,e),this[s(1256)](),this.renderSelection(!0)}))),this[h(1700)](this[h(1672)][h(1134)]((()=>{const t=h;this[t(1256)](),this[t(376)](!0)}))),this[h(1700)](this._selectionService[h(1134)]((()=>this.renderSelection(!0)))),this[h(1700)](this._imageService[h(1134)]((()=>this.render()))),this[h(1700)](this._imageService[h(737)]((()=>this[h(1256)]()))),this.register(this[h(596)][h(930)]((()=>this[h(1256)]()))),this[h(1700)](this[h(1254)][h(1421)]((t=>this.setTool(t)))),this[h(1700)]((0,e.Lw)(this._canvas,h(489),(()=>this[h(960)](h(1409)))));const a=this[h(731)][h(695)](h(292),{antialias:!1,premultipliedAlpha:!1,stencil:!0});if(!a){const t=h(655);throw this._showError(t),new Error(t)}this[h(1476)]=a,this[h(1179)]=Q(this[h(1723)].getContext("webgl2",{antialias:!1})),this[h(1413)](this[h(1396)][h(1648)],this[h(1396)][h(1295)]),this[h(1476)][h(366)](0,0,0,0),this[h(1476)][h(1632)](this[h(1476)][h(539)]),this[h(1179)].clearColor(0,0,0,0),this[h(1179)][h(1632)](this._gl[h(539)]),this[h(1577)][h(1568)](new Et(this[h(1476)],this._imageService,this[h(1672)])),this[h(1577)][h(1568)](new nt(this._gl,this[h(596)],this._viewportService)),this[h(316)]=new vt(this[h(1476)],this[h(596)],this._selectionService,this[h(1672)]),this._renderPrograms[h(1568)](new Tt(this._gl,this._imageService,this[h(1672)])),this[h(1509)][h(1568)](new Bt(this[h(1179)],this[h(596)],this._selectionService,this._toolService,this[h(1672)])),this[h(1509)][h(1568)](new Mt(this[h(1179)],this._imageService,this._selectionService,this[h(1672)]));for(const t of this._animationRenderPrograms)t.onStartAnimating&&t[h(870)]&&(t[h(685)]((()=>this[h(995)](t))),t[h(870)]((()=>this[h(1070)](t))));this.render();let c=this[h(596)][h(1134)]((()=>{const t=h;this._container[t(1276)].add(t(651)),c?.[t(921)](),c=void 0}));this[h(1700)]({dispose:()=>c?.[h(921)]()});const l=new MutationObserver((()=>{const t=h;for(const e of this[t(1577)])e[t(1482)]&&e[t(1482)]();this[t(1256)]()}));l[h(1498)](document[h(1150)],{attributes:!0,attributeFilter:[h(735)]}),this.register({dispose:()=>l.disconnect()})}[t(1413)](e,s){const i=t,n=Math[i(606)](e),r=Math[i(606)](s);this[i(731)].width=n,this[i(731)][i(897)]=r,this[i(1723)].width=n,this[i(1723)][i(897)]=r,this[i(1476)][i(977)](0,0,n,r),this[i(1179)][i(977)](0,0,n,r),this._viewsElement[i(735)].position="absolute",this._viewsElement[i(735)][i(351)]="0",this[i(1006)][i(735)][i(362)]="0",this._viewsElement[i(735)][i(1702)]="0",this[i(1006)].style.bottom="0",this[i(316)]?.[i(911)]()}pause(){this[t(964)]=!0}resume(){const e=t;this._isPaused&&(this._isPaused=!1,this[e(1256)](),this[e(376)](!0))}[t(1256)](){const e=t;0===this[e(807)]&&(this[e(807)]=window.requestAnimationFrame((()=>this[e(1323)]())))}[t(376)](e=!1){const s=t;if(this[s(964)]&&!e)return window[s(1158)](this[s(595)]),void(this[s(595)]=0);this._forceSelectionAnimation=this[s(1459)]||e,0===this._selectionAnimationFrame&&(this[s(595)]=window[s(1649)]((()=>this[s(546)]())))}_render(){const e=t;this._renderProgramsWithOrder(this[e(1577)],1),!this[e(1254)][e(1303)]?.[e(856)]&&this[e(1579)](this._toolRenderPrograms,1),this[e(316)].render(),this[e(1579)](this[e(1577)],2),!this._toolService[e(1303)]?.[e(856)]&&this[e(1579)](this._toolRenderPrograms,2),this[e(807)]=0}[t(546)](){const e=t,s=!!this[e(514)][e(312)];if(this[e(1723)][e(735)][e(1671)]=s?"block":e(973),this[e(595)]=0,!s)return void(this[e(1459)]=!1);const i=this._lastAnimationFrame<=Date[e(531)]()-50;if(!this[e(1459)]&&!i)return this[e(1459)]=!1,void this[e(376)]();if(this._forceSelectionAnimation=!1,i){for(const t of this[e(1509)])t[e(769)]&&t[e(769)]();this[e(423)]=Date[e(531)]()}this[e(1161)][e(461)]>0&&this._renderProgramsWithOrder(this._animationRenderPrograms,2),this[e(1254)][e(1303)]?.isSelectionTool&&this._renderProgramsWithOrder(this[e(617)],2),this[e(376)]()}[t(1579)](e,s){const i=t;for(const t of e)t[i(1340)]===s&&t[i(1256)]()}[t(995)](e){const s=t;this[s(1161)][s(384)](e),this[s(376)]()}_stopAnimatingProgram(e){const s=t;this[s(1161)][s(844)](e)}[t(1569)](s){const i=t;(0,e._c)(this._toolDisposables),this._toolDisposables.length=0;for(const t of this._toolRenderPrograms)t[i(921)]&&t.dispose();let n;this[i(617)][i(823)]=0,s[i(1012)]?n=s[i(1012)](this[i(1476)]):s.createDomRenderProgram&&(n=s[i(1717)](this._viewsElement)),n&&(Array[i(797)](n)?this[i(617)][i(1568)](...n):this[i(617)][i(1568)](n),s[i(737)]&&this[i(1129)][i(1568)](s[i(737)]((()=>this[i(1256)]())))),n&&this[i(1256)]()}[t(960)](e){const s=t;this[s(731)].parentElement&&this._container[s(561)](this[s(731)]);const i=document[s(1267)](s(818));i[s(576)]=e,i[s(735)][s(1434)]=s(1734),i[s(735)][s(351)]="50%",i[s(735)][s(362)]=s(1619),i[s(735)][s(1576)]="translate(-50%, -50%)",this[s(1396)][s(1276)][s(676)]("loaded"),this[s(1396)].appendChild(i)}}class kt extends e.JT{constructor(e,s,i,n,r){const o=t;super(),this[o(677)]=e,this[o(596)]=s,this._selectionService=i,this[o(1254)]=n,this._viewportService=r,this[o(1700)](this[o(677)][o(669)]((t=>this._attach(t)))),this.register({dispose:()=>this[o(1317)]?.[o(921)]()})}[t(1256)](){this[t(1317)]?.render()}[t(437)](){this[t(1317)]?.pause()}[t(1453)](){const e=t;this._renderer?.[e(1453)]()}[t(1360)](e){const s=t;this[s(1317)]?.dispose(),this[s(1317)]=new Ut(e,this[s(596)],this[s(514)],this[s(1254)],this[s(1672)])}}class Pt{constructor(e,s,i,n,r){const o=t;this[o(514)]=e,this[o(1095)]=s,this[o(1595)]=i,this[o(534)]=n,this[o(1162)]=r,this[o(1549)]=o(1098),this[o(942)]=0}[t(1293)](){const e=t;this[e(354)](this[e(534)])}[t(344)](){this[t(354)](this._redoRange)}[t(354)](e){const s=t;this[s(514)].range=e?{left:e[s(351)],top:e[s(362)],right:e[s(1702)],bottom:e[s(955)]}:void 0}serialize(){const e=t;return{id:e(1098),operationName:this[e(1095)],requiresTool:this[e(1595)],undoRange:this[e(534)],redoRange:this[e(1162)]}}static[t(532)](e,s){const i=t;return new Pt(e,s[i(1095)],s[i(1595)],s[i(534)],s.redoRange)}}class Nt extends e.JT{constructor(e,s){const i=t;super(),this[i(596)]=e,this[i(664)]=s,this[i(643)]=this[i(1700)](new n.v),this[i(1134)]=this[i(643)][i(1053)],this[i(664)][i(568)](i(1098),{undo:t=>{const e=i;t[e(1293)](this[e(954)]),this[e(490)]=t[e(534)]},redo:t=>{const e=i;t[e(344)](this[e(954)]),this[e(490)]=t[e(534)]}}),this[i(664)][i(1128)](i(1098),Pt[i(532)][i(658)](null,this))}get range(){return this._range}set[t(312)](e){const s=t;if(e&&(e.left>e[s(1702)]||e[s(362)]>e[s(955)]))throw new Error(s(507)+e[s(351)]+s(1348)+e.right+s(1687)+e.top+", bottom: "+e[s(955)]);this[s(954)]=e,this[s(643)].fire()}[t(452)](e,s){const n=t;if(!this[n(954)])return;const r=(0,i.BN)(this[n(312)]);(0,i.Hd)(r,e,s),this[n(312)]=r}[t(1418)](e,s){const i=t;this[i(954)]&&(this[i(954)][i(351)]>=e||this[i(954)][i(362)]>=s||this[i(954)][i(955)]<=0||this[i(954)].right<=0?this[i(954)]=void 0:this.range={left:Math[i(839)](this[i(954)][i(351)],0),top:Math[i(839)](this[i(954)][i(362)],0),right:Math[i(584)](this[i(954)][i(1702)],e),bottom:Math.min(this._range[i(955)],s)})}deselect(){const e=t;this[e(312)]=void 0,this[e(661)](e(406))}async[t(1468)](){const e=t,s=this[e(954)];if(!s)return;const i=this[e(596)][e(1342)];i&&(await(this._imageService[e(1342)]?.[e(1543)]()),await this._historyService.createCompositeEntry(e(383),(async()=>{const t=e;await this[t(664)][t(1025)](new U.Z("Erase Selection",s,i,((e,i)=>{const n=t;for(let t=s[n(362)];t<s[n(955)];t++){const r=t*i*4;e.fill(0,r+4*s.left,r+4*s[n(1702)])}}))),this.deselect()})))}[t(448)](){const e=t;this[e(312)]={left:0,top:0,right:this[e(596)][e(956)],bottom:this[e(596)].height},this[e(661)](e(545))}[t(661)](e,s){const i=t;if(function(e,s){const i=t;return s&&e?e.left===s[i(351)]&&e[i(362)]===s.top&&e[i(1702)]===s[i(1702)]&&e[i(955)]===s[i(955)]:!e&&!s}(this._lastCommittedRange,this[i(312)]))return;const n=new Pt(this,e,s,this[i(490)],this[i(312)]);this._historyService[i(935)](n),this._lastCommittedRange=this[i(312)]}[t(1528)](e,s){const i=t;return!this[i(954)]||e>=this[i(954)].left&&e<this[i(954)][i(1702)]&&s>=this[i(954)][i(362)]&&s<this[i(954)].bottom}serialize(){return this[t(954)]}[t(1542)](e){this[t(312)]=e}}var Ft=s(7166);class Ot{constructor(e,s,i){const n=t;this[n(1095)]=e,this[n(1148)]=s,this._f=i}async run(){const e=t,s={data:(0,Ft.Qf)(this[e(1148)],(0,i.DI)(this[e(1148)].width,this._layer[e(897)])),width:this[e(1148)][e(956)],height:this._layer.height};let n;await this[e(1148)][e(1059)]((async(t,e,s)=>(n=await this._f(t,e,s),n)));const r={data:(0,Ft.Qf)(n,(0,i.DI)(n[e(956)],n[e(897)])),width:n[e(956)],height:n[e(897)]};return new L(this[e(1095)],this[e(1148)],s,r)}}class Vt{constructor(e,s,i,n){const r=t;this[r(822)]=e,this[r(596)]=s,this._width=i,this[r(601)]=n}[t(358)](){const e=t;if(this[e(596)].width===this[e(1636)]&&this[e(596)][e(897)]===this[e(601)])return;const s={width:this[e(596)].width,height:this[e(596)].height},i={width:this[e(1636)],height:this[e(601)]},n=new b(this._operationName,s,i);return n[e(344)](this[e(596)][e(911)][e(658)](this[e(596)])),n}}class Ht extends e.JT{constructor(e,s,i,r){const o=t;super(),this[o(664)]=e,this[o(596)]=s,this[o(514)]=i,this._taskWorkerService=r,this[o(1530)]=this[o(1700)](new n.v),this.onProgress=this[o(1530)][o(1053)],this[o(716)]=this.register(new n.v),this[o(1351)]=this[o(716)][o(1053)]}async[t(768)](e,s){const i=t,n=this[i(596)][i(1116)];if(0===n[i(823)])return;await this[i(716)][i(855)](this[i(1638)](e));const r={left:0,top:0,right:this[i(596)][i(956)],bottom:this[i(596)][i(897)]},o=i(1688)+zt(e);await this[i(664)][i(1039)](o,(async()=>{const t=i;let h;for(const i of n)h=await this[t(481)](e,s,i,o,r);h&&(h[t(852)].width!==r.right||h[t(852)][t(897)]!==r[t(955)])&&this._historyService.runSyncAction(new Vt(t(965),this[t(596)],h[t(852)][t(956)],h.dest[t(897)])),h?.selection!==this[t(514)][t(312)]&&(this[t(514)][t(312)]=h?.[t(1098)],this._selectionService.commit(t(698)))}))}async[t(1056)](e,s){const i=t,n=this[i(596)][i(1342)];if(!n)return;await this[i(716)][i(855)](this._getBeforeRunLayerTaskEvent(e));const r={left:0,top:0,right:n[i(956)],bottom:n[i(897)]},o=i(1079)+zt(e);await this._historyService[i(1039)](o,(async()=>{const t=i,h=await this[t(481)](e,s,n,o,r);if(h?.selection!==this[t(514)][t(312)]&&(this._selectionService[t(312)]=h?.[t(1098)],this[t(514)][t(661)](t(698))),h&&(h[t(852)][t(956)]!==r[t(1702)]||h[t(852)][t(897)]!==r[t(955)]))throw new Error(t(1132))}))}async _doExecuteOnLayer(e,s,i,r,o){const h=t;let a;return await this[h(664)][h(1025)](new Ot(r,i,(async(t,i,r)=>{const o=h,c=this[o(1541)][o(1073)](e,s,{data:t,width:i,height:r},this._selectionService.range);return(0,n.B)(c.onProgress,this._onProgress),a=await c[o(1253)],a.dest}))),a}[t(1638)](t){return{finishSelection:"layer/expandCanvasToSelection"!==t}}}function zt(e){const s=t;switch(e){case"layer/crop":return"Crop";case s(1420):return s(415);case s(602):return s(1108);case s(1085):return s(1216);case"layer/flipVertical":return s(517);case s(1384):return s(1362);case s(1676):return s(965);case"layer/resizeCanvas":return"Resize Canvas";case s(1506):return s(1713);case s(792):return s(1356);case s(783):return s(961);default:return s(1736)}}function Wt(){const e=t;return new Worker(s.p+e(859))}const qt=new Map;qt[t(1681)](t(814),(e=>e[t(312)][t(955)]-e[t(312)][t(362)])),qt[t(1681)](t(1113),(e=>e[t(1113)][t(897)])),qt.set(t(379),(e=>e.range.bottom-e[t(312)].top)),qt[t(1681)]("fillContiguous",(()=>1)),qt[t(1681)]("fillGlobal",(()=>1)),qt.set(t(1187),(e=>e[t(645)][t(897)])),qt.set(t(1192),(e=>e[t(607)][t(955)]-e[t(607)][t(362)]));let jt=!1;class Gt extends e.JT{get disableWorkers(){return jt}set[t(1048)](t){jt=t}runLayerTask(t,e,s,i){return new Jt(t,e,s,i)}[t(939)](e,s){const i=t;return new Yt(e,s,this._getJobDimension(e,s))[i(1253)]}[t(758)](e,s){const i=t,n=qt[i(399)](e);if(!n)throw new Error(i(1417)+e+'"');return n(s)}async[t(845)](e,s,i){const n=t,r={sourceImage:e,destImage:(0,Ft.uF)(s,i)};await this[n(939)]("generatePreview",r);const o=new ImageData(new Uint8ClampedArray(r[n(645)][n(969)]),r[n(645)][n(956)],r[n(645)][n(897)]);return createImageBitmap(o)}}class Xt extends e.JT{constructor(e,s){const i=t;super(),this._name=e,this[i(694)]=s,this[i(1393)]=0,this._progressTimeout=0,this[i(1530)]=this[i(1700)](new n.v),this[i(785)]=this[i(1530)].event,this[i(586)]=performance.now(),this[i(1198)]=setInterval((()=>this[i(779)]()),1e3)}[t(635)](){const e=t;this[e(1198)]&&(clearInterval(this._reportInterval),this[e(1198)]=0,this[e(779)]())}[t(1408)](e,s){const i=t;this[i(694)][e]=s,this[i(1718)]()}_queueProgress(){const e=t;!this[e(877)]&&(this[e(877)]=window.setTimeout((()=>{const t=e;this[t(441)](),this[t(877)]=0}),0))}[t(441)](){const e=t,s=this[e(694)][e(1591)](((t,e)=>t+e),0)/this[e(694)].length;this[e(1393)]!==s&&(this._onProgress[e(1448)](s),this._progressLast=s)}_logProgress(){const e=t,s=this[e(694)][e(1591)](((t,e)=>t+e),0)/this[e(694)][e(823)],i=Math[e(309)](s/.05),n=20-i;let r="["+"█"[e(1151)](i)+" "[e(1151)](n)+"]";if(1===s){const t=" "+(performance.now()-this[e(586)])[e(1127)](0)+e(1341);r="["+t[e(1571)](t[e(823)]+Math[e(1082)]((20-t[e(823)])/2),"█")[e(817)](20,"█")+"]"}console[e(480)](r+" "+Math[e(309)](100*s)[e(1462)]().padStart(3," ")+"% "+this[e(799)])}}class Jt extends Xt{constructor(e,s,n,r){const o=t,h=o(956)in s&&"height"in s;let a=h?s[o(956)]:n[o(956)],c=h?s[o(897)]:n[o(897)];switch(e){case o(1420):if(!r)throw new Error("Cannot run crop to selection without a selection");a=r[o(1702)]-r[o(351)],c=r.bottom-r[o(362)];break;case"layer/expandCanvasToSelection":if(!r)throw new Error("Cannot run expand canvas to selection without a selection");const t=(0,i.DI)(n[o(956)],n[o(897)]),e=(0,i.qi)(t,r);a=e[o(1702)]-e.left,c=e[o(955)]-e[o(362)];break;case o(792):case o(783):a=n[o(897)],c=n[o(956)]}const l=a*c*4,d=o(852)in s?s[o(852)]:{data:new Uint8Array(new SharedArrayBuffer(l)),width:a,height:c},u=[],m=Math[o(584)](navigator[o(479)]||1,Math[o(839)](d[o(897)]/100,1));super(e,new Float32Array(m));for(let t=0;t<m;t++){const i={id:t,yStart:Math[o(1082)](t/m*d[o(897)]),yEnd:Math[o(584)](Math[o(1082)]((t+1)/m*d[o(897)]),d.height),xStart:Math[o(1082)](t/m*d.width),xEnd:Math[o(584)](Math[o(1082)]((t+1)/m*d[o(956)]),d[o(956)])};u[o(1568)](this[o(1597)](e,s,n,d,r,i))}this.result=Promise[o(1358)](u).then((()=>(this[o(635)](),{selection:this.selection,dest:d})))[o(770)]((t=>{throw this[o(635)](),t}))}[t(1597)](t,e,i,n,r,o){return new Promise((async(h,a)=>{const c=a2_0x139a;let l;if(jt){const t=await s.e(174)[c(1580)](s[c(658)](s,9174));l=new Kt(t[c(1097)])}else l=new Wt;const d={type:c(1715),taskName:t,source:i,dest:n,selection:r,options:e,job:o};l[c(530)](d),l[c(1018)]=e=>{const s=c;switch(e.data[s(1549)]){case"complete":this[s(1408)](o.id,1),this[s(1098)]=e.data.selection,h(),l.terminate();break;case"error":this[s(1408)](o.id,1),a(s(1157)+t+s(1519)+e[s(969)][s(1406)]),l.terminate();break;case s(471):this._updateProgress(o.id,e.data[s(323)])}}}))}}class Yt extends Xt{constructor(e,s,i){const n=t,r=[],o=Math[n(584)](navigator[n(479)]||1,Math.max(Math[n(606)](i/100),1));super(e,new Float32Array(o));for(let t=0;t<o;t++){const h=Math.floor(t/o*i),a=Math.floor((t+1)/o*i),c={id:t,start:h,end:a,size:a-h};r.push(this[n(1597)](e,s,c))}this[n(1253)]=Promise[n(1358)](r)[n(1580)]((t=>(this[n(635)](),0===t.length?void 0:t[0])))[n(770)]((t=>{throw this[n(635)](),t}))}_createWorker(t,e,i){return new Promise((async(n,r)=>{const o=a2_0x139a;let h;if(jt){const t=await s.e(174).then(s[o(658)](s,9174));h=new Kt(t.createMessageHandler)}else h=new Wt;const a={type:o(1598),taskName:t,args:e,job:i};h[o(1018)]=e=>{const s=o;switch(e[s(969)].type){case s(900):this[s(1408)](i.id,1),n(e[s(969)][s(1253)]),h[s(1365)]();break;case s(1101):this._updateProgress(i.id,1),r(s(1157)+t+s(1519)+e[s(969)][s(1406)]),h[s(1365)]();break;case s(471):this._updateProgress(i.id,e[s(969)][s(323)])}},h.postMessage(a)}))}}class Kt{constructor(e){const s=t;this.onmessage=()=>{},this._messageHandler=e(this[s(439)][s(658)](this))}[t(530)](e){this[t(1621)]({data:e})}[t(1365)](){}[t(439)](t){this.onmessage({data:t})}}const Zt=new Map([["colorPicker",{file:t(1173)}],[t(1257),{file:t(1257)}],["fill",{file:t(318)}],[t(949),{file:"movePixels"}],[t(611),{file:t(611)}],[t(1167),{file:t(1167)}],[t(959),{file:t(959)}],[t(1098),{file:t(1098)}],[t(1347),{file:t(1347)}]]);class $t extends e.JT{constructor(e,s,i,r,o,h,a,c){const l=t;super(),this[l(664)]=e,this[l(596)]=s,this[l(678)]=i,this[l(1243)]=r,this[l(514)]=o,this[l(492)]=h,this[l(1541)]=a,this[l(1672)]=c,this._onToolChange=this.register(new n.v),this.onToolChange=this[l(1661)][l(1053)],this[l(684)]={historyService:this._historyService,imageService:this[l(596)],paletteService:this._paletteService,selectionService:this[l(514)],taskService:this[l(492)],taskWorkerService:this[l(1541)],viewportService:this._viewportService},this[l(678)][l(1280)]((t=>{const e=l;document.body[e(1276)][e(1274)](e(803),0===t[e(835)]),document[e(1556)][e(1276)][e(1274)]("mouseright",2===t[e(835)])})),this[l(678)][l(1691)]((()=>{const t=l;document[t(1556)].classList.remove(t(803)),document[t(1556)][t(1276)][t(676)](t(1149))})),this._historyService.onRequestTool((t=>this.setTool(t))),this[l(596)][l(1313)]((t=>{const e=l;t[e(1549)]===e(570)&&this[e(1569)](e(949))})),this[l(1504)](this[l(678)][l(1531)],"keyDown"),this[l(1504)](this[l(678)][l(1304)],"keyUp"),this[l(1504)](this[l(678)].onPointerDown,"pointerDown"),this._forwardEventToTool(this[l(678)][l(1269)],l(1234)),this[l(1504)](this._inputService[l(536)],l(1692)),this[l(1504)](this[l(678)][l(1691)],l(791))}get[t(1303)](){return this[t(342)]}async[t(1569)](e){const s=t;if(e===this._activeTool?.id)return;if(this[s(342)]?.dispose(),typeof e!==s(393))return void(this._activeTool=e);const i=Zt[s(399)](e);if(!i)throw new Error("Could not find builtin tool "+e);if(!i[s(686)]){const t=await this[s(456)](s(703),i[s(335)]);i[s(686)]=e=>new t(e)}const n=i.factory(this[s(684)]);this[s(342)]=n,document[s(1556)][s(1270)](s(1385),n.id),this[s(484)](n),n[s(1398)]&&n[s(1398)]((()=>this[s(484)](n))),this[s(1661)].fire(n)}[t(484)](e){const s=t;e[s(1470)]?document.body[s(1270)](s(976),e[s(1470)]):document[s(1556)][s(950)](s(976))}async[t(456)](e,i){const n=t;return(await s(1038)("./"+e+"/"+i+n(1608)))[n(583)]}[t(1504)](e,s){const i=t;this[i(1700)](e((t=>{const e=i,n=this[e(1303)]?this[e(1303)][s]:void 0;n&&n[e(658)](this[e(1303)])(t,this[e(678)]?.[e(673)])})))}[t(1383)](){return this[t(342)]?.id}[t(1542)](e){e&&this[t(1569)](e)}}var Qt=s(7896);const te=new Uint16Array([1,2,3,4,5,6,7,8,9,10,11,12,13,15,17,19,21,24,27,30,34,38,43,48,54,60,64,70,76,82,90,100]);class ee extends e.JT{constructor(e,s,i){const r=t;super(),this._elementService=e,this[r(596)]=s,this._zoom=20,this[r(1609)]=!0,this[r(1169)]=!1,this._x=0,this._y=0,this._scrollVelocity={x:0,y:0},this[r(931)]=0,this[r(643)]=this.register(new n.v),this[r(1134)]=this[r(643)][r(1053)],this[r(430)]=this.register(new n.v),this.onDimensionsChange=this[r(430)][r(1053)],this[r(680)]=this[r(1700)](new n.v),this.onPixelGridEnabledChange=this[r(680)][r(1053)],this._onZoomChange=this[r(1700)](new n.v),this[r(878)]=this._onZoomChange[r(1053)],this[r(411)]=this[r(1700)](new n.v),this[r(1696)]=this[r(411)][r(1053)],this.register(this._imageService[r(1155)]((()=>{this.x=this._x,this.y=this._y}))),this[r(1700)](this._elementService[r(669)]((t=>{const e=r;this._elementResizeObserver?.[e(626)](),this[e(905)]=new ResizeObserver((([t])=>{const s=e;this._onDimensionsChange[s(1448)](t.contentRect.width,t[s(999)][s(897)]),this[s(643)][s(1448)]()})),this._elementResizeObserver.observe(t)}))),this.register({dispose:()=>{const t=r;this[t(905)]?.[t(626)]()}}),this[r(1700)](i[r(1029)]((t=>this[r(714)](t)))),this[r(1700)](i.onPointerDownMove((t=>this[r(883)](t)))),this[r(1700)](i[r(536)]((t=>this[r(907)](t)))),this[r(1700)](i.onPointerUp((()=>this[r(556)]())))}get[t(1667)](){const e=t,s=this._elementService[e(1660)];if(!s)throw new Error(e(1376));const i=s[e(1562)]/this[e(1347)],n=s[e(333)]/this[e(1347)],r=this._imageService[e(956)]/2-this._x,o=this[e(596)][e(897)]/2-this._y;return{left:Math.max(r-i/2,0),right:Math.min(r+i/2,this[e(596)].width),top:Math.max(o-n/2,0),bottom:Math[e(584)](o+n/2,this[e(596)][e(897)])}}get[t(1347)](){const e=t;return parseFloat(this[e(412)][e(1127)](2))}set[t(1347)](e){const s=t;e<=0||(this[s(412)]=e,this[s(643)][s(1448)](),this._onZoomChange[s(1448)]())}get isPixelGridEnabled(){return this[t(1609)]}set isPixelGridEnabled(e){const s=t;e!==this[s(1609)]&&(this[s(1609)]=e,this._onUpdate[s(1448)](),this[s(680)].fire())}get x(){return this._x}set x(e){const s=t,i=this[s(596)].width/2;this._x=(0,c.u)(e,i,-i),this[s(643)][s(1448)]()}get y(){return this._y}set y(e){const s=t,i=this._imageService[s(897)]/2;this._y=(0,c.u)(e,i,-i),this[s(643)].fire()}[t(562)](t=.2){return this._multiplyZoom(t)}[t(1292)](e=.2){return this[t(1403)](-e)}[t(571)](){const e=t,s=this[e(677)][e(1660)];if(!s)return;const i=(s.offsetWidth-10)/this._imageService[e(956)],n=(s[e(333)]-10)/this._imageService[e(897)];this.zoom=Math[e(584)](i,n),this._x=0,this._y=0,this[e(1169)]=!0,this[e(643)][e(1448)]()}[t(714)](e){const s=t;if(this[s(677)][s(1660)]){if(e.ctrlKey){const t=this[s(1347)],i=Qt.V?e[s(804)]<0?this[s(562)](-e[s(804)]/20):this.zoomOut(e[s(804)]/20):e[s(804)]<0?this[s(562)]():this.zoomOut(),n=i/t;if(t!==i){const t=(e[s(1258)]-this[s(677)].element[s(1648)]/2)*(n-1),r=(e[s(1146)]-this[s(677)][s(1660)][s(1295)]/2)*(n-1);this.x-=t/i,this.y-=r/i}}else!Qt.V&&e[s(786)]?this.x-=this._normalizeWheelDelta(e[s(804)])/this.zoom:(this.x-=this[s(1634)](e[s(1614)])/this.zoom,this.y-=this._normalizeWheelDelta(e[s(804)])/this[s(1347)]);this[s(1169)]=!1,e[s(1103)]()}}[t(1634)](e){const s=t;return Qt.V?e:Math[s(1454)](e)<100?40*e:e}[t(883)](e){const s=t,i=this._elementService[s(1660)];i&&(e[s(1049)]<30?this[s(1685)].x=this[s(475)](30-e[s(1049)]):e[s(1049)]>i[s(1648)]-30?this[s(1685)].x=-this._calculateScrollVelocity(e.offsetX-i[s(1648)]-30):this[s(1685)].x=0,e[s(760)]<30?this[s(1685)].y=this._calculateScrollVelocity(30-e[s(760)]):e.offsetY>i[s(1295)]-30?this[s(1685)].y=-this._calculateScrollVelocity(e[s(760)]-i[s(1295)]-30):this._scrollVelocity.y=0,!this[s(931)]&&(this[s(1377)](),this[s(931)]=setInterval((()=>this._outOfFrameScroll()),16)))}[t(907)](e){const s=t,i=this[s(1668)](e);if(void 0!==i||void 0!==this[s(1285)])return void 0===i||void 0===this[s(1285)]?(this[s(1285)]=i,void this._onPointerCoordChange[s(1448)](this[s(1285)])):void(i[0]===this._pointerCoord[0]&&i[1]===this[s(1285)][1]||(this[s(1285)]=i,this[s(411)][s(1448)](this[s(1285)])))}[t(475)](e){const s=t;return 1+Math[s(516)](Math[s(839)](e/20,3),2)}[t(556)](){const e=t;this._scrollVelocity.x=0,this[e(1685)].y=0,clearInterval(this[e(931)]),this._scrollInterval=0}_outOfFrameScroll(){const e=t;this._isScrollLocked||(this[e(1685)].x&&(this.x+=1*this[e(1685)].x/this.zoom),this._scrollVelocity.y&&(this.y+=1*this[e(1685)].y/this.zoom))}[t(1403)](e){const s=t,i=this[s(412)]+this[s(412)]*e;if(i<=.02)return this[s(412)]=.02,this[s(412)];let n=-1;if(e>0){for(const t of te)if(t>this[s(412)]){n=t;break}if(-1===n)return this[s(412)];this[s(412)]=n<i?n:i}else{for(const t of te){if(t>=this[s(412)])break;n=t}n>i?this._zoom=n:this[s(412)]=i}return this[s(643)].fire(),this[s(1629)][s(1448)](),this[s(412)]}[t(1309)](e){const s=t,i=this[s(677)].element;if(!i)throw new Error("Cannot get coords without element");let n=e[s(1049)]-Math.floor(i[s(1648)]/2),r=e.offsetY-Math.floor(i[s(1295)]/2);return n/=this[s(1347)],r/=this.zoom,n+=this[s(596)][s(956)]/2,r+=this[s(596)].height/2,n-=this.x,r-=this.y,[Math[s(1082)](n),Math[s(1082)](r)]}[t(1668)](e){const s=t,i=this[s(1309)](e);if(!(i[0]<0||i[0]>=this[s(596)][s(956)]||i[1]<0||i[1]>=this[s(596)][s(897)]))return i}[t(1383)](){return{x:this._x,y:this._y,zoom:this._zoom}}[t(1542)](e){const s=t;this._x=e.x,this._y=e.y,this._zoom=e[s(1347)],this._onUpdate.fire(),this[s(1629)][s(1448)]()}}class se extends e.JT{constructor(){const e=t;super(),this[e(677)]=this[e(1700)](new r),this[e(1243)]=this[e(1700)](new G),this[e(664)]=this[e(1700)](new h),this[e(1541)]=this.register(new Gt),this[e(596)]=this[e(1700)](new W(this[e(664)],this[e(1541)])),this[e(514)]=this[e(1700)](new Nt(this._imageService,this[e(664)])),this[e(678)]=this[e(1700)](new q(this[e(677)])),this[e(1672)]=this.register(new ee(this._elementService,this[e(596)],this[e(678)])),this[e(492)]=this[e(1700)](new Ht(this[e(664)],this._imageService,this[e(514)],this[e(1541)])),this._toolService=this.register(new $t(this[e(664)],this[e(596)],this[e(678)],this[e(1243)],this[e(514)],this._taskService,this[e(1541)],this[e(1672)])),this._renderService=this[e(1700)](new kt(this[e(677)],this[e(596)],this[e(514)],this._toolService,this._viewportService)),this[e(335)]=new ie(this[e(664)],this[e(596)],this._selectionService,this[e(1254)],this[e(1672)]),this[e(831)]=new ne(this[e(664)]),this[e(1716)]=new re(this[e(596)]),this[e(826)]=new oe(this[e(596)],this[e(514)],this._taskWorkerService),this[e(1433)]=new ae(this[e(1243)]),this[e(1256)]=new ce(this._renderService),this[e(1098)]=new le(this[e(514)]),this[e(997)]=new de(this[e(492)],this[e(1541)]),this.tool=new ue(this._toolService,this[e(664)],this[e(596)],this[e(1243)],this._selectionService,this[e(1672)]),this[e(977)]=new me(this[e(677)],this[e(1672)])}}class ie{constructor(e,s,i,n,r){const o=t;this[o(664)]=e,this._imageService=s,this[o(514)]=i,this[o(1254)]=n,this[o(1672)]=r}exportBlob(e){const s=t;return this._imageService[s(1412)](e)}[t(1424)](e){return this[t(596)].exportBlobClone(e)}[t(1110)](){const e=t;return this[e(596)][e(1110)]()}[t(742)](){const e=t;return this[e(596)][e(742)]()}async openFile(e,i){const n=t;switch(i){case".ico":const t=(await s.e(586)[n(1580)](s.bind(s,3586)))[n(618)],i=await t(e);await Promise.allSettled(i[n(1220)]((t=>t[n(812)])));let r=0,o=0;for(const[t,e]of i[n(683)]())e[n(1515)][n(956)]>o&&(r=t,o=e[n(1515)][n(956)]);await this[n(407)](i[n(1220)]((t=>t[n(1515)])),r);break;default:await this[n(962)](new Blob([e]))}}async[t(1207)](e){const s=t;this._imageService[s(1207)](e),this[s(1672)].fitToWindow()}async[t(407)](e,s){const i=t;this[i(596)][i(1510)](e,s),this._viewportService[i(571)]()}async[t(962)](e){const s=t;await this[s(596)][s(1205)](e),this[s(1672)][s(571)]()}[t(996)](e,s){const i=t;this[i(596)][i(996)](e,s),this._viewportService[i(571)]()}[t(508)](e){const s=t;if(e.version<4)throw new Error(s(1319)+e[s(1255)]+")");this._imageService[s(1542)](e[s(1556)].image),this[s(664)].deserialize(e[s(1556)][s(831)]),this[s(1254)][s(1542)](e.body[s(751)]),this[s(514)][s(1542)](e[s(1556)].selection),this[s(1672)].deserialize(e[s(1556)][s(977)])}[t(840)](e){const s=t;return{version:4,body:{image:this[s(596)][s(1383)](e),history:this[s(664)][s(1383)](e),selection:this._selectionService[s(1383)](),tool:this[s(1254)].serialize(),viewport:this._viewportService.serialize()}}}}class ne{constructor(e){this[t(664)]=e}get[t(1467)](){const e=t;return this[e(664)][e(1467)]}get[t(683)](){return this[t(664)].entries}get[t(328)](){const e=t;return this[e(664)][e(328)]}get canUndo(){const e=t;return this._historyService[e(923)]}get onEntriesChange(){return this[t(664)].onEntriesChange}[t(344)](){const e=t;return this._historyService[e(344)]()}undo(){return this[t(664)].undo()}[t(1039)](e,s){const i=t;return this[i(664)][i(1039)](e,s)}}class re{constructor(e){this[t(596)]=e}get imageSet(){const e=t;return this[e(596)][e(879)]}get[t(306)](){return this[t(596)].onImagesChange}get[t(1058)](){const e=t;return this[e(596)][e(1438)]}set[t(1058)](e){const s=t;if(e!==this[s(596)].activeImageSetIndex){if(void 0===e)throw new Error(s(1204));this[s(596)][s(1496)](e)}}}class oe{constructor(e,s,i){const n=t;this[n(596)]=e,this[n(514)]=s,this[n(1541)]=i}get[t(956)](){const e=t;return this[e(596)][e(956)]}get[t(897)](){const e=t;return this._imageService[e(897)]}get[t(1185)](){return this._imageService.onChangedDimensions}get[t(930)](){const e=t;return this[e(596)][e(930)]}get[t(590)](){return this._imageService.onLayerVisibilityChange}get layers(){const e=t;return this[e(596)][e(1116)].map((t=>new he(t,this[e(514)],this._taskWorkerService)))||[]}get[t(1019)](){const e=t,s=this[e(596)][e(1342)];if(s)return new he(s,this[e(514)],this[e(1541)])}set activeLayer(e){const s=t;if(void 0===e)throw new Error(s(639));this[s(596)][s(730)](e.id)}[t(1487)](){this[t(596)].newLayer()}[t(305)](e){const s=t;this[s(596)][s(305)](e?.id)}mergeLayerDown(){const e=t;return this[e(596)][e(1036)]()}flattenLayers(){const e=t;return this[e(596)][e(502)]()}goToTopLayer(){const e=t;this[e(596)][e(1153)]()}[t(1037)](){const e=t;this[e(596)][e(1037)]()}[t(460)](){const e=t;this[e(596)][e(460)]()}goToLayerBelow(){const e=t;this._imageService[e(888)]()}[t(1473)](){this._imageService.moveLayerToTop()}[t(1272)](){const e=t;this._imageService[e(1272)]()}[t(805)](){const e=t;this[e(596)][e(805)]()}moveLayerDown(){this[t(596)].moveLayerDown()}async[t(1543)](){const e=t;await(this[e(596)][e(1342)]?.finishTemporaryLayer())}}class he{constructor(e,s,i){const n=t;this[n(1148)]=e,this[n(514)]=s,this[n(1541)]=i,this._previewCache=new Map,this[n(1148)].onUpdate((()=>this._previewCache[n(1632)]()))}get onDispose(){return this._layer.onSoftDeletedChange}get onUpdate(){const e=t;return this._layer[e(1134)]}get id(){return this[t(1148)].id}get name(){const e=t;return this[e(1148)][e(1401)]}set[t(1401)](e){const s=t;this[s(1148)][s(1401)]=e}get blendMode(){const e=t;return this[e(1148)][e(1426)]}set[t(1426)](e){const s=t;this[s(1148)][s(426)](e)}get[t(842)](){const e=t;return this[e(1148)][e(842)]}set[t(842)](e){const s=t;this[s(1148)][s(816)](e)}[t(1187)](e,s){const i=t,n=e+"x"+s,r=this[i(692)][i(399)](n);if(r)return r;const o={data:this._layer.data,width:this._layer.width,height:this._layer[i(897)]},h=this[i(1541)].generateLayerPreview(o,e,s);return this[i(692)][i(1681)](n,h),h}[t(1412)](e){const s=t;return this[s(1148)][s(1412)](e)}async importBlob(e,s){const n=t,r=await this[n(1148)].importBlob(e,s);this[n(514)][n(312)]=(0,i.BN)(r[n(581)][n(312)]),this[n(514)][n(661)](n(337))}}class ae{constructor(e){this[t(1243)]=e}get onChange(){return this._paletteService.onUpdate}get[t(916)](){const e=t;return this._paletteService[e(916)]}set[t(916)](e){this[t(1243)].primary=e}get[t(992)](){const e=t;return this._paletteService[e(992)]}set secondary(e){const s=t;this[s(1243)][s(992)]=e}swap(){const e=t;this._paletteService[e(1361)]()}}class ce{constructor(e){this[t(1003)]=e}pause(){this[t(1003)].pause()}[t(1453)](){const e=t;this._renderService[e(1453)]()}}class le{constructor(e){this[t(514)]=e}get[t(1134)](){return this._selectionService.onUpdate}get[t(312)](){const e=t;return this._selectionService[e(312)]}[t(711)](){const e=t;this._selectionService[e(711)]()}[t(1468)](){const e=t;return this[e(514)][e(1468)]()}selectAll(){const e=t;this[e(514)][e(448)]()}}class de{constructor(e,s){const i=t;this[i(492)]=e,this[i(1541)]=s}get disableWorkers(){const e=t;return this[e(1541)][e(1048)]}set[t(1048)](e){const s=t;this._taskWorkerService[s(1048)]=e}get[t(785)](){const e=t;return this[e(492)][e(785)]}[t(768)](e,s){const i=t;return this._taskService[i(768)](e,s)}executeOnSingleLayer(t,e){return this._taskService.executeOnSingleLayer(t,e)}}class ue{constructor(e,s,i,n,r,o){const h=t;this[h(1254)]=e,this[h(664)]=s,this[h(596)]=i,this._paletteService=n,this[h(514)]=r,this[h(1672)]=o}get[t(1421)](){return this[t(1254)].onToolChange}get[t(1303)](){const e=t;return this._toolService[e(1303)]?.id}get[t(1458)](){const e=t;return this[e(1254)][e(1303)]?.actions||[]}get[t(1690)](){const e=t;return this[e(1254)][e(1303)]?.[e(1690)]||[]}get info(){const e=t;return this[e(1254)][e(1303)]?.[e(480)]||[]}async[t(1569)](e){const s=t;await this[s(1254)][s(1569)](e)}}class me{constructor(e,s){const i=t;this[i(677)]=e,this[i(1672)]=s}get[t(1134)](){const e=t;return this[e(1672)][e(1134)]}get[t(878)](){const e=t;return this[e(1672)][e(878)]}get[t(1416)](){const e=t;return this[e(1672)][e(1416)]}get[t(1696)](){const e=t;return this[e(1672)][e(1696)]}get x(){return this[t(1672)].x}set x(e){this[t(1672)].x=e}get y(){return this[t(1672)].y}set y(e){this[t(1672)].y=e}get[t(1667)](){const e=t;return this._viewportService[e(1667)]}get[t(1347)](){const e=t;return this._viewportService[e(1347)]}set zoom(e){const s=t;this[s(1672)][s(1347)]=e}get[t(776)](){return this[t(1672)].isPixelGridEnabled}set[t(776)](e){const s=t;this[s(1672)][s(776)]=e}[t(1596)](e){this[t(677)].attach(e)}[t(511)](){document[t(1165)].blur()}zoomIn(e){const s=t;this[s(1672)][s(562)](e)}[t(1292)](e){const s=t;this[s(1672)][s(1292)](e)}fitToWindow(){const e=t;this[e(1672)][e(571)]()}}const fe=t(910),ge="di$dependencies",pe=new Map;function _e(e){const s=t;if(pe[s(1436)](e))return pe.get(e);const i=function(t,e,n){const r=s;if(3!==arguments[r(823)])throw new Error(r(563));ye(i,t,n)};return i[s(1462)]=()=>e,pe[s(1681)](e,i),i}function ye(e,s,i){const n=t;s[fe]===s?s[ge][n(1568)]({id:e,index:i}):(s[ge]=[{id:e,index:i}],s[fe]=s)}const we=_e(t(1489)),ve=_e(t(1338)),be=_e("InstantiationService");class xe{constructor(){this[t(1339)]=new Map}[t(1700)](e,s){const i=t;this[i(1339)][i(1681)](e,s)}[t(399)](e){const s=t,i=this[s(1339)][s(399)](e);if(!i)throw new Error(s(1707)+e+'"');return i}getAll(){const e=t;return this[e(1339)][e(1563)]()}}const Se=new xe;var Ce=function(t,e){return function(s,i){e(s,i,t)}};let Ee=class{constructor(e,s){const i=t;this[i(1281)]=e,this[i(1060)]=s}[t(1711)](e){return Se[t(399)](e)}[t(1145)](){return Se[t(945)]()}canRunCommand(e){const s=t,i=Se.get(e);if(void 0===i[s(1214)])return!0;const n=this[s(1060)].get(i[s(1214)]);if(!n)return!0;const r=n[s(399)]();return i[s(1456)]?!r:r}[t(541)](e){const s=t;if(!this.canRunCommand(e))throw new Error(s(1481)+e+"\", it's disabled");const i=Se[s(399)](e);return console.info(s(1727)+e),this[s(1281)][s(1166)](i[s(358)])}filterCommands(e,s){const i=t,n=Se[i(945)](),r=[];for(const t of n)if((t[i(739)]+": "+t[i(1297)])[i(594)]()[i(1573)](e[i(594)]())&&(r[i(1568)](t),r[i(823)]===s))return r;return r}};Ee=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object[r(889)](s,i):n;if(typeof Reflect===r(592)&&typeof Reflect[r(403)]===r(1343))a=Reflect[r(403)](e,s,i,n);else for(var c=e[r(823)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a}([Ce(0,be),Ce(1,ve)],Ee);class Le{constructor(){const e=t;this.serviceBrand=void 0,this[e(1646)]=new Map}[t(399)](e){const s=t;return this[s(1646)][s(399)](e)}bind(e,s){const i=t,n=new Ie(s);return this[i(1646)][i(1681)](e,n),n}}class Ie extends e.JT{constructor(e){const s=t;super(),this[s(365)]=e,this._onUpdate=this.register(new n.v),this[s(1134)]=this._onUpdate[s(1053)],this[s(1164)]=this[s(365)]}[t(1681)](e){const s=t;this[s(1164)]!==e&&(this[s(1164)]=e,this._onUpdate[s(1448)](e))}[t(757)](){const e=t;this[e(1681)](this[e(365)])}[t(399)](){return this[t(1164)]}}const Te=_e(t(1023));class Ae{constructor(...e){const s=t;this[s(898)]=new Map;for(const[t,i]of e)this[s(1681)](t,i)}[t(1681)](e,s){const i=t,n=this._entries.get(e);return this[i(898)][i(1681)](e,s),n}[t(1402)](e){const s=t;this._entries[s(1402)](((t,s)=>e(s,t)))}[t(1436)](e){return this[t(898)].has(e)}[t(399)](e){const s=t;return this._entries[s(399)](e)}}class Re{constructor(){this[t(906)]=new Ae,this._services.set(be,this)}[t(819)](e,s){this[t(906)].set(e,s)}[t(1714)](e){const s=t;return this[s(906)][s(399)](e)}[t(798)](e,...s){const i=t,n=(o=e,o[ge]||[]).sort(((t,e)=>t.index-e[i(610)])),r=[];var o;for(const t of n){const s=this[i(906)][i(399)](t.id);if(!s)throw new Error(i(1655)+e[i(1401)]+i(321)+t.id+".");r[i(1568)](s)}const h=n[i(823)]>0?n[0].index:s.length;if(s[i(823)]!==h)throw new Error(i(1505)+e[i(1401)]+i(1015)+(h+1)+i(462)+s[i(823)]+i(1719));return new e(...[...s,...r])}[t(1166)](t,...e){return t({get:t=>{const e=a2_0x139a,s=this[e(1714)](t);if(!s)throw new Error(e(347)+t+"'");return s}},...e)}}const Me=_e(t(793)),De=_e("ILunaService"),Be=_e(t(1086));class Ue extends e.JT{constructor(){const e=t;super(...arguments),this[e(1181)]=new Map([[1,new ke],[0,new ke]]),this[e(722)]=this[e(1700)](new n.v),this[e(443)]=this[e(722)][e(1053)],this[e(377)]=this[e(1700)](new n.v),this[e(1047)]=this[e(377)][e(1053)],this[e(493)]=this.register(new n.v),this[e(467)]=this[e(493)][e(1053)],this._onDidRemoveBottomItem=this.register(new n.v),this[e(1366)]=this[e(662)][e(1053)]}createItem(e){const s=t,i=this[s(1181)][s(399)](e[s(1652)]),n=0===e[s(619)]?i[s(505)]:i[s(307)];if(n[s(1436)](e))throw new Error("Status bar item already added");return n.add(e),(0===e[s(1652)]?this._onDidAddTopItem:this[s(493)])[s(1448)](e),{dispose:()=>{this[s(1014)](e)}}}[t(1224)](e){const s=t;return this._items[s(399)](e)[s(505)].values()}[t(1315)](e){const s=t;return this[s(1181)][s(399)](e)[s(307)].values()}_removeItem(e){const s=t,i=this[s(1181)].get(e.target);(0===e[s(619)]?i.leftItems:i[s(307)])[s(844)](e),(0===e[s(1652)]?this[s(377)]:this[s(662)])[s(1448)](e)}}class ke{constructor(){const e=t;this[e(505)]=new Set,this[e(307)]=new Set}}const Pe=_e(t(297)),Ne=_e("ViewService"),Fe=_e(t(806));class Oe{constructor(){this._views=new Map}[t(1700)](e,s){this[t(825)].set(e,s)}[t(399)](e){const s=t,i=this._views[s(399)](e);if(!i)throw new Error(s(966)+e+'"');return i}getAll(){const e=t;return this[e(825)][e(683)]()}}const Ve=new Oe;class He{constructor(){this[t(825)]=new Map}[t(1700)](e,s){const i=t;this[i(825)][i(1681)](e,s)}[t(399)](e){const s=t,i=this[s(825)].get(e);if(!i)throw new Error(s(1196)+e+'"');return i}[t(945)](){const e=t;return this[e(825)][e(683)]()}}const ze=new He;var We=function(t,e){return function(s,i){e(s,i,t)}};let qe=class extends e.JT{constructor(e,s){const i=t;super(),this[i(1281)]=e,this[i(890)]=s,this[i(825)]=new Map,this[i(615)]=!1,this._onStateChange=this[i(1700)](new n.v),this.onStateChange=this._onStateChange[i(1053)];for(const[t,e]of Ve[i(945)]()){let s;switch(e[i(749)]){case i(362):s=this[i(1281)][i(798)](e.ctor,document[i(543)]("#top"));break;case"bottom":s=this[i(1281)][i(798)](e[i(934)],document.querySelector(i(988)))}s&&this._views.set(t,s)}this._viewsElement=document.querySelector(i(369));for(const[t,e]of ze[i(945)]())e[i(1500)]&&this[i(1395)](t,e);this[i(890)][i(1394)]("viewService",this)}toggleView(e,s=!1){const i=t,n=this[i(825)].get(e);n?n.isVisible=!n[i(842)]:this._createView(e,ze[i(399)](e)),!this[i(615)]&&this[i(1694)][i(1448)]()}[t(1395)](e,s){const i=t,n=this[i(1281)][i(798)](s.ctor,this[i(1006)]);n[i(1174)]((()=>{const t=i;!1===n[t(842)]&&(n[t(921)](),this[t(825)][t(844)](e),!this[t(615)]&&this[t(1694)][t(1448)]())})),this[i(825)][i(1681)](e,n)}[t(840)](){const e=t,s=[];for(const t of this[e(825)][e(1563)]())s[e(1568)](t.id);return{visibleViews:s}}[t(508)](e){const s=t;this[s(615)]=!0;for(const t of e[s(294)])!this[s(825)][s(1436)](t)&&this.toggleView(t);for(const t of this[s(825)].keys()){let i=!1;for(const n of e[s(294)][s(1563)]())if(n===t){i=!0;break}!i&&this[s(1644)](t)}this[s(615)]=!1}};qe=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object[r(889)](s,i):n;if(typeof Reflect===r(592)&&"function"==typeof Reflect[r(403)])a=Reflect[r(403)](e,s,i,n);else for(var c=e[r(823)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a}([We(0,be),We(1,Fe)],qe);const je=_e(t(453));class Ge extends e.JT{constructor(){const e=t;super(...arguments),this[e(707)]=!0,this._isStretchEnabled=!0,this[e(1585)]=this.register(new n.v),this[e(355)]=this._onShowViewportChange[e(1053)],this[e(904)]=this[e(1700)](new n.v),this[e(637)]=this._onStretchEnabledChange[e(1053)]}get[t(603)](){return this[t(707)]}set showViewport(e){const s=t;this._showViewport!==e&&(this[s(707)]=e,this._onShowViewportChange[s(1448)](e))}get isStretchEnabled(){return this[t(1089)]}set[t(1478)](e){const s=t;this[s(1089)]!==e&&(this._isStretchEnabled=e,this[s(904)][s(1448)](e))}}var Xe;!function(e){const s=t;e[e[s(1160)]=1]=s(1160)}(Xe||(Xe={}));class Je extends e.JT{constructor(){const e=t;super(...arguments),this[e(1076)]=new Map,this[e(1694)]=this[e(1700)](new n.v),this[e(1398)]=this[e(1694)][e(1053)]}[t(1394)](e,s){const i=t;if(this[i(1076)][i(1436)](e))throw new Error(i(985)+e+i(638));this[i(1076)].set(e,s),s.onStateChange((()=>this[i(1694)][i(1448)]({id:e,body:s[i(840)]()})))}[t(508)](e){const s=t;if(e[s(1255)]===Xe[s(1160)])for(const t of e[s(683)]){const e=this[s(1076)][s(399)](t.id);e?e[s(508)](t.state):console[s(1641)]('No state handler for id "'+t.id+s(477))}else console[s(1641)]("Could not restore workbench state (version "+e.version+" < "+Xe[s(1160)]+")")}}class Ye{constructor(){this[t(1215)]=[]}register(e){const s=t;this[s(1215)][s(1568)](e)}[t(945)](){const e=t;return this[e(1215)][e(1563)]()}[t(1632)](){const e=t;this[e(1215)][e(823)]=0}}const Ke=new Ye;const Ze=_e(t(1032));class $e{constructor(e){const s=t;this[s(679)]=e,this[s(614)]=void 0,this[s(526)]=new Map,this[s(1333)]=new Map,window[s(604)]("message",(async t=>{const e=s;if("webviewRequestId"in t.data){const s=t[e(969)][e(902)],i=this._activeRequests[e(399)](s);if(!i)throw new Error(e(868)+s+'"');return this[e(1333)][e(844)](s),void i(this[e(1316)](t[e(969)]))}if("extHostRequestId"in t[e(969)]){const s=this[e(526)][e(399)](t[e(969)][e(1549)]);if(!s)throw new Error('No handler for webview request "'+t[e(969)][e(1549)]+'"');const i=await s(this[e(1316)](t[e(969)])),n={type:t[e(969)].type,body:i,extHostRequestId:t[e(969)][e(838)]};this[e(679)][e(530)](n)}}))}[t(1213)](e,s){const i=t;if(this[i(526)][i(1436)](e))throw new Error('Duplicate webview request handler "'+e+'"');this[i(526)][i(1681)](e,s)}async[t(487)](e,s){const i=t,n=Math[i(309)](1e6*Math.random());return new Promise((t=>{const r=i;this[r(1333)][r(1681)](n,t),this[r(679)][r(530)]({type:e,body:s,webviewRequestId:n})}))}_rehydrateExtHostMessage(e){const s=t;if(void 0===e[s(1556)])return e[s(1556)];const i=e.body;for(const t of Object[s(843)](i)){const e=i[t];typeof e===s(592)&&s(1549)in e&&e[s(1549)]===s(1367)&&(i[t]=new Uint8Array(e[s(969)]))}return i}}class Qe{register(t){}[t(945)](){return[][t(1563)]()}}class ts{constructor(){}async[t(1721)](){throw new Error(t(1461))}async[t(1212)](){throw new Error(t(1461))}async[t(1480)](){throw new Error("NYI")}}var es=function(t,e){return function(s,i){e(s,i,t)}};let ss=class{constructor(e,s){const i=t;this[i(1021)]=e,this[i(1601)]=s}async[t(1397)](e){const s=t;switch(e){case s(1676):{const t=await this._requestNewDimensions(),e=await this[s(1021)].request(s(1195),{items:[{id:s(885),label:"Bilinear",description:s(1106),detail:"Gets the color by averaging the values of surrounding pixels."},{id:s(1229),label:s(509),description:s(1301),detail:s(1283)}],options:{placeHolder:"Select how the resize will be performed"}});if(void 0===e)throw new Error(s(1537));return{...t,resampling:e}}case s(1063):{const t=await this._requestNewDimensions(),e=await this[s(1021)].request("quickPick",{items:[{id:s(1546),label:"Top left",description:"↘"},{id:"top",label:s(1561),description:"↓"},{id:s(350),label:s(1686),description:"↙"},{id:s(351),label:"Left",description:"→"},{id:s(422),label:"Middle",description:"·"},{id:"right",label:s(1183),description:"←"},{id:"bottomleft",label:s(778),description:"↗"},{id:s(955),label:s(810),description:"↑"},{id:s(851),label:s(1551),description:"↖"}],options:{placeHolder:"Select where to anchor the existing image"}});if(void 0===e)throw new Error("Anchor not selected");return{...t,anchor:e}}default:throw new Error(s(499)+e+" not yet supported")}}async _requestNewDimensions(){const e=t,s=await this._ipcService[e(487)]("inputBoxNumber",{prompt:e(824),defaultValue:this[e(1601)][e(826)].width,minValue:1});if(void 0===s)throw new Error(e(1109));const i=await this[e(1021)][e(487)]("inputBoxNumber",{prompt:"Enter the height of the image",defaultValue:this[e(1601)][e(826)][e(897)],minValue:1});if(void 0===i)throw new Error(e(1651));return{width:s,height:i}}};ss=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object[r(889)](s,i):n;if(typeof Reflect===r(592)&&typeof Reflect[r(403)]===r(1343))a=Reflect[r(403)](e,s,i,n);else for(var c=e[r(823)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a}([es(0,Ze),es(1,De)],ss);class is{constructor(){this[t(898)]=[]}[t(1700)](e){const s=t;this[s(898)][s(1568)](e)}[t(945)](){return this[t(898)]}clear(){const e=t;this._entries[e(823)]=0}}const ns=new is;function rs(e){const s=t;if(Se.register(e.id,{id:e.id,label:e.label,section:e[s(739)],run:e[s(358)],checked:e[s(700)],negateChecked:e[s(1142)],enabled:e[s(1214)],negateEnabled:e.negateEnabled}),e[s(843)])if(Array[s(797)](e.keys))for(const t of e.keys)ns.register({commandId:e.id,keys:t});else ns.register({commandId:e.id,keys:e.keys})}rs({id:t(1251),label:"Invert",section:"Adjustments",run:async e=>{const s=t,i=e[s(399)](De);i.task[s(1056)](s(1384),{selection:i.selection[s(312)]})},keys:t(1259)});class os extends e.JT{constructor(e,s){const i=t;super(),this[i(385)]=document[i(1267)](i(818)),this[i(385)].id=s[i(594)]()[i(1429)](/ /g,""),this._contentElement.classList[i(384)](i(830),"modal"),e.appendChild(this[i(385)]),this[i(1700)]({dispose:()=>{const t=i;e[t(561)](this[t(385)])}})}}let hs,as=class extends os{constructor(e,s){const i=t;super(e,i(1447)),this[i(755)]=s,this[i(641)]=[];const n=document[i(1267)](i(818));n[i(1276)][i(384)]("cmd-palette-header"),this[i(291)]=document[i(1267)](i(991)),this[i(291)][i(1549)]="text",this[i(291)][i(604)](i(991),(()=>this[i(609)]())),this._inputElement.addEventListener(i(634),(t=>this._keyDown(t))),n[i(986)](this[i(291)]);const r=document[i(1267)]("ul");r[i(1276)][i(384)](i(1703));for(let t=0;t<18;t++)this._listItemElements.push(this[i(1380)]());r[i(1175)](...this[i(641)]),this[i(609)](),this[i(385)].classList[i(384)](i(1057)),this._contentElement[i(1175)](n,r),this[i(291)][i(511)]()}[t(1380)](){return document[t(1267)]("li")}[t(609)](){const e=t,s=this._commandService[e(548)](this[e(291)].value,18);let i=0;for(;i<s.length;i++){const t=s[i],n=this[e(641)][i];n[e(576)]=t[e(739)]+": "+t[e(1297)],n[e(1276)].remove("hidden")}for(;i<18;i++)this[e(641)][i].classList.add(e(1533))}[t(1066)](e){const s=t;if(e[s(914)]===s(631)){const t=this[s(755)][s(548)](this[s(291)][s(537)],18);return t[s(823)]>0&&this[s(755)][s(541)](t[0].id),void this[s(921)]()}}};async function cs(e){const s=t,i=document[s(1165)];if(i?.[s(1363)]===s(1524)){const t=i;let e;return e=null===t.selectionStart||null===t[s(1026)]||t[s(794)]===t.selectionEnd?t.value:t[s(537)].substring(t[s(794)],t[s(1026)]),void navigator[s(1223)][s(1331)](e)}const n=e[s(399)](De);if(!n[s(1098)][s(312)])return;const r=n[s(826)].activeLayer;if(!r)return;const o=await r.exportBlob({range:n[s(1098)][s(312)],useMovingLayer:!0});hs=n.selection[s(312)];const h=new ClipboardItem({"image/png":o});if(!(s(762)in navigator[s(1223)]))throw new Error(s(1547));navigator[s(1223)][s(762)]([h])}var ls,ds;as=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object.getOwnPropertyDescriptor(s,i):n;if(typeof Reflect===r(592)&&typeof Reflect[r(403)]===r(1343))a=Reflect[r(403)](e,s,i,n);else for(var c=e[r(823)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a}([(ls=1,ds=we,function(t,e){ds(t,e,ls)})],as),rs({id:"Command: Show All Commands",label:t(980),section:t(1492),run:e=>{const s=t;e[s(399)](be)[s(798)](as,document[s(1556)])},keys:[t(1678),"f1"]}),Ke.register({start(e){const s=t,i=e.get(De),n=e[s(399)](ve)[s(658)](8,!1),r=e[s(399)](ve)[s(658)](7,!1);i[s(831)][s(775)]((()=>{const t=s;n[t(1681)](i[t(831)].canRedo),r[t(1681)](i[t(831)][t(923)])}))}}),rs({id:t(482),label:t(837),section:t(620),run:function(e){const s=t,i=e[s(399)](De);return i.history[s(1039)](s(1137),(async()=>{const t=s;await cs(e),await i.selection[t(1468)]()}))},keys:t(1273)}),rs({id:t(895),label:"Copy",section:t(620),run:cs,keys:t(1231)}),rs({id:t(588),label:t(894),section:"Edit",run:async function(e){const s=t,i=e[s(399)](De),n=i[s(826)][s(1019)];if(!n)return;if("denied"===(await navigator[s(1440)].query({name:s(1011)}))[s(1470)])return void console[s(1101)](s(1574));await i[s(826)][s(1543)]();const r=await navigator[s(1223)][s(547)]();for(const t of r){if(!t[s(538)][s(1573)](s(1475))){console.log("Clipboard contains non-image data. Unable to access it.");continue}const e=await t.getType(s(1475));await i[s(831)].createCompositeEntry("Paste Image",(()=>n.importBlob(e,hs)))}},keys:"cmdctrl+v"}),rs({id:t(990),label:"Redo",section:t(620),run:e=>e.get(De).history[t(344)](),keys:Qt.V?t(1613):t(569),enabled:8}),rs({id:t(917),label:t(1016),section:"Edit",run:e=>e[t(399)](De)[t(831)][t(1293)](),keys:"cmdctrl+z",enabled:7}),rs({id:t(421),label:"New",section:t(854),run:e=>e.get(De)[t(335)][t(996)](20,15),keys:"ctrl+n"}),rs({id:"file.open",label:"Open",section:t(854),run:async e=>e[t(399)](Te)[t(1721)](),keys:"ctrl+o"}),rs({id:t(1067),label:"Save",section:t(854),run:async e=>e[t(399)](Te)[t(1212)](),keys:t(874)}),rs({id:t(1550),label:t(1218),section:"File",run:async e=>e[t(399)](Te)[t(1480)](),keys:t(1684)});class us extends e.JT{constructor(e,s,i,r){const o=t;super(),this.id=e,this[o(1006)]=s,this._position=r,this[o(396)]=!0,this._onDidChangeVisibilityEmitter=this[o(1700)](new n.v),this[o(1174)]=this._onDidChangeVisibilityEmitter[o(1053)],this._viewElement=document[o(1267)](o(818)),this[o(1111)].id=i[o(594)]()[o(1429)](/ /g,""),this[o(1111)].classList[o(384)](o(830),o(1428),this[o(1620)]);const h=document.createElement(o(818));h.classList[o(384)](o(599));const a=document[o(1267)]("div");a[o(1276)][o(384)](o(1730)),a[o(576)]=i,this[o(853)]=document[o(1267)]("div"),this._headerContentElement[o(1276)].add("header-content");const c=document[o(1267)](o(835));c[o(1276)].add(o(525),"luna-icon"),c[o(1270)](o(1268),o(382)+i+o(1699)),c[o(604)]("click",(()=>this[o(842)]=!1)),h[o(1175)](a,this[o(853)],c),this[o(385)]=document[o(1267)]("div"),this[o(385)].classList[o(384)](o(1241)),this[o(1111)][o(1175)](h,this[o(385)]),this[o(1006)][o(986)](this[o(1111)]),this[o(1700)]({dispose:()=>{this[o(1006)].removeChild(this._viewElement)}}),this[o(1250)]()}get[t(842)](){return this[t(396)]}set[t(842)](e){const s=t;this[s(396)]=e,this[s(398)][s(1448)](e)}_updatePosition(){const e=t;this._position===e(1100)||this._position===e(851)?(this[e(1111)][e(735)][e(362)]=e(650),this[e(1111)][e(735)][e(955)]="10px"):(this[e(1620)]===e(1546)||this[e(1620)]===e(350))&&(this[e(1111)][e(735)][e(362)]=e(1136),this[e(1111)][e(735)][e(955)]=e(650)),this[e(1620)]===e(1100)||this._position===e(1546)?(this[e(1111)][e(735)].right=e(650),this[e(1111)][e(735)][e(351)]=e(1136)):(this[e(1620)]===e(350)||this[e(1620)]===e(851))&&(this[e(1111)][e(735)].right=e(1136),this[e(1111)][e(735)][e(351)]=e(650))}}var ms=function(t,e){return function(s,i){e(s,i,t)}};let fs=class e extends us{constructor(e,s,i){const n=t;super(n(831),e,n(1567),n(350)),this[n(394)]=s,this[n(1060)]=i,this._listItemElements=[],this._windowVisibleContextKey=this[n(1060)][n(658)](5,!0),this.register(this[n(1174)]((t=>this[n(821)][n(1681)](t)))),this[n(1211)]=document.createElement("ul"),this[n(1211)][n(1276)].add(n(738)),this[n(1700)](this[n(394)][n(831)][n(775)]((()=>this[n(1323)]()))),this[n(1323)](),this[n(385)][n(986)](this._listElement)}[t(1323)](){const s=t,i=document[s(1262)](),n=this[s(394)][s(831)].activeEntry;let r,o=!1,h=!1;for(const[t,a]of this[s(394)].history[s(683)][s(683)]()){let c;if(t<this[s(641)].length)c=this[s(641)][t];else{c=document[s(1267)]("li"),c[s(518)]=0;const n=async()=>{const i=s;if(!this._luna[i(831)][i(1467)])return;const n=t-this[i(394)][i(831)][i(683)][i(1061)](this._luna[i(831)][i(1467)]),r=n>0?e[i(827)]?e[i(827)]:this[i(394)].history[i(344)]:e[i(671)]?e[i(671)]:this._luna[i(831)][i(1293)];for(let t=0;t<Math[i(1454)](n);t++)await r()};c[s(604)](s(865),(()=>n())),c[s(604)]("keydown",(t=>{const e=s;switch(t.key){case"ArrowUp":c[e(834)]?.[e(511)](),t[e(1103)](),t[e(332)]();break;case e(497):c[e(401)]?.focus(),t[e(1103)](),t.stopImmediatePropagation();break;case e(631):case e(1469):n(),t[e(1103)](),t[e(332)]()}})),i[s(986)](c),this._listItemElements[s(1568)](c)}c.textContent=a.operationName,c[s(1276)][s(1274)](s(344),o),h=a===n,c[s(1276)].toggle(s(478),h),h&&(o=!0,r=c)}for(this[s(1211)][s(986)](i);this[s(641)].length>this[s(394)].history[s(683)].length;)this[s(1211)].removeChild(this._listItemElements[s(660)]());r?(this[s(385)][s(1517)]+this[s(1211)][s(315)]>r.offsetTop||this[s(385)][s(1517)]<r.offsetTop-this[s(385)][s(333)])&&(this[s(385)].scrollTop=r[s(315)]-this[s(1211)][s(315)]):this._contentElement[s(1517)]=this[s(385)][s(1594)]}};fs=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object[r(889)](s,i):n;if(typeof Reflect===r(592)&&typeof Reflect.decorate===r(1343))a=Reflect[r(403)](e,s,i,n);else for(var c=e[r(823)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a}([ms(1,De),ms(2,ve)],fs),ze[t(1700)](t(831),{ctor:fs,defaultVisible:!0}),rs({id:t(1088),label:t(1265),section:t(1247),checked:5,run:e=>e[t(399)](Ne).toggleView(t(831))});let gs=class extends e.JT{constructor(e){const s=t;super(),this[s(1601)]=e,this[s(1652)]=1,this.alignment=1,this.className=s(1284),this[s(1590)]=!0,this.commandId=s(359),this[s(643)]=this[s(1700)](new n.v),this[s(1134)]=this[s(643)][s(1053)],this[s(1601)][s(826)][s(1185)]((()=>this._update())),this[s(1592)]()}[t(1592)](){const e=t;(this[e(1636)]!==this[e(1601)][e(826)][e(956)]||this[e(601)]!==this[e(1601)][e(826)][e(897)])&&(this._width=this._lunaService[e(826)][e(956)],this[e(601)]=this[e(1601)].layer[e(897)],this[e(1248)]=this[e(1636)]+" x "+this._height,this[e(1730)]=e(1232)+this._width+" pixels wide by "+this[e(601)]+" pixels tall",this[e(643)][e(1448)]())}};var ps,_s;gs=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object.getOwnPropertyDescriptor(s,i):n;if(typeof Reflect===r(592)&&"function"==typeof Reflect.decorate)a=Reflect[r(403)](e,s,i,n);else for(var c=e[r(823)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a}([(ps=0,_s=De,function(t,e){_s(t,e,ps)})],gs);var ys=function(t,e){return function(s,i){e(s,i,t)}};let ws=class extends us{constructor(s,i,n){const r=t;super(r(1407),s,"Images",r(851)),this[r(394)]=i,this._contextKeyService=n,this[r(675)]=new Map,this._windowVisibleContextKey=this._contextKeyService[r(658)](1,!0),this.register(this[r(1174)]((t=>this[r(821)][r(1681)](t)))),this._imageListElement=document.createElement("div"),this[r(574)][r(1276)][r(384)](r(1068));const o=document[r(1267)](r(818));o[r(1276)][r(384)]("actions"),this._contentElement[r(1175)](this._imageListElement,o),this[r(1700)](this[r(394)].image[r(306)]((()=>this[r(1637)]()))),this[r(1700)]({dispose:()=>{const t=r;for(const s of this[t(675)][t(1563)]())(0,e._c)(s[t(1540)])}}),this._renderImages()}[t(1637)](){const e=t,s=this[e(394)].image[e(879)],i=this[e(394)].image.activeImage;if(!s||void 0===i)return;let n=null;for(let t=s.length-1;t>=0;t--){const r=t,o=s[t];if(!this[e(675)][e(1436)](o.id)){const t={container:document[e(1267)](e(818)),nameSpan:document[e(1267)](e(1372)),previewCanvas:document[e(1267)]("canvas"),disposables:[]};t.container[e(1276)][e(384)](e(1484)),t.previewCanvas.classList.add(e(1642)),t[e(1008)][e(956)]=40,t.previewCanvas[e(897)]=40;let s=!1;this[e(1159)].push(this._luna[e(831)][e(775)]((()=>{s&&(this[e(1370)](o,t),s=!1)}))),this[e(1370)](o,t),t.container[e(986)](t[e(1008)]),t[e(420)][e(518)]=0,t[e(1299)][e(1276)].add("name"),t.container.addEventListener("click",(()=>this[e(1298)](r))),t[e(420)][e(604)](e(634),(s=>{const i=e;switch(s.key){case"ArrowUp":t[i(420)][i(834)]?.focus(),s.preventDefault();break;case i(497):t[i(420)][i(401)]?.[i(511)](),s.preventDefault();break;case i(631):case"Space":this._setActiveItem(r)}})),t[e(420)][e(986)](t[e(1299)]),this[e(675)].set(o.id,t)}const h=this[e(675)][e(399)](o.id),a=t===i;h.container.classList[e(1274)](e(478),a),h[e(1299)].textContent=o[e(956)]+"x"+o[e(897)]+(o[e(501)]?e(1720)+o[e(501)]:""),null===n?(!h[e(420)][e(1017)]||null!==h.container.previousSibling)&&(this[e(574)][e(1653)]?this._imageListElement[e(1626)](h.container,this[e(574)][e(1653)]):this._imageListElement[e(986)](h[e(420)])):h[e(420)][e(834)]!==n&&n[e(1647)](e(1201),h[e(420)]),n=h[e(420)]}}async[t(1370)](e,s){const i=t,n=new ImageData(new Uint8ClampedArray(e[i(969)]),e[i(956)],e[i(897)]),r=await createImageBitmap(n),o=s[i(1008)][i(695)]("2d");o.clearRect(0,0,40,40),e[i(956)]>=40||e.width>=40?o[i(1176)](r,0,0,40,40):o.drawImage(r,Math[i(309)]((40-e.width)/2),(40-e[i(897)])/2,e.width,e[i(897)])}_setActiveItem(e){const s=t;this._luna.image[s(1058)]=e,this[s(394)][s(977)][s(571)]()}};ws=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object.getOwnPropertyDescriptor(s,i):n;if("object"==typeof Reflect&&typeof Reflect[r(403)]===r(1343))a=Reflect[r(403)](e,s,i,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a}([ys(1,De),ys(2,ve)],ws);let vs=class extends e.JT{constructor(e){const s=t;super(),this[s(1601)]=e,this[s(1652)]=1,this[s(619)]=1,this[s(551)]=s(360),this[s(1590)]=!0,this.visible=!1,this[s(983)]=s(359),this._onUpdate=this[s(1700)](new n.v),this[s(1134)]=this[s(643)].event,this[s(1601)][s(977)][s(1696)]((t=>this._update(t)))}_update(e){const s=t;this.visible=!!e,e&&(this[s(1248)]=e[0]+","+e[1]),this[s(643)][s(1448)]()}};var bs,xs;vs=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object.getOwnPropertyDescriptor(s,i):n;if(typeof Reflect===r(592)&&"function"==typeof Reflect[r(403)])a=Reflect.decorate(e,s,i,n);else for(var c=e[r(823)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a}([(bs=0,xs=De,function(t,e){xs(t,e,bs)})],vs),ze[t(1700)](t(1407),{ctor:ws,defaultVisible:!1}),Ke.register({start(e){const s=t,i=e[s(399)](Be),n=e[s(399)](be);i[s(442)](n[s(798)](vs)),i[s(442)](n[s(798)](gs))}}),rs({id:t(1028),label:t(974),section:t(1247),checked:1,run:e=>{const s=t;if(void 0===e[s(399)](De)[s(1716)][s(879)])throw new Error("The images window is not supported for this file type");e.get(Ne)[s(1644)]("images")}}),rs({id:t(1603),label:"Crop to Selection",section:t(464),run:async e=>{const s=t,i=e[s(399)](De);i.task.executeOnAllLayers("layer/cropToSelection",{selection:i[s(1098)][s(312)]})},keys:t(1125)}),rs({id:t(947),label:t(1108),section:t(464),run:async e=>{const s=t,i=e[s(399)](De);await i[s(997)].executeOnAllLayers(s(602),{selection:i[s(1098)].range}),i[s(977)].fitToWindow()}}),rs({id:t(359),label:t(965),section:t(464),run:async e=>{const s=t,i=await e[s(399)](Pe)[s(1397)](s(1676));e[s(399)](De).task[s(768)](s(1676),i)},keys:"ctrl+r"}),rs({id:t(1144),label:t(713),section:"Image",run:async e=>{const s=t,i=await e[s(399)](Pe)[s(1397)](s(1063));e[s(399)](De)[s(997)][s(768)](s(1063),i)},keys:t(373)}),rs({id:"image.flipHorizontal",label:t(1216),section:"Image",run:async e=>{const s=t,i=e[s(399)](De);i[s(997)][s(768)](s(1085),{selection:i.selection[s(312)]})}}),rs({id:t(1264),label:t(517),section:t(464),run:async e=>{const s=t,i=e.get(De);i[s(997)].executeOnAllLayers("layer/flipVertical",{selection:i.selection[s(312)]})}}),rs({id:t(704),label:t(1713),section:t(464),run:async e=>{const s=t,i=e.get(De);i.task[s(768)](s(1506),{selection:i.selection[s(312)]})},keys:t(1460)}),rs({id:t(1353),label:t(1356),section:"Image",run:async e=>{const s=t,i=e[s(399)](De);i[s(997)][s(768)](s(792),{selection:i.selection[s(312)]})},keys:t(331)}),rs({id:t(470),label:t(378),section:t(464),run:async e=>{const s=t,i=e[s(399)](De);i.task[s(768)](s(783),{selection:i[s(1098)][s(312)]})},keys:t(1010)}),rs({id:t(449),label:t(1138),section:"Image",run:e=>e[t(399)](De).layer[t(502)](),keys:t(1140)}),rs({id:t(1731),label:t(1030),section:"Image",run:e=>e[t(399)](De)[t(826)][t(1543)](),keys:"enter"}),Ke[t(1700)]({start:()=>{const e=t;window[e(604)](e(634),(t=>{const s=e;if("INPUT"!==t[s(1652)]?.tagName)return;const i=t[s(1652)];if(i[s(1549)]===s(1679)&&(Qt.V&&t[s(1439)]||!Qt.V&&t[s(1516)])){let e;switch(t[s(914)]){case"ArrowUp":e=parseInt(i[s(537)])+10;break;case"ArrowDown":e=parseInt(i[s(537)])-10;break;case s(725):e=""!==i.min?parseInt(i[s(584)]):void 0;break;case s(1235):e=""!==i[s(839)]?parseInt(i.max):void 0}if(void 0===e)return;""!==i[s(584)]&&(e=Math[s(839)](e,parseInt(i[s(584)]))),""!==i[s(839)]&&(e=Math[s(584)](e,parseInt(i.max))),i[s(537)]=e[s(1462)](),t[s(1103)](),t[s(332)]();const n=new Event(s(991),{bubbles:!0});i[s(1463)](n)}}))}});const Ss=["r","g","b","a"];class Cs{constructor(e,s,i){const n=t;this[n(394)]=e,this._container=s;const r=n(325)+i;this[n(790)]=Ss[n(1061)](i);const o=document[n(1267)](n(818));o.classList[n(384)](n(472));const h=document[n(1267)](n(1297));h[n(576)]=i[n(336)]()+":",h[n(1270)](n(425),r);const a=document.createElement("div");a.classList[n(384)](n(340)),"a"===i&&a[n(1276)][n(384)]("a"),this[n(1555)]=document.createElement("div"),this._sliderGradientElement[n(1276)][n(384)]("slider-gradient"),this._sliderGradientElement[n(604)](n(1075),(t=>{const e=n;a[e(1276)][e(1327)]("active")&&t[e(445)]&&this[e(553)](t[e(1049)])})),this[n(1555)][n(604)](n(1502),(t=>{const e=n;this[e(1555)].setPointerCapture(t[e(642)]),a[e(1276)].add(e(478)),this[e(553)](t[e(1049)])})),this[n(1555)][n(604)](n(1485),(t=>{const e=n;this[e(1555)].releasePointerCapture(t[e(642)]),a.classList.remove(e(478))})),this[n(1555)][n(604)](n(881),(t=>{const e=n;if(0===t[e(804)])return;const s=this[e(394)].palette[e(916)].slice();s[this[e(790)]]=Math.max(Math[e(584)](s[this[e(790)]]+(t.deltaY>0?-1:1),255),0),this[e(394)].palette[e(916)]=s})),this[n(1077)]=document.createElement(n(818)),this[n(1077)][n(1276)][n(384)](n(765)),a.append(this[n(1555)],this[n(1077)]);const c=document[n(1267)]("input");c[n(1549)]="number",c[n(584)]="0",c[n(839)]=n(438),c.value=n(438),c.id=r,c[n(604)](n(991),(()=>{const t=n,e=this[t(394)][t(1433)][t(916)][t(440)]();e[this[t(790)]]=this[t(654)](parseInt(c[t(537)])),this._luna[t(1433)].primary=e})),c[n(604)]("blur",(()=>{const t=n;this[t(291)][t(537)]=this[t(654)](parseInt(this[t(291)][t(537)]))[t(1462)]()})),this[n(291)]=c,o[n(1175)](h,a,c),this[n(1330)](),this[n(1396)][n(986)](o)}set[t(537)](e){const s=t;document[s(1165)]!==this[s(291)]&&(this._inputElement[s(537)]=e[s(1462)]())}[t(654)](e){const s=t;return Math[s(839)](Math[s(584)](e||0,255),0)}[t(1330)](){const e=t,s=this[e(394)][e(1433)][e(916)],i=[0===this[e(790)]?0:s[0],1===this[e(790)]?0:s[1],2===this[e(790)]?0:s[2],3===this[e(790)]?0:1],n=[0===this[e(790)]?255:s[0],1===this[e(790)]?255:s[1],2===this._channelIndex?255:s[2],(this[e(790)],1)];this[e(1555)][e(735)].background="linear-gradient(90deg, rgba("+i[e(1425)](",")+e(886)+n[e(1425)](",")+e(861),this[e(1077)][e(735)].left=s[this[e(790)]]/255*49+"px"}[t(553)](e){const s=t,i=Math[s(839)](Math.min(e/49,1),0),n=Math[s(309)](255*i),r=this._luna.palette.primary[s(440)]();r[this[s(790)]]=Math[s(309)](n),this._luna.palette[s(916)]=r}}var Es=function(t,e){return function(s,i){e(s,i,t)}};let Ls=class extends us{constructor(s,i,n,r){const o=t;super(o(1433),s,o(1682),"bottomleft"),this[o(394)]=i,this[o(1060)]=r,this[o(630)]=new Map,this[o(821)]=this[o(1060)][o(658)](3,!0),this[o(1700)](this[o(1174)]((t=>this[o(821)][o(1681)](t)))),this._luna[o(1433)][o(916)]=new Float32Array([255,255,255,255]),this._luna[o(1433)][o(992)]=new Float32Array([0,0,0,255]);const h=document.createElement("div");h[o(1276)][o(384)](o(478)),this[o(1622)]=this[o(873)]("primary"),this[o(533)]=this[o(873)](o(992));const a=document[o(1267)]("button");a[o(1276)][o(384)](o(1361),"luna-icon"),this[o(1700)]((0,e.Lw)(a,o(865),(()=>n[o(541)]("palette.swapColors")))),h[o(1175)](this[o(1622)].parentElement,this[o(533)][o(1017)],a);const c=document[o(1267)]("div");c[o(1276)][o(384)](o(351)),c[o(1175)](h,document.createElement("br"),this[o(752)](255,255,255),this[o(752)](0,0,0),this[o(752)](255,0,0),this[o(752)](255,255,0),this[o(752)](0,255,0),this._createPaletteButton(0,255,255),this[o(752)](0,0,255),this._createPaletteButton(255,0,255),document[o(1267)]("br"),this._createPaletteButton(255,255,255,192),this._createPaletteButton(0,0,0,192),this[o(752)](255,0,0,192),this[o(752)](255,255,0,192),this[o(752)](0,255,0,192),this[o(752)](0,255,255,192),this[o(752)](0,0,255,192),this[o(752)](255,0,255,192),document.createElement("br"),this._createPaletteButton(255,255,255,128),this[o(752)](0,0,0,128),this[o(752)](255,0,0,128),this[o(752)](255,255,0,128),this[o(752)](0,255,0,128),this._createPaletteButton(0,255,255,128),this[o(752)](0,0,255,128),this[o(752)](255,0,255,128),document.createElement("br"),this[o(752)](255,255,255,64),this._createPaletteButton(0,0,0,64),this._createPaletteButton(255,0,0,64),this._createPaletteButton(255,255,0,64),this._createPaletteButton(0,255,0,64),this[o(752)](0,255,255,64),this[o(752)](0,0,255,64),this._createPaletteButton(255,0,255,64));const l=document.createElement(o(818));l[o(1276)][o(384)](o(1702));for(const t of Ss)this._channelInputs[o(1681)](t,new Cs(this[o(394)],l,t));const d=document[o(1267)](o(818));d[o(1276)][o(384)](o(472));const u=document[o(1267)](o(1297));u[o(576)]=o(1423),u[o(1270)](o(425),o(1708)),this[o(613)]=document[o(1267)](o(991)),this._hexInputElement.id=o(1708),this[o(613)].pattern="[0-9a-fA-F]*",this[o(613)][o(1730)]=o(1618),this[o(1735)](),this._hexInputElement[o(604)](o(991),(()=>{const t=o,e=this[t(613)].value;if(6===e[t(823)]){const s=this[t(394)][t(1433)][t(916)].slice();s[0]=parseInt(e[t(519)](0,2),16),s[1]=parseInt(e.substr(2,2),16),s[2]=parseInt(e.substr(4,2),16),this._luna[t(1433)].primary=s}})),this[o(613)][o(604)](o(634),(t=>{const e=o;switch(t.key){case e(979):this[e(1206)](t,Qt.V&&t[e(1439)]||!Qt.V&&t[e(1516)]?16:1);break;case e(497):this[e(1206)](t,Qt.V&&t[e(1439)]||!Qt.V&&t[e(1516)]?-16:-1);break;case e(725):(Qt.V&&t[e(1439)]||!Qt.V&&t[e(1516)])&&this[e(1206)](t,-255);break;case e(1235):(Qt.V&&t[e(1439)]||!Qt.V&&t.ctrlKey)&&this[e(1206)](t,255)}})),this[o(613)][o(604)](o(740),(()=>{const t=o,e=this[t(613)].value;if(e[t(1566)](/^[0-9a-fA-F]+$/))if(3===e.length){const s=this._luna[t(1433)].primary[t(440)]();s[0]=parseInt(e[t(519)](0,1).repeat(2),16),s[1]=parseInt(e.substr(1,1).repeat(2),16),s[2]=parseInt(e[t(519)](2,1)[t(1151)](2),16),this._luna[t(1433)][t(916)]=s}else this[t(1735)]();else this[t(1735)]()})),d[o(1175)](u,this[o(613)]),l.appendChild(d),this[o(385)][o(1175)](c,l),this[o(1266)](),this[o(1700)](this[o(394)].palette[o(1697)]((()=>this._updatePalette())))}[t(1735)](){const e=t;this._hexInputElement[e(537)]=this[e(702)](this[e(394)][e(1433)][e(916)])}_changeHexInput(e,s){const i=t,n=this[i(613)][i(794)],r=this._hexInputElement[i(1026)];if(null===n||null===r)return;const o=n<=1,h=n>1&&n<4||r>2&&r<4||n<=1&&r>=4,a=n>=4||r>4;if(!o&&!h&&!a)return;const c=this[i(394)].palette.primary[i(440)]();o&&(c[0]=Math[i(584)](255,Math.max(0,parseInt(this._hexInputElement[i(537)][i(519)](0,2),16)+s))),h&&(c[1]=Math[i(584)](255,Math[i(839)](0,parseInt(this[i(613)][i(537)][i(519)](2,2),16)+s))),a&&(c[2]=Math[i(584)](255,Math.max(0,parseInt(this[i(613)][i(537)].substr(4,2),16)+s))),this[i(394)].palette.primary=c,e.preventDefault(),this[i(613)][i(794)]=n,this[i(613)][i(1026)]=r}[t(702)](e){const s=t;return""+this[s(1332)](e[0])+this[s(1332)](e[1])+this[s(1332)](e[2])}[t(1332)](e){const s=t;return e[s(1462)](16)[s(1571)](2,"0")[s(336)]()}[t(873)](e){const s=t,i=document[s(1267)](s(818));i.id=e,i[s(1276)].add(e);const n=document[s(1267)](s(818));return n[s(1276)].add("color-overlay"),i[s(986)](n),n}[t(752)](e,s,i,n=255){const r=t,o=document[r(1267)](r(818));o[r(1276)][r(384)](r(1544));const h=document.createElement("div");o[r(604)]("click",(()=>this[r(394)][r(1433)][r(916)]=new Float32Array([e,s,i,n]))),o.addEventListener(r(903),(t=>{const o=r;this[o(394)][o(1433)].secondary=new Float32Array([e,s,i,n]),t[o(1103)]()})),h[r(1276)][r(384)](r(841));const a=r(521)+e+","+s+","+i+r(924);return h.style[r(495)]=r(395)+a+r(1239)+e+","+s+","+i+","+n/255+r(861),o[r(986)](h),o}_updatePalette(){const e=t,s=this[e(394)][e(1433)].primary;for(const[t,i]of Ss[e(683)]()){const n=this[e(630)][e(399)](i);n[e(537)]=s[t],n.refresh()}this[e(1735)]();const i=s[0]+","+s[1]+","+s[2];this[e(1622)][e(735)][e(495)]=e(608)+i+e(1200)+i+","+s[3]/255+e(861);const n=this[e(394)][e(1433)].secondary,r=n[0]+","+n[1]+","+n[2];this[e(533)].style[e(495)]=e(608)+r+",1) 0%, rgba("+r+","+n[3]/255+e(861)}};Ls=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object.getOwnPropertyDescriptor(s,i):n;if("object"==typeof Reflect&&typeof Reflect.decorate===r(1343))a=Reflect[r(403)](e,s,i,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a}([Es(1,De),Es(2,we),Es(3,ve)],Ls),ze[t(1700)](t(1433),{ctor:Ls,defaultVisible:!0}),rs({id:t(374),label:t(1311),section:"Window",checked:3,run:e=>e[t(399)](Ne).toggleView("palette")}),rs({id:t(633),label:t(1237),section:t(1682),run:e=>e[t(399)](De)[t(1433)][t(1361)](),keys:"x"});let Is=class extends e.JT{constructor(e){const s=t;super(),this[s(1601)]=e,this[s(1652)]=1,this[s(619)]=0,this[s(551)]="selection-size",this[s(1590)]=!0,this.visible=!1,this[s(643)]=this.register(new n.v),this.onUpdate=this[s(643)][s(1053)],this[s(1601)][s(1098)].onUpdate((()=>this[s(1592)]())),this[s(1592)]()}[t(1592)](){const e=t,s=this[e(1601)][e(1098)][e(312)];if(!s)return void(this[e(1419)]&&(this[e(1248)]="",this[e(1419)]=!1,this._onUpdate[e(1448)]()));const i=s[e(1702)]-s[e(351)],n=s[e(955)]-s[e(362)];this[e(1248)]=i+e(1411)+n,this.title="Selection size is "+i+e(1659)+n+e(1291),this[e(1419)]=!0,this[e(643)].fire()}};var Ts,As;Is=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object[r(889)](s,i):n;if("object"==typeof Reflect&&typeof Reflect[r(403)]===r(1343))a=Reflect[r(403)](e,s,i,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object.defineProperty(s,i,a),a}([(Ts=0,As=De,function(t,e){As(t,e,Ts)})],Is);let Rs=class extends e.JT{constructor(e){const s=t;super(),this._lunaService=e,this.target=1,this[s(619)]=0,this[s(551)]=s(600),this[s(1590)]=!0,this[s(1419)]=!1,this[s(643)]=this[s(1700)](new n.v),this[s(1134)]=this[s(643)].event,this[s(1601)][s(1098)][s(1134)]((()=>this[s(1592)]())),this[s(1592)]()}_update(){const e=t,s=this[e(1601)].selection.range;s?(this[e(1248)]=s[e(351)]+", "+s.top,this[e(1730)]="Selection top left position is x="+s[e(351)]+e(1558)+s[e(362)],this[e(1419)]=!0,this[e(643)][e(1448)]()):this[e(1419)]&&(this[e(1248)]="",this[e(1419)]=!1,this[e(643)][e(1448)]())}};var Ms,Ds;Rs=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object.getOwnPropertyDescriptor(s,i):n;if(typeof Reflect===r(592)&&typeof Reflect[r(403)]===r(1343))a=Reflect[r(403)](e,s,i,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a}([(Ms=0,Ds=De,function(t,e){Ds(t,e,Ms)})],Rs),Ke[t(1700)]({start(e){const s=t;e[s(399)](Be)[s(442)](e[s(399)](be).createInstance(Rs)),e[s(399)](Be)[s(442)](e[s(399)](be)[s(798)](Is));const i=e[s(399)](De),n=e[s(399)](ve)[s(658)](6,!1);i[s(1098)][s(1134)]((()=>{const t=s;n[t(1681)](!!i[t(1098)][t(312)])}))}}),rs({id:t(1587),label:"Select All",section:t(933),run:e=>e[t(399)](De).selection[t(448)](),keys:t(1219)}),rs({id:"selection.deselect",label:"Deselect",section:t(933),run:e=>e[t(399)](De)[t(1098)].deselect(),keys:t(450),enabled:6}),rs({id:"selection.erase",label:"Erase",section:t(933),run:e=>e[t(399)](De)[t(1098)].erase(),keys:t(844),enabled:6});class Bs extends e.JT{constructor(e,s,i){const n=t;super(),this.id=e,this[n(396)]=!0,this[n(385)]=document[n(1267)](n(818)),this._contentElement.id=i.toLowerCase()[n(1429)](/ /g,""),this[n(385)][n(1276)].add(n(830),n(1359)),s[n(986)](this[n(385)]),this[n(1700)]({dispose:()=>{const t=n;s.removeChild(this[t(385)])}})}get[t(842)](){return this[t(396)]}set isVisible(e){const s=t;this[s(396)]=e,this[s(385)][s(735)][s(1671)]=this[s(396)]?"":s(973)}}var Us=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object[r(889)](s,i):n;if(typeof Reflect===r(592)&&"function"==typeof Reflect[r(403)])a=Reflect[r(403)](e,s,i,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a},ks=function(t,e){return function(s,i){e(s,i,t)}};class Ps extends Bs{constructor(e,s,i,n){const r=t;super(r(0===e?998:1477),s,r(622)),this[r(891)]=e,this._statusBarService=i,this[r(755)]=n,this[r(811)]=new Map,this[r(1689)]=document[r(1267)](r(818)),this[r(1689)][r(1276)][r(384)](r(1020)),this[r(593)]=document[r(1267)](r(818)),this[r(593)][r(1276)][r(384)](r(919)),(0===this[r(891)]?this[r(1033)][r(443)]:this._statusBarService[r(467)])((t=>this[r(468)](t))),(0===this[r(891)]?this._statusBarService[r(1047)]:this._statusBarService[r(1366)])((t=>this[r(1014)](t))),this[r(385)][r(1175)](this._leftItemsElement,this[r(593)]),this.register({dispose:()=>{const t=r;for(const e of this[t(811)][t(1563)]())for(const t of e)t.dispose()}})}[t(468)](e){const s=t,i=[],n=0===e.alignment?this[s(1689)]:this[s(593)],r=document.createElement(s(1372));if(r[s(1276)][s(384)](s(364)),e[s(551)]&&r[s(1276)].add(e[s(551)]),e[s(1590)]&&r[s(1276)].add(s(1716),s(301)),e.title&&(r.title=e[s(1730)]),r[s(604)]("click",(()=>{const t=s;e[t(983)]&&this._commandService[t(541)](e.commandId)})),e[s(991)]){const t=s(616)+Math[s(309)](1e6*Math[s(1054)]());switch(e[s(991)][s(1549)]){case"string":{const i=e[s(991)],n=document[s(1267)]("label");n[s(576)]=e[s(1248)]+": ",n[s(1270)](s(425),t);const o=document.createElement(s(967));o.id=t;for(const t of i.options){const e=document[s(1267)](s(1228));e[s(537)]=t,e[s(576)]=t,o[s(986)](e)}o[s(537)]=i.currentValue,o[s(604)]("change",(()=>i[s(419)](o[s(537)]))),i.onHistoryUpdateValue((t=>o[s(537)]=t)),r.append(n,o);break}case s(1679):{const i=e[s(991)],n=document[s(1267)](s(1297));n[s(576)]=e[s(1248)]+": ",n[s(1270)](s(425),t);const o=document.createElement("input");o.id=t,o[s(1549)]=s(1679),i.min&&(o[s(584)]=i[s(584)][s(1462)]()),i[s(839)]&&(o[s(839)]=i[s(839)][s(1462)]()),o[s(537)]=i[s(1415)].toString(),o[s(604)]("input",(()=>{o.checkValidity()&&i.setOption(parseInt(o.value))})),i.onHistoryUpdateValue((t=>o[s(537)]=t[s(1462)]())),r.append(n,o);break}}}e[s(1134)]&&i[s(1568)](e[s(1134)]((()=>this[s(1252)](e,r)))),this[s(1252)](e,r),n[s(986)](r),i.push({dispose:()=>n.removeChild(r)}),this._itemDisposables[s(1681)](e,i)}[t(1014)](e){const s=t,i=this[s(811)][s(399)](e);if(i){for(const t of i)t.dispose();this[s(811)][s(844)](e)}}[t(1252)](e,s){const i=t;e[i(991)]?s[i(543)](i(1297))[i(576)]=e.text+": ":(s[i(576)]=e[i(1248)],s[i(1276)][i(1274)](i(690),0===e[i(1248)]?.[i(823)])),e[i(1730)]&&(s[i(1730)]=e[i(1730)]),s[i(735)].display=!1===e[i(1419)]?i(973):"",s[i(1276)][i(1274)]("interactive",!!e[i(983)]&&!1!==e[i(1214)]),s.classList[i(1274)]("checked",!!e[i(700)]),void 0!==e[i(1214)]&&s[i(1276)][i(1274)](i(1726),!e[i(1214)])}}let Ns=class extends Ps{constructor(t,e,s){super(0,t,e,s)}};Ns=Us([ks(1,Be),ks(2,we)],Ns);let Fs=class extends Ps{constructor(t,e,s){super(1,t,e,s)}};Fs=Us([ks(1,Be),ks(2,we)],Fs),Ve[t(1700)](t(998),{anchor:t(362),ctor:Ns}),Ve[t(1700)](t(1477),{anchor:"bottom",ctor:Fs}),rs({id:t(413),label:t(390),section:t(1247),run:e=>e[t(399)](Ne)[t(1644)]("topStatusBar")}),rs({id:t(743),label:t(1336),section:"Window",run:e=>e[t(399)](Ne)[t(1644)](t(1477))});class Os extends e.JT{constructor(e,s){const i=t;super(),this[i(1586)]=e,this.className=s,this[i(1652)]=0,this[i(619)]=0,this.hasImage=!0,this[i(1248)]="",this._onUpdate=this[i(1700)](new n.v),this[i(1134)]=this[i(643)][i(1053)],this[i(1586)][i(1134)]&&this[i(1700)](this[i(1586)][i(1134)]((()=>this[i(1592)]()))),this._update()}[t(1592)](){const e=t;switch(this._action.type){case e(869):this[e(983)]=e(1603);break;case e(689):this[e(983)]=e(947);break;default:throw new Error('Unknown command id for type "'+this._action[e(1549)]+'"')}this[e(1730)]=this[e(1586)].name,this.enabled=this[e(1586)][e(1214)],this[e(643)][e(1448)]()}}class Vs{constructor(){this[t(1305)]=[]}[t(1598)](e){const s=t,i=e[s(399)](De),n=e[s(399)](Be);i[s(751)][s(1421)]((()=>this[s(1592)](i,n)))}[t(1592)](e,s){const i=t;for(const t of this._activeItems)t[i(921)]();this[i(1305)][i(823)]=0;const n=e[i(751)][i(1458)];for(const t of n)this._activeItems.push(s.createItem(new Os(t,e[i(751)].activeTool+"-"+t[i(1549)])))}}class Hs extends e.JT{constructor(e,s){const i=t;super(),this[i(1643)]=e,this[i(551)]=s,this[i(1652)]=1,this.alignment=0,this[i(1590)]=!0,this.visible=!1,this[i(643)]=this.register(new n.v),this[i(1134)]=this[i(643)].event,this[i(1700)](this[i(1643)][i(1134)]((()=>this[i(1592)]()))),this[i(1592)]()}[t(1592)](){const e=t;this._info[e(1419)]?(this.text=this._info[e(1521)](),this[e(1730)]=this[e(1643)].getDetailedInfo(),this[e(1419)]=!0,this[e(643)][e(1448)]()):this[e(1419)]&&(this[e(1248)]="",this[e(1419)]=!1,this[e(643)][e(1448)]())}}class zs{constructor(){this[t(1305)]=[]}start(e){const s=t,i=e[s(399)](De),n=e[s(399)](Be);i.tool.onToolChange((()=>this[s(1592)](i,n)))}[t(1592)](e,s){const i=t;for(const t of this[i(1305)])t[i(921)]();switch(this._activeItems[i(823)]=0,e[i(751)].activeTool){case i(959):for(const t of e.tool[i(480)])(t[i(1549)]===i(461)||"topleft"===t[i(1549)])&&this[i(1305)][i(1568)](s.createItem(new Hs(t,e[i(751)][i(1303)]+"-"+t[i(1549)])))}}}class Ws{constructor(){this._activeItems=[]}[t(1598)](e){const s=t,i=e[s(399)](De),n=e[s(399)](Be);i[s(751)][s(1421)]((()=>this[s(1592)](i,n)))}[t(1592)](e,s){const i=t;for(const t of this[i(1305)])t[i(921)]();this[i(1305)].length=0;const n=e[i(751)][i(1690)];for(const t of n)switch(t[i(1549)]){case i(887):break;case"string":const e=t;this._addOption(s,t[i(1401)],{type:i(393),currentValue:e[i(537)],options:e[i(1690)],setOption:e=>t[i(537)]=e,onHistoryUpdateValue:t[i(554)]});break;case i(1679):const n=t;this[i(577)](s,t[i(1401)],{type:"number",currentValue:n[i(537)],min:n[i(584)],max:n[i(839)],setOption:e=>t[i(537)]=e,onHistoryUpdateValue:t.onHistoryUpdateValue})}}[t(577)](e,s,i){const n=t;this._activeItems[n(1568)](e[n(442)]({target:0,alignment:0,dispose:()=>{},text:s,input:i}))}}var qs=function(t,e){return function(s,i){e(s,i,t)}};const js=new Map([[t(1098),"S"],[t(949),"M"],[t(1167),"P"],["moveSelection","M"],[t(1257),"E"],[t(1173),"K"],["fill","F"],[t(1347),"Z"],[t(959),"O"]]);let Gs=class extends us{constructor(e,s,i){const n=t;super("tools",e,n(944),"topleft"),this[n(394)]=s,this[n(1060)]=i,this[n(1324)]=new Map,this[n(821)]=this[n(1060)].bind(0,!0),this[n(1700)](this[n(1174)]((t=>this[n(821)][n(1681)](t))));const r=n(1167),o=document.createDocumentFragment();for(const[t,e]of[n(1098),n(949),n(1167),n(611),"eraser",n(1173),n(318),n(1347),n(959)][n(683)]()){const s=document[n(1267)]("div");s.classList[n(384)]("tool-container");const i=document[n(1267)](n(991));i.name=n(751),i.type=n(621),i[n(1276)][n(384)]("tool",e,n(1532));const h=Xs(e),a=js[n(399)](e);a?i.title=h+" ("+a+")":i[n(1730)]=""+h,i[n(1270)]("aria-label",h),this[n(1324)][n(1681)](e,i),i[n(700)]=e===r,i[n(604)](n(740),(()=>this[n(394)][n(751)][n(1569)](e))),i[n(604)](n(634),(i=>{const r=n;switch(i.key){case r(979):s[r(834)]?.previousSibling?.[r(1653)]?.[r(511)](),i[r(1103)](),i[r(332)]();break;case r(497):const n=s[r(401)]?.[r(401)]?.[r(1653)];n?n[r(511)]():s[r(401)]?.firstChild?.[r(511)](),i.preventDefault(),i[r(332)]();break;case r(725):t%2==1&&s[r(834)]?.firstChild?.[r(511)](),i.preventDefault(),i.stopImmediatePropagation();break;case r(1235):if(t%2==0){const t=s[r(401)]?.[r(1653)];t?t[r(511)]():s[r(834)]?.firstChild?.[r(511)]()}i[r(1103)](),i[r(332)]();break;case r(631):this[r(394)].tool.setTool(e)}})),s[n(986)](i),o[n(986)](s)}this[n(385)][n(986)](o),this[n(1700)](this[n(394)][n(751)][n(1421)]((t=>{const e=n;this._toolElements.get(t.id).checked=!0;for(const[s,i]of this[e(1324)][e(683)]())i[e(1017)]?.[e(1276)][e(1274)](e(700),s===t.id)}))),this[n(394)][n(751)][n(1569)](r)}};function Xs(e){const s=t;return((e.substr(0,1)[s(336)]()+e[s(519)](1)).match(/[A-Z][a-z]+/g)||[])[s(1425)](" ")}function Js(e,s){const i=t,n=e[i(399)](De);n[i(751)][i(1569)](s),n[i(977)][i(511)]()}Gs=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object[r(889)](s,i):n;if(typeof Reflect===r(592)&&typeof Reflect[r(403)]===r(1343))a=Reflect[r(403)](e,s,i,n);else for(var c=e[r(823)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a}([qs(1,De),qs(2,ve)],Gs),ze[t(1700)](t(703),{ctor:Gs,defaultVisible:!0}),Ke[t(1700)](new Ws),Ke[t(1700)](new Vs),Ke[t(1700)](new zs),rs({id:"tool.toggleToolsWindow",label:t(1186),section:t(1247),checked:0,run:e=>e[t(399)](Ne)[t(1644)](t(703))}),rs({id:t(431),label:"Color Picker",section:t(984),run:e=>Js(e,t(1173)),keys:"k"}),rs({id:t(867),label:t(1693),section:"Tool",run:e=>Js(e,t(1257)),keys:"e"}),rs({id:t(1552),label:t(1009),section:t(984),run:e=>Js(e,t(318)),keys:"f"}),rs({id:t(432),label:t(688),section:t(984),run:e=>Js(e,t(949))}),rs({id:"tool.moveSelection",label:"Move Selection",section:t(984),run:e=>Js(e,t(611))}),rs({id:t(718),label:t(937),section:t(984),run:e=>{const s=t;e[s(399)](De)[s(751)][s(1303)]===s(949)?Js(e,s(611)):Js(e,s(949))},keys:"m"}),rs({id:t(741),label:"Pencil",section:t(984),run:t=>Js(t,"pencil"),keys:"p"}),rs({id:t(847),label:"Rectangle",section:"Tool",run:e=>Js(e,t(959)),keys:"o"}),rs({id:t(693),label:t(933),section:t(984),run:e=>Js(e,t(1098)),keys:"s"}),rs({id:"tool.zoom",label:t(761),section:t(984),run:e=>Js(e,t(1347)),keys:"z"}),rs({id:t(1474),label:"Focus Canvas",section:t(1189),run:e=>e[t(399)](De)[t(977)].focus()}),rs({id:t(1078),label:"Zoom In",section:"View",run:e=>e[t(399)](De)[t(977)][t(562)]()}),rs({id:t(789),label:"Zoom Out",section:t(1189),run:e=>e[t(399)](De).viewport[t(1292)]()}),rs({id:t(875),label:t(540),section:t(1189),run:e=>e[t(399)](De).viewport[t(1347)]=1,keys:t(1414)}),rs({id:t(1600),label:"Fit to Window",section:"View",run:e=>e[t(399)](De)[t(977)].fitToWindow(),keys:t(946)}),rs({id:t(428),label:t(1483),section:t(1189),run:e=>{const s=t,i=e.get(De)[s(977)];i[s(776)]=!i.isPixelGridEnabled}});let Ys=class extends e.JT{constructor(e){const s=t;super(),this[s(1601)]=e,this[s(1652)]=0,this[s(619)]=1,this[s(551)]=s(1404),this[s(1590)]=!0,this.text="",this[s(1730)]=s(1236),this[s(983)]=s(428),this._onUpdate=this[s(1700)](new n.v),this[s(1134)]=this[s(643)][s(1053)],this._lunaService.viewport[s(1416)]((()=>this[s(1592)]())),this[s(1592)]()}[t(1592)](){const e=t;this[e(700)]=this[e(1601)][e(977)][e(776)],this[e(643)].fire()}};var Ks,Zs;Ys=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object.getOwnPropertyDescriptor(s,i):n;if(typeof Reflect===r(592)&&typeof Reflect[r(403)]===r(1343))a=Reflect[r(403)](e,s,i,n);else for(var c=e[r(823)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object.defineProperty(s,i,a),a}([(Ks=0,Zs=De,function(t,e){Zs(t,e,Ks)})],Ys);let $s=class extends e.JT{constructor(e){const s=t;super(),this._lunaService=e,this[s(1652)]=1,this[s(619)]=1,this[s(551)]="zoom",this[s(1590)]=!0,this[s(643)]=this[s(1700)](new n.v),this[s(1134)]=this[s(643)][s(1053)],this[s(1601)].viewport.onZoomChange((()=>this[s(1592)]())),this._update()}[t(1592)](){const e=t,s=(100*this[e(1601)][e(977)].zoom)[e(1127)](0);this[e(1248)]=s+"%",this[e(1730)]=e(936)+s+"%",this[e(643)].fire()}};var Qs,ti;$s=function(e,s,i,n){const r=t;var o,h=arguments[r(823)],a=h<3?s:null===n?n=Object.getOwnPropertyDescriptor(s,i):n;if(typeof Reflect===r(592)&&typeof Reflect[r(403)]===r(1343))a=Reflect[r(403)](e,s,i,n);else for(var c=e[r(823)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a}([(Qs=0,ti=De,function(t,e){ti(t,e,Qs)})],$s),Ke[t(1700)]({start(e){const s=t,i=e[s(399)](Be),n=e[s(399)](be);i.createItem(n[s(798)]($s)),i[s(442)](n[s(798)](Ys))}});var ei=function(t,e){return function(s,i){e(s,i,t)}};let si=class extends us{constructor(s,i,n,r,o){const h=t;super("minimap",s,h(296),h(851)),this._luna=i,this[h(1060)]=n,this[h(755)]=r,this[h(901)]=o,this._timeout=0,this[h(821)]=this._contextKeyService[h(658)](4,!0),this.register(this.onDidChangeVisibility((t=>this._windowVisibleContextKey.set(t))));const a=this[h(1677)](h(1190),h(754),this[h(901)].isStretchEnabled,h(833));this._minimapService[h(637)]((t=>{const e=h;a[e(700)]=t,this._queueUpdate(),this[e(476)]()}));const c=this._createToggle("minimap-show-viewport","minimap.toggleShowViewport",this[h(901)][h(603)],"Toggle the viewport display in the minimap");this._minimapService[h(355)]((t=>{c[h(700)]=t,this._viewportUpdate()})),this[h(853)][h(1175)](a,c),this[h(731)]=document[h(1267)](h(544)),this._canvas[h(956)]=200,this[h(731)].height=200,this[h(731)][h(735)].width="200px",this[h(731)].style[h(897)]="200px",this[h(1700)]((0,e.Lw)(this[h(731)],h(1502),(t=>{const e=h;if(!this[e(1443)](t)){const s=this[e(896)]();this[e(394)][e(977)].x=-((t[e(1049)]-s.left)/s[e(956)]*this._luna[e(826)].width-this[e(394)][e(826)].width/2),this[e(394)][e(977)].y=-((t[e(760)]-s[e(362)])/s.height*this._luna[e(826)][e(897)]-this[e(394)][e(826)].height/2)}this[e(731)].setPointerCapture(t[e(642)]),this[e(731)].classList.add(e(310)),this[e(1624)]=[t[e(1049)],t[e(760)]],this[e(782)]=[this[e(394)][e(977)].x,this[e(394)][e(977)].y]}))),this[h(1700)]((0,e.Lw)(this[h(731)],h(1485),(t=>{const e=h;this[e(731)].releasePointerCapture(t[e(642)]),this[e(731)][e(1276)][e(676)](e(310)),this[e(1624)]=void 0,this[e(782)]=void 0}))),this[h(1700)]((0,e.Lw)(this[h(731)],h(572),(t=>{const e=h,s=this[e(394)][e(977)].visibleRange,i=0===s[e(351)]&&0===s[e(362)]&&s.right===this._luna.layer[e(956)]&&s[e(955)]===this[e(394)][e(826)].height;if(this._canvas[e(1276)][e(1274)](e(1732),!i&&this[e(1443)](t)),!this[e(1624)]||!this[e(782)])return;const n=this[e(896)]();this[e(394)][e(977)].x=this[e(782)][0]+(this[e(1624)][0]-n[e(351)]-(t[e(1049)]-n[e(351)]))*(this[e(394)][e(826)][e(956)]/n.width),this._luna.viewport.y=this[e(782)][1]+(this[e(1624)][1]-n[e(362)]-(t[e(760)]-n.top))*(this._luna[e(826)][e(897)]/n.height)}))),this[h(1700)]((0,e.Lw)(this._canvas,h(1499),(t=>{const e=h;this[e(731)][e(1276)][e(676)](e(1732))}))),this.register((0,e.Lw)(this[h(731)],h(881),(t=>{const e=h;Qt.V?t[e(804)]<0?this[e(394)][e(977)][e(562)](-t[e(804)]/20):this[e(394)][e(977)][e(1292)](t.deltaY/20):t[e(804)]<0?this[e(394)][e(977)].zoomIn():this[e(394)][e(977)][e(1292)]()}))),this[h(564)]=this._canvas[h(695)]("2d"),this[h(726)]=document[h(1267)]("div"),this._viewportElement[h(1276)][h(384)](h(1538)),this[h(385)][h(1175)](this[h(731)],this._viewportElement),this[h(1700)](this[h(394)][h(831)][h(775)]((()=>this._queueUpdate()))),this[h(1700)](this[h(394)].layer[h(590)]((()=>this[h(1321)]()))),this[h(1700)](this[h(394)].viewport[h(1134)]((()=>this._viewportUpdate()))),this[h(1592)](),this._viewportUpdate()}[t(1321)](){const e=t;this[e(394)][e(826)][e(956)]&&0===this[e(723)]&&(this[e(723)]=setTimeout((()=>{const t=e;this[t(1592)](),this[t(723)]=0})))}async[t(1592)](){const e=t,s=await this[e(394)][e(335)][e(742)]();if(!s[e(956)]||!s.height)return void this._canvas.classList[e(384)](e(1533));this[e(731)].classList[e(676)](e(1533));const i=new ImageData(new Uint8ClampedArray(s[e(969)]),s[e(956)],s[e(897)]),n=await createImageBitmap(i);this[e(564)].imageSmoothingEnabled=s.width>200||s[e(897)]>200,this[e(564)].clearRect(0,0,200,200);const r=this[e(896)]();this._ctx[e(1176)](n,r[e(351)],r[e(362)],r[e(956)],r[e(897)])}[t(476)](){const e=t;if(!this._luna[e(826)].width)return;const s=this[e(394)][e(826)],i=this[e(896)](),n=this[e(394)][e(977)][e(1667)],r=0===n[e(351)]&&0===n[e(362)]&&n[e(1702)]===s[e(956)]&&n.bottom===s[e(897)];this[e(726)][e(1276)][e(1274)](e(1533),r||!this[e(901)][e(603)]),this[e(994)]={left:i[e(351)]+Math[e(309)](n[e(351)]/s[e(956)]*i[e(956)]),top:i.top+Math[e(309)](n[e(362)]/s[e(897)]*i.height),width:Math.round((n[e(1702)]-n[e(351)])/s.width*i[e(956)]),height:Math.round((n.bottom-n.top)/s.height*i[e(897)])},this[e(726)][e(735)].left=this[e(994)][e(351)]+"px",this[e(726)][e(735)][e(362)]=this[e(994)][e(362)]+"px",this._viewportElement[e(735)][e(956)]=this[e(994)][e(956)]+"px",this._viewportElement.style[e(897)]=this[e(994)][e(897)]+"px"}_eventInViewport(e){const s=t;return!!this[s(994)]&&e.offsetX>this._viewportPosition[s(351)]&&e.offsetX<this[s(994)][s(351)]+this._viewportPosition[s(956)]&&e[s(760)]>this[s(994)].top&&e.offsetY<this[s(994)][s(362)]+this[s(994)][s(897)]}[t(1677)](e,s,i,n){const r=t,o=document[r(1267)](r(991));return o.type="checkbox",o.id=e,o[r(700)]=i,o[r(1730)]=n,o[r(1276)][r(384)](e,r(1532)),o[r(604)](r(865),(()=>this[r(755)][r(541)](s))),o}[t(896)](){const e=t;return(0,Ft.M_)(this[e(394)][e(826)][e(956)],this[e(394)][e(826)][e(897)],200,200,this._minimapService.isStretchEnabled)}};si=function(e,s,i,n){const r=t;var o,h=arguments.length,a=h<3?s:null===n?n=Object[r(889)](s,i):n;if(typeof Reflect===r(592)&&typeof Reflect[r(403)]===r(1343))a=Reflect[r(403)](e,s,i,n);else for(var c=e[r(823)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a}([ei(1,De),ei(2,ve),ei(3,we),ei(4,je)],si),ze[t(1700)](t(1139),{ctor:si,defaultVisible:!0}),rs({id:"minimap.toggleMinimapWindow",label:t(567),section:t(1247),checked:4,run:e=>e[t(399)](Ne).toggleView(t(1139))}),rs({id:t(1729),label:t(836),section:t(296),run:e=>{const s=t,i=e[s(399)](je);i[s(603)]=!i.showViewport}}),rs({id:t(754),label:t(926),section:t(296),run:e=>{const s=t,i=e[s(399)](je);i[s(1478)]=!i[s(1478)]}});var ii=function(t,e){return function(s,i){e(s,i,t)}};let ni=class extends us{constructor(s,i,n){const r=t;super(r(1116),s,r(970),"bottomright"),this[r(394)]=i,this[r(1060)]=n,this[r(734)]=new Map,this[r(1364)]=new Map,this[r(821)]=this[r(1060)][r(658)](2,!0),this.register(this[r(1174)]((t=>this[r(821)].set(t)))),this._layerListElement=document.createElement(r(818)),this[r(1371)].classList[r(384)](r(1227));const o=document[r(1267)]("div");o[r(1276)][r(384)](r(1458)),o[r(1175)](this._createButton(r(1560),(()=>this[r(394)][r(826)][r(1487)]()),r(922)),this[r(1514)](r(1074),(()=>this[r(394)][r(826)][r(305)]()),r(1602)),this[r(1514)]("layer-merge",(()=>this[r(394)][r(826)][r(1036)]()),r(756)),this[r(1514)](r(1172),(()=>this[r(394)][r(826)].moveLayerUp()),"Move the active layer up"),this[r(1514)](r(1193),(()=>this[r(394)][r(826)].moveLayerDown()),r(963)),this[r(483)]()),this[r(385)][r(1175)](this[r(1371)],o),this.register(this[r(394)][r(826)][r(930)]((()=>this[r(1665)]()))),this[r(1700)]({dispose:()=>{const t=r;for(const s of this[t(734)][t(1563)]())(0,e._c)(s[t(1540)])}}),this._renderLayers()}_createButton(e,s,i){const n=t,r=document[n(1267)]("button");r.id=e,r[n(1730)]=i;const o=document.createElement(n(587));return r[n(986)](o),r[n(1276)].add(e,n(1532)),r[n(604)](n(865),s),r}_createBlendModeSelect(){const e=t,s=document[e(1267)](e(967)),i=[e(361),"darken",e(820),e(1722),e(1112),e(899),"linearDodgeAdd",e(981),e(1156),e(746),e(728)];for(const t of i){const i=document.createElement(e(1228));i[e(576)]=t,i[e(537)]=t,this[e(1364)][e(1681)](t,i),s[e(986)](i)}return s[e(604)](e(740),(()=>{const t=e;this[t(394)][t(826)][t(1019)]&&(this._luna[t(826)][t(1019)][t(1426)]=s.value)})),s}_renderLayers(){const e=t,s=this[e(394)][e(826)][e(1116)],i=this._luna[e(826)][e(1019)];let n=null;for(let t=s[e(823)]-1;t>=0;t--){const r=s[t];if(!this[e(734)][e(1436)](r.id)){const t={container:document[e(1267)]("div"),nameSpan:document[e(1267)](e(1372)),previewCanvas:document[e(1267)]("canvas"),visibleCheckbox:document[e(1267)](e(991)),disposables:[]};t[e(420)][e(1276)][e(384)](e(826)),t[e(420)][e(518)]=0,t.previewCanvas[e(1276)].add(e(1642)),t[e(1008)][e(956)]=40,t.previewCanvas.height=40;let s=!1;t[e(1540)][e(1568)](r[e(1134)]((()=>s=!0))),this[e(1159)][e(1568)](this._luna[e(831)][e(775)]((()=>{s&&(this[e(1370)](r,t),s=!1)}))),this[e(1370)](r,t),t[e(420)][e(986)](t.previewCanvas),t.nameSpan.classList[e(384)](e(1401)),t.container.appendChild(t[e(1299)]),t[e(1328)][e(1549)]="checkbox",t[e(1328)][e(1276)][e(384)](e(1419)),t[e(1328)][e(604)](e(740),(()=>r[e(842)]=!r[e(842)])),t[e(420)].appendChild(t[e(1328)]);const i=s=>{const i=e;s?.[i(1652)]!==t[i(1328)]&&(this[i(394)][i(826)][i(1019)]=r)};t.container[e(604)]("click",(t=>i(t))),t.container[e(604)](e(634),(s=>{const n=e;switch(s[n(914)]){case n(979):t.container[n(834)]?.[n(511)](),s.preventDefault();break;case"ArrowDown":t[n(420)][n(401)]?.[n(511)](),s[n(1103)]();break;case n(631):case n(1469):i()}})),this._layerListItems[e(1681)](r.id,t),t[e(1540)].push(r[e(1525)]((()=>{const s=e;this[s(1371)][s(561)](t[s(420)]);for(const e of t[s(1540)])e.dispose();this._layerListItems[s(844)](r.id)})))}const o=this[e(734)][e(399)](r.id),h=r.id===i?.id;o[e(420)][e(1276)].toggle(e(478),h),o[e(1299)].textContent=r[e(1401)],o[e(1328)][e(700)]=r.isVisible,null===n?(!o.container[e(1017)]||null!==o[e(420)].previousSibling)&&(this[e(1371)][e(1653)]?this._layerListElement[e(1626)](o[e(420)],this[e(1371)][e(1653)]):this[e(1371)][e(986)](o[e(420)])):o[e(420)][e(834)]!==n&&n[e(1647)](e(1201),o[e(420)]),n=o[e(420)]}if(i){const t=this[e(1364)][e(399)](i[e(1426)]);t&&(t[e(857)]=!0)}}[t(1370)](e,s){const i=t;e[i(1187)](40,40)[i(1580)]((t=>{const e=i,n=s[e(1008)][e(695)]("2d");n[e(987)]=!1,n[e(747)](0,0,40,40),n[e(1176)](t,0,0)}))}};async function ri(e,s,i,n){const r=t;switch(await i[r(335)].openFile(e,s),s){case r(363):n.runCommand("image.toggleImagesWindow"),n[r(541)](r(1512)),n[r(541)]("minimap.toggleMinimapWindow")}}function oi(){const e=t,s=ai(getComputedStyle(document[e(1150)]).getPropertyValue(e(1559)));void 0!==s&&document[e(1556)][e(735)][e(764)]("--luna-icon-brightness",s);const i=ai(getComputedStyle(document.documentElement)[e(1180)](e(1044)));void 0!==i&&document[e(1556)].style[e(764)]("--luna-icon-list-active-brightness",i);const n=ai(getComputedStyle(document[e(1150)]).getPropertyValue(e(1124)));void 0!==n&&document[e(1556)][e(735)].setProperty("--luna-statusBar-icon-brightness",n)}function hi(e,s,i){const n=t;return e.request(n(1495),{key:s,value:i})}function ai(e){const s=t;let i,n,r,o;if(e[s(777)](s(627)))[i,n,r,o]=e[s(1147)](5,e[s(1061)](")"))[s(1282)](",")[s(1220)]((t=>+t.trim()));else{if(7!==e[s(823)])return;i=parseInt(e.substr(1,2),16),n=parseInt(e[s(519)](3,2),16),r=parseInt(e[s(519)](5,2),16),o=1}return((i+n+r)*o/765)[s(1127)](2)}ni=function(e,s,i,n){const r=t;var o,h=arguments.length,a=h<3?s:null===n?n=Object.getOwnPropertyDescriptor(s,i):n;if(typeof Reflect===r(592)&&typeof Reflect[r(403)]===r(1343))a=Reflect.decorate(e,s,i,n);else for(var c=e[r(823)]-1;c>=0;c--)(o=e[c])&&(a=(h<3?o(a):h>3?o(s,i,a):o(s,i))||a);return h>3&&a&&Object[r(652)](s,i,a),a}([ii(1,De),ii(2,ve)],ni),ze[t(1700)]("layers",{ctor:ni,defaultVisible:!0}),rs({id:"layer.toggleLayersWindow",label:t(1683),section:t(1247),checked:2,run:e=>e[t(399)](Ne)[t(1644)](t(1116))}),rs({id:t(1027),label:"Add New Layer",section:t(1287),run:e=>e[t(399)](De).layer.newLayer(),keys:t(1115)}),rs({id:t(1518),label:"Delete Layer",section:t(1287),run:e=>e[t(399)](De).layer[t(305)](),keys:t(708)}),rs({id:t(512),label:t(687),section:t(1287),run:e=>e[t(399)](De)[t(826)][t(1036)](),keys:"ctrl+m"}),rs({id:t(1369),label:"Flip Horizontal",section:t(1287),run:async e=>{const s=t,i=e.get(De);i[s(997)].executeOnSingleLayer(s(1085),{selection:i[s(1098)][s(312)]})}}),rs({id:t(1168),label:t(517),section:"Layer",run:async e=>{const s=t,i=e[s(399)](De);i[s(997)][s(1056)](s(324),{selection:i.selection[s(312)]})}}),rs({id:t(1090),label:t(1005),section:t(1287),run:async e=>{const s=t,i=e[s(399)](De);i.task.executeOnSingleLayer("layer/rotate180",{selection:i[s(1098)].range})}}),rs({id:t(1593),label:t(871),section:t(1287),run:e=>e[t(399)](De)[t(826)][t(1153)](),keys:t(356)}),rs({id:"layer.goToBottomLayer",label:t(1081),section:t(1287),run:e=>e.get(De).layer[t(1037)](),keys:t(781)}),rs({id:t(1325),label:t(523),section:t(1287),run:e=>e[t(399)](De)[t(826)].goToLayerAbove(),keys:t(1628)}),rs({id:t(1184),label:t(1277),section:"Layer",run:e=>e.get(De).layer[t(888)](),keys:t(298)}),rs({id:t(1096),label:"Move Layer to Top",section:t(1287),run:e=>e[t(399)](De)[t(826)][t(1473)]()}),rs({id:"layer.moveLayerUp",label:t(709),section:t(1287),run:e=>e[t(399)](De)[t(826)][t(805)]()}),rs({id:"layer.moveLayerDown",label:t(371),section:t(1287),run:e=>e[t(399)](De)[t(826)][t(1382)]()}),rs({id:t(958),label:t(978),section:t(1287),run:e=>e[t(399)](De)[t(826)][t(1272)]()}),Ke[t(1700)]({start(e){const s=t,i=e[s(399)](De),n=e[s(399)](we),r=e[s(399)](Ze),o=e[s(399)](Fe);r.registerRequestHandler(s(697),(async t=>{const i=s;let n=!0;try{await e.get(we)[i(541)](t)}catch{n=!1}return{success:n}})),r[s(1213)](s(1212),(async t=>{const e=s,n=await(t[e(1605)]?i[e(335)][e(1424)]():i[e(335)][e(1412)]());return{blobBuffer:Array.from(new Uint8Array(await n[e(1604)]()))}})),r.registerRequestHandler(s(1578),(async t=>{const e=s;return t.hotExitMaxPixels&&t[e(1465)]<i.layer[e(956)]*i[e(826)][e(897)]?{success:!1}:{success:!0,state:i[e(335)][e(840)](t[e(1465)])}})),r[s(1213)]("open",(async t=>{const e=s;ri(t[e(969)],t[e(1335)],i,n)})),r.request("ready",void 0)[s(1580)]((async t=>{const e=s;switch(t[e(1549)]){case e(1131):i.file.newImage(t[e(313)][e(956)],t[e(313)][e(897)]);break;case e(1721):await ri(t[e(969)],t.extName,i,n);break;case e(1249):(!t[e(1289)]||0===t[e(1470)][e(1556)][e(831)]?.[e(683)]?.[e(823)])&&(t[e(1470)][e(1556)][e(831)]={currentEntry:0,entries:[(new M).serialize()]}),i[e(335)][e(508)](t[e(1470)]),t[e(326)]&&o[e(508)](t[e(326)])}})),o[s(1398)]((t=>r[s(487)](s(1564),t))),r[s(1213)]("pauseanimations",(()=>i.render[s(437)]())),window.addEventListener(s(511),(()=>{const t=s;hi(r,t(387),!0),i[t(1256)][t(1453)]()})),window[s(604)](s(1374),(()=>{hi(r,"luna:focused",!1)})),window.addEventListener(s(1488),(t=>{const e=s,i=t[e(1652)];if(i.tagName!==e(1524))hi(r,e(404),!1);else{const t=i,s=t.type===e(1248)||t[e(1549)]===e(1679);hi(r,"luna:textFocused",s)}})),window[s(604)]("focusout",(t=>{hi(r,"luna:textFocused",!1)})),i[s(831)][s(775)]((t=>{const e=s;!t||i[e(831)].entries[e(823)]<=1||i.history[e(1467)]!==i[e(831)][e(683)][i[e(831)].entries[e(823)]-1]||r.request(e(1052),{label:i[e(831)][e(1467)][e(1095)]})})),rs({id:s(1565),label:"Toggle Menu Bar",section:"View",run:()=>{const t=s;return r.request(t(1209),{command:t(712),args:">Luna: "})}}),e.get(Be)[s(442)]({text:s(850),alignment:0,className:s(1379),hasImage:!0,target:0,dispose:()=>{},commandId:"vscode.toggleMenuBar"}),fs[s(827)]=()=>r[s(487)](s(1209),{command:s(344)}),fs[s(671)]=()=>r[s(487)](s(1209),{command:s(1293)}),new MutationObserver((()=>oi())).observe(document[s(1150)],{attributes:!0,attributeFilter:[s(735)]}),oi()}});const ci=new Re,li=new se;li.task[t(1048)]=!0,ci.setService(De,li);const di=window[t(1302)]();window[t(1302)]=void 0,ci[t(819)](Ze,ci[t(798)]($e,di)),ci[t(819)](Fe,ci[t(798)](Je)),ci.setService(Pe,ci[t(798)](ss)),ci[t(819)](ve,ci.createInstance(Le)),ci[t(819)](we,ci[t(798)](Ee)),ci[t(819)](Te,ci[t(798)](ts)),ci.setService(Be,ci[t(798)](Ue)),ci[t(819)](Me,ci.createInstance(Qe)),ci.setService(je,ci.createInstance(Ge)),ci[t(819)](Ne,ci[t(798)](qe)),new class{constructor(e){const s=t,i=document.querySelector(s(1143));e[s(1714)](De)[s(977)][s(1596)](i);for(const t of Ke[s(945)]())e[s(1166)](t[s(1598)][s(658)](t))}}(ci)})()})();